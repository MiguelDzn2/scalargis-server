(this["webpackJsonp@scalargis/backoffice"]=this["webpackJsonp@scalargis/backoffice"]||[]).push([[0],{226:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return b}));a(49),a(10);var i=a(2),c=a(5),n=a(4),r=a(26),s=a(11),o=a(12),l=a(253),d=a(154),u=a(103),j=function(e){Object(s.a)(a,e);var t=Object(o.a)(a);function a(e,i){var c;return Object(n.a)(this,a),c=t.call(this,e),Object.setPrototypeOf(Object(r.a)(c),a.prototype),c.name=c.constructor.name,"function"===typeof Error.captureStackTrace?Error.captureStackTrace(Object(r.a)(c),c.constructor):c.stack=new Error(e).stack,c.stack=(new Error).stack,c}return Object(c.a)(a)}(Object(l.a)(Error)),b=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=function(e){var t=e.headers||new Headers({Accept:"application/json"});if(t.has("Content-Type")||e&&(!e.method||"GET"===e.method)||e&&e.body&&e.body instanceof FormData||t.set("Content-Type","application/json"),e.user&&e.user.authenticated&&e.user.token)t.set("X-API-KEY",e.user.token);else{var a=(new u.a).get("scalargis_webgis");a&&a.token&&t.set("X-API-KEY",a.token)}return t}(t);return fetch(e,Object(i.a)(Object(i.a)({},t),{},{headers:a})).then((function(e){return e.text().then((function(t){return{status:e.status,statusText:e.statusText,headers:e.headers,body:t}}))})).then((function(e){var t,a=e.status,i=e.statusText,c=e.headers,n=e.body;try{t=JSON.parse(n)}catch(r){}return a<200||a>=300?Promise.reject(new j(t&&t.message||i,a,t)):Promise.resolve({status:a,headers:c,body:n,json:t})}))};d.stringify}).call(this,a(440).Buffer)},436:function(e,t){function a(e){return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=436},475:function(e,t,a){},476:function(e,t,a){},477:function(e,t,a){},478:function(e,t,a){},479:function(e,t,a){"use strict";a.r(t);var i={};a.r(i),a.d(i,"rememberUrl",(function(){return _})),a.d(i,"generateRGBA",(function(){return C})),a.d(i,"removeUrlParam",(function(){return w})),a.d(i,"getWindowSize",(function(){return S})),a.d(i,"isUrlAppOrigin",(function(){return k})),a.d(i,"isAdminOrManager",(function(){return F})),a.d(i,"getAppRootPath",(function(){return E})),a.d(i,"getAppBaseUrl",(function(){return R})),a.d(i,"getBackofficeBaseUrl",(function(){return P})),a.d(i,"getAppClientUrl",(function(){return L})),a.d(i,"getAppApiUrl",(function(){return A})),a.d(i,"getAppMapProxyUrl",(function(){return I})),a.d(i,"getAppUploadUrl",(function(){return T})),a.d(i,"getCookieAuthName",(function(){return D}));var c={};a.r(c),a.d(c,"AUTH_HTTP_LOADING",(function(){return M})),a.d(c,"AUTH_HTTP_ERROR",(function(){return U})),a.d(c,"AUTH_RESPONSE",(function(){return G})),a.d(c,"AUTH_LOGIN",(function(){return q})),a.d(c,"BACKOFFICE_LOAD",(function(){return V})),a.d(c,"BACKOFFICE_LOAD_DONE",(function(){return B})),a.d(c,"BACKOFFICE_SET_CONFIG",(function(){return H})),a.d(c,"BACKOFFICE_LOAD_ERROR",(function(){return z})),a.d(c,"BACKOFFICE_NOT_FOUND",(function(){return W})),a.d(c,"BACKOFFICE_NOT_AUTHORIZED",(function(){return K})),a.d(c,"BACKOFFICE_LOAD_COMPONENTS",(function(){return Z})),a.d(c,"BACKOFFICE_UNLOAD_COMPONENTS",(function(){return J})),a.d(c,"LAYOUT_WRAPPER_CLICK",(function(){return Y})),a.d(c,"LAYOUT_TOGGLE_OVERLAYMENU",(function(){return $})),a.d(c,"LAYOUT_TOGGLE_STATICMENU",(function(){return X})),a.d(c,"LAYOUT_TOGGLE_MOBILEMENU",(function(){return Q})),a.d(c,"LAYOUT_SET_MODE",(function(){return ee})),a.d(c,"LAYOUT_SET_COLORMODE",(function(){return te})),a.d(c,"login_http_loading",(function(){return ne})),a.d(c,"login_post",(function(){return re})),a.d(c,"logout",(function(){return se})),a.d(c,"login_http_error",(function(){return oe})),a.d(c,"login_response",(function(){return le})),a.d(c,"login",(function(){return de})),a.d(c,"backoffice_set_config",(function(){return ue})),a.d(c,"backoffice_load_components",(function(){return je})),a.d(c,"backoffice_unload_components",(function(){return be})),a.d(c,"backoffice_error",(function(){return pe})),a.d(c,"backoffice_not_found",(function(){return me})),a.d(c,"backoffice_not_authorized",(function(){return Oe})),a.d(c,"backoffice_load_done",(function(){return fe})),a.d(c,"backoffice_load",(function(){return he})),a.d(c,"layout_wrapper_click",(function(){return ve})),a.d(c,"layout_toggle_overlaymenu",(function(){return ge})),a.d(c,"layout_toggle_staticmenu",(function(){return xe})),a.d(c,"layout_toggle_mobilemenu",(function(){return ye})),a.d(c,"layout_toggle_menu",(function(){return Ne})),a.d(c,"layout_set_mode",(function(){return _e})),a.d(c,"layout_set_colormode",(function(){return Ce}));a(356);var n=a(1),r=a.n(n),s=a(57),o=a.n(s),l=(a(432),a(19)),d=a(2),u=a(6),j=a(136),b=a.n(j),p=a(66),m=a(480),O=a(40),f=a(14),h=a(284),v=a(324),g=a(140),x=a(103),y=function(){var e,t;return"__SCALARGIS_ROOT_PATH__"!==(null===(e=window)||void 0===e?void 0:e.SCALARGIS_ROOT_PATH)&&(null===(t=window)||void 0===t?void 0:t.SCALARGIS_ROOT_PATH)||""},N=function(){var e,t;return"__SCALARGIS_ROOT_PATH_BASE_URL__"!==(null===(e=window)||void 0===e?void 0:e.SCALARGIS_ROOT_PATH_BASE_URL)&&(null===(t=window)||void 0===t?void 0:t.SCALARGIS_ROOT_PATH_BASE_URL)||""};function _(e,t,a){var i=(Object({NODE_ENV:"production",PUBLIC_URL:"/static/backoffice",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"/api",REACT_APP_BASE_URL:"",REACT_APP_CLIENT_URL:"/static/backoffice",REACT_APP_CONFIG_URL:"",REACT_APP_COOKIE_AUTH_NAME:"scalargis_webgis",REACT_APP_COOKIE_EXPIRES_DAYS:"150",REACT_APP_COOKIE_INFO_URL:"/static/viewer/rgpd.html",REACT_APP_COOKIE_MESSAGE:"This website uses cookies to improve your browsing experience. By pressing 'I Accept' you are agreeing to its use.",REACT_APP_COOKIE_NAME:"scalargis_rgpd",REACT_APP_COOKIE_PATH:"/",REACT_APP_COOKIE_VALUE:"2",REACT_APP_DESCRIPTION:"ScalarGIS - Web GIS framework (backoffice)",REACT_APP_ENTITY_NAME:"ScalarGIS",REACT_APP_ENTITY_NAME_ABREV:"ScalarGIS",REACT_APP_ENTITY_URL:"https://www.scalargis.com",REACT_APP_MAP_PROXY:"/proxy?url=",REACT_APP_ROOT_PATH:"",REACT_APP_TITLE:"ScalarGIS",REACT_APP_UPLOAD_URL:"/spatial_toolbox/convert2geojson"}).REACT_APP_COOKIE_PREFIX||"sniguserurl")+t,c=e.get(i)||[];-1===c.indexOf(a)&&c.push(a),e.set(i,c)}var C=function(){return[Math.floor(255*Math.random()),Math.floor(255*Math.random()),Math.floor(255*Math.random()),1].join(",")},w=function(e,t){var a,i=e.split("?")[0],c=[],n=[],r=-1!==e.indexOf("?")?e.split("?")[1]:"";if(""!==r){for(var s=(c=r.split("&")).length-1;s>=0;s-=1){a=c[s].split("=")[0],new RegExp(t,"ig").test(a)||n.push(c[s])}i=i+"?"+n.join("&")}return i},S=function(){var e=window,t=document,a=t.documentElement,i=t.getElementsByTagName("body")[0];return[e.innerWidth||a.clientWidth||i.clientWidth,e.innerHeight||a.clientHeight||i.clientHeight]},k=function(e){if(0!==e.indexOf("http"))return!0;var t=new URL(window.location.href),a=new URL(e);return t.origin===a.origin},F=function(e){var t;return(null!==e&&void 0!==e&&e.data?e.data.userroles||[]:(null===e||void 0===e||null===(t=e.response)||void 0===t?void 0:t.userroles)||[]).map((function(e){return e.toLowerCase()})).filter((function(e){return["admin","manager"].includes(e)})).length>0},E=function(){return y()},R=function(){var e=y(),t=e+"";return N()&&(t=e+N()),t.endsWith("/")||(t+="/"),t},P=function(){var e=R()+"backoffice";return e.endsWith("/")||(e+="/"),e},L=function(){var e=y(),t=e+"/static/backoffice/";return(t=e+"/static/backoffice").endsWith("/")||(t+="/"),t},A=function(){var e=y(),t=e+"/api";return(t=e+"/api").startsWith("//")&&(t=window.location.protocol+t),t.toLowerCase().startsWith("http")||(t=window.location.origin+t),t},I=function(){var e=y(),t=e+"/map/proxy?url=";return(t=e+"/proxy?url=").startsWith("//")&&(t=window.location.protocol+t),t.toLowerCase().startsWith("http")||(t=window.location.origin+t),t},T=function(){var e="";return(e=y()+"/spatial_toolbox/convert2geojson").startsWith("//")&&(e=window.location.protocol+e),e.toLowerCase().startsWith("http")||(e=window.location.origin+e),e},D=function(){return"scalargis_webgis"},M="AUTH_HTTP_LOADING",U="AUTH_HTTP_ERROR",G="AUTH_RESPONSE",q="AUTH_LOGIN",V="BACKOFFICE_LOAD",B="BACKOFFICE_LOAD_DONE",H="BACKOFFICE_SET_CONFIG",z="BACKOFFICE_LOAD_ERROR",W="BACKOFFICE_NOT_FOUND",K="BACKOFFICE_NOT_AUTHORIZED",Z="BACKOFFICE_LOAD_COMPONENTS",J="BACKOFFICE_UNLOAD_COMPONENTS",Y="LAYOUT_WRAPPER_CLICK",$="LAYOUT_TOGGLE_OVERLAYMENU",X="LAYOUT_TOGGLE_STATICMENU",Q="LAYOUT_TOGGLE_MOBILEMENU",ee="LAYOUT_SET_MODE",te="LAYOUT_SET_COLORMODE",ae=A()+"/app/backoffice",ie=A(),ce=D();function ne(){return{type:M}}function re(e,t,a){return function(i,c){i(ne());var n={method:"POST",body:JSON.stringify(e)};fetch(ie+"/authentication/authenticate",n).then((function(e){return e.json()})).then((function(e){(i(le(e)),e.authenticated)?((new x.a).set(ce,e,{path:"/"}),a&&t?t.push({pathname:a}):window.location.reload()):i(oe({status:401,message:"Nome de Utilizador ou Palavra-passe inv\xe1lido"}))})).catch((function(e){console.log("error",e),i(oe(null))}))}}function se(){(new x.a).remove(ce,{path:"/"}),window.location.reload()}function oe(e){return{type:U,res:e}}function le(e){return{type:G,res:e}}function de(e){return{type:q,data:e}}function ue(e){return{type:H,config:e,backoffice:e}}function je(e){return{type:Z,components:e}}function be(e){return function(t,a){e.unloadComponents(),t({type:J})}}function pe(e){var t={type:z,redirect:"/not-found"};return t.redirect&&e&&e.push({pathname:t.redirect}),t}function me(e){var t={type:W,redirect:"/not-found"};return t.redirect&&e&&e.push({pathname:t.redirect}),t}function Oe(e,t){var a={type:K,redirect:t||"/not-allowed"};return a.redirect&&e&&e.push({pathname:a.redirect}),a}function fe(e){return{type:B}}function he(e,t){return function(a,i){var c=(new x.a).get(ce),n=ae||ie+"/app/backoffice"+(t.location.search||""),r={headers:{}};c&&(r.headers["X-API-KEY"]=c.token),fetch(n,r).then((function(e){if(401===e.status)throw new Error("Unauthorized");if(200!==e.status)throw new Error("Not found");return e.json()})).then((function(i){var c=Object(d.a)(Object(d.a)({},i),{},{config_json:i.config});if(delete c.config,!c)return a(me(t));if(!c.config_json)return a(me(t));a(be(e)),e.setConfig(c),a(ue(c));var n=0,r=c.config_json.components;r.forEach((function(t){e.addComponent(e,t,(function(){if(++n===r.length){var e={};r.forEach((function(t){return e[t.id]=t})),a(je(e)),a(fe())}}))}))})).catch((function(e){if("Not found"===e.message){t.push("/login?redirect=/")}else if("Unauthorized"===e.message)if(c)a(Oe(t));else{t.push("/login?redirect=/")}else a(se())}))}}function ve(){return{type:Y,overlayMenuActive:!1,mobileMenuActive:!1}}function ge(){return{type:$}}function xe(){return{type:X}}function ye(){return{type:Q}}function Ne(e){return function(t,a){e?"overlay"===a().backoffice.layoutMode?t(ge()):"static"===a().backoffice.layoutMode&&t(xe()):t(ye())}}function _e(e){return{type:ee,layoutMode:e}}function Ce(e){return{type:te,layoutColorMode:e}}var we=a(0);function Se(e,t){for(var a=0,i=Object.entries(e);a<i.length;a++){var n=Object(u.a)(i[a],2),r=n[0],s=n[1];this[r]=s}this.config={},this.actions=c,this.store=Object(g.d)(t,Object(g.a)(v.a)),this.__components={},this.__mainmenu={},this.__managers={},this.__secureProps=["config","actions","store","Renderer","__components","__mainmenu","__managers"]}Se.prototype.setConfig=function(e){this.config=e},Se.prototype.addComponent=function(e,t,i){var c=this;a(436)("./"+t.type+"/src/Main.js").then((function(a){if(a.decorators&&"object"===typeof a.decorators&&(e.actions=Object(h.a)(e.actions,Object(h.b)(a.decorators,c.__secureProps))),a.default&&!c.__components[t.type]){var n=a.default;c.__components[t.type]=n}if(a.MainMenu&&!c.__mainmenu[t.type]){var r=a.MainMenu;c.__mainmenu[t.type]=r}if(a.Manager&&!c.__managers[t.type]){var s=a.Manager;c.__managers[t.type]=s}i()})).catch((function(e){console.log("Error loading module:",e),i()}))},Se.prototype.unloadComponents=function(){this.__components={},this.__managers={}},Se.prototype.renderMainMenu=function(e){var t=this,a=e.selected_menu,c=e.props;return 0===Object.keys(this.__mainmenu).length?null:this.config.config_json.components.map((function(e){var n=t.__mainmenu[e.type];if(!n)return null;var s=a===e.id?"p-button-rounded p-button-raised p-button-sm":"p-button-rounded p-button-raised p-button-sm p-button-outlined";return Object(we.jsx)(r.a.Fragment,{children:Object(we.jsx)(n,{className:s,record:e,config:Object(d.a)(Object(d.a)({className:s},c),e.config_json),core:t,actions:t.actions,utils:i})},e.id)}))},Se.prototype.renderComponentById=function(e){var t=e.id,a=e.as,c=void 0===a?"":a,n=e.props;if(!t)return null;if(0===Object.keys(this.__components).length)return null;var r=this.config.config_json.components.find((function(e){return e.id===t})),s=this.__components[r.type];return s?Object(we.jsx)(s,{record:r,config:Object(d.a)(Object(d.a)({},n),r.config_json),core:this,actions:this.actions,as:c,utils:i}):null},Se.prototype.renderComponents=function(e){var t=this,a=e.region,c=e.as,n=void 0===c?"":c,r=e.props,s=e.parent,o=e.separator,l=void 0===o?"":o,u=e.style,j=void 0===u?null:u,b=e.className,p=void 0===b?"":b;if(0===Object.keys(this.__components).length)return null;var m=this.config.config_json.components;return s&&(m=m.filter((function(e){return s.children.includes(e.id)}))),m.filter((function(e){return e.target===a})).map((function(e){var a=t.__components[e.type];return a?Object(we.jsxs)("div",{className:p,style:j?j(e):null,children:[Object(we.jsx)(a,{record:e,config:Object(d.a)(Object(d.a)({},r),e.config_json),core:t,actions:t.actions,as:n,utils:i}),l]},e.id):null}))},Se.prototype.renderComponentManager=function(e){var t=e.id,a=e.as,c=void 0===a?"":a,n=e.props;if(!t)return null;if(0===Object.keys(this.__managers).length)return null;var r=this.config.config_json.components.find((function(e){return e.id===t})),s=this.__managers[r.type];return s?Object(we.jsx)(s,{record:r,config:Object(d.a)(Object(d.a)({},n),r.config_json),core:this,actions:this.actions,as:c,utils:i}):null};var ke=Se,Fe={layoutMode:"static",layoutColorMode:"light",staticMenuInactive:!1,overlayMenuActive:!1,mobileMenuActive:!1,config_json:{}},Ee=new x.a,Re=D(),Pe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{loading:!0,auth:{data:Ee.get(Re)},config:null,backoffice:Fe,components:{}},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case M:return Object(d.a)(Object(d.a)({},e),{},{auth:{loading:!0,http_error:!1,error:null}});case U:return Object(d.a)(Object(d.a)({},e),{},{auth:{loading:!1,http_error:!0,response:t.res}});case G:return Object(d.a)(Object(d.a)({},e),{},{auth:{loading:!1,response:t.res}});case q:return Object(d.a)(Object(d.a)({},e),{},{auth:{loading:!1,data:t.data}});case V:return Object(d.a)(Object(d.a)({},e),{},{loading:!0});case H:return Object(d.a)(Object(d.a)({},e),{},{config:t.config,backoffice:Object(d.a)(Object(d.a)({},Fe),t.backoffice)});case Z:return Object(d.a)(Object(d.a)({},e),{},{components:t.components});case J:return Object(d.a)(Object(d.a)({},e),{},{components:{}});case B:return Object(d.a)(Object(d.a)({},e),{},{loading:!1});case Y:return Object(d.a)(Object(d.a)({},e),{},{backoffice:Object(d.a)(Object(d.a)({},e.backoffice),{},{overlayMenuActive:!1,mobileMenuActive:!1})});case $:return Object(d.a)(Object(d.a)({},e),{},{backoffice:Object(d.a)(Object(d.a)({},e.backoffice),{},{overlayMenuActive:!e.backoffice.overlayMenuActive})});case X:return Object(d.a)(Object(d.a)({},e),{},{backoffice:Object(d.a)(Object(d.a)({},e.backoffice),{},{staticMenuInactive:!e.backoffice.staticMenuInactive})});case Q:return Object(d.a)(Object(d.a)({},e),{},{backoffice:Object(d.a)(Object(d.a)({},e.backoffice),{},{mobileMenuActive:!e.backoffice.mobileMenuActive})});case ee:return Object(d.a)(Object(d.a)({},e),{},{backoffice:Object(d.a)(Object(d.a)({},e.backoffice),{},{layoutMode:t.layoutMode})});case te:return Object(d.a)(Object(d.a)({},e),{},{backoffice:Object(d.a)(Object(d.a)({},e.backoffice),{},{layoutColorMode:t.layoutColorMode})});default:return e}},Le=new ke({ROOT_PATH:E(),BASE_URL:R(),CLIENT_URL:L(),API_URL:A(),MAP_PROXY_URL:I(),UPLOAD_URL:T(),COOKIE_AUTH_NAME:D()},Pe),Ae=r.a.createContext(),Ie=function(e){var t,a,i,c=Object(n.useContext)(Ae),r=null===c||void 0===c||null===(t=c.core)||void 0===t||null===(a=t.config)||void 0===a?void 0:a.config_json;return Object(we.jsxs)("div",{className:"layout-topbar clearfix",children:[Object(we.jsx)("button",{type:"button",className:"p-link layout-menu-button",onClick:e.onToggleMenu,children:Object(we.jsx)("span",{className:"pi pi-bars"})}),Object(we.jsxs)("div",{className:"layout-topbar-icons",children:[Object(we.jsx)(O.b,{activeClassName:"active-route",to:"/notifications/list",exact:!0,target:null,children:Object(we.jsxs)("button",{type:"button",className:"p-link",children:[Object(we.jsx)("span",{className:"layout-topbar-item-text",children:"Events"}),Object(we.jsx)("span",{className:"layout-topbar-icon pi pi-inbox"}),Object(we.jsx)("span",{className:"layout-topbar-badge",children:(null===r||void 0===r||null===(i=r.notifications)||void 0===i?void 0:i.total)||0})]})}),Object(we.jsxs)("button",{type:"button",className:"p-link",children:[Object(we.jsx)("span",{className:"layout-topbar-item-text",children:"Settings"}),Object(we.jsx)("span",{className:"layout-topbar-icon pi pi-cog"})]}),Object(we.jsxs)("button",{type:"button",className:"p-link",children:[Object(we.jsx)("span",{className:"layout-topbar-item-text",children:"User"}),Object(we.jsx)("span",{className:"layout-topbar-icon pi pi-user"})]})]})]})},Te=function(){return Object(we.jsx)("div",{className:"layout-footer",children:Object(we.jsxs)("span",{className:"footer-text",style:{marginLeft:"5px"},children:["\xa9 ",(new Date).getFullYear()," ","ScalarGIS"]})})},De=function e(t){var a=Object(n.useState)(null),i=Object(u.a)(a,2),c=i[0],s=i[1],o=function(e,a,i){if(a.disabled)return e.preventDefault(),!0;if(a.link){if(a.target)return e.preventDefault(),window.open(a.link,"_blank"),!0;window.location=a.link}s(i===c?null:i),t.onMenuItemClick&&t.onMenuItemClick({originalEvent:e,item:a})},l=function(e,t){var a=function(e){var t=e.items&&Object(we.jsx)("i",{className:"pi pi-fw pi-angle-down menuitem-toggle-icon"}),a=e.badge&&Object(we.jsx)("span",{className:"menuitem-badge",children:e.badge});return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)("i",{className:e.icon}),Object(we.jsx)("span",{children:e.label}),t,a]})}(e);return e.to?Object(we.jsx)(O.b,{activeClassName:"active-route",to:e.to,onClick:function(a){return o(a,e,t)},exact:!0,target:e.target,children:a}):Object(we.jsx)("a",{href:e.url,onClick:function(a){return o(a,e,t)},target:e.target,children:a})},d=t.items&&t.items.map((function(a,i){var n=c===i,r=b()(a.badgeStyleClass,{"active-menuitem":n&&!a.to});return Object(we.jsxs)("li",{className:r,children:[a.items&&!0===t.root&&Object(we.jsx)("div",{className:"arrow"}),l(a,i),Object(we.jsx)(m.a,{classNames:"p-toggleable-content",timeout:{enter:1e3,exit:450},in:n,unmountOnExit:!0,children:Object(we.jsx)(e,{items:a.items,onMenuItemClick:t.onMenuItemClick})})]},i)}));return d?Object(we.jsx)("ul",{className:t.className,children:d}):null},Me=function(e){return Object(we.jsx)("div",{className:"layout-menu-container",children:Object(we.jsx)(De,{items:e.model,className:"layout-menu",onMenuItemClick:e.onMenuItemClick,root:!0})})},Ue=function(e){var t,a,i,c,r,s=e.core,o=e.dispatch,l=s.actions.logout,d=null!==(t=e.auth)&&void 0!==t&&t.data?null===(a=e.auth)||void 0===a?void 0:a.data:(null===(i=e.auth)||void 0===i?void 0:i.response)||{},j=d.name,p=d.username,f=(d.email,null===s||void 0===s||null===(c=s.config)||void 0===c?void 0:c.config_json),h=Object(n.useState)(!1),v=Object(u.a)(h,2),g=v[0],x=v[1];s.COOKIE_AUTH_NAME,s.CLIENT_URL;return Object(we.jsxs)("div",{className:"layout-profile",children:[Object(we.jsx)("div",{className:"p-mb-2",children:Object(we.jsx)("i",{className:"fas fa-user-circle",style:{fontSize:"3rem"}})}),Object(we.jsxs)("button",{className:"p-link layout-profile-link",onClick:function(e){x((function(e){return!e})),e.preventDefault()},children:[Object(we.jsx)("span",{className:"username",children:j||p||""}),Object(we.jsx)("i",{className:"pi pi-fw pi-cog"})]}),Object(we.jsx)(m.a,{classNames:"p-toggleable-content",timeout:{enter:1e3,exit:450},in:g,unmountOnExit:!0,children:Object(we.jsxs)("ul",{className:b()({"layout-profile-expanded":g}),children:[Object(we.jsx)("li",{children:Object(we.jsx)(O.b,{activeClassName:"active-route",to:"/account",exact:!0,target:null,children:Object(we.jsxs)("button",{type:"button",className:"p-link",children:[Object(we.jsx)("i",{className:"pi pi-fw pi-user"}),Object(we.jsx)("span",{children:"Conta"})]})})}),Object(we.jsx)("li",{children:Object(we.jsx)(O.b,{activeClassName:"active-route",to:"/notifications/list",exact:!0,target:null,children:Object(we.jsxs)("button",{type:"button",className:"p-link",children:[Object(we.jsx)("i",{className:"pi pi-fw pi-inbox"}),Object(we.jsx)("span",{children:"Notifica\xe7\xf5es"}),Object(we.jsx)("span",{className:"menuitem-badge",children:(null===f||void 0===f||null===(r=f.notifications)||void 0===r?void 0:r.total)||0})]})})}),Object(we.jsx)("li",{children:Object(we.jsxs)("button",{type:"button",className:"p-link",onClick:function(e){return o(l())},children:[Object(we.jsx)("i",{className:"pi pi-fw pi-power-off"}),Object(we.jsx)("span",{children:"Sair"})]})})]})})]})},Ge=(a(169),a(325),a(10)),qe=a(184),Ve=a(85),Be=a(326),He=a(226);function ze(e){var t=e.core.API_URL,a=Object(n.useState)([{label:"Visualiza\xe7\xe3o de mapas",value:"VM"},{label:"Emiss\xe3o de plantas",value:"EP"}]),i=Object(u.a)(a,2),c=i[0],r=i[1],s=Object(n.useState)([{label:"Desde sempre",value:"all"},{label:"\xdaltimos 7 dias",value:"7"},{label:"\xdaltimos 30 dias",value:"30"},{label:"\xdaltimos 100 dias",value:"100"},{label:"\xdaltimo ano",value:"365"}]),o=Object(u.a)(s,2),l=o[0],d=o[1],j=Object(n.useState)("VM"),b=Object(u.a)(j,2),p=b[0],m=b[1],O=Object(n.useState)("100"),f=Object(u.a)(O,2),h=f[0],v=f[1],g=Object(n.useState)(),x=Object(u.a)(g,2),y=x[0],N=x[1],_=Object(n.useState)(),C=Object(u.a)(_,2),w=C[0],S=C[1],k=Object(n.useState)(),F=Object(u.a)(k,2),E=F[0],R=F[1],P=Object(n.useState)(),L=Object(u.a)(P,2),A=L[0],I=L[1],T=Object(n.useState)(!1),D=Object(u.a)(T,2),M=D[0],U=D[1];Object(n.useEffect)((function(){var t,a,i,c;null!==e&&void 0!==e&&null!==(t=e.stats)&&void 0!==t&&t.types&&r(Object(Ge.a)(e.stats.types)),null!==e&&void 0!==e&&null!==(a=e.stats)&&void 0!==a&&a.timeranges&&d(Object(Ge.a)(e.stats.timeranges)),null!==e&&void 0!==e&&null!==(i=e.stats)&&void 0!==i&&i.selected_type&&m(e.stats.selected_type),null!==e&&void 0!==e&&null!==(c=e.stats)&&void 0!==c&&c.selected_timerange&&v(e.stats.selected_timerange)}),[e.stats]),Object(n.useEffect)((function(){U(!0);var e=t+"/portal/stats/viewer_visits?type_code="+p;(0,He.a)(e).then((function(e){e.headers;return e.json})).then((function(e){if(U(!1),e.values){var t=e.values.map((function(e){return e.date})),a=e.values.map((function(e){return e.count}));R(t),I(a);var i=t.length-1-parseInt(h);if(i<0&&(i=0),"all"===h)return N(t),void S(a);var c=t.slice(i,t.length-1),n=a.slice(i,a.length-1);N(c),S(n)}else R(null),I(null),N(null),S(null)})).catch((function(e){console.log("fetch error"),U(!1)}))}),[p]);var G={labels:y,datasets:[{data:w,fill:!1,backgroundColor:"rgb(255, 99, 132)",borderColor:"rgba(255, 99, 132, 0.8)",tension:.25}]};return Object(we.jsx)("div",{className:"card",children:Object(we.jsxs)("div",{className:"p-grid p-fluid",children:[Object(we.jsx)("div",{className:"p-col-12 p-lg-5",children:Object(we.jsx)(Ve.a,{value:p,options:c,onChange:function(e){return t=e.value,void m(t);var t}})}),Object(we.jsx)("div",{className:"p-col-12 p-lg-5",children:Object(we.jsx)(Ve.a,{value:h,options:l,onChange:function(e){return function(e){if(v(e),"all"===e)return N(E),void S(A);if(E){var t=E.length-1-parseInt(e);t<0&&(t=0);var a=E.slice(t,E.length-1),i=A.slice(t,A.length-1);N(a),S(i)}}(e.value)}})}),Object(we.jsx)("div",{className:"p-col-12 p-lg-2",children:M?Object(we.jsx)(Be.a,{style:{width:"25px",height:"30px"}}):null}),Object(we.jsx)(qe.a,{data:G,options:{responsive:!0,plugins:{legend:{display:!1,position:"top"},title:{display:!0,text:"Contagem di\xe1ria"}},scales:{y:{beginAtZero:!0}}}})]})})}function We(e){var t=e.core.API_URL,a=Object(n.useState)({}),i=Object(u.a)(a,2),c=i[0],s=i[1];return Object(n.useEffect)((function(){fetch(t+"/portal/stats/basicstats").then((function(e){return e.json()})).then((function(e){console.log(e),s(e)})).catch((function(e){console.log("fetch error")}))}),[]),Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)("div",{className:"p-col-12 p-lg-3",children:Object(we.jsxs)("div",{className:"card summary",children:[Object(we.jsx)("span",{className:"title",children:"Utilizadores"}),Object(we.jsx)("span",{className:"detail",children:"Utilizadores registados"}),Object(we.jsx)("span",{className:"count blue",children:null===c||void 0===c?void 0:c.nb_users})]})}),Object(we.jsx)("div",{className:"p-col-12 p-lg-3",children:Object(we.jsxs)("div",{className:"card summary",children:[Object(we.jsx)("span",{className:"title",children:"Grupos"}),Object(we.jsx)("span",{className:"detail",children:"Grupos de utilizadores"}),Object(we.jsx)("span",{className:"count blue",children:null===c||void 0===c?void 0:c.nb_groups})]})}),Object(we.jsx)("div",{className:"p-col-12 p-lg-3",children:Object(we.jsxs)("div",{className:"card summary",children:[Object(we.jsx)("span",{className:"title",children:"Visualizadores"}),Object(we.jsx)("span",{className:"detail",children:"Incluindo mapas partilhados"}),Object(we.jsx)("span",{className:"count orange",children:null===c||void 0===c?void 0:c.nb_viewers})]})}),Object(we.jsx)("div",{className:"p-col-12 p-lg-3",children:Object(we.jsxs)("div",{className:"card summary",children:[Object(we.jsx)("span",{className:"title",children:"Opera\xe7\xf5es"}),Object(we.jsx)("span",{className:"detail",children:"Visitas, plantas, etc..."}),Object(we.jsx)("span",{className:"count red",children:null===c||void 0===c?void 0:c.nb_ops})]})})]})}qe.b.animation=!1,qe.b.animation=!1;var Ke=a(80),Ze=function(e){var t=e.core,a=e.name,i=e.email,c=e.icon,n=t.CLIENT_URL;return Object(we.jsxs)("button",{className:"p-link",children:[Object(we.jsx)("img",{src:c?n+c:n+"assets/layout/images/avatar_4.png",width:"35",alt:"avatar4"}),Object(we.jsx)("span",{className:"name",children:a}),Object(we.jsx)("span",{className:"email",children:i})]})},Je=function(e){var t=e.core,a=e.contacts;return Object(we.jsx)(Ke.a,{header:"Contactos (suporte)",children:Object(we.jsx)("ul",{children:a.map((function(e,a){return Object(we.jsx)("li",{children:Object(we.jsx)(Ze,Object(d.a)({core:t},e))},a)}))})})};var Ye=Object(l.b)((function(e){return{loading:e.loading,backoffice:e.backoffice}}))(Object(p.h)((function(e){var t=e.backoffice,a=Object(n.useContext)(Ae).core,i=a.store.getState().auth,c=F(i),r=null,s=null;return t&&t.config_json&&(t.config_json.contacts&&(r=t.config_json.contacts),t.config_json.stats&&(s=t.config_json.stats)),Object(we.jsxs)("div",{className:"p-grid p-fluid dashboard",children:[c&&Object(we.jsx)(We,{core:a}),Object(we.jsx)("div",{className:r&&r.length>0?"p-col-12 p-lg-9":"p-col-12",children:Object(we.jsx)(ze,{core:a,stats:s})}),r&&r.length>0?Object(we.jsx)("div",{className:"p-col-12 p-lg-3 contacts",children:Object(we.jsx)(Je,{core:a,contacts:r})}):null]})}))),$e=a(49),Xe=a(154),Qe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:He.a;return{getSimpleList:function(a){var i="".concat(e,"/").concat(a);return t(i).then((function(e){e.headers;var t=e.json;return{data:t.items||t}}))},getList:function(a,i){var c=i.pagination,n=c.page,r=c.perPage,s=i.sort,o=s.field,l=s.order,d={sort:JSON.stringify([o,l]),range:JSON.stringify([(n-1)*r,n*r-1]),page:n,per_page:r,filter:JSON.stringify(i.filter)},u="".concat(e,"/").concat(a,"?").concat(Object(Xe.stringify)(d));return t(u).then((function(e){e.headers;var t=e.json;return{data:t.items||t,total:null!=t.total?t.total:t.length||0}}))},getOne:function(a,i){return t("".concat(e,"/").concat(a,"/").concat(i.id)).then((function(e){return{data:e.json}}))},getMany:function(a,i){var c={filter:JSON.stringify({id:i.ids})},n="".concat(e,"/").concat(a,"?").concat(Object(Xe.stringify)(c));return t(n).then((function(e){var t=e.json;return{data:t.items||t,total:null!=t.total?t.total:t.length||0}}))},getManyReference:function(a,i){var c=i.pagination,n=c.page,r=c.perPage,s=i.sort,o=s.field,l=s.order,u={sort:JSON.stringify([o,l]),range:JSON.stringify([(n-1)*r,n*r-1]),page:n,per_page:r,filter:JSON.stringify(Object(d.a)(Object(d.a)({},i.filter),{},Object($e.a)({},i.target,i.id)))},j="".concat(e,"/").concat(a,"?").concat(Object(Xe.stringify)(u));return t(j).then((function(e){e.headers;var t=e.json;return{data:t.items||t,total:null!=t.total?t.total:t.length||0}}))},update:function(a,i){return t("".concat(e,"/").concat(a,"/").concat(i.id),{method:"PUT",body:JSON.stringify(i.data)}).then((function(e){return{data:e.json}}))},updateMany:function(a,i){var c={filter:JSON.stringify({id:i.ids})};return t("".concat(e,"/").concat(a,"?").concat(Object(Xe.stringify)(c)),{method:"PUT",body:JSON.stringify(i.data)}).then((function(e){return{data:e.json}}))},create:function(a,i){return t("".concat(e,"/").concat(a),{method:"POST",body:JSON.stringify(i.data)}).then((function(e){var t=e.json;return{data:Object(d.a)(Object(d.a)({},i.data),{},{id:t.id})}}))},delete:function(a,i){return t("".concat(e,"/").concat(a,"/").concat(i.id),{method:"DELETE"}).then((function(e){e.json;return{data:{id:i.id}}}))},deleteMany:function(a,i){var c={filter:JSON.stringify({id:i.ids})};return t("".concat(e,"/").concat(a,"?").concat(Object(Xe.stringify)(c)),{method:"DELETE",body:JSON.stringify(i.data)}).then((function(e){return{data:e.json}}))},getGeometry:function(a,i){return t("".concat(e,"/").concat(a,"/").concat(i.feature_id,"/geometry")).then((function(e){return{data:e.json}}))},saveGeometry:function(a,i){return t("".concat(e,"/").concat(a,"/").concat(i.feature_id,"/geometry"),{method:"POST",body:JSON.stringify(i.data)}).then((function(e){var t=e.json;return{data:Object(d.a)(Object(d.a)({},i.data),{},{id:t.id})}}))},getDocuments:function(a,i){return t("".concat(e,"/").concat(a,"/").concat(i.resource_id,"/docs")).then((function(e){return{data:e.json}}))},getDocument:function(a,i){return t("".concat(e,"/").concat(a,"/docs/").concat(i.id)).then((function(e){return{data:e.json}}))},createDocument:function(a,i){return t("".concat(e,"/").concat(a,"/").concat(i.resource_id,"/docs"),{method:"POST",body:JSON.stringify(i.data)}).then((function(e){return{data:e.json}}))},updateDocument:function(a,i){return t("".concat(e,"/").concat(a,"/docs/").concat(i.id),{method:"PUT",body:JSON.stringify(i.data)}).then((function(e){return{data:e.json}}))},deleteDocument:function(a,i){return t("".concat(e,"/").concat(a,"/docs/").concat(i.id),{method:"DELETE"}).then((function(e){e.json;return{data:{id:i.id}}}))}}},et=a(18),tt=a(45),at=a(178),it=a(134),ct=a(43),nt=a(9),rt=a(160),st=a(83),ot=a(137),lt=a(63),dt=a(38),ut=a(482);var jt=Object(l.b)((function(e){return{}}))(Object(p.h)((function(e){e.history,e.dispatch;var t=Object(n.useContext)(Ae).core,a=Object(n.useState)(!1),i=Object(u.a)(a,2),c=(i[0],i[1],Object(n.useState)(!1)),s=Object(u.a)(c,2),o=s[0],l=s[1],j=Object(n.useState)(e.data||{}),b=Object(u.a)(j,2),p=b[0],m=b[1],O=Object(n.useRef)(null),h=t.API_URL,v=Object(et.b)({defaultValues:Object(d.a)({},p)}),g=v.register,x=v.control,y=v.handleSubmit,N=(v.watch,v.formState.errors),_=v.setValue,C=function(e,t){if(e&&e[t])return"required"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:e[t].message||"Campo obrigat\xf3rio"}):"maxLength"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:e[t].message||"O n\xfamero de caracteres \xe9 superior \xe0 dimens\xe3o m\xe1xima permitida"}):"pattern"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:e[t].message||"Formato inv\xe1lido"}):Object(we.jsx)("small",{className:"p-error",children:e[t].message})};return Object(we.jsxs)("form",{onSubmit:y((function(e){var t={first_name:e.first_name,last_name:e.last_name,name:e.name,username:e.username,email:e.email,password:e.password||null};l(!0);var a=Qe(h+"/security");if(p.id){var i={id:p.id,data:Object(d.a)({},t)};a.update("users",i).then((function(e){O.current.show({life:3e3,severity:"success",summary:"Editar Registo",detail:"Registo alterado com sucesso"}),_("password","",{shouldValidate:!0,shouldDirty:!0})})).catch((function(e){O.current.show({life:3e3,severity:"error",summary:"Editar Registo",detail:"Ocorreu um erro ao alterar o registo"})})).finally((function(){l(!1)}))}else{var c={data:Object(d.a)({},t)};a.create("users",c).then((function(e){m(Object(d.a)(Object(d.a)({},p),{},{id:e.data.id})),O.current.show({life:5e3,severity:"success",summary:"Criar Registo",detail:"Registo criada com sucesso"})})).catch((function(e){O.current.show({life:5e3,severity:"error",summary:"Criar Registo",detail:"Ocorreu um erro ao criar o registo"})})).finally((function(){l(!1)}))}})),children:[Object(we.jsx)(tt.a,{ref:O,baseZIndex:2e3}),Object(we.jsxs)("div",{className:"p-fluid p-formgrid p-grid",children:[Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-3",children:[Object(we.jsx)("label",{htmlFor:"first_name",children:"Primeiro Nome"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"first_name",name:"first_name"},g("first_name")),{},{autoFocus:!0}))]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-3",children:[Object(we.jsx)("label",{htmlFor:"last_name",children:"\xdaltimo Nome"}),Object(we.jsx)(f.a,Object(d.a)({id:"last_name",name:"last_name"},g("last_name")))]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-6",children:[Object(we.jsx)("label",{htmlFor:"name",children:"Nome"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"name",name:"name"},g("name",{required:"Campo obrigat\xf3rio."})),{},{className:Object(dt.a)({"p-invalid":N.name})})),C(N,"name")]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-3",children:[Object(we.jsx)("label",{htmlFor:"username",children:"Username"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"username",name:"username"},g("username",{required:"Campo obrigat\xf3rio."})),{},{className:Object(dt.a)({"p-invalid":N.username})})),C(N,"username")]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-4",children:[Object(we.jsx)("label",{htmlFor:"email",children:"Email"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"email",name:"email"},g("email",{required:"Campo obrigat\xf3rio."})),{},{className:Object(dt.a)({"p-invalid":N.email})})),C(N,"email")]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-4",children:[Object(we.jsx)("label",{htmlFor:"password",children:"Password"}),Object(we.jsx)(et.a,{control:x,name:"password",render:function(e){var t=e.field;return Object(we.jsx)(at.a,Object(d.a)(Object(d.a)({},t),{},{feedback:!1,onChange:function(e){return t.onChange(e.target.value)}}))}})]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-6",children:[Object(we.jsx)("label",{htmlFor:"auth_token",children:"Token de Autentica\xe7\xe3o"}),Object(we.jsxs)("div",{className:"p-inputgroup",children:[Object(we.jsx)(nt.a,{type:"button",label:"Gerar",icon:"pi pi-check",className:"p-button-primary",onClick:function(e){_("auth_token",String(Object(ut.a)()))}}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"auth_token",name:"auth_token"},g("auth_token")),{},{placeholder:"Token n\xe3o definido"})),Object(we.jsx)(nt.a,{type:"button",icon:"pi pi-times",className:"p-button-danger",onClick:function(e){_("auth_token",null),_("auth_token_expire",null)}})]})]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-3",children:[Object(we.jsx)("label",{htmlFor:"auth_token_expire",children:"Data de Validade do Token"}),Object(we.jsxs)("div",{className:"p-inputgroup",children:[Object(we.jsx)(et.a,{control:x,name:"auth_token_expire",render:function(e){var t=e.field;return Object(we.jsx)(rt.a,Object(d.a)(Object(d.a)({},t),{},{dateFormat:"yy-mm-dd",onChange:function(e){return t.onChange(e.target.value)},showIcon:!0,showTime:!0,showSeconds:!0}))}}),Object(we.jsx)(nt.a,{type:"button",icon:"pi pi-times",className:"p-button-danger",onClick:function(e){return _("auth_token_expire",null)}})]})]})]}),Object(we.jsx)(ct.a,{className:"p-mt-4 p-mb-4",right:function(){return Object(we.jsx)(r.a.Fragment,{children:Object(we.jsx)(nt.a,{type:"submit",label:"Gravar",icon:o?"pi pi-save pi-spinner":"pi pi-save",disabled:!!o})})}})]})})));var bt=Object(l.b)((function(e){return{}}))(Object(p.h)((function(e){var t=Object(n.useContext)(Ae).core,a=Object(p.g)().id,i=Object(n.useState)(!1),c=Object(u.a)(i,2),s=(c[0],c[1]),o=Object(n.useState)(null),l=Object(u.a)(o,2),j=l[0],b=l[1],m=t.API_URL;Object(n.useEffect)((function(){a?O():b({})}),[]);var O=function(){var e=Qe(m+"/security"),t={id:a};s(!0),e.getOne("users",t).then((function(e){var t=Object(d.a)({},e.data);t.auth_token_expire=t.auth_token&&t.auth_token_expire?new Date(t.auth_token_expire):null,b(t),s(!1)})).catch((function(e){s(!1),console.log(e)}))};return Object(we.jsx)(r.a.Fragment,{children:j?Object(we.jsx)(jt,{data:j}):Object(we.jsx)("div",{children:"loading..."})})})));function pt(e){var t=e.history,a=e.core,c=e.backoffice,n=e.dispatch,r=e.module;return Object(we.jsx)("div",{children:a.renderComponentManager({id:r||"cadastro",props:{history:t,backoffice:c,dispatch:n,Models:{Utils:i},dataProvider:Qe},dataProvider:{dataProvider:Qe},as:"panel"})})}var mt=a(146),Ot=a(327);var ft=Object(l.b)((function(e){return{auth:e.auth}}))(Object(p.h)((function(e){var t=e.history,a=Object(n.useState)(!1),i=Object(u.a)(a,2),c=i[0],s=i[1],o=Object(n.useState)(e.data||{}),l=Object(u.a)(o,2),j=l[0],b=l[1],p=Object(n.useContext)(Ae).core,m=Object(n.useRef)(null),O=p.API_URL,h=function(){if(t.location.state&&t.location.state.from){var e={pathname:t.location.state.from,state:{searchParams:Object(d.a)({},t.location.state.previousSearchParams)}};t.replace(e)}else t.goBack()},v=function(){var e={checked:!0,checked_date:(new Date).toISOString().slice(0,10)};N(e)},g=function(){var e={closed:!0,closed_date:(new Date).toISOString().slice(0,10)};N(e)},x=function(){N({closed:!1,closed_date:null})},y=function(){var e={notes:j.notes};N(e)},N=function(e){s(!0);var t=Qe(O+"/portal"),a={id:j.id,data:e};t.update("notifications",a).then((function(e){m.current.show({life:3e3,severity:"success",summary:"Editar Registo",detail:"Registo alterado com sucesso"}),b(Object(d.a)({},e.data))})).catch((function(e){m.current.show({life:3e3,severity:"error",summary:"Editar Registo",detail:"Ocorreu um erro ao alterar o registo"})})).finally((function(){s(!1)}))};return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)("h3",{children:"Notifica\xe7\xe3o - Edi\xe7\xe3o"}),Object(we.jsxs)("form",{children:[Object(we.jsx)(tt.a,{ref:m,baseZIndex:2e3}),j.id?Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsxs)("div",{className:"p-grid p-fluid",children:[Object(we.jsx)("div",{className:"p-col p-md-9",children:Object(we.jsxs)("div",{className:"p-fluid p-formgrid p-grid",children:[Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-2",children:[Object(we.jsx)("label",{htmlFor:"id",children:"Id"}),Object(we.jsx)(f.a,{id:"id",type:"text",value:j.id,disabled:!0})]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-5",children:[Object(we.jsx)("label",{htmlFor:"name",children:"Nome"}),Object(we.jsx)(f.a,{id:"nam",type:"text",value:DataTransfer.name,disabled:!0})]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-5",children:[Object(we.jsx)("label",{htmlFor:"email",children:"Email"}),Object(we.jsx)(f.a,{id:"email",type:"text",value:j.email,disabled:!0})]}),Object(we.jsxs)("div",{className:"p-field p-col-12",children:[Object(we.jsx)("label",{htmlFor:"message",children:"Messagem"}),Object(we.jsx)(mt.a,{id:"message",rows:5,value:j.message,autoResize:!0,style:{maxHeight:"250px",opacity:"0.6"}})]}),Object(we.jsxs)("div",{className:"p-field p-col-12",children:[Object(we.jsx)("label",{htmlFor:"message",children:"Ficheiros"}),Object(we.jsx)(Ot.a,{value:(null===j||void 0===j?void 0:j.files)||[],layout:"list",emptyMessage:"N\xe3o tem ficheiros",itemTemplate:function(e,t){if(e)return Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)("div",{className:"p-col p-md-9",children:Object(we.jsx)("div",{className:"p-m-2",children:Object(we.jsx)("a",{href:e.url,target:"_blank",rel:"noreferrer",download:e.filename,children:e.filename})})}),Object(we.jsx)("div",{className:"p-col p-md-3",children:Object(we.jsx)("div",{className:"p-m-2 p-text-center",children:null!=e.size&&Object(we.jsx)("span",{class:"p-tag p-component p-px-1 p-py-1",children:Object(we.jsx)("span",{class:"p-tag-value",children:(e.size/1024).toFixed(2)+" KB"})})})})]})}})]})]})}),Object(we.jsx)("div",{className:"p-col p-md-3",children:Object(we.jsxs)("div",{className:"p-fluid p-formgrid p-grid",children:[Object(we.jsxs)("div",{className:"p-field p-col-12",children:[Object(we.jsx)("label",{htmlFor:"viewer",children:"Visualizador"}),Object(we.jsx)(f.a,{id:"viewer",type:"text",value:j.viewer,disabled:!0})]}),Object(we.jsxs)("div",{className:"p-field p-col-12",children:[Object(we.jsx)("label",{htmlFor:"date",children:"Data"}),Object(we.jsx)(f.a,{id:"date",type:"text",value:j.date||"",disabled:!0})]})]})}),Object(we.jsx)("div",{className:"p-col p-md-9",children:Object(we.jsx)("div",{className:"p-fluid p-formgrid p-grid",children:Object(we.jsxs)("div",{className:"p-field p-col-12",children:[Object(we.jsx)("label",{htmlFor:"notes",children:"Observa\xe7\xf5es"}),Object(we.jsx)(mt.a,{id:"notes",rows:5,autoResize:!0,value:j.notes,onChange:function(e){return b(Object(d.a)(Object(d.a)({},j),{},{notes:e.target.value}))}})]})})}),Object(we.jsx)("div",{className:"p-col p-md-3",children:Object(we.jsxs)("div",{className:"p-fluid p-formgrid p-grid",children:[Object(we.jsxs)("div",{className:"p-field p-col-12",children:[Object(we.jsx)("label",{htmlFor:"read_date",children:"Data Leitura"}),Object(we.jsx)(f.a,{id:"read_date",type:"text",value:j.checked_date||"",disabled:!0})]}),Object(we.jsxs)("div",{className:"p-field p-col-12",children:[Object(we.jsx)("label",{htmlFor:"close_date",children:"Data Encerramento"}),Object(we.jsx)(f.a,{id:"close_date",type:"text",value:j.closed_date||"",disabled:!0})]})]})})]}),Object(we.jsx)(ct.a,{className:"p-mt-2 p-mb-4",right:function(){var e,t,a;return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{type:"button",label:"Voltar",icon:"pi pi-left",className:"p-button-secondary p-mr-4",disabled:!!c,onClick:h}),0===(null===j||void 0===j||null===(e=j.status)||void 0===e?void 0:e.value)&&Object(we.jsx)(nt.a,{type:"button",label:"Lida",className:"p-mr-2",icon_:c?"pi pi-save pi-spinner":"pi pi-save",disabled:!!c,onClick:v}),2!==(null===j||void 0===j||null===(t=j.status)||void 0===t?void 0:t.value)&&Object(we.jsx)(nt.a,{type:"button",label:"Encerrar",className:"p-mr-2",icon_:c?"pi pi-save pi-spinner":"pi pi-save",disabled:!!c,onClick:g}),2===(null===j||void 0===j||null===(a=j.status)||void 0===a?void 0:a.value)&&Object(we.jsx)(nt.a,{type:"button",label:"Reabrir",className:"p-mr-2",icon_:c?"pi pi-save pi-spinner":"pi pi-save",disabled:!!c,onClick:x}),Object(we.jsx)(nt.a,{type:"button",label:"Gravar",className:"p-mr-2",icon_:c?"pi pi-save pi-spinner":"pi pi-save",disabled:!!c,onClick:y})]})}})]}):Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(lt.a,{severity:"error",text:"N\xe3o foi poss\xedvel obter os dados da notifica\xe7\xe3o.",className:"p-col p-md-12"}),Object(we.jsx)(ct.a,{className:"p-mt-2 p-mb-4",right:function(){return Object(we.jsx)(r.a.Fragment,{children:Object(we.jsx)(nt.a,{type:"button",label:"Voltar",icon:"pi pi-left",className:"p-button-secondary p-mr-4",onClick:h})})}})]})]})]})})));var ht=Object(l.b)((function(e){return{loading:e.loading}}))(Object(p.h)((function(e){var t=Object(n.useContext)(Ae).core,a=Object(p.g)().id,i=Object(n.useState)(!1),c=Object(u.a)(i,2),s=(c[0],c[1]),o=Object(n.useState)(null),l=Object(u.a)(o,2),d=l[0],j=l[1],b=Object(n.useState)(null),m=Object(u.a)(b,2),O=m[0],f=m[1],h=(Object(n.useRef)(null),t.API_URL);Object(n.useEffect)((function(){a?v():f({})}),[]);var v=function(){var e=Qe(h+"/portal"),t={id:a};s(!0),e.getOne("notifications",t).then((function(e){f(e.data),s(!1)})).catch((function(e){s(!1),j(!0)}))};return Object(we.jsx)(r.a.Fragment,{children:O?Object(we.jsx)(ft,{data:O}):d?Object(we.jsx)(ft,{data:null}):Object(we.jsx)("div",{children:"loading..."})})}))),vt=a(281),gt=a(62),xt=a(17),yt=a(71),Nt={filters:{status:[0]},first:0,rows:20,page:0,sortField:"id",sortOrder:1},_t=[{value:0,name:"Por abrir"},{value:1,name:"Lida"},{value:2,name:"Encerrado"}];var Ct=Object(l.b)((function(e){return{loading:e.loading,filters:e.filters}}))(Object(p.h)((function(e){var t=e.history,a=Object(n.useContext)(Ae).core,i=Object(n.useRef)(null),c=Object(n.useState)([]),s=Object(u.a)(c,2),o=s[0],l=s[1],j=Object(n.useState)(!1),b=Object(u.a)(j,2),p=b[0],m=b[1],O=Object(n.useState)([]),h=Object(u.a)(O,2),v=h[0],g=h[1],x=Object(n.useState)(null),y=Object(u.a)(x,2),N=y[0],_=y[1],C=Object(n.useState)(e.filter||{status:[0]}),w=Object(u.a)(C,2),S=w[0],k=(w[1],Object(n.useState)(Object(d.a)({},Nt))),F=Object(u.a)(k,2),E=F[0],R=F[1],P=Object(n.useRef)(null),L=a.API_URL,A=Object(et.b)({defaultValues:Object(d.a)({},S)}),I=A.register,T=A.control,D=A.handleSubmit,M=A.watch,U=(A.formState.errors,A.setValue),G=(A.reset,M());Object(n.useEffect)((function(){Promise.all([Qe(L+"/portal").getSimpleList("notifications/viewers/list",{}).catch((function(e){return e}))]).then((function(e){l(e[0].data||[])})).catch((function(e){console.log(e)}))}),[]),Object(n.useEffect)((function(){V()}),[E]);var q=function(){P.current.exportCSV()},V=function(e){var t=Qe(L+"/portal"),a={};e?Object.entries(e).forEach((function(e){var t=Object(u.a)(e,2),i=t[0],c=t[1];a[i]=c.value})):E.filters&&Object.entries(E.filters).forEach((function(e){var t=Object(u.a)(e,2),i=t[0],c=t[1];i&&c&&(a[i]=c)}));var c={pagination:{page:E.page+1,perPage:E.rows},sort:{field:E.sortField,order:-1===E.sortOrder?"Desc":"Asc"},filter:a};m(!0),t.getList("notifications",c).then((function(e){_(null);var t=e.data.map((function(e){return Object(d.a)(Object(d.a)({},e),{},{author:{name:e.name,email:e.email}})}));g(Object(d.a)(Object(d.a)({},e),{},{data:t,page:E.page})),m(!1)})).catch((function(e){var t;m(!1),null!==i&&void 0!==i&&null!==(t=i.current)&&void 0!==t&&t.show&&i.current.show({life:5e3,severity:"error",summary:"Pesquisa de Notifica\xe7\xf5es",detail:"Ocorreu um erro na pesquisa"})}))},B=function(){var e=G.viewer,t=e?e.length:0;return Object(we.jsxs)("div",{className:"p-py-2 p-px-3",children:[Object(we.jsx)("b",{children:t})," selecionado",t>1?"s":""]})};return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)("div",{className:"p-col-12",children:Object(we.jsx)("h3",{children:"Notifica\xe7\xf5es"})}),Object(we.jsxs)("div",{className:"p-grid p-fluid notification-list",children:[Object(we.jsx)(tt.a,{ref:i,baseZIndex:2e3}),Object(we.jsxs)("div",{className:"card",children:[Object(we.jsx)(vt.a,{activeIndex:0,children:Object(we.jsx)(vt.b,{header:"Filtro",children:Object(we.jsxs)("form",{onSubmit:D((function(e){var t=Object(d.a)({},E);t.filters=Object(d.a)({},e),R(t)})),children:[Object(we.jsxs)("div",{className:"p-fluid p-formgrid p-grid",children:[Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-1",children:[Object(we.jsx)("label",{htmlFor:"id",children:"Id"}),Object(we.jsx)(f.a,Object(d.a)({id:"id",type:"text"},I("id")))]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-7",children:[Object(we.jsx)("label",{htmlFor:"viewer",children:"Visualizador"}),Object(we.jsx)(et.a,{control:T,name:"viewer",render:function(e){var t=e.field;return Object(we.jsx)(st.a,{optionLabel:"name",optionValue:"id",value:t.value,options:o,filter:!0,showClear:!0,showSelectAll:!1,display:"chip",onChange:function(e){t.onChange(e.target.value)},panelFooterTemplate:B,className:"filter-multiselect",style:{minHeight:"2.5rem",maxHeight:"2.5rem"}})}})]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-2",children:[Object(we.jsx)("label",{htmlFor:"start_date",children:"Data envio (in\xedcio)"}),Object(we.jsx)(et.a,{control:T,name:"start_date",render:function(e){var t=e.field;return Object(we.jsx)(rt.a,{value:t.value,onChange:function(e){t.onChange(e.target.value)},dateFormat:"dd/mm/yy",mask:"99/99/9999",placeholder:"dd/mm/aaaa"})}})]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-2",children:[Object(we.jsx)("label",{htmlFor:"end_date",children:"Data envio (fim)"}),Object(we.jsx)(et.a,{control:T,name:"end_date",render:function(e){var t=e.field;return Object(we.jsx)(rt.a,{value:t.value,onChange:function(e){t.onChange(e.target.value)},dateFormat:"dd/mm/yy",mask:"99/99/9999",placeholder:"dd/mm/aaaa"})}})]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-4",children:[Object(we.jsx)("label",{htmlFor:"author",children:"Autor"}),Object(we.jsx)(f.a,Object(d.a)({id:"author",type:"text"},I("author")))]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-4",children:[Object(we.jsx)("label",{htmlFor:"status",children:"Mensagem"}),Object(we.jsx)(f.a,Object(d.a)({id:"message",type:"text"},I("message")))]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-4",children:[Object(we.jsx)("label",{htmlFor:"status",children:"Estado"}),Object(we.jsx)(et.a,{control:T,name:"status",render:function(e){var t=e.field;return Object(we.jsx)(st.a,{optionLabel:"name",optionValue:"value",options:_t,value:t.value,showClear:!0,showSelectAll:!1,display:"chip",onChange:function(e){return t.onChange(e.target.value)},className:"filter-multiselect",style:{minHeight:"2.5rem",maxHeight:"2.5rem"}})}})]})]}),Object(we.jsxs)("div",{className:"p-fluid p-formgrid p-grid p-justify-end",children:[Object(we.jsx)("div",{className:"p-field p-col-12 p-md-2",children:Object(we.jsx)(nt.a,{type:"submit",label:"Pesquisar",className:"p-mr-2"})}),Object(we.jsx)("div",{className:"p-field p-col-12 p-md-2",children:Object(we.jsx)(nt.a,{type:"button",label:"Limpar",className:"p-button-secondary p-mr-2",onClick:function(e){U("id",null),U("author",null),U("viewer",null),U("start_date",null),U("end_date",null),U("message",null),U("status",null);var t=Object(d.a)({},E);t.filters={},t.first=0,R(t)}})})]})]})})}),Object(we.jsx)(ct.a,{className:"p-mt-2",left:function(){return null!==v.total&&Object(we.jsx)(r.a.Fragment,{children:Object(we.jsxs)("span",{children:[Object(we.jsx)("b",{children:"Total:"})," ",v.total]})})},right:function(){return Object(we.jsx)(r.a.Fragment,{children:Object(we.jsx)(nt.a,{label:"Exportar",icon:"pi pi-upload",className:"p-button-help",onClick:q,disabled:null===v||void 0===v||!v.total})})}}),Object(we.jsxs)(gt.a,{ref:P,value:v?v.data:[],lazy:!0,selectionMode:"checkbox",selection:N,onSelectionChange:function(e){return _(e.value)},paginator:!0,first:E.first,rows:E.rows,totalRecords:v.total,onPage:function(e){var t=Object(d.a)(Object(d.a)({},E),e);R(t)},onSort:function(e){var t=Object(d.a)(Object(d.a)({},E),e);R(t)},sortField:E.sortField,sortOrder:E.sortOrder,loading:p,exportFunction:function(e){return"status"===e.field?e.data.label:"author"===e.field?e.data.name+(e.data.email?" (".concat(e.data.email,")"):""):e.data},exportFilename:"notificacoes",emptyMessage:"N\xe3o foram encontradas notifica\xe7\xf5es.",children:[Object(we.jsx)(xt.a,{selectionMode:"multiple",headerStyle:{width:"3rem"}}),Object(we.jsx)(xt.a,{field:"id",header:"Id",sortable:!0,headerStyle:{width:"6rem"}}),Object(we.jsx)(xt.a,{field:"date",header:"Data",sortable:!0,headerStyle:{width:"8rem"}}),Object(we.jsx)(xt.a,{field:"viewer",header:"Visualizador",sortable:!0,sortField:"viewer",body:function(e){return e.viewer?Object(we.jsx)(yt.a,{label:e.viewer}):null},headerStyle:{width:"9rem"},style:{textAlign:"center"}}),Object(we.jsx)(xt.a,{field:"author",header:"Autor",sortable:!0,sortField:"name",body:function(e){return Object(we.jsxs)(we.Fragment,{children:[e.name&&Object(we.jsx)("span",{children:e.name}),e.name&&e.email?Object(we.jsx)("br",{}):null,e.email&&Object(we.jsx)("span",{style:{color:"#707070",fontSize:".9rem"},children:e.email})]})},style:{wordBreak:"break-all"}}),Object(we.jsx)(xt.a,{field:"message",header:"Mensagem",body:function(e){var t=e.message||"";return t.length>50?"".concat(t.slice(0,50),"..."):t}}),Object(we.jsx)(xt.a,{field:"status",header:"Estado",body:function(e){var t=e.status||{};return 0===t.value?Object(we.jsx)("span",{className:"badge badge-danger",title:"".concat(t.label||"Por abrir"),children:Object(we.jsx)("i",{className:"fas fa-envelope"})}):1===t.value?Object(we.jsx)("span",{className:"badge badge-warning",title:"".concat(t.label||"Lida"," (").concat(t.date,")"),children:Object(we.jsx)("i",{className:"fas fa-envelope-open"})}):2===t.value?Object(we.jsx)("span",{className:"badge badge-success",title:"".concat(t.label||"Encerrada"," (").concat(t.date,")"),children:Object(we.jsx)("i",{className:"fas fa-check"})}):null},headerStyle:{width:"6rem"},style:{textAlign:"center"}}),Object(we.jsx)(xt.a,{body:function(e){return Object(we.jsx)(r.a.Fragment,{children:Object(we.jsx)(nt.a,{icon:"pi pi-pencil",className:"p-button-rounded p-button-outlined p-button-secondary p-mr-2",title:"Editar",onClick:function(){return function(e){var a={pathname:"/notifications/edit/".concat(e.id),state:{from:t.location.pathname,previousSearchParams:Object(d.a)({},E)}};t.push(a)}(e)}})})},headerStyle:{width:"8rem"}})]})]})]})]})}))),wt=a(229),St=a(179),kt=a(278),Ft=a(180),Et=a(127),Rt=a.n(Et),Pt=(a(223),a(224),a(465),a(466),a(4)),Lt=a(5),At=a(26),It=a(11),Tt=a(12),Dt=a(139),Mt=a(108),Ut=function(e,t,a){var i=Object.entries(e).map((function(e,t){return Object(d.a)({id:e[0]},e[1])})),c=i.splice(t,1),n=Object(u.a)(c,1)[0];i.splice(a,0,n);var r={};return i.forEach((function(e){r[e.id]={active:e.active,required:e.required,title:e.title}})),r},Gt=function(e,t){return Object(d.a)({userSelect:"none",padding:8,margin:"0 0 ".concat(8,"px 0"),background:e?"lightblue":"none"},t)},qt=function(e){return{background:e?"lightgray":"none",padding:4}};function Vt(e){var t=Object(n.useState)(null!==e&&void 0!==e&&e.data?Object(Ge.a)(e.data):[]),a=Object(u.a)(t,2),i=a[0],c=a[1],s=Object(n.useState)(e.list||[]),o=Object(u.a)(s,2),l=o[0],d=o[1],j=Object(n.useState)(null),b=Object(u.a)(j,2),p=b[0],m=b[1],O=Object(n.useState)(""),f=Object(u.a)(O,2),h=f[0],v=f[1];Object(n.useEffect)((function(){d(Object(Ge.a)(e.list))}),[e.list]),Object(n.useEffect)((function(){c(Object(Ge.a)(e.data))}),[e.data]);return Object(we.jsx)(r.a.Fragment,{children:Object(we.jsxs)("div",{className:"p-card p-p-2",children:[Object(we.jsx)("div",{className:"p-field p-col-12 p-pl-0",children:Object(we.jsx)(st.a,{value:p||[],options:(l||[]).filter((function(e){return!(i||[]).map((function(e){return e.id})).includes(e.id)})),optionLabel:"title",optionValue:"id",display:"chip",showClear:!0,filter:!0,filterValue:h,onFilterValueChange:function(e){return v(e.value)},onChange:function(e){return m(e.value)},placeholder:"Selecionar"})}),Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsx)("div",{className:"p-col"}),Object(we.jsx)("div",{className:"p-col",children:Object(we.jsx)(nt.a,{label:"Adicionar",type:"button",disabled:!p||0===p.length,onClick:function(){if(l){var t=l.filter((function(e){return p.includes(e.id)}));t=[].concat(Object(Ge.a)(t),Object(Ge.a)(e.data)),console.log(t),e.onChange(t),m(null)}}})}),Object(we.jsx)("div",{className:"p-col"})]})]})})}var Bt=function(e){var t=e.type,a=e.data;return a&&0!==a.length?Object(we.jsx)(Mt.a,{onDragEnd:function(t){if(t.destination){var i=Object(Ge.a)(a),c=i[t.source.index];i.splice(t.source.index,1),i.splice(t.destination.index,0,c),e.onChange(i)}},children:Object(we.jsx)(Mt.c,{droppableId:"droppable",type:t,children:function(t,i){return Object(we.jsxs)("div",{ref:t.innerRef,style:qt(i.isDraggingOver),children:[a.map((function(t,i){return Object(we.jsx)(Mt.b,{draggableId:t.id.toString(),index:i,style:{border:"solid 1px lightgray",marginTop:3},children:function(i,c){return Object(we.jsxs)("div",Object(d.a)(Object(d.a)({ref:i.innerRef},i.draggableProps),{},{style:Gt(c.isDragging,i.draggableProps.style),className:"p-shadow-1",children:[Object(we.jsxs)("div",{style:{marginBottom:5},children:[Object(we.jsxs)("div",{style:{float:"left",paddingTop:6},children:[Object(we.jsx)("span",{style:{paddingLeft:"15px"},children:t.code}),Object(we.jsx)("span",Object(d.a)(Object(d.a)({},i.dragHandleProps),{},{children:Object(we.jsx)("i",{className:"fas fa-arrows-alt",style:{float:"left",paddingTop:3}})}))]}),Object(we.jsx)("div",{style:{textAlign:"right"},children:Object(we.jsx)(nt.a,{type:"text",icon:"pi pi-times",className:"p-button-rounded p-button-text p-button-danger",tooltip:"Remover",tooltipOptions:{position:"bottom"},onClick:function(i){i.preventDefault(),Object(Dt.a)({target:i.currentTarget,message:"Tem a certeza que pretende remover?",icon:"pi pi-exclamation-triangle",acceptLabel:"Sim",rejectLabel:"N\xe3o",accept:function(){var i=a.filter((function(e){return e.id!==t.id}));e.onChange(i)}})}})})]}),Object(we.jsx)("div",{className:"p-fluid p-pt-2",children:Object(we.jsx)("div",{className:"p-field p-grid p-mb-0",children:Object(we.jsx)("div",{class:"p-col-12",children:Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsx)("label",{className:"p-col-12 p-md-2",children:Object(we.jsx)("strong",{children:"T\xedtulo: "})}),Object(we.jsx)("div",{className:"p-col-12 p-md-10",children:Object(we.jsx)("span",{children:t.title})})]})})})})]}))}},t.id.toString())})),t.placeholder]})}})}):Object(we.jsx)("div",{children:Object(we.jsx)(lt.a,{severity:"info",text:"Selecione uma ou mais op\xe7\xf5es e clique em 'Adicionar'"})})},Ht=function(e){Object(It.a)(a,e);var t=Object(Tt.a)(a);function a(e){var i;return Object(Pt.a)(this,a),(i=t.call(this,e)).state={data:e.data||{},printsList:e.printsList||[],groupsList:e.groupsList||[],showGroupForm:!1,showFieldForm:!1},i.onChange=e.onChange.bind(Object(At.a)(i)),i.onPrintsChange=i.onPrintsChange.bind(Object(At.a)(i)),i.onGroupsChange=i.onGroupsChange.bind(Object(At.a)(i)),i}return Object(Lt.a)(a,[{key:"componentWillReceiveProps",value:function(e){this.setState({data:e.data})}},{key:"onGroupsChange",value:function(e){console.log(e),this.onChange(Object(d.a)(Object(d.a)({},this.state.data),{},{groups:Object(Ge.a)(e)}))}},{key:"onPrintsChange",value:function(e){console.log(e),this.onChange(Object(d.a)(Object(d.a)({},this.state.data),{},{prints:Object(Ge.a)(e)}))}},{key:"render",value:function(){var e=this;return Object(we.jsxs)("div",{className:"p-fluid p-formgrid p-grid",children:[Object(we.jsx)("div",{className:"p-field p-col-12 p-md-6",children:Object(we.jsx)(Ke.a,{header:"Plantas",children:Object(we.jsxs)("div",{class:"p-col-12",children:[Object(we.jsx)("div",{className:"p-grid p-mb-4",children:Object(we.jsx)("div",{className:"p-col-12",children:Object(we.jsx)(Vt,{data:this.state.data.prints,list:this.state.printsList,onChange:function(t){e.onPrintsChange(t)}})})}),Object(we.jsx)("div",{className:"p-grid",children:Object(we.jsx)("div",{className:"p-col-12",children:Object(we.jsx)("div",{className:"p-card p-p-2",children:Object(we.jsx)(Bt,{data:this.state.data.prints,type:"PRINTS",onChange:function(t){e.onPrintsChange(t)}})})})})]})})}),Object(we.jsx)("div",{className:"p-field p-col-12 p-md-6",children:Object(we.jsx)(Ke.a,{header:"Grupos",children:Object(we.jsxs)("div",{class:"p-col-12",children:[Object(we.jsx)("div",{className:"p-grid p-mb-4",children:Object(we.jsx)("div",{className:"p-col-12",children:Object(we.jsx)(Vt,{data:this.state.data.groups,list:this.state.groupsList,onChange:function(t){e.onGroupsChange(t)}})})}),Object(we.jsx)("div",{className:"p-grid",children:Object(we.jsx)("div",{className:"p-col-12",children:Object(we.jsx)("div",{className:"p-card p-p-2",children:Object(we.jsx)(Bt,{data:this.state.data.groups,type:"GROUPS",onChange:function(t){e.onGroupsChange(t)}})})})})]})})})]})}}]),a}(n.Component),zt=function(e){return e?e.sort((function(e,t){return e.name.toLowerCase()<t.name.toLowerCase()?-1:e.name.toLowerCase()>t.name.toLowerCase()?1:0})):e},Wt=[{label:"Dados Base",icon:"pi pi-fw pi-home"},{label:"UI",icon:"pi pi-fw pi-home"},{label:"Configura\xe7\xe3o",icon:"pi pi-fw pi-cog"},{label:"Plantas",icon:"pi pi-fw pi-print"}];var Kt=Object(l.b)((function(e){return{auth:e.auth}}))(Object(p.h)((function(e){var t,a,i,c=e.history,s=(e.dispatch,Object(n.useState)(!1)),o=Object(u.a)(s,2),l=o[0],j=o[1],b=Object(n.useState)(!1),p=Object(u.a)(b,2),m=p[0],O=p[1],h=Object(n.useState)(0),v=Object(u.a)(h,2),g=v[0],x=v[1],y=Object(n.useState)(e.data||{}),N=Object(u.a)(y,2),_=N[0],C=N[1],w=Object(n.useState)(null!==_&&void 0!==_&&_.config_json?JSON.stringify(_.config_json,null,2):"{}"),S=Object(u.a)(w,2),k=S[0],E=S[1],R=Object(n.useState)(null!==_&&void 0!==_&&_.manifest_json?JSON.stringify(_.manifest_json,null,2):null),P=Object(u.a)(R,2),L=P[0],A=P[1],I=Object(n.useState)(null!==_&&void 0!==_&&_.custom_style?_.custom_style:null),T=Object(u.a)(I,2),D=T[0],M=T[1],U=Object(n.useState)(null!==e&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.roles?zt(Object(Ge.a)(e.data.roles)):[]),G=Object(u.a)(U,2),q=G[0],V=G[1],B=Object(n.useState)(null),H=Object(u.a)(B,2),z=H[0],W=H[1],K=Object(n.useState)(null),Z=Object(u.a)(K,2),J=Z[0],Y=Z[1],$=Object(n.useState)(null),X=Object(u.a)($,2),Q=X[0],ee=X[1],te=Object(n.useState)(""),ae=Object(u.a)(te,2),ie=ae[0],ce=ae[1],ne=Object(n.useState)(null),re=Object(u.a)(ne,2),se=re[0],oe=re[1],le=Object(n.useState)(null!==_&&void 0!==_&&_.owner?{id:_.owner.id,username:_.owner.username,name:_.owner.name,active:_.owner.active}:null),de=Object(u.a)(le,2),ue=de[0],je=de[1],be=Object(n.useState)([]),pe=Object(u.a)(be,2),me=pe[0],Oe=pe[1],fe=Object(n.useState)([]),he=Object(u.a)(fe,2),ve=he[0],ge=he[1],xe=Object(n.useState)({prints:(null===(a=e.data)||void 0===a?void 0:a.prints)||[],groups:(null===(i=e.data)||void 0===i?void 0:i.print_groups)||[]}),ye=Object(u.a)(xe,2),Ne=ye[0],_e=ye[1],Ce=Object(n.useState)(null),Se=Object(u.a)(Ce,2),ke=Se[0],Fe=Se[1],Ee=Object(n.useState)(null),Re=Object(u.a)(Ee,2),Pe=Re[0],Le=Re[1],Ie=Object(n.useRef)(null),Te=Object(n.useRef)(null),De=Object(n.useRef)(null),Me=Object(n.useRef)(null),Ue=Object(n.useRef)(null),qe=Object(n.useContext)(Ae).core,Ve=F(e.auth),Be=qe.API_URL,He=Object(et.b)({defaultValues:Object(d.a)({},_)}),ze=He.register,We=He.control,Ke=He.handleSubmit,Ze=(He.watch,He.formState.errors);He.setValue,Object(n.useEffect)((function(){var t={pagination:{page:1,perPage:1e3},sort:{field:"name",order:"Asc"},filter:{}};j(!0),Promise.all([Qe(Be+"/security").getList("roles",t).catch((function(e){return e})),Qe(Be+"/security").getList("users",t).catch((function(e){return e})),Qe(Be+"/portal").getList("prints",t).catch((function(e){return e})),Qe(Be+"/portal").getList("prints/groups",{pagination:{page:1,perPage:1e3},sort:{field:"title",order:"Asc"},filter:{}}).catch((function(e){return e}))]).then((function(t){var a,i,c,n,r=t[0],s=null!==e&&void 0!==e&&null!==(a=e.data)&&void 0!==a&&a.roles?e.data.roles.map((function(e){return e.id})):[];if(W(zt(r.data.filter((function(e){return!s.includes(e.id)})).map((function(e){return{id:e.id,name:e.name}})))),oe(t[1].data.map((function(e){return{id:e.id,username:e.username,name:e.name,active:e.active}}))),null===e||void 0===e||null===(i=e.data)||void 0===i||!i.id){var o=t[1].data.find((function(t){return t.email===e.auth.data.username}));o&&je({id:o.id,username:o.username,name:o.name,active:o.active})}var l=(null===(c=t[2])||void 0===c?void 0:c.data)||[];Oe(l);var d=(null===(n=t[3])||void 0===n?void 0:n.data)||[];ge(d),j(!1)})).catch((function(e){j(!1)}))}),[]);var Je=function(){if(c.location.state&&c.location.state.from){var e={pathname:c.location.state.from,state:{searchParams:Object(d.a)({},c.location.state.previousSearchParams)}};c.replace(e)}else c.goBack()},Ye=function(e,t){if(e&&e[t])return"maxLength"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:"O n\xfamero de caracteres \xe9 superior \xe0 dimens\xe3o m\xe1xima permitida"}):"pattern"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:"Formato n\xe3o permitido"}):Object(we.jsx)("small",{className:"p-error",children:e[t].message})};return Object(we.jsx)(r.a.Fragment,{children:Object(we.jsxs)(wt.a,{blocked:l,template:Object(we.jsx)("i",{class:"p-blockui-loading-icon pi-spin pi pi-spinner"}),children:[Object(we.jsx)(St.a,{model:Wt,activeIndex:g,onTabChange:function(e){return x(e.index)}}),Object(we.jsxs)("form",{onSubmit:Ke((function(e){var t=null,a=null;try{t=L?JSON.parse(L):null}catch(s){return!1}try{a=JSON.parse(k)}catch(s){return!1}var i={id:e.id,name:e.name,title:e.title,description:e.description,slug:e.slug,keywords:e.keywords,is_active:e.is_active,show_help:e.show_help,show_credits:e.show_credits,show_contact:e.show_contact,on_homepage:e.on_homepage,img_icon:e.img_icon?e.img_icon:null,img_logo:e.img_logo?e.img_logo:null,img_logo_alt:e.img_logo_alt?e.img_logo_alt:null,manifest_json:t,custom_style:D||null,config_json:a,owner_id:ue?ue.id:null,roles:q?q.map((function(e){return e.id})):[],prints:null!==Ne&&void 0!==Ne&&Ne.prints?Ne.prints:[],print_groups:null!==Ne&&void 0!==Ne&&Ne.groups?Ne.groups:[]};O(!0);var c=Qe(Be+"/portal");if(_.id){var n={id:_.id,data:Object(d.a)({},i)};c.update("viewers",n).then((function(e){Ie.current.show({life:3e3,severity:"success",summary:"Editar Registo",detail:"Registo alterado com sucesso"})})).catch((function(e){Ie.current.show({life:3e3,severity:"error",summary:"Editar Registo",detail:"Ocorreu um erro ao alterar o registo"})})).finally((function(){O(!1)}))}else{var r={data:Object(d.a)({},i)};c.create("viewers",r).then((function(e){C(Object(d.a)(Object(d.a)({},_),{},{id:e.data.id})),Ie.current.show({life:5e3,severity:"success",summary:"Criar Registo",detail:"Registo criada com sucesso"})})).catch((function(e){Ie.current.show({life:5e3,severity:"error",summary:"Criar Registo",detail:"Ocorreu um erro ao criar o registo"})})).finally((function(){O(!1)}))}})),children:[Object(we.jsx)(tt.a,{ref:Ie,baseZIndex:2e3}),0===g?Object(we.jsx)("div",{className:"card",children:Object(we.jsxs)("div",{className:"p-fluid p-formgrid p-grid",children:[Object(we.jsxs)("div",{className:"p-field p-col-3",children:[Object(we.jsx)("label",{htmlFor:"id",children:"Id"}),Object(we.jsx)(f.a,{id:"id",type:"text",value:_.id||""})]}),Object(we.jsxs)("div",{className:"p-field p-col-4",children:[Object(we.jsx)("label",{children:"\xa0"}),Object(we.jsx)(et.a,{control:We,name:"is_active",render:function(e){var t=e.field;return Object(we.jsx)(it.a,Object(d.a)(Object(d.a)({},t),{},{checked:t.value,onChange:function(e){return t.onChange(e.target.value)},onLabel:"Mapa Ativo",offLabel:"Mapa N\xe3o Ativo",onIcon:"pi pi-check",offIcon:"pi pi-times"}))}})]}),Ve&&Object(we.jsxs)("div",{className:"p-field p-col-4",children:[Object(we.jsx)("label",{children:"Dono"}),Object(we.jsx)("div",{children:Object(we.jsxs)("div",{className:"p-inputgroup",children:[(null===ue||void 0===ue?void 0:ue.id)>0?Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)("span",{className:"p-inputgroup-addon",children:Object(we.jsx)("i",{className:ue.active?"fas fa-user-alt":"fas fa-user-alt-slash"})}),Object(we.jsxs)("span",{className:"p-inputgroup-addon",children:[ue.name," (",ue.username,")"]})]}):Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)("span",{className:"p-inputgroup-addon",children:Object(we.jsx)("i",{className:"far fa-user"})}),Object(we.jsx)("span",{className:"p-inputgroup-addon",children:"An\xf3mimo"})]}),Object(we.jsx)(nt.a,{type:"button",tooltip:"Alterar",icon:"fas fa-user-edit",className:"p-button-primary",onClick:function(e){Te.current.toggle(e)}}),(null===ue||void 0===ue?void 0:ue.id)>0&&Object(we.jsx)(nt.a,{type:"button",icon:"pi pi-times",className:"p-button-danger",onClick:function(e){je(null)}}),Object(we.jsx)(Ft.a,{ref:Te,showCloseIcon:!0,id:"overlay_panel",breakpoints:{"960px":"75vw","640px":"100vw"},style:{width:"450px"},className:"overlaypanel-demo",children:Object(we.jsx)("div",{className:"p-fluid",children:Object(we.jsxs)("div",{className:"p-field",children:[Object(we.jsx)("label",{htmlFor:"observacoes",children:"Utilizadores"}),Object(we.jsxs)(gt.a,{value:se,selectionMode:"single",paginator:!0,rows:10,selection:ue,onSelectionChange:function(e){je(Object(d.a)({},e.value)),Te.current.hide()},children:[Object(we.jsx)(xt.a,{field:"username",header:"Username",sortable:!0,filter:!0,filterMatchMode:"contains"}),Object(we.jsx)(xt.a,{field:"name",header:"Nome",sortable:!0,filter:!0,filterMatchMode:"contains"})]})]})})})]})})]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-6",children:[Object(we.jsx)("label",{htmlFor:"name",children:"Designa\xe7\xe3o"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"name",name:"name"},ze("name",{required:"Campo obrigat\xf3rio."})),{},{className:Object(dt.a)({"p-invalid":Ze.name})})),Ye(Ze,"name")]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-6",children:[Object(we.jsx)("label",{htmlFor:"name",children:"T\xedtulo"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"title",name:"title"},ze("title",{required:"Campo obrigat\xf3rio."})),{},{className:Object(dt.a)({"p-invalid":Ze.title})})),Ye(Ze,"title")]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-6",children:[Object(we.jsx)("label",{htmlFor:"slug",children:"Slug"}),Object(we.jsx)(f.a,Object(d.a)({id:"slug",name:"slug"},ze("slug")))]}),Object(we.jsxs)("div",{className:"p-field p-col-6",children:[Object(we.jsx)("label",{htmlFor:"tags",children:"Tags"}),Object(we.jsx)(et.a,{name:"keywords",control:We,defaultValue:_.keywords,render:function(e){return Object(we.jsx)(kt.a,{id:"keywords",value:e.field.value,onChange:function(t){return e.field.onChange(t.value)}})}})]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-6",children:[Object(we.jsx)("label",{children:"Perfis"}),Object(we.jsxs)("div",{className:"p-card p-p-2",children:[z&&z.length>0&&Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)("div",{className:"p-field p-col-12 p-pl-0",children:Object(we.jsx)(st.a,{value:J,options:z,optionLabel:"name",optionValue:"id",display:"chip",showClear:!0,filter:!0,filterValue:ie,onFilterValueChange:function(e){return ce(e.value)},onChange:function(e){return Y(e.value)},placeholder:"Selecionar"})}),Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsx)("div",{className:"p-col"}),Object(we.jsx)("div",{className:"p-col",children:Object(we.jsx)(nt.a,{label:"Adicionar",type:"button",disabled:!J||0===J.length,onClick:function(){if(z){var e=z.filter((function(e){return J.includes(e.id)})),t=z.filter((function(e){return!J.includes(e.id)}));V(zt([].concat(Object(Ge.a)(q),Object(Ge.a)(e)))),W(zt(Object(Ge.a)(t))),Y(null),ee(null)}}})}),Object(we.jsx)("div",{className:"p-col"})]})]}),q&&q.length>0?Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)("div",{className:"p-field p-col-12 p-pl-0 p-pt-2",children:Object(we.jsx)(ot.a,{optionLabel:"name",optionValue:"id",className:"p-p-1",options:q,value:Q,onChange:function(e){return ee(e.value)},multiple:!0})}),Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsx)("div",{className:"p-col"}),Object(we.jsx)("div",{className:"p-col",children:Object(we.jsx)(nt.a,{label:"Remover",type:"button",disabled:!Q||0===Q.length,onClick:function(){if(Q){var e=q.filter((function(e){return Q.includes(e.id)})),t=q.filter((function(e){return!Q.includes(e.id)}));V(zt(Object(Ge.a)(t))),W(zt([].concat(Object(Ge.a)(z),Object(Ge.a)(e)))),ee(null),Y(null)}}})}),Object(we.jsx)("div",{className:"p-col"})]})]}):Object(we.jsx)("div",{className:"p-grid p-justify-center",children:Object(we.jsx)("div",{className:"p-col-12 p-mt-4 p-mb-2",children:Object(we.jsx)(lt.a,{severity:"warn",text:"Adicione um ou mais Perfis"})})})]})]})]})}):null,1===g?Object(we.jsx)("div",{className:"card",children:Object(we.jsxs)("div",{className:"p-fluid p-formgrid p-grid",children:[Object(we.jsxs)("div",{className:"p-field p-col-4",children:[Object(we.jsx)("label",{htmlFor:"img_icon",children:"Icon"}),Object(we.jsx)(f.a,Object(d.a)({id:"img_icon",name:"img_icon"},ze("img_icon")))]}),Object(we.jsxs)("div",{className:"p-field p-col-4",children:[Object(we.jsx)("label",{htmlFor:"img_logo",children:"Logo"}),Object(we.jsx)(f.a,Object(d.a)({id:"img_logo",name:"img_logo"},ze("img_logo")))]}),Object(we.jsxs)("div",{className:"p-field p-col-4",children:[Object(we.jsx)("label",{htmlFor:"img_logo_alt",children:"Logo Alternativo"}),Object(we.jsx)(f.a,Object(d.a)({id:"img_logo_alt",name:"img_logo_alt"},ze("img_logo_alt")))]}),Object(we.jsxs)("div",{className:"p-field p-col-12",id:"manifest-editor-parent",children:[Object(we.jsx)("label",{htmlFor:"manifest_editor",children:"App Manifest"}),Object(we.jsx)(Rt.a,{ref:De,id:"manifest_editor",mode:"json",theme:"github",onLoad:function(e){e.container.style.setProperty("width",document.getElementById("manifest-editor-parent").offsetWidth-20+"px")},onChange:function(e){A(e)},value:L,name:"UNIQUE_ID_OF_MANIFEST",editorProps:{$blockScrolling:!0},setOptions:{tabSize:2,maxLines:20,printMargin:!1}})]}),Object(we.jsxs)("div",{className:"p-field p-col-12",id:"style-editor-parent",children:[Object(we.jsx)(ct.a,{className:"p-mb-1",left:function(){return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{icon:"pi pi-undo",className:"p-mr-2 p-pl-3 p-pr-3",title:"Undo",onClick:function(e){e.preventDefault(),Me.current.editor.undo()}}),Object(we.jsx)(nt.a,{icon:"pi pi-refresh",className:"p-mr-2 p-pl-3 p-pr-3",title:"Redo",onClick:function(e){e.preventDefault(),Me.current.editor.redo()}}),Object(we.jsxs)("div",{className:"p-inputgroup",children:[Object(we.jsx)(f.a,{placeholder:"Pesquisar",value:ke,onChange:function(e){e.target.value||Me.current.editor.find("",{backwards:!1,wrap:!0,caseSensitive:!1,wholeWord:!1,regExp:!1}),Fe(e.target.value)}}),Object(we.jsx)(nt.a,{icon:"pi pi-search",className:"p-button-warning",title:"Pesquisar texto",onClick:function(e){return e.preventDefault(),Me.current.editor.find(ke,{backwards:!1,wrap:!0,caseSensitive:!1,wholeWord:!1,regExp:!1}),!1}})]})]})}}),Object(we.jsx)("label",{htmlFor:"style_editor",children:"Style (C\xf3digo)"}),Object(we.jsx)(Rt.a,{ref:Me,id:"style_editor",mode:"css",theme:"github",onLoad:function(e){e.container.style.setProperty("width",document.getElementById("style-editor-parent").offsetWidth-20+"px")},onChange:function(e){M(e)},value:D,name:"UNIQUE_ID_OF_DIV2",editorProps:{$blockScrolling:!0},setOptions:{tabSize:2,maxLines:20,printMargin:!1}})]})]})}):null,2===g?Object(we.jsxs)("div",{className:"card",id:"editor-parent",children:[Object(we.jsx)(ct.a,{className:"p-mb-1",left:function(){return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{icon:"pi pi-undo",className:"p-mr-2 p-pl-3 p-pr-3",title:"Undo",onClick:function(e){e.preventDefault(),Ue.current.editor.undo()}}),Object(we.jsx)(nt.a,{icon:"pi pi-refresh",className:"p-mr-2 p-pl-3 p-pr-3",title:"Redo",onClick:function(e){e.preventDefault(),Ue.current.editor.redo()}}),Object(we.jsxs)("div",{className:"p-inputgroup",children:[Object(we.jsx)(f.a,{placeholder:"Pesquisar",value:Pe,onChange:function(e){e.target.value||Ue.current.editor.find("",{backwards:!1,wrap:!0,caseSensitive:!1,wholeWord:!1,regExp:!1}),Le(e.target.value)}}),Object(we.jsx)(nt.a,{icon:"pi pi-search",className:"p-button-warning",title:"Pesquisar texto",onClick:function(e){return e.preventDefault(),Ue.current.editor.find(Pe,{backwards:!1,wrap:!0,caseSensitive:!1,wholeWord:!1,regExp:!1}),!1}})]})]})}}),Object(we.jsx)(Rt.a,{ref:Ue,mode:"json",theme:"github",onLoad:function(e){e.container.style.setProperty("width",document.getElementById("editor-parent").offsetWidth-30+"px")},onChange:function(e){E(e)},value:k,name:"UNIQUE_ID_OF_DIV",editorProps:{$blockScrolling:!0},setOptions:{tabSize:2,printMargin:!1}})]}):null,3===g?Object(we.jsx)("div",{className:"card",children:Object(we.jsx)(Ht,{data:Ne,printsList:me,groupsList:ve,onChange:function(e){_e(e)}})}):null,Object(we.jsx)(ct.a,{className:"p-mt-4 p-mb-4",right:function(){return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{type:"button",label:"Voltar",icon:"pi pi-left",className:"p-button-secondary p-mr-4",disabled:!!m,onClick:Je}),Object(we.jsx)(nt.a,{type:"submit",label:"Gravar",icon:m?"pi pi-save pi-spinner":"pi pi-save",disabled:!!m})]})}})]})]})})})));var Zt=Object(l.b)((function(e){return{loading:e.loading}}))(Object(p.h)((function(e){var t=Object(n.useContext)(Ae).core,a=(e.history,e.dispatch,Object(p.g)().id),i=Object(n.useState)(!0),c=Object(u.a)(i,2),s=c[0],o=c[1],l=Object(n.useState)(null),d=Object(u.a)(l,2),j=d[0],b=d[1],m=Object(n.useState)([]),O=Object(u.a)(m,2),f=(O[0],O[1],Object(n.useRef)(null),t.API_URL);Object(n.useEffect)((function(){a?h():(o(!1),b({}))}),[]);var h=function(){var e=Qe(f+"/portal"),t={id:a};o(!0),e.getOne("viewers",t).then((function(e){b(e.data),o(!1)})).catch((function(e){o(!1)}))};return Object(we.jsx)(r.a.Fragment,{children:Object(we.jsx)(wt.a,{blocked:s,template:Object(we.jsx)("i",{class:"p-blockui-loading-icon pi-spin pi pi-spinner"}),children:j?Object(we.jsx)(Kt,{data:j}):Object(we.jsx)("div",{})})})}))),Jt=a(60),Yt={filters:{},first:0,rows:20,page:0,sortField:"id",sortOrder:1};var $t=Object(l.b)((function(e){return{loading:e.loading,filters:e.filters}}))(Object(p.h)((function(e){var t,a,i,c,s,o,l,j,b=e.history,p=Object(n.useContext)(Ae).core,m=Object(n.useRef)(null),O=Object(n.useState)(!1),h=Object(u.a)(O,2),v=h[0],g=h[1],x=Object(n.useState)([]),y=Object(u.a)(x,2),N=y[0],_=y[1],C=Object(n.useState)(null),w=Object(u.a)(C,2),S=w[0],k=w[1],E=Object(n.useState)(Object(d.a)({},Yt)),R=Object(u.a)(E,2),P=R[0],L=R[1],A=Object(n.useState)(!1),I=Object(u.a)(A,2),T=I[0],D=I[1],M=Object(n.useRef)(null),U=p.store.getState().auth,G=F(U),q=p.API_URL;Object(n.useEffect)((function(){var t,a,i;D(!0),null!==e&&void 0!==e&&null!==(t=e.history)&&void 0!==t&&null!==(a=t.location)&&void 0!==a&&null!==(i=a.state)&&void 0!==i&&i.searchParams?L(Object(d.a)({},e.history.location.state.searchParams)):H()}),[]),Object(n.useEffect)((function(){if(T){var e=setTimeout((function(){H()}),500);return function(){clearTimeout(e)}}}),[P]);var V=function(){var e={pathname:"/viewers/create",state:{from:b.location.pathname,previousSearchParams:Object(d.a)({},P)}};b.push(e)},B=function(){Object(Jt.a)({message:" Deseja eliminar o(s) registo(s) selecionado(s)?",header:"Confirma\xe7\xe3o",icon:"pi pi-exclamation-triangle",acceptLabel:"Sim",rejectLabel:"N\xe3o",accept:function(){var e=Qe(q+"/portal"),t={ids:S.map((function(e){return e.id}))};e.deleteMany("viewers",t).then((function(e){m.current.show({life:3e3,severity:"success",summary:"Eliminar Registo(s)",detail:"Registo(s) eliminado(s) com sucesso"}),H()})).catch((function(e){m.current.show({life:3e3,severity:"error",summary:"Eliminar Registo(s)",detail:"Ocorreu um erro ao eliminar o(s) registo(s)"})})).finally((function(){}))},reject:function(){}})},H=function(e){var t=Qe(q+"/portal"),a={};e?Object.entries(e).forEach((function(e){var t=Object(u.a)(e,2),i=t[0],c=t[1];c.value&&(a[i]=c.value)})):P.filters&&Object.entries(P.filters).forEach((function(e){var t=Object(u.a)(e,2),i=t[0],c=t[1];c.value&&(a[i]=c.value)}));var i={pagination:{page:P.page+1,perPage:P.rows},sort:{field:P.sortField,order:-1==P.sortOrder?"Desc":"Asc"},filter:a};g(!0),t.getList("viewers",i).then((function(e){k(null),_(Object(d.a)(Object(d.a)({},e),{},{page:P.page})),g(!1)})).catch((function(e){g(!1),m.current.show({life:5e3,severity:"error",summary:"Pesquisa de Visualizadores",detail:"Ocorreu um erro na pesquisa de interven\xe7\xf5es"})}))},z=function(e){var t=Object(d.a)({},null===P||void 0===P?void 0:P.filters);t[e.target.name]={value:e.target.value},L(Object(d.a)(Object(d.a)({},P),{},{filters:Object(d.a)({},t)}))},W=function(e){L(Object(d.a)({},Yt))},K=Object(we.jsx)(f.a,{name:"id",value:null===P||void 0===P||null===(t=P.filters)||void 0===t||null===(a=t.id)||void 0===a?void 0:a.value,onChange:z,className:"p-column-filter",placeholder:"Id",disabled:v}),Z=Object(we.jsx)(f.a,{name:"name",value:null===P||void 0===P||null===(i=P.filters)||void 0===i||null===(c=i.name)||void 0===c?void 0:c.value,onChange:z,className:"p-column-filter",placeholder:"Nome",disabled:v}),J=Object(we.jsx)(f.a,{name:"title",value:null===P||void 0===P||null===(s=P.filters)||void 0===s||null===(o=s.title)||void 0===o?void 0:o.value,onChange:z,className:"p-column-filter",placeholder:"Nome",disabled:v}),Y=Object(we.jsx)(f.a,{name:"description",value:null===P||void 0===P||null===(l=P.filters)||void 0===l||null===(j=l.description)||void 0===j?void 0:j.value,onChange:z,className:"p-column-filter",placeholder:"Descri\xe7\xe3o",disabled:v});return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)("div",{className:"p-col-12",children:Object(we.jsx)("h3",{children:"Visualizadores"})}),Object(we.jsxs)("div",{className:"p-grid p-fluid viewer-list",children:[Object(we.jsx)(tt.a,{ref:m,baseZIndex:2e3}),Object(we.jsxs)("div",{className:"card",children:[Object(we.jsx)(ct.a,{className:"p-mb-4",left:function(){return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{label:"Novo",icon:"pi pi-plus",className:"p-button-success p-mr-2",onClick:V}),Object(we.jsx)(nt.a,{label:"Eliminar",icon:"pi pi-trash",className:"p-button-danger",onClick:B,disabled:!S||!S.length})]})},right:function(){return Object(we.jsx)(r.a.Fragment,{children:Object(we.jsx)(nt.a,{label:"Limpar",icon:"pi pi-times",className:"p-button-help p-mr-2",onClick:W})})}}),Object(we.jsxs)(gt.a,{ref:M,value:N?N.data:[],lazy:!0,selectionMode:"checkbox",selection:S,onSelectionChange:function(e){return k(e.value)},paginator:!0,first:P.first,rows:P.rows,totalRecords:N.total,onPage:function(e){var t=Object(d.a)(Object(d.a)({},P),e);L(t)},onSort:function(e){var t=Object(d.a)(Object(d.a)({},P),e);L(t)},sortField:P.sortField,sortOrder:P.sortOrder,filters:P.filters,loading:v,emptyMessage:"N\xe3o foram entrados registos.",children:[Object(we.jsx)(xt.a,{selectionMode:"multiple",headerStyle:{width:"3rem"}}),Object(we.jsx)(xt.a,{field:"id",header:"Id",sortable:!0,filter:!0,filterElement:K,filterPlaceholder:"Id",headerStyle:{width:"6rem"}}),Object(we.jsx)(xt.a,{field:"name",header:"Nome",sortable:!0,filter:!0,filterElement:Z,filterPlaceholder:"Nome",style:{wordBreak:"break-all"}}),Object(we.jsx)(xt.a,{field:"title",header:"T\xedtulo",sortable:!0,filter:!0,filterElement:J,filterPlaceholder:"T\xedtulo",style:{wordBreak:"break-all"}}),Object(we.jsx)(xt.a,{field:"description",header:"Descri\xe7\xe3o",sortable:!0,filter:!0,filterElement:Y,filterPlaceholder:"Descri\xe7\xe3o",style:{wordBreak:"break-all"}}),Object(we.jsx)(xt.a,{field:"keywords",header:"Keywords",body:function(e){return Object(we.jsx)(r.a.Fragment,{children:e.keywords&&e.keywords.map((function(e){return Object(we.jsx)(yt.a,{label:e,className:"p-mr-2 p-mb-2"})}))})}}),G&&Object(we.jsx)(xt.a,{field:"owner",header:"Dono",body:function(e){var t,a=Object(we.jsx)(yt.a,{label:"An\xf3nimo",icon:"far fa-user",className:"p-mr-2 p-mb-2"});return(null===e||void 0===e||null===(t=e.owner)||void 0===t?void 0:t.id)>0&&(a=e.owner.active?Object(we.jsx)(yt.a,{label:e.owner.username,icon:"fas fa-user-alt",className:"p-mr-2 p-mb-2"}):Object(we.jsx)(yt.a,{label:e.owner.username,icon:"fas fa-user-alt-slash",className:"p-mr-2 p-mb-2"})),a}}),Object(we.jsx)(xt.a,{body:function(e){return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{icon:"pi pi-pencil",className:"p-button-rounded p-button-success p-mr-2",onClick:function(){return function(e){var t={pathname:"/viewers/edit/".concat(e.id),state:{from:b.location.pathname,previousSearchParams:Object(d.a)({},P)}};b.push(t)}(e)}}),Object(we.jsx)(nt.a,{icon:"pi pi-trash",className:"p-button-rounded p-button-warning",onClick:function(){return t=e,void Object(Jt.a)({message:" Deseja eliminar o registo selecionado?",header:"Confirma\xe7\xe3o",icon:"pi pi-exclamation-triangle",acceptLabel:"Sim",rejectLabel:"N\xe3o",accept:function(){var e=Qe(q+"/portal"),a={id:t.id};e.delete("viewers",a).then((function(e){m.current.show({life:3e3,severity:"success",summary:"Eliminar Registo",detail:"Registo eliminado com sucesso"}),H()})).catch((function(e){m.current.show({life:3e3,severity:"error",summary:"Eliminar Registo",detail:"Ocorreu um erro ao eliminar o registo"})})).finally((function(){}))},reject:function(){}});var t}})]})}})]})]})]})]})}))),Xt=a(200),Qt=a(54),ea=a(255),ta=a(106),aa=a(228),ia=a(258),ca=a(16),na=a(287),ra=a(209),sa=a(256),oa=a(208),la=a(8),da=a(330),ua=a(285),ja=a(165),ba=a(207),pa=a(282),ma=a(128),Oa=a(250),fa=a(331),ha=a(337),va=a(257),ga=a(328),xa=a(333),ya=a(334),Na=a(131),_a=a(336),Ca=a(335),wa=a(286),Sa=a(329);var ka=function(e){var t=Object(n.useState)(),a=Object(u.a)(t,2),i=a[0],c=a[1],r=Object(n.useState)(),s=Object(u.a)(r,2),o=s[0],l=s[1],d=Object(n.useState)(),j=Object(u.a)(d,2),b=(j[0],j[1]),p=Object(n.useRef)(),m=Object(n.useRef)();m.current=i,Object(n.useEffect)((function(){var t=new Ca.a({source:new wa.a}),a=new ya.a({target:p.current,layers:[new _a.a({source:new Sa.a}),t],view:new Na.a({projection:"EPSG:3857",center:[0,0],zoom:2}),controls:[]});a.on("click",O),c(a),e.features&&e.features.length>0&&(t.getSource().addFeatures(e.features),a.getView().fit(t.getSource().getExtent())),l(t)}),[]),Object(n.useEffect)((function(){(m||m.current.current)&&o&&(e.features.length?o.setSource(new wa.a({features:e.features})):o.getSource().clear())}),[e.features]);var O=function(e){var t=m.current.getCoordinateFromPixel(e.pixel),a=Object(ca.t)(t,"EPSG:3857","EPSG:4326");b(a),console.log(a)};return Object(we.jsx)("div",{ref:p,className:"map-container",style:{width:"100%",height:"300px"}})},Fa=function(e){var t=Object(n.useState)(e.data?Object(d.a)({},e.data):{}),a=Object(u.a)(t,2),i=a[0],c=a[1],s=Object(n.useState)(),o=Object(u.a)(s,2),l=o[0],j=o[1],b=Object(n.useState)(!1),p=Object(u.a)(b,2),m=p[0],O=p[1],f=Object(n.useState)([]),h=Object(u.a)(f,2),v=h[0],g=h[1],x=Object(et.b)({defaultValues:Object(d.a)({},e.data)}),y=x.register,N=x.watch,_=x.setValue,C=x.handleSubmit,w=x.clearErrors,S=x.control,k=x.formState.errors,F=function(e,t){if(e&&e[t])return"maxLength"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:"O n\xfamero de caracteres \xe9 superior \xe0 dimens\xe3o m\xe1xima permitida"}):"pattern"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:"Formato n\xe3o permitido"}):Object(we.jsx)("small",{className:"p-error",children:e[t].message})},E=function(t){if(t.geometryWKT&&t.geometrySRID)try{var a=function(e,t){var a=new ia.a;return t?a.readGeometry(e,t):a.readGeometry(e)}(t.geometryWKT,null);if(a){var i=function(e){return(new ia.a).writeGeometry(e)}(a.clone());e.onSave({geometryWKT:i,geometrySRID:t.geometrySRID,tolerance:t.tolerance}),O(!1)}else console.log("error")}catch(c){console.log(c)}},R=function(){_("geometrySRID",null===e||void 0===e?void 0:e.data.geometrySRID,{shouldValidate:!1}),_("geometryWKT",null===e||void 0===e?void 0:e.data.geometryWKT,{shouldValidate:!1}),_("tolerance",null===e||void 0===e?void 0:e.data.tolerance,{shouldValidate:!1}),w(),O(!1)},P=function(e){if(e.geometryWKT&&e.geometrySRID){var t=[],a=(new ia.a).readFeature(e.geometryWKT,{dataProjection:"EPSG:"+e.geometrySRID,featureProjection:"EPSG:3857"});if(t.push(a),e.tolerance&&e.tolerance>0)try{var i=new ga.a;i.inject(ja.a,ba.a,pa.a,ma.a,Oa.a,fa.a,ha.a,va.a);var c=i.read(a.getGeometry()),n=xa.a.bufferOp(c,e.tolerance),r=i.write(n),s=new oa.a({geometry:r}),o=new na.b({stroke:new ra.a({color:"rgba(100,27,0,1.0)",width:1}),fill:new sa.a({color:"rgba(0,0,0,0)"})});s.setStyle(o),t.push(s)}catch(l){console.log(l)}g(t)}else g([])};Object(n.useEffect)((function(){P(e.data)}),[]),r.a.useEffect((function(){var e=N((function(e,t){t.name,t.type;P(e)}));return function(){return e.unsubscribe()}}),[N]),Object(n.useEffect)((function(){e.coordinateSystems&&(j(e.coordinateSystems.map((function(e){return{value:parseInt(e.config_json.srid),label:e.config_json.title}}))),function(e){e.map((function(e){if(!ca.l("EPSG:"+e.srid))try{ua.a.defs("EPSG:"+e.srid,e.defs),Object(da.a)(ua.a);var t=ca.l("EPSG:"+e.srid),a=ca.n("EPSG:4326",t);if(e.extent){var i=e.extent.split(" ").map(Number);t.setWorldExtent(i);var c=Object(la.a)(i,a,void 0,8);t.setExtent(c)}}catch(n){console.log(n)}return e}))}(e.coordinateSystems.map((function(e){return{srid:parseInt(e.config_json.srid),defs:e.config_json.defs,extent:e.config_json.extent}}))),P(e.data))}),[e.coordinateSystems]),Object(n.useEffect)((function(){c(Object(d.a)({},e.data))}),[e.data]);return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)("div",{className:"p-field p-col-12 p-mt-2 p-mb-4",children:Object(we.jsx)("div",{children:i.geometryWKT?Object(we.jsx)(lt.a,{severity:"info",text:"Clique em 'Editar' para configurar o filtro espacial."}):Object(we.jsx)(lt.a,{severity:"warn",text:"Sem filtro espacial definido. Clique em 'Editar' para definir um filtro espacial."})})}),Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsx)("div",{className:"p-col-6",children:i.geometryWKT&&Object(we.jsx)(nt.a,{type:"text",label:"Remover",icon:"pi pi-trash",className:"p-button-danger p-button-outlined",onClick:function(t){t.preventDefault(),_("geometrySRID",null,{shouldValidate:!1}),_("geometryWKT",null,{shouldValidate:!1}),_("tolerance",null,{shouldValidate:!1}),e.onSave({geometryWKT:null,geometrySRID:null,tolerance:null})}})}),Object(we.jsx)("div",{className:"p-col-6",children:Object(we.jsx)(nt.a,{type:"text",label:"Editar",icon:"pi pi-times",className:"p-button-outlined",onClick:function(e){e.preventDefault(),O(!0)}})})]}),m&&Object(we.jsx)(ta.a,{header:"Edi\xe7\xe3o de Filtro Espacial",visible:m,style:{width:"50vw"},footer:function(e){return Object(we.jsxs)("div",{children:[Object(we.jsx)(nt.a,{label:"Fechar",icon:"pi pi-times",onClick:R,className:"p-button-text"}),Object(we.jsx)(nt.a,{label:"Gravar",icon:"pi pi-check",onClick:C((function(e){return E(e)})),autoFocus:!0})]})},onHide:R,children:Object(we.jsx)("form",{children:Object(we.jsxs)("div",{className:"p-fluid p-formgrid p-grid",children:[Object(we.jsx)("div",{className:"p-field p-col-12",children:Object(we.jsxs)(ea.b,{children:[Object(we.jsxs)(ea.a,{header:"WKT",children:[Object(we.jsxs)("div",{className:"p-col p-field",children:[Object(we.jsx)("label",{htmlFor:"format",children:"Sistema de Coordenadas"}),Object(we.jsx)(et.a,{name:"geometrySRID",control:S,rules:{required:"Campo obrigat\xf3rio."},render:function(e){var t=e.field;return Object(we.jsx)(Ve.a,Object(d.a)(Object(d.a)({id:"geometrySRID"},t),{},{options:l,showClear:!0,onChange:function(e){return t.onChange(e.value)},className:Object(dt.a)({"p-invalid":k.geometrySRID})}))}}),F(k,"geometrySRID")]}),Object(we.jsxs)("div",{className:"p-field p-col-12",children:[Object(we.jsx)("label",{htmlFor:"orientation",children:"Geometria (WKT)"}),Object(we.jsx)(mt.a,Object(d.a)(Object(d.a)({id:"geometryWKT",name:"geometryWKT",rows:5},y("geometryWKT",{required:"Campo obrigat\xf3rio."})),{},{className:Object(dt.a)({"p-invalid":k.geometryWKT})})),F(k,"geometryWKT")]})]}),Object(we.jsx)(ea.a,{header:"Mapa",children:Object(we.jsx)("div",{children:Object(we.jsx)(ka,{features:v})})})]})}),Object(we.jsxs)("div",{className:"p-field p-col-12",children:[Object(we.jsx)("label",{htmlFor:"tolerance",children:"Toler\xe2ncia (m)"}),Object(we.jsx)(et.a,{name:"tolerance",control:S,render:function(e){var t=e.field;return Object(we.jsx)(aa.a,Object(d.a)(Object(d.a)({id:"tolerance"},t),{},{onChange:function(e){return t.onChange(e.value)}}))}})]})]})})})]})},Ea=a(283),Ra=function(e){var t=Object(n.useState)(e.data?Object(d.a)({},e.data):{}),a=Object(u.a)(t,2),i=(a[0],a[1]),c=Object(et.b)({defaultValues:Object(d.a)({},e.data)}),r=c.register,s=c.handleSubmit,o=c.control,l=(c.reset,c.formState.errors),j=function(e,t){if(e&&e[t])return"maxLength"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:"O n\xfamero de caracteres \xe9 superior \xe0 dimens\xe3o m\xe1xima permitida"}):"pattern"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:"Formato n\xe3o permitido"}):Object(we.jsx)("small",{className:"p-error",children:e[t].message})};Object(n.useEffect)((function(){i(Object(d.a)({},e.data))}),[e.data]);return Object(we.jsx)(ta.a,{header:"Edi\xe7\xe3o de Campo",visible:e.show,style:{width:"50vw"},footer:function(t){return Object(we.jsxs)("div",{children:[Object(we.jsx)(nt.a,{label:"Fechar",icon:"pi pi-times",onClick:function(){return e.onHide()},className:"p-button-text"}),Object(we.jsx)(nt.a,{label:"Gravar",icon:"pi pi-check",onClick:s((function(t){return a=t,void e.onSave(a);var a})),autoFocus:!0})]})},onHide:function(){e.onHide()},children:Object(we.jsx)("form",{children:Object(we.jsxs)("div",{className:"p-fluid p-formgrid p-grid",children:[Object(we.jsxs)("div",{className:"p-field p-col-12",children:[Object(we.jsx)("label",{htmlFor:"key",children:"Chave"}),Object(we.jsxs)("div",{className:"p-inputgroup",children:[Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"key",type:"text"},r("key",{required:"Campo obrigat\xf3rio.",pattern:/^(?![0-9])[a-zA-Z0-9$_]+$/i})),{},{className:Object(dt.a)({"p-invalid":l.key})})),Object(we.jsx)(Ea.a,{target:".tooltip-form-field-key",autoHide:!1,children:Object(we.jsx)("div",{className:"p-d-flex p-ai-center",children:Object(we.jsxs)("span",{style:{minWidth:"5rem"},children:["O campo ",Object(we.jsx)("i",{children:"chave"})," \xe9 de preenchimento obrigat\xf3rio e serve como identificador \xfanico de cada campo. Dever\xe1 ser preenchido com uma cadeia de caracteres, sem espa\xe7os."]})})}),Object(we.jsx)(nt.a,{type:"text",icon:"pi pi-info-circle",className:"tooltip-form-field-key p-button-rounded p-button-text",onClick:function(e){return e.preventDefault()}})]}),j(l,"key")]}),Object(we.jsxs)("div",{className:"p-field p-col-12",children:[Object(we.jsx)("label",{htmlFor:"title",children:"T\xedtulo"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"title",type:"text"},r("title",{required:"Campo obrigat\xf3rio."})),{},{className:Object(dt.a)({"p-invalid":l.title})})),j(l,"title")]}),Object(we.jsxs)("div",{className:"p-field p-col-12",children:[Object(we.jsx)(et.a,{name:"required",control:o,render:function(e){var t=e.field;return Object(we.jsx)(Qt.a,Object(d.a)(Object(d.a)({id:"required"},t),{},{onChange:function(e){return t.onChange(!e.value)},checked:t.value,className:"p-mr-2",style:{float:"left"}}))}}),Object(we.jsx)("label",{htmlFor:"required",className:"p-checkbox-label",style:{display:"inline"},children:"Preenchimento obrigat\xf3rio"})]}),Object(we.jsx)("div",{className:"p-field p-col-12",children:Object(we.jsx)("hr",{})}),Object(we.jsxs)("div",{className:"p-field p-col-12",children:[Object(we.jsx)(et.a,{name:"active",control:o,render:function(e){var t=e.field;return Object(we.jsx)(Qt.a,Object(d.a)(Object(d.a)({id:"active"},t),{},{onChange:function(e){return t.onChange(!e.value)},checked:t.value,className:"p-mr-2",style:{float:"left"}}))}}),Object(we.jsx)("label",{htmlFor:"active",className:"p-checkbox-label",style:{display:"inline"},children:"Activo"})]})]})})})},Pa=function(e){var t=Object(n.useState)(e.data?Object(d.a)({},e.data):{}),a=Object(u.a)(t,2),i=(a[0],a[1]),c=Object(et.b)({defaultValues:Object(d.a)({},e.data)}),r=c.register,s=c.handleSubmit,o=c.control,l=(c.reset,c.formState.errors),j=function(e,t){if(e&&e[t])return"maxLength"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:"O n\xfamero de caracteres \xe9 superior \xe0 dimens\xe3o m\xe1xima permitida"}):"pattern"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:"Formato n\xe3o permitido"}):Object(we.jsx)("small",{className:"p-error",children:e[t].message})};Object(n.useEffect)((function(){i(Object(d.a)({},e.data))}),[e.data]);return Object(we.jsx)(ta.a,{header:"Edi\xe7\xe3o de Grupo",visible:e.show,style:{width:"50vw"},footer:function(t){return Object(we.jsxs)("div",{children:[Object(we.jsx)(nt.a,{label:"Fechar",icon:"pi pi-times",onClick:function(){return e.onHide()},className:"p-button-text"}),Object(we.jsx)(nt.a,{label:"Gravar",icon:"pi pi-check",onClick:s((function(t){return a=t,void e.onSave(a);var a})),autoFocus:!0})]})},onHide:function(){e.onHide()},children:Object(we.jsx)("form",{children:Object(we.jsxs)("div",{className:"p-fluid p-formgrid p-grid",children:[Object(we.jsxs)("div",{className:"p-field p-col-12",children:[Object(we.jsx)("label",{htmlFor:"key",children:"Chave"}),Object(we.jsxs)("div",{className:"p-inputgroup",children:[Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"key",type:"text"},r("key",{required:"Campo obrigat\xf3rio.",pattern:/^(?![0-9])[a-zA-Z0-9$_]+$/i})),{},{className:Object(dt.a)({"p-invalid":l.key})})),Object(we.jsx)(Ea.a,{target:".tooltip-form-field-key",autoHide:!1,children:Object(we.jsx)("div",{className:"p-d-flex p-ai-center",children:Object(we.jsxs)("span",{style:{minWidth:"5rem"},children:["O campo ",Object(we.jsx)("i",{children:"chave"})," \xe9 de preenchimento obrigat\xf3rio e serve como identificador \xfanico de cada grupo. Dever\xe1 ser preenchido com uma cadeia de caracteres, sem espa\xe7os."]})})}),Object(we.jsx)(nt.a,{type:"text",icon:"pi pi-info-circle",className:"tooltip-form-field-key p-button-rounded p-button-text",onClick:function(e){return e.preventDefault()}})]}),j(l,"key")]}),Object(we.jsxs)("div",{className:"p-field p-col-12",children:[Object(we.jsx)("label",{htmlFor:"title",children:"T\xedtulo"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"title",type:"text"},r("title",{required:"Campo obrigat\xf3rio."})),{},{className:Object(dt.a)({"p-invalid":l.title})})),j(l,"title")]}),Object(we.jsx)("div",{className:"p-field p-col-12",children:Object(we.jsx)("hr",{})}),Object(we.jsxs)("div",{className:"p-field p-col-12",children:[Object(we.jsx)(et.a,{name:"active",control:o,render:function(e){var t=e.field;return Object(we.jsx)(Qt.a,Object(d.a)(Object(d.a)({id:"active"},t),{},{onChange:function(e){return t.onChange(!e.value)},checked:t.value,className:"p-mr-2",style:{float:"left"}}))}}),Object(we.jsx)("label",{htmlFor:"active",className:"p-checkbox-label",style:{display:"inline"},children:"Activo"})]})]})})})},La=function(e){var t=e.group,a=e.groupNum,i=Object(n.useState)(),c=Object(u.a)(i,2),r=c[0],s=c[1],o=Object(n.useState)(!1),l=Object(u.a)(o,2),j=l[0],b=l[1];function p(){b(!1),s(null)}function m(a){var i=a.key;if(r.key===i||!t.data.fields[i]){var c,n=Object(d.a)({},t.data.fields);n[r.key]&&delete n[r.key],n=Object(d.a)(Object($e.a)({},i,{active:(c=a).active,title:c.title,header:c.header,required:c.required}),n),e.onChange(t.id,n),b(!1)}}return Object(we.jsx)(Mt.c,{droppableId:"droppable".concat(t.id),type:"".concat(a),children:function(i,c){return Object(we.jsxs)("div",{ref:i.innerRef,style:qt(c.isDraggingOver),children:[0===Object.keys(t.data.fields||{}).length&&Object(we.jsx)("div",{className:"p-fluid",children:Object(we.jsx)("div",{className:"p-col-12",children:Object(we.jsx)(lt.a,{severity:"info",text:"Clique em '+' para adicionar um campo"})})}),Object.entries(t.data.fields).map((function(e,t){return Object(d.a)({id:e[0]},e[1])})).map((function(i,c){return Object(we.jsx)(Mt.b,{draggableId:"".concat(a).concat(c),index:c,style:{border:"solid 1px lightgray",marginTop:3},children:function(a,c){return Object(we.jsxs)("div",Object(d.a)(Object(d.a)({ref:a.innerRef},a.draggableProps),{},{style:Gt(c.isDragging,a.draggableProps.style),className:"p-shadow-1",children:[Object(we.jsxs)("div",{style:{marginBottom:5},children:[Object(we.jsxs)("div",{style:{float:"left",paddingTop:6},children:[Object(we.jsx)("span",{style:{paddingLeft:"15px"},children:i.id}),Object(we.jsx)("span",Object(d.a)(Object(d.a)({},a.dragHandleProps),{},{children:Object(we.jsx)("i",{className:"fas fa-arrows-alt",style:{float:"left",paddingTop:3}})}))]}),Object(we.jsxs)("div",{style:{textAlign:"right"},children:[Object(we.jsx)(nt.a,{type:"text",icon:"pi pi-trash",className:"p-button-rounded p-button-text p-button-danger",tooltip:"Eliminar campo",tooltipOptions:{position:"bottom"},onClick:function(a){a.preventDefault(),Object(Dt.a)({target:a.currentTarget,message:"Tem a certeza que pretende eliminar?",icon:"pi pi-exclamation-triangle",acceptLabel:"Sim",rejectLabel:"N\xe3o",accept:function(){var a=Object(d.a)({},t.data.fields);delete a[i.id],e.onChange(t.id,a)}})}}),Object(we.jsx)(nt.a,{type:"text",icon:"pi pi-pencil",className:"p-button-rounded p-button-text p-button-warning",tooltip:"Editar campo",tooltipOptions:{position:"bottom"},onClick:function(e){e.preventDefault(),s(Object(d.a)(Object(d.a)({},i),{},{groupId:t.id,key:i.id})),b(!0)}})]})]}),j&&Object(we.jsx)(Ra,{data:r,show:j,onHide:p,onSave:m}),Object(we.jsxs)("div",{className:"p-fluid p-pt-2",children:[Object(we.jsxs)("div",{className:"p-field p-grid p-mb-0",children:[Object(we.jsx)("div",{class:"p-col-10",children:Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsx)("label",{className:"p-col-12 p-md-2",children:Object(we.jsx)("strong",{children:"T\xedtulo: "})}),Object(we.jsx)("div",{className:"p-col-12 p-md-10",children:Object(we.jsx)("span",{children:i.title})})]})}),Object(we.jsx)("div",{class:"p-col-2",children:Object(we.jsx)("div",{className:"p-grid",children:Object(we.jsxs)("div",{className:"p-field-checkbox",children:[Object(we.jsx)(Qt.a,{checked:i.active,disabled:!0}),Object(we.jsx)("label",{children:"Ativo"})]})})})]}),Object(we.jsx)("div",{className:"p-field p-grid",children:Object(we.jsx)("div",{class:"p-col-12",children:Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsx)("label",{className:"p-col-12 p-md-2",children:Object(we.jsx)("strong",{children:"Cabe\xe7alho: "})}),Object(we.jsx)("div",{className:"p-col-12 p-md-10",children:Object(we.jsx)("span",{children:i.header})})]})})}),Object(we.jsx)("div",{className:"p-field p-grid",children:Object(we.jsx)("div",{class:"p-col-12",children:Object(we.jsxs)("div",{className:"p-field-checkbox",children:[Object(we.jsx)(Qt.a,{checked:i.required,disabled:!0}),Object(we.jsx)("label",{children:"Preenchimento obrigat\xf3rio"})]})})})]})]}))}},"".concat(a).concat(c))})),i.placeholder]})}})},Aa=function(e){var t=e.fields,a=Object(n.useState)(),i=Object(u.a)(a,2),c=i[0],r=i[1],s=Object(n.useState)(!1),o=Object(u.a)(s,2),l=o[0],j=o[1];function b(){j(!1),r(null)}function p(a){var i=a.key;if(c.key===i||!t[i]){var n,r=Object(d.a)({},t);c.key!==i&&delete r[c.key],r[i]={active:(n=a).active,title:n.title,header:n.header,required:n.required},e.onChange(r),j(!1)}}return Object(we.jsx)(Mt.a,{onDragEnd:e.onDragEnd,children:Object(we.jsx)(Mt.c,{droppableId:"droppable",type:"FIELDS",children:function(a,i){return Object(we.jsxs)("div",{ref:a.innerRef,style:qt(i.isDraggingOver),children:[0===Object.keys(t||{}).length&&Object(we.jsx)("div",{className:"p-fluid",children:Object(we.jsx)("div",{className:"p-col-12",children:Object(we.jsx)(lt.a,{severity:"info",text:"Clique em 'Novo Campo' para adicionar um campo"})})}),Object.entries(t).map((function(e,t){return{id:e[0],data:e[1]}})).map((function(a,i){return Object(we.jsx)(Mt.b,{draggableId:a.id,index:i,style:{border:"solid 1px lightgray",marginTop:3},children:function(i,n){return Object(we.jsxs)("div",Object(d.a)(Object(d.a)({ref:i.innerRef},i.draggableProps),{},{style:Gt(n.isDragging,i.draggableProps.style),className:"p-shadow-1",children:[Object(we.jsxs)("div",{style:{marginBottom:5},children:[Object(we.jsxs)("div",{style:{float:"left",paddingTop:6},children:[Object(we.jsx)("span",{style:{paddingLeft:"15px"},children:a.id}),Object(we.jsx)("span",Object(d.a)(Object(d.a)({},i.dragHandleProps),{},{children:Object(we.jsx)("i",{className:"fas fa-arrows-alt",style:{float:"left",paddingTop:3}})}))]}),Object(we.jsxs)("div",{style:{textAlign:"right"},children:[Object(we.jsx)(nt.a,{type:"text",icon:"pi pi-trash",className:"p-button-rounded p-button-text p-button-danger",tooltip:"Eliminar campo",tooltipOptions:{position:"bottom"},onClick:function(i){i.preventDefault(),Object(Dt.a)({target:i.currentTarget,message:"Tem a certeza que pretende eliminar?",icon:"pi pi-exclamation-triangle",acceptLabel:"Sim",rejectLabel:"N\xe3o",accept:function(){var i=Object(d.a)({},t);delete i[a.id],e.onChange(i)}})}}),Object(we.jsx)(nt.a,{type:"text",icon:"pi pi-pencil",className:"p-button-rounded p-button-text p-button-warning",tooltip:"Editar campo",tooltipOptions:{position:"bottom"},onClick:function(e){e.preventDefault(),r(Object(d.a)(Object(d.a)({},a.data),{},{key:a.id})),j(!0)}})]})]}),l&&Object(we.jsx)(Ra,{data:c,show:l,onHide:b,onSave:p}),Object(we.jsxs)("div",{className:"p-fluid p-pt-2",children:[Object(we.jsxs)("div",{className:"p-field p-grid p-mb-0",children:[Object(we.jsx)("div",{class:"p-col-10",children:Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsx)("label",{className:"p-col-12 p-md-2",children:Object(we.jsx)("strong",{children:"T\xedtulo: "})}),Object(we.jsx)("div",{className:"p-col-12 p-md-10",children:Object(we.jsx)("span",{children:a.data.title})})]})}),Object(we.jsx)("div",{class:"p-col-2",children:Object(we.jsx)("div",{className:"p-grid",children:Object(we.jsxs)("div",{className:"p-field-checkbox",children:[Object(we.jsx)(Qt.a,{checked:a.data.active,disabled:!0}),Object(we.jsx)("label",{children:"Ativo"})]})})})]}),Object(we.jsx)("div",{className:"p-field p-grid",children:Object(we.jsx)("div",{class:"p-col-12",children:Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsx)("label",{className:"p-col-12 p-md-2",children:Object(we.jsx)("strong",{children:"Cabe\xe7alho: "})}),Object(we.jsx)("div",{className:"p-col-12 p-md-10",children:Object(we.jsx)("span",{children:a.data.header})})]})})}),Object(we.jsx)("div",{className:"p-field p-grid",children:Object(we.jsx)("div",{class:"p-col-12",children:Object(we.jsxs)("div",{className:"p-field-checkbox",children:[Object(we.jsx)(Qt.a,{checked:a.data.required,disabled:!0}),Object(we.jsx)("label",{children:"Preenchimento obrigat\xf3rio"})]})})})]})]}))}},a.id)})),a.placeholder]})}})})},Ia=function(e){Object(It.a)(a,e);var t=Object(Tt.a)(a);function a(e){var i;return Object(Pt.a)(this,a),(i=t.call(this,e)).state={data:e.data||{},showGroupForm:!1,showFieldForm:!1},i.onDragEnd=i.onDragEnd.bind(Object(At.a)(i)),i.onChange=e.onChange.bind(Object(At.a)(i)),i.onFieldsChange=i.onFieldsChange.bind(Object(At.a)(i)),i.onGroupFieldsChange=i.onGroupFieldsChange.bind(Object(At.a)(i)),i.groupEdition={},i.onGroupFormHide=i.onGroupFormHide.bind(Object(At.a)(i)),i.onGroupFormSave=i.onGroupFormSave.bind(Object(At.a)(i)),i.fieldEdition={},i.onFieldFormHide=i.onFieldFormHide.bind(Object(At.a)(i)),i.onFieldFormSave=i.onFieldFormSave.bind(Object(At.a)(i)),i}return Object(Lt.a)(a,[{key:"componentWillReceiveProps",value:function(e){this.setState({data:e.data})}},{key:"onDragEnd",value:function(e){if(e.destination)if("GROUPS"===e.type){var t=function(e,t,a){var i=Object.entries(e).map((function(e,t){return Object(d.a)({id:e[0]},e[1])})),c=i.splice(t,1),n=Object(u.a)(c,1)[0];i.splice(a,0,n);var r={};return i.forEach((function(e){r[e.id]={active:e.active,title:e.title,fields:e.fields}})),r}(this.state.data.groups,e.source.index,e.destination.index);this.onChange(Object(d.a)(Object(d.a)({},this.state.data),{},{groups:t}))}else if("FIELDS"===e.type){var a=Ut(this.state.data.fields,e.source.index,e.destination.index);this.onChange(Object(d.a)(Object(d.a)({},this.state.data),{},{fields:a}))}else{var i=Ut(this.state.data.groups[e.type].fields,e.source.index,e.destination.index),c=JSON.parse(JSON.stringify(this.state.data.groups));c[e.type].fields=i,this.onChange(Object(d.a)(Object(d.a)({},this.state.data),{},{groups:c}))}}},{key:"onGroupFormHide",value:function(){this.setState(Object(d.a)(Object(d.a)({},this.state),{},{showGroupForm:!1}))}},{key:"onGroupFormSave",value:function(e){var t=e.key;if(this.groupEdition.key===t||!this.state.data.groups[t]){var a,i=Object(d.a)({},this.state.data.groups);i[t]&&delete i[t],i=Object(d.a)(Object($e.a)({},t,{active:(a=e).active,title:a.title,fields:a.fields}),i),this.setState(Object(d.a)(Object(d.a)({},this.state),{},{showGroupForm:!1})),this.onChange(Object(d.a)(Object(d.a)({},this.state.data),{},{groups:i}))}}},{key:"onGroupFieldsChange",value:function(e,t){var a=Object(d.a)({},this.state.data.groups);a[e]&&(a[e].fields=t,this.onChange(Object(d.a)(Object(d.a)({},this.state.data),{},{groups:a})))}},{key:"onFieldsChange",value:function(e){this.onChange(Object(d.a)(Object(d.a)({},this.state.data),{},{fields:Object(d.a)({},e)}))}},{key:"onFieldFormHide",value:function(){this.setState(Object(d.a)(Object(d.a)({},this.state),{},{showFieldForm:!1}))}},{key:"onFieldFormSave",value:function(e){var t,a,i=e.groupId,c=e.key;if(i){if(this.fieldEdition.key!==c&&this.state.data.groups[i].fields[c])return;var n=Object(d.a)({},this.state.data.groups);n[i].fields[c]&&delete n[i].fields[c],n[i].fields=Object(d.a)(Object($e.a)({},c,{active:(a=e).active,title:a.title,header:a.header,required:a.required}),n[i].fields),this.setState(Object(d.a)(Object(d.a)({},this.state),{},{showFieldForm:!1})),this.onChange(Object(d.a)(Object(d.a)({},this.state.data),{},{groups:n}))}else{if(this.fieldEdition.key!==c&&this.state.data.fields[c])return;var r=Object(d.a)({},this.state.data.fields);r[c]&&delete r[c],r=Object(d.a)(Object($e.a)({},c,{active:(t=e).active,title:t.title,header:t.header,required:t.required}),r),this.setState(Object(d.a)(Object(d.a)({},this.state),{},{showFieldForm:!1})),this.onChange(Object(d.a)(Object(d.a)({},this.state.data),{},{fields:r}))}}},{key:"render",value:function(){var e=this;return Object(we.jsxs)("div",{className:"p-fluid p-formgrid p-grid",children:[this.state.showFieldForm&&Object(we.jsx)(Ra,{data:this.fieldEdition,show:this.state.showFieldForm,onHide:this.onFieldFormHide,onSave:this.onFieldFormSave}),Object(we.jsx)("div",{className:"p-field p-col-12 p-md-6",children:Object(we.jsx)(Ke.a,{header:"Campos",children:Object(we.jsxs)("div",{class:"p-col-12",children:[Object(we.jsx)("div",{children:Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsx)("div",{className:"p-col-12 p-md-8"}),Object(we.jsx)("div",{className:"p-col-12 p-md-4 p-mt-2 p-mb-2",children:Object(we.jsx)(nt.a,{type:"button",label:"Novo Campo",icon:"pi pi-list",className:"p-button-outlined",onClick:function(){e.fieldEdition={key:null,active:!0,title:null,header:null},e.setState(Object(d.a)(Object(d.a)({},e.state),{},{showFieldForm:!0}))}})})]})}),Object(we.jsx)(Aa,{fields:this.state.data.fields||{},onDragEnd:this.onDragEnd,onChange:this.onFieldsChange})]})})}),Object(we.jsx)("div",{className:"p-field p-col-12 p-md-6",children:Object(we.jsx)(Ke.a,{header:"Grupos",children:Object(we.jsxs)("div",{class:"p-col-12",children:[Object(we.jsxs)("div",{children:[this.state.showGroupForm&&Object(we.jsx)(Pa,{data:this.groupEdition,show:this.state.showGroupForm,onHide:this.onGroupFormHide,onSave:this.onGroupFormSave}),Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsx)("div",{className:"p-col-12 p-md-8"}),Object(we.jsx)("div",{className:"p-col-12 p-md-4 p-mt-2 p-mb-2",children:Object(we.jsx)(nt.a,{type:"button",label:"Novo Grupo",icon:"pi pi-list",className:"p-button-outlined",onClick:function(){e.groupEdition={key:null,active:!0,title:null,fields:{}},e.setState(Object(d.a)(Object(d.a)({},e.state),{},{showGroupForm:!0}))}})})]})]}),Object(we.jsx)(Mt.a,{onDragEnd:this.onDragEnd,children:Object(we.jsx)(Mt.c,{droppableId:"droppable",type:"GROUPS",children:function(t,a){return Object(we.jsxs)("div",{ref:t.innerRef,style:(i=a.isDraggingOver,{background:i?"lightgray":"none",padding:8}),children:[0===Object.keys(e.state.data.groups||{}).length&&Object(we.jsx)("div",{className:"p-fluid",children:Object(we.jsx)("div",{className:"p-col-12",children:Object(we.jsx)(lt.a,{severity:"info",text:"Clique em 'Novo Grupo' para adicionar um grupo"})})}),Object.entries(e.state.data.groups).map((function(e,t){return{id:e[0],data:e[1]}})).map((function(t,a){return Object(we.jsx)(Mt.b,{draggableId:t.id,index:a,children:function(a,i){return Object(we.jsxs)("div",Object(d.a)(Object(d.a)({ref:a.innerRef},a.draggableProps),{},{style:Gt(i.isDragging,a.draggableProps.style),className:"p-shadow-1",children:[Object(we.jsxs)("div",{children:[Object(we.jsxs)("div",{style:{float:"left",paddingTop:"6px"},children:[Object(we.jsx)("span",{style:{paddingLeft:"15px"},children:t.id}),Object(we.jsx)("div",Object(d.a)(Object(d.a)({},a.dragHandleProps),{},{style:{float:"left",paddingTop:"3px"},children:Object(we.jsx)("i",{className:"fas fa-arrows-alt",style:{float:"left"}})}))]}),Object(we.jsxs)("div",{style:{textAlign:"right"},children:[Object(we.jsx)(nt.a,{type:"text",icon:"pi pi-plus-circle",className:"p-button-rounded p-button-text p-button-warning p-mr-2",tooltip:"Adicionar campo",tooltipOptions:{position:"bottom"},onClick:function(a){a.preventDefault(),e.fieldEdition={groupId:t.id,key:null,active:!0,title:null,header:null,required:!1},e.setState(Object(d.a)(Object(d.a)({},e.state),{},{showFieldForm:!0}))}}),Object(we.jsx)(nt.a,{type:"text",icon:"pi pi-trash",className:"p-button-rounded p-button-text p-button-danger",tooltip:"Eliminar grupo",tooltipOptions:{position:"bottom"},onClick:function(a){a.preventDefault(),Object(Dt.a)({target:a.currentTarget,message:"Tem a certeza que pretende eliminar?",icon:"pi pi-exclamation-triangle",acceptLabel:"Sim",rejectLabel:"N\xe3o",accept:function(){var a=Object(d.a)({},e.state.data.groups);a[t.id]&&delete a[t.id],e.onChange(Object(d.a)(Object(d.a)({},e.state.data),{},{groups:a}))}})}}),Object(we.jsx)(nt.a,{type:"text",icon:"pi pi-pencil",className:"p-button-rounded p-button-text p-button-warning",tooltip:"Editar grupo",tooltipOptions:{position:"bottom"},onClick:function(a){a.preventDefault(),e.groupEdition=Object(d.a)({key:t.id},t.data),e.setState(Object(d.a)(Object(d.a)({},e.state),{},{showGroupForm:!0}))}})]})]}),Object(we.jsx)("div",{children:Object(we.jsx)("hr",{className:"p-mt-1 p-pb-3"})}),Object(we.jsxs)("div",{className:"p-fluid",children:[Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsx)("div",{class:"p-col-10",children:Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsx)("label",{className:"p-col-12 p-md-2",children:Object(we.jsx)("strong",{children:"T\xedtulo: "})}),Object(we.jsx)("div",{className:"p-col-12 p-md-10",children:Object(we.jsx)("span",{children:t.data.title})})]})}),Object(we.jsx)("div",{class:"p-col-2",children:Object(we.jsx)("div",{className:"p-grid",children:Object(we.jsxs)("div",{className:"p-field-checkbox",children:[Object(we.jsx)(Qt.a,{checked:!0,disabled:!0}),Object(we.jsx)("label",{children:"Ativo"})]})})})]}),Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsx)("label",{className:"p-col-12",children:Object(we.jsx)("strong",{children:"Campos:"})}),Object(we.jsx)("div",{className:"p-col-12",children:Object(we.jsx)(La,{groupNum:t.id,group:t,onChange:e.onGroupFieldsChange})})]})]})]}))}},t.id)})),t.placeholder]});var i}})})]})})})]})}}]),a}(n.Component),Ta=function(e){var t=Object(et.b)({defaultValues:Object(d.a)({},e.data)}),a=(t.register,t.handleSubmit),i=t.control,c=(t.reset,t.formState.errors),n=function(e,t){if(e&&e[t])return"maxLength"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:"O n\xfamero de caracteres \xe9 superior \xe0 dimens\xe3o m\xe1xima permitida"}):"pattern"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:"Formato n\xe3o permitido"}):Object(we.jsx)("small",{className:"p-error",children:e[t].message})};return Object(we.jsx)(ta.a,{header:"Edi\xe7\xe3o de Layout",visible:e.show,style:{width:"50vw"},footer:function(t){return Object(we.jsxs)("div",{className:"p-mt-4",children:[Object(we.jsx)(nt.a,{label:"Fechar",icon:"pi pi-times",onClick:function(){return e.onHide()},className:"p-button-text"}),Object(we.jsx)(nt.a,{label:"Gravar",icon:"pi pi-check",onClick:a((function(t){return a=t,void e.onSave(a);var a})),autoFocus:!0})]})},onHide:function(){e.onHide()},children:Object(we.jsx)("form",{children:Object(we.jsxs)("div",{className:"p-fluid p-formgrid p-grid",children:[Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-6",children:[Object(we.jsx)("label",{htmlFor:"format",children:"Formato"}),Object(we.jsx)(et.a,{name:"format",control:i,rules:{required:"Campo obrigat\xf3rio."},render:function(t){var a=t.field;return Object(we.jsx)(Ve.a,Object(d.a)(Object(d.a)({id:"format"},a),{},{options:e.pageFormatList.map((function(e){return{label:e,value:e}})),onChange:function(e){return a.onChange(e.value)},className:Object(dt.a)({"p-invalid":c.format})}))}}),n(c,"format")]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-6",children:[Object(we.jsx)("label",{htmlFor:"orientation",children:"Orienta\xe7\xe3o"}),Object(we.jsx)(et.a,{name:"orientation",control:i,rules:{required:"Campo obrigat\xf3rio."},render:function(t){var a=t.field;return Object(we.jsx)(Ve.a,Object(d.a)(Object(d.a)({id:"orientation"},a),{},{options:e.pageOrientationList.map((function(e){return{label:e,value:e}})),onChange:function(e){return a.onChange(e.value)},className:Object(dt.a)({"p-invalid":c.format})}))}}),n(c,"orientation")]}),Object(we.jsxs)("div",{className:"p-field p-col-12",children:[Object(we.jsx)("label",{htmlFor:"config",children:"Configura\xe7\xe3o"}),Object(we.jsx)("div",{id:"editor-parent",children:Object(we.jsx)(et.a,{control:i,name:"config",render:function(e){var t=e.field;return Object(we.jsx)(Rt.a,Object(d.a)(Object(d.a)({mode:"json",theme:"github",onLoad:function(e){e.container.style.setProperty("width",document.getElementById("editor-parent").offsetWidth-50+"px")}},t),{},{onChange:function(e){t.onChange(e)},value:t.value,name:"layout-config",editorProps:{$blockScrolling:!0},setOptions:{tabSize:2}}))}})})]})]})})})},Da=function(e){var t=Object(n.useState)(e.data?Object(Ge.a)(e.data):[]),a=Object(u.a)(t,2),i=a[0],c=a[1],s=Object(n.useState)(null),o=Object(u.a)(s,2),l=o[0],j=o[1],b=Object(n.useState)(),p=Object(u.a)(b,2),m=p[0],O=p[1],f=Object(n.useState)(!1),h=Object(u.a)(f,2),v=h[0],g=h[1],x=Object(n.useRef)(null),y=Object(n.useRef)(null);Object(n.useEffect)((function(){null!==e&&void 0!==e&&e.data&&c(e.data.map((function(e){return Object(d.a)(Object(d.a)({},e),{},{key:N()})})))}),[e.data]);var N=function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=0;a<5;a++)e+=t.charAt(Math.floor(Math.random()*t.length));return e},_=function(e){O(Object(d.a)({},e)),g(!0)};return Object(we.jsxs)("div",{children:[Object(we.jsx)(tt.a,{ref:x,baseZIndex:2e3}),v&&Object(we.jsx)(Ta,{data:m,pageFormatList:e.pageFormatList,pageOrientationList:e.pageOrientationList,show:v,onHide:function(){g(!1),O(null)},onSave:function(t){console.log(t);var a=Object(Ge.a)(i),c=Object(d.a)({},t);t.key?a[function(e){for(var t=-1,a=0;a<i.length;a++)if(i[a].key===e){t=a;break}return t}(t.key)]=c:(c.key=N(),a.push(c));e.onChange(a.map((function(e){return{id:(t=e).id,format:t.format,orientation:t.orientation,config:t.config};var t}))),j([]),g(!1)}}),Object(we.jsxs)("div",{className:"card",children:[Object(we.jsx)(ct.a,{className:"p-mb-4",left:function(){return null},right:function(){return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{type:"button",label:"Novo",icon:"pi pi-plus",className:"p-button-success p-mr-2",onClick:function(){_({key:""})}}),Object(we.jsx)(nt.a,{type:"button",label:"Eliminar",icon:"pi pi-trash",className:"p-button-danger",disabled:!l||!l.length,onClick:function(t){!function(t){Object(Dt.a)({target:t.currentTarget,message:"Tem a certeza que pretende eliminar todos os layouts selecionados?",icon:"pi pi-exclamation-triangle",acceptLabel:"Sim",rejectLabel:"N\xe3o",accept:function(){var t=l.map((function(e){return e.key})),a=i.filter((function(e){return!t.includes(e.key)}));e.onChange(a.map((function(e){return{id:(t=e).id,format:t.format,orientation:t.orientation,config:t.config};var t}))),j([])}})}(t)}})]})}}),Object(we.jsxs)(gt.a,{ref:y,value:i||[],selection:l,onSelectionChange:function(e){return j(e.value)},emptyMessage:"N\xe3o foram encontrados registos.",children:[Object(we.jsx)(xt.a,{selectionMode:"multiple",headerStyle:{width:"3rem"}}),Object(we.jsx)(xt.a,{field:"id",header:"Id",sortable:!0,filterPlaceholder:"Id",headerStyle:{width:"6rem"}}),Object(we.jsx)(xt.a,{field:"format",header:"Formato",sortable:!0,filterPlaceholder:"Format"}),Object(we.jsx)(xt.a,{field:"orientation",header:"Orienta\xe7\xe3o",sortable:!0,filterPlaceholder:"Orienta\xe7\xe3o"}),Object(we.jsx)(xt.a,{body:function(t){return Object(we.jsxs)("div",{style:{textAlign:"right"},children:[Object(we.jsx)(nt.a,{type:"button",icon:"pi pi-pencil",className:"p-button-rounded p-button-success p-mr-2",onClick:function(e){_(t)}}),Object(we.jsx)(nt.a,{type:"button",icon:"pi pi-trash",className:"p-button-rounded p-button-warning",onClick:function(a){!function(t,a){Object(Dt.a)({target:t.currentTarget,message:"Tem a certeza que pretende eliminar?",icon:"pi pi-exclamation-triangle",acceptLabel:"Sim",rejectLabel:"N\xe3o",accept:function(){var t=i.filter((function(e){return e.key!==a.key}));console.log(t),e.onChange(t.map((function(e){return{id:(t=e).id,format:t.format,orientation:t.orientation,config:t.config};var t}))),j([])}})}(a,t)}})]})}})]})]})]})},Ma=function(e,t){return Object(Ge.a)(new Set([].concat(Object(Ge.a)(e||[]),Object(Ge.a)(t||[])))).sort((function(e,t){return e-t}))},Ua=function(e){return e?e.sort((function(e,t){return e.name.toLowerCase()<t.name.toLowerCase()?-1:e.name.toLowerCase()>t.name.toLowerCase()?1:0})):e},Ga=[{label:"Dados Base",icon:"pi pi-fw pi-home"},{label:"Configura\xe7\xe3o",icon:"pi pi-fw pi-cog"},{label:"Formul\xe1rio",icon:"pi pi-fw pi-home"},{label:"Layouts",icon:"pi pi-fw pi-home"}],qa=["A4","A3","A2","A1","A0"],Va=["Retrato","Paisagem"];var Ba=Object(l.b)((function(e){return{auth:e.auth}}))(Object(p.h)((function(e){var t,a,i,c,s,o,l=e.history,j=(e.dispatch,Object(n.useState)(!1)),b=Object(u.a)(j,2),p=(b[0],b[1],Object(n.useState)(!1)),m=Object(u.a)(p,2),O=m[0],h=m[1],v=Object(n.useState)(0),g=Object(u.a)(v,2),x=g[0],y=g[1],N=Object(n.useState)(e.data),_=Object(u.a)(N,2),C=_[0],w=_[1],S=Object(n.useState)(null!==e&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.roles?Ua(Object(Ge.a)(e.data.roles)):[]),k=Object(u.a)(S,2),E=(k[0],k[1],Object(n.useState)(null)),R=Object(u.a)(E,2),P=(R[0],R[1]),L=Object(n.useState)(null),A=Object(u.a)(L,2),I=(A[0],A[1],Object(n.useState)(null)),T=Object(u.a)(I,2),D=(T[0],T[1],Object(n.useState)("")),M=Object(u.a)(D,2),U=(M[0],M[1],Object(n.useState)(null)),G=Object(u.a)(U,2),q=(G[0],G[1]),V=Object(n.useState)(null!==C&&void 0!==C&&C.owner?{id:C.owner.id,username:C.owner.username,name:C.owner.name,active:C.owner.active}:null),B=Object(u.a)(V,2),H=(B[0],B[1]),z=Object(n.useState)(null),W=Object(u.a)(z,2),K=W[0],Z=W[1],J=Object(n.useState)(Ma([1e3,2e3,5e3,1e4,2e4,25e3,5e4],C.restrict_scales_list)),Y=Object(u.a)(J,2),$=Y[0],X=Y[1],Q=Object(n.useState)((null===(a=e.data)||void 0===a?void 0:a.form_fields)||{fields:{},groups:{}}),ee=Object(u.a)(Q,2),te=ee[0],ae=ee[1],ie=Object(n.useState)((null===(i=e.data)||void 0===i?void 0:i.layouts)||[]),ce=Object(u.a)(ie,2),ne=ce[0],re=ce[1],se=Object(n.useState)(),oe=Object(u.a)(se,2),le=oe[0],de=oe[1],ue=Object(n.useContext)(Ae).core,je=Object(n.useRef)(null),be=Object(n.useRef)(null),pe=(F(e.auth),ue.API_URL),me=Object(et.b)({defaultValues:{id:C.id,code:C.code,config_json:C.config_json,description:C.description,allow_drawing:C.allow_drawing,draw_location:C.draw_location,format:C.format,free_printing:C.free_printing,free_scale:C.free_scale,identification:C.identification,identification_fields:C.identification_fields,is_active:C.is_active,location_marking:C.location_marking,map_scale:C.map_scale,multi_geom:C.multi_geom,name:C.name,orientation:C.orientation,owner_id:C.owner_id,payment_reference:C.payment_reference,print_purpose:C.print_purpose,restrict_scales:C.restrict_scales,restrict_scales_list:C.restrict_scales_list,scale:C.scale,add_title:C.add_title,show_author:C.show_author,srid:C.srid,title:C.title}}),Oe=me.register,fe=me.control,he=me.handleSubmit,ve=me.watch,ge=me.formState.errors,xe=(me.setValue,ve("restrict_scales"));Object(n.useEffect)((function(){var t={pagination:{page:1,perPage:1e3},sort:{field:"name",order:"Asc"},filter:{}};Promise.all([Qe(pe+"/security").getList("roles",t).catch((function(e){return e})),Qe(pe+"/security").getList("users",t).catch((function(e){return e})),Qe(pe+"/portal/lists").getList("coordinate_systems",t).catch((function(e){return e}))]).then((function(t){var a,i,c,n=t[0],r=null!==e&&void 0!==e&&null!==(a=e.data)&&void 0!==a&&a.roles?e.data.roles.map((function(e){return e.id})):[];if(P(Ua(n.data.filter((function(e){return!r.includes(e.id)})).map((function(e){return{id:e.id,name:e.name}})))),q(t[1].data.map((function(e){return{id:e.id,username:e.username,name:e.name,active:e.active}}))),null===e||void 0===e||null===(i=e.data)||void 0===i||!i.id){var s=t[1].data.find((function(t){return t.email===e.auth.data.username}));s&&H({id:s.id,username:s.username,name:s.name,active:s.active})}var o=(null===(c=t[2])||void 0===c?void 0:c.data)||[];Z(o.map((function(e){return{value:parseInt(e.config_json.srid),label:e.config_json.title}})))})).catch((function(e){console.log(e)}))}),[]);var ye=function(){var e={pathname:l.location.state.from,state:{searchParams:Object(d.a)({},l.location.state.previousSearchParams)}};l.replace(e)},Ne=function(e,t){if(e&&e[t])return"maxLength"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:"O n\xfamero de caracteres \xe9 superior \xe0 dimens\xe3o m\xe1xima permitida"}):"pattern"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:"Formato n\xe3o permitido"}):Object(we.jsx)("small",{className:"p-error",children:e[t].message})};return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(St.a,{model:Ga,activeIndex:x,onTabChange:function(e){return y(e.index)}}),Object(we.jsx)(Ft.a,{ref:be,showCloseIcon:!0,dismissable:!0,children:Object(we.jsxs)("div",{className:"p-fluid p-grid",children:[Object(we.jsx)("label",{children:"Adicionar escala"}),Object(we.jsx)(Xt.a,{id:"addScale",onChange:function(e){"Enter"!==e.originalEvent.key&&13!==e.originalEvent.keyCode||e.value&&(X([].concat(Object(Ge.a)($),[e.value]).sort((function(e,t){return e-t}))),be.current.hide())},mask:"1:9?99999999",unmask:!0,autoClear:!1})]})}),Object(we.jsxs)("form",{onSubmit:he((function(e){var t=Object(d.a)(Object(d.a)({},e),{},{form_fields:te?Object(d.a)({},te):{},layouts:ne?Object(Ge.a)(ne):[]});le&&(t=Object(d.a)(Object(d.a)({},t),le)),h(!0);var a=Qe(pe+"/portal");if(C.id){var i={id:C.id,data:Object(d.a)({},t)};a.update("prints",i).then((function(e){je.current.show({life:3e3,severity:"success",summary:"Editar Registo",detail:"Registo alterado com sucesso"}),re(null!==e&&void 0!==e&&e.data?Object(Ge.a)(e.data.layouts||[]):[])})).catch((function(e){je.current.show({life:3e3,severity:"error",summary:"Editar Registo",detail:"Ocorreu um erro ao alterar o registo"})})).finally((function(){h(!1)}))}else{var c={data:Object(d.a)({},t)};a.create("prints",c).then((function(e){w(Object(d.a)(Object(d.a)({},C),{},{id:e.data.id})),re(null!==e&&void 0!==e&&e.data?Object(Ge.a)(e.data.layouts||[]):[]),je.current.show({life:5e3,severity:"success",summary:"Criar Registo",detail:"Registo criada com sucesso"})})).catch((function(e){je.current.show({life:5e3,severity:"error",summary:"Criar Registo",detail:"Ocorreu um erro ao criar o registo"})})).finally((function(){h(!1)}))}})),children:[Object(we.jsx)(tt.a,{ref:je,baseZIndex:2e3}),0===x?Object(we.jsx)("div",{className:"card",children:Object(we.jsxs)("div",{className:"p-fluid p-formgrid p-grid",children:[Object(we.jsxs)("div",{className:"p-field p-col-1",children:[Object(we.jsx)("label",{htmlFor:"id",children:"Id"}),Object(we.jsx)(f.a,{id:"id",type:"text",value:C.id||""})]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-2",children:[Object(we.jsx)("label",{htmlFor:"code",children:"C\xf3digo"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"code",name:"code"},Oe("code",{required:"Campo obrigat\xf3rio."})),{},{autoFocus:!0,className:Object(dt.a)({"p-invalid":ge.code})})),Ne(ge,"code")]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-7",children:[Object(we.jsx)("label",{htmlFor:"name",children:"Designa\xe7\xe3o"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"name",name:"name"},Oe("name",{required:"Campo obrigat\xf3rio."})),{},{autoFocus:!0,className:Object(dt.a)({"p-invalid":ge.name})})),Ne(ge,"name")]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-2",children:[Object(we.jsx)("label",{children:"\xa0"}),Object(we.jsx)(et.a,{control:fe,name:"is_active",render:function(e){var t=e.field;return Object(we.jsx)(it.a,Object(d.a)(Object(d.a)({},t),{},{checked:t.value,onChange:function(e){return t.onChange(e.target.value)},onLabel:"Planta Ativa",offLabel:"Planta N\xe3o Ativa",onIcon:"pi pi-check",offIcon:"pi pi-times"}))}})]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-12",children:[Object(we.jsx)("label",{htmlFor:"name",children:"T\xedtulo"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"title",name:"title"},Oe("title",{required:"Campo obrigat\xf3rio."})),{},{autoFocus:!0,className:Object(dt.a)({"p-invalid":ge.title})})),Ne(ge,"title")]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-12",children:[Object(we.jsx)("label",{htmlFor:"name",children:"Descri\xe7\xe3o"}),Object(we.jsx)(f.a,Object(d.a)({id:"description",name:"description"},Oe("description")))]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-6",children:[Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsxs)("div",{className:"p-col p-field",children:[Object(we.jsx)("label",{htmlFor:"scale",children:"Escala"}),Object(we.jsx)(et.a,{name:"scale",control:fe,render:function(e){var t=e.field;return Object(we.jsx)(Xt.a,Object(d.a)(Object(d.a)({id:"scale"},t),{},{onChange:function(e){return t.onChange(e.value)},mask:"1:999?999999",unmask:!0,autoClear:!1}))}})]}),Object(we.jsxs)("div",{className:"p-col p-field",children:[Object(we.jsx)("label",{htmlFor:"format",children:"Formato"}),Object(we.jsx)(et.a,{name:"format",control:fe,render:function(e){var t=e.field;return Object(we.jsx)(Ve.a,Object(d.a)(Object(d.a)({id:"format"},t),{},{options:qa.map((function(e){return{label:e,value:e}})),onChange:function(e){return t.onChange(e.value)},showClear:!0}))}})]}),Object(we.jsxs)("div",{className:"p-col p-field",children:[Object(we.jsx)("label",{htmlFor:"format",children:"Orienta\xe7\xe3o"}),Object(we.jsx)(et.a,{name:"orientation",control:fe,render:function(e){var t=e.field;return Object(we.jsx)(Ve.a,Object(d.a)(Object(d.a)({id:"orientation"},t),{},{options:Va.map((function(e){return{label:e,value:e}})),onChange:function(e){return t.onChange(e.value)},showClear:!0}))}})]})]}),Object(we.jsx)("div",{className:"p-grid",children:Object(we.jsxs)("div",{className:"p-col p-field",children:[Object(we.jsx)("label",{htmlFor:"format",children:"Sistema de Coordenadas"}),Object(we.jsx)(et.a,{name:"srid",control:fe,rules:{required:"Campo obrigat\xf3rio."},render:function(e){var t=e.field;return Object(we.jsx)(Ve.a,Object(d.a)(Object(d.a)({id:"srid"},t),{},{options:K,onChange:function(e){return t.onChange(e.value)},className:Object(dt.a)({"p-invalid":ge.srid})}))}}),Ne(ge,"srid")]})})]}),Object(we.jsx)("div",{className:"p-field p-col-12 p-md-6",children:Object(we.jsx)(Ke.a,{header:"Filtro Geogr\xe1fico",children:Object(we.jsx)(Fa,{data:le?{geometryWKT:le.geom_filter,geometrySRID:le.geom_filter_srid,tolerance:le.tolerance_filter}:{geometryWKT:null===(c=e.data)||void 0===c?void 0:c.geom_filter,geometrySRID:null===(s=e.data)||void 0===s?void 0:s.geom_filter_srid,tolerance:null===(o=e.data)||void 0===o?void 0:o.tolerance_filter},coordinateSystems:e.coordinateSystems,onSave:function(e){var t={geom_filter:e.geometryWKT,geom_filter_srid:e.geometrySRID,tolerance_filter:e.tolerance};de(t)}})})}),Object(we.jsx)("div",{className:"p-field p-col-12 p-md-6",children:Object(we.jsxs)(Ke.a,{header:"Op\xe7\xf5es de Escalas",children:[Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsxs)("div",{className:"p-col p-field p-mt-2",children:[Object(we.jsx)(et.a,{name:"free_scale",control:fe,render:function(e){var t=e.field;return Object(we.jsx)(Qt.a,Object(d.a)(Object(d.a)({id:"free_scale"},t),{},{onChange:function(e){return t.onChange(!e.value)},checked:t.value,className:"p-mr-2",style:{float:"left"}}))}}),Object(we.jsx)("label",{htmlFor:"map_scale",className:"p-checkbox-label",style:{display:"inline"},children:"Escala livre"})]}),Object(we.jsxs)("div",{className:"p-col p-field p-mt-2",children:[Object(we.jsx)(et.a,{name:"map_scale",control:fe,render:function(e){var t=e.field;return Object(we.jsx)(Qt.a,Object(d.a)(Object(d.a)({id:"map_scale"},t),{},{onChange:function(e){return t.onChange(!e.value)},checked:t.value,className:"p-mr-2",style:{float:"left"}}))}}),Object(we.jsx)("label",{htmlFor:"map_scale",className:"p-checkbox-label",style:{display:"inline"},children:"Escala do mapa"})]})]}),Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsxs)("div",{className:"p-col p-field p-mt-3",children:[Object(we.jsx)(et.a,{name:"restrict_scales",control:fe,render:function(e){var t=e.field;return Object(we.jsx)(Qt.a,Object(d.a)(Object(d.a)({id:"restrict_scales"},t),{},{onChange:function(e){return t.onChange(!e.value)},checked:t.value,className:"p-mr-2",style:{float:"left"}}))}}),Object(we.jsx)("label",{htmlFor:"cb1",className:"p-checkbox-label",style:{display:"inline"},children:"Escalas restritas"})]}),xe&&Object(we.jsx)("div",{className:"p-col p-field p-mt-2",children:Object(we.jsxs)("div",{className:"p-inputgroup",children:[Object(we.jsx)(et.a,{name:"restrict_scales_list",control:fe,render:function(e){var t=e.field;return Object(we.jsx)(st.a,Object(d.a)(Object(d.a)({id:"restrict_scales_list"},t),{},{value:t.value,options:$.map((function(e){return{value:e,name:"1:"+e}})),onChange:function(e){return t.onChange(e.value)},optionValue:"value",optionLabel:"name",selectedItemsLabel:"{0} escalas selecionadas"}))}}),Object(we.jsx)(nt.a,{type:"button",icon:"pi pi-ellipsis-v",className:"p-button-primary",onClick:function(e){return be.current.toggle(e)}})]})})]})]})}),Object(we.jsx)("div",{className:"p-field p-col-12 p-md-6",children:Object(we.jsx)(Ke.a,{header:"Op\xe7\xf5es de impress\xe3o",className:"p-pb-1",children:Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsxs)("div",{className:"p-col p-field p-mt-2",children:[Object(we.jsx)(et.a,{name:"identification",control:fe,render:function(e){var t=e.field;return Object(we.jsx)(Qt.a,Object(d.a)(Object(d.a)({id:"identification"},t),{},{onChange:function(e){return t.onChange(!e.value)},checked:t.value,className:"p-mr-2",style:{float:"left"}}))}}),Object(we.jsx)("label",{htmlFor:"identification",className:"p-checkbox-label",style:{display:"inline"},children:"Identifica\xe7\xe3o obrigat\xf3ria"})]}),Object(we.jsxs)("div",{className:"p-col p-field p-mt-2",children:[Object(we.jsx)(et.a,{name:"add_title",control:fe,render:function(e){var t=e.field;return Object(we.jsx)(Qt.a,Object(d.a)(Object(d.a)({id:"add_title"},t),{},{onChange:function(e){return t.onChange(!e.value)},checked:t.value,className:"p-mr-2",style:{float:"left"}}))}}),Object(we.jsx)("label",{htmlFor:"add_title",className:"p-checkbox-label",style:{display:"inline"},children:"Adicionar t\xedtulo"})]}),Object(we.jsxs)("div",{className:"p-col p-field p-mt-2",children:[Object(we.jsx)(et.a,{name:"free_printing",control:fe,render:function(e){var t=e.field;return Object(we.jsx)(Qt.a,Object(d.a)(Object(d.a)({id:"free_printing"},t),{},{onChange:function(e){return t.onChange(!e.value)},checked:t.value,className:"p-mr-2",style:{float:"left"}}))}}),Object(we.jsx)("label",{htmlFor:"free_printing",className:"p-checkbox-label",style:{display:"inline"},children:"Emiss\xe3o livre"})]})]})})}),Object(we.jsx)("div",{className:"p-field p-col-12 p-md-6",children:Object(we.jsxs)(Ke.a,{header:"Marca\xe7\xe3o de local e geometrias",className:"p-mt-2",children:[Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsxs)("div",{className:"p-col p-field p-mt-2",children:[Object(we.jsx)(et.a,{name:"allow_drawing",control:fe,render:function(e){var t=e.field;return Object(we.jsx)(Qt.a,Object(d.a)(Object(d.a)({id:"allow_drawing"},t),{},{onChange:function(e){return t.onChange(!e.value)},checked:t.value,className:"p-mr-2",style:{float:"left"}}))}}),Object(we.jsx)("label",{htmlFor:"allow_drawing",className:"p-checkbox-label",style:{display:"inline"},children:"Permitir desenhar"})]}),Object(we.jsxs)("div",{className:"p-col p-field p-mt-2",children:[Object(we.jsx)(et.a,{name:"location_marking",control:fe,render:function(e){var t=e.field;return Object(we.jsx)(Qt.a,Object(d.a)(Object(d.a)({id:"location_marking"},t),{},{onChange:function(e){return t.onChange(!e.value)},checked:t.value,className:"p-mr-2",style:{float:"left"}}))}}),Object(we.jsx)("label",{htmlFor:"location_marking",className:"p-checkbox-label",style:{display:"inline"},children:"Obrigat\xf3rio marcar local"})]})]}),Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsxs)("div",{className:"p-col p-field p-mt-2",children:[Object(we.jsx)(et.a,{name:"draw_location",control:fe,render:function(e){var t=e.field;return Object(we.jsx)(Qt.a,Object(d.a)(Object(d.a)({id:"draw_location"},t),{},{onChange:function(e){return t.onChange(!e.value)},checked:t.value,className:"p-mr-2",style:{float:"left"}}))}}),Object(we.jsx)("label",{htmlFor:"cb1",className:"p-checkbox-label",style:{display:"inline"},children:"Desenhar local"})]}),Object(we.jsxs)("div",{className:"p-col p-field p-mt-2",children:[Object(we.jsx)(et.a,{name:"multi_geom",control:fe,render:function(e){var t=e.field;return Object(we.jsx)(Qt.a,Object(d.a)(Object(d.a)({id:"multi_geom"},t),{},{onChange:function(e){return t.onChange(!e.value)},checked:t.value,className:"p-mr-2",style:{float:"left"}}))}}),Object(we.jsx)("label",{htmlFor:"cb1",className:"p-checkbox-label",style:{display:"inline"},children:"M\xfaltiplas geometrias"})]})]})]})})]})}):null,1===x?Object(we.jsx)("div",{className:"card",children:Object(we.jsxs)("div",{className:"p-field p-col-12",children:[Object(we.jsx)("label",{htmlFor:"orientation",children:"Configura\xe7\xe3o"}),Object(we.jsx)("div",{id:"config-editor-parent",children:Object(we.jsx)(et.a,{control:fe,name:"config_json",render:function(e){var t=e.field;return Object(we.jsx)(Rt.a,Object(d.a)(Object(d.a)({mode:"json",theme:"github",onLoad:function(e){e.container.style.setProperty("width",document.getElementById("config-editor-parent").offsetWidth-50+"px")}},t),{},{onChange:function(e){t.onChange(e)},value:t.value,name:"print-config",editorProps:{$blockScrolling:!0},setOptions:{tabSize:2}}))}})})]})}):null,2===x?Object(we.jsx)("div",{className:"card",children:Object(we.jsx)(Ia,{data:te,onChange:function(e){ae(e)}})}):null,3===x?Object(we.jsx)("div",{className:"card",children:Object(we.jsx)("div",{className:"p-fluid p-formgrid p-grid",children:Object(we.jsx)(Da,{data:ne,pageFormatList:qa,pageOrientationList:Va,onChange:function(e){console.log(e),re(e)}})})}):null,Object(we.jsx)(ct.a,{className:"p-mt-4 p-mb-4",right:function(){return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{type:"button",label:"Voltar",icon:"pi pi-left",className:"p-button-secondary p-mr-4",disabled:!!O,onClick:ye}),Object(we.jsx)(nt.a,{type:"submit",label:"Gravar",icon:O?"pi pi-save pi-spinner":"pi pi-save",disabled:!!O})]})}})]})]})})));var Ha=Object(l.b)((function(e){return{loading:e.loading,backoffice:e.backoffice}}))(Object(p.h)((function(e){var t,a=Object(n.useContext)(Ae).core,i=(e.history,e.dispatch,Object(p.g)().id),c=Object(n.useState)(!1),s=Object(u.a)(c,2),o=(s[0],s[1]),l=Object(n.useState)(null),d=Object(u.a)(l,2),j=d[0],b=d[1],m=Object(n.useState)([]),O=Object(u.a)(m,2),f=(O[0],O[1],Object(n.useRef)(null),a.API_URL);Object(n.useEffect)((function(){i?h():b({})}),[]);var h=function(){var e=Qe(f+"/portal"),t={id:i};o(!0),e.getOne("prints",t).then((function(e){var t=e.data;t.restrict_scales_list&&("string"===typeof t.restrict_scales_list||t.restrict_scales_list instanceof String)&&(t.restrict_scales_list=t.restrict_scales_list.split(",").map((function(e){return parseInt(e)}))),b(t),o(!1)})).catch((function(e){o(!1)}))};return Object(we.jsx)(r.a.Fragment,{children:j?Object(we.jsx)(Ba,{data:j,coordinateSystems:null!==e&&void 0!==e&&null!==(t=e.backoffice)&&void 0!==t&&t.config_json&&e.backoffice.config_json.coordinate_systems||[]}):Object(we.jsx)("div",{children:"loading..."})})}))),za={filters:{},first:0,rows:20,page:0,sortField:"id",sortOrder:1};var Wa=Object(l.b)((function(e){return{loading:e.loading,filters:e.filters}}))(Object(p.h)((function(e){var t=e.history,a=e.printsFilter,i=Object(n.useContext)(Ae).core,c=Object(n.useRef)(null),s=Object(n.useState)(!1),o=Object(u.a)(s,2),l=o[0],j=o[1],b=Object(n.useState)([]),p=Object(u.a)(b,2),m=p[0],O=p[1],f=Object(n.useState)(null),h=Object(u.a)(f,2),v=h[0],g=h[1],x=Object(n.useState)(Object(d.a)({},za)),y=Object(u.a)(x,2),N=y[0],_=y[1],C=Object(n.useRef)(!1),w=Object(n.useRef)(null),S=i.store.getState().auth,k=F(S),E=i.API_URL;Object(n.useEffect)((function(){C.current&&(C.current=!0,a&&_.apply(void 0,Object(Ge.a)(a)))}),[]),Object(n.useEffect)((function(){L()}),[N]);var R=function(){var e={pathname:"/prints/create",state:{from:t.location.pathname,previousSearchParams:Object(d.a)({},N)}};t.push(e)},P=function(){Object(Jt.a)({message:" Deseja eliminar o(s) registo(s) selecionado(s)?",header:"Confirma\xe7\xe3o",icon:"pi pi-exclamation-triangle",acceptLabel:"Sim",rejectLabel:"N\xe3o",accept:function(){var e=Qe(E+"/portal"),t={ids:v.map((function(e){return e.id}))};e.deleteMany("prints",t).then((function(e){c.current.show({life:3e3,severity:"success",summary:"Eliminar Registo(s)",detail:"Registo(s) eliminado(s) com sucesso"}),L()})).catch((function(e){c.current.show({life:3e3,severity:"error",summary:"Eliminar Registo(s)",detail:"Ocorreu um erro ao eliminar o(s) registo(s)"})})).finally((function(){}))},reject:function(){}})},L=function(e){var t=Qe(E+"/portal"),a={};e?Object.entries(e).forEach((function(e){var t=Object(u.a)(e,2),i=t[0],c=t[1];a[i]=c.value})):N.filters&&Object.entries(N.filters).forEach((function(e){var t=Object(u.a)(e,2),i=t[0],c=t[1];a[i]=c.value}));var i={pagination:{page:N.page+1,perPage:N.rows},sort:{field:N.sortField,order:-1==N.sortOrder?"Desc":"Asc"},filter:a};j(!0),t.getList("prints",i).then((function(e){g(null),O(Object(d.a)(Object(d.a)({},e),{},{page:N.page})),j(!1)})).catch((function(e){j(!1),c.current.show({life:5e3,severity:"error",summary:"Pesquisa de Plantas",detail:"Ocorreu um erro na pesquisa"})}))},A=function(e){_(Object(d.a)({},za))};return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)("div",{className:"p-col-12",children:Object(we.jsx)("h3",{children:"Emiss\xe3o de Plantas - Plantas"})}),Object(we.jsxs)("div",{className:"p-grid p-fluid print-list",children:[Object(we.jsx)(tt.a,{ref:c,baseZIndex:2e3}),Object(we.jsxs)("div",{className:"card",children:[Object(we.jsx)(ct.a,{className:"p-mb-4",left:function(){return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{label:"Novo",icon:"pi pi-plus",className:"p-button-success p-mr-2",onClick:R}),Object(we.jsx)(nt.a,{label:"Eliminar",icon:"pi pi-trash",className:"p-button-danger",onClick:P,disabled:!v||!v.length})]})},right:function(){return Object(we.jsx)(r.a.Fragment,{children:Object(we.jsx)(nt.a,{label:"Limpar",icon:"pi pi-times",className:"p-button-help p-mr-2",onClick:A})})}}),Object(we.jsxs)(gt.a,{ref:w,value:m?m.data:[],lazy:!0,selectionMode:"checkbox",selection:v,onSelectionChange:function(e){return g(e.value)},paginator:!0,first:N.first,rows:N.rows,totalRecords:m.total,onPage:function(e){var t=Object(d.a)(Object(d.a)({},N),e);_(t)},onSort:function(e){var t=Object(d.a)(Object(d.a)({},N),e);_(t)},sortField:N.sortField,sortOrder:N.sortOrder,filters:N.filters,onFilter:function(e){var t=Object(d.a)(Object(d.a)({},N),e);t.first=0,_(t)},loading:l,emptyMessage:"N\xe3o foram encontrados registos.",children:[Object(we.jsx)(xt.a,{selectionMode:"multiple",headerStyle:{width:"3rem"}}),Object(we.jsx)(xt.a,{field:"id",header:"Id",sortable:!0,filter:!0,filterPlaceholder:"Id",headerStyle:{width:"6rem"}}),Object(we.jsx)(xt.a,{field:"code",header:"C\xf3digo",sortable:!0,filter:!0,filterPlaceholder:"C\xf3digo",style:{wordBreak:"break-all"}}),Object(we.jsx)(xt.a,{field:"name",header:"Nome",sortable:!0,filter:!0,filterPlaceholder:"Nome",style:{wordBreak:"break-all"}}),Object(we.jsx)(xt.a,{field:"title",header:"T\xedtulo",sortable:!0,filter:!0,filterPlaceholder:"T\xedtulo",style:{wordBreak:"break-all"}}),Object(we.jsx)(xt.a,{field:"groups",header:"Grupos",body:function(e){return Object(we.jsx)(r.a.Fragment,{children:e.groups&&e.groups.map((function(e){return Object(we.jsx)(yt.a,{label:e.code,className:"p-mr-2 p-mb-2"},e.id)}))})}}),Object(we.jsx)(xt.a,{field:"viewers",header:"Visualizadores",body:function(e){return Object(we.jsx)(r.a.Fragment,{children:e.viewers&&e.viewers.map((function(e){return Object(we.jsx)(yt.a,{label:e.name,className:"p-mr-2 p-mb-2"},e.id)}))})}}),k&&Object(we.jsx)(xt.a,{field:"owner",header:"Dono",body:function(e){var t,a=Object(we.jsx)(yt.a,{label:"An\xf3nimo",icon:"far fa-user",className:"p-mr-2 p-mb-2"});return(null===e||void 0===e||null===(t=e.owner)||void 0===t?void 0:t.id)>0&&(a=e.owner.active?Object(we.jsx)(yt.a,{label:e.owner.username,icon:"fas fa-user-alt",className:"p-mr-2 p-mb-2"}):Object(we.jsx)(yt.a,{label:e.owner.username,icon:"fas fa-user-alt-slash",className:"p-mr-2 p-mb-2"})),a}}),Object(we.jsx)(xt.a,{body:function(e){return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{icon:"pi pi-pencil",className:"p-button-rounded p-button-success p-mr-2",onClick:function(){return function(e){var a={pathname:"/prints/edit/".concat(e.id),state:{from:t.location.pathname,previousSearchParams:Object(d.a)({},N)}};t.push(a)}(e)}}),Object(we.jsx)(nt.a,{icon:"pi pi-trash",className:"p-button-rounded p-button-warning",onClick:function(){return t=e,void Object(Jt.a)({message:" Deseja eliminar o registo selecionado?",header:"Confirma\xe7\xe3o",icon:"pi pi-exclamation-triangle",acceptLabel:"Sim",rejectLabel:"N\xe3o",accept:function(){var e=Qe(E+"/portal"),a={id:t.id};e.delete("prints",a).then((function(e){c.current.show({life:3e3,severity:"success",summary:"Eliminar Registo",detail:"Registo eliminado com sucesso"}),L()})).catch((function(e){c.current.show({life:3e3,severity:"error",summary:"Eliminar Registo",detail:"Ocorreu um erro ao eliminar o registo"})})).finally((function(){}))},reject:function(){}});var t}})]})}})]})]})]})]})}))),Ka=function(e,t){return Object(Ge.a)(new Set([].concat(Object(Ge.a)(e||[]),Object(Ge.a)(t||[])))).sort((function(e,t){return e-t}))},Za=function(e){return e?e.sort((function(e,t){return e.name.toLowerCase()<t.name.toLowerCase()?-1:e.name.toLowerCase()>t.name.toLowerCase()?1:0})):e},Ja=[{label:"Dados Base",icon:"pi pi-fw pi-home"},{label:"Formul\xe1rio",icon:"pi pi-fw pi-home"},{label:"Layouts",icon:"pi pi-fw pi-home"},{label:"Plantas e Grupos",icon:"pi pi-fw pi-cog"}],Ya=["A4","A3","A2","A1","A0"],$a=["Retrato","Paisagem"];var Xa=Object(l.b)((function(e){return{auth:e.auth}}))(Object(p.h)((function(e){var t,a,i,c,s,o,l,j,b=e.history,p=(e.dispatch,Object(n.useState)(!1)),m=Object(u.a)(p,2),O=(m[0],m[1],Object(n.useState)(!1)),h=Object(u.a)(O,2),v=h[0],g=h[1],x=Object(n.useState)(0),y=Object(u.a)(x,2),N=y[0],_=y[1],C=Object(n.useState)(e.data),w=Object(u.a)(C,2),S=w[0],k=w[1],E=Object(n.useState)(null!==e&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.roles?Za(Object(Ge.a)(e.data.roles)):[]),R=Object(u.a)(E,2),P=(R[0],R[1],Object(n.useState)(null)),L=Object(u.a)(P,2),A=(L[0],L[1]),I=Object(n.useState)(null),T=Object(u.a)(I,2),D=(T[0],T[1],Object(n.useState)(null)),M=Object(u.a)(D,2),U=(M[0],M[1],Object(n.useState)("")),G=Object(u.a)(U,2),q=(G[0],G[1],Object(n.useState)(null)),V=Object(u.a)(q,2),B=(V[0],V[1]),H=Object(n.useState)(null!==S&&void 0!==S&&S.owner?{id:S.owner.id,username:S.owner.username,name:S.owner.name,active:S.owner.active}:null),z=Object(u.a)(H,2),W=(z[0],z[1]),K=Object(n.useState)([]),Z=Object(u.a)(K,2),J=(Z[0],Z[1],Object(n.useState)([])),Y=Object(u.a)(J,2),$=Y[0],X=Y[1],Q=Object(n.useState)([]),ee=Object(u.a)(Q,2),te=ee[0],ae=ee[1],ie=Object(n.useState)(Ka([1e3,2e3,5e3,1e4,2e4,25e3,5e4],S.restrict_scales_list)),ce=Object(u.a)(ie,2),ne=ce[0],re=ce[1],se=Object(n.useState)((null===(a=e.data)||void 0===a?void 0:a.form_fields)||{fields:{},groups:{}}),oe=Object(u.a)(se,2),le=oe[0],de=oe[1],ue=Object(n.useState)((null===(i=e.data)||void 0===i?void 0:i.layouts)||[]),je=Object(u.a)(ue,2),be=je[0],pe=je[1],me=Object(n.useState)({prints:(null===(c=e.data)||void 0===c?void 0:c.prints)||[],groups:(null===(s=e.data)||void 0===s?void 0:s.groups)||[]}),Oe=Object(u.a)(me,2),fe=Oe[0],he=Oe[1],ve=Object(n.useState)(),ge=Object(u.a)(ve,2),xe=ge[0],ye=ge[1],Ne=Object(n.useRef)(null),_e=Object(n.useRef)(null),Ce=Object(n.useContext)(Ae).core,Se=(F(e.auth),Ce.API_URL),ke=Object(et.b)({defaultValues:{id:S.id,code:S.code,title:S.title,description:S.description,free_scale:S.free_scale,identification:S.identification,identification_fields:S.identification_fields,is_active:S.is_active,allow_drawing:S.allow_drawing,draw_location:S.draw_location,location_marking:S.location_marking,map_scale:S.map_scale,multi_geom:S.multi_geom,owner_id:S.owner_id,payment_reference:S.payment_reference,print_purpose:S.print_purpose,restrict_scales:S.restrict_scales,restrict_scales_list:S.restrict_scales_list,add_title:S.add_title,show_author:S.show_author,select_prints:S.select_prints,group_prints:S.group_prints,show_all_prints:S.show_all_prints}}),Fe=ke.register,Ee=ke.control,Re=ke.handleSubmit,Pe=ke.watch,Le=ke.formState.errors,Ie=(ke.setValue,Pe("restrict_scales"));Object(n.useEffect)((function(){var t={pagination:{page:1,perPage:1e3},sort:{field:"name",order:"Asc"},filter:{}};Promise.all([Qe(Se+"/security").getList("roles",t).catch((function(e){return e})),Qe(Se+"/security").getList("users",t).catch((function(e){return e})),Qe(Se+"/portal").getList("prints",t).catch((function(e){return e})),Qe(Se+"/portal").getList("prints/groups",{pagination:{page:1,perPage:1e3},sort:{field:"title",order:"Asc"},filter:{}}).catch((function(e){return e}))]).then((function(t){var a,i,c,n,r=t[0],s=null!==e&&void 0!==e&&null!==(a=e.data)&&void 0!==a&&a.roles?e.data.roles.map((function(e){return e.id})):[];if(A(Za(r.data.filter((function(e){return!s.includes(e.id)})).map((function(e){return{id:e.id,name:e.name}})))),B(t[1].data.map((function(e){return{id:e.id,username:e.username,name:e.name,active:e.active}}))),null===e||void 0===e||null===(i=e.data)||void 0===i||!i.id){var o=t[1].data.find((function(t){return t.email===e.auth.data.username}));o&&W({id:o.id,username:o.username,name:o.name,active:o.active})}var l=(null===(c=t[2])||void 0===c?void 0:c.data)||[];X(l);var d=(null===(n=t[3])||void 0===n?void 0:n.data)||[];ae(d)})).catch((function(e){console.log(e)}))}),[]);var Te=function(){var e={pathname:b.location.state.from,state:{searchParams:Object(d.a)({},b.location.state.previousSearchParams)}};b.replace(e)},De=function(e,t){if(e&&e[t])return"maxLength"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:"O n\xfamero de caracteres \xe9 superior \xe0 dimens\xe3o m\xe1xima permitida"}):"pattern"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:"Formato n\xe3o permitido"}):Object(we.jsx)("small",{className:"p-error",children:e[t].message})};return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(St.a,{model:Ja,activeIndex:N,onTabChange:function(e){return _(e.index)}}),Object(we.jsx)(Ft.a,{ref:_e,showCloseIcon:!0,dismissable:!0,children:Object(we.jsxs)("div",{className:"p-fluid p-grid",children:[Object(we.jsx)("label",{children:"Adicionar escala"}),Object(we.jsx)(Xt.a,{id:"addScale",onChange:function(e){"Enter"!==e.originalEvent.key&&13!==e.originalEvent.keyCode||e.value&&(re([].concat(Object(Ge.a)(ne),[e.value]).sort((function(e,t){return e-t}))),_e.current.hide())},mask:"1:9?99999999",unmask:!0,autoClear:!1})]})}),Object(we.jsxs)("form",{onSubmit:Re((function(e){var t=Object(d.a)(Object(d.a)({},e),{},{form_fields:le?Object(d.a)({},le):{},layouts:be?Object(Ge.a)(be):[],prints:null!==fe&&void 0!==fe&&fe.prints?fe.prints:[],groups:null!==fe&&void 0!==fe&&fe.groups?fe.groups:[]});xe&&(t=Object(d.a)(Object(d.a)({},t),xe)),g(!0);var a=Qe(Se+"/portal");if(S.id){var i={id:S.id,data:Object(d.a)({},t)};a.update("prints/groups",i).then((function(e){Ne.current.show({life:3e3,severity:"success",summary:"Editar Registo",detail:"Registo alterado com sucesso"}),pe(null!==e&&void 0!==e&&e.data?Object(Ge.a)(e.data.layouts||[]):[])})).catch((function(e){Ne.current.show({life:3e3,severity:"error",summary:"Editar Registo",detail:"Ocorreu um erro ao alterar o registo"})})).finally((function(){g(!1)}))}else{var c={data:Object(d.a)({},t)};a.create("prints/groups",c).then((function(e){k(Object(d.a)(Object(d.a)({},S),{},{id:e.data.id})),pe(null!==e&&void 0!==e&&e.data?Object(Ge.a)(e.data.layouts||[]):[]),Ne.current.show({life:5e3,severity:"success",summary:"Criar Registo",detail:"Registo criada com sucesso"})})).catch((function(e){Ne.current.show({life:5e3,severity:"error",summary:"Criar Registo",detail:"Ocorreu um erro ao criar o registo"})})).finally((function(){g(!1)}))}})),children:[Object(we.jsx)(tt.a,{ref:Ne,baseZIndex:2e3}),0===N?Object(we.jsx)("div",{className:"card",children:Object(we.jsxs)("div",{className:"p-fluid p-formgrid p-grid",children:[Object(we.jsxs)("div",{className:"p-field p-col-1",children:[Object(we.jsx)("label",{htmlFor:"id",children:"Id"}),Object(we.jsx)(f.a,{id:"id",type:"text",value:S.id||""})]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-2",children:[Object(we.jsx)("label",{htmlFor:"code",children:"C\xf3digo"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"code",name:"code"},Fe("code",{required:"Campo obrigat\xf3rio."})),{},{autoFocus:!0,className:Object(dt.a)({"p-invalid":Le.code})})),De(Le,"code")]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-7",children:[Object(we.jsx)("label",{htmlFor:"name",children:"T\xedtulo"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"title",name:"title"},Fe("title",{required:"Campo obrigat\xf3rio."})),{},{autoFocus:!0,className:Object(dt.a)({"p-invalid":Le.title})})),De(Le,"title")]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-2",children:[Object(we.jsx)("label",{children:"\xa0"}),Object(we.jsx)(et.a,{control:Ee,name:"is_active",render:function(e){var t=e.field;return Object(we.jsx)(it.a,Object(d.a)(Object(d.a)({},t),{},{checked:t.value,onChange:function(e){return t.onChange(e.target.value)},onLabel:"Grupo Ativo",offLabel:"Grupo N\xe3o Ativo",onIcon:"pi pi-check",offIcon:"pi pi-times"}))}})]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-12",children:[Object(we.jsx)("label",{htmlFor:"name",children:"Descri\xe7\xe3o"}),Object(we.jsx)(f.a,Object(d.a)({id:"description",name:"description"},Fe("description")))]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-6",children:[Object(we.jsxs)(Ke.a,{header:"Op\xe7\xf5es de Escalas",children:[Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsxs)("div",{className:"p-col p-field p-mt-2",children:[Object(we.jsx)(et.a,{name:"free_scale",control:Ee,render:function(e){var t=e.field;return Object(we.jsx)(Qt.a,Object(d.a)(Object(d.a)({id:"free_scale"},t),{},{onChange:function(e){return t.onChange(!e.value)},checked:t.value,className:"p-mr-2",style:{float:"left"}}))}}),Object(we.jsx)("label",{htmlFor:"map_scale",className:"p-checkbox-label",style:{display:"inline"},children:"Escala livre"})]}),Object(we.jsxs)("div",{className:"p-col p-field p-mt-2",children:[Object(we.jsx)(et.a,{name:"map_scale",control:Ee,render:function(e){var t=e.field;return Object(we.jsx)(Qt.a,Object(d.a)(Object(d.a)({id:"map_scale"},t),{},{onChange:function(e){return t.onChange(!e.value)},checked:t.value,className:"p-mr-2",style:{float:"left"}}))}}),Object(we.jsx)("label",{htmlFor:"map_scale",className:"p-checkbox-label",style:{display:"inline"},children:"Escala do mapa"})]})]}),Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsxs)("div",{className:"p-col p-field p-mt-3",children:[Object(we.jsx)(et.a,{name:"restrict_scales",control:Ee,render:function(e){var t=e.field;return Object(we.jsx)(Qt.a,Object(d.a)(Object(d.a)({id:"restrict_scales"},t),{},{onChange:function(e){return t.onChange(!e.value)},checked:t.value,className:"p-mr-2",style:{float:"left"}}))}}),Object(we.jsx)("label",{htmlFor:"cb1",className:"p-checkbox-label",style:{display:"inline"},children:"Escalas restritas"})]}),Ie&&Object(we.jsx)("div",{className:"p-col p-field p-mt-2",children:Object(we.jsxs)("div",{className:"p-inputgroup",children:[Object(we.jsx)(et.a,{name:"restrict_scales_list",control:Ee,render:function(e){var t=e.field;return Object(we.jsx)(st.a,Object(d.a)(Object(d.a)({id:"restrict_scales_list"},t),{},{value:t.value,options:ne.map((function(e){return{value:e,name:"1:"+e}})),onChange:function(e){return t.onChange(e.value)},optionValue:"value",optionLabel:"name",selectedItemsLabel:"{0} escalas selecionadas"}))}}),Object(we.jsx)(nt.a,{type:"button",icon:"pi pi-ellipsis-v",className:"p-button-primary",onClick:function(e){return _e.current.toggle(e)}})]})})]})]}),Object(we.jsx)(Ke.a,{header:"Op\xe7\xf5es de impress\xe3o",className:"p-mt-2",children:Object(we.jsx)("div",{className:"p-grid",children:Object(we.jsxs)("div",{className:"p-col p-field p-mt-2",children:[Object(we.jsx)(et.a,{name:"identification",control:Ee,render:function(e){var t=e.field;return Object(we.jsx)(Qt.a,Object(d.a)(Object(d.a)({id:"identification"},t),{},{onChange:function(e){return t.onChange(!e.value)},checked:t.value,className:"p-mr-2",style:{float:"left"}}))}}),Object(we.jsx)("label",{htmlFor:"identification",className:"p-checkbox-label",style:{display:"inline"},children:"Identifica\xe7\xe3o obrigat\xf3ria"})]})})}),Object(we.jsxs)(Ke.a,{header:"Marca\xe7\xe3o de local e geometrias",className:"p-mt-2",children:[Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsxs)("div",{className:"p-col p-field p-mt-2",children:[Object(we.jsx)(et.a,{name:"allow_drawing",control:Ee,render:function(e){var t=e.field;return Object(we.jsx)(Qt.a,Object(d.a)(Object(d.a)({id:"allow_drawing"},t),{},{onChange:function(e){return t.onChange(!e.value)},checked:t.value,className:"p-mr-2",style:{float:"left"}}))}}),Object(we.jsx)("label",{htmlFor:"allow_drawing",className:"p-checkbox-label",style:{display:"inline"},children:"Permitir desenhar"})]}),Object(we.jsxs)("div",{className:"p-col p-field p-mt-2",children:[Object(we.jsx)(et.a,{name:"location_marking",control:Ee,render:function(e){var t=e.field;return Object(we.jsx)(Qt.a,Object(d.a)(Object(d.a)({id:"location_marking"},t),{},{onChange:function(e){return t.onChange(!e.value)},checked:t.value,className:"p-mr-2",style:{float:"left"}}))}}),Object(we.jsx)("label",{htmlFor:"location_marking",className:"p-checkbox-label",style:{display:"inline"},children:"Obrigat\xf3rio marcar local"})]})]}),Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsxs)("div",{className:"p-col p-field p-mt-2",children:[Object(we.jsx)(et.a,{name:"draw_location",control:Ee,render:function(e){var t=e.field;return Object(we.jsx)(Qt.a,Object(d.a)(Object(d.a)({id:"draw_location"},t),{},{onChange:function(e){return t.onChange(!e.value)},checked:t.value,className:"p-mr-2",style:{float:"left"}}))}}),Object(we.jsx)("label",{htmlFor:"cb1",className:"p-checkbox-label",style:{display:"inline"},children:"Desenhar local"})]}),Object(we.jsxs)("div",{className:"p-col p-field p-mt-2",children:[Object(we.jsx)(et.a,{name:"multi_geom",control:Ee,render:function(e){var t=e.field;return Object(we.jsx)(Qt.a,Object(d.a)(Object(d.a)({id:"multi_geom"},t),{},{onChange:function(e){return t.onChange(!e.value)},checked:t.value,className:"p-mr-2",style:{float:"left"}}))}}),Object(we.jsx)("label",{htmlFor:"cb1",className:"p-checkbox-label",style:{display:"inline"},children:"M\xfaltiplas geometrias"})]})]})]})]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-6",children:[Object(we.jsx)(Ke.a,{header:"Filtro Geogr\xe1fico",children:Object(we.jsx)(Fa,{data:xe?{geometryWKT:xe.geom_filter,geometrySRID:xe.geom_filter_srid,tolerance:xe.tolerance_filter}:{geometryWKT:null===(o=e.data)||void 0===o?void 0:o.geom_filter,geometrySRID:null===(l=e.data)||void 0===l?void 0:l.geom_filter_srid,tolerance:null===(j=e.data)||void 0===j?void 0:j.tolerance_filter},coordinateSystems:e.coordinateSystems,onSave:function(e){var t={geom_filter:e.geometryWKT,geom_filter_srid:e.geometrySRID,tolerance_filter:e.tolerance};ye(t)}})}),Object(we.jsxs)(Ke.a,{header:"Op\xe7\xf5es de Grupo",className:"p-mt-2",children:[Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsxs)("div",{className:"p-col p-field p-mt-2",children:[Object(we.jsx)(et.a,{name:"select_prints",control:Ee,render:function(e){var t=e.field;return Object(we.jsx)(Qt.a,Object(d.a)(Object(d.a)({id:"select_prints"},t),{},{onChange:function(e){return t.onChange(!e.value)},checked:t.value,className:"p-mr-2",style:{float:"left"}}))}}),Object(we.jsx)("label",{htmlFor:"select_prints",className:"p-checkbox-label",style:{display:"inline"},children:"Permitir selecionar plantas"})]}),Object(we.jsxs)("div",{className:"p-col p-field p-mt-2",children:[Object(we.jsx)(et.a,{name:"group_prints",control:Ee,render:function(e){var t=e.field;return Object(we.jsx)(Qt.a,Object(d.a)(Object(d.a)({id:"group_prints"},t),{},{onChange:function(e){return t.onChange(!e.value)},checked:t.value,className:"p-mr-2",style:{float:"left"}}))}}),Object(we.jsx)("label",{htmlFor:"group_prints",className:"p-checkbox-label",style:{display:"inline"},children:"Agrupar plantas"})]})]}),Object(we.jsx)("div",{className:"p-grid",children:Object(we.jsxs)("div",{className:"p-col p-field p-mt-2",children:[Object(we.jsx)(et.a,{name:"show_all_prints",control:Ee,render:function(e){var t=e.field;return Object(we.jsx)(Qt.a,Object(d.a)(Object(d.a)({id:"show_all_prints"},t),{},{onChange:function(e){return t.onChange(!e.value)},checked:t.value,className:"p-mr-2",style:{float:"left"}}))}}),Object(we.jsx)("label",{htmlFor:"show_all_prints",className:"p-checkbox-label",style:{display:"inline"},children:"Mostar filhos vazios"})]})})]})]})]})}):null,1===N?Object(we.jsx)("div",{className:"card",children:Object(we.jsx)(Ia,{data:le,onChange:function(e){de(e)}})}):null,2===N?Object(we.jsx)("div",{className:"card",children:Object(we.jsx)("div",{className:"p-fluid p-formgrid p-grid",children:Object(we.jsx)(Da,{data:be,pageFormatList:Ya,pageOrientationList:$a,onChange:function(e){pe(e)}})})}):null,3===N?Object(we.jsx)("div",{className:"card",children:Object(we.jsx)(Ht,{data:fe,printsList:$,groupsList:S.id?te.filter((function(e){return e.id!==S.id})):te,onChange:function(e){he(e)}})}):null,Object(we.jsx)(ct.a,{className:"p-mt-4 p-mb-4",right:function(){return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{type:"button",label:"Voltar",icon:"pi pi-left",className:"p-button-secondary p-mr-4",disabled:!!v,onClick:Te}),Object(we.jsx)(nt.a,{type:"submit",label:"Gravar",icon:v?"pi pi-save pi-spinner":"pi pi-save",disabled:!!v})]})}})]})]})})));var Qa=Object(l.b)((function(e){return{loading:e.loading,backoffice:e.backoffice}}))(Object(p.h)((function(e){var t,a=Object(n.useContext)(Ae).core,i=(e.history,e.dispatch,e.backoffice,Object(p.g)().id),c=Object(n.useState)(!1),s=Object(u.a)(c,2),o=(s[0],s[1]),l=Object(n.useState)(null),d=Object(u.a)(l,2),j=d[0],b=d[1],m=Object(n.useState)([]),O=Object(u.a)(m,2),f=(O[0],O[1],Object(n.useRef)(null),a.API_URL);Object(n.useEffect)((function(){i?h():b({})}),[]);var h=function(){var e=Qe(f+"/portal"),t={id:i};o(!0),e.getOne("prints/groups",t).then((function(e){var t=e.data;t.restrict_scales_list&&("string"===typeof t.restrict_scales_list||t.restrict_scales_list instanceof String)&&(t.restrict_scales_list=t.restrict_scales_list.split(",").map((function(e){return parseInt(e)}))),b(t),o(!1)})).catch((function(e){o(!1)}))};return Object(we.jsx)(r.a.Fragment,{children:j?Object(we.jsx)(Xa,{data:j,coordinateSystems:null!==e&&void 0!==e&&null!==(t=e.backoffice)&&void 0!==t&&t.config_json&&e.backoffice.config_json.coordinate_systems||[]}):Object(we.jsx)("div",{children:"loading..."})})}))),ei={filters:{},first:0,rows:20,page:0,sortField:"id",sortOrder:1};var ti=Object(l.b)((function(e){return{loading:e.loading,filters:e.filters}}))(Object(p.h)((function(e){var t=e.history,a=e.groupsFilter,i=Object(n.useContext)(Ae).core,c=Object(n.useRef)(null),s=Object(n.useState)(!1),o=Object(u.a)(s,2),l=o[0],j=o[1],b=Object(n.useState)([]),p=Object(u.a)(b,2),m=p[0],O=p[1],f=Object(n.useState)(null),h=Object(u.a)(f,2),v=h[0],g=h[1],x=Object(n.useState)(Object(d.a)({},ei)),y=Object(u.a)(x,2),N=y[0],_=y[1],C=Object(n.useRef)(!1),w=Object(n.useRef)(null),S=i.API_URL;Object(n.useEffect)((function(){C.current&&(C.current=!0,a&&_.apply(void 0,Object(Ge.a)(a)))}),[]),Object(n.useEffect)((function(){E()}),[N]);var k=function(){var e={pathname:"/prints/groups/create",state:{from:t.location.pathname,previousSearchParams:Object(d.a)({},N)}};t.push(e)},F=function(){Object(Jt.a)({message:" Deseja eliminar o(s) registo(s) selecionado(s)?",header:"Confirma\xe7\xe3o",icon:"pi pi-exclamation-triangle",acceptLabel:"Sim",rejectLabel:"N\xe3o",accept:function(){var e=Qe(S+"/portal"),t={ids:v.map((function(e){return e.id}))};e.deleteMany("prints/groups",t).then((function(e){c.current.show({life:3e3,severity:"success",summary:"Eliminar Registo(s)",detail:"Registo(s) eliminado(s) com sucesso"}),E()})).catch((function(e){c.current.show({life:3e3,severity:"error",summary:"Eliminar Registo(s)",detail:"Ocorreu um erro ao eliminar o(s) registo(s)"})})).finally((function(){}))},reject:function(){}})},E=function(e){var t=Qe(S+"/portal"),a={};e?Object.entries(e).forEach((function(e){var t=Object(u.a)(e,2),i=t[0],c=t[1];a[i]=c.value})):N.filters&&Object.entries(N.filters).forEach((function(e){var t=Object(u.a)(e,2),i=t[0],c=t[1];a[i]=c.value}));var i={pagination:{page:N.page+1,perPage:N.rows},sort:{field:N.sortField,order:-1==N.sortOrder?"Desc":"Asc"},filter:a};j(!0),t.getList("prints/groups",i).then((function(e){g(null),O(Object(d.a)(Object(d.a)({},e),{},{page:N.page})),j(!1)})).catch((function(e){j(!1),c.current.show({life:5e3,severity:"error",summary:"Pesquisa de Grupos de Plantas",detail:"Ocorreu um erro na pesquisa"})}))},R=function(e){_(Object(d.a)({},ei))};return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)("div",{className:"p-col-12",children:Object(we.jsx)("h3",{children:"Emiss\xe3o de Plantas - Grupos"})}),Object(we.jsxs)("div",{className:"p-grid p-fluid print-list",children:[Object(we.jsx)(tt.a,{ref:c,baseZIndex:2e3}),Object(we.jsxs)("div",{className:"card",children:[Object(we.jsx)(ct.a,{className:"p-mb-4",left:function(){return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{label:"Novo",icon:"pi pi-plus",className:"p-button-success p-mr-2",onClick:k}),Object(we.jsx)(nt.a,{label:"Eliminar",icon:"pi pi-trash",className:"p-button-danger",onClick:F,disabled:!v||!v.length})]})},right:function(){return Object(we.jsx)(r.a.Fragment,{children:Object(we.jsx)(nt.a,{label:"Limpar",icon:"pi pi-times",className:"p-button-help p-mr-2",onClick:R})})}}),Object(we.jsxs)(gt.a,{ref:w,value:m?m.data:[],lazy:!0,selectionMode:"checkbox",selection:v,onSelectionChange:function(e){return g(e.value)},paginator:!0,first:N.first,rows:N.rows,totalRecords:m.total,onPage:function(e){var t=Object(d.a)(Object(d.a)({},N),e);_(t)},onSort:function(e){var t=Object(d.a)(Object(d.a)({},N),e);_(t)},sortField:N.sortField,sortOrder:N.sortOrder,filters:N.filters,onFilter:function(e){var t=Object(d.a)(Object(d.a)({},N),e);t.first=0,_(t)},loading:l,emptyMessage:"N\xe3o foram encontrados registos.",children:[Object(we.jsx)(xt.a,{selectionMode:"multiple",headerStyle:{width:"3rem"}}),Object(we.jsx)(xt.a,{field:"id",header:"Id",sortable:!0,filter:!0,filterPlaceholder:"Id",headerStyle:{width:"6rem"}}),Object(we.jsx)(xt.a,{field:"code",header:"C\xf3digo",sortable:!0,filter:!0,filterPlaceholder:"C\xf3digo",style:{wordBreak:"break-all"}}),Object(we.jsx)(xt.a,{field:"title",header:"T\xedtulo",sortable:!0,filter:!0,filterPlaceholder:"T\xedtulo",style:{wordBreak:"break-all"}}),Object(we.jsx)(xt.a,{field:"groups",header:"Grupos",body:function(e){return Object(we.jsx)(r.a.Fragment,{children:e.groups&&e.groups.map((function(e){return Object(we.jsx)(yt.a,{label:e.code,className:"p-mr-2 p-mb-2"},e.id)}))})}}),Object(we.jsx)(xt.a,{field:"prints",header:"Plantas",body:function(e){return Object(we.jsx)(r.a.Fragment,{children:e.groups&&e.prints.map((function(e){return Object(we.jsx)(yt.a,{label:e.code,className:"p-mr-2 p-mb-2"},e.id)}))})}}),Object(we.jsx)(xt.a,{field:"viewers",header:"Visualizadores",body:function(e){return Object(we.jsx)(r.a.Fragment,{children:e.viewers&&e.viewers.map((function(e){return Object(we.jsx)(yt.a,{label:e.name,className:"p-mr-2 p-mb-2"},e.id)}))})}}),Object(we.jsx)(xt.a,{body:function(e){return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{icon:"pi pi-pencil",className:"p-button-rounded p-button-success p-mr-2",onClick:function(){return function(e){var a={pathname:"/prints/groups/edit/".concat(e.id),state:{from:t.location.pathname,previousSearchParams:Object(d.a)({},N)}};t.push(a)}(e)}}),Object(we.jsx)(nt.a,{icon:"pi pi-trash",className:"p-button-rounded p-button-warning",onClick:function(){return t=e,void Object(Jt.a)({message:" Deseja eliminar o registo selecionado?",header:"Confirma\xe7\xe3o",icon:"pi pi-exclamation-triangle",acceptLabel:"Sim",rejectLabel:"N\xe3o",accept:function(){var e=Qe(S+"/portal"),a={id:t.id};e.delete("prints/groups",a).then((function(e){c.current.show({life:3e3,severity:"success",summary:"Eliminar Registo",detail:"Registo eliminado com sucesso"}),E()})).catch((function(e){c.current.show({life:3e3,severity:"error",summary:"Eliminar Registo",detail:"Ocorreu um erro ao eliminar o registo"})})).finally((function(){}))},reject:function(){}});var t}})]})}})]})]})]})]})})));var ai=Object(l.b)((function(e){return{}}))(Object(p.h)((function(e){var t=e.history,a=(e.dispatch,Object(n.useState)(!1)),i=Object(u.a)(a,2),c=(i[0],i[1],Object(n.useState)(!1)),s=Object(u.a)(c,2),o=s[0],l=s[1],j=Object(n.useState)(e.data||{}),b=Object(u.a)(j,2),p=b[0],m=b[1],O=Object(n.useRef)(null),h=Object(n.useContext)(Ae).core.API_URL,v=Object(et.b)({defaultValues:Object(d.a)({},p)}),g=v.register,x=v.control,y=v.handleSubmit,N=(v.watch,v.formState.errors),_=(v.setValue,function(){var e={pathname:t.location.state.from,state:{searchParams:Object(d.a)({},t.location.state.previousSearchParams)}};t.replace(e)}),C=function(e,t){if(e&&e[t])return"required"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:e[t].message||"Campo obrigat\xf3rio"}):"maxLength"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:e[t].message||"O n\xfamero de caracteres \xe9 superior \xe0 dimens\xe3o m\xe1xima permitida"}):"pattern"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:e[t].message||"Formato inv\xe1lido"}):Object(we.jsx)("small",{className:"p-error",children:e[t].message})};return Object(we.jsxs)("form",{onSubmit:y((function(e){var t={code:e.code,name:e.name,config:e.config};l(!0);var a=Qe(h+"/portal");if(p.id){var i={id:p.id,data:Object(d.a)({},t)};a.update("prints/elements",i).then((function(e){O.current.show({life:3e3,severity:"success",summary:"Editar Registo",detail:"Registo alterado com sucesso"})})).catch((function(e){O.current.show({life:3e3,severity:"error",summary:"Editar Registo",detail:"Ocorreu um erro ao alterar o registo"})})).finally((function(){l(!1)}))}else{var c={data:Object(d.a)({},t)};a.create("prints/elements",c).then((function(e){m(Object(d.a)(Object(d.a)({},p),{},{id:e.data.id})),O.current.show({life:5e3,severity:"success",summary:"Criar Registo",detail:"Registo criada com sucesso"})})).catch((function(e){O.current.show({life:5e3,severity:"error",summary:"Criar Registo",detail:"Ocorreu um erro ao criar o registo"})})).finally((function(){l(!1)}))}})),children:[Object(we.jsx)(tt.a,{ref:O,baseZIndex:2e3}),Object(we.jsxs)("div",{className:"p-fluid p-formgrid p-grid",children:[Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-2",children:[Object(we.jsx)("label",{htmlFor:"id",children:"Id"}),Object(we.jsx)(f.a,{id:"id",type:"text",value:p.id||"",disabled:!0})]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-6",children:[Object(we.jsx)("label",{htmlFor:"code",children:"C\xf3digo"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"code",name:"code"},g("code",{required:"Campo obrigat\xf3rio."})),{},{autoFocus:!0,className:Object(dt.a)({"p-invalid":N.code})})),C(N,"code")]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-11",children:[Object(we.jsx)("label",{htmlFor:"name",children:"Designa\xe7\xe3o"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"name",name:"name"},g("name",{required:"Campo obrigat\xf3rio."})),{},{autoFocus:!0,className:Object(dt.a)({"p-invalid":N.name})})),C(N,"name")]}),Object(we.jsxs)("div",{className:"p-field p-col-12",children:[Object(we.jsx)("label",{htmlFor:"config",children:"Configura\xe7\xe3o"}),Object(we.jsxs)("div",{id:"editor-parent",children:[Object(we.jsx)(et.a,{control:x,name:"config",rules:{required:"Campo obrigat\xf3rio."},render:function(e){var t=e.field;return Object(we.jsx)(Rt.a,Object(d.a)(Object(d.a)({mode:"json",theme:"github",onLoad:function(e){e.container.style.setProperty("width",document.getElementById("editor-parent").offsetWidth-50+"px")}},t),{},{onChange:function(e){t.onChange(e)},value:t.value,name:"config",editorProps:{$blockScrolling:!0},setOptions:{tabSize:2}}))}}),C(N,"config")]})]})]}),Object(we.jsx)(ct.a,{className:"p-mt-4 p-mb-4",right:function(){return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{type:"button",label:"Voltar",icon:"pi pi-left",className:"p-button-secondary p-mr-4",disabled:!!o,onClick:_}),Object(we.jsx)(nt.a,{type:"submit",label:"Gravar",icon:o?"pi pi-save pi-spinner":"pi pi-save",disabled:!!o})]})}})]})})));var ii=Object(l.b)((function(e){return{loading:e.loading}}))(Object(p.h)((function(e){var t=Object(n.useContext)(Ae).core,a=(e.history,e.dispatch,Object(p.g)().id),i=Object(n.useState)(!1),c=Object(u.a)(i,2),s=(c[0],c[1]),o=Object(n.useState)(null),l=Object(u.a)(o,2),d=l[0],j=l[1],b=Object(n.useState)([]),m=Object(u.a)(b,2),O=(m[0],m[1],Object(n.useRef)(null),t.API_URL);Object(n.useEffect)((function(){a?f():j({})}),[]);var f=function(){var e=Qe(O+"/portal"),t={id:a};s(!0),e.getOne("prints/elements",t).then((function(e){var t=e.data;t.restrict_scales_list&&("string"===typeof t.restrict_scales_list||t.restrict_scales_list instanceof String)&&(t.restrict_scales_list=t.restrict_scales_list.split(",").map((function(e){return parseInt(e)}))),j(t),s(!1)})).catch((function(e){s(!1)}))};return Object(we.jsx)(r.a.Fragment,{children:d?Object(we.jsx)(ai,{data:d}):Object(we.jsx)("div",{children:"loading..."})})}))),ci={filters:{},first:0,rows:20,page:0,sortField:"id",sortOrder:1};var ni=Object(l.b)((function(e){return{loading:e.loading,filters:e.filters}}))(Object(p.h)((function(e){var t=e.history,a=e.elementsFilter,i=Object(n.useContext)(Ae).core,c=Object(n.useRef)(null),s=Object(n.useState)(!1),o=Object(u.a)(s,2),l=o[0],j=o[1],b=Object(n.useState)([]),p=Object(u.a)(b,2),m=p[0],O=p[1],f=Object(n.useState)(null),h=Object(u.a)(f,2),v=h[0],g=h[1],x=Object(n.useState)(Object(d.a)({},ci)),y=Object(u.a)(x,2),N=y[0],_=y[1],C=Object(n.useRef)(!1),w=Object(n.useRef)(null),S=i.API_URL;Object(n.useEffect)((function(){C.current&&(C.current=!0,a&&_.apply(void 0,Object(Ge.a)(a)))}),[]),Object(n.useEffect)((function(){E()}),[N]);var k=function(){var e={pathname:"/prints/elements/create",state:{from:t.location.pathname,previousSearchParams:Object(d.a)({},N)}};t.push(e)},F=function(){Object(Jt.a)({message:" Deseja eliminar o(s) registo(s) selecionado(s)?",header:"Confirma\xe7\xe3o",icon:"pi pi-exclamation-triangle",acceptLabel:"Sim",rejectLabel:"N\xe3o",accept:function(){var e=Qe(S+"/portal"),t={ids:v.map((function(e){return e.id}))};e.deleteMany("prints/elements",t).then((function(e){c.current.show({life:3e3,severity:"success",summary:"Eliminar Registo(s)",detail:"Registo(s) eliminado(s) com sucesso"}),E()})).catch((function(e){c.current.show({life:3e3,severity:"error",summary:"Eliminar Registo(s)",detail:"Ocorreu um erro ao eliminar o(s) registo(s)"})})).finally((function(){}))},reject:function(){}})},E=function(e){var t=Qe(S+"/portal"),a={};e?Object.entries(e).forEach((function(e){var t=Object(u.a)(e,2),i=t[0],c=t[1];a[i]=c.value})):N.filters&&Object.entries(N.filters).forEach((function(e){var t=Object(u.a)(e,2),i=t[0],c=t[1];a[i]=c.value}));var i={pagination:{page:N.page+1,perPage:N.rows},sort:{field:N.sortField,order:-1==N.sortOrder?"Desc":"Asc"},filter:a};j(!0),t.getList("prints/elements",i).then((function(e){g(null),O(Object(d.a)(Object(d.a)({},e),{},{page:N.page})),j(!1)})).catch((function(e){j(!1),c.current.show({life:5e3,severity:"error",summary:"Pesquisa de Elementos de Impress\xe3o",detail:"Ocorreu um erro na pesquisa"})}))},R=function(e){_(Object(d.a)({},ci))};return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)("div",{className:"p-col-12",children:Object(we.jsx)("h3",{children:"Emiss\xe3o de Plantas - Elementos"})}),Object(we.jsxs)("div",{className:"p-grid p-fluid print-list",children:[Object(we.jsx)(tt.a,{ref:c,baseZIndex:2e3}),Object(we.jsxs)("div",{className:"card",children:[Object(we.jsx)(ct.a,{className:"p-mb-4",left:function(){return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{label:"Novo",icon:"pi pi-plus",className:"p-button-success p-mr-2",onClick:k}),Object(we.jsx)(nt.a,{label:"Eliminar",icon:"pi pi-trash",className:"p-button-danger",onClick:F,disabled:!v||!v.length})]})},right:function(){return Object(we.jsx)(r.a.Fragment,{children:Object(we.jsx)(nt.a,{label:"Limpar",icon:"pi pi-times",className:"p-button-help p-mr-2",onClick:R})})}}),Object(we.jsxs)(gt.a,{ref:w,value:m?m.data:[],lazy:!0,selectionMode:"checkbox",selection:v,onSelectionChange:function(e){return g(e.value)},paginator:!0,first:N.first,rows:N.rows,totalRecords:m.total,onPage:function(e){var t=Object(d.a)(Object(d.a)({},N),e);_(t)},onSort:function(e){var t=Object(d.a)(Object(d.a)({},N),e);_(t)},sortField:N.sortField,sortOrder:N.sortOrder,filters:N.filters,onFilter:function(e){var t=Object(d.a)(Object(d.a)({},N),e);t.first=0,_(t)},loading:l,emptyMessage:"N\xe3o foram encontrados registos.",children:[Object(we.jsx)(xt.a,{selectionMode:"multiple",headerStyle:{width:"3rem"}}),Object(we.jsx)(xt.a,{field:"id",header:"Id",sortable:!0,filter:!0,filterPlaceholder:"Id",headerStyle:{width:"6rem"}}),Object(we.jsx)(xt.a,{field:"code",header:"C\xf3digo",sortable:!0,filter:!0,filterPlaceholder:"C\xf3digo",style:{wordBreak:"break-all"}}),Object(we.jsx)(xt.a,{field:"name",header:"Nome",sortable:!0,filter:!0,filterPlaceholder:"Nome",style:{wordBreak:"break-all"}}),Object(we.jsx)(xt.a,{body:function(e){return Object(we.jsxs)("div",{style:{textAlign:"right"},children:[Object(we.jsx)(nt.a,{icon:"pi pi-pencil",className:"p-button-rounded p-button-success p-mr-2",onClick:function(){return function(e){var a={pathname:"/prints/elements/edit/".concat(e.id),state:{from:t.location.pathname,previousSearchParams:Object(d.a)({},N)}};t.push(a)}(e)}}),Object(we.jsx)(nt.a,{icon:"pi pi-trash",className:"p-button-rounded p-button-warning",onClick:function(){return t=e,void Object(Jt.a)({message:" Deseja eliminar o registo selecionado?",header:"Confirma\xe7\xe3o",icon:"pi pi-exclamation-triangle",acceptLabel:"Sim",rejectLabel:"N\xe3o",accept:function(){var e=Qe(S+"/portal"),a={id:t.id};e.delete("prints/elements",a).then((function(e){c.current.show({life:3e3,severity:"success",summary:"Eliminar Registo",detail:"Registo eliminado com sucesso"}),E()})).catch((function(e){c.current.show({life:3e3,severity:"error",summary:"Eliminar Registo",detail:"Ocorreu um erro ao eliminar o registo"})})).finally((function(){}))},reject:function(){}});var t}})]})}})]})]})]})]})}))),ri={filters:{active:{value:!0}},first:0,rows:20,page:0,sortField:"id",sortOrder:1};var si=Object(l.b)((function(e){return{loading:e.loading,auth:e.auth,filters:e.filters}}))(Object(p.h)((function(e){var t=e.history,a=Object(n.useContext)(Ae).core,i=Object(n.useRef)(null),c=Object(n.useState)(!1),s=Object(u.a)(c,2),o=s[0],l=s[1],j=Object(n.useState)([]),b=Object(u.a)(j,2),p=b[0],m=b[1],O=Object(n.useState)(null),f=Object(u.a)(O,2),h=f[0],v=f[1],g=Object(n.useState)(!0),x=Object(u.a)(g,2),y=x[0],N=x[1],_=Object(n.useState)(Object(d.a)({},ri)),C=Object(u.a)(_,2),w=C[0],S=C[1],k=Object(n.useRef)(!1),F=Object(n.useRef)(null),E=a.API_URL;Object(n.useEffect)((function(){var e,a;if(!k.current&&null!==(e=t.location)&&void 0!==e&&null!==(a=e.state)&&void 0!==a&&a.searchParams){k.current=!0;var i=Object(d.a)({},t.location.state.searchParams);S(i)}else L()}),[w]);var R=function(){var e={pathname:"/security/users/create",state:{from:t.location.pathname,previousSearchParams:Object(d.a)({},w)}};t.push(e)},P=function(){Object(Jt.a)({message:" Deseja eliminar o(s) registo(s) selecionado(s)?",header:"Confirma\xe7\xe3o",icon:"pi pi-exclamation-triangle",acceptLabel:"Sim",rejectLabel:"N\xe3o",accept:function(){var e=Qe(E+"/security"),t={ids:h.filter((function(e){return!e.read_only})).map((function(e){return e.id}))};e.deleteMany("users",t).then((function(e){i.current.show({life:3e3,severity:"success",summary:"Eliminar Registo(s)",detail:"Registo(s) eliminado(s) com sucesso"}),L()})).catch((function(e){i.current.show({life:3e3,severity:"error",summary:"Eliminar Registo(s)",detail:"Ocorreu um erro ao eliminar o(s) registo(s)"})})).finally((function(){}))},reject:function(){}})},L=function(e){var t=Qe(E+"/security"),a={};e?Object.entries(e).forEach((function(e){var t=Object(u.a)(e,2),i=t[0],c=t[1];a[i]=c.value})):w.filters&&Object.entries(w.filters).forEach((function(e){var t=Object(u.a)(e,2),i=t[0],c=t[1];a[i]=c.value}));var c={pagination:{page:w.page+1,perPage:w.rows},sort:{field:w.sortField,order:-1===w.sortOrder?"Desc":"Asc"},filter:a};l(!0),t.getList("users",c).then((function(e){v(null),m(Object(d.a)(Object(d.a)({},e),{},{page:w.page}))})).catch((function(e){i.current.show({life:3e3,severity:"error",summary:"Pesquisa de Utilizadores",detail:"Ocorreu um erro ao realizar a pesquisa"})})).finally((function(){l(!1)}))},A=function(e){S(Object(d.a)({},ri)),N(!0)},I=Object(we.jsx)(Ve.a,{value:y,options:[{label:"Sim",value:!0},{label:"N\xe3o",value:!1}],onChange:function(e){F.current.filter(e.value,"active","equals"),N(e.value)},placeholder:"",className:"p-column-filter",showClear:!0});return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)("div",{className:"p-col-12",children:Object(we.jsx)("h3",{children:"Utilizadores"})}),Object(we.jsxs)("div",{className:"p-grid p-fluid viewer-list",children:[Object(we.jsx)(tt.a,{ref:i,baseZIndex:2e3}),Object(we.jsxs)("div",{className:"card",children:[Object(we.jsx)(ct.a,{className:"p-mb-4",left:function(){return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{label:"Novo",icon:"pi pi-plus",className:"p-button-success p-mr-2",onClick:R}),Object(we.jsx)(nt.a,{label:"Eliminar",icon:"pi pi-trash",className:"p-button-danger",onClick:P,disabled:!h||!h.length})]})},right:function(){return Object(we.jsx)(r.a.Fragment,{children:Object(we.jsx)(nt.a,{label:"Limpar",icon:"pi pi-times",className:"p-button-help p-mr-2",onClick:A})})}}),Object(we.jsxs)(gt.a,{ref:F,value:p?p.data:[],lazy:!0,selectionMode:"checkbox",selection:h,onSelectionChange:function(e){v(e.value.filter((function(e){return!e.read_only})))},paginator:!0,first:w.first,rows:w.rows,totalRecords:p.total,onPage:function(e){var t=Object(d.a)(Object(d.a)({},w),e);S(t)},onSort:function(e){var t=Object(d.a)(Object(d.a)({},w),e);S(t)},sortField:w.sortField,sortOrder:w.sortOrder,filters:w.filters,onFilter:function(e){var t=Object(d.a)(Object(d.a)({},w),e);t.first=0,S(t)},loading:o,emptyMessage:"N\xe3o foram encontrados registos.",children:[Object(we.jsx)(xt.a,{selectionMode:"multiple",headerStyle:{width:"3rem"}}),Object(we.jsx)(xt.a,{field:"id",header:"Id",sortable:!0,filter:!0,filterPlaceholder:"Id",headerStyle:{width:"6rem"}}),Object(we.jsx)(xt.a,{field:"username",header:"Username",sortable:!0,filter:!0,filterPlaceholder:"Username",style:{wordBreak:"break-all"}}),Object(we.jsx)(xt.a,{field:"email",header:"Email",sortable:!0,filter:!0,filterPlaceholder:"Email",style:{wordBreak:"break-all"}}),Object(we.jsx)(xt.a,{field:"name",header:"Nome",sortable:!0,filter:!0,filterPlaceholder:"Nome",style:{wordBreak:"break-all"}}),Object(we.jsx)(xt.a,{field:"active",header:"Ativo",body:function(e){return e.active?Object(we.jsx)("i",{className:"pi pi-check",style:{fontWeight:"bold",color:"#28a745"}}):Object(we.jsx)("i",{className:"pi pi-times",style:{fontWeight:"bold",color:"#D32F2F"}})},sortable:!0,filter:!0,filterElement:I,className:"p-text-center",headerStyle:{width:"9rem"}}),Object(we.jsx)(xt.a,{body:function(e){return e.read_only?Object(we.jsx)(nt.a,{icon:"fas fa-lock",className:"p-button-rounded p-button-secondary",disabled:!0}):Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{icon:"pi pi-pencil",className:"p-button-rounded p-button-success p-mr-2",onClick:function(){return function(e){var a={pathname:"/security/users/edit/".concat(e.id),state:{from:t.location.pathname,previousSearchParams:Object(d.a)({},w)}};t.push(a)}(e)}}),Object(we.jsx)(nt.a,{icon:"pi pi-trash",className:"p-button-rounded p-button-warning",onClick:function(){return t=e,void Object(Jt.a)({message:" Deseja eliminar o registo selecionado?",header:"Confirma\xe7\xe3o",icon:"pi pi-exclamation-triangle",acceptLabel:"Sim",rejectLabel:"N\xe3o",accept:function(){var e=Qe(E+"/security"),a={id:t.id};e.delete("users",a).then((function(e){i.current.show({life:3e3,severity:"success",summary:"Eliminar Registo",detail:"Registo eliminado com sucesso"}),L()})).catch((function(e){i.current.show({life:3e3,severity:"error",summary:"Eliminar Registo",detail:"Ocorreu um erro ao eliminar o registo"})})).finally((function(){}))},reject:function(){}});var t}})]})},style:{textAlign:"center"}})]})]})]})]})}))),oi=function(e){return e?e.sort((function(e,t){return e.name.toLowerCase()<t.name.toLowerCase()?-1:e.name.toLowerCase()>t.name.toLowerCase()?1:0})):e},li=function(e){return e?e.sort((function(e,t){return e.name.toLowerCase()<t.name.toLowerCase()?-1:e.name.toLowerCase()>t.name.toLowerCase()?1:0})):e};var di=Object(l.b)((function(e){return{}}))(Object(p.h)((function(e){var t,a,i=e.history,c=(e.dispatch,Object(n.useState)(!1)),s=Object(u.a)(c,2),o=(s[0],s[1],Object(n.useState)(!1)),l=Object(u.a)(o,2),j=l[0],b=l[1],p=Object(n.useState)(e.data||{}),m=Object(u.a)(p,2),O=m[0],h=m[1],v=Object(n.useState)(null!==e&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.roles?oi(Object(Ge.a)(e.data.roles)):[]),g=Object(u.a)(v,2),x=g[0],y=g[1],N=Object(n.useState)(null),_=Object(u.a)(N,2),C=_[0],w=_[1],S=Object(n.useState)(null),k=Object(u.a)(S,2),F=k[0],E=k[1],R=Object(n.useState)(null),P=Object(u.a)(R,2),L=P[0],A=P[1],I=Object(n.useState)(""),T=Object(u.a)(I,2),D=T[0],M=T[1],U=Object(n.useState)(null!==e&&void 0!==e&&null!==(a=e.data)&&void 0!==a&&a.groups?li(Object(Ge.a)(e.data.groups)):[]),G=Object(u.a)(U,2),q=G[0],V=G[1],B=Object(n.useState)(null),H=Object(u.a)(B,2),z=H[0],W=H[1],K=Object(n.useState)(null),Z=Object(u.a)(K,2),J=Z[0],Y=Z[1],$=Object(n.useState)(null),X=Object(u.a)($,2),Q=X[0],ee=X[1],te=Object(n.useState)(""),ae=Object(u.a)(te,2),ie=ae[0],ce=ae[1],ne=Object(n.useRef)(null),re=Object(n.useContext)(Ae).core.API_URL,se=Object(et.b)({defaultValues:Object(d.a)({},O)}),oe=se.register,le=se.control,de=se.handleSubmit,ue=(se.watch,se.formState.errors),je=se.setValue;Object(n.useEffect)((function(){var t={pagination:{page:1,perPage:1e3},sort:{field:"name",order:"Asc"},filter:{}};Promise.all([Qe(re+"/security").getList("roles",t).catch((function(e){return e})),Qe(re+"/security").getList("groups",t).catch((function(e){return e}))]).then((function(t){var a,i,c=t[0],n=null!==e&&void 0!==e&&null!==(a=e.data)&&void 0!==a&&a.roles?e.data.roles.map((function(e){return e.id})):[];w(oi(c.data.filter((function(e){return!n.includes(e.id)})).map((function(e){return{id:e.id,name:e.name}}))));var r=t[1],s=null!==e&&void 0!==e&&null!==(i=e.data)&&void 0!==i&&i.groups?e.data.groups.map((function(e){return e.id})):[];W(li(r.data.filter((function(e){return!s.includes(e.id)})).map((function(e){return{id:e.id,name:e.name}}))))})).catch((function(e){console.log(e)}))}),[]);var be=function(){var e={pathname:i.location.state.from,state:{searchParams:Object(d.a)({},i.location.state.previousSearchParams)}};i.replace(e)},pe=function(e,t){if(e&&e[t])return"required"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:e[t].message||"Campo obrigat\xf3rio"}):"maxLength"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:e[t].message||"O n\xfamero de caracteres \xe9 superior \xe0 dimens\xe3o m\xe1xima permitida"}):"pattern"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:e[t].message||"Formato inv\xe1lido"}):Object(we.jsx)("small",{className:"p-error",children:e[t].message})};return Object(we.jsxs)("form",{onSubmit:de((function(e){var t={first_name:e.first_name,last_name:e.last_name,name:e.name,username:e.username,email:e.email,password:e.password||null,active:e.active||!1,auth_token:e.auth_token||null,auth_token_expire:e.auth_token_expire||null,roles:x?x.map((function(e){return e.id})):[],groups:q?q.map((function(e){return e.id})):[]};b(!0);var a=Qe(re+"/security");if(O.id){var i={id:O.id,data:Object(d.a)({},t)};a.update("users",i).then((function(e){ne.current.show({life:3e3,severity:"success",summary:"Editar Registo",detail:"Registo alterado com sucesso"}),je("password","",{shouldValidate:!0,shouldDirty:!0})})).catch((function(e){ne.current.show({life:3e3,severity:"error",summary:"Editar Registo",detail:"Ocorreu um erro ao alterar o registo"})})).finally((function(){b(!1)}))}else{var c={data:Object(d.a)({},t)};a.create("users",c).then((function(e){h(Object(d.a)(Object(d.a)({},O),{},{id:e.data.id})),ne.current.show({life:5e3,severity:"success",summary:"Criar Registo",detail:"Registo criada com sucesso"})})).catch((function(e){ne.current.show({life:5e3,severity:"error",summary:"Criar Registo",detail:"Ocorreu um erro ao criar o registo"})})).finally((function(){b(!1)}))}})),children:[Object(we.jsx)(tt.a,{ref:ne,baseZIndex:2e3}),Object(we.jsxs)("div",{className:"p-fluid p-formgrid p-grid",children:[Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-3",children:[Object(we.jsx)("label",{htmlFor:"first_name",children:"Primeiro Nome"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"first_name",name:"first_name"},oe("first_name")),{},{autoFocus:!0}))]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-3",children:[Object(we.jsx)("label",{htmlFor:"last_name",children:"\xdaltimo Nome"}),Object(we.jsx)(f.a,Object(d.a)({id:"last_name",name:"last_name"},oe("last_name")))]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-6",children:[Object(we.jsx)("label",{htmlFor:"name",children:"Nome"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"name",name:"name"},oe("name",{required:"Campo obrigat\xf3rio."})),{},{className:Object(dt.a)({"p-invalid":ue.name})})),pe(ue,"name")]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-3",children:[Object(we.jsx)("label",{htmlFor:"username",children:"Username"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"username",name:"username"},oe("username",{required:"Campo obrigat\xf3rio."})),{},{className:Object(dt.a)({"p-invalid":ue.username})})),pe(ue,"username")]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-4",children:[Object(we.jsx)("label",{htmlFor:"email",children:"Email"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"email",name:"email"},oe("email",{required:"Campo obrigat\xf3rio."})),{},{className:Object(dt.a)({"p-invalid":ue.email})})),pe(ue,"email")]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-4",children:[Object(we.jsx)("label",{htmlFor:"password",children:"Password"}),Object(we.jsx)(et.a,{control:le,name:"password",render:function(e){var t=e.field;return Object(we.jsx)(at.a,Object(d.a)(Object(d.a)({},t),{},{feedback:!1,onChange:function(e){return t.onChange(e.target.value)}}))}})]}),Object(we.jsx)("div",{className:"p-field p-col-12",children:Object(we.jsx)("div",{className:"p-grid",children:Object(we.jsxs)("div",{className:"p-col-3 p-mt-2 p-mb-2",children:[Object(we.jsx)("label",{children:"\xa0"}),Object(we.jsx)(et.a,{control:le,name:"active",render:function(e){var t=e.field;return Object(we.jsx)(it.a,Object(d.a)(Object(d.a)({},t),{},{checked:t.value,onChange:function(e){return t.onChange(e.target.value)},onLabel:"Utilizador Ativo",offLabel:"Utilizador N\xe3o Ativo",onIcon:"pi pi-check",offIcon:"pi pi-times"}))}})]})})}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-6",children:[Object(we.jsx)("label",{htmlFor:"auth_token",children:"Token de Autentica\xe7\xe3o"}),Object(we.jsxs)("div",{className:"p-inputgroup",children:[Object(we.jsx)(nt.a,{type:"button",label:"Gerar",icon:"pi pi-check",className:"p-button-primary",onClick:function(e){je("auth_token",String(Object(ut.a)()))}}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"auth_token",name:"auth_token"},oe("auth_token")),{},{placeholder:"Token n\xe3o definido"})),Object(we.jsx)(nt.a,{type:"button",icon:"pi pi-times",className:"p-button-danger",onClick:function(e){je("auth_token",null),je("auth_token_expire",null)}})]})]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-3",children:[Object(we.jsx)("label",{htmlFor:"auth_token_expire",children:"Data de Validade do Token"}),Object(we.jsxs)("div",{className:"p-inputgroup",children:[Object(we.jsx)(et.a,{control:le,name:"auth_token_expire",render:function(e){var t=e.field;return Object(we.jsx)(rt.a,Object(d.a)(Object(d.a)({},t),{},{dateFormat:"yy-mm-dd",onChange:function(e){return t.onChange(e.target.value)},showIcon:!0,showTime:!0,showSeconds:!0}))}}),Object(we.jsx)(nt.a,{type:"button",icon:"pi pi-times",className:"p-button-danger",onClick:function(e){return je("auth_token_expire",null)}})]})]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-6",children:[Object(we.jsx)("label",{children:"Perfis"}),Object(we.jsxs)("div",{className:"p-card p-p-2",children:[C&&C.length>0&&Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)("div",{className:"p-field p-col-12 p-pl-0",children:Object(we.jsx)(st.a,{value:F,options:C,optionLabel:"name",optionValue:"id",display:"chip",showClear:!0,filter:!0,filterValue:D,onFilterValueChange:function(e){return M(e.value)},onChange:function(e){return E(e.value)},placeholder:"Selecionar"})}),Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsx)("div",{className:"p-col"}),Object(we.jsx)("div",{className:"p-col",children:Object(we.jsx)(nt.a,{label:"Adicionar",type:"button",disabled:!F||0===F.length,onClick:function(){if(C){var e=C.filter((function(e){return F.includes(e.id)})),t=C.filter((function(e){return!F.includes(e.id)}));y(oi([].concat(Object(Ge.a)(x),Object(Ge.a)(e)))),w(oi(Object(Ge.a)(t))),E(null),A(null)}}})}),Object(we.jsx)("div",{className:"p-col"})]})]}),x&&x.length>0?Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)("div",{className:"p-field p-col-12 p-pl-0 p-pt-2",children:Object(we.jsx)(ot.a,{optionLabel:"name",optionValue:"id",className:"p-p-1",options:x,value:L,onChange:function(e){return A(e.value)},multiple:!0})}),Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsx)("div",{className:"p-col"}),Object(we.jsx)("div",{className:"p-col",children:Object(we.jsx)(nt.a,{label:"Remover",type:"button",disabled:!L||0===L.length,onClick:function(){if(L){var e=x.filter((function(e){return L.includes(e.id)})),t=x.filter((function(e){return!L.includes(e.id)}));y(oi(Object(Ge.a)(t))),w(oi([].concat(Object(Ge.a)(C),Object(Ge.a)(e)))),A(null),E(null)}}})}),Object(we.jsx)("div",{className:"p-col"})]})]}):Object(we.jsx)("div",{className:"p-grid p-justify-center",children:Object(we.jsx)("div",{className:"p-col-12 p-mt-4 p-mb-2",children:Object(we.jsx)(lt.a,{severity:"warn",text:"Adicione um ou mais Perfis"})})})]})]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-6",children:[Object(we.jsx)("label",{children:"Grupos"}),Object(we.jsxs)("div",{className:"p-card p-p-2",children:[z&&z.length>0&&Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)("div",{className:"p-field p-col-12 p-pl-0",children:Object(we.jsx)(st.a,{value:J,options:z,optionLabel:"name",optionValue:"id",display:"chip",showClear:!0,filter:!0,filterValue:ie,onFilterValueChange:function(e){return ce(e.value)},onChange:function(e){return Y(e.value)},placeholder:"Selecionar"})}),Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsx)("div",{className:"p-col"}),Object(we.jsx)("div",{className:"p-col",children:Object(we.jsx)(nt.a,{label:"Adicionar",type:"button",disabled:!J||0===J.length,onClick:function(){if(z){var e=z.filter((function(e){return J.includes(e.id)})),t=z.filter((function(e){return!J.includes(e.id)}));V(li([].concat(Object(Ge.a)(q),Object(Ge.a)(e)))),W(li(Object(Ge.a)(t))),Y(null),ee(null)}}})}),Object(we.jsx)("div",{className:"p-col"})]})]}),q&&q.length>0?Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)("div",{className:"p-field p-col-12 p-pl-0 p-pt-2",children:Object(we.jsx)(ot.a,{optionLabel:"name",optionValue:"id",className:"p-p-1",options:q,value:Q,onChange:function(e){return ee(e.value)},multiple:!0})}),Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsx)("div",{className:"p-col"}),Object(we.jsx)("div",{className:"p-col",children:Object(we.jsx)(nt.a,{label:"Remover",type:"button",disabled:!Q||0===Q.length,onClick:function(){if(Q){var e=q.filter((function(e){return Q.includes(e.id)})),t=q.filter((function(e){return!Q.includes(e.id)}));V(li(Object(Ge.a)(t))),W(li([].concat(Object(Ge.a)(z),Object(Ge.a)(e)))),ee(null),Y(null)}}})}),Object(we.jsx)("div",{className:"p-col"})]})]}):Object(we.jsx)("div",{className:"p-grid p-justify-center",children:Object(we.jsx)("div",{className:"p-col-12 p-mt-4 p-mb-2",children:Object(we.jsx)(lt.a,{severity:"warn",text:"Adicione um ou mais Grupos"})})})]})]})]}),Object(we.jsx)(ct.a,{className:"p-mt-4 p-mb-4",right:function(){return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{type:"button",label:"Voltar",icon:"pi pi-left",className:"p-button-secondary p-mr-4",disabled:!!j,onClick:be}),Object(we.jsx)(nt.a,{type:"submit",label:"Gravar",icon:j?"pi pi-save pi-spinner":"pi pi-save",disabled:!!j})]})}})]})})));var ui=Object(l.b)((function(e){return{}}))(Object(p.h)((function(e){var t=Object(n.useContext)(Ae).core,a=(e.history,e.dispatch,Object(p.g)().id),i=Object(n.useState)(!1),c=Object(u.a)(i,2),s=(c[0],c[1]),o=Object(n.useState)(null),l=Object(u.a)(o,2),j=l[0],b=l[1],m=(Object(n.useRef)(null),t.API_URL);Object(n.useEffect)((function(){a?O():b({})}),[]);var O=function(){var e=Qe(m+"/security"),t={id:a};s(!0),e.getOne("users",t).then((function(e){var t=Object(d.a)({},e.data);t.auth_token_expire=t.auth_token&&t.auth_token_expire?new Date(t.auth_token_expire):null,b(t),s(!1)})).catch((function(e){s(!1),console.log(e)}))};return Object(we.jsx)(r.a.Fragment,{children:j?Object(we.jsx)(di,{data:j}):Object(we.jsx)("div",{children:"loading..."})})}))),ji={filters:{},first:0,rows:20,page:0,sortField:"id",sortOrder:1};var bi=Object(l.b)((function(e){return{loading:e.loading,auth:e.auth,filters:e.filters}}))(Object(p.h)((function(e){var t=e.history,a=Object(n.useContext)(Ae).core,i=Object(n.useRef)(null),c=Object(n.useState)(!1),s=Object(u.a)(c,2),o=s[0],l=s[1],j=Object(n.useState)([]),b=Object(u.a)(j,2),p=b[0],m=b[1],O=Object(n.useState)(null),f=Object(u.a)(O,2),h=f[0],v=f[1],g=Object(n.useState)(Object(d.a)({},ji)),x=Object(u.a)(g,2),y=x[0],N=x[1],_=Object(n.useRef)(!1),C=Object(n.useRef)(null),w=a.API_URL;Object(n.useEffect)((function(){var e,a;if(!_.current&&null!==(e=t.location)&&void 0!==e&&null!==(a=e.state)&&void 0!==a&&a.searchParams){_.current=!0;var i=Object(d.a)({},t.location.state.searchParams);N(i)}else F()}),[y]);var S=function(){var e={pathname:"/security/roles/create",state:{from:t.location.pathname,previousSearchParams:Object(d.a)({},y)}};t.push(e)},k=function(){Object(Jt.a)({message:" Deseja eliminar o(s) registo(s) selecionado(s)?",header:"Confirma\xe7\xe3o",icon:"pi pi-exclamation-triangle",acceptLabel:"Sim",rejectLabel:"N\xe3o",accept:function(){var e=Qe(w+"/security"),t={ids:h.filter((function(e){return!e.read_only})).map((function(e){return e.id}))};e.deleteMany("users",t).then((function(e){i.current.show({life:3e3,severity:"success",summary:"Eliminar Registo(s)",detail:"Registo(s) eliminado(s) com sucesso"}),F()})).catch((function(e){i.current.show({life:3e3,severity:"error",summary:"Eliminar Registo(s)",detail:"Ocorreu um erro ao eliminar o(s) registo(s)"})})).finally((function(){}))},reject:function(){}})},F=function(e){var t=Qe(w+"/security"),a={};e?Object.entries(e).forEach((function(e){var t=Object(u.a)(e,2),i=t[0],c=t[1];a[i]=c.value})):y.filters&&Object.entries(y.filters).forEach((function(e){var t=Object(u.a)(e,2),i=t[0],c=t[1];a[i]=c.value}));var c={pagination:{page:y.page+1,perPage:y.rows},sort:{field:y.sortField,order:-1==y.sortOrder?"Desc":"Asc"},filter:a};l(!0),t.getList("roles",c).then((function(e){v(null),m(Object(d.a)(Object(d.a)({},e),{},{page:y.page}))})).catch((function(e){i.current.show({life:3e3,severity:"error",summary:"Pesquisa de Perfis",detail:"Ocorreu um erro ao realizar a pesquisa"})})).finally((function(){l(!1)}))},E=function(e){N(Object(d.a)({},ji))};return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)("div",{className:"p-col-12",children:Object(we.jsx)("h3",{children:"Utilizadores - Perfis"})}),Object(we.jsxs)("div",{className:"p-grid p-fluid viewer-list",children:[Object(we.jsx)(tt.a,{ref:i,baseZIndex:2e3}),Object(we.jsxs)("div",{className:"card",children:[Object(we.jsx)(ct.a,{className:"p-mb-4",left:function(){return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{label:"Novo",icon:"pi pi-plus",className:"p-button-success p-mr-2",onClick:S}),Object(we.jsx)(nt.a,{label:"Eliminar",icon:"pi pi-trash",className:"p-button-danger",onClick:k,disabled:!h||!h.length})]})},right:function(){return Object(we.jsx)(r.a.Fragment,{children:Object(we.jsx)(nt.a,{label:"Limpar",icon:"pi pi-times",className:"p-button-help p-mr-2",onClick:E})})}}),Object(we.jsxs)(gt.a,{ref:C,value:p?p.data:[],lazy:!0,selectionMode:"checkbox",selection:h,onSelectionChange:function(e){v(e.value.filter((function(e){return!e.read_only})))},paginator:!0,first:y.first,rows:y.rows,totalRecords:p.total,onPage:function(e){var t=Object(d.a)(Object(d.a)({},y),e);N(t)},onSort:function(e){var t=Object(d.a)(Object(d.a)({},y),e);N(t)},sortField:y.sortField,sortOrder:y.sortOrder,filters:y.filters,onFilter:function(e){var t=Object(d.a)(Object(d.a)({},y),e);t.first=0,N(t)},loading:o,emptyMessage:"N\xe3o foram encontrados registos.",children:[Object(we.jsx)(xt.a,{selectionMode:"multiple",headerStyle:{width:"3rem"}}),Object(we.jsx)(xt.a,{field:"id",header:"Id",sortable:!0,filter:!0,filterPlaceholder:"Id",headerStyle:{width:"6rem"}}),Object(we.jsx)(xt.a,{field:"name",header:"Nome",sortable:!0,filter:!0,filterPlaceholder:"Nome",style:{wordBreak:"break-all"}}),Object(we.jsx)(xt.a,{field:"description",header:"Descri\xe7\xe3o",sortable:!0,filter:!0,filterPlaceholder:"Descri\xe7\xe3o",style:{wordBreak:"break-all"}}),Object(we.jsx)(xt.a,{body:function(e){return e.read_only?Object(we.jsx)(nt.a,{icon:"fas fa-lock",className:"p-button-rounded p-button-secondary",disabled:!0}):Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{icon:"pi pi-pencil",className:"p-button-rounded p-button-success p-mr-2",onClick:function(){return function(e){var a={pathname:"/security/roles/edit/".concat(e.id),state:{from:t.location.pathname,previousSearchParams:Object(d.a)({},y)}};t.push(a)}(e)}}),Object(we.jsx)(nt.a,{icon:"pi pi-trash",className:"p-button-rounded p-button-warning",onClick:function(){return t=e,void Object(Jt.a)({message:" Deseja eliminar o registo selecionado?",header:"Confirma\xe7\xe3o",icon:"pi pi-exclamation-triangle",acceptLabel:"Sim",rejectLabel:"N\xe3o",accept:function(){var e=Qe(w+"/security"),a={id:t.id};e.delete("roles",a).then((function(e){i.current.show({life:3e3,severity:"success",summary:"Eliminar Registo",detail:"Registo eliminado com sucesso"}),F()})).catch((function(e){i.current.show({life:3e3,severity:"error",summary:"Eliminar Registo",detail:"Ocorreu um erro ao eliminar o registo"})})).finally((function(){}))},reject:function(){}});var t}})]})},style:{textAlign:"center",width:"12rem"}})]})]})]})]})})));var pi=Object(l.b)((function(e){return{}}))(Object(p.h)((function(e){var t=e.history,a=(e.dispatch,Object(n.useState)(!1)),i=Object(u.a)(a,2),c=(i[0],i[1],Object(n.useState)(!1)),s=Object(u.a)(c,2),o=s[0],l=s[1],j=Object(n.useState)(e.data||{}),b=Object(u.a)(j,2),p=b[0],m=b[1],O=Object(n.useRef)(null),h=Object(n.useContext)(Ae).core.API_URL,v=Object(et.b)({defaultValues:Object(d.a)({},p)}),g=v.register,x=(v.control,v.handleSubmit),y=(v.watch,v.formState.errors),N=(v.setValue,function(){var e={pathname:t.location.state.from,state:{searchParams:Object(d.a)({},t.location.state.previousSearchParams)}};t.replace(e)}),_=function(e,t){if(e&&e[t])return"required"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:e[t].message||"Campo obrigat\xf3rio"}):"maxLength"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:e[t].message||"O n\xfamero de caracteres \xe9 superior \xe0 dimens\xe3o m\xe1xima permitida"}):"pattern"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:e[t].message||"Formato inv\xe1lido"}):Object(we.jsx)("small",{className:"p-error",children:e[t].message})};return Object(we.jsxs)("form",{onSubmit:x((function(e){var t={name:e.name,description:e.description};l(!0);var a=Qe(h+"/security");if(p.id){var i={id:p.id,data:Object(d.a)({},t)};a.update("roles",i).then((function(e){O.current.show({life:3e3,severity:"success",summary:"Editar Registo",detail:"Registo alterado com sucesso"})})).catch((function(e){O.current.show({life:3e3,severity:"error",summary:"Editar Registo",detail:"Ocorreu um erro ao alterar o registo"})})).finally((function(){l(!1)}))}else{var c={data:Object(d.a)({},t)};a.create("roles",c).then((function(e){m(Object(d.a)(Object(d.a)({},p),{},{id:e.data.id})),O.current.show({life:5e3,severity:"success",summary:"Criar Registo",detail:"Registo criada com sucesso"})})).catch((function(e){O.current.show({life:5e3,severity:"error",summary:"Criar Registo",detail:"Ocorreu um erro ao criar o registo"})})).finally((function(){l(!1)}))}})),children:[Object(we.jsx)(tt.a,{ref:O,baseZIndex:2e3}),Object(we.jsxs)("div",{className:"p-fluid p-formgrid p-grid",children:[Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-2",children:[Object(we.jsx)("label",{htmlFor:"id",children:"Id"}),Object(we.jsx)(f.a,{id:"id",type:"text",value:p.id||"",disabled:!0})]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-10",children:[Object(we.jsx)("label",{htmlFor:"name",children:"Designa\xe7\xe3o"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"name",name:"name"},g("name",{required:"Campo obrigat\xf3rio."})),{},{autoFocus:!0,className:Object(dt.a)({"p-invalid":y.name})})),_(y,"name")]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-12",children:[Object(we.jsx)("label",{htmlFor:"description",children:"Descri\xe7\xe3o"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"description",name:"notes"},g("description")),{},{autoFocus:!0})),_(y,"notes")]})]}),Object(we.jsx)(ct.a,{className:"p-mt-4 p-mb-4",right:function(){return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{type:"button",label:"Voltar",icon:"pi pi-left",className:"p-button-secondary p-mr-4",disabled:!!o,onClick:N}),Object(we.jsx)(nt.a,{type:"submit",label:"Gravar",icon:o?"pi pi-save pi-spinner":"pi pi-save",disabled:!!o})]})}})]})})));var mi=Object(l.b)((function(e){return{}}))(Object(p.h)((function(e){var t=Object(n.useContext)(Ae).core,a=(e.history,e.dispatch,Object(p.g)().id),i=Object(n.useState)(!1),c=Object(u.a)(i,2),s=(c[0],c[1]),o=Object(n.useState)(null),l=Object(u.a)(o,2),j=l[0],b=l[1],m=(Object(n.useRef)(null),t.API_URL);Object(n.useEffect)((function(){a?O():b({})}),[]);var O=function(){var e=Qe(m+"/security"),t={id:a};s(!0),e.getOne("roles",t).then((function(e){var t=Object(d.a)({},e.data);b(t),s(!1)})).catch((function(e){s(!1),console.log(e)}))};return Object(we.jsx)(r.a.Fragment,{children:j?Object(we.jsx)(pi,{data:j}):Object(we.jsx)("div",{children:"loading..."})})}))),Oi={filters:{},first:0,rows:20,page:0,sortField:"id",sortOrder:1};var fi=Object(l.b)((function(e){return{loading:e.loading,auth:e.auth,filters:e.filters}}))(Object(p.h)((function(e){var t=e.history,a=Object(n.useContext)(Ae).core,i=Object(n.useRef)(null),c=Object(n.useState)(!1),s=Object(u.a)(c,2),o=s[0],l=s[1],j=Object(n.useState)([]),b=Object(u.a)(j,2),p=b[0],m=b[1],O=Object(n.useState)(null),f=Object(u.a)(O,2),h=f[0],v=f[1],g=Object(n.useState)(Object(d.a)({},Oi)),x=Object(u.a)(g,2),y=x[0],N=x[1],_=Object(n.useRef)(!1),C=Object(n.useRef)(null),w=a.API_URL;Object(n.useEffect)((function(){var e,a;if(!_.current&&null!==(e=t.location)&&void 0!==e&&null!==(a=e.state)&&void 0!==a&&a.searchParams){_.current=!0;var i=Object(d.a)({},t.location.state.searchParams);N(i)}else F()}),[y]);var S=function(){var e={pathname:"/security/groups/create",state:{from:t.location.pathname,previousSearchParams:Object(d.a)({},y)}};t.push(e)},k=function(){Object(Jt.a)({message:" Deseja eliminar o(s) registo(s) selecionado(s)?",header:"Confirma\xe7\xe3o",icon:"pi pi-exclamation-triangle",acceptLabel:"Sim",rejectLabel:"N\xe3o",accept:function(){var e=Qe(w+"/security"),t={ids:h.filter((function(e){return!e.read_only})).map((function(e){return e.id}))};e.deleteMany("users",t).then((function(e){i.current.show({life:3e3,severity:"success",summary:"Eliminar Registo(s)",detail:"Registo(s) eliminado(s) com sucesso"}),F()})).catch((function(e){i.current.show({life:3e3,severity:"error",summary:"Eliminar Registo(s)",detail:"Ocorreu um erro ao eliminar o(s) registo(s)"})})).finally((function(){}))},reject:function(){}})},F=function(e){var t=Qe(w+"/security"),a={};e?Object.entries(e).forEach((function(e){var t=Object(u.a)(e,2),i=t[0],c=t[1];a[i]=c.value})):y.filters&&Object.entries(y.filters).forEach((function(e){var t=Object(u.a)(e,2),i=t[0],c=t[1];a[i]=c.value}));var c={pagination:{page:y.page+1,perPage:y.rows},sort:{field:y.sortField,order:-1==y.sortOrder?"Desc":"Asc"},filter:a};l(!0),t.getList("groups",c).then((function(e){v(null),m(Object(d.a)(Object(d.a)({},e),{},{page:y.page}))})).catch((function(e){i.current.show({life:3e3,severity:"error",summary:"Pesquisa de Grupos",detail:"Ocorreu um erro ao realizar a pesquisa"})})).finally((function(){l(!1)}))},E=function(e){N(Object(d.a)({},Oi))};return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)("div",{className:"p-col-12",children:Object(we.jsx)("h3",{children:"Utilizadores - Grupos"})}),Object(we.jsxs)("div",{className:"p-grid p-fluid viewer-list",children:[Object(we.jsx)(tt.a,{ref:i,baseZIndex:2e3}),Object(we.jsxs)("div",{className:"card",children:[Object(we.jsx)(ct.a,{className:"p-mb-4",left:function(){return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{label:"Novo",icon:"pi pi-plus",className:"p-button-success p-mr-2",onClick:S}),Object(we.jsx)(nt.a,{label:"Eliminar",icon:"pi pi-trash",className:"p-button-danger",onClick:k,disabled:!h||!h.length})]})},right:function(){return Object(we.jsx)(r.a.Fragment,{children:Object(we.jsx)(nt.a,{label:"Limpar",icon:"pi pi-times",className:"p-button-help p-mr-2",onClick:E})})}}),Object(we.jsxs)(gt.a,{ref:C,value:p?p.data:[],lazy:!0,selectionMode:"checkbox",selection:h,onSelectionChange:function(e){v(e.value.filter((function(e){return!e.read_only})))},paginator:!0,first:y.first,rows:y.rows,totalRecords:p.total,onPage:function(e){var t=Object(d.a)(Object(d.a)({},y),e);N(t)},onSort:function(e){var t=Object(d.a)(Object(d.a)({},y),e);N(t)},sortField:y.sortField,sortOrder:y.sortOrder,filters:y.filters,onFilter:function(e){var t=Object(d.a)(Object(d.a)({},y),e);t.first=0,N(t)},loading:o,emptyMessage:"N\xe3o foram encontrados registos.",children:[Object(we.jsx)(xt.a,{selectionMode:"multiple",headerStyle:{width:"3rem"}}),Object(we.jsx)(xt.a,{field:"id",header:"Id",sortable:!0,filter:!0,filterPlaceholder:"Id",headerStyle:{width:"6rem"}}),Object(we.jsx)(xt.a,{field:"name",header:"Nome",sortable:!0,filter:!0,filterPlaceholder:"Nome",style:{wordBreak:"break-all"}}),Object(we.jsx)(xt.a,{field:"description",header:"Descri\xe7\xe3o",sortable:!0,filter:!0,filterPlaceholder:"Descri\xe7\xe3o",style:{wordBreak:"break-all"}}),Object(we.jsx)(xt.a,{body:function(e){return e.read_only?Object(we.jsx)(nt.a,{icon:"fas fa-lock",className:"p-button-rounded p-button-secondary",disabled:!0}):Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{icon:"pi pi-pencil",className:"p-button-rounded p-button-success p-mr-2",onClick:function(){return function(e){var a={pathname:"/security/groups/edit/".concat(e.id),state:{from:t.location.pathname,previousSearchParams:Object(d.a)({},y)}};t.push(a)}(e)}}),Object(we.jsx)(nt.a,{icon:"pi pi-trash",className:"p-button-rounded p-button-warning",onClick:function(){return t=e,void Object(Jt.a)({message:" Deseja eliminar o registo selecionado?",header:"Confirma\xe7\xe3o",icon:"pi pi-exclamation-triangle",acceptLabel:"Sim",rejectLabel:"N\xe3o",accept:function(){var e=Qe(w+"/security"),a={id:t.id};e.delete("groups",a).then((function(e){i.current.show({life:3e3,severity:"success",summary:"Eliminar Registo",detail:"Registo eliminado com sucesso"}),F()})).catch((function(e){i.current.show({life:3e3,severity:"error",summary:"Eliminar Registo",detail:"Ocorreu um erro ao eliminar o registo"})})).finally((function(){}))},reject:function(){}});var t}})]})},style:{textAlign:"center",width:"12rem"}})]})]})]})]})}))),hi=function(e){return e?e.sort((function(e,t){return e.name.toLowerCase()<t.name.toLowerCase()?-1:e.name.toLowerCase()>t.name.toLowerCase()?1:0})):e},vi=function(e){return e?e.sort((function(e,t){return e.name.toLowerCase()<t.name.toLowerCase()?-1:e.name.toLowerCase()>t.name.toLowerCase()?1:0})):e};var gi=Object(l.b)((function(e){return{}}))(Object(p.h)((function(e){var t,a,i=e.history,c=(e.dispatch,Object(n.useState)(!1)),s=Object(u.a)(c,2),o=(s[0],s[1],Object(n.useState)(!1)),l=Object(u.a)(o,2),j=l[0],b=l[1],p=Object(n.useState)(e.data||{}),m=Object(u.a)(p,2),O=m[0],h=m[1],v=Object(n.useState)(null!==e&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.roles?hi(Object(Ge.a)(e.data.roles)):[]),g=Object(u.a)(v,2),x=g[0],y=g[1],N=Object(n.useState)(null),_=Object(u.a)(N,2),C=_[0],w=_[1],S=Object(n.useState)(null),k=Object(u.a)(S,2),F=k[0],E=k[1],R=Object(n.useState)(null),P=Object(u.a)(R,2),L=P[0],A=P[1],I=Object(n.useState)(""),T=Object(u.a)(I,2),D=T[0],M=T[1],U=Object(n.useState)(null!==e&&void 0!==e&&null!==(a=e.data)&&void 0!==a&&a.users?vi(Object(Ge.a)(e.data.users)):[]),G=Object(u.a)(U,2),q=G[0],V=G[1],B=Object(n.useState)(null),H=Object(u.a)(B,2),z=H[0],W=H[1],K=Object(n.useState)(null),Z=Object(u.a)(K,2),J=Z[0],Y=Z[1],$=Object(n.useState)(null),X=Object(u.a)($,2),Q=X[0],ee=X[1],te=Object(n.useState)(""),ae=Object(u.a)(te,2),ie=ae[0],ce=ae[1],ne=Object(n.useRef)(null),re=Object(n.useContext)(Ae).core.API_URL,se=Object(et.b)({defaultValues:Object(d.a)({},O)}),oe=se.register,le=(se.control,se.handleSubmit),de=(se.watch,se.formState.errors);se.setValue,Object(n.useEffect)((function(){var t={pagination:{page:1,perPage:1e3},sort:{field:"name",order:"Asc"},filter:{}};Promise.all([Qe(re+"/security").getList("roles",t).catch((function(e){return e})),Qe(re+"/security").getList("users",t).catch((function(e){return e}))]).then((function(t){var a,i,c=t[0],n=null!==e&&void 0!==e&&null!==(a=e.data)&&void 0!==a&&a.roles?e.data.roles.map((function(e){return e.id})):[];w(hi(c.data.filter((function(e){return!n.includes(e.id)})).map((function(e){return{id:e.id,name:e.name}}))));var r=t[1],s=null!==e&&void 0!==e&&null!==(i=e.data)&&void 0!==i&&i.users?e.data.users.map((function(e){return e.id})):[];W(vi(r.data.filter((function(e){return!s.includes(e.id)})).map((function(e){return{id:e.id,name:e.name}}))))})).catch((function(e){console.log(e)}))}),[]);var ue=function(){var e={pathname:i.location.state.from,state:{searchParams:Object(d.a)({},i.location.state.previousSearchParams)}};i.replace(e)},je=function(e,t){if(e&&e[t])return"required"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:e[t].message||"Campo obrigat\xf3rio"}):"maxLength"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:e[t].message||"O n\xfamero de caracteres \xe9 superior \xe0 dimens\xe3o m\xe1xima permitida"}):"pattern"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:e[t].message||"Formato inv\xe1lido"}):Object(we.jsx)("small",{className:"p-error",children:e[t].message})};return Object(we.jsxs)("form",{onSubmit:le((function(e){var t={name:e.name,description:e.description,roles:x?x.map((function(e){return e.id})):[],users:q?q.map((function(e){return e.id})):[]};b(!0);var a=Qe(re+"/security");if(O.id){var i={id:O.id,data:Object(d.a)({},t)};a.update("groups",i).then((function(e){ne.current.show({life:3e3,severity:"success",summary:"Editar Registo",detail:"Registo alterado com sucesso"})})).catch((function(e){ne.current.show({life:3e3,severity:"error",summary:"Editar Registo",detail:"Ocorreu um erro ao alterar o registo"})})).finally((function(){b(!1)}))}else{var c={data:Object(d.a)({},t)};a.create("groups",c).then((function(e){h(Object(d.a)(Object(d.a)({},O),{},{id:e.data.id})),ne.current.show({life:5e3,severity:"success",summary:"Criar Registo",detail:"Registo criada com sucesso"})})).catch((function(e){ne.current.show({life:5e3,severity:"error",summary:"Criar Registo",detail:"Ocorreu um erro ao criar o registo"})})).finally((function(){b(!1)}))}})),children:[Object(we.jsx)(tt.a,{ref:ne,baseZIndex:2e3}),Object(we.jsxs)("div",{className:"p-fluid p-formgrid p-grid",children:[Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-2",children:[Object(we.jsx)("label",{htmlFor:"id",children:"Id"}),Object(we.jsx)(f.a,{id:"id",type:"text",value:O.id||"",disabled:!0})]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-10",children:[Object(we.jsx)("label",{htmlFor:"name",children:"Designa\xe7\xe3o"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"name",name:"name"},oe("name",{required:"Campo obrigat\xf3rio."})),{},{autoFocus:!0,className:Object(dt.a)({"p-invalid":de.name})})),je(de,"name")]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-12",children:[Object(we.jsx)("label",{htmlFor:"description",children:"Descri\xe7\xe3o"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"description",name:"notes"},oe("description")),{},{autoFocus:!0})),je(de,"notes")]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-6",children:[Object(we.jsx)("label",{children:"Perfis"}),Object(we.jsxs)("div",{className:"p-card p-p-2",children:[C&&C.length>0&&Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)("div",{className:"p-field p-col-12 p-pl-0",children:Object(we.jsx)(st.a,{value:F,options:C,optionLabel:"name",optionValue:"id",display:"chip",showClear:!0,filter:!0,filterValue:D,onFilterValueChange:function(e){return M(e.value)},onChange:function(e){return E(e.value)},placeholder:"Selecionar"})}),Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsx)("div",{className:"p-col"}),Object(we.jsx)("div",{className:"p-col",children:Object(we.jsx)(nt.a,{label:"Adicionar",type:"button",disabled:!F||0===F.length,onClick:function(){if(C){var e=C.filter((function(e){return F.includes(e.id)})),t=C.filter((function(e){return!F.includes(e.id)}));y(hi([].concat(Object(Ge.a)(x),Object(Ge.a)(e)))),w(hi(Object(Ge.a)(t))),E(null),A(null)}}})}),Object(we.jsx)("div",{className:"p-col"})]})]}),x&&x.length>0?Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)("div",{className:"p-field p-col-12 p-pl-0 p-pt-2",children:Object(we.jsx)(ot.a,{optionLabel:"name",optionValue:"id",className:"p-p-1",options:x,value:L,onChange:function(e){return A(e.value)},multiple:!0})}),Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsx)("div",{className:"p-col"}),Object(we.jsx)("div",{className:"p-col",children:Object(we.jsx)(nt.a,{label:"Remover",type:"button",disabled:!L||0===L.length,onClick:function(){if(L){var e=x.filter((function(e){return L.includes(e.id)})),t=x.filter((function(e){return!L.includes(e.id)}));y(hi(Object(Ge.a)(t))),w(hi([].concat(Object(Ge.a)(C),Object(Ge.a)(e)))),A(null),E(null)}}})}),Object(we.jsx)("div",{className:"p-col"})]})]}):Object(we.jsx)("div",{className:"p-grid p-justify-center",children:Object(we.jsx)("div",{className:"p-col-12 p-mt-4 p-mb-2",children:Object(we.jsx)(lt.a,{severity:"warn",text:"Adicione um ou mais Perfis"})})})]})]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-6",children:[Object(we.jsx)("label",{children:"Utilizadores"}),Object(we.jsxs)("div",{className:"p-card p-p-2",children:[z&&z.length>0&&Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)("div",{className:"p-field p-col-12 p-pl-0",children:Object(we.jsx)(st.a,{value:J,options:z,optionLabel:"name",optionValue:"id",display:"chip",showClear:!0,filter:!0,filterValue:ie,onFilterValueChange:function(e){return ce(e.value)},onChange:function(e){return Y(e.value)},placeholder:"Selecionar"})}),Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsx)("div",{className:"p-col"}),Object(we.jsx)("div",{className:"p-col",children:Object(we.jsx)(nt.a,{label:"Adicionar",type:"button",disabled:!J||0===J.length,onClick:function(){if(z){var e=z.filter((function(e){return J.includes(e.id)})),t=z.filter((function(e){return!J.includes(e.id)}));V(vi([].concat(Object(Ge.a)(q),Object(Ge.a)(e)))),W(vi(Object(Ge.a)(t))),Y(null),ee(null)}}})}),Object(we.jsx)("div",{className:"p-col"})]})]}),q&&q.length>0?Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)("div",{className:"p-field p-col-12 p-pl-0 p-pt-2",children:Object(we.jsx)(ot.a,{optionLabel:"name",optionValue:"id",className:"p-p-1",options:q,value:Q,onChange:function(e){return ee(e.value)},multiple:!0})}),Object(we.jsxs)("div",{className:"p-grid",children:[Object(we.jsx)("div",{className:"p-col"}),Object(we.jsx)("div",{className:"p-col",children:Object(we.jsx)(nt.a,{label:"Remover",type:"button",disabled:!Q||0===Q.length,onClick:function(){if(Q){var e=q.filter((function(e){return Q.includes(e.id)})),t=q.filter((function(e){return!Q.includes(e.id)}));V(vi(Object(Ge.a)(t))),W(vi([].concat(Object(Ge.a)(z),Object(Ge.a)(e)))),ee(null),Y(null)}}})}),Object(we.jsx)("div",{className:"p-col"})]})]}):Object(we.jsx)("div",{className:"p-grid p-justify-center",children:Object(we.jsx)("div",{className:"p-col-12 p-mt-4 p-mb-2",children:Object(we.jsx)(lt.a,{severity:"warn",text:"Adicione um ou mais Utilizadores"})})})]})]})]}),Object(we.jsx)(ct.a,{className:"p-mt-4 p-mb-4",right:function(){return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{type:"button",label:"Voltar",icon:"pi pi-left",className:"p-button-secondary p-mr-4",disabled:!!j,onClick:ue}),Object(we.jsx)(nt.a,{type:"submit",label:"Gravar",icon:j?"pi pi-save pi-spinner":"pi pi-save",disabled:!!j})]})}})]})})));var xi=Object(l.b)((function(e){return{}}))(Object(p.h)((function(e){var t=Object(n.useContext)(Ae).core,a=(e.history,e.dispatch,Object(p.g)().id),i=Object(n.useState)(!1),c=Object(u.a)(i,2),s=(c[0],c[1]),o=Object(n.useState)(null),l=Object(u.a)(o,2),j=l[0],b=l[1],m=(Object(n.useRef)(null),t.API_URL);Object(n.useEffect)((function(){a?O():b({})}),[]);var O=function(){var e=Qe(m+"/security"),t={id:a};s(!0),e.getOne("groups",t).then((function(e){var t=Object(d.a)({},e.data);b(t),s(!1)})).catch((function(e){s(!1),console.log(e)}))};return Object(we.jsx)(r.a.Fragment,{children:j?Object(we.jsx)(gi,{data:j}):Object(we.jsx)("div",{children:"loading..."})})}))),yi={filters:{},first:0,rows:20,page:0,sortField:"id",sortOrder:1};var Ni=Object(l.b)((function(e){return{loading:e.loading,auth:e.auth,filters:e.filters}}))(Object(p.h)((function(e){var t=e.history,a=e.parametersTable||"site",i=Object(n.useContext)(Ae).core,c=Object(n.useRef)(null),s=Object(n.useState)(!1),o=Object(u.a)(s,2),l=o[0],j=o[1],b=Object(n.useState)([]),p=Object(u.a)(b,2),m=p[0],O=p[1],f=Object(n.useState)(null),h=Object(u.a)(f,2),v=h[0],g=h[1],x=Object(n.useState)(!1),y=Object(u.a)(x,2),N=y[0],_=y[1],C=Object(n.useState)(),w=Object(u.a)(C,2),S=w[0],k=w[1],F=Object(n.useState)(Object(d.a)({},yi)),E=Object(u.a)(F,2),R=E[0],P=E[1],L=Object(n.useRef)(!1),A=Object(n.useRef)(null),I=i.API_URL;Object(n.useEffect)((function(){var e,a;if(!L.current&&null!==(e=t.location)&&void 0!==e&&null!==(a=e.state)&&void 0!==a&&a.searchParams){L.current=!0;var i=Object(d.a)({},t.location.state.searchParams);P(i)}else M()}),[R]);var T=function(){var e={pathname:"/settings/parameters/create",state:{from:t.location.pathname,previousSearchParams:Object(d.a)({},R)}};t.push(e)},D=function(){Object(Jt.a)({message:" Deseja eliminar o(s) registo(s) selecionado(s)?",header:"Confirma\xe7\xe3o",icon:"pi pi-exclamation-triangle",acceptLabel:"Sim",rejectLabel:"N\xe3o",accept:function(){var e=Qe(I+"/portal/settings"),t={ids:v.filter((function(e){return!e.read_only})).map((function(e){return e.id}))};e.deleteMany(a,t).then((function(e){c.current.show({life:3e3,severity:"success",summary:"Eliminar Registo(s)",detail:"Registo(s) eliminado(s) com sucesso"}),M()})).catch((function(e){c.current.show({life:3e3,severity:"error",summary:"Eliminar Registo(s)",detail:"Ocorreu um erro ao eliminar o(s) registo(s)"})})).finally((function(){}))},reject:function(){}})},M=function(e){var t=Qe(I+"/portal/settings"),i={};e?Object.entries(e).forEach((function(e){var t=Object(u.a)(e,2),a=t[0],c=t[1];i[a]=c.value})):R.filters&&Object.entries(R.filters).forEach((function(e){var t=Object(u.a)(e,2),a=t[0],c=t[1];i[a]=c.value}));var n={pagination:{page:R.page+1,perPage:R.rows},sort:{field:R.sortField,order:-1==R.sortOrder?"Desc":"Asc"},filter:i};j(!0),t.getList(a,n).then((function(e){g(null),O(Object(d.a)(Object(d.a)({},e),{},{page:R.page}))})).catch((function(e){c.current.show({life:3e3,severity:"error",summary:"Pesquisa de Sistemas de Coordenadas",detail:"Ocorreu um erro ao realizar a pesquisa"})})).finally((function(){j(!1)}))},U=function(e){P(Object(d.a)({},yi))};return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)("div",{className:"p-col-12",children:Object(we.jsx)("h3",{children:"Par\xe2metros"})}),Object(we.jsxs)("div",{className:"p-grid p-fluid viewer-list",children:[Object(we.jsx)(tt.a,{ref:c,baseZIndex:2e3}),Object(we.jsxs)("div",{className:"card",children:[Object(we.jsx)(ct.a,{className:"p-mb-4",left:function(){return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{label:"Novo",icon:"pi pi-plus",className:"p-button-success p-mr-2",onClick:T}),Object(we.jsx)(nt.a,{label:"Eliminar",icon:"pi pi-trash",className:"p-button-danger",onClick:D,disabled:!v||!v.length})]})},right:function(){return Object(we.jsx)(r.a.Fragment,{children:Object(we.jsx)(nt.a,{label:"Limpar",icon:"pi pi-times",className:"p-button-help p-mr-2",onClick:U})})}}),Object(we.jsxs)(gt.a,{ref:A,value:m?m.data:[],lazy:!0,selectionMode:"checkbox",selection:v,onSelectionChange:function(e){g(e.value.filter((function(e){return!e.read_only})))},paginator:!0,first:R.first,rows:R.rows,totalRecords:m.total,onPage:function(e){var t=Object(d.a)(Object(d.a)({},R),e);P(t)},onSort:function(e){var t=Object(d.a)(Object(d.a)({},R),e);P(t)},sortField:R.sortField,sortOrder:R.sortOrder,filters:R.filters,onFilter:function(e){var t=Object(d.a)(Object(d.a)({},R),e);t.first=0,P(t)},loading:l,emptyMessage:"N\xe3o foram encontrados registos.",children:[Object(we.jsx)(xt.a,{selectionMode:"multiple",headerStyle:{width:"3rem"}}),Object(we.jsx)(xt.a,{field:"id",header:"Id",sortable:!0,filter:!0,filterPlaceholder:"Id",headerStyle:{width:"6rem"}}),Object(we.jsx)(xt.a,{field:"code",header:"C\xf3digo",sortable:!0,filter:!0,filterPlaceholder:"C\xf3digo",style:{wordBreak:"break-all"}}),Object(we.jsx)(xt.a,{field:"name",header:"Nome",sortable:!0,filter:!0,filterPlaceholder:"Nome",style:{wordBreak:"break-all"}}),Object(we.jsx)(xt.a,{field:"notes",header:"Descri\xe7\xe3o",sortable:!0,filter:!0,filterPlaceholder:"Descri\xe7\xe3o",style:{wordBreak:"break-all"}}),Object(we.jsx)(xt.a,{header:"Valor",body:function(e){return""===(e.setting_value||"")?null:Object(we.jsx)(nt.a,{label:"Ver",className:"p-button-link",onClick:function(){k(e.setting_value),_(!0)}})},headerStyle:{width:"5rem"}}),Object(we.jsx)(xt.a,{body:function(e){return e.read_only?Object(we.jsx)(nt.a,{icon:"fas fa-lock",className:"p-button-rounded p-button-secondary",disabled:!0}):Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{icon:"pi pi-pencil",className:"p-button-rounded p-button-success p-mr-2",onClick:function(){return function(e){var a={pathname:"/settings/parameters/edit/".concat(e.id),state:{from:t.location.pathname,previousSearchParams:Object(d.a)({},R)}};t.push(a)}(e)}}),Object(we.jsx)(nt.a,{icon:"pi pi-trash",className:"p-button-rounded p-button-warning",onClick:function(){return t=e,void Object(Jt.a)({message:" Deseja eliminar o registo selecionado?",header:"Confirma\xe7\xe3o",icon:"pi pi-exclamation-triangle",acceptLabel:"Sim",rejectLabel:"N\xe3o",accept:function(){var e=Qe(I+"/portal/settings"),i={id:t.id};e.delete(a,i).then((function(e){c.current.show({life:3e3,severity:"success",summary:"Eliminar Registo",detail:"Registo eliminado com sucesso"}),M()})).catch((function(e){c.current.show({life:3e3,severity:"error",summary:"Eliminar Registo",detail:"Ocorreu um erro ao eliminar o registo"})})).finally((function(){}))},reject:function(){}});var t}})]})},style:{textAlign:"center"}})]}),Object(we.jsx)(ta.a,{header:"Valor",visible:N,style:{width:"50vw"},onHide:function(){return _(!1)},children:Object(we.jsx)("div",{dangerouslySetInnerHTML:{__html:S}})})]})]})]})})));var _i=Object(l.b)((function(e){return{}}))(Object(p.h)((function(e){var t=e.history,a=(e.dispatch,e.parametersTable||"site"),i=Object(n.useState)(!1),c=Object(u.a)(i,2),s=(c[0],c[1],Object(n.useState)(!1)),o=Object(u.a)(s,2),l=o[0],j=o[1],b=Object(n.useState)(e.data||{}),p=Object(u.a)(b,2),m=p[0],O=p[1],h=Object(n.useState)(""),v=Object(u.a)(h,2),g=(v[0],v[1],Object(n.useRef)(null)),x=Object(n.useContext)(Ae).core.API_URL,y=Object(et.b)({defaultValues:Object(d.a)({},m)}),N=y.register,_=(y.control,y.handleSubmit),C=(y.watch,y.formState.errors),w=(y.setValue,function(){var e={pathname:t.location.state.from,state:{searchParams:Object(d.a)({},t.location.state.previousSearchParams)}};t.replace(e)}),S=function(e,t){if(e&&e[t])return"required"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:e[t].message||"Campo obrigat\xf3rio"}):"maxLength"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:e[t].message||"O n\xfamero de caracteres \xe9 superior \xe0 dimens\xe3o m\xe1xima permitida"}):"pattern"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:e[t].message||"Formato inv\xe1lido"}):Object(we.jsx)("small",{className:"p-error",children:e[t].message})};return Object(we.jsxs)("form",{onSubmit:_((function(e){var t={code:e.code,name:e.name,notes:e.notes,setting_value:e.setting_value};j(!0);var i=Qe(x+"/portal/settings");if(m.id){var c={id:m.id,data:Object(d.a)({},t)};i.update(a,c).then((function(e){g.current.show({life:3e3,severity:"success",summary:"Editar Registo",detail:"Registo alterado com sucesso"})})).catch((function(e){g.current.show({life:3e3,severity:"error",summary:"Editar Registo",detail:"Ocorreu um erro ao alterar o registo"})})).finally((function(){j(!1)}))}else{var n={data:Object(d.a)({},t)};i.create(a,n).then((function(e){O(Object(d.a)(Object(d.a)({},m),{},{id:e.data.id})),g.current.show({life:5e3,severity:"success",summary:"Criar Registo",detail:"Registo criada com sucesso"})})).catch((function(e){g.current.show({life:5e3,severity:"error",summary:"Criar Registo",detail:"Ocorreu um erro ao criar o registo"})})).finally((function(){j(!1)}))}})),children:[Object(we.jsx)(tt.a,{ref:g,baseZIndex:2e3}),Object(we.jsxs)("div",{className:"p-fluid p-formgrid p-grid",children:[Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-2",children:[Object(we.jsx)("label",{htmlFor:"id",children:"Id"}),Object(we.jsx)(f.a,{id:"id",type:"text",value:m.id||"",disabled:!0})]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-2",children:[Object(we.jsx)("label",{htmlFor:"code",children:"C\xf3digo"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"code",name:"code"},N("code",{required:"Campo obrigat\xf3rio."})),{},{autoFocus:!0,className:Object(dt.a)({"p-invalid":C.code})})),S(C,"code")]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-8",children:[Object(we.jsx)("label",{htmlFor:"name",children:"Designa\xe7\xe3o"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"name",name:"name"},N("name",{required:"Campo obrigat\xf3rio."})),{},{autoFocus:!0,className:Object(dt.a)({"p-invalid":C.name})})),S(C,"name")]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-12",children:[Object(we.jsx)("label",{htmlFor:"notes",children:"Descri\xe7\xe3o"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"notes",name:"notes"},N("notes")),{},{autoFocus:!0})),S(C,"notes")]}),Object(we.jsxs)("div",{className:"p-field p-col-12",children:[Object(we.jsx)("label",{htmlFor:"setting_value",children:"Valor"}),Object(we.jsx)(mt.a,Object(d.a)(Object(d.a)({rows:5,id:"notes",name:"setting_value"},N("setting_value",{required:"Campo obrigat\xf3rio."})),{},{autoFocus:!0,className:Object(dt.a)({"p-invalid":C.setting_value})})),S(C,"setting_value")]})]}),Object(we.jsx)(ct.a,{className:"p-mt-4 p-mb-4",right:function(){return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{type:"button",label:"Voltar",icon:"pi pi-left",className:"p-button-secondary p-mr-4",disabled:!!l,onClick:w}),Object(we.jsx)(nt.a,{type:"submit",label:"Gravar",icon:l?"pi pi-save pi-spinner":"pi pi-save",disabled:!!l})]})}})]})})));var Ci=Object(l.b)((function(e){return{}}))(Object(p.h)((function(e){var t=Object(n.useContext)(Ae).core,a=(e.history,e.dispatch,e.parametersTable||"site"),i=Object(p.g)().id,c=Object(n.useState)(!1),s=Object(u.a)(c,2),o=(s[0],s[1]),l=Object(n.useState)(null),d=Object(u.a)(l,2),j=d[0],b=d[1],m=Object(n.useState)([]),O=Object(u.a)(m,2),f=(O[0],O[1],Object(n.useRef)(null),t.API_URL);Object(n.useEffect)((function(){i?h():b({})}),[]);var h=function(){var e=Qe(f+"/portal/settings"),t={id:i};o(!0),e.getOne(a,t).then((function(e){var t,a,i,c,n,r,s,l,d,u,j,p,m,O,f,h,v,g,x,y,N,_,C,w,S,k,F,E,R={id:null===(t=e.data)||void 0===t?void 0:t.id,code:null===(a=e.data)||void 0===a?void 0:a.code,name:null===(i=e.data)||void 0===i?void 0:i.name,description:null===(c=e.data)||void 0===c?void 0:c.description,srid:null===(n=e.data)||void 0===n||null===(r=n.config_json)||void 0===r?void 0:r.srid,label:null===(s=e.data)||void 0===s||null===(l=s.config_json)||void 0===l?void 0:l.label,defs:null===(d=e.data)||void 0===d||null===(u=d.config_json)||void 0===u?void 0:u.defs,minx:null!==(j=e.data)&&void 0!==j&&null!==(p=j.config_json)&&void 0!==p&&p.extent?null===(m=e.data)||void 0===m||null===(O=m.config_json)||void 0===O?void 0:O.extent.split(" ")[0]:null,miny:null!==(f=e.data)&&void 0!==f&&null!==(h=f.config_json)&&void 0!==h&&h.extent?null===(v=e.data)||void 0===v||null===(g=v.config_json)||void 0===g?void 0:g.extent.split(" ")[1]:null,maxx:null!==(x=e.data)&&void 0!==x&&null!==(y=x.config_json)&&void 0!==y&&y.extent?null===(N=e.data)||void 0===N||null===(_=N.config_json)||void 0===_?void 0:_.extent.split(" ")[2]:null,maxy:null!==(C=e.data)&&void 0!==C&&null!==(w=C.config_json)&&void 0!==w&&w.extent?null===(S=e.data)||void 0===S||null===(k=S.config_json)||void 0===k?void 0:k.extent.split(" ")[3]:null,precision:null===(F=e.data)||void 0===F||null===(E=F.config_json)||void 0===E?void 0:E.precision};b(R),o(!1)})).catch((function(e){o(!1),console.log(e)}))};return Object(we.jsx)(r.a.Fragment,{children:j?Object(we.jsx)(_i,{data:j}):Object(we.jsx)("div",{children:"loading..."})})}))),wi={filters:{},first:0,rows:20,page:0,sortField:"id",sortOrder:1};var Si=Object(l.b)((function(e){return{loading:e.loading,auth:e.auth,filters:e.filters}}))(Object(p.h)((function(e){var t=e.history,a=Object(n.useContext)(Ae).core,i=Object(n.useRef)(null),c=Object(n.useState)(!1),s=Object(u.a)(c,2),o=s[0],l=s[1],j=Object(n.useState)([]),b=Object(u.a)(j,2),p=b[0],m=b[1],O=Object(n.useState)(null),f=Object(u.a)(O,2),h=f[0],v=f[1],g=Object(n.useState)(!1),x=Object(u.a)(g,2),y=x[0],N=x[1],_=Object(n.useState)(),C=Object(u.a)(_,2),w=C[0],S=C[1],k=Object(n.useState)(Object(d.a)({},wi)),F=Object(u.a)(k,2),E=F[0],R=F[1],P=Object(n.useRef)(!1),L=Object(n.useRef)(null),A=a.API_URL;Object(n.useEffect)((function(){var e,a;if(!P.current&&null!==(e=t.location)&&void 0!==e&&null!==(a=e.state)&&void 0!==a&&a.searchParams){P.current=!0;var i=Object(d.a)({},t.location.state.searchParams);R(i)}else D()}),[E]);var I=function(){var e={pathname:"/settings/coordinate_systems/create",state:{from:t.location.pathname,previousSearchParams:Object(d.a)({},E)}};t.push(e)},T=function(){Object(Jt.a)({message:" Deseja eliminar o(s) registo(s) selecionado(s)?",header:"Confirma\xe7\xe3o",icon:"pi pi-exclamation-triangle",acceptLabel:"Sim",rejectLabel:"N\xe3o",accept:function(){var e=Qe(A+"/portal/lists"),t={ids:h.filter((function(e){return!e.read_only})).map((function(e){return e.id}))};e.deleteMany("coordinate_systems",t).then((function(e){i.current.show({life:3e3,severity:"success",summary:"Eliminar Registo(s)",detail:"Registo(s) eliminado(s) com sucesso"}),D()})).catch((function(e){i.current.show({life:3e3,severity:"error",summary:"Eliminar Registo(s)",detail:"Ocorreu um erro ao eliminar o(s) registo(s)"})})).finally((function(){}))},reject:function(){}})},D=function(e){var t=Qe(A+"/portal/lists"),a={};e?Object.entries(e).forEach((function(e){var t=Object(u.a)(e,2),i=t[0],c=t[1];a[i]=c.value})):E.filters&&Object.entries(E.filters).forEach((function(e){var t=Object(u.a)(e,2),i=t[0],c=t[1];a[i]=c.value}));var c={pagination:{page:E.page+1,perPage:E.rows},sort:{field:E.sortField,order:-1==E.sortOrder?"Desc":"Asc"},filter:a};l(!0),t.getList("coordinate_systems",c).then((function(e){v(null),m(Object(d.a)(Object(d.a)({},e),{},{page:E.page}))})).catch((function(e){i.current.show({life:3e3,severity:"error",summary:"Pesquisa de Sistemas de Coordenadas",detail:"Ocorreu um erro ao realizar a pesquisa"})})).finally((function(){l(!1)}))},M=function(e){R(Object(d.a)({},wi))};return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)("div",{className:"p-col-12",children:Object(we.jsx)("h3",{children:"Sistemas de Coordenadas"})}),Object(we.jsxs)("div",{className:"p-grid p-fluid viewer-list",children:[Object(we.jsx)(tt.a,{ref:i,baseZIndex:2e3}),Object(we.jsxs)("div",{className:"card",children:[Object(we.jsx)(ct.a,{className:"p-mb-4",left:function(){return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{label:"Novo",icon:"pi pi-plus",className:"p-button-success p-mr-2",onClick:I}),Object(we.jsx)(nt.a,{label:"Eliminar",icon:"pi pi-trash",className:"p-button-danger",onClick:T,disabled:!h||!h.length})]})},right:function(){return Object(we.jsx)(r.a.Fragment,{children:Object(we.jsx)(nt.a,{label:"Limpar",icon:"pi pi-times",className:"p-button-help p-mr-2",onClick:M})})}}),Object(we.jsxs)(gt.a,{ref:L,value:p?p.data:[],lazy:!0,selectionMode:"checkbox",selection:h,onSelectionChange:function(e){v(e.value.filter((function(e){return!e.read_only})))},paginator:!0,first:E.first,rows:E.rows,totalRecords:p.total,onPage:function(e){var t=Object(d.a)(Object(d.a)({},E),e);R(t)},onSort:function(e){var t=Object(d.a)(Object(d.a)({},E),e);R(t)},sortField:E.sortField,sortOrder:E.sortOrder,filters:E.filters,onFilter:function(e){var t=Object(d.a)(Object(d.a)({},E),e);t.first=0,R(t)},loading:o,emptyMessage:"N\xe3o foram encontrados registos.",children:[Object(we.jsx)(xt.a,{selectionMode:"multiple",headerStyle:{width:"3rem"}}),Object(we.jsx)(xt.a,{field:"id",header:"Id",sortable:!0,filter:!0,filterPlaceholder:"Id"}),Object(we.jsx)(xt.a,{field:"code",header:"C\xf3digo",sortable:!0,filter:!0,filterPlaceholder:"C\xf3digo",style:{wordBreak:"break-all"}}),Object(we.jsx)(xt.a,{field:"name",header:"Nome",sortable:!0,filter:!0,filterPlaceholder:"Nome",style:{wordBreak:"break-all"}}),Object(we.jsx)(xt.a,{field:"description",header:"Descri\xe7\xe3o",sortable:!0,filter:!0,filterPlaceholder:"Descri\xe7\xe3o",style:{wordBreak:"break-all"}}),Object(we.jsx)(xt.a,{header:"Defini\xe7\xe3o",body:function(e){var t;return""===((null===e||void 0===e||null===(t=e.config_json)||void 0===t?void 0:t.defs)||"")?null:Object(we.jsx)(nt.a,{label:"Ver",className:"p-button-link",onClick:function(){var t;S(null===e||void 0===e||null===(t=e.config_json)||void 0===t?void 0:t.defs),N(!0)}})},headerStyle:{width:"5rem"}}),Object(we.jsx)(xt.a,{body:function(e){return e.read_only?Object(we.jsx)(nt.a,{icon:"fas fa-lock",className:"p-button-rounded p-button-secondary",disabled:!0}):Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{icon:"pi pi-pencil",className:"p-button-rounded p-button-success p-mr-2",onClick:function(){return function(e){var a={pathname:"/settings/coordinate_systems/edit/".concat(e.id),state:{from:t.location.pathname,previousSearchParams:Object(d.a)({},E)}};t.push(a)}(e)}}),Object(we.jsx)(nt.a,{icon:"pi pi-trash",className:"p-button-rounded p-button-warning",onClick:function(){return t=e,void Object(Jt.a)({message:" Deseja eliminar o registo selecionado?",header:"Confirma\xe7\xe3o",icon:"pi pi-exclamation-triangle",acceptLabel:"Sim",rejectLabel:"N\xe3o",accept:function(){var e=Qe(A+"/portal/lists"),a={id:t.id};e.delete("coordinate_systems",a).then((function(e){i.current.show({life:3e3,severity:"success",summary:"Eliminar Registo",detail:"Registo eliminado com sucesso"}),D()})).catch((function(e){i.current.show({life:3e3,severity:"error",summary:"Eliminar Registo",detail:"Ocorreu um erro ao eliminar o registo"})})).finally((function(){}))},reject:function(){}});var t}})]})},style:{textAlign:"center"}})]}),Object(we.jsx)(ta.a,{header:"Defini\xe7\xe3o",visible:y,style:{width:"50vw"},onHide:function(){return N(!1)},children:Object(we.jsx)("div",{dangerouslySetInnerHTML:{__html:w}})})]})]})]})})));var ki=Object(l.b)((function(e){return{}}))(Object(p.h)((function(e){var t=e.history,a=(e.dispatch,Object(n.useState)(!1)),i=Object(u.a)(a,2),c=(i[0],i[1],Object(n.useState)(!1)),s=Object(u.a)(c,2),o=s[0],l=s[1],j=Object(n.useState)(e.data||{}),b=Object(u.a)(j,2),p=b[0],m=b[1],O=Object(n.useRef)(null),h=Object(n.useContext)(Ae).core.API_URL,v=Object(et.b)({defaultValues:Object(d.a)({},p)}),g=v.register,x=v.control,y=v.handleSubmit,N=(v.watch,v.formState.errors),_=(v.setValue,function(){var e={pathname:t.location.state.from,state:{searchParams:Object(d.a)({},t.location.state.previousSearchParams)}};t.replace(e)}),C=function(e,t){if(e&&e[t])return"required"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:e[t].message||"Campo obrigat\xf3rio"}):"maxLength"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:e[t].message||"O n\xfamero de caracteres \xe9 superior \xe0 dimens\xe3o m\xe1xima permitida"}):"pattern"===e[t].type?Object(we.jsx)("small",{className:"p-error",children:e[t].message||"Formato inv\xe1lido"}):Object(we.jsx)("small",{className:"p-error",children:e[t].message})};return Object(we.jsxs)("form",{onSubmit:y((function(e){var t={code:e.code,name:e.name,description:e.description,config_json:{code:e.code,defs:e.defs,description:e.description,extent:"".concat(e.minx," ").concat(e.miny," ").concat(e.maxx," ").concat(e.maxy),precision:e.precision,srid:e.srid,title:e.name,label:e.label}};l(!0);var a=Qe(h+"/portal/lists");if(p.id){var i={id:p.id,data:Object(d.a)({},t)};a.update("coordinate_systems",i).then((function(e){O.current.show({life:3e3,severity:"success",summary:"Editar Registo",detail:"Registo alterado com sucesso"})})).catch((function(e){O.current.show({life:3e3,severity:"error",summary:"Editar Registo",detail:"Ocorreu um erro ao alterar o registo"})})).finally((function(){l(!1)}))}else{var c={data:Object(d.a)({},t)};a.create("coordinate_systems",c).then((function(e){m(Object(d.a)(Object(d.a)({},p),{},{id:e.data.id})),O.current.show({life:5e3,severity:"success",summary:"Criar Registo",detail:"Registo criada com sucesso"})})).catch((function(e){O.current.show({life:5e3,severity:"error",summary:"Criar Registo",detail:"Ocorreu um erro ao criar o registo"})})).finally((function(){l(!1)}))}})),children:[Object(we.jsx)(tt.a,{ref:O,baseZIndex:2e3}),Object(we.jsxs)("div",{className:"p-fluid p-formgrid p-grid",children:[Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-2",children:[Object(we.jsx)("label",{htmlFor:"id",children:"Id"}),Object(we.jsx)(f.a,{id:"id",type:"text",value:p.id||"",disabled:!0})]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-2",children:[Object(we.jsx)("label",{htmlFor:"code",children:"C\xf3digo"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"code",name:"code"},g("code",{required:"Campo obrigat\xf3rio."})),{},{autoFocus:!0,className:Object(dt.a)({"p-invalid":N.code})})),C(N,"code")]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-2",children:[Object(we.jsx)("label",{htmlFor:"srid",children:"SRID"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"srid",name:"srid"},g("srid",{required:!0,pattern:{value:/^[0-9]+$/,message:"Formato inv\xe1lido"}})),{},{autoFocus:!0,className:Object(dt.a)({"p-invalid":N.srid})})),C(N,"srid")]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-6",children:[Object(we.jsx)("label",{htmlFor:"name",children:"Designa\xe7\xe3o"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"name",name:"name"},g("name",{required:"This is required."})),{},{autoFocus:!0,className:Object(dt.a)({"p-invalid":N.name})})),C(N,"name")]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-4",children:[Object(we.jsx)("label",{htmlFor:"label",children:"Label"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"label",name:"label"},g("label")),{},{autoFocus:!0,className:Object(dt.a)({"p-invalid":N.label})})),C(N,"label")]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-8",children:[Object(we.jsx)("label",{htmlFor:"description",children:"Descri\xe7\xe3o"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"description",name:"description"},g("description",{required:"This is required."})),{},{autoFocus:!0,className:Object(dt.a)({"p-invalid":N.description})})),C(N,"description")]}),Object(we.jsxs)("div",{className:"p-field p-col-12",children:[Object(we.jsx)("label",{htmlFor:"defs",children:"Defini\xe7\xe3o"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"defs",name:"defs"},g("defs")),{},{autoFocus:!0}))]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-3",children:[Object(we.jsx)("label",{htmlFor:"minx",children:"Min X"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"minx",name:"minx"},g("minx",{required:"Campo obrigat\xf3rio.",pattern:{value:/^[+-]?((\d+(\.\d*)?)|(\.\d+))$/,message:"Formato inv\xe1lido"},min:-180,max:180})),{},{autoFocus:!0,className:Object(dt.a)({"p-invalid":N.minx})})),C(N,"minx")]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-3",children:[Object(we.jsx)("label",{htmlFor:"miny",children:"Min Y"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"miny",name:"minx"},g("miny",{required:"Campo obrigat\xf3rio.",pattern:{value:/^[+-]?((\d+(\.\d*)?)|(\.\d+))$/,message:"Formato inv\xe1lido"},min:-90,max:90})),{},{autoFocus:!0,className:Object(dt.a)({"p-invalid":N.miny})})),C(N,"miny")]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-3",children:[Object(we.jsx)("label",{htmlFor:"maxx",children:"Max X"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"maxx",name:"maxx"},g("maxx",{required:"Campo obrigat\xf3rio.",pattern:{value:/^[+-]?((\d+(\.\d*)?)|(\.\d+))$/,message:"Formato inv\xe1lido"}})),{},{autoFocus:!0,className:Object(dt.a)({"p-invalid":N.maxx})})),C(N,"maxx")]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-3",children:[Object(we.jsx)("label",{htmlFor:"maxy",children:"Max Y"}),Object(we.jsx)(f.a,Object(d.a)(Object(d.a)({id:"maxy",name:"minx"},g("maxy",{required:"Campo obrigat\xf3rio.",pattern:{value:/^[+-]?((\d+(\.\d*)?)|(\.\d+))$/,message:"Formato inv\xe1lido"}})),{},{autoFocus:!0,className:Object(dt.a)({"p-invalid":N.maxy})})),C(N,"maxy")]}),Object(we.jsxs)("div",{className:"p-field p-col-12 p-md-3",children:[Object(we.jsx)("label",{htmlFor:"precision",children:"Precis\xe3o"}),Object(we.jsx)(et.a,{name:"precision",control:x,render:function(e){return Object(we.jsx)(Ve.a,{id:"precision",value:e.field.value,options:[0,1,2,3,4,5,6,7,8,9,10].map((function(e){return{label:e+" casas decimais",value:Math.pow(10,e)}})),onChange:function(t){return e.field.onChange(t.value)},showClear:!0,className:Object(dt.a)({"p-invalid":N.precision})})}})]})]}),Object(we.jsx)(ct.a,{className:"p-mt-4 p-mb-4",right:function(){return Object(we.jsxs)(r.a.Fragment,{children:[Object(we.jsx)(nt.a,{type:"button",label:"Voltar",icon:"pi pi-left",className:"p-button-secondary p-mr-4",disabled:!!o,onClick:_}),Object(we.jsx)(nt.a,{type:"submit",label:"Gravar",icon:o?"pi pi-save pi-spinner":"pi pi-save",disabled:!!o})]})}})]})})));var Fi=Object(l.b)((function(e){return{}}))(Object(p.h)((function(e){var t=Object(n.useContext)(Ae).core,a=(e.history,e.dispatch,Object(p.g)().id),i=Object(n.useState)(!1),c=Object(u.a)(i,2),s=(c[0],c[1]),o=Object(n.useState)(null),l=Object(u.a)(o,2),d=l[0],j=l[1],b=Object(n.useState)([]),m=Object(u.a)(b,2),O=(m[0],m[1],Object(n.useRef)(null),t.API_URL);Object(n.useEffect)((function(){a?f():j({})}),[]);var f=function(){var e=Qe(O+"/portal/lists"),t={id:a};s(!0),e.getOne("coordinate_systems",t).then((function(e){var t,a,i,c,n,r,o,l,d,u,b,p,m,O,f,h,v,g,x,y,N,_,C,w,S,k,F,E,R={id:null===(t=e.data)||void 0===t?void 0:t.id,code:null===(a=e.data)||void 0===a?void 0:a.code,name:null===(i=e.data)||void 0===i?void 0:i.name,description:null===(c=e.data)||void 0===c?void 0:c.description,srid:null===(n=e.data)||void 0===n||null===(r=n.config_json)||void 0===r?void 0:r.srid,label:null===(o=e.data)||void 0===o||null===(l=o.config_json)||void 0===l?void 0:l.label,defs:null===(d=e.data)||void 0===d||null===(u=d.config_json)||void 0===u?void 0:u.defs,minx:null!==(b=e.data)&&void 0!==b&&null!==(p=b.config_json)&&void 0!==p&&p.extent?null===(m=e.data)||void 0===m||null===(O=m.config_json)||void 0===O?void 0:O.extent.split(" ")[0]:null,miny:null!==(f=e.data)&&void 0!==f&&null!==(h=f.config_json)&&void 0!==h&&h.extent?null===(v=e.data)||void 0===v||null===(g=v.config_json)||void 0===g?void 0:g.extent.split(" ")[1]:null,maxx:null!==(x=e.data)&&void 0!==x&&null!==(y=x.config_json)&&void 0!==y&&y.extent?null===(N=e.data)||void 0===N||null===(_=N.config_json)||void 0===_?void 0:_.extent.split(" ")[2]:null,maxy:null!==(C=e.data)&&void 0!==C&&null!==(w=C.config_json)&&void 0!==w&&w.extent?null===(S=e.data)||void 0===S||null===(k=S.config_json)||void 0===k?void 0:k.extent.split(" ")[3]:null,precision:null===(F=e.data)||void 0===F||null===(E=F.config_json)||void 0===E?void 0:E.precision};j(R),s(!1)})).catch((function(e){s(!1),console.log(e)}))};return Object(we.jsx)(r.a.Fragment,{children:d?Object(we.jsx)(ki,{data:d}):Object(we.jsx)("div",{children:"loading..."})})})));a(50),a(467),a(468),a(469),a(470),a(471),a(472),a(473),a(474),a(475),a(476),a(477);var Ei=function(e){var t=e.core,a=e.history,i=(e.dispatch,e.backoffice),c=e.sidebar,r=e.onWrapperClick,s=e.onSidebarClick,o=e.onToggleMenu,l=(e.onLayoutModeChange,e.onLayoutColorModeChange,t.CLIENT_URL),j=Object(n.useState)("outlined"),O=Object(u.a)(j,2),f=O[0],h=(O[1],Object(n.useState)(!1)),v=Object(u.a)(h,2),g=v[0],x=(v[1],"dark"===i.layoutColorMode?l+"assets/images/logo-light.png":l+"assets/images/logo.png"),y=b()("layout-wrapper",{"layout-overlay":"overlay"===i.layoutMode,"layout-static":"static"===i.layoutMode,"layout-static-sidebar-inactive":i.staticMenuInactive&&"static"===i.layoutMode,"layout-overlay-sidebar-active":i.overlayMenuActive&&"overlay"===i.layoutMode,"layout-mobile-sidebar-active":i.mobileMenuActive,"p-input-filled":"filled"===f,"p-ripple-disabled":!1===g}),N=b()("layout-sidebar",{"layout-sidebar-dark":"dark"===i.layoutColorMode,"layout-sidebar-light":"light"===i.layoutColorMode}),_=[];return i&&i.config_json&&i.config_json.menu&&(_=i.config_json.menu),Object(we.jsxs)("div",{className:y,onClick:r,children:[Object(we.jsx)(Ie,{onToggleMenu:o}),Object(we.jsx)(m.a,{classNames:"layout-sidebar",timeout:{enter:200,exit:200},in:!(window.innerWidth>1024)||("static"===i.layoutMode?!i.staticMenuInactive:"overlay"!==i.layoutMode||i.overlayMenuActive),unmountOnExit:!0,children:Object(we.jsxs)("div",{ref:c,className:N,onClick:s,children:[Object(we.jsx)("div",{className:"layout-logo",style:{cursor:"pointer"},onClick:function(){return a.push("/")},children:Object(we.jsx)("img",{alt:"Logo",src:x})}),Object(we.jsx)(Ue,{core:e.core,dispatch:e.dispatch,auth:e.auth}),Object(we.jsx)(Me,{model:_,onMenuItemClick:function(e){e.item.items}})]})}),Object(we.jsxs)("div",{className:"layout-main",children:[Object(we.jsx)(p.a,{path:"/account",component:bt}),Object(we.jsx)(p.a,{path:"/notifications/edit/:id",component:ht}),Object(we.jsx)(p.a,{path:"/notifications/list",render:function(e){return Object(we.jsx)(Ct,Object(d.a)({},e))}}),Object(we.jsx)(p.a,{path:"/",exact:!0,component:Ye}),Object(we.jsx)(p.a,{path:"/dashboard",exact:!0,component:Ye}),Object(we.jsx)(p.a,{path:"/viewers/create",component:Zt}),Object(we.jsx)(p.a,{path:"/viewers/edit/:id",component:Zt}),Object(we.jsx)(p.a,{path:"/viewers/list",render:function(e){return Object(we.jsx)($t,Object(d.a)({},e))}}),Object(we.jsx)(p.a,{path:"/prints/create",component:Ha}),Object(we.jsx)(p.a,{path:"/prints/edit/:id",component:Ha}),Object(we.jsx)(p.a,{path:"/prints/list",render:function(e){return Object(we.jsx)(Wa,Object(d.a)({},e))}}),Object(we.jsx)(p.a,{path:"/prints/groups/create",component:Qa}),Object(we.jsx)(p.a,{path:"/prints/groups/edit/:id",component:Qa}),Object(we.jsx)(p.a,{path:"/prints/groups/list",render:function(e){return Object(we.jsx)(ti,Object(d.a)({},e))}}),Object(we.jsx)(p.a,{path:"/prints/elements/create",component:ii}),Object(we.jsx)(p.a,{path:"/prints/elements/edit/:id",component:ii}),Object(we.jsx)(p.a,{path:"/prints/elements/list",render:function(e){return Object(we.jsx)(ni,Object(d.a)({},e))}}),Object(we.jsx)(p.a,{path:"/modules/:id",render:function(e){return Object(we.jsx)(pt,Object(d.a)(Object(d.a)({},e),{},{core:t,module:e.match.params.id}))}}),Object(we.jsx)(p.a,{path:"/security/users/create",component:ui}),Object(we.jsx)(p.a,{path:"/security/users/edit/:id",component:ui}),Object(we.jsx)(p.a,{path:"/security/users/list",render:function(e){return Object(we.jsx)(si,Object(d.a)({},e))}}),Object(we.jsx)(p.a,{path:"/security/roles/create",component:mi}),Object(we.jsx)(p.a,{path:"/security/roles/edit/:id",component:mi}),Object(we.jsx)(p.a,{path:"/security/roles/list",render:function(e){return Object(we.jsx)(bi,Object(d.a)({},e))}}),Object(we.jsx)(p.a,{path:"/security/groups/create",component:xi}),Object(we.jsx)(p.a,{path:"/security/groups/edit/:id",component:xi}),Object(we.jsx)(p.a,{path:"/security/groups/list",render:function(e){return Object(we.jsx)(fi,Object(d.a)({},e))}}),Object(we.jsx)(p.a,{path:"/settings/parameters/create",component:Ci}),Object(we.jsx)(p.a,{path:"/settings/parameters/edit/:id",component:Ci}),Object(we.jsx)(p.a,{path:"/settings/parameters/list",render:function(e){return Object(we.jsx)(Ni,Object(d.a)(Object(d.a)({},e),{},{parametersTable:"site"}))}}),Object(we.jsx)(p.a,{path:"/settings/coordinate_systems/create",component:Fi}),Object(we.jsx)(p.a,{path:"/settings/coordinate_systems/edit/:id",component:Fi}),Object(we.jsx)(p.a,{path:"/settings/coordinate_systems/list",render:function(e){return Object(we.jsx)(Si,Object(d.a)({},e))}})]}),Object(we.jsx)(Te,{})]})};var Ri=Object(l.b)((function(e){return{backoffice:e.backoffice,auth:e.auth}}))(Object(p.h)((function(e){e.history,e.backoffice;var t=e.layout_toggle_menu,a=e.layout_wrapper_click,i=e.layout_set_mode,c=e.layout_set_colormode,r=Object(n.useRef)(null),s=Object(n.useRef)(!1);return Object(we.jsx)(Ei,Object(d.a)(Object(d.a)({},e),{},{sidebar:r,onWrapperClick:function(e){s.current||a(),s.current=!1},onSidebarClick:function(){s.current=!0},onToggleMenu:function(e){e.preventDefault(),s.current=!0,t(window.innerWidth>1024)},onLayoutModeChange:function(e){i(e)},onLayoutColorModeChange:function(e){c(e)}}))})));var Pi=Object(l.b)((function(e){return{backoffice:e.backoffice}}))(Object(p.h)((function(e){e.match.url,e.match.params.id;var t=e.history,a=e.dispatch,i=e.loading,c=e.backoffice,s=(e.config,Object(n.useContext)(Ae).core),o=s.actions,l=o.backoffice_load,d=o.layout_wrapper_click,u=o.layout_toggle_menu,j=o.layout_set_mode,b=o.layout_set_colormode;return r.a.useEffect((function(){a(l(s,t,!0))}),[]),i?null:Object(we.jsx)(Ri,{history:t,core:s,backoffice:c,layout_wrapper_click:function(e){return a(d())},layout_toggle_menu:function(e){return a(u(e))},layout_set_mode:function(e){return a(j(e))},layout_set_colormode:function(e){return a(b(e))}})})));var Li=Object(p.h)((function(e){var t=e.history;return Object(we.jsx)("div",{className:"p-d-flex p-jc-center",style:{height:"100%"},children:Object(we.jsxs)("div",{className:"p-as-center",style:{backgroundColor:"white",padding:"6rem"},children:[Object(we.jsx)("h1",{children:"Ops..."}),Object(we.jsx)("p",{children:"O visualizador pedido n\xe3o existe."}),Object(we.jsx)("p",{children:"Clique para voltar a p\xe1gina inicial"}),Object(we.jsx)("p",{children:Object(we.jsx)(nt.a,{label:"P\xe1gina Inicial",onClick:function(e){return t.push({pathname:"/"})}})})]})})}));var Ai=Object(p.h)((function(e){var t=e.history;return Object(we.jsx)("div",{className:"p-d-flex p-jc-center",style:{height:"100%"},children:Object(we.jsxs)("div",{className:"p-as-center",style:{backgroundColor:"white",padding:"6rem"},children:[Object(we.jsx)("h1",{children:"Ops..."}),Object(we.jsx)("p",{children:"N\xe3o est\xe1 autorizado a aceder ao visualizador pedido."}),Object(we.jsx)("p",{children:"Clique para voltar a p\xe1gina inicial ou clique para efetuar login"}),Object(we.jsxs)("p",{children:[Object(we.jsx)(nt.a,{label:"P\xe1gina Inicial",onClick:function(e){return t.push({pathname:"/"})}})," ",Object(we.jsx)(nt.a,{label:"Entrar",onClick:function(e){return t.push({pathname:"/login"})}})]})]})})})),Ii=new x.a;var Ti=Object(l.b)((function(e){return{auth:e.auth}}))((function(e){var t=e.auth,a=e.history,i=e.redirect,c=Object(n.useState)(""),r=Object(u.a)(c,2),s=r[0],o=r[1],d=Object(n.useState)(""),j=Object(u.a)(d,2),b=j[0],p=j[1],m=Object(l.c)(),O=Object(n.useContext)(Ae).core,h=O.actions,v=h.login_post,g=h.logout,x=O.COOKIE_AUTH_NAME,y=Ii.get(x);if(y){var N=y.username;return Object(we.jsxs)("div",{children:[Object(we.jsxs)("p",{children:["Ol\xe1 ",N,"."]}),Object(we.jsxs)("p",{children:["Clique para",Object(we.jsx)(nt.a,{className:"p-button-link",onClick:function(e){return m(g())},label:"terminar sess\xe3o"}),"."]})]})}function _(e){e.preventDefault(),m(v({username:s,password:b},a,i))}return Object(we.jsxs)("form",{onSubmit:function(e){return _()},children:[Object(we.jsxs)("div",{className:"p-fluid",children:[Object(we.jsxs)("div",{className:"p-field p-grid",children:[Object(we.jsx)("label",{className:"p-col-12 p-md-4",children:"Nome de Utilizador / E-mail"}),Object(we.jsx)("div",{className:"p-col-12 p-md-8",children:Object(we.jsx)(f.a,{value:s,placeholder:"Nome de Utilizador",onChange:function(e){return o(e.target.value)}})})]}),Object(we.jsxs)("div",{className:"p-field p-grid",children:[Object(we.jsx)("label",{className:"p-col-12 p-md-4",children:"Palavra-passe"}),Object(we.jsx)("div",{className:"p-col-12 p-md-8",children:Object(we.jsx)(at.a,{value:b,placeholder:"Palavra-passe",feedback:!1,onChange:function(e){return p(e.target.value)}})})]})]}),Object(we.jsx)("div",{className:"p-dialog-myfooter",children:Object(we.jsx)(nt.a,{color:"green",icon:t.loading?"pi pi-spin pi-spinner":"pi pi-check",label:"Entrar",onClick:_,disabled:t.loading})}),t.http_error&&!t.response&&Object(we.jsx)(lt.a,{style:{width:"100%"},severity:"error",text:"Servi\xe7o Indispon\xedvel"}),t.response&&!!t.response&&!!t.response.message&&Object(we.jsx)(lt.a,{style:{width:"100%"},severity:"error",text:"Nome de Utilizador ou Palavra-passe inv\xe1lido"})]})}));var Di=Object(p.h)((function(e){var t=e.location.search,a=/redirect=(.*)/i.exec(t),i=Object(n.useContext)(Ae).core.CLIENT_URL+"assets/images/logo.png";return Object(we.jsx)("div",{id:"login-page",className:"p-d-flex p-jc-center",style:{height:"100%"},children:Object(we.jsxs)("div",{className:"p-as-center",style:{backgroundColor:"white",padding:"6rem"},children:[Object(we.jsx)("div",{className:"login-logo",children:Object(we.jsx)("img",{alt:"Logo",src:i})}),Object(we.jsx)(Ti,{history:e.history,redirect:a?a[1]:null})]})})})),Mi=Object(p.h)((function(e){var t=Object(p.f)();return Object(n.useEffect)((function(){window.scrollTo(0,0)}),[t]),e.children}));var Ui=Object(p.h)((function(e){e.history;var t=Object(n.useContext)(Ae).core.CLIENT_URL+"assets/images/logo-splash.png";return Object(we.jsx)("div",{className:"p-d-flex p-jc-center",style:{height:"100%"},children:Object(we.jsxs)("div",{className:"p-as-center",style:{backgroundColor:"white",padding:"6rem"},children:[Object(we.jsx)("div",{className:"login-logo",children:Object(we.jsx)("img",{alt:"Logo",src:t})}),Object(we.jsx)("p",{children:"Bem-vindo!"}),Object(we.jsx)("p",{children:"Para continuar, por favor aceite a nossa pol\xedtica de privacidade."})]})})})),Gi=a(483),qi=a(332),Vi=a.n(qi),Bi="scalargis_rgpd",Hi="2",zi="/",Wi=parseInt("150",10);var Ki=Object(Gi.a)((function(e){var t=e.cookies,a=e.children,i=Object(n.useState)(t.get(Bi)),c=Object(u.a)(i,2),s=c[0],o=c[1];return Object(we.jsxs)(r.a.Fragment,{children:[s!==Hi&&Object(we.jsx)(Vi.a,{location:"bottom",buttonText:"Aceito",cookieName:Bi,cookieValue:Hi,style:{background:"#2B373B"},buttonStyle:{color:"#4e503b",fontSize:"13px"},expires:Wi,onAccept:function(){if(o(Hi),"http:"===window.location.protocol){var e,t=new Date;t.setDate(t.getDate()+parseInt(Wi)),(new x.a).set(Bi,Hi,(e={path:zi,expires:t},Object($e.a)(e,"path",zi),Object($e.a)(e,"secure",!1),Object($e.a)(e,"httpOnly",!1),e))}},extraCookieOptions:{path:zi},debug:!0,cookieSecurity:!1,children:"Este website usa cookies para melhorar a experi\xeancia do utilizador"}),s?a:Object(we.jsx)(Ui,{})]})})),Zi=(a(478),function(){var e=P();return Object(we.jsx)(r.a.StrictMode,{children:Object(we.jsx)(Ae.Provider,{value:{core:Le},children:Object(we.jsx)(l.a,{store:Le.store,children:Object(we.jsx)(O.a,{basename:e,children:Object(we.jsx)(Mi,{children:Object(we.jsx)(Ki,{children:Object(we.jsxs)(p.c,{children:[Object(we.jsx)(p.a,{path:"/login",children:Object(we.jsx)(Di,{})}),Object(we.jsx)(p.a,{path:"/not-found",children:Object(we.jsx)(Li,{})}),Object(we.jsx)(p.a,{path:"/not-allowed",children:Object(we.jsx)(Ai,{})}),Object(we.jsx)(p.a,{path:"/",children:Object(we.jsx)(Pi,{})})]})})})})})})})});o.a.render(Object(we.jsx)(Zi,{}),document.getElementById("root"))}},[[479,1,2]]]);