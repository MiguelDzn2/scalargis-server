(this["webpackJsonp@scalargis/viewer"]=this["webpackJsonp@scalargis/viewer"]||[]).push([[0],{1062:function(e,t){function n(e){return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=1062},1082:function(e,t){},1084:function(e,t){},1096:function(e,t,n){},1172:function(e,t,n){},1173:function(e,t,n){},1181:function(e,t){},1184:function(e,t,n){},1186:function(e,t,n){},1187:function(e,t,n){},1188:function(e,t,n){},1189:function(e,t,n){},1190:function(e,t,n){},1191:function(e,t,n){},1192:function(e,t,n){},1260:function(e,t){},1394:function(e,t,n){},1395:function(e,t,n){},1396:function(e,t,n){},1397:function(e,t,n){},1398:function(e,t){function n(e){return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=1398},1399:function(e,t,n){},1400:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"mapStateToProps",(function(){return ge})),n.d(r,"rememberUrl",(function(){return ve})),n.d(r,"generateRGBA",(function(){return Oe})),n.d(r,"removeUrlParam",(function(){return _e})),n.d(r,"addUrlParam",(function(){return xe})),n.d(r,"getWindowSize",(function(){return ye})),n.d(r,"isDesktop",(function(){return we})),n.d(r,"isMobile",(function(){return Ee})),n.d(r,"isUrlAppOrigin",(function(){return Se})),n.d(r,"isUrlAppHostname",(function(){return Pe})),n.d(r,"getAppRootPath",(function(){return Ae})),n.d(r,"getAppBaseUrl",(function(){return Ce})),n.d(r,"getAppClientUrl",(function(){return Te})),n.d(r,"getAppApiUrl",(function(){return Re})),n.d(r,"getAppMapProxyUrl",(function(){return Ne})),n.d(r,"getAppUploadUrl",(function(){return ke})),n.d(r,"getViewerPublicUrl",(function(){return Ie})),n.d(r,"getCookieAuthName",(function(){return Me})),n.d(r,"traverseOlLayers",(function(){return Le})),n.d(r,"findOlLayer",(function(){return Fe})),n.d(r,"findOLInteraction",(function(){return Ue})),n.d(r,"serializeDrawing",(function(){return Ge})),n.d(r,"createStyle",(function(){return De})),n.d(r,"deserializeDrawing",(function(){return Ve})),n.d(r,"createDrawingStyle",(function(){return We})),n.d(r,"createDrawingText",(function(){return He})),n.d(r,"createDrawingSymbol",(function(){return ze})),n.d(r,"showOnPortal",(function(){return Ke})),n.d(r,"traverseLayersTree",(function(){return Be})),n.d(r,"isAdminOrManager",(function(){return Ye}));var i={};n.r(i),n.d(i,"default",(function(){return gn}));var a={};n.r(a),n.d(a,"default",(function(){return On}));var o={};n.r(o),n.d(o,"default",(function(){return Pn}));var c={};n.r(c),n.d(c,"default",(function(){return Tn}));var s={};n.r(s),n.d(s,"default",(function(){return Rn}));var l={};n.r(l),n.d(l,"ShareViewer",(function(){return i})),n.d(l,"SaveViewer",(function(){return a})),n.d(l,"TopButtonAuth",(function(){return o})),n.d(l,"TopButtonContact",(function(){return c})),n.d(l,"TopButtonHelp",(function(){return s}));var u={};n.r(u),n.d(u,"default",(function(){return Ln}));var d={};n.r(d),n.d(d,"MainMenu",(function(){return Vn})),n.d(d,"default",(function(){return Wn}));var p={};n.r(p),n.d(p,"MainMenu",(function(){return Zn})),n.d(p,"default",(function(){return $n}));var f={};n.r(f),n.d(f,"MainMenu",(function(){return ur})),n.d(f,"default",(function(){return dr}));var j={};n.r(j),n.d(j,"default",(function(){return hr}));var h={};n.r(h),n.d(h,"MainMenu",(function(){return Ir})),n.d(h,"default",(function(){return Mr}));var b={};n.r(b),n.d(b,"traverseOlLayers",(function(){return Ur})),n.d(b,"default",(function(){return Gr}));var m={};n.r(m),n.d(m,"traverseOlLayers",(function(){return qr})),n.d(m,"MainMenu",(function(){return Xr})),n.d(m,"default",(function(){return Jr}));var g={};n.r(g),n.d(g,"MainMenu",(function(){return Qr})),n.d(g,"default",(function(){return ei}));var v={};n.r(v),n.d(v,"MainMenu",(function(){return ni})),n.d(v,"default",(function(){return ri}));var O={};n.r(O),n.d(O,"default",(function(){return ii}));var _={};n.r(_),n.d(_,"actions",(function(){return si})),n.d(_,"default",(function(){return li}));var x={};n.r(x),n.d(x,"default",(function(){return pi}));var y={};n.r(y),n.d(y,"default",(function(){return hi}));var w={};n.r(w),n.d(w,"default",(function(){return gi}));var E={};n.r(E),n.d(E,"default",(function(){return Oi}));var S={};n.r(S),n.d(S,"default",(function(){return _i}));var P={};n.r(P),n.d(P,"MainMenu",(function(){return ki})),n.d(P,"default",(function(){return Ii}));var A={};n.r(A),n.d(A,"default",(function(){return Mi}));var C={};n.r(C),n.d(C,"default",(function(){return Fi}));var T={};n.r(T),n.d(T,"MainMenu",(function(){return Yi})),n.d(T,"default",(function(){return qi}));var R={};n.r(R),n.d(R,"MainMenu",(function(){return Ji})),n.d(R,"default",(function(){return Zi}));var N={};n.r(N),n.d(N,"default",(function(){return ea}));var k={};n.r(k),n.d(k,"default",(function(){return ra}));var I={};n.r(I),n.d(I,"MainMenu",(function(){return ha})),n.d(I,"default",(function(){return ba}));var M={};n.r(M),n.d(M,"MainMenu",(function(){return Xa})),n.d(M,"actions",(function(){return Ja})),n.d(M,"reducers",(function(){return Za})),n.d(M,"default",(function(){return $a}));var L={};n.r(L),n.d(L,"MainMenu",(function(){return to})),n.d(L,"default",(function(){return no}));var F={};n.r(F),n.d(F,"MainMenu",(function(){return Go})),n.d(F,"default",(function(){return Do}));var U={};n.r(U),n.d(U,"actions",(function(){return tc})),n.d(U,"MainMenu",(function(){return nc})),n.d(U,"default",(function(){return ic}));var G={};n.r(G),n.d(G,"default",(function(){return bc}));var D={};n.r(D),n.d(D,"AttributesTable",(function(){return u})),n.d(D,"Basemaps",(function(){return d})),n.d(D,"ContactForm",(function(){return p})),n.d(D,"CRSSelect",(function(){return j})),n.d(D,"Coordinates",(function(){return f})),n.d(D,"DrawTools",(function(){return h})),n.d(D,"ExportMapFeatures",(function(){return b})),n.d(D,"FeatureInfo",(function(){return m})),n.d(D,"GeoLocation",(function(){return g})),n.d(D,"HelpButton",(function(){return v})),n.d(D,"HtmlContent",(function(){return O})),n.d(D,"LayerAttributesTable",(function(){return _})),n.d(D,"LayerDownload",(function(){return x})),n.d(D,"LayerEdit",(function(){return y})),n.d(D,"LayerMetadata",(function(){return w})),n.d(D,"LayerOpacity",(function(){return E})),n.d(D,"LayerRemove",(function(){return S})),n.d(D,"MapControls",(function(){return P})),n.d(D,"MapScaleInput",(function(){return A})),n.d(D,"MapScaleLine",(function(){return C})),n.d(D,"MapTools",(function(){return T})),n.d(D,"PanelHTML",(function(){return R})),n.d(D,"PlacesSearch",(function(){return N})),n.d(D,"PopupInfo",(function(){return k})),n.d(D,"Print",(function(){return I})),n.d(D,"SearchLayers",(function(){return M})),n.d(D,"StreetView",(function(){return L})),n.d(D,"ThemeWizard",(function(){return F})),n.d(D,"TOC",(function(){return U})),n.d(D,"UserLogin",(function(){return G}));var V={};n.r(V),n.d(V,"AUTH_HTTP_LOADING",(function(){return mc})),n.d(V,"AUTH_HTTP_ERROR",(function(){return gc})),n.d(V,"AUTH_CLEAR_ERROR",(function(){return vc})),n.d(V,"AUTH_RESPONSE",(function(){return Oc})),n.d(V,"AUTH_LOGIN",(function(){return _c})),n.d(V,"PASSWORD_HTTP_LOADING",(function(){return xc})),n.d(V,"PASSWORD_HTTP_ERROR",(function(){return yc})),n.d(V,"PASSWORD_RESPONSE",(function(){return wc})),n.d(V,"REGISTRATION_HTTP_LOADING",(function(){return Ec})),n.d(V,"REGISTRATION_HTTP_ERROR",(function(){return Sc})),n.d(V,"REGISTRATION_RESPONSE",(function(){return Pc})),n.d(V,"VIEWER_LOAD",(function(){return Ac})),n.d(V,"VIEWER_LOAD_DONE",(function(){return Cc})),n.d(V,"VIEWER_SAVE_HTTP_LOADING",(function(){return Tc})),n.d(V,"VIEWER_SAVE_HTTP_ERROR",(function(){return Rc})),n.d(V,"VIEWER_SAVE_RESPONSE",(function(){return Nc})),n.d(V,"VIEWER_SESSION_LOAD",(function(){return kc})),n.d(V,"VIEWER_SESSION_SAVED",(function(){return Ic})),n.d(V,"VIEWER_SET_CONFIG",(function(){return Mc})),n.d(V,"VIEWER_LOAD_ERROR",(function(){return Lc})),n.d(V,"VIEWER_NOT_FOUND",(function(){return Fc})),n.d(V,"VIEWER_NOT_AUTHORIZED",(function(){return Uc})),n.d(V,"VIEWER_LOAD_COMPONENTS",(function(){return Gc})),n.d(V,"VIEWER_UNLOAD_COMPONENTS",(function(){return Dc})),n.d(V,"VIEWER_SET_SELECTEDMENU",(function(){return Vc})),n.d(V,"VIEWER_SET_FEATUREINFO",(function(){return Wc})),n.d(V,"VIEWER_SET_GEOLOCATION",(function(){return Hc})),n.d(V,"VIEWER_SET_DRAWINGS",(function(){return zc})),n.d(V,"VIEWER_SET_COORDINATES",(function(){return Kc})),n.d(V,"MAP_SET_EXTENT",(function(){return Bc})),n.d(V,"MAP_SET_SIZE",(function(){return Yc})),n.d(V,"MAP_SET_CLASS",(function(){return qc})),n.d(V,"LAYERS_SET_CHECKED",(function(){return Xc})),n.d(V,"LAYERS_SET_OPENED",(function(){return Jc})),n.d(V,"LAYERS_UPDATE_THEME",(function(){return Zc})),n.d(V,"LAYERS_REMOVE_ITEMS",(function(){return $c})),n.d(V,"VIEWER_SET_DISPLAYCRS",(function(){return Qc})),n.d(V,"VIEWER_ADD_THEMES",(function(){return es})),n.d(V,"VIEWER_REMOVE_THEMES",(function(){return ts})),n.d(V,"VIEWER_SET_CONFIGJSON",(function(){return ns})),n.d(V,"VIEWER_UPDATE_MAPCONTROL",(function(){return rs})),n.d(V,"VIEWER_SET_EXCUSIVE_MAPCONTROL",(function(){return is})),n.d(V,"LAYOUT_WRAPPER_CLICK",(function(){return as})),n.d(V,"LAYOUT_TOGGLE_OVERLAYMENU",(function(){return os})),n.d(V,"LAYOUT_TOGGLE_STATICMENU",(function(){return cs})),n.d(V,"LAYOUT_TOGGLE_MOBILEMENU",(function(){return ss})),n.d(V,"viewer_save_record",(function(){return hs})),n.d(V,"viewer_save_http_error",(function(){return bs})),n.d(V,"viewer_save_http_loading",(function(){return ms})),n.d(V,"viewer_save_response",(function(){return gs})),n.d(V,"login_http_loading",(function(){return vs})),n.d(V,"login_post",(function(){return Os})),n.d(V,"login",(function(){return _s})),n.d(V,"logout",(function(){return xs})),n.d(V,"login_http_error",(function(){return ys})),n.d(V,"login_clear_error",(function(){return ws})),n.d(V,"login_response",(function(){return Es})),n.d(V,"login_reset_password",(function(){return Ss})),n.d(V,"password_http_loading",(function(){return Ps})),n.d(V,"password_reset_validation",(function(){return As})),n.d(V,"password_post",(function(){return Cs})),n.d(V,"password_response",(function(){return Ts})),n.d(V,"password_http_error",(function(){return Rs})),n.d(V,"login_user_registration",(function(){return Ns})),n.d(V,"registration_http_loading",(function(){return ks})),n.d(V,"registration_post",(function(){return Is})),n.d(V,"registration_confirmation",(function(){return Ms})),n.d(V,"registration_send_confirmation",(function(){return Ls})),n.d(V,"registration_response",(function(){return Fs})),n.d(V,"registration_http_error",(function(){return Us})),n.d(V,"viewer_set_drawings",(function(){return Gs})),n.d(V,"viewer_set_featureinfo",(function(){return Ds})),n.d(V,"viewer_set_geolocation",(function(){return Vs})),n.d(V,"viewer_set_coordinates",(function(){return Ws})),n.d(V,"viewer_set_config",(function(){return Hs})),n.d(V,"viewer_load_components",(function(){return zs})),n.d(V,"viewer_unload_components",(function(){return Ks})),n.d(V,"viewer_error",(function(){return Bs})),n.d(V,"viewer_not_found",(function(){return Ys})),n.d(V,"viewer_not_authorized",(function(){return qs})),n.d(V,"viewer_load_done",(function(){return Xs})),n.d(V,"viewer_set_selectedmenu",(function(){return Js})),n.d(V,"viewer_set_exclusive_mapcontrol",(function(){return Zs})),n.d(V,"viewer_load",(function(){return $s})),n.d(V,"viewer_session_load",(function(){return Qs})),n.d(V,"viewer_session_saved",(function(){return el})),n.d(V,"isThemeOnScale",(function(){return tl})),n.d(V,"map_set_extent",(function(){return nl})),n.d(V,"map_set_size",(function(){return rl})),n.d(V,"map_set_class",(function(){return il})),n.d(V,"layers_set_checked",(function(){return al})),n.d(V,"layers_set_opened",(function(){return ol})),n.d(V,"layers_update_theme",(function(){return cl})),n.d(V,"viewer_add_themes",(function(){return sl})),n.d(V,"layers_remove_items",(function(){return ll})),n.d(V,"viewer_remove_themes",(function(){return ul})),n.d(V,"viewer_set_configjson",(function(){return dl})),n.d(V,"viewer_update_mapcontrol",(function(){return pl})),n.d(V,"viewer_set_displaycrs",(function(){return fl})),n.d(V,"layout_wrapper_click",(function(){return jl})),n.d(V,"layout_toggle_overlaymenu",(function(){return hl})),n.d(V,"layout_toggle_staticmenu",(function(){return bl})),n.d(V,"layout_toggle_mobilemenu",(function(){return ml})),n.d(V,"layout_toggle_menu",(function(){return gl})),n.d(V,"layout_show_menu",(function(){return vl})),n.d(V,"getThemeLegendUrl",(function(){return Ol})),n.d(V,"transform_extent",(function(){return xl}));var W={};n.r(W),n.d(W,"subscribe",(function(){return wl})),n.d(W,"publish",(function(){return El}));n(829),n(847);var H=n(0),z=n.n(H),K=n(99),B=n.n(K),Y=(n(1058),n(3)),q=n(28),X=n(6),J=n(1);function Z(e){var t=e.theme,r=e.children,i=null;return i=t&&"default"!==t?z.a.lazy((function(){return n(1062)("./"+t+"/src/main")})):z.a.lazy((function(){return n.e(3).then(n.bind(null,1413))})),Object(J.jsxs)(J.Fragment,{children:[Object(J.jsx)(z.a.Suspense,{fallback:Object(J.jsx)(J.Fragment,{}),children:Object(J.jsx)(i,{})}),r]})}var $=n(366),Q=n.n($),ee=n(43),te=n(44),ne=n(49),re=n(50),ie=function(e){Object(ne.a)(n,e);var t=Object(re.a)(n);function n(){return Object(ee.a)(this,n),t.apply(this,arguments)}return Object(te.a)(n,[{key:"render",value:function(){return Object(J.jsxs)("div",{className:"layout-topbar clearfix",children:[Object(J.jsx)("button",{className:"p-link layout-menu-button",onClick:this.props.onToggleMenu,children:Object(J.jsx)("span",{className:"pi pi-bars"})}),this.props.logo,Object(J.jsx)("div",{className:"layout-topbar-icons topbar-right",children:this.props.regionComponents})]})}}]),n}(H.Component);ie.defaultProps={onToggleMenu:null,logo:null,regionComponents:null};n(1063),n(1064),n(1065);var ae=n(22),oe=n(1408),ce=function(e){var t=e.children,n=document.createElement("div"),r=document.getElementById("portal-root"),i=Object(H.useState)(!0),a=Object(X.a)(i,2),o=a[0],c=a[1],s=Object(H.useRef)(null);return Object(H.useEffect)((function(){s.current||(s.current=n,c(!o))}),[s]),Object(H.useEffect)((function(){return r.appendChild(s.current),function(){return r.removeChild(s.current)}}),[s,r]),s.current?Object(K.createPortal)(t,s.current):null},se=n(59),le=n(63),ue=n(48),de=n(122),pe=n(46),fe=n(47),je=n(273),he=n(253),be=function(){var e,t;return"__SCALARGIS_ROOT_PATH__"!==(null===(e=window)||void 0===e?void 0:e.SCALARGIS_ROOT_PATH)&&(null===(t=window)||void 0===t?void 0:t.SCALARGIS_ROOT_PATH)||""},me=function(){var e,t;return"__SCALARGIS_ROOT_PATH_BASE_URL__"!==(null===(e=window)||void 0===e?void 0:e.SCALARGIS_ROOT_PATH_BASE_URL)&&(null===(t=window)||void 0===t?void 0:t.SCALARGIS_ROOT_PATH_BASE_URL)||""},ge=function(e){if(e){var t=Object.entries(e).map((function(e){var t=Object(X.a)(e,2);t[0];return t[1]}));return Object.assign.apply(Object,Object(ae.a)(t))}};function ve(e,t,n){var r=(Object({NODE_ENV:"production",PUBLIC_URL:"/static/viewer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"/api",REACT_APP_BASE_URL:"",REACT_APP_CLIENT_URL:"/static/viewer",REACT_APP_CONFIG_URL:"/static/viewer/config.json",REACT_APP_COOKIE_AUTH_NAME:"scalargis_webgis",REACT_APP_COOKIE_EXPIRES_DAYS:"150",REACT_APP_COOKIE_INFO_URL:"/static/viewer/rgpd.html",REACT_APP_COOKIE_MESSAGE:"This website uses cookies to improve your browsing experience. By pressing 'I Accept' you are agreeing to its use.",REACT_APP_COOKIE_NAME:"scalargis_rgpd",REACT_APP_COOKIE_PATH:"/",REACT_APP_COOKIE_VALUE:"2",REACT_APP_DEFAULT_THEME:"default",REACT_APP_DESCRIPTION:"ScalarGIS - Web GIS framework",REACT_APP_ENTITY_NAME:"ScalarGIS",REACT_APP_ENTITY_NAME_ABREV:"ScalarGIS",REACT_APP_ENTITY_URL:"https://www.scalargis.com",REACT_APP_MAP_PROXY:"/proxy?url=",REACT_APP_ROOT_PATH:"",REACT_APP_TITLE:"ScalarGIS",REACT_APP_UPLOAD_URL:"/spatial_toolbox/convert2geojson"}).REACT_APP_COOKIE_PREFIX||"sniguserurl")+t,i=e.get(r)||[];-1===i.indexOf(n)&&i.push(n),e.set(r,i)}var Oe=function(){return[Math.floor(255*Math.random()),Math.floor(255*Math.random()),Math.floor(255*Math.random()),1].join(",")},_e=function(e,t){var n,r=e.split("?")[0],i=[],a=[],o=-1!==e.indexOf("?")?e.split("?")[1]:"";if(""!==o){for(var c=(i=o.split("&")).length-1;c>=0;c-=1){n=i[c].split("=")[0],new RegExp(t,"ig").test(n)||a.push(i[c])}r=r+"?"+a.join("&")}return r},xe=function(e,t,n){var r=e.split("?")[0],i=[],a=-1!==e.indexOf("?")?e.split("?")[1]:"";return""!==a&&(i=a.split("&")),i.push(t+"="+n),r=r+"?"+i.join("&")},ye=function(){var e=window,t=document,n=t.documentElement,r=t.getElementsByTagName("body")[0];return[e.innerWidth||n.clientWidth||r.clientWidth,e.innerHeight||n.clientHeight||r.clientHeight]},we=function(){return window.innerWidth>1024},Ee=function(){var e=ye()[0]<=768;return e},Se=function(e){if(0!==e.indexOf("http"))return!0;var t=new URL(window.location.href),n=new URL(e);return t.origin===n.origin},Pe=function(e){if(0!==e.indexOf("http"))return!0;var t=new URL(window.location.href),n=new URL(e);return t.hostname===n.hostname},Ae=function(){return be()},Ce=function(){var e=be(),t=e+"";return me()&&(t=e+me()),t.endsWith("/")||(t+="/"),t},Te=function(){var e=be(),t=e+"/static/viewer/";return(t=e+"/static/viewer").endsWith("/")||(t+="/"),t},Re=function(){var e=be(),t=e+"/api";return(t=e+"/api").startsWith("//")&&(t=window.location.protocol+t),t.toLowerCase().startsWith("http")||(t=window.location.origin+t),t},Ne=function(){var e=be(),t=e+"/map/proxy?url=";return(t=e+"/proxy?url=").startsWith("//")&&(t=window.location.protocol+t),t.toLowerCase().startsWith("http")||(t=window.location.origin+t),t},ke=function(){var e="";return(e=be()+"/spatial_toolbox/convert2geojson").startsWith("//")&&(e=window.location.protocol+e),e.toLowerCase().startsWith("http")||(e=window.location.origin+e),e},Ie=function(e){var t=new URL(window.location.href.toLowerCase()),n="map/";if(t.pathname.startsWith(Ce())){var r=t.pathname.substring(Ce().length);r.indexOf("/")>-1&&((r=r.substring(0,r.indexOf("/"))).endsWith("/")||(r+="/"),n=r)}return t.origin+Ce()+n+e},Me=function(){return"scalargis_webgis"};function Le(e,t){e.forEach((function(e){t(e),e instanceof se.b&&Le(e.getLayers(),t)}))}function Fe(e,t){var n;return Le(e.getLayers(),(function(e){e.get("id")===t&&(n=e)})),n}function Ue(e,t){var n=!1;return e.getInteractions().forEach((function(e){e instanceof t&&(n=e)})),n}var Ge=function(e,t,n){var r=e.getId()?e.getId():Object(oe.a)();e.setId(r),e.set("id",r);var i=e.getGeometry().getType();t.draw_symbol&&(i="Symbol"),t.draw_text&&(i="Text"),e.set("type",i),e.set("state",{draw_geom:t.draw_geom,draw_symbol:t.draw_symbol,draw_text:t.draw_text,fill:Object.assign({},t.fill),stroke:Object.assign({},t.stroke),size:t.size,symbol_type:t.symbol_type,text_style:t.text_style,text_size:t.text_size,text_font:t.text_font,text_value:t.text_value});var a={dataProjection:n||"EPSG:3857",featureProjection:n||"EPSG:3857",decimals:6},o=(new le.a).writeFeatureObject(e,a),c=(n||"EPSG:3857").replace(":","::");return o.crs={type:"name",properties:{name:"urn:ogc:def:crs:"+c}},o},De=function(e,t,n){var r=t.symbol_type,i=t.size,a=t.fill,o=t.stroke,c=t.text_style,s=t.text_size,l=t.text_font,u=t.text_value;o=n||o;var d=We(e.getGeometry().getType(),i,a,o);return"Symbol"===e.get("type")&&(d=ze(r,i,a,o)),"Text"===e.get("type")&&(d=He(e,i,a,o,c,s,l,u)),d},Ve=function(e,t){var n=e.properties.state,r=n.draw_geom,i=n.draw_symbol,a=n.draw_text,o=n.symbol_type,c=n.size,s=n.fill,l=n.stroke,u=n.text_style,d=n.text_size,p=n.text_font,f=n.text_value,j={dataProjection:t||"EPSG:3857",featureProjection:t||"EPSG:3857",decimals:6},h=(new le.a).readFeature(e,j),b=De(h,e.properties.state);return h.setStyle(b),h.set("state",{draw_geom:r,draw_symbol:i,draw_text:a,fill:Object.assign({},s),stroke:Object.assign({},l),size:c,symbol_type:o,text_style:u,text_size:d,text_font:p,text_value:f}),h},We=function(e,t,n,r){var i="rgba(".concat(n.r,", ").concat(n.g,", ").concat(n.b,", ").concat(n.a,")"),a="rgba(".concat(r.r,", ").concat(r.g,", ").concat(r.b,", ").concat(r.a,")"),o=new ue.c({stroke:new fe.a({color:a,width:parseInt(10,10)}),fill:new pe.a({color:i})});switch(e){case"Point":o=new ue.c({image:new de.a({radius:parseInt(t,10),fill:new pe.a({color:i}),stroke:new fe.a({color:a,width:2})}),stroke:new fe.a({color:a,lineDash:[4],width:parseInt(t,10)}),fill:new pe.a({color:i})});break;case"LineString":o=new ue.c({stroke:new fe.a({color:a,width:parseInt(t,10)})});break;case"Polygon":o=new ue.c({stroke:new fe.a({color:a,lineDash:[4],width:parseInt(t,10)}),fill:new pe.a({color:i})});break;case"Circle":o=new ue.c({stroke:new fe.a({color:a,width:parseInt(t,10)}),fill:new pe.a({color:i})})}return o},He=function(e,t,n,r,i,a,o,c){var s="rgba(".concat(n.r,", ").concat(n.g,", ").concat(n.b,", ").concat(n.a,")"),l="rgba(".concat(r.r,", ").concat(r.g,", ").concat(r.b,", ").concat(r.a,")"),u=c,d=[i,a,o].join(" ");return new ue.c({text:new je.a({font:d,textAlign:"left",fill:new pe.a({color:s}),stroke:new fe.a({color:l,width:parseInt(t,10)}),textBaseline:"top",text:u})})},ze=function(e,t,n,r){var i="rgba(".concat(n.r,", ").concat(n.g,", ").concat(n.b,", ").concat(n.a,")"),a="rgba(".concat(r.r,", ").concat(r.g,", ").concat(r.b,", ").concat(r.a,")"),o=null;switch(e){case"square":o=new ue.c({image:new he.a({fill:new pe.a({color:i}),stroke:new fe.a({color:a,width:2}),radius:parseInt(t,10),points:4,angle:Math.PI/4})});break;case"triangle":o=new ue.c({image:new he.a({fill:new pe.a({color:i}),stroke:new fe.a({color:a,width:2}),radius:parseInt(t,10),points:3,rotation:0,angle:0})});break;case"star":o=new ue.c({image:new he.a({fill:new pe.a({color:i}),stroke:new fe.a({color:a,width:2}),radius:parseInt(t,10),points:5,radius2:4,angle:0})});break;case"cross":o=new ue.c({image:new he.a({fill:new pe.a({color:i}),stroke:new fe.a({color:a,width:2}),radius:parseInt(t,10),points:4,radius2:0,angle:0})});break;case"circle":o=new ue.c({image:new de.a({fill:new pe.a({color:i}),stroke:new fe.a({color:a,width:2}),radius:parseInt(t,10)})});break;default:o=new ue.c({image:new he.a({fill:new pe.a({color:i}),stroke:new fe.a({color:a,width:2}),points:4,radius:10,radius2:0,angle:Math.PI/4})})}return o},Ke=function(e){return Object(J.jsx)(ce,{children:e})},Be=function e(t,n,r){(n?t.filter((function(e){return e.id===n})):t).forEach((function(i,a){i.children&&i.children.forEach((function(n){e(t,n,r)})),r(i,a,n)}))},Ye=function(e){var t;return(null!==e&&void 0!==e&&e.data?e.data.userroles||[]:(null===e||void 0===e||null===(t=e.response)||void 0===t?void 0:t.userroles)||[]).map((function(e){return e.toLowerCase()})).filter((function(e){return["admin","manager"].includes(e)})).length>0},qe=function(e,t){Object(H.useEffect)((function(){var n=document.createElement("script");return n.src=e,n.async="undefined"===typeof t||t,document.body.appendChild(n),function(){document.body.removeChild(n)}}),[e])},Xe=function(e){Object(H.useEffect)((function(){var t=document.createElement("script");try{t.appendChild(document.createTextNode(e)),document.body.appendChild(t)}catch(n){t.text=e,document.body.appendChild(t)}return function(){document.body.removeChild(t)}}),[e])};function Je(e){var t=e.src,n=e.async;return qe(t,void 0===n||n),null}function Ze(e){var t=e.code;return Xe(t),null}var $e=function(e,t){Object(H.useEffect)((function(){var n=document.createElement("link");return n.href=e,n.rel="stylesheet",n.type="text/css",n.async="undefined"===typeof t||t,document.body.appendChild(n),function(){document.body.removeChild(n)}}),[e])},Qe=function(e){Object(H.useEffect)((function(){var t=document.createElement("style");t.type="text/css";try{t.appendChild(document.createTextNode(e)),document.body.appendChild(t)}catch(n){t.text=e,document.body.appendChild(t)}return function(){document.body.removeChild(t)}}),[e])};function et(e){var t=e.src,n=e.async;return $e(t,void 0===n||n),null}function tt(e){var t=e.style,n=e.onLoaded;return Qe(t),n&&n(),null}var nt=n(96),rt=n(434);var it=Object(nt.g)((function(e){return Object(J.jsx)("div",{className:"loadingscreen",children:Object(J.jsx)("div",{children:Object(J.jsx)(rt.a,{mode:"indeterminate",style:{height:"6px"}})})})}));var at=function(e){var t,n=e.core,r=e.config,i=e.viewer,a=e.sidebar,o=e.onWrapperClick,c=e.onSidebarClick,s=e.onToggleMenu,l=n.CLIENT_URL,u=Object(H.useState)(!1),d=Object(X.a)(u,2),p=d[0],f=d[1];Object(H.useEffect)((function(){r&&(r.custom_style||f(!0))}),[r]);var j=(new Date).getFullYear(),h="ScalarGIS",b="https://www.scalargis.com",m=Q()("layout-wrapper",{"layout-overlay":"overlay"===i.layoutMode,"layout-static":"static"===i.layoutMode,"layout-static-sidebar-inactive":i.staticMenuInactive&&"static"===i.layoutMode,"layout-overlay-sidebar-active":i.overlayMenuActive&&"overlay"===i.layoutMode,"layout-mobile-sidebar-active":i.mobileMenuActive},(null===r||void 0===r||null===(t=r.config_json)||void 0===t?void 0:t.layout_class)||(null===r||void 0===r?void 0:r.layout_class)),g=Q()("layout-sidebar",{"layout-sidebar-dark":"dark"===i.layoutColorMode,"layout-sidebar-light":"light"===i.layoutColorMode}),v=ye(),O="dark"===i.layoutColorMode?l+"assets/images/logo-light.png":l+"assets/images/logo.png";i.staticMenuInactive&&"static"===i.layoutMode&&(O=l+"assets/images/logo-light.png"),r&&r.img_logo&&(O=l+r.img_logo);var _=null;r&&r.title_logo&&(_=r.title_logo),r&&r.config_json&&r.config_json.title_logo&&(_=r.config_json.title_logo);var x=v[0]>768?Object(J.jsxs)("div",{className:"layout-logo",children:[Object(J.jsx)("img",{alt:"Logo",src:O}),_?Object(J.jsx)("div",{dangerouslySetInnerHTML:{__html:_}}):null]}):null;return Object(J.jsxs)("div",{className:m,onClick:o,children:[p&&Object(J.jsx)(ie,{onToggleMenu:s,logo:x,regionComponents:e.topbarRight}),Object(J.jsxs)("div",{ref:function(e){return a.current=e},className:g,onClick:c,style:{width:i.mobileMenuActive&&v[0]<=768?v[0]:null},children:[i.mobileMenuActive&&Object(J.jsxs)("div",{className:"layout-logo",children:[_?Object(J.jsx)("div",{dangerouslySetInnerHTML:{__html:_}}):null,Object(J.jsx)("img",{alt:"Logo",src:O})]}),e.mainMenu]}),Object(J.jsx)("div",{className:"layout-main",children:e.children}),p&&Object(J.jsxs)("div",{className:"layout-footer",children:[Object(J.jsxs)("div",{className:"footer-left",children:[h&&(b?Object(J.jsxs)("span",{className:"footer-text",children:["\xa9 ",j," ",Object(J.jsx)("a",{href:b,target:"_blank",rel:"noopener noreferrer",children:h})]}):Object(J.jsxs)("span",{className:"footer-text",children:["\xa9 ",j," ",h]})),Object(J.jsx)("div",{children:e.footerLeft})]}),Object(J.jsx)("div",{className:"footer-right",children:e.footerRight})]}),Object(J.jsx)("div",{className:"layout-mask"}),!p&&Object(J.jsx)(it,{}),r&&r.scripts?r.scripts.map((function(e,t){return Object(J.jsx)(Je,{src:e,async:!1},t)})):null,r&&r.styles?r.styles.map((function(e,t){return Object(J.jsx)(et,{src:e,async:!1},t)})):null,r&&r.custom_style?Object(J.jsx)(tt,{style:r.custom_style,onLoaded:function(){setTimeout((function(){return f(!0)}),500)}}):null,r&&r.custom_script?Object(J.jsx)(Ze,{code:r.custom_script}):null]})};var ot=Object(q.b)((function(e){var t=ge(e);return{config:t.config,viewer:t.viewer,auth:t.auth}}))((function(e){var t=e.core,n=(e.history,e.config),r=e.viewer,i=e.mainOlMap,a=e.layout_toggle_menu,o=e.layout_wrapper_click,c=Object(H.useState)(null),s=Object(X.a)(c,2),l=s[0],u=s[1],d=Object(H.useRef)(null),p=Object(H.useRef)(!1);return Object(H.useEffect)((function(){if(n){var e="default";n&&n.theme&&(e=n.theme),n&&n.config_json&&n.config_json.theme&&(e=n.config_json.theme),u(e);var r=t.CLIENT_URL,i=r+"manifest.json";if(n.manifest_json)i="data:application/manifest+json,"+encodeURIComponent(JSON.stringify(n.manifest_json));var a=document.querySelector("link[rel='manifest']");a?a.href=i:((a=document.createElement("link")).setAttribute("rel","manifest"),a.setAttribute("href",i),document.querySelector("head").appendChild(a)),n.title&&(document.title=n.title),n.description&&(a=document.querySelector("meta[name='description']"))&&(a.content=n.description),n.keywords&&n.keywords.length>0&&(a=document.querySelector("meta[name='keywords']"))&&(a.content=n.keywords.join(", "));var o=r+"assets/images/logo32.png";n.img_icon&&(o=r+n.img_icon),(a=document.querySelector("link[rel='shortcut icon']"))||(a=document.querySelector("link[rel='icon']")),a?a.href=o:((a=document.createElement("link")).setAttribute("rel","shortcut icon"),a.setAttribute("href",o),document.querySelector("head").appendChild(a)),o=r+"assets/images/logo192.png",(a=document.querySelector("link[rel='apple-touch-icon']"))?a.href=o:((a=document.createElement("link")).setAttribute("rel","apple-touch-icon"),a.setAttribute("href",o),document.querySelector("head").appendChild(a))}}),[n]),Object(H.useEffect)((function(){var e,t;r.mobileMenuActive?(e=document.body,t="body-overflow-hidden",e.classList?e.classList.add(t):e.className+=" "+t):function(e,t){e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," ")}(document.body,"body-overflow-hidden"),setTimeout((function(){i&&i.updateSize()}),210)}),[r]),Object(J.jsx)(Z,{theme:l,children:Object(J.jsx)(at,Object(Y.a)(Object(Y.a)({},e),{},{sidebar:d,onWrapperClick:function(e){p.current||o(),p.current=!1},onSidebarClick:function(e){p.current=!0},onToggleMenu:function(e){e.preventDefault(),p.current=!0,a(we())}}))})})),ct=n(257),st=n(1407),lt=n(58),ut=n(325),dt=n(811),pt=n(329),ft=n(35),jt=n(23),ht=n(182),bt=n(8),mt=n(31),gt=n(88),vt=n(54),Ot=n(38),_t=n(90),xt=n(131),yt=n(319),wt=n(66),Et=n(248),St=n(367),Pt=n(442),At=n(795),Ct=n(223),Tt=n(224),Rt=n(314),Nt=n(315),kt=n(185),It=n(98),Mt=n(374),Lt=n(323),Ft=n(105),Ut=n(40),Gt=n(456),Dt=n(275),Vt=n(52),Wt=n(7),Ht=n(794),zt=n(255),Kt=n(5),Bt=n(242),Yt=n.n(Bt),qt=0,Xt=function(e){e.map((function(e){if(!Wt.l("EPSG:"+e.srid)){zt.a.defs("EPSG:"+e.srid,e.defs),Object(Ht.a)(zt.a);var t=Wt.l("EPSG:"+e.srid),n=Wt.n("EPSG:4326",t);if(e.extent){var r=e.extent.split(" ").map(Number);t.setWorldExtent(r);var i=Object(Kt.a)(r,n,void 0,8);t.setExtent(i)}}return e}))},Jt={m:39.37,degrees:4374754},Zt=function(e){var t=[];e.config_json.layers.forEach((function(n){if(!e.removed.includes(n.id)&&"featureinfo"!=n.id){var r=Object(Y.a)({},n);n.children&&(r.children=n.children.slice()),t.push(r)}}));var n=t.map((function(e){return e.id}));t.forEach((function(e){e.children&&(e.children=e.children.filter((function(e){return n.includes(e)})))}));var r=e.config_json.checked.filter((function(t){return!e.removed.includes(t)}));return r=r.filter((function(e){return"featureinfo"!=e})),Object(Y.a)(Object(Y.a)({},e.config_json),{},{layers:t,checked:r})},$t=function(e,t,n,r){var i=Object.assign([],n);isFinite(i[0])||(i=r),i=[parseFloat(i[0]),parseFloat(i[1]),parseFloat(i[2]),parseFloat(i[3])];var a=-1===String(e).indexOf(":")?"EPSG:"+e:e,o=-1===String(t).indexOf(":")?"EPSG:"+t:t;return i=Wt.v(i,a,o)},Qt=function e(t,n,r){var i;if(t){var a=function(e){var n=t.style_color?"rgba(".concat(t.style_color,")"):"black",r=t.style_stroke_color?"rgba(".concat(t.style_stroke_color,")"):"rgba(0, 0, 255, 1.0)",i="undefined"===typeof t.style_stroke_width?2:Number(t.style_stroke_width),a="undefined"===typeof t.style_image_radius?8:Number(t.style_image_radius);if(e.ollayer){var o=e.ollayer.getProperties();n="rgba(".concat(o.style_color,")")}return new ue.c({image:new de.a({radius:a,snapToPixel:!1,fill:new pe.a({color:n}),stroke:new fe.a({color:r,width:i})}),fill:new pe.a({color:n}),stroke:new fe.a({color:r,width:i})})},o=n.getView().getProjection().getCode();switch(t.type){case"XYZ":i=new xt.a({visible:t.active,source:new Et.a({url:t.url})});break;case"WMTSXYZ":i=new xt.a({visible:t.active,source:new Et.a({tileUrlFunction:function(e){var n=t.url,r=("0"+e[0]).slice(-2);return n=(n=(n=n.replace("{z}",r)).replace("{x}",e[1])).replace("{y}",e[2])}})});break;case"OSM":i=new xt.a({visible:t.active,source:new St.a});break;case"BING":i=new xt.a({visible:t.active,preload:1/0,source:new At.a({key:"AuwLFA-O1AcL74VKikVahe1-ERPMta838eby5eIXMswtCKNdsioHUpMrJFyj5c1g",imagerySet:"AerialWithLabels"})});break;case"TileJSON":i=new xt.a({visible:t.active,opacity:t.opacity?t.opacity:1,source:new Pt.a({url:t.url})});break;case"WMS":var c=t.url;c=_e(c,"service"),c=_e(c,"version");var s={url:c=_e(c,"request"),hidpi:!1,params:{LAYERS:t.layers,TILED:t.tiled,VERSION:t.version,FORMAT:t.get_map_format||t.format||"image/jpeg",STYLES:t.wms_style||t.styles}};t.crs_options&&-1===t.crs_options.indexOf(o)&&(-1!=t.crs_options.indexOf("EPSG:4326")?s.projection="EPSG:4326":s.projection="CRS:84"),i=t.tiled?new xt.a({visible:t.active,opacity:t.opacity?t.opacity:1,source:new Ct.a(s)}):new yt.a({visible:t.active,opacity:t.opacity?t.opacity:1,source:new Tt.a(s)});var l=tn(t.url,t.wms_layers||t.layers,t.crs);i.set("legendURL",l);break;case"WMTS":var u=kt.a.optionsFromCapabilities(t.wmts_capabilities,{layer:t.layer,matrixSet:"EPSG:3857"});i=new xt.a({visible:t.active,opacity:t.opacity?t.opacity:1,source:new kt.a(u)});break;case"WFS":var d={srsName:"EPSG:"+t.crs,dataProjection:"EPSG:"+t.crs},p="GML2",f=new Ft.a(d),j={featureProjection:o},h="EPSG:"+t.crs;["2.0.0"].indexOf(t.version)>-1&&(d={srsName:"EPSG:"+t.crs,dataProjection:"EPSG:"+t.crs},p="GML3",f=new Gt.a(d),j={srsName:"EPSG:"+t.crs,dataProjection:"EPSG:"+t.crs,featureProjection:o},h="urn:ogc:def:crs:EPSG::"+t.crs);var b=new It.a({loader:function(e){var n=t.bbox.split(" "),r=t.url;r=(r=r.replace(/&$/gi,""))+(r.indexOf("?")>-1?"":"?")+"&service=WFS&version="+t.version+"&request=GetFeature&typename="+encodeURIComponent(t.layers)+"&outputFormat="+p+"&srsname="+h+"&bbox="+n.join(",")+",EPSG:"+t.crs;var a=Object({NODE_ENV:"production",PUBLIC_URL:"/static/viewer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"/api",REACT_APP_BASE_URL:"",REACT_APP_CLIENT_URL:"/static/viewer",REACT_APP_CONFIG_URL:"/static/viewer/config.json",REACT_APP_COOKIE_AUTH_NAME:"scalargis_webgis",REACT_APP_COOKIE_EXPIRES_DAYS:"150",REACT_APP_COOKIE_INFO_URL:"/static/viewer/rgpd.html",REACT_APP_COOKIE_MESSAGE:"This website uses cookies to improve your browsing experience. By pressing 'I Accept' you are agreeing to its use.",REACT_APP_COOKIE_NAME:"scalargis_rgpd",REACT_APP_COOKIE_PATH:"/",REACT_APP_COOKIE_VALUE:"2",REACT_APP_DEFAULT_THEME:"default",REACT_APP_DESCRIPTION:"ScalarGIS - Web GIS framework",REACT_APP_ENTITY_NAME:"ScalarGIS",REACT_APP_ENTITY_NAME_ABREV:"ScalarGIS",REACT_APP_ENTITY_URL:"https://www.scalargis.com",REACT_APP_MAP_PROXY:"/proxy?url=",REACT_APP_ROOT_PATH:"",REACT_APP_TITLE:"ScalarGIS",REACT_APP_UPLOAD_URL:"/spatial_toolbox/convert2geojson"}).REACT_APP_PROXY_URL||"";en("start"),fetch(a+r).then((function(e){return e.text()})).then((function(e){var t=[];(t=f.readFeatures(e,j)).forEach((function(e){return e.ollayer=i})),i.getSource().addFeatures(t),en("end")})).catch((function(t){console.log(t),i.getSource().removeLoadedExtent(e),en("end")}))}});i=new wt.a({visible:t.active,source:b,style:a});break;case"KML":i=new wt.a({visible:t.active,source:new It.a({url:t.url,format:new Dt.a({extractStyles:!1})}),style:a});break;case"GeoJSON":i=new wt.a({visible:t.active,source:new It.a({url:t.url,format:new le.a}),style:a});break;case"GML":i=new wt.a({visible:t.active,source:new It.a({url:t.url,format:new Ft.a({srsName:"EPSG:3763",defaultDataProjection:"EPSG:3763"})}),style:a});break;case"GROUP":i=new se.b({visible:t.active});var m=new lt.a;if(Array.isArray(t.children)){var g=Object.assign([],r.filter((function(e){return t.children.includes(e.id)})));g.reverse(),g.map((function(t){var i=e(t,n,r);return m.push(i),!0})),i.setLayers(m)}}if(i instanceof se.b||((i.getSource()instanceof Ct.a||i.getSource()instanceof St.a)&&(i.getSource().on("tileloadstart",(function(){en("start")})),i.getSource().on("tileloadend",(function(){en("end")})),i.getSource().on("tileloaderror",(function(){en("end")}))),i.getSource()instanceof Tt.a&&(i.getSource().on("imageloadstart",(function(){en("start")})),i.getSource().on("imageloadend",(function(){en("end")})),i.getSource().on("imageloaderror",(function(){en("end")})))),i instanceof se.b&&delete t.layers,i.setProperties(t,!0),t.max_scale&&t.max_scale>0){var v=pn(t.max_scale,n.getView().getProjection().getUnits());i.setMaxResolution(v)}if(t.min_scale&&t.min_scale>0){var O=pn(t.min_scale,n.getView().getProjection().getUnits());i.setMinResolution(O)}return i.setVisible(!!t.active),i}},en=function(e){"start"===e&&qt++,"end"===e&&qt--,qt=qt<0?0:qt},tn=function(e,t,n){var r=e;return(r+=-1===r.indexOf("?")?"?":"")+"&"+["SERVICE=WMS","VERSION=1.1.1","REQUEST=GetLegendGraphic","FORMAT=image%2Fpng","SRS="+(-1===n.indexOf(":")?"EPSG:"+n:n),"CRS="+(-1===n.indexOf(":")?"EPSG:"+n:n),"LAYER="+t].join("&")},nn=function(e,t,n,r,i){var a=Object({NODE_ENV:"production",PUBLIC_URL:"/static/viewer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"/api",REACT_APP_BASE_URL:"",REACT_APP_CLIENT_URL:"/static/viewer",REACT_APP_CONFIG_URL:"/static/viewer/config.json",REACT_APP_COOKIE_AUTH_NAME:"scalargis_webgis",REACT_APP_COOKIE_EXPIRES_DAYS:"150",REACT_APP_COOKIE_INFO_URL:"/static/viewer/rgpd.html",REACT_APP_COOKIE_MESSAGE:"This website uses cookies to improve your browsing experience. By pressing 'I Accept' you are agreeing to its use.",REACT_APP_COOKIE_NAME:"scalargis_rgpd",REACT_APP_COOKIE_PATH:"/",REACT_APP_COOKIE_VALUE:"2",REACT_APP_DEFAULT_THEME:"default",REACT_APP_DESCRIPTION:"ScalarGIS - Web GIS framework",REACT_APP_ENTITY_NAME:"ScalarGIS",REACT_APP_ENTITY_NAME_ABREV:"ScalarGIS",REACT_APP_ENTITY_URL:"https://www.scalargis.com",REACT_APP_MAP_PROXY:"/proxy?url=",REACT_APP_ROOT_PATH:"",REACT_APP_TITLE:"ScalarGIS",REACT_APP_UPLOAD_URL:"/spatial_toolbox/convert2geojson"}).REACT_APP_PROXY_URL||Object({NODE_ENV:"production",PUBLIC_URL:"/static/viewer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"/api",REACT_APP_BASE_URL:"",REACT_APP_CLIENT_URL:"/static/viewer",REACT_APP_CONFIG_URL:"/static/viewer/config.json",REACT_APP_COOKIE_AUTH_NAME:"scalargis_webgis",REACT_APP_COOKIE_EXPIRES_DAYS:"150",REACT_APP_COOKIE_INFO_URL:"/static/viewer/rgpd.html",REACT_APP_COOKIE_MESSAGE:"This website uses cookies to improve your browsing experience. By pressing 'I Accept' you are agreeing to its use.",REACT_APP_COOKIE_NAME:"scalargis_rgpd",REACT_APP_COOKIE_PATH:"/",REACT_APP_COOKIE_VALUE:"2",REACT_APP_DEFAULT_THEME:"default",REACT_APP_DESCRIPTION:"ScalarGIS - Web GIS framework",REACT_APP_ENTITY_NAME:"ScalarGIS",REACT_APP_ENTITY_NAME_ABREV:"ScalarGIS",REACT_APP_ENTITY_URL:"https://www.scalargis.com",REACT_APP_MAP_PROXY:"/proxy?url=",REACT_APP_ROOT_PATH:"",REACT_APP_TITLE:"ScalarGIS",REACT_APP_UPLOAD_URL:"/spatial_toolbox/convert2geojson"}).REACT_APP_PUBLIC_URL,o=e.getSource().getGetFeatureInfoUrl(n,t,"EPSG:3857",{INFO_FORMAT:"application/geojson"});fetch(a+o).then((function(e){return e.json()})).then((function(e){var t=(new le.a).readFeatures(e,{dataProjection:"EPSG:3857",featureProjection:"EPSG:3857"});t.length?r(t[0]):i()})).catch((function(e){i()}))},rn=function(e,t,n,r,i){var a=Object({NODE_ENV:"production",PUBLIC_URL:"/static/viewer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"/api",REACT_APP_BASE_URL:"",REACT_APP_CLIENT_URL:"/static/viewer",REACT_APP_CONFIG_URL:"/static/viewer/config.json",REACT_APP_COOKIE_AUTH_NAME:"scalargis_webgis",REACT_APP_COOKIE_EXPIRES_DAYS:"150",REACT_APP_COOKIE_INFO_URL:"/static/viewer/rgpd.html",REACT_APP_COOKIE_MESSAGE:"This website uses cookies to improve your browsing experience. By pressing 'I Accept' you are agreeing to its use.",REACT_APP_COOKIE_NAME:"scalargis_rgpd",REACT_APP_COOKIE_PATH:"/",REACT_APP_COOKIE_VALUE:"2",REACT_APP_DEFAULT_THEME:"default",REACT_APP_DESCRIPTION:"ScalarGIS - Web GIS framework",REACT_APP_ENTITY_NAME:"ScalarGIS",REACT_APP_ENTITY_NAME_ABREV:"ScalarGIS",REACT_APP_ENTITY_URL:"https://www.scalargis.com",REACT_APP_MAP_PROXY:"/proxy?url=",REACT_APP_ROOT_PATH:"",REACT_APP_TITLE:"ScalarGIS",REACT_APP_UPLOAD_URL:"/spatial_toolbox/convert2geojson"}).REACT_APP_PROXY_URL||Object({NODE_ENV:"production",PUBLIC_URL:"/static/viewer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"/api",REACT_APP_BASE_URL:"",REACT_APP_CLIENT_URL:"/static/viewer",REACT_APP_CONFIG_URL:"/static/viewer/config.json",REACT_APP_COOKIE_AUTH_NAME:"scalargis_webgis",REACT_APP_COOKIE_EXPIRES_DAYS:"150",REACT_APP_COOKIE_INFO_URL:"/static/viewer/rgpd.html",REACT_APP_COOKIE_MESSAGE:"This website uses cookies to improve your browsing experience. By pressing 'I Accept' you are agreeing to its use.",REACT_APP_COOKIE_NAME:"scalargis_rgpd",REACT_APP_COOKIE_PATH:"/",REACT_APP_COOKIE_VALUE:"2",REACT_APP_DEFAULT_THEME:"default",REACT_APP_DESCRIPTION:"ScalarGIS - Web GIS framework",REACT_APP_ENTITY_NAME:"ScalarGIS",REACT_APP_ENTITY_NAME_ABREV:"ScalarGIS",REACT_APP_ENTITY_URL:"https://www.scalargis.com",REACT_APP_MAP_PROXY:"/proxy?url=",REACT_APP_ROOT_PATH:"",REACT_APP_TITLE:"ScalarGIS",REACT_APP_UPLOAD_URL:"/spatial_toolbox/convert2geojson"}).REACT_APP_PUBLIC_URL,o=e.getSource().getGetFeatureInfoUrl(n,t,"EPSG:3857",{INFO_FORMAT:"application/json"});fetch(a+o).then((function(e){return e.json()})).then((function(e){var t=(new le.a).readFeatures(e,{dataProjection:"EPSG:3857",featureProjection:"EPSG:3857"});t.length?r(t[0]):i()})).catch((function(e){i()}))},an=function(e,t,n,r,i){var a=Object({NODE_ENV:"production",PUBLIC_URL:"/static/viewer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"/api",REACT_APP_BASE_URL:"",REACT_APP_CLIENT_URL:"/static/viewer",REACT_APP_CONFIG_URL:"/static/viewer/config.json",REACT_APP_COOKIE_AUTH_NAME:"scalargis_webgis",REACT_APP_COOKIE_EXPIRES_DAYS:"150",REACT_APP_COOKIE_INFO_URL:"/static/viewer/rgpd.html",REACT_APP_COOKIE_MESSAGE:"This website uses cookies to improve your browsing experience. By pressing 'I Accept' you are agreeing to its use.",REACT_APP_COOKIE_NAME:"scalargis_rgpd",REACT_APP_COOKIE_PATH:"/",REACT_APP_COOKIE_VALUE:"2",REACT_APP_DEFAULT_THEME:"default",REACT_APP_DESCRIPTION:"ScalarGIS - Web GIS framework",REACT_APP_ENTITY_NAME:"ScalarGIS",REACT_APP_ENTITY_NAME_ABREV:"ScalarGIS",REACT_APP_ENTITY_URL:"https://www.scalargis.com",REACT_APP_MAP_PROXY:"/proxy?url=",REACT_APP_ROOT_PATH:"",REACT_APP_TITLE:"ScalarGIS",REACT_APP_UPLOAD_URL:"/spatial_toolbox/convert2geojson"}).REACT_APP_PROXY_URL||Object({NODE_ENV:"production",PUBLIC_URL:"/static/viewer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"/api",REACT_APP_BASE_URL:"",REACT_APP_CLIENT_URL:"/static/viewer",REACT_APP_CONFIG_URL:"/static/viewer/config.json",REACT_APP_COOKIE_AUTH_NAME:"scalargis_webgis",REACT_APP_COOKIE_EXPIRES_DAYS:"150",REACT_APP_COOKIE_INFO_URL:"/static/viewer/rgpd.html",REACT_APP_COOKIE_MESSAGE:"This website uses cookies to improve your browsing experience. By pressing 'I Accept' you are agreeing to its use.",REACT_APP_COOKIE_NAME:"scalargis_rgpd",REACT_APP_COOKIE_PATH:"/",REACT_APP_COOKIE_VALUE:"2",REACT_APP_DEFAULT_THEME:"default",REACT_APP_DESCRIPTION:"ScalarGIS - Web GIS framework",REACT_APP_ENTITY_NAME:"ScalarGIS",REACT_APP_ENTITY_NAME_ABREV:"ScalarGIS",REACT_APP_ENTITY_URL:"https://www.scalargis.com",REACT_APP_MAP_PROXY:"/proxy?url=",REACT_APP_ROOT_PATH:"",REACT_APP_TITLE:"ScalarGIS",REACT_APP_UPLOAD_URL:"/spatial_toolbox/convert2geojson"}).REACT_APP_PUBLIC_URL,o=e.getSource().getGetFeatureInfoUrl(n,t,"EPSG:3857",{INFO_FORMAT:"text/xml"});fetch(a+o).then((function(e){return e.text()})).then((function(e){var t=[],n=(new Lt.a).readFeatures(e,{dataProjection:"EPSG:3857",featureProjection:"EPSG:3857"});if(n&&n.length)return r(n[0]);Yt.a.parseString(e,(function(e,n){return e?i():(n.FeatureInfoResponse&&n.FeatureInfoResponse.FIELDS.forEach((function(e){t.push(e.$)})),t.length?void r(t[0]):i())}))})).catch((function(e){i()}))},on=function(e,t,n,r,i){var a=e.getProperties(),o=Object({NODE_ENV:"production",PUBLIC_URL:"/static/viewer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"/api",REACT_APP_BASE_URL:"",REACT_APP_CLIENT_URL:"/static/viewer",REACT_APP_CONFIG_URL:"/static/viewer/config.json",REACT_APP_COOKIE_AUTH_NAME:"scalargis_webgis",REACT_APP_COOKIE_EXPIRES_DAYS:"150",REACT_APP_COOKIE_INFO_URL:"/static/viewer/rgpd.html",REACT_APP_COOKIE_MESSAGE:"This website uses cookies to improve your browsing experience. By pressing 'I Accept' you are agreeing to its use.",REACT_APP_COOKIE_NAME:"scalargis_rgpd",REACT_APP_COOKIE_PATH:"/",REACT_APP_COOKIE_VALUE:"2",REACT_APP_DEFAULT_THEME:"default",REACT_APP_DESCRIPTION:"ScalarGIS - Web GIS framework",REACT_APP_ENTITY_NAME:"ScalarGIS",REACT_APP_ENTITY_NAME_ABREV:"ScalarGIS",REACT_APP_ENTITY_URL:"https://www.scalargis.com",REACT_APP_MAP_PROXY:"/proxy?url=",REACT_APP_ROOT_PATH:"",REACT_APP_TITLE:"ScalarGIS",REACT_APP_UPLOAD_URL:"/spatial_toolbox/convert2geojson"}).REACT_APP_PROXY_URL||Object({NODE_ENV:"production",PUBLIC_URL:"/static/viewer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"/api",REACT_APP_BASE_URL:"",REACT_APP_CLIENT_URL:"/static/viewer",REACT_APP_CONFIG_URL:"/static/viewer/config.json",REACT_APP_COOKIE_AUTH_NAME:"scalargis_webgis",REACT_APP_COOKIE_EXPIRES_DAYS:"150",REACT_APP_COOKIE_INFO_URL:"/static/viewer/rgpd.html",REACT_APP_COOKIE_MESSAGE:"This website uses cookies to improve your browsing experience. By pressing 'I Accept' you are agreeing to its use.",REACT_APP_COOKIE_NAME:"scalargis_rgpd",REACT_APP_COOKIE_PATH:"/",REACT_APP_COOKIE_VALUE:"2",REACT_APP_DEFAULT_THEME:"default",REACT_APP_DESCRIPTION:"ScalarGIS - Web GIS framework",REACT_APP_ENTITY_NAME:"ScalarGIS",REACT_APP_ENTITY_NAME_ABREV:"ScalarGIS",REACT_APP_ENTITY_URL:"https://www.scalargis.com",REACT_APP_MAP_PROXY:"/proxy?url=",REACT_APP_ROOT_PATH:"",REACT_APP_TITLE:"ScalarGIS",REACT_APP_UPLOAD_URL:"/spatial_toolbox/convert2geojson"}).REACT_APP_PUBLIC_URL,c=e.getSource().getGetFeatureInfoUrl(n,t,"EPSG:3857",{INFO_FORMAT:"application/vnd.ogc.gml"});fetch(o+c).then((function(e){return e.text()})).then((function(e){var t=new Lt.a,n={dataProjection:"EPSG:3857",featureProjection:"EPSG:3857"},o=t.readFeatures(e,n);o.length||(n={dataProjection:"EPSG:3857",featureProjection:"EPSG:3857"},o=(t=new Ft.a).readFeatures(e,n)),o.length||(t=new Ut.a,n={dataProjection:"EPSG:3857",featureProjection:"EPSG:3857",featureType:a.layers},o=t.readFeatures(e,n)),o.length?r(o[0]):i()})).catch((function(e){i()}))},cn=function(e,t,n,r,i){var a=Object({NODE_ENV:"production",PUBLIC_URL:"/static/viewer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"/api",REACT_APP_BASE_URL:"",REACT_APP_CLIENT_URL:"/static/viewer",REACT_APP_CONFIG_URL:"/static/viewer/config.json",REACT_APP_COOKIE_AUTH_NAME:"scalargis_webgis",REACT_APP_COOKIE_EXPIRES_DAYS:"150",REACT_APP_COOKIE_INFO_URL:"/static/viewer/rgpd.html",REACT_APP_COOKIE_MESSAGE:"This website uses cookies to improve your browsing experience. By pressing 'I Accept' you are agreeing to its use.",REACT_APP_COOKIE_NAME:"scalargis_rgpd",REACT_APP_COOKIE_PATH:"/",REACT_APP_COOKIE_VALUE:"2",REACT_APP_DEFAULT_THEME:"default",REACT_APP_DESCRIPTION:"ScalarGIS - Web GIS framework",REACT_APP_ENTITY_NAME:"ScalarGIS",REACT_APP_ENTITY_NAME_ABREV:"ScalarGIS",REACT_APP_ENTITY_URL:"https://www.scalargis.com",REACT_APP_MAP_PROXY:"/proxy?url=",REACT_APP_ROOT_PATH:"",REACT_APP_TITLE:"ScalarGIS",REACT_APP_UPLOAD_URL:"/spatial_toolbox/convert2geojson"}).REACT_APP_PROXY_URL||Object({NODE_ENV:"production",PUBLIC_URL:"/static/viewer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"/api",REACT_APP_BASE_URL:"",REACT_APP_CLIENT_URL:"/static/viewer",REACT_APP_CONFIG_URL:"/static/viewer/config.json",REACT_APP_COOKIE_AUTH_NAME:"scalargis_webgis",REACT_APP_COOKIE_EXPIRES_DAYS:"150",REACT_APP_COOKIE_INFO_URL:"/static/viewer/rgpd.html",REACT_APP_COOKIE_MESSAGE:"This website uses cookies to improve your browsing experience. By pressing 'I Accept' you are agreeing to its use.",REACT_APP_COOKIE_NAME:"scalargis_rgpd",REACT_APP_COOKIE_PATH:"/",REACT_APP_COOKIE_VALUE:"2",REACT_APP_DEFAULT_THEME:"default",REACT_APP_DESCRIPTION:"ScalarGIS - Web GIS framework",REACT_APP_ENTITY_NAME:"ScalarGIS",REACT_APP_ENTITY_NAME_ABREV:"ScalarGIS",REACT_APP_ENTITY_URL:"https://www.scalargis.com",REACT_APP_MAP_PROXY:"/proxy?url=",REACT_APP_ROOT_PATH:"",REACT_APP_TITLE:"ScalarGIS",REACT_APP_UPLOAD_URL:"/spatial_toolbox/convert2geojson"}).REACT_APP_PUBLIC_URL,o=e.getSource().getGetFeatureInfoUrl(n,t,"EPSG:3857",{INFO_FORMAT:"text/html"});fetch(a+o).then((function(e){return e.text()})).then((function(e){r(e)})).catch((function(e){i()}))},sn=function(e,t,n,r,i){var a=Object({NODE_ENV:"production",PUBLIC_URL:"/static/viewer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"/api",REACT_APP_BASE_URL:"",REACT_APP_CLIENT_URL:"/static/viewer",REACT_APP_CONFIG_URL:"/static/viewer/config.json",REACT_APP_COOKIE_AUTH_NAME:"scalargis_webgis",REACT_APP_COOKIE_EXPIRES_DAYS:"150",REACT_APP_COOKIE_INFO_URL:"/static/viewer/rgpd.html",REACT_APP_COOKIE_MESSAGE:"This website uses cookies to improve your browsing experience. By pressing 'I Accept' you are agreeing to its use.",REACT_APP_COOKIE_NAME:"scalargis_rgpd",REACT_APP_COOKIE_PATH:"/",REACT_APP_COOKIE_VALUE:"2",REACT_APP_DEFAULT_THEME:"default",REACT_APP_DESCRIPTION:"ScalarGIS - Web GIS framework",REACT_APP_ENTITY_NAME:"ScalarGIS",REACT_APP_ENTITY_NAME_ABREV:"ScalarGIS",REACT_APP_ENTITY_URL:"https://www.scalargis.com",REACT_APP_MAP_PROXY:"/proxy?url=",REACT_APP_ROOT_PATH:"",REACT_APP_TITLE:"ScalarGIS",REACT_APP_UPLOAD_URL:"/spatial_toolbox/convert2geojson"}).REACT_APP_PROXY_URL||Object({NODE_ENV:"production",PUBLIC_URL:"/static/viewer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"/api",REACT_APP_BASE_URL:"",REACT_APP_CLIENT_URL:"/static/viewer",REACT_APP_CONFIG_URL:"/static/viewer/config.json",REACT_APP_COOKIE_AUTH_NAME:"scalargis_webgis",REACT_APP_COOKIE_EXPIRES_DAYS:"150",REACT_APP_COOKIE_INFO_URL:"/static/viewer/rgpd.html",REACT_APP_COOKIE_MESSAGE:"This website uses cookies to improve your browsing experience. By pressing 'I Accept' you are agreeing to its use.",REACT_APP_COOKIE_NAME:"scalargis_rgpd",REACT_APP_COOKIE_PATH:"/",REACT_APP_COOKIE_VALUE:"2",REACT_APP_DEFAULT_THEME:"default",REACT_APP_DESCRIPTION:"ScalarGIS - Web GIS framework",REACT_APP_ENTITY_NAME:"ScalarGIS",REACT_APP_ENTITY_NAME_ABREV:"ScalarGIS",REACT_APP_ENTITY_URL:"https://www.scalargis.com",REACT_APP_MAP_PROXY:"/proxy?url=",REACT_APP_ROOT_PATH:"",REACT_APP_TITLE:"ScalarGIS",REACT_APP_UPLOAD_URL:"/spatial_toolbox/convert2geojson"}).REACT_APP_PUBLIC_URL,o=e.getSource().getGetFeatureInfoUrl(n,t,"EPSG:3857",{INFO_FORMAT:"text/plain"});fetch(a+o).then((function(e){return e.text()})).then((function(e){r(e)})).catch((function(e){i()}))},ln=function(){var e=Object(_t.a)(Object(Ot.a)().mark((function e(t,n,r,i){var a,o;return Object(Ot.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=function(e){return new Promise((function(i,a){/xml/gi.test(e)?an(t,n,r,i,a):/gml/gi.test(e)?on(t,n,r,i,a):/geojson/gi.test(e)?nn(t,n,r,i,a):/json/gi.test(e)?rn(t,n,r,i,a):/html/gi.test(e)?cn(t,n,r,i,a):/plain/gi.test(e)?sn(t,n,r,i,a):a()}))},o=t.getProperties(),a(o.get_feature_info_format).then((function(e){i(e)})).catch((function(e){i(!1)}));case 3:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),un=function(e){return(new le.a).readFeatures(e,{dataProjection:"EPSG:3857",featureProjection:"EPSG:3857"})},dn=function(e){return(new le.a).writeFeatures(e,{dataProjection:"EPSG:3857",featureProjection:"EPSG:3857"})},pn=function(e,t){return parseFloat(e)/(72*Jt[t])},fn=function(e,t){var n=72*Jt[t]*e;return Math.round(n)},jn=function(e,t){var n=!0,r=e.getView().getResolution();if(t.source_max_scale){var i=pn(t.source_max_scale,e.getView().getProjection().getUnits());n=n&&r<=i}if(t.source_min_scale){var a=pn(t.source_min_scale,e.getView().getProjection().getUnits());n=n&&r>=a}if(t.max_scale){var o=pn(t.max_scale,e.getView().getProjection().getUnits());n=n&&r<=o}if(t.min_scale){var c=pn(t.min_scale,e.getView().getProjection().getUnits());n=n&&r>=c}return n},hn=function(e){var t=("object"===typeof e&&null!==e?e.getCode():e).split(":")[1];return parseInt(t)},bn={processVisibility:function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];t&&t.forEach((function(t){n.indexOf(t.get("id"))>-1||t.get("always_visible")?t.setVisible(!0):t.setVisible(!1),t instanceof se.b&&e(t.getLayers(),n)}))},traverseTree:function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(t=t||[]).map((function(i,a){return n(i,a,t,r),e(i.children,n,i),i}))},processOpacity:function e(t,n){t&&t.forEach((function(t){n.forEach((function(e){e.id===t.get("id")&&"undefined"!==typeof e.opacity&&(t.setOpacity(e.opacity),t.setProperties(e))})),t instanceof se.b&&e(t.getLayers(),n)}))},processRemoveThemes:function e(t,n){t&&t.forEach((function(r,i){r&&n.includes(String(r.get("id")))&&t.removeAt(i),r instanceof se.b&&e(r.getLayers(),n)}))},getViewerSessionConfig:Zt,transformExtent:$t,createStyle:function(e){var t=e.style_color?"rgba(".concat(e.style_color,")"):"rgba(255,255,255,0.7)",n=e.style_stroke_color?"rgba(".concat(e.style_stroke_color,")"):"rgba(37,150,190,1)",r="undefined"===typeof e.style_stroke_width?3:Number(e.style_stroke_width),i="undefined"===typeof e.style_image_radius?3:Number(e.style_image_radius);return new ue.c({image:new de.a({radius:i,snapToPixel:!1,fill:new pe.a({color:t}),stroke:new fe.a({color:n,width:r})}),fill:new pe.a({color:t}),stroke:new fe.a({color:n,width:r})})},createLayer:Qt,checkLoading:en,addBaseLayers:function(e,t){var n;e&&t&&t.map((function(t){return n=Qt(t,e),e.addLayer(n),n}))},addLayers:function(e,t){var n;if(e&&t){var r=Object.assign([],t);r.reverse(),r.map((function(r){return n=Qt(r,e,t),e.addLayer(n),n}))}},createLegendUrl:tn,toggleinteractionDragBox:function(e){},findActiveWMSLayer:function e(t){var n=[];return t.forEach((function(t){(t.getVisible()&&t.getSource&&(t.getSource()instanceof Ct.a||t.getSource()instanceof Tt.a)&&n.push(t),t instanceof se.b&&t.getVisible())&&e(t.getLayers()).forEach((function(e){return n.push(e)}))})),n},toggleGetFeatureInfo:function(){},disableZoomExtent:function(){},updateBBOXCenter:function(e){},setFeatureInfo:function(e){},getFeatureInfo:function(){},getState:function(){},zoomTheme:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=null,r=t.getView().getProjection().getCode();e.crs!==r&&e.bbox&&(n=$t("EPSG:"+e.crs,r,e.bbox.split(" ")).join(" ")),n=n.split(" ").map((function(e){return parseFloat(e)})),t&&t.getView().fit(n,{nearest:!0})},parseFeatureInfo:ln,getResolutionForScale:pn,getScaleForResolution:fn,getCurrentScale:function(e){var t=e.getView().getResolution(),n=e.getView().getProjection().getUnits();return fn(t,n)},getThemeLegendUrl:function(e){var t=e.legend_url,n=e.wms_style;return n&&(/style=/i.test(t)?t=t.replace(/style=(.*)&?/i,"style="+n+"&"):t+="&style="+n),t},serializeFeatures:dn,deserializeFeatures:un,getProjectionSrid:hn,getPolygonFromExtent:function(e,t){var n=e;"string"===typeof e&&(n=e.split(t||" "));var r=[[parseFloat(n[0]),parseFloat(n[3])],[parseFloat(n[2]),parseFloat(n[3])],[parseFloat(n[2]),parseFloat(n[1])],[parseFloat(n[0]),parseFloat(n[1])],[parseFloat(n[0]),parseFloat(n[3])]];return new Vt.b(new Array(r))},getWKTFromGeometry:function(e){return(new Mt.a).writeGeometry(e)},getGeometryFromWKT:function(e,t){var n=new Mt.a;return t?n.readGeometry(e,t):n.readGeometry(e)},getWMSVisibleLayers:function(e,t){for(var n=[],r=function t(n,r){if(n.getVisible())if(n instanceof se.b)for(var i=n.getLayers().getArray(),a=0;a<i.length;a++)t(i[a],r);else{var o=n.getSource();if(o instanceof Ct.a||o instanceof Tt.a){var c="";c=o.getUrl?o.getUrl():o.getUrls()[0];var s={},l=o.getParams();for(var u in l)s[u]=l[u];var d={url:c,params:s,opacity:n.getOpacity(),minScale:0,maxScale:0};n.getMaxResolution&&n.getMaxResolution()>0&&(d.minScale=fn(n.getMaxResolution(),e.getView().getProjection().getUnits())),n.getMinResolution&&n.getMinResolution()>0&&(d.maxScale=fn(n.getMinResolution(),e.getView().getProjection().getUnits())),r.push(d)}else if(n.get("print")){(n.get("print").length?n.get("print"):[n.get("print")]).forEach((function(t){if("wms"===t.type){var i={};i.FORMAT=t.format||"image/png",t.layers&&(i.LAYERS=t.layers),i.STYLES=t.styles||"",i.VERSION=t.version||"1.3.0",t.cql_filter&&(i.CQL_FILTER=t.cql_filter);var a={url:t.url,params:i,opacity:n.getOpacity(),minScale:0,maxScale:0};n.getMaxResolution&&n.getMaxResolution()>0&&(a.minScale=fn(n.getMaxResolution(),e.getView().getProjection().getUnits())),t.maxResolution&&t.maxResolution>0&&(a.minScale=fn(t.maxResolution,e.getView().getProjection().getUnits())),t.minScale&&t.minScale>0&&(a.minScale=t.minScale),n.getMinResolution&&n.getMinResolution()>0&&(a.maxScale=fn(n.getMinResolution(),e.getView().getProjection().getUnits())),t.minResolution&&t.minResolution>0&&(a.maxScale=fn(t.minResolution,e.getView().getProjection().getUnits())),t.maxScale&&t.maxScale>0&&(a.maxScale=t.maxScale),r.push(a)}}))}}},i=e.getLayers().getArray(),a=0;a<i.length;a++)r(i[a],n);return n},getArcGISVisibleLayers:function(e,t){for(var n=[],r=function t(n,r){if(n.getVisible())if(n instanceof se.b)for(var i=n.getLayers().getArray(),a=0;a<i.length;a++)t(i[a],r);else{var o=n.getSource();if(o instanceof Rt.a||o instanceof Nt.a){var c="";c=o.getUrl?o.getUrl():o.getUrls()[0];var s={},l=o.getParams();for(var u in l)s[u]=l[u];var d={url:c,params:s,opacity:n.getOpacity(),minScale:0,maxScale:0};n.getMaxResolution&&n.getMaxResolution()>0&&(d.minScale=fn(n.getMaxResolution(),e.getView().getProjection().getUnits())),n.getMinResolution&&n.getMinResolution()>0&&(d.maxScale=fn(n.getMinResolution(),e.getView().getProjection().getUnits())),r.push(d)}else if(n.get("print")){(n.get("print").length?n.get("print"):[n.get("print")]).forEach((function(t){if("ArcGIS"===t.type){var i={};i.FORMAT=t.format||"image/png",t.layers&&(i.LAYERS=t.layers),i.STYLES=t.styles||"",i.VERSION=t.version||"1.3.0",t.cql_filter&&(i.CQL_FILTER=t.cql_filter);var a={url:t.url,params:i,opacity:n.getOpacity(),minScale:0,maxScale:0};n.getMaxResolution&&n.getMaxResolution()>0&&(a.minScale=fn(n.getMaxResolution(),e.getView().getProjection().getUnits())),t.maxResolution&&t.maxResolution>0&&(a.minScale=fn(t.maxResolution,e.getView().getProjection().getUnits())),t.minScale&&t.minScale>0&&(a.minScale=t.minScale),n.getMinResolution&&n.getMinResolution()>0&&(a.maxScale=fn(n.getMinResolution(),e.getView().getProjection().getUnits())),t.minResolution&&t.minResolution>0&&(a.maxScale=fn(t.minResolution,e.getView().getProjection().getUnits())),t.maxScale&&t.maxScale>0&&(a.maxScale=t.maxScale),r.push(a)}}))}}},i=e.getLayers().getArray(),a=0;a<i.length;a++)r(i[a],n);return n}},mn=new ft.a;var gn=Object(q.b)((function(e){return{viewer:e.root.viewer}}))((function(e){var t,n,r,i,a,o=e.viewer,c=e.record,s=Object(H.useState)(!1),l=Object(X.a)(s,2),u=l[0],d=l[1],p=Object(H.useState)(null),f=Object(X.a)(p,2),j=f[0],h=f[1],b=Object(H.useState)(""),m=Object(X.a)(b,2),g=m[0],v=m[1],O=Object(H.useState)(""),_=Object(X.a)(O,2),x=_[0],y=_[1],w=Object(H.useState)(""),E=Object(X.a)(w,2),S=E[0],P=E[1],A=Object(H.useState)(""),C=Object(X.a)(A,2),T=C[0],R=C[1],N=Object(H.useState)(!0),k=Object(X.a)(N,2),I=k[0],M=k[1],L=Object(H.useState)(!1),F=Object(X.a)(L,2),U=F[0],G=F[1],D=Object(H.useState)(!0),V=Object(X.a)(D,2),W=V[0],K=V[1],B=ye()[0]<=768,Y=Object(q.c)(),Z=Object(H.useContext)(Ml).core,$=Z.actions,Q=$.viewer_save_record,ee=$.viewer_save_response,te=mn.get(Z.COOKIE_AUTH_NAME),ne=!0;function re(e){if(e.preventDefault(),!x||0===x.length)return!1;var t=Zt(o),n={id:j,name:g,title:x,description:S,slug:T,allow_add_layers:I,allow_user_session:U,allow_anonymous:W,config_json:JSON.stringify(t),parent_id:o.id};Y(Q(n,null,null))}return!1===(null===o||void 0===o?void 0:o.allow_sharing)&&(ne=!1),!1===(null===o||void 0===o||null===(t=o.config_json)||void 0===t?void 0:t.allow_sharing)?ne=!1:!0===(null===o||void 0===o||null===(n=o.config_json)||void 0===n?void 0:n.allow_sharing)&&(ne=!0),ne?Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsxs)("button",{className:"p-link",onClick:function(e){return function(){var e,t;if(Y(ee(null)),h(null),v(null),y(o.title),P(o.description),R(null),!1===(null===c||void 0===c||null===(e=c.config_json)||void 0===e?void 0:e.allow_add_layers)&&M(!1),te){var n,r=null==o.allow_anonymous||o.allow_anonymous;!1===(null===c||void 0===c||null===(n=c.config_json)||void 0===n?void 0:n.allow_anonymous)&&(r=!1),K(r)}else K(!0);!0===(null===c||void 0===c||null===(t=c.config_json)||void 0===t?void 0:t.allow_user_session)&&G(!0),d(!0)}()},title:"Partilhar mapa",children:[Object(J.jsx)("span",{className:"layout-topbar-item-text",children:"Partilhar"}),Object(J.jsx)("span",{className:"layout-topbar-icon pi pi-share-alt"})]}),Ke(Object(J.jsx)(vt.a,{header:"Partilhar Mapa",visible:u,style:{width:B?"90%":"35vw"},modal:!0,onHide:function(e){return d(!1)},children:Object(J.jsxs)("form",{onSubmit:function(e){return re()},children:[Object(J.jsxs)("div",{className:"p-fluid",children:[Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{className:"p-col-12 p-md-4",children:"T\xedtulo"}),Object(J.jsxs)("div",{className:"p-col-12 p-md-8",children:[Object(J.jsx)(jt.a,{className:x&&0!==x.length?"":"p-invalid",value:x,placeholder:"T\xedtulo",onChange:function(e){return y(e.target.value)}}),(!x||0==x.length)&&Object(J.jsx)("small",{className:"p-invalid p-d-block",children:"Campo de preenchimento obrigat\xf3rio"})]})]}),Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{className:"p-col-12 p-md-4",children:"Descri\xe7\xe3o"}),Object(J.jsx)("div",{className:"p-col-12 p-md-8",children:Object(J.jsx)(ht.a,{rows:3,value:S,placeholder:"Descri\xe7\xe3o",onChange:function(e){return P(e.target.value)}})})]}),!1!==(null===c||void 0===c||null===(r=c.config_json)||void 0===r?void 0:r.show_allow_add_layers)&&Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{className:"p-col-12 p-md-4",children:"Permitir adicionar temas ao mapa?"}),Object(J.jsx)("div",{className:"p-col-12 p-md-8",children:Object(J.jsx)(gt.a,{checked:I,onChange:function(e){return M(!I)}})})]}),te&&!1!==(null===c||void 0===c||null===(i=c.config_json)||void 0===i?void 0:i.show_allow_user_session)&&Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{className:"p-col-12 p-md-4",children:"Permitir gravar sess\xe3o?"}),Object(J.jsx)("div",{className:"p-col-12 p-md-8",children:Object(J.jsx)(gt.a,{checked:U,onChange:function(e){return G(!U)}})})]}),te&&!1!==(null===c||void 0===c||null===(a=c.config_json)||void 0===a?void 0:a.show_allow_anonymous)&&Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{className:"p-col-12 p-md-4",children:"Permitir acesso an\xf3nimo?"}),Object(J.jsx)("div",{className:"p-col-12 p-md-8",children:Object(J.jsx)(gt.a,{checked:W,onChange:function(e){return K(!W)}})})]})]}),o.save_response&&Object(J.jsxs)("div",{className:"p-grid",children:[Object(J.jsx)("label",{className:"p-col-12",children:Object(J.jsx)("strong",{children:"Url"})}),Object(J.jsx)("div",{className:"p-col-12 p-md-10",children:Object(J.jsx)("a",{style:{wordBreak:"break-all"},href:Ie(o.save_response.uuid),target:"_blank",rel:"noopener noreferrer",children:Ie(o.save_response.uuid)})}),Object(J.jsx)("div",{className:"p-col-12 p-md-2",children:Object(J.jsx)(bt.a,{style:{marginLeft:"0px",color:"#2196F"},icon:"pi pi-copy",className:"p-button p-component p-button-rounded p-button-outlined p-button-help p-button-icon-only",onClick:function(e){e.preventDefault(),e.currentTarget.blur(),function(e){var t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}(Ie(o.save_response.uuid))},tooltip:"Copiar Url",tooltipOptions:{position:"top"}})})]}),Object(J.jsx)("div",{className:"p-dialog-myfooter",children:Object(J.jsx)(bt.a,{color:"green",icon:o.save_loading?"pi pi-spin pi-spinner":"pi pi-check",label:"Obter Link",onClick:re,disabled:o.save_loading})}),o.save_error&&Object(J.jsx)(mt.a,{style:{width:"100%"},severity:"error",text:"Servi\xe7o Indispon\xedvel"}),o.save_response&&!!o.save_response.message&&Object(J.jsx)(mt.a,{style:{width:"100%"},severity:"error",text:"Ocorreu um erro"})]})}))]}):null})),vn=new ft.a;var On=Object(q.b)((function(e){return{viewer:e.root.viewer}}))((function(e){var t=e.viewer,n=Object(H.useState)(!1),r=Object(X.a)(n,2),i=r[0],a=r[1],o=Object(H.useState)(null),c=Object(X.a)(o,2),s=c[0],l=c[1],u=Object(H.useState)(""),d=Object(X.a)(u,2),p=d[0],f=d[1],j=Object(H.useState)(""),h=Object(X.a)(j,2),b=h[0],m=h[1],g=Object(H.useState)(""),v=Object(X.a)(g,2),O=v[0],_=v[1],x=Object(H.useState)(!0),y=Object(X.a)(x,2),w=y[0],E=y[1],S=Object(H.useState)(!0),P=Object(X.a)(S,2),A=P[0],C=P[1],T=Object(H.useState)(!1),R=Object(X.a)(T,2),N=R[0],k=R[1],I=Object(H.useState)(!0),M=Object(X.a)(I,2),L=M[0],F=M[1],U=ye()[0]<=768,G=Object(q.c)(),D=Object(H.useContext)(Ml).core,V=D.actions.viewer_save_record;if(!vn.get(D.COOKIE_AUTH_NAME)||!t.is_owner)return null;function W(e){if(e.preventDefault(),!p||0==p.length||!b||0==b.length)return!1;var n=Zt(t),r={id:s,name:p,title:b,description:O,is_active:w,allow_add_layers:A,allow_user_session:N,allow_anonymous:L,config_json:JSON.stringify(n)};G(V(r,null,null))}return Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsxs)("button",{className:"p-link",onClick:function(e){return l(t.id),f(t.name),m(t.title),_(t.description),E(null===t.is_active||t.is_active),C(t.allow_add_layers),k(null!=t.allow_user_session&&t.allow_user_session),F(null==t.allow_anonymous||t.allow_anonymous),void a(!0)},children:[Object(J.jsx)("span",{className:"layout-topbar-item-text",children:"Guardar"}),Object(J.jsx)("span",{className:"layout-topbar-icon pi pi-save"})]}),Ke(Object(J.jsx)(vt.a,{header:"Guardar Visualizador",visible:i,style:{width:U?"90%":"35vw"},modal:!0,onHide:function(e){return a(!1)},children:Object(J.jsxs)("form",{onSubmit:function(e){return W()},children:[Object(J.jsxs)("div",{className:"p-fluid",children:[Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{className:"p-col-12 p-md-4",children:"Nome"}),Object(J.jsxs)("div",{className:"p-col-12 p-md-8",children:[Object(J.jsx)(jt.a,{className:p&&0!=p.length?"":"p-invalid",value:p,placeholder:"Nome do Visualizador",onChange:function(e){return f(e.target.value)}}),(!p||0==p.length)&&Object(J.jsx)("small",{className:"p-invalid p-d-block",children:"Campo de preenchimento obrigat\xf3rio"})]})]}),Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{className:"p-col-12 p-md-4",children:"T\xedtulo"}),Object(J.jsxs)("div",{className:"p-col-12 p-md-8",children:[Object(J.jsx)(jt.a,{className:b&&0!=b.length?"":"p-invalid",value:b,placeholder:"T\xedtulo",onChange:function(e){return m(e.target.value)}}),(!b||0==b.length)&&Object(J.jsx)("small",{className:"p-invalid p-d-block",children:"Campo de preenchimento obrigat\xf3rio"})]})]}),Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{className:"p-col-12 p-md-4",children:"Descri\xe7\xe3o"}),Object(J.jsx)("div",{className:"p-col-12 p-md-8",children:Object(J.jsx)(ht.a,{rows:3,value:O,placeholder:"Descri\xe7\xe3o",onChange:function(e){return _(e.target.value)}})})]}),Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{className:"p-col-12 p-md-4",children:"Est\xe1 ativo?"}),Object(J.jsx)("div",{className:"p-col-12 p-md-8",children:Object(J.jsx)(gt.a,{checked:w,onChange:function(e){return E(!w)}})})]}),Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{className:"p-col-12 p-md-4",children:"Permitir gravar sess\xe3o?"}),Object(J.jsx)("div",{className:"p-col-12 p-md-8",children:Object(J.jsx)(gt.a,{checked:N,onChange:function(e){return k(!N)}})})]}),Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{className:"p-col-12 p-md-4",children:"Permitir acesso an\xf3nimo?"}),Object(J.jsx)("div",{className:"p-col-12 p-md-8",children:Object(J.jsx)(gt.a,{checked:L,onChange:function(e){return F(!L)}})})]})]}),Object(J.jsx)("div",{className:"p-dialog-myfooter",children:Object(J.jsx)(bt.a,{color:"green",icon:t.save_loading?"pi pi-spin pi-spinner":"pi pi-check",label:"Guardar",onClick:W,disabled:t.save_loading})}),t.save_error&&Object(J.jsx)(mt.a,{style:{width:"100%"},severity:"error",text:"Servi\xe7o Indispon\xedvel"}),t.save_response&&!!t.save_response.message&&Object(J.jsx)(mt.a,{style:{width:"100%"},severity:"error",text:"Chave de URL inv\xe1lida"})]})}))]})})),_n=n(446),xn=n(220),yn=new ft.a;var wn=Object(q.b)((function(e){return{auth:e.root.auth}}))((function(e){var t=e.auth,n=e.history,r=e.redirect,i=e.path,a=e.urlRedirect,o=Object(H.useState)(""),c=Object(X.a)(o,2),s=c[0],l=c[1],u=Object(H.useState)(""),d=Object(X.a)(u,2),p=d[0],f=d[1],j=Object(q.c)(),h=Object(H.useContext)(Ml).core,b=h.actions,m=b.login_post,g=b.login_clear_error,v=b.logout,O=yn.get(h.COOKIE_AUTH_NAME);if(Object(H.useEffect)((function(){j(g())}),[]),O){var _=O.username;return Object(J.jsxs)("div",{children:[Object(J.jsxs)("p",{children:["Ol\xe1 ",_,"."]}),Object(J.jsxs)("p",{children:["Clique para",Object(J.jsx)(bt.a,{className:"p-button-link",onClick:function(e){return j(v())},label:"terminar sess\xe3o"}),"."]})]})}function x(e){e.preventDefault(),j(m({username:s,password:p},n,i?i+r:r,a))}return Object(J.jsxs)("form",{onSubmit:function(e){return x()},children:[Object(J.jsxs)("div",{className:"p-fluid",children:[Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{className:"p-col-12 p-md-4",children:"Nome de Utilizador / E-mail"}),Object(J.jsx)("div",{className:"p-col-12 p-md-8",children:Object(J.jsx)(jt.a,{value:s,placeholder:"Nome de Utilizador",onChange:function(e){return l(e.target.value)}})})]}),Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{className:"p-col-12 p-md-4",children:"Palavra-passe"}),Object(J.jsx)("div",{className:"p-col-12 p-md-8",children:Object(J.jsx)(xn.a,{value:p,placeholder:"Palavra-passe",feedback:!1,onChange:function(e){return f(e.target.value)}})})]})]}),Object(J.jsx)("div",{className:"p-dialog-myfooter",children:Object(J.jsx)(bt.a,{color:"green",icon:t.loading?"pi pi-spin pi-spinner":"pi pi-check",label:"Entrar",onClick:x,disabled:t.loading})}),t.http_error&&!t.response&&Object(J.jsx)(mt.a,{style:{width:"100%"},severity:"error",text:"Servi\xe7o Indispon\xedvel"}),t.response&&!!t.response&&!!t.response.message&&Object(J.jsx)(mt.a,{style:{width:"100%"},severity:"error",text:"Nome de Utilizador ou Palavra-passe inv\xe1lido"})]})})),En=new ft.a,Sn="ScalarGIS";var Pn=Object(q.b)((function(e){return{auth:e.root.auth,config:e.root.config}}))((function(e){var t=Object(H.useState)(!0),n=Object(X.a)(t,2),r=n[0],i=n[1],a=Object(H.useState)(!1),o=Object(X.a)(a,2),c=o[0],s=o[1],l=Object(H.useState)(!1),u=Object(X.a)(l,2),d=u[0],p=u[1],f=Object(H.useRef)(),j=Object(q.c)(),h=Object(H.useContext)(Ml).core,b=h.actions.logout,m=En.get(h.COOKIE_AUTH_NAME),g=ye(),v=(g[0],g[0]<=440);if(Object(H.useEffect)((function(){h.config&&h.config.roles&&1===h.config.roles.length&&"Anonymous"===h.config.roles[0].name&&i(!1)}),[e.config]),m){var O=m.username,_=[{label:"Terminar Sess\xe3o",icon:"pi pi-lock",command:function(){j(b())}}];return v&&_.unshift({label:O,disabled:!0,style:{wordBreak:"break-all"}}),Object(J.jsxs)("span",{style:{position:"relative"},children:[r?Object(J.jsxs)("button",{className:"p-link",onClick:function(e){return p(!d)},children:[Object(J.jsx)("span",{className:"layout-topbar-item-text",children:v?"":O}),Object(J.jsx)("span",{className:"layout-topbar-icon pi pi-user"})," ",v?"":O]}):null,Object(J.jsx)(_n.a,{model:_,ref:function(e){return f.current=e},id:"user_menu",style:{display:d?"block":"none"}})]})}return c?Object(J.jsx)(vt.a,{header:"Entrar - "+(Sn||"ScalarGIS"),visible:c,style:{width:g[0]<768?"90%":"35vw"},modal:!0,onHide:function(e){return s(!1)},children:Object(J.jsx)(wn,{})}):r?Object(J.jsxs)("button",{className:"p-link",onClick:function(e){return s(!0)},children:[Object(J.jsx)("span",{className:"layout-topbar-item-text",children:"Utilizador"}),Object(J.jsx)("span",{className:"layout-topbar-icon pi pi-unlock"})]}):null})),An=new ft.a,Cn=function(e){return e.match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)};var Tn=Object(q.b)((function(e){return{viewer:e.root.viewer}}))((function(e){var t,n,r=e.viewer,i=Object(H.useState)(!1),a=Object(X.a)(i,2),o=a[0],c=a[1],s=Object(H.useState)(""),l=Object(X.a)(s,2),u=l[0],d=l[1],p=Object(H.useState)(""),f=Object(X.a)(p,2),j=f[0],h=f[1],b=Object(H.useState)(""),m=Object(X.a)(b,2),g=m[0],v=m[1],O=Object(H.useState)(null),_=Object(X.a)(O,2),x=_[0],y=_[1],w=Object(H.useState)(!1),E=Object(X.a)(w,2),S=E[0],P=E[1],A=ye()[0]<=768,C=(Object(q.c)(),Object(H.useContext)(Ml).core);function T(e){if(e.preventDefault(),!(u&&j&&g))return y({type:"error",message:"Campos obrigat\xf3rios n\xe3o preenchidos"}),!1;if(!Cn(j))return y({type:"error",message:"Formato de email incorreto"}),!1;y(null);var t={name:u,email:j,description:g},n={headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify(t)},i=(new ft.a).get(C.COOKIE_AUTH_NAME);i&&(n.headers["X-API-KEY"]=i.token),P(!0);var a=C.API_URL+"/app/viewer/"+r.id+"/contact_message";fetch(a,n).then((function(e){return e.json()})).then((function(e){P(!1),e.success?y({type:"success",message:e.message}):y({type:"error",message:e.message})})).catch((function(e){P(!1),y({type:"error",message:"Ocorreu um erro."})}))}return An.get(C.COOKIE_AUTH_NAME),r&&r.show_contact?Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsxs)("button",{className:"p-link",onClick:function(e){return function(){var e,t;d(null!==r&&void 0!==r&&null!==(e=r.user_info)&&void 0!==e&&e.name?r.user_info.name:null),h(null!==r&&void 0!==r&&null!==(t=r.user_info)&&void 0!==t&&t.email?r.user_info.email:null),v(null),y(null),c(!0)}()},title:"Contacto",children:[Object(J.jsx)("span",{className:"layout-topbar-item-text",children:"Contacto"}),Object(J.jsx)("span",{className:"layout-topbar-icon far fa-envelope"})]}),Ke(Object(J.jsx)(vt.a,{header:"Formul\xe1rio de Contacto",visible:o,style:{width:A?"90%":"35vw"},modal:!0,onHide:function(e){return c(!1)},children:Object(J.jsxs)("form",{onSubmit:function(e){return T()},children:[Object(J.jsxs)("div",{className:"p-fluid",children:[Object(J.jsxs)("div",{className:"p-field",children:[Object(J.jsx)("label",{htmlFor:"contact_name",children:"Nome"}),Object(J.jsx)(jt.a,{id:"contact_name",className:u&&0!==u.length?"":"p-invalid",value:u,placeholder:"Nome",disabled:null===r||void 0===r||null===(t=r.user_info)||void 0===t?void 0:t.name,onChange:function(e){d(e.target.value),y(null)}}),(!u||0===u.length)&&Object(J.jsx)("small",{className:"p-invalid p-d-block",children:"Campo de preenchimento obrigat\xf3rio"})]}),Object(J.jsxs)("div",{className:"p-field",children:[Object(J.jsx)("label",{htmlFor:"contact_email",children:"Email"}),Object(J.jsx)(jt.a,{id:"contact_email",className:j&&0!==j.length?"":"p-invalid",value:j,placeholder:"Email",disabled:null===r||void 0===r||null===(n=r.user_info)||void 0===n?void 0:n.email,onChange:function(e){h(e.target.value),y(null)}}),(!j||0===j.length)&&Object(J.jsx)("small",{className:"p-invalid p-d-block",children:"Campo de preenchimento obrigat\xf3rio"})]}),Object(J.jsxs)("div",{className:"p-field",children:[Object(J.jsx)("label",{htmlFor:"contact_description",children:"Descri\xe7\xe3o"}),Object(J.jsx)(ht.a,{rows:3,id:"contact_description",className:g&&0!==g.length?"":"p-invalid",value:g,placeholder:"Descri\xe7\xe3o",onChange:function(e){v(e.target.value),y(null)}}),(!g||0===g.length)&&Object(J.jsx)("small",{className:"p-invalid p-d-block",children:"Campo de preenchimento obrigat\xf3rio"})]})]}),r.contact_info&&Object(J.jsx)("div",{dangerouslySetInnerHTML:{__html:r.contact_info}}),Object(J.jsx)("div",{className:"p-mb-2",children:x&&x.type&&Object(J.jsx)(mt.a,{style:{width:"100%"},severity:x.type,text:x.message})}),Object(J.jsx)("div",{className:"p-dialog-myfooter",children:Object(J.jsx)(bt.a,{color:"green",icon:S?"pi pi-spin pi-spinner":"pi pi-check",label:"Enviar",onClick:T,disabled:S})})]})}))]}):null}));var Rn=Object(q.b)((function(e){return{viewer:e.root.viewer}}))((function(e){var t=e.viewer,n=(Object(H.useContext)(Ml).core,ye());return n[0],n[0],t&&t.config_json&&t.config_json.help_url?Object(J.jsx)("button",{className:"p-link",title:"Ajuda",onClick:function(e){},children:Object(J.jsxs)("a",{href:t.config_json.help_url,target:"_blank",style:{color:"#ffffff"},children:[Object(J.jsx)("span",{className:"layout-topbar-item-text",children:"Ajuda"}),Object(J.jsx)("span",{className:"layout-topbar-icon pi pi-question-circle"})]})}):null})),Nn=n(201),kn=n(118),In=Object(J.jsx)(bt.a,{type:"button",icon:"pi pi-refresh",className:"p-button-text"}),Mn=Object(J.jsx)(bt.a,{type:"button",icon:"pi pi-cloud",className:"p-button-text"});function Ln(e){var t=e.open,n=e.as,r=e.onOpen,i=e.onClose,a=e.data,o=e.fields;return"button"===n?Object(J.jsx)(bt.a,{icon:"pi pi-table",title:"Tabela de atributos",color:"blue",className:"p-button-sm p-button-rounded p-button-text tool",onClick:function(e){return r(!0)}}):Object(J.jsx)(z.a.Fragment,{children:Object(J.jsx)(vt.a,{header:"Tabela de Attributos",visible:t,style:{width:"50vw"},modal:!0,onHide:function(e){return i(!1)},children:Object(J.jsx)(Nn.a,{value:a,paginator:!0,rows:4,paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown",currentPageReportTemplate:"A mostrar de {first} at\xe9 {last} de um total de {totalRecords}",rowsPerPageOptions:[2,4],paginatorLeft:In,paginatorRight:Mn,className:"p-datatable-striped",children:o.map((function(e){return Object(J.jsx)(kn.a,{field:e.name,header:e.label,sortable:"url"!==e.type,filter:"url"!==e.type,filterPlaceholder:"Procurar por "+e.label.toLowerCase(),body:function(t){return"url"===e.type?Object(J.jsx)("div",{children:Object(J.jsx)("a",{href:t[e.name],title:t[e.name],target:"_blank",rel:"noopener noreferrer",children:Object(J.jsx)("i",{className:"pi pi-external-link"})})}):t[e.name]}},e.name)}))})})})}var Fn=n(75),Un=n(363);n(664);function Gn(e){var t=e.core,n=(e.viewer,e.mainMap,e.layer),r=e.selected,i=e.setSelected,a=t.CLIENT_URL,o=n.title||"",c=n.description||"",s=a+(n.thumbnail||"assets/images/basemaps/TERRAIN.jpg"),l=Object(J.jsx)("img",{alt:"Card",src:s,className:r?"":"disabled",title:r?"Clicar para desligar":"Clicar para ligar",onClick:function(){return i(r?null:n.id)}}),u="p-mr-2 p-mb-1 basemaps-control-item"+(r?" active":"");return Object(J.jsx)("div",{className:u,children:Object(J.jsx)(Un.a,{className:"p-text-center",title:o,subTitle:c,header:l})})}function Dn(e){var t=e.core,n=e.viewer,r=e.mainMap,i=e.config,a=e.actions,o=e.record,c=e.layers,s=e.selectedLayer,l=i.dispatch,u=Object(H.useState)(o.config_json&&o.config_json.auto_close),d=Object(X.a)(u,2),p=d[0],f=(d[1],Object(H.useState)(!1)),j=Object(X.a)(f,2),h=j[0],b=j[1],m=c.map((function(e){return e.id}));function g(e){var t=n.config_json.checked.filter((function(e){return!m.includes(e)}));e&&t.push(e),e&&p&&b(!1),l(a.layers_set_checked(t))}return"mainmenu"===o.target?Object(J.jsx)("div",{className:"basemaps-menu",children:c.map((function(e,i){return Object(J.jsx)(Gn,{viewer:n,mainMap:r,layer:e,selected:s&&s===e.id,setSelected:g,core:t},e.id)}))}):Object(J.jsxs)("div",{className:"basemaps map-controls",children:[Object(J.jsx)(bt.a,{icon:"pi pi-image",className:h?"p-button-rounded p-button-raised active":"p-button-rounded p-button-raised",onClick:function(e){e.currentTarget.blur(),b(!h)}}),h&&Object(J.jsx)("div",{className:"basemaps-control",children:Object(J.jsx)("div",{className:"p-d-inline-flex p-flex-row p-flex-wrap",children:c.map((function(e,i){return Object(J.jsx)(Gn,{viewer:n,mainMap:r,layer:e,selected:s&&s===e.id,setSelected:g,core:t},e.id)}))})})]})}function Vn(e){var t=e.className,n=e.config,r=e.actions,i=e.record;return i&&"mainmenu"===i.target?Object(J.jsx)(bt.a,{title:"Mapas de Base",className:t,icon:"pi pi-image",style:{margin:"0.5em 1em"},onClick:function(e){return n.dispatch(r.viewer_set_selectedmenu(i.id))}}):null}function Wn(e){var t=e.as,n=e.core,r=e.config,i=e.actions,a=e.record,o=(e.utils,r.viewer),c=r.mainMap,s=[],l=null;if(o&&o.config_json&&o.config_json.layers){var u=o.config_json.layers.filter((function(e){return"basemaps"===e.id}));u&&u[0]&&u[0].children&&o.config_json.layers.forEach((function(e){u[0].children.includes(e.id)&&s.push(e)}))}for(var d=0,p=s;d<p.length;d++){var f=p[d];if(o.config_json.checked.includes(f.id)){l=f.id;break}}function j(){return Object(J.jsx)("div",{title:"Mapas de Base",children:Object(J.jsx)(Dn,{core:n,config:r,actions:i,viewer:o,mainMap:c,record:a,layers:s,selectedLayer:l})})}return"panel"===t?Object(J.jsx)(Fn.a,{header:"Mapas de Base",children:j()}):j()}var Hn=n(169),zn=n(796),Kn=n(797);n(665);function Bn(e){var t=e.viewer,n=e.config,r=n.contact_info||t.contact_info;return!0!==(null===n||void 0===n?void 0:n.hideContactInfo)&&r?r&&Object(J.jsx)("div",{dangerouslySetInnerHTML:{__html:r}}):null}new ft.a;var Yn=function(e){return e.match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)},qn=function(e){var t=new FileReader;return new Promise((function(n,r){t.onerror=function(){t.abort(),r(new DOMException("Problem parsing input file."))},t.onload=function(){var r={filename:e.name,type:e.type,size:e.size,data:t.result};n(r)},t.readAsDataURL(e)}))},Xn=function(){var e=Object(_t.a)(Object(Ot.a)().mark((function e(t){var n;return Object(Ot.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,qn(t);case 3:return n=e.sent,e.abrupt("return",n);case 7:return e.prev=7,e.t0=e.catch(0),console.warn(e.t0.message),e.abrupt("return",null);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}();function Jn(e){var t,n,r,i,a,o=e.core,c=e.viewer,s=e.config,l=(e.Utils,s.upload||{}),u=!(null!==c&&void 0!==c&&null!==(t=c.user_info)&&void 0!==t&&t.name||!c.captcha_key),d=Object(H.useState)(null!==c&&void 0!==c&&null!==(n=c.user_info)&&void 0!==n&&n.name?c.user_info.name:null),p=Object(X.a)(d,2),f=p[0],j=p[1],h=Object(H.useState)(null!==c&&void 0!==c&&null!==(r=c.user_info)&&void 0!==r&&r.email?c.user_info.email:null),b=Object(X.a)(h,2),m=b[0],g=b[1],v=Object(H.useState)(null),O=Object(X.a)(v,2),_=O[0],x=O[1],y=Object(H.useState)([]),w=Object(X.a)(y,2),E=w[0],S=w[1],P=Object(H.useState)(null),A=Object(X.a)(P,2),C=A[0],T=A[1],R=Object(H.useState)(null),N=Object(X.a)(R,2),k=N[0],I=N[1],M=Object(H.useState)(!u),L=Object(X.a)(M,2),F=L[0],U=L[1],G=Object(H.useState)(!1),D=Object(X.a)(G,2),V=D[0],W=D[1],K=Object(H.useState)(!1),B=Object(X.a)(K,2),Y=B[0],q=B[1],Z=Object(H.useState)(!1),$=Object(X.a)(Z,2),Q=$[0],ee=$[1],te=Object(H.useRef)(null);function ne(e){e.preventDefault();var t=te.current&&te.current.files?te.current.files.filter((function(e){return te.current.isFileSelected(e)})).map((function(e){return e.name})):[];if(!(f&&m&&C))return I({type:"error",message:"Campos obrigat\xf3rios n\xe3o preenchidos"}),!1;if(!Yn(m))return I({type:"error",message:"Formato de email incorreto"}),!1;if(null!=(null===l||void 0===l?void 0:l.minFiles)&&l.minFiles>t.length)return I({type:"error",message:"Tem de anexar pelo menos ".concat(l.minFiles," ficheiro(s).")}),!1;if(null!=(null===l||void 0===l?void 0:l.maxFiles)&&(null===l||void 0===l?void 0:l.maxFiles)<t.length)return I({type:"error",message:"Apenas pode anexar at\xe9 ".concat(l.maxFiles," ficheiro(s).")}),!1;I(null);var n={name:f,email:m,description:C};E&&E.length&&(n.files=E.filter((function(e){return t.includes(e.filename)}))),u&&(n.captcha=_);var r={headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify(n)},i=(new ft.a).get(o.COOKIE_AUTH_NAME);i&&(r.headers["X-API-KEY"]=i.token),q(!0);var a=o.API_URL+"/app/viewer/"+c.id+"/contact_message";fetch(a,r).then((function(e){return e.json()})).then((function(e){q(!1),e.success?(I({type:"success",message:e.message}),ee(!0)):(I({type:"error",message:e.message}),ee(!1))})).catch((function(e){q(!1),I({type:"error",message:"Ocorreu um erro."}),ee(!1)}))}return Q?Object(J.jsxs)("div",{className:"p-fluid",children:[Object(J.jsxs)("div",{className:"p-field",children:[Object(J.jsx)("label",{htmlFor:"contact_name",children:"Nome"}),Object(J.jsx)(jt.a,{id:"contact_name",value:f,placeholder:"Nome",disabled:!0})]}),Object(J.jsxs)("div",{className:"p-field",children:[Object(J.jsx)("label",{htmlFor:"contact_email",children:"Email"}),Object(J.jsx)(jt.a,{id:"contact_email",value:m,placeholder:"Email",disabled:!0})]}),Object(J.jsxs)("div",{className:"p-field",children:[Object(J.jsx)("label",{htmlFor:"contact_description",children:"Descri\xe7\xe3o"}),Object(J.jsx)(ht.a,{rows:3,id:"contact_description",value:C,placeholder:"Descri\xe7\xe3o",disabled:!0})]}),Object(J.jsx)("div",{className:"p-field",children:Object(J.jsx)("div",{className:"p-mb-2",children:k&&k.type&&Object(J.jsx)(mt.a,{style:{width:"100%"},severity:k.type,text:k.message})})})]}):Object(J.jsx)(z.a.Fragment,{children:Object(J.jsxs)("form",{onSubmit:function(e){return ne()},children:[Object(J.jsxs)("div",{className:"p-fluid",children:[Object(J.jsxs)("div",{className:"p-field",children:[Object(J.jsx)("label",{htmlFor:"contact_name",children:"Nome"}),Object(J.jsx)(jt.a,{id:"contact_name",className:f&&0!==f.length?"":"p-invalid",value:f,placeholder:"Nome",disabled:null===c||void 0===c||null===(i=c.user_info)||void 0===i?void 0:i.name,onChange:function(e){j(e.target.value),I(null)}}),(!f||0===f.length)&&Object(J.jsx)("small",{className:"p-invalid p-d-block",children:s.requiredFieldMessage||"Campo de preenchimento obrigat\xf3rio"})]}),Object(J.jsxs)("div",{className:"p-field",children:[Object(J.jsx)("label",{htmlFor:"contact_email",children:"Email"}),Object(J.jsx)(jt.a,{id:"contact_email",className:m&&0!==m.length?"":"p-invalid",value:m,placeholder:"Email",disabled:null===c||void 0===c||null===(a=c.user_info)||void 0===a?void 0:a.email,onChange:function(e){g(e.target.value),I(null)}}),(!m||0===m.length)&&Object(J.jsx)("small",{className:"p-invalid p-d-block",children:s.requiredFieldMessage||"Campo de preenchimento obrigat\xf3rio"})]}),Object(J.jsxs)("div",{className:"p-field",children:[Object(J.jsx)("label",{htmlFor:"contact_description",children:"Descri\xe7\xe3o"}),Object(J.jsx)(ht.a,{rows:3,id:"contact_description",className:C&&0!==C.length?"":"p-invalid",value:C,placeholder:"Descri\xe7\xe3o",onChange:function(e){T(e.target.value),I(null)}}),(!C||0===C.length)&&Object(J.jsx)("small",{className:"p-invalid p-d-block",children:s.requiredFieldMessage||"Campo de preenchimento obrigat\xf3rio"})]}),l.enabled&&Object(J.jsxs)("div",{className:"p-field",children:[Object(J.jsx)("label",{htmlFor:"contact_description",children:"Anexos"}),Object(J.jsx)(Hn.a,{ref:te,name:"files[]",uploadOptions:{style:{display:"none"}},className:"contact-form-upload-file",chooseLabel:l.chooseLabel||"Selecionar",cancelLabel:l.cancelLabel||"Limpar",itemTemplate:function(e,t){return Object(J.jsxs)("div",{className:"p-d-flex p-ai-center p-flex-wrap",children:[Object(J.jsx)("div",{className:"p-d-flex p-ai-center",style:{width:"70%"},children:Object(J.jsx)("span",{className:"p-d-flex p-dir-col p-text-left p-ml-0 p-mr-1",style:{wordBreak:"break-all"},children:e.name})}),Object(J.jsx)(zn.a,{value:t.formatSize,className:"p-px-1 p-py-1"}),Object(J.jsx)(bt.a,{type:"button",icon:"pi pi-times",className:"p-button-outlined p-button-rounded p-button-danger p-ml-auto",onClick:function(){(0,t.onRemove)()}})]})},onSelect:function(e){var t=Array.from(e.files).filter((function(e){return te.current.isFileSelected(e)})).map((function(e){return e})),n=Array.from(t).map((function(e){return Xn(e)}));n&&n.length&&W(!0),Promise.all(n).then((function(e){S([].concat(Object(ae.a)(E),Object(ae.a)(e))),W(!1),I(null)}))},onRemove:function(e){if(E&&E.length){var t=E.filter((function(t){return t.filename!==e.file.name}));S(t),I(null)}},onClear:function(){S([]),I(null)},multiple:!0,disabled:V,accept:l.accept||"image/*, application/pdf",maxFileSize:l.maxFileSize||1e6,invalidFileSizeMessageSummary:"{0}",invalidFileSizeMessageDetail:l.invalidFileSizeMessageDetail||"Ficheiro com dimens\xe3o superior ao permitido ({0}).",emptyTemplate:Object(J.jsx)("p",{className:"m-0",children:l.emptyMessage||"Arraste para aqui o ficheiros a enviar."})}),l.maxFileSize&&Object(J.jsxs)("small",{className:"p-invalid p-d-block",children:["Tamanho m\xe1ximo do ficheiro: ",(l.maxFileSize/1048576).toFixed(2)," MB"]})]}),u?Object(J.jsx)("div",{className:"p-field",children:Object(J.jsx)(Kn.a,{siteKey:c.captcha_key,language:"pt",onResponse:function(e){x(e.response),e.response&&U(!0)},onExpire:function(){x(null),U(!1)}})}):null]}),Object(J.jsx)(Bn,{viewer:c,config:s}),Object(J.jsx)("div",{className:"p-mb-2",children:k&&k.type&&Object(J.jsx)(mt.a,{style:{width:"100%"},severity:k.type,text:k.message})}),Object(J.jsx)("div",{className:"p-dialog-myfooter",children:Object(J.jsx)(bt.a,{className:"p-button-secondary",icon:Y?"pi pi-spin pi-spinner":"pi pi-check",label:"Enviar",onClick:ne,disabled:!F||Y})})]})})}function Zn(e){var t=e.className,n=e.core,r=e.config,i=e.actions,a=e.record,o=r.viewer,c=r.dispatch,s=r.Models,l=s.Utils,u=l.getWindowSize,d=l.showOnPortal,p=Object(H.useState)(!1),f=Object(X.a)(p,2),j=f[0],h=f[1],b=a.config_json||{},m=a.title||"",g=b.header||m||"Formul\xe1rio de Contacto",v=u()[0]<=768;if("popup"===a.as){var O=b.closeLabel||"Fechar";return Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsx)(bt.a,{title:m,className:t,icon:"far fa-question-circle",style:{margin:"0.5em 1em"},onClick:function(e){return h(!0)}}),d(Object(J.jsx)(vt.a,{header:g,visible:j,style:{width:v?"90%":"45vw"},modal:!0,footer:Object(J.jsx)("div",{className:"p-grid",children:Object(J.jsx)("div",{className:"p-col",style:{textAlign:"right"},children:Object(J.jsx)(bt.a,{label:O,onClick:function(e){return h(!1)}})})}),onHide:function(e){return h(!1)},children:!0!==b.hideForm?Object(J.jsx)(Jn,{core:n,viewer:o,dispatch:c,config:b,Utils:s.Utils}):Object(J.jsx)(Bn,{core:n,viewer:o,dispatch:c,config:b,Utils:s.Utils})}))]})}return Object(J.jsx)(bt.a,{title:m,className:t,icon:"far fa-question-circle",style:{margin:"0.5em 1em"},onClick:function(e){return r.dispatch(i.viewer_set_selectedmenu(a.id))}})}function $n(e){e.region;var t=e.as,n=e.core,r=e.config,i=(e.actions,e.record),a=r.viewer,o=r.dispatch,c=r.Models,s=c.Utils,l=s.getWindowSize,u=s.showOnPortal,d=Object(H.useState)(!1),p=Object(X.a)(d,2),f=p[0],j=p[1],h=i.config_json||{},b=i.title||"",m=h.header||b||"Formul\xe1rio de Contacto",g=l()[0]<=768,v=h.closeLabel||"Fechar";return"panel"===t?Object(J.jsx)(Fn.a,{header:m,children:!0!==h.hideForm?Object(J.jsx)(Jn,{core:n,viewer:a,dispatch:o,config:h,Utils:c.Utils}):Object(J.jsx)(Bn,{core:n,viewer:a,dispatch:o,config:h,Utils:c.Utils})}):Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsxs)("button",{className:"p-link",onClick:function(e){return j(!0)},title:"Contacto",children:[Object(J.jsx)("span",{className:"layout-topbar-item-text"}),Object(J.jsx)("span",{className:"layout-topbar-icon far fa-envelope"})]}),u(Object(J.jsx)(vt.a,{header:m,visible:f,style:{width:g?"90%":"45vw"},modal:!0,footer:Object(J.jsx)("div",{className:"p-grid",children:Object(J.jsx)("div",{className:"p-col",style:{textAlign:"right"},children:Object(J.jsx)(bt.a,{label:v,onClick:function(e){return j(!1)}})})}),onHide:function(e){return j(!1)},children:!0!==h.hideForm?Object(J.jsx)(Jn,{core:n,viewer:a,dispatch:o,config:h,Utils:c.Utils}):Object(J.jsx)(Bn,{core:n,viewer:a,dispatch:o,config:h,Utils:c.Utils})}))]})}var Qn=n(798),er=n(150),tr=n(799),nr=n(42),rr=n(448),ir=n(225),ar=n(276),or=n(51),cr=n(57),sr=n(249);n(668);function lr(e){var t=e.core,n=e.config,r=e.actions,i=e.dispatch,a=e.record,o=n.viewer,c=n.mainMap,s=n.Models.MapModel.getProjectionSrid,l=o.coordinates,u=Object(H.useState)([]),d=Object(X.a)(u,2),p=d[0],f=d[1],j=Object(H.useState)(null),h=Object(X.a)(j,2),b=h[0],m=h[1],g=Object(H.useState)(null),v=Object(X.a)(g,2),O=v[0],_=v[1],x=Object(H.useState)(null),y=Object(X.a)(x,2),w=y[0],E=y[1],S=Object(H.useState)("m"),P=Object(X.a)(S,2),A=P[0],C=P[1],T=Object(H.useState)(!1),R=Object(X.a)(T,2),N=R[0],k=R[1],I=Object(H.useState)("N"),M=Object(X.a)(I,2),L=M[0],F=M[1],U=Object(H.useState)("W"),G=Object(X.a)(U,2),D=G[0],V=G[1],W=Object(H.useState)(null),K=Object(X.a)(W,2),B=K[0],Y=K[1],q=Object(H.useState)(null),Z=Object(X.a)(q,2),$=Z[0],Q=Z[1],ee=Object(H.useState)(null),te=Object(X.a)(ee,2),ne=te[0],re=te[1],ie=function(e){return[{label:"CSV",icon:"pi pi-align-justify",data:e,command:function(e){fe(e.item.data,"csv")}},{label:"GeoJSON",icon:"pi pi-globe",data:e,command:function(e){fe(e.item.data,"geojson")}}]},oe=function(e){var t=[],n=a?a.config_json:null,r=null;r=n&&n.export_crs?n.export_crs:o.config_json&&o.config_json.export_crs?o.config_json.export_crs:o.config_json&&o.config_json.display_crs?o.config_json.display_crs:4326;var i=new le.a,s={dataProjection:"EPSG:"+r,featureProjection:c.getView().getProjection().getCode()};e.forEach((function(e){var n=new or.a({geometry:new cr.a(e.coordinates)});Object.entries(e.results).map((function(e){var t=Object(X.a)(e,2),r=t[0],i=t[1],a=!0;p&&p.length&&(p.find((function(e){return e.value==r}))||(a=!1));if(a){var o=(r||"").replace(":","");n.set(o+"_x",i.coordinates[0]),n.set(o+"_y",i.coordinates[1])}})),t.push(n)}));var l=i.writeFeaturesObject(t,s),u={type:"name",properties:{name:"urn:ogc:def:crs:EPSG::"+r}};return l.crs=u,JSON.stringify(l)},ce=function(e){if(null==e||!e.length)return null;var t=[],n="",r=[];Object.entries(e[0].results).map((function(e){var n=Object(X.a)(e,2),i=n[0],a=(n[1],!0);p&&p.length&&(p.find((function(e){return e.value==i}))||(a=!1));if(a){t.push(i);var o=(i||"").replace(":","");r.push((o+"_x").replace(":","")),r.push((o+"_y").replace(":",""))}})),n=r.join(";"),n+="\n";var i=[];return e.forEach((function(e){var n=[];t.forEach((function(t){var r=!0;p&&p.length&&(p.find((function(e){return e.value==t}))||(r=!1));r&&(n.push(e.results[t].coordinates[0]),n.push(e.results[t].coordinates[1]))})),i.push(n.join(";"))})),n+=i.join("\n")};function se(e){var t=null,n=e.replace("\xba","").replace("''","").replace("'","").split(" ");return n[1]=parseInt(n[1]),n[2]=parseInt(n[2]),n[3]=parseFloat(n[3]),t=n[1]+n[2]/60+n[3]/3600,"W"!=n[0]&&"O"!=n[0]&&"S"!=n[0]||(t*=-1),t}function ue(e,t){var n=Math.floor(Math.abs(e)),r=60*(Math.abs(e)-n),i=Math.floor(r),a=60*(r-i),o=parseFloat(Math.round(100*a)/100).toFixed(2);return t?("000"+Math.abs(n)).slice(-3)+"\xba "+("00"+i).slice(-2)+"' "+("0000"+o).slice(-5)+"''":("00"+Math.abs(n)).slice(-2)+"\xba "+("00"+i).slice(-2)+"' "+("0000"+o).slice(-5)+"''"}function de(e,t,n){var r=document.createElement("a");r.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),r.setAttribute("download",e+"."+n),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r)}function pe(e){if(e&&e.coordinates){var t=Object(Wt.u)(e.coordinates,e.crs||c.getView().getProjection(),c.getView().getProjection()),n=[t[0]-500,t[1]-500,t[0]+500,t[1]+500];s(c.getView().getProjection());i(r.map_set_extent(t,n))}}function fe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"geojson",n="";if("csv"===t)n=ce([e],t);else n=oe([e],t);de("coordenadas",n,t)}function je(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"geojson",t="";switch(e){case"csv":t=ce(l,e);break;case"geojson":t=oe(l,e);break;default:t=oe(l,"geojson")}de("coordenadas",t,e)}function he(e){return e?Object(J.jsxs)("div",{className:"p-col-12 coordinates-item",children:[Object(J.jsxs)("div",{className:"coordinates-item-tools p-text-right",children:[Object(J.jsx)(bt.a,{title:"Aproximar ao elemento",icon:"pi pi-search",onClick:function(t){return pe(e)}}),Object(J.jsx)(tr.a,{label:"",icon:"pi pi-download",model:ie(e)}),Object(J.jsx)(bt.a,{title:"Remover elemento",icon:"pi pi-times",onClick:function(t){return function(e){var t=l.findIndex((function(t){return t.id===e.id}));if(-1!==t){var n=Object(ae.a)(l);n.splice(t,1),i(r.viewer_set_coordinates(n))}}(e)}})]}),Object(J.jsx)("table",{children:Object.entries(e.results).map((function(e){var t=Object(X.a)(e,2),n=t[0],r=t[1],i=!0;p&&p.length&&(p.find((function(e){return e.value==n}))||(i=!1));if(i){var a="m",o=Wt.l(r.code);return o&&(a=o.getUnits()),Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsx)("tr",{children:Object(J.jsxs)("td",{colspan:"2",className:"coordinates-item-title",children:[r.title," (",r.code,")"]})}),Object(J.jsxs)("tr",{children:[Object(J.jsxs)("td",{children:["degrees"===a?"lon (dd): ":a?"x ("+a+"): ":"x: ",Object(J.jsx)("span",{children:Math.round(r.coordinates[0]*r.precision)/r.precision})]}),Object(J.jsxs)("td",{children:["degrees"===a?"lat (dd): ":a?"y ("+a+"): ":"y: ",Object(J.jsx)("span",{children:Math.round(r.coordinates[1]*r.precision)/r.precision})]})]}),"degrees"===a&&Object(J.jsxs)("tr",{children:[Object(J.jsxs)("td",{children:["lon: ",Object(J.jsxs)("span",{children:[ue(r.coordinates[0],!0),"  ",r.coordinates[0]<0?"W":"E"]})]}),Object(J.jsxs)("td",{children:["lat: ",Object(J.jsxs)("span",{children:[ue(r.coordinates[1],!1),"  ",r.coordinates[1]<0?"S":"N"]})]})]})]})}return null}))})]}):null}return Object(H.useEffect)((function(){var e=o.config_json.crs_list.map((function(e){return{label:e.title+" ("+e.code+")",value:e.code}}));a&&a.config_json&&a.config_json.crs_list&&a.config_json.crs_list.length&&(e=(o.config_json.crs_list||[]).filter((function(e){return a.config_json.crs_list.includes(e.srid)})).map((function(e){return{label:e.title+" ("+e.code+")",value:e.code}}))),f(e)}),[]),Object(H.useEffect)((function(){ne&&i(r.viewer_set_coordinates([ne].concat(Object(ae.a)(l))))}),[ne]),Object(H.useEffect)((function(){var e=!1;if(b){var t=Wt.l(b);if(t)"degrees"===t.getUnits()&&(e=!0)}e&&(_(null),E(null),Q(null),Y(null)),k(e),C(e?"dd":"m")}),[b]),Object(H.useEffect)((function(){if(N)if("dd"===A&&B&&$){var e=se(D+" "+B),t=se(L+" "+$);_(e),E(t)}else if("dms"===A&&O&&w){var n=ue(Math.abs(O),!0),r=ue(Math.abs(w),!1);Y(n),V(O<0?"W":"E"),Q(r),F(w<0?"S":"N")}}),[A]),Object(H.useEffect)((function(){l&&l.length>0&&i(r.viewer_set_selectedmenu("coordinates"))}),[l]),Object(J.jsxs)("div",{children:[l&&l.length?null:Object(J.jsx)("div",{className:"p-mt-2 p-mb-3",children:Object(J.jsx)(mt.a,{severity:"info",text:"Clique no mapa para obter as coordenadas ou indique os seus valores atrav\xe9s seguinte formul\xe1rio."})}),N&&Object(J.jsx)(z.a.Fragment,{children:Object(J.jsxs)("div",{className:"p-fluid p-formgrid p-grid p-mt-2",children:[Object(J.jsxs)("div",{className:"p-field p-col-12",children:[Object(J.jsx)("label",{htmlFor:"coordsys",children:"Sistema de Coordenadas"}),Object(J.jsx)(nr.a,{options:p,value:b,onChange:function(e){return m(e.value)},placeholder:"Selecione um CRS"})]}),Object(J.jsx)("div",{className:"p-field p-col-12",children:Object(J.jsxs)("div",{className:"p-formgroup-inline flex-no-wrap",children:[Object(J.jsxs)("div",{className:"p-field-checkbox",children:[Object(J.jsx)(ar.a,{value:"dd",onChange:function(e){return C(e.value)},checked:"dd"===A}),Object(J.jsx)("label",{children:"Graus decimais"})]}),Object(J.jsxs)("div",{className:"p-field-checkbox",children:[Object(J.jsx)(ar.a,{value:"dms",onChange:function(e){return C(e.value)},checked:"dms"===A}),Object(J.jsx)("label",{children:"Graus / Minutos / Segundos"})]})]})}),Object(J.jsxs)("div",{className:"p-field p-col-12",children:["dd"===A&&Object(J.jsxs)("div",{className:"p-fluid p-formgrid p-grid",children:[Object(J.jsxs)("div",{className:"p-field p-col",children:[Object(J.jsx)("label",{children:"Longitude"}),Object(J.jsx)(ir.a,{value:O,onValueChange:function(e){return _(e.value)},mode:"decimal",minFractionDigits:1,maxFractionDigits:8,className:"p-inputtext-sm"})]}),Object(J.jsxs)("div",{className:"p-field p-col",children:[Object(J.jsx)("label",{children:"Latitude"}),Object(J.jsx)(ir.a,{value:w,onValueChange:function(e){return E(e.value)},mode:"decimal",minFractionDigits:1,maxFractionDigits:8,className:"p-inputtext-sm"})]})]}),"dms"===A&&Object(J.jsxs)("div",{className:"p-fluid p-formgrid p-grid",children:[Object(J.jsxs)("div",{className:"p-field p-col",children:[Object(J.jsx)("label",{children:"Longitude"}),Object(J.jsxs)("div",{className:"p-inputgroup",children:[Object(J.jsxs)("select",{value:D,onChange:function(e){return V(e.target.value)},children:[Object(J.jsx)("option",{value:"E",children:"E"}),Object(J.jsx)("option",{value:"W",children:"W"})]}),Object(J.jsx)(rr.a,{mask:"999\xba 99' 99?.99''",value:B,onChange:function(e){return Y(e.value)}})]})]}),Object(J.jsxs)("div",{className:"p-field p-col",children:[Object(J.jsx)("label",{children:"Latitude"}),Object(J.jsxs)("div",{className:"p-inputgroup",children:[Object(J.jsxs)("select",{value:L,onChange:function(e){return F(e.target.value)},children:[Object(J.jsx)("option",{value:"N",children:"N"}),Object(J.jsx)("option",{value:"S",children:"S"})]}),Object(J.jsx)(rr.a,{mask:"99\xba 99' 99?.99''",value:$,onChange:function(e){return Q(e.value)}})]})]})]})]})]})}),!N&&Object(J.jsx)(z.a.Fragment,{children:Object(J.jsxs)("div",{className:"p-fluid p-formgrid p-grid p-mt-2",children:[Object(J.jsxs)("div",{className:"p-field p-col-12",children:[Object(J.jsx)("label",{htmlFor:"coordsys",children:"Sistema de Coordenadas"}),Object(J.jsx)(nr.a,{options:p,value:b,onChange:function(e){return m(e.value)},placeholder:"Selecione um CRS"})]}),Object(J.jsxs)("div",{className:"p-field p-col",children:[Object(J.jsx)("label",{htmlFor:"coordX",children:"X"}),Object(J.jsx)(ir.a,{id:"coordX",value:O,onValueChange:function(e){return _(e.value)},mode:"decimal",minFractionDigits:1,maxFractionDigits:8,className:"p-inputtext-sm"})]}),Object(J.jsxs)("div",{className:"p-field p-col",children:[Object(J.jsx)("label",{htmlFor:"coordY",children:"Y"}),Object(J.jsx)(ir.a,{id:"coordY",value:w,onValueChange:function(e){return E(e.value)},mode:"decimal",minFractionDigits:1,maxFractionDigits:8,className:"p-inputtext-sm"})]})]})}),Object(J.jsx)("div",{className:"card p-text-center",children:Object(J.jsx)(bt.a,{label:"Localizar",icon:"pi pi-pi-search",className:"p-button-md",onClick:function(e){!function(){var e,n;if("dms"===A){if(!B||!$)return;e=se(D+" "+B),n=se(L+" "+$),_(e),E(n)}else e=O,n=w;if(b&&null!=e||null!=e){var r=t.API_URL+"/app/utils/transcoord",i={headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify({x:e,y:n,srid:s(b)})};fetch(r,i).then((function(e){return e.json()})).then((function(e){if(e.results){var t={};o.config_json.crs_list.forEach((function(n){var r=[];e.results[n.code]&&(r=[e.results[n.code].x,e.results[n.code].y],t[n.code]={code:n.code,title:n.title,description:n.description,srid:n.srid,precision:n.precision,coordinates:r})}));var n=t[c.getView().getProjection().getCode()].coordinates,r={id:Object(sr.v4)(),coordinates:n,crs:c.getView().getProjection().getCode(),results:t};re(r),pe(r)}})).catch((function(e){console.log("error",e)}))}}()}})}),l&&l.length&&l.length>0?Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsx)("hr",{className:"rounded"}),Object(J.jsxs)("div",{style:{padding:"1rem 0",textAlign:"right"},children:[Object(J.jsx)(bt.a,{title:"Limpar resultados",label:"Limpar",icon:"pi pi-times",className:"p-button-outlined p-button-sm",onClick:function(e){i(r.viewer_set_coordinates([]))}}),Object(J.jsx)(bt.a,{title:"Exportar resultados",label:"CSV",icon:"pi pi-download",className:"p-button-outlined p-button-sm p-ml-2",onClick:function(e){return je("csv")}}),Object(J.jsx)(bt.a,{title:"Exportar resultados",label:"GeoJSON",icon:"pi pi-download",className:"p-button-outlined p-button-sm p-ml-2",onClick:function(e){return je("geojson")}})]}),he(l[0])]}):null,l.length>1?Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsx)("h4",{children:"Resultados anteriores"}),Object(J.jsx)(Qn.a,{value:l.slice(1),layout:"list",itemTemplate:function(e,t){return"list"===t?e&&he(e):"grid"===t?null:void 0},paginator:!0,alwaysShowPaginator:!1,pageLinkSize:2,rows:9,style:{fontSize:".8rem"}})]}):null]})}function ur(e){var t=e.className,n=e.config,r=e.actions,i=e.record,a=(i.config_json,i.title||"Pesquisa por Coordenadas");return Object(J.jsx)(bt.a,{title:a,className:t,icon:"fas fa-bullseye",style:{margin:"0.5em 1em"},onClick:function(e){return n.dispatch(r.viewer_set_selectedmenu(i.id))}})}function dr(e){var t=e.as,n=e.core,r=e.config,i=e.actions,a=e.record,o=r.viewer,c=r.dispatch,s=r.Models.Utils,l=s.getWindowSize,u=(s.showOnPortal,o.config_json.selected_menu),d=a.config_json||{},p=a.title||"Pesquisa por Coordenadas",f=d.header||p,j=l()[0]<=768;return Object(H.useEffect)((function(){"coordinates"===u&&c(i.viewer_set_exclusive_mapcontrol("Coordinates"))}),[u]),Object(H.useEffect)((function(){"coordinates"===u&&(j||!0!==d.expand_menu||c(i.layout_show_menu(!0)),j&&!0===d.expand_menu_mobile&&c(i.layout_show_menu(!1)))}),[o.coordinates]),"panel"===t?Object(J.jsx)(Fn.a,{header:f,children:Object(J.jsx)("div",{className:"coordinates",children:Object(J.jsx)(lr,{core:n,config:r,actions:i,dispatch:c,record:a})})}):null}var pr=n(421),fr=n(53);n(1096);function jr(e,t,n){if(!e)return!1;var r=Object(Wt.u)(e,t,"EPSG:4326");return!1===Object(Kt.f)(function(e){return e?e.split(" ").map((function(e){return Number(e)})):[0,0,1,1]}(n),r)}function hr(e){var t=e.config,n=e.actions,r=e.record,i=t.viewer,a=t.mainMap,o=t.dispatch,c=i.config_json,s=c.display_crs,l=c.center,u=n.viewer_set_displaycrs,d=Object(H.useState)(i.config_json.crs_list||[]),p=Object(X.a)(d,2),f=p[0],j=p[1],h=Object(H.useRef)();if(Object(H.useEffect)((function(){if(r&&r.config_json&&r.config_json.crs_list&&r.config_json.crs_list.length){var e=(i.config_json.crs_list||[]).filter((function(e){return r.config_json.crs_list.includes(e.srid)}));j(e)}}),[]),Object(H.useEffect)((function(){var e=f.find((function(e){return e.srid===s})),t=String(e.precision).length-1,n=new pr.a({target:h.current,coordinateFormat:Object(fr.c)(t),className:"viewer-mouse-position",projection:"EPSG:"+s});return a.addControl(n),function(){a.removeControl(n)}}),[s]),Object(H.useEffect)((function(){var e=!1,t=a.getView().getProjection().getCode();s&&l&&(f.map((function(n){var r=jr(l,t,n.extent);return n.srid===s&&r&&(e=!0),n})),e&&o(u(4326)))}),[l]),0===f.length)return null;var b=a?a.getView().getProjection().getCode():"EPSG:3857",m=l,g=f.find((function(e){return e.srid===s}));g.code!==b&&(m=Object(Wt.u)(l,b,"EPSG:"+g.srid));var v=String(g.precision).length-1;return m=m.map((function(e){return(Math.round(parseFloat(e)*g.precision)/g.precision).toFixed(v)})),Object(J.jsxs)("div",{className:"crsselect",children:[Object(J.jsx)("div",{id:"cursor_coords",ref:h}),Object(J.jsx)(nr.a,{value:s,options:f.map((function(e){return Object(Y.a)(Object(Y.a)({},e),{},{value:e.srid,label:e.label||e.title,disabled:jr(l,b,e.extent)})})),onChange:function(e){o(u(e.value))},placeholder:f?f.find((function(e){return e.srid===s})).label:"Escolha"})]})}var br=n(309),mr=n(147),gr=n(202),vr=n(203),Or=n(198),_r=n(241),xr=n(197),yr=n(37),wr=n(565),Er=n(371),Sr=n.n(Er),Pr=(n(1172),[{value:"symbol",title:"Adicionar s\xedmbolo",icon:"pi pi-star-o"},{value:"text",title:"Adicionar texto",icon:"pi pi-info-circle"},{value:"point",title:"Adicionar ponto",icon:"pi pi-circle-on"},{value:"line",title:"Adicionar linha",icon:"pi pi-minus"},{value:"polygon",title:"Adicionar pol\xedgono",icon:"pi pi-th-large"}]),Ar=[{value:"select",title:"Selecionar",icon:"pi pi-pencil"}],Cr=[{value:"undo",title:"Desfazer",icon:"pi pi-replay"},{value:"redo",title:"Refazer",icon:"pi pi-refresh"},{value:"clear",title:"Limpar Tudo",icon:"pi pi-trash"}],Tr=[{value:"fill",title:"C\xf4r de preenchimento",icon:"pi pi-palette"},{value:"stroke",title:"C\xf4r de rebordo",icon:"pi pi-palette"}],Rr=[{value:"geojson",title:"GeoJSON",icon:"pi pi-file",tooltip:"Exportar para ficheiro GeoJSON"},{value:"gml",title:"GML",icon:"pi pi-file",tooltip:"Exportar para ficheiro GML"},{value:"shape",title:"ShapeFile",icon:"pi pi-file",tooltip:"Exportar para ficheiro ShapeFile"},{value:"kml",title:"KML",icon:"pi pi-file",tooltip:"Exportar para ficheiro KML"}],Nr={Symbol:"s\xedmbolo",Text:"texto",Point:"ponto",LineString:"trajeto",Polygon:"pol\xedgono"};var kr=function(e){Object(ne.a)(n,e);var t=Object(re.a)(n);function n(e){var r;Object(ee.a)(this,n),(r=t.call(this,e)).changeSize=function(e){var t=e.value;r.setState(Object(Y.a)(Object(Y.a)({},r.state),{},{size:t}),(function(){var e=r.select.getFeatures();e.getLength()&&r.updateStyle(e.item(0))}))},r.changeFill=function(e){r.setState(Object(Y.a)(Object(Y.a)({},r.state),{},{fill:e.rgb}),(function(){var e=r.select.getFeatures();e.getLength()&&r.updateStyle(e.item(0))}))},r.changeStroke=function(e){r.setState(Object(Y.a)(Object(Y.a)({},r.state),{},{stroke:e.rgb}),(function(){var e=r.select.getFeatures();e.getLength()&&r.updateStyle(e.item(0))}))},r.changeSymbol=function(e){var t=e.value;r.setState(Object(Y.a)(Object(Y.a)({},r.state),{},{symbol_type:t}),(function(){var e=r.select.getFeatures();e.getLength()&&r.updateStyle(e.item(0))}))},r.changeTextStyle=function(e){var t=e.value;r.setState(Object(Y.a)(Object(Y.a)({},r.state),{},{text_style:t}),(function(){var e=r.select.getFeatures();e.getLength()&&r.updateStyle(e.item(0))}))},r.changeTextSize=function(e){var t=e.value;r.setState(Object(Y.a)(Object(Y.a)({},r.state),{},{text_size:t}),(function(){var e=r.select.getFeatures();e.getLength()&&r.updateStyle(e.item(0))}))},r.changeTextFont=function(e){var t=e.value;r.setState(Object(Y.a)(Object(Y.a)({},r.state),{},{text_font:t}),(function(){var e=r.select.getFeatures();e.getLength()&&r.updateStyle(e.item(0))}))},r.changeTextValue=function(e){r.setState(Object(Y.a)(Object(Y.a)({},r.state),{},{text_value:e.target.value}),(function(){var e=r.select.getFeatures();e.getLength()&&r.updateStyle(e.item(0))}))},r.toggleFillPicker=function(){r.setState(Object(Y.a)(Object(Y.a)({},r.state),{},{displayFillPicker:!r.state.displayFillPicker,displayStrokePicker:!1}))},r.closeFillPicker=function(){r.setState(Object(Y.a)(Object(Y.a)({},r.state),{},{displayFillPicker:!1}))},r.toggleStrokePicker=function(){r.setState(Object(Y.a)(Object(Y.a)({},r.state),{},{displayStrokePicker:!r.state.displayStrokePicker,displayFillPicker:!1}))},r.closeStrokePicker=function(){r.setState(Object(Y.a)(Object(Y.a)({},r.state),{},{displayStrokePicker:!1}))};var i=Object.assign([],e.viewer.config_json.drawings),a=e.record.config_json;a&&a.exclude_export_formats&&a.exclude_export_formats.length?r.exportFormats=Rr.filter((function(e){return!a.exclude_export_formats.includes(e.value)})):e.viewer&&e.viewer.config_json&&e.viewer.config_json.exclude_export_formats?r.exportFormats=Rr.filter((function(t){return!e.viewer.config_json.exclude_export_formats.includes(t.value)})):r.exportFormats=[].concat(Rr),r.state={enabled:!0,hist:[i],history_now:0,click:!1,draw_geom:!1,draw_symbol:!1,draw_text:!1,fill:{r:"255",g:"255",b:"255",a:"1"},stroke:{r:"0",g:"0",b:"0",a:"1"},size:"2",symbol_type:"x",text_style:"normal",text_size:"20px",text_font:"Arial, Helvetica, sans-serif",text_value:"Introduza o texto...",displayFillPicker:!1,displayStrokePicker:!1,editing:null,selectedTool:null},r.sizeOptions=[{key:"1",label:"1",value:"1"},{key:"2",label:"2",value:"2"},{key:"3",label:"3",value:"3"},{key:"4",label:"4",value:"4"},{key:"5",label:"5",value:"5"},{key:"10",label:"10",value:"10"},{key:"15",label:"15",value:"15"},{key:"20",label:"20",value:"20"}],r.symbolOptions=[{key:"1",label:"circulo",value:"circle"},{key:"2",label:"quadrado",value:"square"},{key:"3",label:"tri\xe2ngulo",value:"triangle"},{key:"4",label:"estrela",value:"star"},{key:"5",label:"cruz",value:"cross"},{key:"10",label:"xis",value:"x"}],r.textStyleOptions=[{key:"1",label:"normal",value:"normal"},{key:"2",label:"italico",value:"italic"},{key:"3",label:"negrito",value:"bold"}],r.textSizeOptions=[{key:"1",label:"8px",value:"8px"},{key:"2",label:"11px",value:"11px"},{key:"3",label:"15px",value:"15px"},{key:"4",label:"20px",value:"20px"},{key:"5",label:"25px",value:"25px"}],r.textFontOptions=[{key:"1",label:"Arial",value:"Arial, Helvetica, sans-serif"},{key:"2",label:"Georgia",value:"Georgia, serif"}];var o=r.props.mainMap;r.drawingsLayer=e.utils.findOlLayer(o,"userlayer"),r.vectorSource=r.drawingsLayer.getSource(),r.features=r.vectorSource.getFeaturesCollection(),r.modify=null,r.select=new xr.a({condition:yr.m,hitTolerance:5,wrapX:!1,filter:function(e,t){return"userlayer"===t.get("id")}});var c=new lt.a;return r.select.on("select",(function(e){var t=e.selected,n=e.deselected;if(t&&t.forEach((function(e){if(e.get("state")){c.push(e);var t=r.createStyle(e,{r:255,g:0,b:0,a:1});e.setStyle(t)}})),n&&n.forEach((function(e){if(e.get("state")){var t=e.getProperties(),n=r.createStyle(e,t.state.stroke);e.setStyle(n)}})),t||n||c.forEach((function(e){if(e.get("state")){var t=e.getProperties(),n=r.createStyle(e,t.state.stroke);e.setStyle(n)}})),!t||0===t.length)return r.modify&&(r.modify.un("modifyend",r.onMOdifyEnd.bind(Object(br.a)(r))),o.removeInteraction(r.modify),r.modify=null),r.setState(Object(Y.a)(Object(Y.a)({},r.state),{},{draw_geom:!1,draw_symbol:!1,draw_text:!1,editing:null}));r.editFeature(t[0])})),r.draw=null,r.format=new Mt.a,r}return Object(te.a)(n,[{key:"createStyle",value:function(e,t){var n=e.getProperties(),r=this.props.utils,i=n.state,a=i.symbol_type,o=i.size,c=i.fill,s=i.text_style,l=i.text_size,u=i.text_font,d=i.text_value,p=r.createDrawingStyle(e.getGeometry().getType(),o,c,t);return"Symbol"===n.type&&(p=r.createDrawingSymbol(a,o,c,t)),"Text"===n.type&&(p=r.createDrawingText(e,o,c,t,s,l,u,d)),p}},{key:"updateStyle",value:function(e){var t=this.props,n=t.viewer,r=t.actions,i=t.dispatch,a=t.utils,o=this.props.mainMap.getView().getProjection().getCode(),c=a.createStyle(e,this.state,{r:255,g:0,b:0,a:1});e.setStyle(c);var s=a.serializeDrawing(e,this.state,o),l=n.config_json.drawings.map((function(e){return e.id===s.id?s:e}));i(r.viewer_set_drawings(l))}},{key:"onMOdifyEnd",value:function(e){var t=this;e.features.forEach((function(e){t.updateStyle(e)}))}},{key:"editFeature",value:function(e){var t=this,n=e.get("state"),r=this.props.mainMap;this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{editing:e.getProperties()},n),(function(){var n=new lt.a;n.push(e),t.modify=new _r.a({features:n,deleteCondition:function(e){return Object(yr.l)(e)&&Object(yr.m)(e)}}),t.modify.on("modifyend",t.onMOdifyEnd.bind(t)),r.addInteraction(t.modify),t.modify.setActive(!0)}))}},{key:"componentDidMount",value:function(){var e=this.props.mainMap;this.drawingsLayer=this.props.utils.findOlLayer(e,"userlayer"),this.vectorSource=this.drawingsLayer.getSource(),this.features=this.vectorSource.getFeaturesCollection(),this.props.mainMap.addInteraction(this.select),this.select.setActive(!1)}},{key:"componentDidUpdate",value:function(e){this.state.selectedTool&&"drawtools"!=this.props.viewer.config_json.selected_menu&&(this.select.setActive(!1),this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{selectedTool:""})))}},{key:"addInteraction",value:function(e,t){var n=this,r=this.state,i=r.hist,a=r.history_now,o=this.props,c=o.viewer,s=o.actions,l=o.dispatch,u=o.utils,d=this.props.mainMap,p=d.getView().getProjection().getCode();this.draw=new Or.a({features:new lt.a,type:e}),this.findInteraction(mr.a).setActive(!1),this.findInteraction(gr.a).setActive(!1),this.findInteraction(vr.a).setActive(!1),l(s.viewer_set_exclusive_mapcontrol("DrawTools")),d.addInteraction(this.draw),this.draw.on("drawend",(function(e){var t=u.serializeDrawing(e.feature,n.state,p),r=[].concat(Object(ae.a)(c.config_json.drawings),[t]);l(s.viewer_set_drawings(r)),setTimeout((function(){var e=[];r.forEach((function(t){e.push(Object.assign({},t))})),i.push(e),n.setState(Object(Y.a)(Object(Y.a)({},n.state),{},{hist:i,history_now:a+1,selectedTool:null,draw_geom:!1,draw_symbol:!1,draw_text:!1})),d.removeInteraction(n.draw),n.findInteraction(mr.a).setActive(!0),n.findInteraction(gr.a).setActive(!0),n.findInteraction(vr.a).setActive(!0),l(s.viewer_set_exclusive_mapcontrol(null))}),350)}))}},{key:"findInteraction",value:function(e){var t=!1;return this.props.mainMap.getInteractions().forEach((function(n){n instanceof e&&(t=n)})),t}},{key:"toggleInteraction",value:function(e){var t=this.props.mainMap;this.draw&&t.removeInteraction(this.draw),this.addInteraction(e),this.findInteraction(mr.a).setActive(!1)}},{key:"startDraw",value:function(e,t){var n=this;if(e.preventDefault(),e.target.blur(),t===this.state.selectedTool){var r=this.props,i=r.mainMap,a=r.actions,o=r.dispatch;return"select"===t?this.select.setActive(!1):(i.removeInteraction(this.draw),this.findInteraction(mr.a).setActive(!0),this.findInteraction(gr.a).setActive(!0),this.findInteraction(vr.a).setActive(!0)),this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{selectedTool:null,draw_geom:!1,draw_symbol:!1,draw_text:!1}),(function(){o(a.viewer_set_exclusive_mapcontrol(null))}))}"select"===t?this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{selectedTool:t,draw_geom:!1,draw_symbol:!1,draw_text:!1}),(function(){n.select.setActive(!0);var e=n.props,t=e.mainMap,r=e.actions,i=e.dispatch;n.draw&&t.removeInteraction(n.draw),i(r.viewer_set_exclusive_mapcontrol("DrawTools"))})):this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{selectedTool:t}),(function(){switch(n.select.setActive(!1),t){case"symbol":n.clickDrawSymbol();break;case"text":n.clickDrawText();break;case"point":default:n.clickDrawPoint();break;case"line":n.clickDrawLine();break;case"polygon":n.clickDrawPolygon()}}))}},{key:"clickDrawPoint",value:function(){this.toggleInteraction("Point"),this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{draw_geom:!0,draw_symbol:!1,draw_text:!1,editing:null}))}},{key:"clickDrawLine",value:function(){this.toggleInteraction("LineString"),this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{draw_geom:!0,draw_symbol:!1,draw_text:!1,editing:null}))}},{key:"clickDrawPolygon",value:function(){this.toggleInteraction("Polygon"),this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{draw_geom:!0,draw_symbol:!1,draw_text:!1,editing:null}))}},{key:"clickDrawText",value:function(){var e=this,t=this.props.mainMap;this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{draw_geom:!1,draw_symbol:!1,draw_text:!0,editing:null}),(function(){t.removeInteraction(e.draw),e.addInteraction("Point")}))}},{key:"clickDrawSymbol",value:function(){var e=this,t=this.props.mainMap;this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{draw_geom:!1,draw_symbol:!0,draw_text:!1,editing:null}),(function(){t.removeInteraction(e.draw),e.addInteraction("Point")}))}},{key:"clickUndo",value:function(e){var t=this;e.preventDefault();var n=this.props,r=n.actions,i=n.dispatch,a=n.mainMap;this.modify&&(this.modify.un("modifyend",this.onMOdifyEnd.bind(this)),a.removeInteraction(this.modify),this.modify=null),this.select.getFeatures().clear(),this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{editing:null}),(function(){var e=[],n=t.state,a=n.hist,o=n.history_now;o>0&&(a[--o].forEach((function(t){e.push(t)})),t.setState(Object(Y.a)(Object(Y.a)({},t.state),{},{hist:a,history_now:o}),(function(){i(r.viewer_set_drawings(e))})))}))}},{key:"clickRedo",value:function(e){var t=this;e.preventDefault();var n=this.props,r=n.actions,i=n.dispatch,a=n.mainMap;this.modify&&(this.modify.un("modifyend",this.onMOdifyEnd.bind(this)),a.removeInteraction(this.modify),this.modify=null),this.select.getFeatures().clear(),this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{editing:null}),(function(){var e=[],n=t.state,a=n.hist,o=n.history_now;o+1<a.length&&(a[++o].forEach((function(t){e.push(t)})),t.setState(Object(Y.a)(Object(Y.a)({},t.state),{},{hist:a,history_now:o}),(function(){i(r.viewer_set_drawings(e))})))}))}},{key:"clickDelete",value:function(e){e.preventDefault();var t=this.props,n=t.actions,r=t.dispatch,i=t.mainMap;this.modify&&(this.modify.un("modifyend",this.onMOdifyEnd.bind(this)),i.removeInteraction(this.modify),this.modify=null),this.select.getFeatures().clear(),r(n.viewer_set_drawings([])),this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{hist:[[]],history_now:0,editing:null}))}},{key:"getEditingFeature",value:function(e){var t=null;return this.features.forEach((function(n){n.get("id")===e&&(t=n)})),t}},{key:"removeFeature",value:function(){var e=this.props,t=e.viewer,n=e.actions,r=e.dispatch,i=e.mainMap,a=t.config_json.drawings,o=this.state.editing,c=this.getEditingFeature(o.id);c&&(this.modify&&(this.modify.un("modifyend",this.onMOdifyEnd.bind(this)),i.removeInteraction(this.modify),this.modify=null),this.select.getFeatures().clear(),a=a.filter((function(e){return e.id!==c.getId()})),r(n.viewer_set_drawings(a))),this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{draw_geom:!1,draw_symbol:!1,draw_text:!1,editing:null}))}},{key:"finishEditing",value:function(){this.select.getFeatures().clear(),this.select.dispatchEvent("select")}},{key:"disableTools",value:function(){var e=this.props.mainMap;this.state.selectedTool&&(this.draw&&e.removeInteraction(this.draw),this.findInteraction(mr.a).setActive(!0),this.findInteraction(gr.a).setActive(!0),this.findInteraction(vr.a).setActive(!0),this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{selectedTool:null}))),this.state.editing&&this.finishEditing(),this.modify&&(this.modify.un("modifyend",this.onMOdifyEnd.bind(this)),e.removeInteraction(this.modify),this.modify=null),this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{enabled:!1,draw_geom:!1,draw_symbol:!1,draw_text:!1,editing:null}))}},{key:"enableTools",value:function(){this.state.enabled||this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{enabled:!0}))}},{key:"componentWillUnmount",value:function(){var e=this.props.mainMap;e.removeInteraction(this.select),this.modify&&(this.modify.un("modifyend",this.onMOdifyEnd.bind(this)),e.removeInteraction(this.modify),this.modify=null),e.removeInteraction(this.draw),this.findInteraction(mr.a).setActive(!0),this.findInteraction(gr.a).setActive(!0),this.findInteraction(vr.a).setActive(!0)}},{key:"download",value:function(e){var t=this.props,n=t.viewer,r=t.record,i=r?r.config_json:null,a=new le.a,o=null,c={dataProjection:"EPSG:"+(o=i&&i.export_crs?i.export_crs:n.config_json&&n.config_json.export_crs?n.config_json.export_crs:n.config_json&&n.config_json.display_crs?n.config_json.display_crs:4326),featureProjection:this.props.mainMap.getView().getProjection().getCode(),decimals:6},s=a.writeFeaturesObject(this.features.getArray(),c),l={type:"name",properties:{name:"urn:ogc:def:crs:EPSG::"+o}};s.crs=l;var u=JSON.stringify(s),d=new Blob([u],{type:"application/json"});Sr.a.saveAs(d,"geojson")}},{key:"getButtonStyle",value:function(e){var t=this.state,n=t.fill,r=t.stroke,i="rgba(".concat(n.r,", ").concat(n.g,", ").concat(n.b,", ").concat(n.a,")"),a="rgba(".concat(r.r,", ").concat(r.g,", ").concat(r.b,", ").concat(r.a,")");switch(e.value){case"fill":return{backgroundColor:i,color:"black"};case"stroke":return{backgroundColor:a,color:"white"}}}},{key:"zoom",value:function(e){var t=this.props.mainMap,n=function(e,t){var n=new le.a,r={dataProjection:t,featureProjection:t},i=n.readFeatures(e,r);return i=i instanceof lt.a?i.getArray():i,i}(JSON.stringify(e),t.getView().getProjection().getCode());n.length&&t.getView().fit(n[0].getGeometry())}},{key:"deleteItem",value:function(e){var t=this.props,n=t.viewer,r=t.mainMap,i=t.dispatch,a=t.actions;this.modify&&(this.modify.un("modifyend",this.onMOdifyEnd.bind(this)),r.removeInteraction(this.modify),this.modify=null),this.select.getFeatures().clear(),this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{draw_geom:!1,draw_symbol:!1,draw_text:!1,editing:null}),(function(){var t=n.config_json.drawings.filter((function(t){return t.id!==e.id}));i(a.viewer_set_drawings(t))}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.enabled,r=t.draw_text,i=t.draw_symbol,a=t.size,o=t.fill,c=t.stroke,s=t.symbol_type,l=t.text_style,u=t.text_size,d=t.text_font,p=t.text_value,f=t.editing,j=t.selectedTool,h=this.props.viewer;return n&&"drawtools"!==h.config_json.selected_menu&&this.disableTools(),n||"drawtools"!==h.config_json.selected_menu||this.enableTools(),Object(J.jsxs)("div",{id:"drawtools",children:[Object(J.jsxs)("div",{className:"p-shadow-5 toolbar",children:[Pr.map((function(t){return Object(J.jsx)(bt.a,{icon:t.icon,label:t.label?t.label:"",tooltip:t.title,className:"p-button-secondary tool "+(t.value===j?"active":""),onClick:function(n){return e.startDraw(n,t.value)}},t.value)}))," ",Ar.map((function(t){return Object(J.jsx)(bt.a,{icon:t.icon,tooltip:t.title,className:"p-button-secondary tool "+(t.value===j?"active":""),onClick:function(n){return e.startDraw(n,t.value)}},t.value)})),Object(J.jsx)("br",{}),Tr.map((function(t){return Object(J.jsx)(bt.a,{icon:t.icon,tooltip:t.title,className:"p-button-secondary tool "+(t.value===j?"p-highlight":""),style:e.getButtonStyle(t),onClick:function(n){switch(t.value){case"fill":e.toggleFillPicker(n);break;case"stroke":e.toggleStrokePicker(n)}}},t.value)})),this.state.displayFillPicker?Object(J.jsxs)("div",{style:{position:"absolute",zIndex:"2"},children:[Object(J.jsx)("div",{style:{position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"},onClick:this.closeFillPicker.bind(this)}),Object(J.jsx)(wr.a,{color:o,onChange:this.changeFill.bind(this)})]}):null,this.state.displayStrokePicker?Object(J.jsxs)("div",{style:{position:"absolute",zIndex:"2"},children:[Object(J.jsx)("div",{style:{position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"},onClick:this.closeStrokePicker.bind(this)}),Object(J.jsx)(wr.a,{color:c,onChange:this.changeStroke.bind(this)})]}):null,Object(J.jsx)(nr.a,{text:a,tooltip:"Tamanho da linha/s\xedmbolo",value:a,options:this.sizeOptions,onChange:function(t){return e.changeSize(t)},style:{marginBottom:"1px"}}),Object(J.jsx)("br",{}),Object(J.jsx)("br",{}),Cr.map((function(t){return Object(J.jsx)(bt.a,{icon:t.icon,tooltip:t.title,className:"clear"!==t.value?"p-button-info tool":"p-button-danger tool",onClick:function(n){switch(t.value){case"undo":e.clickUndo(n);break;case"redo":e.clickRedo(n);break;case"clear":e.clickDelete(n)}}},t.value)}))]}),f?Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsxs)("h5",{children:["A editar ",Nr[f.type]]}),Object(J.jsxs)("div",{children:[Object(J.jsx)(bt.a,{onClick:function(t){return e.finishEditing()},icon:"pi pi-save",label:"Aplicar",tooltip:"Aplicar altera\xe7\xf5es"}),Object(J.jsx)(bt.a,{onClick:function(t){return e.removeFeature()},icon:"pi pi-trash",className:"p-button-danger",tooltip:"Apagar desenho"})]})]}):null,i?Object(J.jsxs)("div",{children:[Object(J.jsx)("h5",{children:"Op\xe7\xf5es de Simbologia"}),Object(J.jsx)(nr.a,{text:s,tooltip:"Escolha o S\xedmbolo",value:s,options:this.symbolOptions,onChange:this.changeSymbol.bind(this),style:{minWidth:"120px"}})]}):null,r?Object(J.jsxs)("div",{children:[Object(J.jsx)("h5",{children:"Op\xe7\xf5es de Texto"}),Object(J.jsx)(nr.a,{text:l,tooltip:"Estilo do Texto",value:l,options:this.textStyleOptions,onChange:this.changeTextStyle.bind(this)}),Object(J.jsx)(nr.a,{text:u,tooltip:"Tamanho do Texto",value:u,options:this.textSizeOptions,onChange:this.changeTextSize.bind(this)}),Object(J.jsx)(nr.a,{text:d,tooltip:"Tipo de Letra",value:d,options:this.textFontOptions,onChange:this.changeTextFont.bind(this)}),Object(J.jsx)("br",{}),Object(J.jsx)(jt.a,{className:"drawtools-text-input",value:p,onChange:this.changeTextValue.bind(this),tooltip:"Texto para a etiqueta",onClick:function(e){return e.target.select()}})]}):null,Object(J.jsx)("hr",{}),Object(J.jsx)("div",{children:h.config_json.drawings.length>0&&this.exportFormats.map((function(t){return Object(J.jsx)(bt.a,{icon:t.icon,label:t.title,tooltip:t.tooltip,className:"p-button-outlined p-button-sm p-button-info format-tool",onClick:function(n){return e.download(t.value)}},t.value)}))}),Object(J.jsx)("hr",{}),Object(J.jsx)("h5",{children:"Desenhos"}),0===h.config_json.drawings.length?Object(J.jsx)("p",{children:"N\xe3o existem desenhos"}):Object(J.jsxs)(Nn.a,{value:h.config_json.drawings,dataKey:"id",paginator:!0,rows:10,rowsPerPageOptions:[5,10,25],paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} at\xe9 {last} de {totalRecords} items",children:[Object(J.jsx)(kn.a,{field:"properties.id",header:"ID",body:function(e,t){return t.value.indexOf(e)+1}}),Object(J.jsx)(kn.a,{field:"properties.type",header:"Tipo",body:function(e){return Nr[e.properties.type]}}),Object(J.jsx)(kn.a,{body:function(t){return Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsx)(bt.a,{icon:"pi pi-search",className:"p-mr-2",onClick:function(){return e.zoom(t)},tooltip:"Centrar"}),Object(J.jsx)(bt.a,{icon:"pi pi-trash",className:"p-button-danger",onClick:function(){return e.deleteItem(t)},tooltip:"Apagar"})]})}})]})]})}}]),n}(z.a.Component);function Ir(e){var t=e.className,n=e.config,r=e.actions,i=e.record,a=i.config_json||{},o=i.title||"Ferramentas de Desenho";a.header;return Object(J.jsx)(bt.a,{title:o,className:t,icon:"pi pi-palette",style:{margin:"0.5em 1em"},onClick:function(e){return n.dispatch(r.viewer_set_selectedmenu(i.id))}})}function Mr(e){var t=e.type,n=e.region,r=e.as,i=e.config,a=e.actions,o=e.record,c=e.utils,s=i.core,l=i.mainMap,u=i.viewer,d=i.dispatch,p=i.Models,f=u.config_json.selected_menu,j=(p?p.Utils:c).getWindowSize,h=o.config_json||{},b=o.title||"Ferramentas de Desenho",m=h.header||b,g=j()[0]<=768;function v(){return Object(J.jsx)("div",{children:Object(J.jsx)(kr,{record:o,viewer:u,core:s,actions:a,dispatch:d,mainMap:l,utils:c})})}return Object(H.useEffect)((function(){"drawtools"===f&&d(a.viewer_set_exclusive_mapcontrol("DrawTools"))}),[f]),"link"===t&&n===o.links?Object(J.jsx)(bt.a,{title:b,icon:"pi pi-palette",className:"p-button-rounded p-button-raised",onClick:function(e){d(a.viewer_set_selectedmenu(o.id)),d(a.layout_show_menu(!g))}}):"panel"===r?Object(J.jsx)(Fn.a,{header:m,children:v()}):v()}var Lr,Fr;n(1173);function Ur(e,t){e.forEach((function(e){t(e),e instanceof se.b&&Ur(e.getLayers(),t)}))}function Gr(e){var t=e.config,n=t.layer,r=(t.actions,t.dispatch,t.mainMap),i=Object(H.useState)(!1),a=Object(X.a)(i,2),o=a[0],c=a[1],s=Object(H.useState)({items:[],coord:null}),l=Object(X.a)(s,2),u=l[0],d=l[1];function p(){Dr("selecao.geojson",(new le.a).writeFeatures(u.items))}return Object(H.useEffect)((function(){return Fr=function(e){var t;return Ur(r.getLayers(),(function(n){n.get("id")===e&&(t=n)})),t}(n.id),(Lr=new xr.a({layers:[Fr]})).on("select",(function(e){e.selected.length&&d({items:e.selected,coord:e.mapBrowserEvent.coordinate})})),r.addInteraction(Lr),function(){r.removeInteraction(Lr)}}),[]),Object(H.useEffect)((function(){Lr.setActive(o)}),[o]),Fr&&Fr.getSource()instanceof It.a?Object(J.jsx)("div",{className:"export-map-features",children:Object(J.jsxs)("table",{children:[Object(J.jsx)("thead",{children:Object(J.jsxs)("tr",{children:[Object(J.jsx)("th",{children:"Selecionar Elementos"}),Object(J.jsx)("th",{children:Object(J.jsx)(gt.a,{checked:o,onChange:function(e){return c(!o)}})})]})}),Object(J.jsxs)("tbody",{children:[!!u.coord&&u.coord.length&&Object(J.jsxs)("tr",{children:[Object(J.jsx)("td",{children:"Ponto"}),Object(J.jsx)("td",{children:Object(J.jsx)(bt.a,{className:"p-button-sm",onClick:function(){var e=new or.a({name:"Coordenada",geometry:new cr.a(u.coord)});Dr("coordenada.geojson",(new le.a).writeFeatures([e]))},label:"Exportar",icon:"pi pi-arrow-circle-down"})})]}),u.items.map((function(e,t){return Object(J.jsxs)("tr",{children:[Object(J.jsx)("td",{children:"Geometria"}),Object(J.jsx)("td",{children:Object(J.jsx)(bt.a,{className:"p-button-sm",onClick:p,label:"Exportar",icon:"pi pi-arrow-circle-down"})})]})}))]})]})}):null}function Dr(e,t){var n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}var Vr=n(172),Wr=n(1406);function Hr(e){var t=e.core,n=e.config,r=e.features,i=e.layers,a=e.actions,o=e.pubsub,c=e.dispatch,s=e.mainMap,l=e.record,u=n.viewer,d=o||{},p=d.publish,f=(d.subscribe,Object(H.useState)(null)),j=Object(X.a)(f,2),h=j[0],b=j[1],m=Object(H.useState)([]),g=Object(X.a)(m,2),v=g[0],O=g[1],_=Object(H.useState)(!0),x=Object(X.a)(_,2),y=x[0],w=x[1],E=Object(H.useState)(!0),S=Object(X.a)(E,2),P=S[0],A=S[1],C=Object(H.useState)(!0),T=Object(X.a)(C,2),R=T[0],N=T[1],k=function(e,t){var n={};return e.forEach((function(e){if(e.layer&&e.data)if(n[e.layer]||(n[e.layer]=[]),"ol"===e.type){var r=function(e,t){var n=new le.a,r={dataProjection:t.getView().getProjection().getCode(),featureProjection:t.getView().getProjection().getCode()},i=n.readFeatures(e,r);return i=i instanceof lt.a?i.getArray():i,i}(e.data,t);r.forEach((function(t){t.set("resultId",e.id),t.set("feature_tpl",Object(Y.a)({},e.feature_tpl))})),n[e.layer]=n[e.layer].concat(r)}else n[e.layer].push(e)})),n}(r,s),I=function(e,t,n){var r=!1;return Object.keys(e).forEach((function(e,i){zr(e,t,n)&&(r=!0)})),r}(k,i,v);Object(H.useEffect)((function(){var e=(new ft.a).get(t.COOKIE_AUTH_NAME),n=[];e&&e.userroles&&e.userroles.length&&(n=Object(ae.a)(e.userroles));var r=[],i=!0;l.config_json&&l.config_json.export_roles&&l.config_json.export_roles.length&&((r=l.config_json.export_roles.filter((function(e){return n.includes(e)})))&&0!==r.length||(i=!1));var a=!l.config_json||null==l.config_json.export_all||l.config_json.export_all,o=!l.config_json||null==l.config_json.export_record||l.config_json.export_record;O(n||[]),w(i),A(a),N(o)}),[]),Object(H.useEffect)((function(){var e=Object.keys(k).map((function(e,t){return t}));e&&e.length?b(e):b([0])}),[r.length]);var M=function(e){var t=e.value;if(e.action&&e.action.type){var n=e.action||{};t=!0===n.show_null||null!=e.value?Object(J.jsx)(bt.a,{label:n.label,icon:n.icon,className:n.classname||n.className,title:n.tooltip,onClick:function(e){return p(n.type,n.data)}}):null}else"html"===(e.type||"")&&(t=Object(J.jsx)("div",{dangerouslySetInnerHTML:{__html:e.value}}));return t};return 0===Object.keys(k).length?Object(J.jsx)(mt.a,{severity:"info",text:"Sem resultados. Clique no mapa para identificar."}):Object(J.jsxs)("div",{children:[Object(J.jsxs)("div",{style:{padding:"0.571rem 1rem",textAlign:"right"},children:[Object(J.jsx)(bt.a,{title:"Limpar resultados",label:"Limpar",icon:"pi pi-times",className:"p-button-outlined p-button-sm",onClick:function(e){c(a.viewer_set_featureinfo([]))}}),y&&P&&I?Object(J.jsx)(bt.a,{title:"Exportar resultados",label:"Exportar",icon:"pi pi-download",className:"p-button-outlined p-button-sm p-ml-2",onClick:function(e){return function(){var e=null;l&&l.config_json&&l.config_json.export_crs&&(e=l.config_json.export_crs);var t=[];Object.keys(k).map((function(e){zr(e,i,v)&&(t=t.concat(k[e]))})),Br("selecao.geojson",Kr(t,s,u,e))}()}}):null]}),Object(J.jsx)(Vr.a,{className:"p-pt-2",multiple:!0,activeIndex:h,onTabChange:function(e){return b(e.index)},children:Object.keys(k).map((function(e){var t=i.find((function(t){return t.title===e})),n=!0;if(t&&t.featureinfo_export_roles&&t.featureinfo_export_roles.length){var o=t.featureinfo_export_roles.filter((function(e){return v.includes(e)}));o&&0===o.length&&(n=!1)}return Object(J.jsx)(Vr.b,{header:e,children:k[e].map((function(e,i){var o;o=e.getId?e.getId():e.get?e.get("id")||e.get("uid")||e.get("fid"):e.id?e.id:String(i);var d=function(e,t){var n=[];if("text"===e.type)n.push({name:"name",value:e.data,type:"text"});else{var r=null;if(t&&t.feature_tpl&&t.feature_tpl.fields&&t.feature_tpl.fields.length?r=t.feature_tpl:e.get("feature_tpl")&&e.get("feature_tpl").fields&&e.get("feature_tpl").fields.length&&(r=e.get("feature_tpl")),e instanceof or.a)if(r)r.fields.forEach((function(t,r){var i=t.name;if("object"!=typeof e.get(i)){var a=e.get(t.name);t.value&&(a=t.value);var o=a&&a.match?a.match(/[^{}]+(?=})/g):null;if(o&&o.forEach((function(t){a=a.replace("{".concat(t,"}"),e.get(t)||"")})),t.action){var c=Object(Y.a)(Object(Y.a)({},t.action),{},{data:Object(Y.a)({},e.getProperties())});if(delete c.data.feature_tpl,t.action.data){var s={};Object.entries(t.action.data).forEach((function(e){var t=Object(X.a)(e,2),n=t[0],r=t[1],i=r,a=r&&r.match?r.match(/[^{}]+(?=})/g):null;if(a){var o=a[0];1===a.length&&r==="{".concat(o,"}")?a[0]in c.data&&(i=c.data[a[0]]):a.forEach((function(e){e in c.data&&(i=i.replace("{".concat(e,"}"),c.data[e]))}))}s[n]=i})),c.data=s}n.push({key:i,name:t.title,action:c,value:a,type:t.type})}else n.push({key:i,name:t.title,value:Yr(a,t.format),type:t.type})}}));else{var i=e.getGeometryName()||"geometry";e.getKeys().forEach((function(t,r){"object"==typeof e.get(t)||[i,"st_union","boundedBy","resultId"].includes(t)||n.push({key:t,name:t,value:e.get(t)})}))}else r?r.fields.forEach((function(t,r){var i=t.name;if("object"!=typeof e.get(i)){var a=e.data[t.name];t.value&&(a=t.value);var o=a&&a.match?a.match(/[^{}]+(?=})/g):null;o&&o.forEach((function(t){a=a.replace("{".concat(t,"}"),e.get(t)||"")})),n.push({key:i,name:t.title,value:Yr(a,t.format),type:t.type})}})):Object.keys(e.data).forEach((function(t){"object"!=typeof e.data[t]&&n.push({name:t,value:e.data[t]})}))}return n}(e,t),p=e.getGeometry&&null!=e.getGeometry(),f="text"===e.type;return Object(J.jsxs)("div",{className:"fi-result-feat",children:[Object(J.jsxs)("div",{className:"fi-result-tools",children:[p&&Object(J.jsx)(bt.a,{title:"Aproximar ao elemento",icon:"pi pi-search",onClick:function(t){return function(e){if(e.getGeometry()){var t=e.getGeometry().getExtent();if(!t)return;if(!t.length)return;if(t[0]===1/0)return;var n=[t[0]+(t[2]-t[0])/2,t[1]+(t[3]-t[1])/2];c(a.map_set_extent(n,t))}}(e)}}),!f&&y&&R&&n&&Object(J.jsx)(bt.a,{title:"Exportar elemento",icon:"pi pi-download",onClick:function(t){return function(e){var t=null;l&&l.config_json&&l.config_json.export_crs&&(t=l.config_json.export_crs),Br("selecao.geojson",Kr([e],s,u,t))}(e)}}),Object(J.jsx)(bt.a,{title:"Remover elemento",icon:"pi pi-times",onClick:function(t){return function(e){var t=-1;if(e.get?t=r.findIndex((function(t){return t.id===e.get("resultId")})):e.id&&(t=r.findIndex((function(t){return t.id===e.id}))),-1!==t){var n=Object(ae.a)(r);n.splice(t,1),c(a.viewer_set_featureinfo(n))}}(e)}})]}),Object(J.jsxs)(Nn.a,{value:d,groupField:"layer",className:"p-datatable-striped",children:[!f&&Object(J.jsx)(kn.a,{header:"\xa0",field:"name",style:{whiteSpace:"pre-wrap",overflowWrap:"break-word"}}),Object(J.jsx)(kn.a,{header:"\xa0",field:"value",body:M,style:{whiteSpace:"pre-wrap",overflowWrap:"break-word"}})]})]},o)}))})}))})]})}function zr(e,t,n){var r=!1,i=t.find((function(t){return t.title===e}));if(i)if(i&&i.featureinfo_export_roles&&i.featureinfo_export_roles.length){var a=i.featureinfo_export_roles.filter((function(e){return n.includes(e)}));a&&a.length>0&&(r=!0)}else r=!0;return r}function Kr(e,t,n,r){var i=r;i||(i=n.config_json&&n.config_json.export_crs?n.config_json.export_crs:n.config_json&&n.config_json.display_crs?n.config_json.display_crs:4326);var a=new le.a,o={dataProjection:"EPSG:"+i,featureProjection:t.getView().getProjection().getCode()},c=a.writeFeatures(e,o),s=JSON.parse(c),l={type:"name",properties:{name:"urn:ogc:def:crs:EPSG::"+i}};return s.crs=l,JSON.stringify(s)}function Br(e,t){var n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}function Yr(e,t){var n=e;if(t){var r=e;t.source_unit&&t.output_unit&&(r=Object(Wr.a)(r,t.source_unit).toNumeric(t.output_unit)),t.options&&(r=r.toLocaleString(t.locale||"en-US",t.options),!1!==t.options.useGrouping&&(r=r.replace(/,/g," "))),t.expression&&(r=t.expression.replace("{value}",r)),n=r}return n}n(1184);function qr(e,t){e.forEach((function(e){t(e),e instanceof se.b&&qr(e.getLayers(),t)}))}function Xr(e){var t=e.className,n=e.config,r=e.actions,i=e.record,a=(i.config_json,i.title||"Identificar Elementos");return Object(J.jsx)(bt.a,{title:a,className:t,icon:"pi pi-info-circle",style:{margin:"0.5em 1em"},onClick:function(e){return n.dispatch(r.viewer_set_selectedmenu(i.id))}})}function Jr(e){var t=e.as,n=e.core,r=e.config,i=e.actions,a=e.record,o=r.viewer,c=r.dispatch,s=r.Models,l=r.mainMap,u=o.featureinfo,d=s.Utils,p=d.getWindowSize,f=(d.showOnPortal,o.config_json),j=f.selected_menu,h=f.layers,b=a.config_json||{},m=a.title||"Identificar Elementos",g=b.header||m,v=p()[0]<=768;return Object(H.useEffect)((function(){"featureinfo"===j&&c(i.viewer_set_exclusive_mapcontrol("FeatureInfo"))}),[j]),Object(H.useEffect)((function(){"featureinfo"===j&&(v||!0!==b.expand_menu||c(i.layout_show_menu(!0)),v&&!0===b.expand_menu_mobile&&c(i.layout_show_menu(!1)))}),[o.featureinfo]),"panel"===t?Object(J.jsx)(Fn.a,{header:g,children:Object(J.jsx)("div",{className:"feature-info",children:Object(J.jsx)(Hr,{core:n,config:r,features:u,layers:h,actions:i,pubsub:n.pubsub,dispatch:c,mainMap:l,record:a})})}):null}n(1185);var Zr=n(165);function $r(e){var t,n,r=e.config,i=e.actions,a=e.dispatch,o=e.record,c=r.viewer,s=r.mainMap,l=r.Models.MapModel.getProjectionSrid,u=c.geolocation,d=o.config_json,p=c.config_json.map_controls.find((function(e){return"GeoLocation"===e.id})),f=!!p&&p.active,j=!!p&&p.tracking,h=i.viewer_update_mapcontrol,b=(i.viewer_set_selectedmenu,i.map_set_extent,i.viewer_set_exclusive_mapcontrol,Object(H.useState)([])),m=Object(X.a)(b,2),g=m[0],v=m[1];function O(){var e=[],t=1e4;if(u&&u.coordinates){if(e.push({field:"Longitude (dd)",value:Math.round(u.coordinates[0]*t)/t}),e.push({field:"Latitude (dd)",value:Math.round(u.coordinates[1]*t)/t}),c.config_json.display_crs&&4326!=c.config_json.display_crs){var n=Object(Wt.u)(u.coordinates,"EPSG:4326","EPSG:"+c.config_json.display_crs);e.push({field:"X [EPSG:"+c.config_json.display_crs+"]",value:Math.round(100*n[0])/100}),e.push({field:"Y [EPSG:"+c.config_json.display_crs+"]",value:Math.round(100*n[1])/100})}u.accuracy&&e.push({field:"Precis\xe3o",value:Math.round(100*u.accuracy)/100+" m"}),u.altitude&&e.push({field:"Altitude",value:Math.round(100*u.altitude)/100+" m"}),u.altitudeAccuracy&&e.push({field:"Precis\xe3o da Altitude",value:Math.round(100*u.altitudeAccuracy)/100+" m"}),u.heading&&e.push({field:"Dire\xe7\xe3o",value:Math.round(100*u.heading)/100+" rad"}),u.speed&&e.push({field:"Velocidade",value:Math.round(100*u.speed)/100+" m/s"})}v(e)}return Object(H.useEffect)((function(){O()}),[c.config_json.display_crs]),Object(H.useEffect)((function(){O()}),[u]),u&&u.error?Object(J.jsx)(mt.a,{severity:"warn",text:function(e,t){var n,r=e.message;switch(e.code){case 1:r="N\xe3o foi autorizada a obten\xe7\xe3o da localiza\xe7\xe3o.";break;case 2:r="Ocorreu um erro interno ao obter-se a localiza\xe7\xe3o.";break;case 3:r="Ocorreu um timeout antes de ter sido poss\xedvel obter a localiza\xe7\xe3o.";break;default:r=null!==t&&void 0!==t&&null!==(n=t.error)&&void 0!==n&&n.text?t.error.text:"N\xe3o foi poss\xedvel obter a localiza\xe7\xe3o."}return e.code&&t&&t["error"+e.code]&&t["error"+e.code].text&&(r=t["error"+e.code].text),r}(u.error,null===d||void 0===d?void 0:d.messages)}):Object(J.jsxs)("div",{children:[Object(J.jsx)(mt.a,{severity:"info",text:null!==d&&void 0!==d&&null!==(t=d.messages)&&void 0!==t&&null!==(n=t.intro)&&void 0!==n&&n.text?d.messages.intro.text:"Selecione a op\xe7\xe3o 'Ver Posi\xe7\xe3o' para ativar a visualiza\xe7\xe3o da sua posi\xe7\xe3o."}),Object(J.jsxs)("div",{className:"p-mt-3 p-pt-3 p-pr-2 p-pl-2",style:{border:"1px solid rgb(111 57 57 / 12%)"},children:[Object(J.jsx)("div",{className:"p-grid",children:Object(J.jsxs)("div",{className:"p-col",style:{textAlign:"left"},children:[Object(J.jsx)(gt.a,{className:"p-mr-1",inputId:"geolocationSwitch",checked:f,onChange:function(e){return function(e){var t=e;a(h(Object(Y.a)(Object(Y.a)({},p),{},{active:t})))}(e.value)}})," ",Object(J.jsx)("label",{htmlFor:"geolocationSwitch",children:Object(J.jsx)("span",{className:"p-text-bold",children:"Ver Posi\xe7\xe3o"})})]})}),Object(J.jsxs)("div",{className:"p-grid p-mt-2",children:[Object(J.jsx)("div",{className:"p-col",style:{textAlign:"left"},children:Object(J.jsxs)("div",{className:"p-field-checkbox p-mb-1",children:[Object(J.jsx)(Zr.a,{onChange:function(e){return function(e){var t=e;a(h(Object(Y.a)(Object(Y.a)({},p),{},{tracking:t})))}(e.checked)},checked:j,disabled:!f}),Object(J.jsx)("label",{className:"p-checkbox-label"+(f?"":" p-disabled"),children:"Atualizar"})]})}),Object(J.jsx)("div",{className:"p-col",style:{textAlign:"right"},children:Object(J.jsx)(bt.a,{label:"Localizar",icon:"pi pi-search",className:"p-button-sm",onClick:function(e){!function(e){if(e&&e.coordinates){var t=Object(Wt.u)(e.coordinates,"EPSG:4326",s.getView().getProjection()),n=[t[0]-500,t[1]-500,t[0]+500,t[1]+500],r=l(s.getView().getProjection());a(i.map_set_extent(t,n,r))}}(u)},disabled:!f})})]})]}),u&&Object(J.jsx)("div",{className:"card p-pt-1",children:Object(J.jsxs)(Nn.a,{value:g,children:[Object(J.jsx)(kn.a,{field:"field",header:""}),Object(J.jsx)(kn.a,{field:"value",header:""})]})})]})}n(1186);function Qr(e){var t=e.className,n=e.config,r=e.actions,i=e.record;return Object(J.jsx)(bt.a,{title:"A minha localiza\xe7\xe3o",className:t,icon:"pi pi-globe",style:{margin:"0.5em 1em"},onClick:function(e){return n.dispatch(r.viewer_set_selectedmenu(i.id))}})}function ei(e){var t=e.as,n=e.config,r=e.actions,i=e.record,a=(n.viewer,n.dispatch);return"panel"===t?Object(J.jsx)(Fn.a,{header:"A minha localiza\xe7\xe3o",children:Object(J.jsx)("div",{className:"geo-location",children:Object(J.jsx)($r,{config:n,actions:r,dispatch:a,record:i})})}):null}n(701);function ti(e){var t=e.config,n=Object(H.useState)(null),r=Object(X.a)(n,2),i=r[0],a=r[1];return Object(H.useEffect)((function(){if(t.url){var e=t.url;fetch(e).then((function(e){return e.text()})).then((function(e){a(e)})).catch((function(e){a(t.html||"")}))}else a(t.html||"")}),[]),Object(J.jsx)("div",{dangerouslySetInnerHTML:{__html:i}})}function ni(e){var t=e.className,n=e.config,r=e.actions,i=e.record,a=n.viewer,o=(n.dispatch,n.Models.Utils),c=o.getWindowSize,s=o.showOnPortal,l=Object(H.useState)(!1),u=Object(X.a)(l,2),d=u[0],p=u[1],f=Object(H.useState)(null),j=Object(X.a)(f,2),h=j[0],b=j[1],m=Object(H.useState)(!1),g=Object(X.a)(m,2),v=g[0],O=g[1],_=Object(H.useRef)(),x=i.config_json||{},y=i.title||"Ajuda",w=x.header||y,E=c()[0]<=768;if("popup"===i.as){var S=x.closeLabel||"Fechar";return Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsx)(bt.a,{title:y,className:t,icon:"far fa-question-circle",style:{margin:"0.5em 1em"},onClick:function(e){return p(!0)}}),s(Object(J.jsx)(vt.a,{ref:_,header:w,visible:d,style:{width:E?"90%":"50vw",height:"80%"},maximizable:!0,maximized:v,modal:!0,footer:Object(J.jsx)("div",{className:"p-grid",children:Object(J.jsx)("div",{className:"p-col",style:{textAlign:"right"},children:Object(J.jsx)(bt.a,{label:S,onClick:function(e){return p(!1)}})})}),onShow:function(){var e=_.current.contentEl;b({x:e.clientWidth,y:e.clientHeight-25})},onResize:function(e){var t=_.current.contentEl;b({x:t.clientWidth,y:t.clientHeight-25})},onMaximize:function(e){O(e.maximized);var t=_.current.contentEl;setTimeout((function(){b({x:t.clientWidth,y:t.clientHeight-25},200)}))},onHide:function(e){return p(!1)},children:!0===x.iframe?Object(J.jsx)("iframe",{title:y,src:x.url,style:h?{border:"none",width:"100%",height:h.y}:{border:"none",width:"100%"}}):Object(J.jsx)(ti,{config:x,size:h})}))]})}if("external"===i.as){var P,A=x.url?x.url:null===a||void 0===a||null===(P=a.config_json)||void 0===P?void 0:P.help_url;return A?Object(J.jsx)(bt.a,{title:y,className:t,icon:"far fa-question-circle",style:{margin:"0.5em 1em"},onClick:function(e){return window.open(A)}}):null}return Object(J.jsx)(bt.a,{title:y,className:t,icon:"far fa-question-circle",style:{margin:"0.5em 1em"},onClick:function(e){return n.dispatch(r.viewer_set_selectedmenu(i.id))}})}function ri(e){var t=e.as,n=e.config,r=(e.actions,e.record),i=n.viewer,a=(n.dispatch,n.Models.Utils),o=a.getWindowSize,c=a.showOnPortal,s=Object(H.useState)(!1),l=Object(X.a)(s,2),u=l[0],d=l[1],p=Object(H.useState)(null),f=Object(X.a)(p,2),j=f[0],h=f[1],b=Object(H.useState)(!1),m=Object(X.a)(b,2),g=m[0],v=m[1],O=Object(H.useRef)(),_=r.config_json||{},x=r.title||"Ajuda",y=_.header||x,w=o()[0]<=768,E=_.closeLabel||"Fechar",S=(null===r||void 0===r?void 0:r.as)||t;if("panel"===S)return Object(J.jsx)(Fn.a,{header:y,children:Object(J.jsx)(ti,{config:_})});if("popup"===S)return Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsxs)("button",{className:"p-link",onClick:function(e){return d(!0)},title:x,children:[Object(J.jsx)("span",{className:"layout-topbar-item-text"}),Object(J.jsx)("span",{className:"layout-topbar-icon far far fa-question-circle"})]}),c(Object(J.jsx)(vt.a,{ref:O,header:y,visible:u,style:{width:w?"90%":"50vw",height:"80%"},maximizable:!0,maximized:g,modal:!0,footer:Object(J.jsx)("div",{className:"p-grid",children:Object(J.jsx)("div",{className:"p-col",style:{textAlign:"right"},children:Object(J.jsx)(bt.a,{label:E,onClick:function(e){return d(!1)}})})}),onShow:function(){var e=O.current.contentEl;h({x:e.clientWidth,y:e.clientHeight-25})},onResize:function(e){var t=O.current.contentEl;h({x:t.clientWidth,y:t.clientHeight-25})},onMaximize:function(e){v(e.maximized);var t=O.current.contentEl;setTimeout((function(){h({x:t.clientWidth,y:t.clientHeight-25},200)}))},onHide:function(e){return d(!1)},children:!0===_.iframe?Object(J.jsx)("iframe",{title:x,src:_.url,style:j?{border:"none",width:"100%",height:j.y}:{border:"none",width:"100%"}}):Object(J.jsx)(ti,{config:_,size:j})}))]});if("external"===S){var P,A=_.url?_.url:null===i||void 0===i||null===(P=i.config_json)||void 0===P?void 0:P.help_url;return A?Object(J.jsx)("button",{className:"p-link",title:x,onClick:function(e){},children:Object(J.jsxs)("a",{href:A,target:"_blank",style:{color:"#ffffff"},children:[Object(J.jsx)("span",{className:"layout-topbar-item-text",children:x}),Object(J.jsx)("span",{className:"layout-topbar-icon pi pi-question-circle"})]})}):null}return null}function ii(e){e.region,e.as,e.config,e.actions;var t=e.record,n=t.config_json||{},r=t.title||"",i=Object(H.useState)(null),a=Object(X.a)(i,2),o=a[0],c=a[1];return Object(H.useEffect)((function(){if(n.url){var e=n.url;fetch(e).then((function(e){return e.text()})).then((function(e){c(e)})).catch((function(e){c(n.html||"")}))}else c(n.html||"")}),[]),Object(J.jsx)("div",{title:r,className:n.classname?n.classname:null,dangerouslySetInnerHTML:{__html:o}})}var ai=function(e){Object(ne.a)(n,e);var t=Object(re.a)(n);function n(){return Object(ee.a)(this,n),t.apply(this,arguments)}return Object(te.a)(n,[{key:"render",value:function(){var e=this.props.theme;return Object(J.jsx)("div",{children:Object(J.jsxs)("div",{className:"p-grid",children:[Object(J.jsx)("div",{className:"p-col-4",children:"T\xedtulo"}),Object(J.jsx)("div",{className:"p-col-8",children:e.title})]})})}}]),n}(z.a.Component),oi=ai;function ci(e){return!["GROUP"].includes(e.type)}var si={layer_has_attributes:ci};function li(e){var t,n,r=e.config,i=r.layer,a=r.dispatch,o=r.actions,c=r.models.Utils,s=c.getWindowSize,l=c.showOnPortal,u=Object(H.useState)(!1),d=Object(X.a)(u,2),p=d[0],f=d[1],j=s()[0]<=768,h=(null===i||void 0===i||null===(t=i.datatable)||void 0===t?void 0:t.target)||(null===e||void 0===e||null===(n=e.config)||void 0===n?void 0:n.target);return i&&i.exclude_components&&i.exclude_components.includes("LayerAttributesTable")?null:i&&i.datatable&&h&&ci(i)?Object(J.jsxs)(z.a.Fragment,{children:[" ",Object(J.jsx)(bt.a,{icon:"pi pi-table",title:"Tabela de atributos",color:"blue",className:"p-button-sm p-button-rounded p-button-text tool",onClick:function(e){a(o.searchlayers_set_layer(h,i)),a(o.viewer_set_selectedmenu(h))}}),l(Object(J.jsx)(vt.a,{header:"Tabela de Atributos",visible:!!p,style:{width:j?"90%":"50vw"},modal:!0,onHide:function(e){return f(!1)},children:Object(J.jsx)(oi,{theme:p})}))]}):null}var ui=n(137),di=[{value:"geojson",title:"GeoJSON",icon:"pi pi-file",tooltip:"Exportar para ficheiro GeoJSON",outputFormat:"application/json"},{value:"gml",title:"GML",icon:"pi pi-file",tooltip:"Exportar para ficheiro GML",outputFormat:"text/xml; subtype=gml/2.1.2"},{value:"shape",title:"ShapeFile",icon:"pi pi-file",tooltip:"Exportar para ficheiro ShapeFile",outputFormat:"SHAPE-ZIP"},{value:"kml",title:"KML",icon:"pi pi-file",tooltip:"Exportar para ficheiro KML",outputFormat:"application/vnd.google-earth.kml+xml"}];function pi(e){e.core;var t=e.config,n=e.record,r=t.viewer,i=t.layer,a=(t.actions,t.mainMap),o=t.models,c=o.Utils.showOnPortal,s=Object(H.useState)(!1),l=Object(X.a)(s,2),u=l[0],d=l[1],p=Object(H.useState)(null),f=Object(X.a)(p,2),j=f[0],h=f[1],b=Object(H.useRef)(null),m=n.config_json,g=[].concat(di);i&&i.exclude_export_formats&&i.exclude_export_formats.length?g=di.filter((function(e){return!i.exclude_export_formats.includes(e.value)})):m&&m.exclude_export_formats&&m.exclude_export_formats.length?g=di.filter((function(e){return!m.exclude_export_formats.includes(e.value)})):r&&r.config_json&&r.config_json.exclude_export_formats&&(g=di.filter((function(e){return!r.config_json.exclude_export_formats.includes(e.value)})));var v=null;i&&i.download&&i.download.link&&(v=Object(Y.a)({},i.download.link));var O=null;i&&i.download&&i.download.external&&(O=Object(Y.a)({},i.download.external));var _=null;function x(e,t){h(t);var i=o.Utils.findOlLayer(a,e.id);if(!i)return null;var c,s=n?n.config_json:null,l=null;if(l=s&&s.export_crs?s.export_crs:r.config_json&&r.config_json.export_crs?r.config_json.export_crs:r.config_json&&r.config_json.display_crs?r.config_json.display_crs:4326,!(c=i.getSource().getFeatures())||!c.length)return null;var u=new le.a,p={dataProjection:"EPSG:"+l,featureProjection:a.getView().getProjection().getCode()},f=u.writeFeaturesObject(c,p),j={type:"name",properties:{name:"urn:ogc:def:crs:EPSG::"+l}};f.crs=j;var m=JSON.stringify(f);"geojson"==t?function(e,t,n){var r=document.createElement("a");r.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),r.setAttribute("download",e+"."+n),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r)}("export",m,t):b.current.show({severity:"warn",summary:"Descarregar Tema",detail:"Formato n\xe3o suportado",life:3e3}),d(!1)}if(i&&i.download&&i.datasource&&(_=Object(Y.a)({},i.download.datasource)),i&&i.exclude_components&&i.exclude_components.includes("LayerDownload"))return null;if((!g||!g.length)&&!v&&!O&&!_)return null;var y=["WFS","KML","GML","GeoJSON"].includes(i.type);return(v||O||_)&&(y=!0),Object(J.jsxs)("div",{children:[c(Object(J.jsx)(ui.a,{ref:b,position:"top-right"})),y&&Object(J.jsxs)("div",{className:"p-grid",children:[Object(J.jsx)("div",{className:"p-col-4",children:"Descarregar"}),Object(J.jsxs)("div",{className:"p-col-8",children:[v&&Object(J.jsx)(bt.a,{className:"p-button-sm p-mr-2 p-mb-2",icon:u&&"link"==j?"pi pi-spin pi-spinner":"pi pi-external-link pi",label:v.label||"Abrir",onClick:function(e){return function(e,t){var n=document.createElement("a");n.setAttribute("href",t),n.setAttribute("target","_blank"),n.setAttribute("download",t),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}(v.filename,v.url)},disabled:u}),O&&Object(J.jsx)(bt.a,{className:"p-button-sm p-mr-2 p-mb-2",icon:u&&"external"==j?"pi pi-spin pi-spinner":"pi pi-external-link pi",label:O.label||"Abrir",onClick:function(e){return window.open(O.url,"_blank")},disabled:u}),_?g.map((function(e){return Object(J.jsx)(bt.a,{className:"p-button-sm p-mr-2 p-mb-2",icon:u&&j==e.value?"pi pi-spin pi-spinner":"pi pi-file pi",label:e.title,onClick:function(t){return function(e,t){var n=null;m&&m.export_crs?n=m.export_crs:r.config_json&&r.config_json.export_crs?n=r.config_json.export_crs:r.config_json&&r.config_json.display_crs&&(n=r.config_json.display_crs),n&&(n="EPSG:"+n);var i=["SERVICE=WFS","REQUEST=GetFeature","VERSION="+(_.version||"2.0.0"),"typeNames="+_.typeNames,"srsName="+(_.crs||n||"EPSG:4326"),"outputFormat="+(t||"application/json")];_.count&&i.push("count="+_.count),_.bbox&&i.push("bbox="+_.bbox.join(",")),_.cqlFilter&&i.push("cql_filter="+_.cqlFilter),_.propertyName&&i.push("propertyName="+_.propertyName);var a=_.url+i.join("&");window.open(a,"_blank")}(0,e.outputFormat)},disabled:u})})):g.map((function(e){return Object(J.jsx)(bt.a,{className:"p-button-sm p-mr-2 p-mb-2",icon:u&&j==e.value?"pi pi-spin pi-spinner":"pi pi-file pi",label:e.title,onClick:function(t){return n=i,r=e.value,void(["WFS","KML","GML","DXF","GeoJSON"].includes(n.type)?x(n,r):alert("Formato n\xe3o suportado"));var n,r},disabled:u})}))]})]})]})}var fi=n(563),ji=function(e){Object(ne.a)(n,e);var t=Object(re.a)(n);function n(e){var r;return Object(ee.a)(this,n),(r=t.call(this,e)).state={edit:e.edit,showAdvanceOptions:!1},null==e.edit.selectable&&r.editField("selectable",!0),r}return Object(te.a)(n,[{key:"editField",value:function(e,t){var n=this.state.edit;n[e]=t,this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{edit:n}))}},{key:"convertToRGBAString",value:function(e){var t=e.split(",");return"rgba(".concat(t[0],", ").concat(t[1],", ").concat(t[2],", ").concat(t[3],")")}},{key:"convertToRGBA",value:function(e){var t=e.split(",");return{r:t[0],g:t[1],b:t[2],a:t[3]}}},{key:"convertToRGB",value:function(e){var t=e.split(",");return{r:t[0],g:t[1],b:t[2]}}},{key:"convertToRGBString",value:function(e){return[e.r,e.g,e.b,1].join(",")}},{key:"render",value:function(){var e=this,t=this.state,n=t.edit,r=t.showAdvanceOptions;if(!n)return null;var i=[],a=[],o=[{key:999,value:"",label:"N\xe3o Especificado"}],c=[],s=[],l=[{key:999,value:"",label:"N\xe3o Especificado"}];if("WMS"===n.type){var u=n.get_map_formats||"",d=n.get_feature_info_formats||"",p=n.wms_styles||"";i=u.split(",").map((function(e,t){return{key:t,value:e,label:e}})),a=d.split(",").map((function(e,t){return{key:t,value:e,label:e}})),p.split(",").forEach((function(e,t){return o.push({key:t,value:e,label:e}),e}))}if(["WMTS","WMTSXYZ"].includes(n.type)){var f=n.wmts_formats||"",j=n.get_feature_info_formats||"",h=n.wmts_styles||"";c=f.split(",").filter((function(e){return e&&-1!==e.toLowerCase().indexOf("image/")})).map((function(e,t){return{key:t,value:e,label:e}})),s=j.split(",").map((function(e,t){return{key:t,value:e,label:e}})),h.split(",").forEach((function(e,t){return l.push({key:t,value:e,label:e}),e}))}return Object(J.jsxs)("div",{children:[Object(J.jsxs)("div",{className:"p-fluid",children:[Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{className:"p-col-12 p-md-4",children:"T\xedtulo"}),Object(J.jsx)("div",{className:"p-col-12 p-md-8",children:Object(J.jsx)(jt.a,{value:n.title,placeholder:"T\xedtulo",onChange:function(t){return e.editField("title",t.target.value)},onClick:function(e){return e.target.select()}})})]}),Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{className:"p-col-12 p-md-4",children:"Descri\xe7\xe3o"}),Object(J.jsx)("div",{className:"p-col-12 p-md-8",children:Object(J.jsx)(ht.a,{value:n.description,placeholder:"Descri\xe7\xe3o",style:{width:"100%",padding:".67857143em 1em",border:"1px solid rgba(34,36,38,.15)"},rows:"5",onChange:function(t){return e.editField("description",t.target.value)},onClick:function(e){return e.target.select()}})})]}),["GeoJSON","KML","WMS","WFS","ArcGISMap"].includes(n.type)?Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{className:"p-col-12 p-md-4",children:"Selecionar Elementos"}),Object(J.jsx)("div",{className:"p-col-12 p-md-8",children:Object(J.jsx)(gt.a,{checked:n.selectable,onChange:function(t){return e.editField("selectable",!n.selectable)}})})]}):null,["WMTS","WMTSXYZ"].includes(n.type)&&n.get_feature_info_formats?Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{className:"p-col-12 p-md-4",children:"Selecionar Elementos"}),Object(J.jsx)("div",{className:"p-col-12 p-md-8",children:Object(J.jsx)(gt.a,{checked:n.selectable,onChange:function(t){return e.editField("selectable",!n.selectable)}})})]}):null,"WMS"===n.type?Object(J.jsx)(z.a.Fragment,{children:Object(J.jsxs)("div",{children:[Object(J.jsx)("p",{style:{textAlign:"right"},children:Object(J.jsxs)("a",{style:{cursor:"pointer"},onClick:function(t){return e.setState(Object(Y.a)(Object(Y.a)({},e.state),{},{showAdvanceOptions:!r}))},children:["Op\xe7\xf5es Avan\xe7adas"," ",Object(J.jsx)("i",{className:r?"pi pi-angle-up":"pi pi-angle-down"})]})}),r&&Object(J.jsxs)("div",{className:"p-pb-2",children:[Object(J.jsxs)("div",{className:"p-pt-2",children:[Object(J.jsx)("label",{children:"Formato de GetMap"}),Object(J.jsx)(nr.a,{placeholder:"Escolha o Formato de GetMap",options:i,value:n.get_map_format||"",onChange:function(t){var n=t.value;return e.editField("get_map_format",n)}})]}),Object(J.jsxs)("div",{className:"p-pt-2",children:[Object(J.jsx)("label",{children:"Formato de GetFeatureInfo"}),Object(J.jsx)(nr.a,{placeholder:"Escolha o formato de GetFeatureInfo",options:a,value:n.get_feature_info_format||"",onChange:function(t){var n=t.value;return e.editField("get_feature_info_format",n)}})]}),Object(J.jsxs)("div",{className:"p-pt-2",children:[Object(J.jsx)("label",{children:"Estilo"}),Object(J.jsx)(nr.a,{placeholder:"Escolha o estilo",options:o,value:n.wms_style||"",onChange:function(t){var n=t.value;return e.editField("wms_style",n)}})]})]})]})}):null,["WMTS","WMTSXYZ"].includes(n.type)?Object(J.jsx)(z.a.Fragment,{children:Object(J.jsxs)("div",{children:[Object(J.jsx)("p",{style:{textAlign:"right"},children:Object(J.jsxs)("a",{style:{cursor:"pointer"},onClick:function(t){return e.setState(Object(Y.a)(Object(Y.a)({},e.state),{},{showAdvanceOptions:!r}))},children:["Op\xe7\xf5es Avan\xe7adas"," ",Object(J.jsx)("i",{className:r?"pi pi-angle-up":"pi pi-angle-down"})]})}),r&&Object(J.jsxs)("div",{className:"p-pb-2",children:[Object(J.jsxs)("div",{className:"p-pt-2",children:[Object(J.jsx)("label",{children:"Formato de GetTile"}),Object(J.jsx)(nr.a,{placeholder:"Escolha o Formato de GetTile",options:c,value:n.wmts_format||"",onChange:function(t){var n=t.value;return e.editField("wmts_format",n)}})]}),Object(J.jsxs)("div",{className:"p-pt-2",children:[Object(J.jsx)("label",{children:"Formato de GetFeatureInfo"}),Object(J.jsx)(nr.a,{placeholder:"Escolha o formato de GetFeatureInfo",options:s,value:n.get_feature_info_format||"",onChange:function(t){var n=t.value;return e.editField("get_feature_info_format",n)}})]}),Object(J.jsxs)("div",{className:"p-pt-2",children:[Object(J.jsx)("label",{children:"Estilo"}),Object(J.jsx)(nr.a,{placeholder:"Escolha o estilo",options:l,value:n.wmts_style||"",onChange:function(t){var n=t.value;return e.editField("wmts_style",n)}})]})]})]})}):null,["GeoJSON","WFS","KML"].includes(n.type)?Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{className:"p-col-12 p-md-4",children:"C\xf4r de Preenchimento"}),Object(J.jsx)("div",{className:"p-col-12 p-md-4",children:Object(J.jsx)(fi.a,{format:"rgb",value:n.style_color?this.convertToRGB(n.style_color):null,onChange:function(t){var n=t.value;return e.editField("style_color",e.convertToRGBString(n))}})}),Object(J.jsx)("div",{className:"p-col-12 p-md-4",children:Object(J.jsx)(jt.a,{placeholder:"C\xf4r de preenchimento",value:n.style_color?this.convertToRGBAString(n.style_color):null})})]}),Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{className:"p-col-12 p-md-4",children:"C\xf4r de Rebordo"}),Object(J.jsx)("div",{className:"p-col-12 p-md-4",children:Object(J.jsx)(fi.a,{format:"rgb",value:n.style_stroke_color?this.convertToRGB(n.style_stroke_color):null,onChange:function(t){var n=t.value;return e.editField("style_stroke_color",e.convertToRGBString(n))}})}),Object(J.jsx)("div",{className:"p-col-12 p-md-4",children:Object(J.jsx)(jt.a,{placeholder:"C\xf4r de Rebordo",value:n.style_stroke_color?this.convertToRGBAString(n.style_stroke_color):null})})]}),Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{className:"p-col-12 p-md-4",children:"Espessura do Rebordo"}),Object(J.jsx)("div",{className:"p-col-12 p-md-8",children:Object(J.jsx)(jt.a,{type:"number",min:"0",value:n.style_stroke_width,placeholder:"Espessura do Rebordo",onChange:function(t){return e.editField("style_stroke_width",t.target.value)}})})]})]}):null]}),Object(J.jsx)("div",{className:"p-dialog-myfooter",children:Object(J.jsx)(bt.a,{color:"green",icon:"pi pi-check",label:"Aplicar",onClick:function(t){return e.props.onSave(t,n)}})})]})}}]),n}(z.a.Component);function hi(e){var t=e.config,n=t.layer,r=t.actions,i=t.models.Utils,a=i.getWindowSize,o=i.showOnPortal,c=Object(H.useState)(!1),s=Object(X.a)(c,2),l=s[0],u=s[1],d=a()[0]<=768;return n&&n.exclude_components&&n.exclude_components.includes("LayerEdit")?null:Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsx)(bt.a,{icon:"pi pi-pencil",title:"Personalizar Tema",color:"green",className:"p-button-sm p-button-rounded p-button-text tool",onClick:function(e){return u(n)}}),o(Object(J.jsx)(vt.a,{header:"Personalizar Tema",visible:!!l,style:{width:d?"90%":"50vw"},modal:!0,onHide:function(e){return u(!1)},children:Object(J.jsx)(ji,{edit:l,onSave:function(e,t){u(!1),r.applyThemeChanges(t)}})}))]})}var bi=function(e){Object(ne.a)(n,e);var t=Object(re.a)(n);function n(){return Object(ee.a)(this,n),t.apply(this,arguments)}return Object(te.a)(n,[{key:"getTypeDescription",value:function(e){switch(e){case"OSM":return"Open Street Map";case"BING":return"Bing Maps";case"WMS":return"Web Map Service";case"WFS":return"Web Feature Service";case"ArcGISMap":return"ArcGIS REST - Map Service";case"KML":return"Keyhole Markup Language";case"GeoJSON":return"GeoJSON";case"GROUP":return"Grupo";default:return e}}},{key:"render",value:function(){var e=this.props,t=e.viewer,n=e.mainMap,r=e.core,i=e.theme,a=e.actions,o=e.models;return Object(J.jsxs)("div",{children:[Object(J.jsxs)("div",{className:"p-grid",children:[Object(J.jsx)("div",{className:"p-col-4",children:"T\xedtulo"}),Object(J.jsx)("div",{className:"p-col-8",children:i.title})]}),i.description?Object(J.jsxs)("div",{className:"p-grid",children:[Object(J.jsx)("div",{className:"p-col-4",children:"Descri\xe7\xe3o"}),Object(J.jsx)("div",{className:"p-col-8",children:i.description})]}):null,i.metadata&&i.metadata.url?Object(J.jsxs)("div",{className:"p-grid",children:[Object(J.jsx)("div",{className:"p-col-4",children:"Metadados"}),Object(J.jsx)("div",{className:"p-col-8",children:Object(J.jsxs)("a",{href:i.metadata.url,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none"},children:[Object(J.jsx)("i",{className:"pi pi-external-link p-mr-2"}),"Abrir Ficha"]})})]}):null,i.metadata&&i.metadata.data?i.metadata.data.map((function(e){return Object(J.jsxs)("div",{className:"p-grid",children:[Object(J.jsx)("div",{className:"p-col-4",children:e.title||e.name}),Object(J.jsx)("div",{className:"p-col-8",children:(t=e,"html"===t.type?Object(J.jsx)("div",{dangerouslySetInnerHTML:{__html:t.value}}):"hyperlink"===t.type?Object(J.jsxs)("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none"},children:[Object(J.jsx)("i",{className:"pi pi-external-link p-mr-2"}),t.value||t.url]}):t.value||"")})]});var t})):null,!0!==i.exclude_service_metadata?Object(J.jsxs)(J.Fragment,{children:[Object(J.jsxs)("div",{className:"p-grid",children:[Object(J.jsx)("div",{className:"p-col-4",children:"Tipo"}),Object(J.jsx)("div",{className:"p-col-8",children:this.getTypeDescription(i.type)})]}),["GROUP"].includes(i.type)?null:Object(J.jsxs)("div",{className:"p-grid",children:[Object(J.jsx)("div",{className:"p-col-4",children:"URL"}),Object(J.jsx)("div",{className:"p-col-8",style:{wordBreak:"break-all"},children:i.url})]}),["GROUP","ArcGISMap"].includes(i.type)?null:Object(J.jsxs)("div",{className:"p-grid",children:[Object(J.jsx)("div",{className:"p-col-4",children:"Sistema de Coordenadas"}),Object(J.jsx)("div",{className:"p-col-8",children:i.crs_options?Object(J.jsx)("ul",{children:i.crs_options.split(",").map((function(e,t){return Object(J.jsx)("li",{children:e},t)}))}):i.crs?Object(J.jsx)("ul",{children:Object(J.jsx)("li",{children:"EPSG:".concat(i.crs)})}):null})]}),["WMS"].includes(i.type)?Object(J.jsxs)("div",{className:"p-grid",children:[Object(J.jsx)("div",{className:"p-col-4",children:"Formatos de GetMap"}),Object(J.jsx)("div",{className:"p-col-8",children:i.get_map_formats?Object(J.jsx)("ul",{children:i.get_map_formats.split(",").map((function(e,t){return Object(J.jsx)("li",{children:e},t)}))}):null})]}):null,["WMS"].includes(i.type)?Object(J.jsxs)("div",{className:"p-grid",children:[Object(J.jsx)("div",{className:"p-col-4",children:"Formatos de GetFeatureInfo"}),Object(J.jsx)("div",{className:"p-col-8",children:i.get_feature_info_formats?Object(J.jsx)("ul",{children:i.get_feature_info_formats.split(",").map((function(e,t){return Object(J.jsx)("li",{children:e},t)}))}):null})]}):null]}):null,r.renderComponents({region:"theme_info_tools",props:{layer:i,actions:a,viewer:t,mainMap:n,models:o},separator:" "})]})}}]),n}(z.a.Component),mi=bi;function gi(e){var t=e.core,n=e.config,r=n.layer,i=n.viewer,a=n.mainMap,o=n.actions,c=n.models,s=c.Utils,l=s.getWindowSize,u=s.showOnPortal,d=Object(H.useState)(!1),p=Object(X.a)(d,2),f=p[0],j=p[1],h=l()[0]<=768;return r&&r.exclude_components&&r.exclude_components.includes("LayerMetadata")?null:Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsx)(bt.a,{icon:"pi pi-info-circle",title:"Informa\xe7\xe3o de Metadados",color:"blue",className:"p-button-sm p-button-rounded p-button-text tool",onClick:function(e){return j(r)}}),u(Object(J.jsx)(vt.a,{header:"Informa\xe7\xe3o do Tema",visible:!!f,style:{width:h?"90%":"50vw"},modal:!0,onHide:function(e){return j(!1)},children:Object(J.jsx)(mi,{viewer:i,mainMap:a,core:t,models:c,theme:f,downloadTheme:function(e){return o.downloadTheme(e)}})}))]})}var vi=n(805);function Oi(e){var t=e.config,n=t.layer,r=t.actions;t.except;return n&&n.exclude_components&&n.exclude_components.includes("LayerOpacity")?null:Object(J.jsx)("div",{title:"Definir Transpar\xeancia",className:"toc-slider-wrapper",children:Object(J.jsx)(vi.a,{discrete:!0,color:"red",min:1,max:100,value:100*n.opacity,onChange:function(e){return r.opacity(e,n,e.value)}})})}function _i(e){var t=e.config,n=t.layer,r=t.actions,i=Object(H.useState)(!1),a=Object(X.a)(i,2),o=a[0],c=a[1];return n&&n.exclude_components&&n.exclude_components.includes("LayerRemove")?null:Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsx)(bt.a,{icon:"pi pi-times-circle",title:"Remover Tema",color:"red",className:"p-button-sm p-button-rounded p-button-text tool",onClick:function(e){return c([n.id])}}),Object(J.jsx)(vt.a,{header:"Confirmar",visible:!!o,modal:!0,style:{width:"350px"},footer:Object(J.jsxs)("div",{children:[Object(J.jsx)(bt.a,{label:"N\xe3o",icon:"pi pi-times",onClick:function(){return c(!1)},className:"p-button-text"}),Object(J.jsx)(bt.a,{label:"Sim",icon:"pi pi-check",onClick:function(){r.removeThemes(o),c(!1)},autoFocus:!0})]}),onHide:function(){return c(!1)},children:Object(J.jsxs)("div",{className:"confirmation-content",children:[Object(J.jsx)("i",{className:"pi pi-exclamation-triangle p-mr-3",style:{fontSize:"2rem"}}),Object(J.jsx)("span",{children:"Tem a certeza?"})]})})]})}var xi,yi,wi,Ei,Si=n(364),Pi=n(307),Ai=n(452),Ci=n(422),Ti=n(373),Ri=n(702);n(1187);function Ni(e){var t=e.viewer,n=e.mainMap,r=e.core,i=e.dispatch,a=e.actions,o=e.record,c=t.exclusive_mapcontrol,s=t.config_json.map_controls.find((function(e){return"Coordinates"===e.id})),l=!!s&&s.active,u=t.config_json.map_controls.find((function(e){return"FeatureInfo"===e.id})),d=!!u&&u.active,p=t.config_json.map_controls.find((function(e){return"GeoLocation"===e.id})),f=!!p&&p.active,j=!!p&&p.tracking,h=t.config_json.components.find((function(e){return e.config_json&&"GeoLocation"===e.config_json.map_control})),b=a.viewer_update_mapcontrol,m=a.viewer_set_selectedmenu,g=a.viewer_set_exclusive_mapcontrol,v=Object(H.useState)(!1),O=Object(X.a)(v,2),_=O[0],x=O[1],y=Object(H.useState)(!1),w=Object(X.a)(y,2),E=w[0],S=w[1];function P(e){return"Coordinates"===e?s&&s.show_button?Object(J.jsx)(bt.a,{title:s.title||"Obter coordenadas",icon:"fas fa-bullseye",className:"Coordinates"===c?"p-button-rounded p-button-raised active":"p-button-rounded p-button-raised",onClick:function(e){e.currentTarget.blur(),function(){var e=!l;i(b(Object(Y.a)(Object(Y.a)({},s),{},{active:e}))),e?(i(m("coordinates")),i(g("Coordinates"))):i(g(null))}()}},e):null:"FeatureInfo"===e?u&&u.show_button?Object(J.jsx)(bt.a,{title:u.title||"Identificar elementos",icon:"pi pi-info-circle",className:"FeatureInfo"===c?"p-button-rounded p-button-raised active":"p-button-rounded p-button-raised",onClick:function(e){e.currentTarget.blur(),function(){var e=!d;i(b(Object(Y.a)(Object(Y.a)({},u),{},{active:e}))),e?(i(m("featureinfo")),i(g("FeatureInfo"))):i(g(null))}()}},e):null:"GeoLocation"===e&&p&&p.show_button&&window.navigator.geolocation?Object(J.jsxs)("div",{className:"map-controls-geolocation",onMouseOver:function(e){S(!0)},onMouseLeave:function(e){S(!1)},children:[Object(J.jsx)(bt.a,{title:p.title||"A minha localiza\xe7\xe3o",icon:"pi pi-globe",className:f?"p-button-rounded p-button-raised active":"p-button-rounded p-button-raised",onClick:function(e){e.currentTarget.blur(),function(){var e=!f;i(b(Object(Y.a)(Object(Y.a)({},p),{},{active:e}))),e&&h&&i(m("geolocation"))}()}}),Object(J.jsxs)("div",{className:"btn-geolocation-options",style:f&&E?{}:{display:"none"},onMouseLeave:function(e){S(!1)},children:[Object(J.jsx)("input",{type:"checkbox",onClick:function(e){!function(e){var t=e;i(b(Object(Y.a)(Object(Y.a)({},p),{},{tracking:t})))}(e.currentTarget.checked)},checked:j}),Object(J.jsx)("label",{children:" Atualizar posi\xe7\xe3o"})]})]},e):null}return Object(H.useEffect)((function(){var e=document.createElement("span");e.classList.add("pi","pi-window-maximize","p-c");var r={label:e,tipLabel:"Ver extens\xe3o total"};t&&t.config_json&&t.config_json.full_extent?(r.extent=t.config_json.full_extent,wi=new Si.a(r)):wi=new Si.a(r);var i={attribution:!1};return t.config_json.exclude_map_controls&&t.config_json.exclude_map_controls.length>0&&t.config_json.exclude_map_controls.forEach((function(e){i[e]=!1})),xi=Object(Ti.a)(i),t.config_json.exclude_map_controls&&t.config_json.exclude_map_controls.length>0?(t.config_json.exclude_map_controls.includes("fullscreen")||(xi=xi.extend([new Ri.a])),t.config_json.exclude_map_controls.includes("zoomtoextent")||(xi=xi.extend([wi]))):xi=Object(Ti.a)(i).extend([new Ri.a,wi]),xi.forEach((function(e){return n.addControl(e)})),Ei=new Pi.a,yi=Object(Ai.a)({altShiftDragRotate:!1,pinchRotate:!1}),t.config_json.exclude_map_controls&&t.config_json.exclude_map_controls.length>0&&(t.config_json.exclude_map_controls.includes("rotate")||(yi=yi.extend([new Ci.a({condition:function(e){return e.originalEvent.ctrlKey}})]))),(yi=yi.extend([Ei])).forEach((function(e){return n.addInteraction(e)})),Ei.on("boxend",(function(e){var t=Ei.getGeometry();n.getView().fit(t),x(!1)})),function(){Ei&&n.removeInteraction(Ei),wi&&n.removeControl(wi)}}),[]),Ei&&Ei.setActive(_),Object(J.jsxs)("div",{id:"map-controls",className:"map-controls",children:[t.config_json.map_controls.map((function(e){return P(e.type)})),r.renderComponents({region:"map_tools",props:{core:r,actions:a,viewer:t,dispatch:i,mainMap:n},separator:" ",parent:o})]})}function ki(e){e.className,e.config,e.actions,e.record;return z.a.Fragment}function Ii(e){var t=e.core,n=e.as,r=e.config,i=e.record,a=r.actions,o=r.mainMap,c=r.viewer,s=r.dispatch;function l(){return Object(J.jsx)("div",{title:"Ferramentas do Mapa",children:Object(J.jsx)(Ni,{core:t,viewer:c,actions:a,dispatch:s,mainMap:o,record:i})})}return"panel"===n?Object(J.jsx)(Fn.a,{header:"Ferramentas do Mapa",children:l()}):l()}n(1188);function Mi(e){var t=e.config,n=(e.actions,t.viewer),r=t.mainMap,i=(t.dispatch,t.Models.MapModel),a=i.getResolutionForScale,o=i.getScaleForResolution,c=Object(H.useState)(!1),s=Object(X.a)(c,2),l=s[0],u=s[1],d=Object(H.useState)(""),p=Object(X.a)(d,2),f=p[0],j=p[1];return Object(H.useEffect)((function(){if(r){var e=r.getView().getResolution(),t=o(e,"m");j("1:"+t)}}),[n]),Object(J.jsx)("div",{className:"mapscale-input",children:Object(J.jsx)(jt.a,{value:f,onChange:function(e){return function(e){var t=e.target.value;j(t),u(!0)}(e)},onKeyUp:function(e){return function(e){if(13===(e.which||e.keyCode)){var t=""+f,n=""+f;if(n.indexOf(":")&&(t=t.substr(n.indexOf(":")+1)),!/\D/.test(t)&&(t=parseInt(t,10),!isNaN(t))){var i=a(t,"m");u(!1),r.getView().setResolution(i)}}}(e)},onBlur:function(e){l&&u(!1)}})})}var Li=n(423);n(1189);function Fi(e){var t=e.config,n=(e.actions,t.viewer,t.mainMap),r=(t.dispatch,t.Models.MapModel),i=(r.getResolutionForScale,r.getScaleForResolution,Object(H.useState)(null)),a=Object(X.a)(i,2),o=(a[0],a[1]);return Object(H.useEffect)((function(){if(n){var e=new Li.a({target:document.getElementById("mapscale-line")});n.addControl(e),o(e)}}),[]),Object(J.jsx)("div",{className:"mapscale-line",children:Object(J.jsx)("div",{id:"mapscale-line"})})}var Ui="MAPTOOLS_SET_SELECTEDCONTROL";var Gi={MAPTOOLS_SET_SELECTEDCONTROL:Ui,maptools_set_selectedcontrol:function(e){return{type:Ui,selected_control:e}}},Di=n(806),Vi=n(310),Wi=n(807),Hi=n(246),zi=n(85),Ki=(n(1190),function(e){Object(ne.a)(n,e);var t=Object(re.a)(n);function n(e){var r;Object(ee.a)(this,n),(r=t.call(this,e)).state={helpModal:!1,helpLengthShowed:!1,helpAreaShowed:!1,control:e.selected_control||"",length:0,area:0},r.drawingsStyle=new ue.c({fill:new pe.a({color:"rgba(255, 255, 255, 0.2)"}),stroke:new fe.a({color:"#ffcc33",width:2})}),r.drawStyle=new ue.c({fill:new pe.a({color:"rgba(255, 255, 255, 0.2)"}),stroke:new fe.a({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new de.a({radius:5,stroke:new fe.a({color:"rgba(0, 0, 0, 0.7)"}),fill:new pe.a({color:"rgba(255, 255, 255, 0.2)"})})}),r.sketch=null,r.helpTooltipElement=null,r.helpTooltip=null,r.measureTooltipElement=null,r.measureTooltip=null;return r.pointerMoveHandler=function(e){if(!e.dragging){var t="Clique para come\xe7ar a desenhar";if(r.sketch){var n=r.sketch.getGeometry();n instanceof Vt.b?t="Clique para continuar a desenhar o pol\xedgono":n instanceof zi.a&&(t="Clique para continuar a desenhar a linha")}r.helpTooltipElement.innerHTML=t,r.helpTooltip.setPosition(e.coordinate),r.helpTooltipElement.classList.remove("hidden")}},r.onMouseOutViewport=function(){r.helpTooltipElement.classList.add("hidden")},r.formatLength=function(e){var t,n,r,i=this,a=Hi.c(e,{projection:this.props.mainMap.getView().getProjection().getCode()});if(this.props.record.config_json&&this.props.record.config_json.crs&&this.props.viewer.config_json.crs_list){var o=this.props.viewer.config_json.crs_list.find((function(e){return e.srid===i.props.record.config_json.crs}));if(o)a=e.clone().transform(this.props.mainMap.getView().getProjection().getCode(),o.code).getLength()}var c=a;if(null!==(t=this.props.record)&&void 0!==t&&null!==(n=t.config_json)&&void 0!==n&&null!==(r=n.length)&&void 0!==r&&r.format){var s=this.props.record.config_json.length.format;s.source_unit&&s.output_unit&&(c=Object(Wr.a)(a,s.source_unit).toNumeric(s.output_unit)),s.options&&(c=c.toLocaleString(s.locale||"en-US",s.options),!1!==s.options.useGrouping&&(c=c.replace(/,/g," "))),s.expression&&(c=s.expression.replace("{value}",c))}else c=a>1e4?Math.round(a/1e3*1e3)/1e3+" km":Math.round(1e3*a)/1e3+" m";return c},r.formatArea=function(e){var t,n,r,i=this,a=Hi.a(e,{projection:this.props.mainMap.getView().getProjection().getCode()});if(this.props.record.config_json&&this.props.record.config_json.crs&&this.props.viewer.config_json.crs_list){var o=this.props.viewer.config_json.crs_list.find((function(e){return e.srid===i.props.record.config_json.crs}));if(o)a=e.clone().transform(this.props.mainMap.getView().getProjection().getCode(),o.code).getArea()}var c=a;if(null!==(t=this.props.record)&&void 0!==t&&null!==(n=t.config_json)&&void 0!==n&&null!==(r=n.area)&&void 0!==r&&r.format){var s=this.props.record.config_json.area.format;s.source_unit&&s.output_unit&&(c=Object(Wr.a)(a,s.source_unit).toNumeric(s.output_unit)),s.options&&(c=c.toLocaleString(s.locale||"en-US",s.options),!1!==s.options.useGrouping&&(c=c.replace(/,/g," "))),s.expression&&(c=s.expression.replace("{value}",c))}else c=a>1e5?Math.round(a/1e6*1e3)/1e3+" km2":Math.round(1e3*a)/1e3+" m2";return c},r.createHelpTooltip=function(){r.helpTooltipElement&&r.helpTooltipElement.parentNode.removeChild(r.helpTooltipElement),r.helpTooltipElement=document.createElement("div"),r.helpTooltipElement.className="tooltip hidden",r.helpTooltip=new Wi.a({element:r.helpTooltipElement,offset:[15,0],positioning:"center-left"}),r.olMap.addOverlay(r.helpTooltip)},r}return Object(te.a)(n,[{key:"componentDidMount",value:function(){if(this.props.mainMap){this.olMap=this.props.mainMap,this.draw=null;this.olMap.getLayers();this.vector=this.props.utils.findOlLayer(this.olMap,"userlayer"),this.vector&&(this.vector.setStyle(this.drawingsStyle),this.source=this.vector.getSource()),this.state.control&&this.addInteraction(this.state.control)}}},{key:"componentDidUpdate",value:function(e){var t=this;if(e.selected_control&&!this.props.selected_control){if(this.source)this.source.getFeatures().forEach((function(e){"maptools"===e.get("tool")&&t.source.removeFeature(e)}));this.olMap.removeInteraction(this.draw),this.olMap.un("pointermove",this.pointerMoveHandler),this.olMap.getViewport().removeEventListener("mouseout",this.onMouseOutViewport),this.helpTooltip&&this.helpTooltip.setPosition(null),this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{helpModal:!1,control:""}))}if(this.state.control&&"maptools"!==this.props.viewer.config_json.selected_menu){if(this.source)this.source.getFeatures().forEach((function(e){"maptools"===e.get("tool")&&t.source.removeFeature(e)}));this.olMap.removeInteraction(this.draw),this.olMap.un("pointermove",this.pointerMoveHandler),this.olMap.getViewport().removeEventListener("mouseout",this.onMouseOutViewport),this.helpTooltip&&this.helpTooltip.setPosition(null),this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{helpModal:!1,control:""}))}}},{key:"addInteraction",value:function(e){var t,n=this,r="area"===e?"Polygon":"LineString";this.draw=new Or.a({source:this.source,type:r,style:this.drawStyle}),this.olMap.addInteraction(this.draw),this.createHelpTooltip(),this.draw.on("drawstart",(function(e){n.source&&n.source.getFeatures().forEach((function(e){"maptools"==e.get("tool")&&n.source.removeFeature(e)}));n.sketch=e.feature,t=n.sketch.getGeometry().on("change",(function(e){var t,r=e.target;r instanceof Vt.b?(t=n.formatArea(r),n.setState(Object(Y.a)(Object(Y.a)({},n.state),{},{area:t}))):r instanceof zi.a&&(t=n.formatLength(r),n.setState(Object(Y.a)(Object(Y.a)({},n.state),{},{length:t})))}))}),this),this.draw.on("drawend",(function(e){e.feature.set("tool","maptools"),n.sketch=null,Object(Vi.b)(t)}),this),this.olMap.on("pointermove",this.pointerMoveHandler),this.olMap.getViewport().addEventListener("mouseout",this.onMouseOutViewport)}},{key:"changeMeasureControl",value:function(e){var t=this,n=this.props,r=n.actions,i=n.dispatch,a=this.state,o=a.control,c=a.helpLengthShowed,s=a.helpAreaShowed;if(this.olMap.removeInteraction(this.draw),this.olMap.un("pointermove",this.pointerMoveHandler),this.olMap.getViewport().removeEventListener("mouseout",this.onMouseOutViewport),this.helpTooltip&&this.helpTooltip.setPosition(null),o===e||!e){if(this.source)this.source.getFeatures().forEach((function(e){"maptools"==e.get("tool")&&t.source.removeFeature(e)}));return this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{helpModal:!1,control:""}),(function(){"MapTools"===t.props.viewer.exclusive_mapcontrol&&(i(r.viewer_set_exclusive_mapcontrol(null)),t.props.onControlSelect(null))}))}this.addInteraction(e);var l="length"===e&&!c||"area"===e&&!s;this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{helpModal:l,control:e}),(function(){i(r.viewer_set_exclusive_mapcontrol("MapTools")),t.props.onControlSelect(e)}))}},{key:"componentWillUnmount",value:function(){var e=this;this.source&&this.source.getFeatures().forEach((function(t){"maptools"===t.get("tool")&&e.source.removeFeature(t)}));this.sketch=null,this.olMap.un("pointermove",this.pointerMoveHandler),this.olMap.getViewport().removeEventListener("mouseout",this.onMouseOutViewport),this.helpTooltipElement&&this.helpTooltipElement.parentNode.removeChild(this.helpTooltipElement),this.helpTooltip&&this.olMap.removeOverlay(this.helpTooltip),this.olMap.removeInteraction(this.draw)}},{key:"closeHelp",value:function(){var e=this.state,t=e.control,n=e.helpLengthShowed,r=e.helpAreaShowed;this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{helpModal:!1,helpLengthShowed:"length"===t||n,helpAreaShowed:"area"===t||r}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.control,r=t.helpModal;return Object(J.jsxs)("div",{style:{height:"100%"},children:[Object(J.jsxs)("div",{id:"map-tools",className:"plugin-main p-p-2",children:[Object(J.jsx)(Di.a,{optionLabel:"name",optionValue:"key",value:n||"",options:[{key:"length",label:"Medir Dist\xe2ncia",icon:"pi pi-minus"},{key:"area",label:"Medir \xc1rea",icon:"fas fa-draw-polygon"}],onChange:function(t){return e.changeMeasureControl(t.value)},itemTemplate:function(e){return Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsx)("i",{className:e.icon,children:"\xa0"})," ",e.label]})}}),Object(J.jsxs)("div",{className:"p-my-2",children:["length"===n?Object(J.jsx)(jt.a,{fluid:!0,label:"Comprimento",value:this.state.length||"",placeholder:"Comprimento"}):null,"area"===n?Object(J.jsx)(jt.a,{fluid:!0,label:"\xc1rea",value:this.state.area||"",placeholder:"\xc1rea"}):null]})]}),Object(J.jsx)(vt.a,{header:"length"===n?"Medir Dist\xe2ncia":"Medir \xc1rea",visible:r,style:{width:"50vw"},modal:!0,footer:Object(J.jsx)(bt.a,{className:"p-button-info",icon:"pi pi-check",label:"OK",onClick:this.closeHelp.bind(this)}),onHide:function(t){return e.closeHelp()},children:Object(J.jsxs)("div",{children:["length"===n?Object(J.jsx)("div",{children:Object(J.jsxs)("p",{children:["1. para come\xe7ar a medi\xe7\xe3o clique no mapa na localiza\xe7\xe3o inicial",Object(J.jsx)("br",{}),"2. para medir um trajeto clique nas localiza\xe7\xf5es interm\xe9dias",Object(J.jsx)("br",{}),"3. para terminar fa\xe7a duplo-clique"]})}):null,"area"===n?Object(J.jsx)("div",{children:Object(J.jsxs)("p",{children:["1. para come\xe7ar a medi\xe7\xe3o clique no mapa numa localiza\xe7\xe3o inicial",Object(J.jsx)("br",{}),"2. continue clicando nas localiza\xe7\xf5es que definem a \xe1rea",Object(J.jsx)("br",{}),"3. para terminar fa\xe7a duplo-clique"]})}):null]})})]})}}]),n}(z.a.Component)),Bi=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return"MAPTOOLS_SET_SELECTEDCONTROL"===t.type?Object(Y.a)(Object(Y.a)({},e),{},{selected_control:t.selected_control}):e};function Yi(e){var t=e.className,n=e.config,r=e.actions,i=e.record,a=(i.config_json,i.title||"Ferramentas de Medi\xe7\xe3o");return Object(J.jsx)(bt.a,{title:a,className:t,icon:"fas fa-ruler",style:{margin:"0.5em 1em"},onClick:function(e){return n.dispatch(r.viewer_set_selectedmenu(i.id))}})}function qi(e){var t=e.type,n=e.region,r=e.as,i=e.config,a=e.actions,o=e.record,c=e.utils,s=e.Models,l=e.core,u=l.store.getState().maptools,d=i.dispatch,p=i.viewer,f=i.mainMap,j=p.config_json,h=j.selected_menu,b=(j.layers,(s?s.Utils:c).getWindowSize),m=o.config_json||{},g=o.title||"Ferramentas de Medi\xe7\xe3o",v=m.header||g,O=b()[0]<=768;if(Object(H.useEffect)((function(){Object.entries(Gi).forEach((function(t){var n=Object(X.a)(t,2),r=n[0],i=n[1];e.core.actions[r]||(e.core.actions[r]=i)})),"maptools"in e.core.store.reducerManager.getReducerMap()||e.core.store.reducerManager.add("maptools",Bi)}),[]),Object(H.useEffect)((function(){d("maptools"===h?a.viewer_set_exclusive_mapcontrol("MapTools"):a.maptools_set_selectedcontrol(null))}),[h]),"link"===t&&n===o.links){var _="MapTools"===(null===p||void 0===p?void 0:p.exclusive_mapcontrol)&&null!==u&&void 0!==u&&u.selected_control?"active":"";return Object(J.jsx)(bt.a,{title:g,icon:"fas fa-ruler",className:_?"p-button-rounded p-button-raised "+_:"p-button-rounded p-button-raised",onClick:function(e){d(a.viewer_set_selectedmenu(o.id)),d(a.layout_show_menu(!O))}})}return"panel"===r?Object(J.jsx)(Fn.a,{header:v,children:Object(J.jsx)("div",{className:"maptools",children:Object(J.jsx)(Ki,{onControlSelect:function(e){d(a.maptools_set_selectedcontrol(e))},viewer:p,core:l,actions:a,dispatch:d,mainMap:f,utils:c,record:o,selected_control:null===u||void 0===u?void 0:u.selected_control})})}):null}n(703);function Xi(e){var t=e.config,n=Object(H.useState)(null),r=Object(X.a)(n,2),i=r[0],a=r[1];return Object(H.useEffect)((function(){if(t.url){var e=t.url;fetch(e).then((function(e){return e.text()})).then((function(e){a(e)})).catch((function(e){a(t.html||"")}))}else a(t.html||"")}),[]),Object(J.jsx)("div",{dangerouslySetInnerHTML:{__html:i}})}function Ji(e){var t=e.className,n=e.config,r=e.actions,i=e.record,a=(n.viewer,n.dispatch,n.Models.Utils),o=a.getWindowSize,c=a.showOnPortal,s=Object(H.useState)(!1),l=Object(X.a)(s,2),u=l[0],d=l[1],p=i.config_json||{},f=i.title||"",j=p.header||f,h=o()[0]<=768;if("popup"===i.as){var b=p.closeLabel||"Fechar";return Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsx)(bt.a,{title:f,className:t,icon:"far fa-question-circle",style:{margin:"0.5em 1em"},onClick:function(e){return d(!0)}}),c(Object(J.jsx)(vt.a,{header:j,visible:u,style:{width:h?"90%":"35vw"},modal:!0,footer:Object(J.jsx)("div",{className:"p-grid",children:Object(J.jsx)("div",{className:"p-col",style:{textAlign:"right"},children:Object(J.jsx)(bt.a,{label:b,onClick:function(e){return d(!1)}})})}),onHide:function(e){return d(!1)},children:Object(J.jsx)(Xi,{config:p})}))]})}return Object(J.jsx)(bt.a,{title:f,className:t,icon:"far fa-question-circle",style:{margin:"0.5em 1em"},onClick:function(e){return n.dispatch(r.viewer_set_selectedmenu(i.id))}})}function Zi(e){var t=e.as,n=e.config,r=(e.actions,e.record),i=(n.viewer,n.dispatch,n.Models.Utils),a=i.getWindowSize,o=(i.showOnPortal,r.config_json||{}),c=r.title||"",s=o.header||c;a()[0];function l(){return Object(J.jsx)(Xi,{config:o})}return""===t?l():"panel"===t?Object(J.jsx)(Fn.a,{header:s,children:l()}):null}var $i=n(808),Qi=(n(1191),function(e,t){var n=function(n){e.current&&!e.current.contains(n.target)&&t()};Object(H.useEffect)((function(){return document.addEventListener("click",n),function(){document.removeEventListener("click",n)}}))});function ea(e){var t=e.core,n=e.config,r=e.actions,i=e.record,a=(n.viewer,n.mainMap),o=n.dispatch,c=n.Models.MapModel,s=Object(H.useState)(""),l=Object(X.a)(s,2),u=l[0],d=l[1],p=Object(H.useState)([]),f=Object(X.a)(p,2),j=f[0],h=f[1],b=Object(H.useState)([]),m=Object(X.a)(b,2),g=m[0],v=m[1],O=Object(H.useState)(null),_=Object(X.a)(O,2),x=_[0],y=(_[1],Object(H.useState)(!1)),w=Object(X.a)(y,2),E=w[0],S=w[1],P=Object(H.useRef)(),A=i.config_json||{};function C(e,t){var n=null,r=e.admin_level4||e.admin_level3||e.admin_level2||e.admin_level1||"";return t?(n=Object(J.jsxs)("div",{children:[Object(J.jsx)("i",{className:"pi ".concat(t||""," p-mr-2")})," ",Object(J.jsxs)("span",{children:[e.name," ",r?"(".concat(r,")"):""]})]}),e.name===r&&(n=Object(J.jsx)("div",{children:r}))):(n=Object(J.jsxs)("div",{children:[e.name," ",r?"(".concat(r,")"):""]}),e.name===e.admin_level&&(n=Object(J.jsx)("div",{children:r}))),n}return Qi(P,(function(){v([])})),Object(H.useEffect)((function(){var e=[];n.sources&&n.sources.length>0&&n.sources.forEach((function(t){t.active&&e.push(t.id)})),h([].concat(e))}),[]),Object(J.jsxs)("div",{ref:P,style:{textAlign:"right"},children:[Object(J.jsxs)("span",{className:"layout-topbar-search",children:[Object(J.jsx)(jt.a,{type:"text",placeholder:n.placeholder||"Pesquisar...",value:u,onChange:function(e){return function(e){if(d(e.target.value),e.target.value.length<3)v([]);else{S(!0);var r=t.API_URL+"/geographical_names/search?_min_similarity=0.5&_maxrows=10&_filter={filter}";n.url&&(r=n.url),n.max_rows&&(r=r.replace("{max_rows}",n.max_rows)),n.min_similarity&&(r=r.replace("{min_similarity}",n.min_similarity)),r=r.replace("{filter}",e.target.value),fetch(r).then((function(e){return e.json()})).then((function(e){null!==j&&void 0!==j&&j.length?v(e.filter((function(e){return j.includes(e.origem)}))):v(e),S(!1)})).catch((function(e){S(!1)}))}}(e)}}),Object(J.jsx)("span",{className:E?"layout-topbar-search-icon pi pi-spin pi-spinner":"layout-topbar-search-icon pi pi-search"})]}),g&&g.length>0?Object(J.jsx)("div",{style:{marginTop:"5px",position:"absolute",zIndex:"10"},children:Object(J.jsx)($i.a,{optionLabel:"Lugar",value:x,options:g,itemTemplate:function(e){var t,n,r,i=null===A||void 0===A?void 0:A.types,a=null;if(a=i?C(e,null===i||void 0===i||null===(n=i.defaultTemplate)||void 0===n?void 0:n.iconClass):function(e,t){var n=null;return t?(n=Object(J.jsxs)("div",{children:[Object(J.jsx)("i",{className:"pi ".concat(t||""," p-mr-2")})," ",Object(J.jsxs)("span",{children:[e.designacao," (",e.concelho,")"]})]}),e.designacao===e.concelho&&(n=Object(J.jsx)("div",{children:e.concelho}))):(n=Object(J.jsxs)("div",{children:[e.designacao," (",e.concelho,")"]}),e.designacao===e.concelho&&(n=Object(J.jsx)("div",{children:e.concelho}))),n}(e,null),null!==i&&void 0!==i&&i.defaultTemplate&&null!==i&&void 0!==i&&null!==(r=i.defaultTemplate)&&void 0!==r&&r.html){var o,c=null===i||void 0===i||null===(o=i.defaultTemplate)||void 0===o?void 0:o.html,s=c&&c.match?c.match(/[^{}]+(?=})/g):null;s&&s.forEach((function(t){c=c.replace("{".concat(t,"}"),e[t]||"")})),a=Object(J.jsx)("div",{dangerouslySetInnerHTML:{__html:c}})}if(null!==i&&void 0!==i&&i.field&&e[null===i||void 0===i?void 0:i.field]&&null!==i&&void 0!==i&&null!==(t=i.templates)&&void 0!==t&&t.length){var l=i.templates.find((function(t){return t.id===e[i.field]}));if(l)if(null!==l&&void 0!==l&&l.html){var u=l.html,d=u&&u.match?u.match(/[^{}]+(?=})/g):null;d&&d.forEach((function(t){u=u.replace("{".concat(t,"}"),e[t]||"")})),a=Object(J.jsx)("div",{dangerouslySetInnerHTML:{__html:u}})}else l.iconClass&&(a=C(e,l.iconClass))}return a},onChange:function(e){return function(e){var t=e.value;if(t&&t.geom_wkt){var i,s=c.getGeometryFromWKT(t.geom_wkt);s.transform("EPSG:4326",a.getView().getProjection());var l=n.buffer||1e3;null!==n&&void 0!==n&&null!==(i=n.sources)&&void 0!==i&&i.length&&n.sources.forEach((function(e){t.origem==e.id&&null!=e.buffer&&(l=e.buffer)}));var u=s.getExtent(),p=[u[0]-l,u[1]-l,u[0]+l,u[1]+l];o(r.map_set_extent([p[2]-p[0],p[3]-p[1]],p)),d(t.designacao)}}(e)}})}):null]})}n(1192);var ta=Object({NODE_ENV:"production",PUBLIC_URL:"/static/viewer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"/api",REACT_APP_BASE_URL:"",REACT_APP_CLIENT_URL:"/static/viewer",REACT_APP_CONFIG_URL:"/static/viewer/config.json",REACT_APP_COOKIE_AUTH_NAME:"scalargis_webgis",REACT_APP_COOKIE_EXPIRES_DAYS:"150",REACT_APP_COOKIE_INFO_URL:"/static/viewer/rgpd.html",REACT_APP_COOKIE_MESSAGE:"This website uses cookies to improve your browsing experience. By pressing 'I Accept' you are agreeing to its use.",REACT_APP_COOKIE_NAME:"scalargis_rgpd",REACT_APP_COOKIE_PATH:"/",REACT_APP_COOKIE_VALUE:"2",REACT_APP_DEFAULT_THEME:"default",REACT_APP_DESCRIPTION:"ScalarGIS - Web GIS framework",REACT_APP_ENTITY_NAME:"ScalarGIS",REACT_APP_ENTITY_NAME_ABREV:"ScalarGIS",REACT_APP_ENTITY_URL:"https://www.scalargis.com",REACT_APP_MAP_PROXY:"/proxy?url=",REACT_APP_ROOT_PATH:"",REACT_APP_TITLE:"ScalarGIS",REACT_APP_UPLOAD_URL:"/spatial_toolbox/convert2geojson"}).REACT_APP_COOKIE_POPUP_NAME||"scalargis_popup",na="/";function ra(e){var t=e.config,n=(e.as,e.core),r=(e.actions,e.utils),i=e.record,a=(t.mainMap,t.auth),o=r.showOnPortal,c=Object(H.useState)(!1),s=Object(X.a)(c,2),l=s[0],u=s[1],d=Object(H.useState)(!1),p=Object(X.a)(d,2),f=p[0],j=p[1],h=r.getWindowSize()[0]<=768;function b(){var e,r;u(!1);var a,o,c=JSON.stringify(0),s=new ft.a,l=1;(f&&(l=t.maxAge||365*l*24*60*60),s.set(t.cookieName||ta,c,{path:na,maxAge:l}),null!==n&&void 0!==n&&n.pubsub&&null!==i&&void 0!==i&&null!==(e=i.config_json)&&void 0!==e&&null!==(r=e.actions)&&void 0!==r&&r.hide)&&n.pubsub.publish(null===i||void 0===i||null===(a=i.config_json)||void 0===a||null===(o=a.actions)||void 0===o?void 0:o.hide,null)}Object(H.useEffect)((function(){var e=function(){var e,n=!0,r=(new ft.a).get(t.cookieName||ta);return"undefined"!==typeof r&&(n=0!==JSON.parse(r)),!1!==t.hideOption&&(n=!0),null!==a&&void 0!==a&&null!==(e=a.data)&&void 0!==e&&e.authenticated&&i.config_json.hideAuthenticated&&(n=!1),n}();u(e),e||setTimeout((function(){var e,t,r,a;null!==n&&void 0!==n&&n.pubsub&&null!==i&&void 0!==i&&null!==(e=i.config_json)&&void 0!==e&&null!==(t=e.actions)&&void 0!==t&&t.hide&&n.pubsub.publish(null===i||void 0===i||null===(r=i.config_json)||void 0===r||null===(a=r.actions)||void 0===a?void 0:a.hide,null)}),500)}),[]);var m=t.closeLabel||"Fechar";return Object(J.jsx)(H.Fragment,{children:o(Object(J.jsx)(vt.a,{header:t.header,visible:l,style:{width:h?"90%":"35vw"},modal:!0,footer:Object(J.jsxs)("div",{className:"p-grid",children:[!t.hideOption&&Object(J.jsxs)("div",{className:"p-col-12 p-md-6",style:{textAlign:"left"},children:[Object(J.jsx)(gt.a,{inputId:"permanentSwitch",checked:f,onChange:function(e){return j(!f)}})," ",Object(J.jsx)("label",{htmlFor:"permanentSwitch",children:Object(J.jsx)("span",{children:"N\xe3o mostrar novamente"})})]}),Object(J.jsx)("div",{className:"p-col",style:{textAlign:"right"},children:Object(J.jsx)(bt.a,{label:m,onClick:function(e){return b()}})})]}),onHide:function(e){return b()},children:Object(J.jsx)("div",{dangerouslySetInnerHTML:{__html:t.html}})}))})}n(358),n(215);function ia(e){var t=e.config;t.viewer,t.mainMap,t.dispatch,t.Models,e.control,e.actions;return Object(J.jsx)("div",{className:"print-panel1",children:Object(J.jsx)(mt.a,{severity:"warn",text:"Este visualizador n\xe3o tem plantas configuradas."})})}function aa(e){var t=e.config,n=t.viewer;t.mainMap,t.dispatch,t.Models,e.control,e.actions;return Object(J.jsxs)("div",{className:"print-panel1",children:[Object(J.jsx)(mt.a,{severity:"info",text:"Escolha o tipo de planta que pretende emitir."}),n.printing&&n.printing.groups&&n.printing.groups.map((function(t,n){return Object(J.jsxs)("div",{children:[Object(J.jsx)(bt.a,{label:"",icon:"pi pi-chevron-right",className:"p-button-rounded p-button-text",onClick:function(n){!function(t){e.setPrintGroup(t),e.changeActivePanel("p2")}(t)}}),Object(J.jsx)("h4",{children:t.title}),Object(J.jsx)("p",{children:t.description})]},n)})),n.printing&&n.printing.prints&&n.printing.prints.map((function(t,n){return Object(J.jsxs)("div",{children:[Object(J.jsx)(bt.a,{label:"",icon:"pi pi-chevron-right",className:"p-button-rounded p-button-text",onClick:function(n){var r;r=t,e.setPrintItem(r),e.changeActivePanel("p2-item")}}),Object(J.jsx)("h4",{children:t.title}),Object(J.jsx)("p",{children:t.description})]},n)}))]})}var oa=n(217),ca=n(450);function sa(e){var t=e.core,n=(e.control,e.printGroup),r=e.printLayer,i=e.setPrintDetails,a=e.fields,o=e.setGeometries,c=e.handleFieldChange,s=e.standalone,l=e.config,u=e.actions,d=l.viewer,p=l.mainMap,f=l.dispatch,j=l.Models,h=j.Utils.showOnPortal,b=d.exclusive_mapcontrol,m=(t.API_URL,Object(H.useState)(null)),g=Object(X.a)(m,2),v=g[0],O=g[1],_=Object(H.useState)(null),x=Object(X.a)(_,2),y=x[0],w=x[1],E=Object(H.useRef)(null),S=Object(H.useState)(null),P=Object(X.a)(S,2),A=P[0],C=P[1],T=Object(H.useState)([]),R=Object(X.a)(T,2),N=(R[0],R[1],Object(H.useState)(!1)),k=Object(X.a)(N,2),I=k[0],M=k[1],L=Object(H.useState)(!1),F=Object(X.a)(L,2),U=(F[0],F[1]),G=Object(H.useRef)(null);var D=function(e){Object(ca.a)({message:" Deseja eliminar todos os elementos?",header:"Confirma\xe7\xe3o",icon:"pi pi-exclamation-triangle",acceptLabel:"Sim",rejectLabel:"N\xe3o",accept:function(){e.forEach((function(e){r.current.getSource().removeFeature(e)})),p.render()},reject:function(){}})};Object(H.useEffect)((function(){U(!1)}),[a]),Object(H.useEffect)((function(){v?(f(u.viewer_set_exclusive_mapcontrol("Print")),function(e){if(y&&p.removeInteraction(y),E.current&&E.current.setActive(!1),A&&A.setActive(!1),["Point","LineString","Polygon"].includes(e)){var t=r.current.getSource(),i=new Or.a({source:t,type:e});p.addInteraction(i),i.on("drawend",(function(e){n.multi_geom||(E.current&&E.current.getFeatures().clear(),r.current.getSource().getFeatures().forEach((function(t){t!=e.feature&&r.current.getSource().removeFeature(t)})))})),w(i)}else"Select"===e?E.current.setActive(!0):"Modify"===e&&A.setActive(!0)}(v)):(y&&(p.removeInteraction(y),w(null)),E.current&&E.current.setActive(!1),A&&A.setActive(!1))}),[v]),Object(H.useEffect)((function(){v&&"Print"!=b&&O(null)}),[b]),Object(H.useEffect)((function(){var e=new xr.a({condition:yr.m,hitTolerance:5,wrapX:!1,filter:function(e,t){return"print"===t.get("id")}});e.on("select",(function(e){p.render()})),p.addInteraction(e),e.setActive(!1),E.current=e;var t=new _r.a({source:r.current.getSource()});return p.addInteraction(t),t.setActive(!1),C(t),function(){e&&p.removeInteraction(e),t&&p.removeInteraction(t)}}),[p]);var V=Object(J.jsx)(z.a.Fragment,{children:[{value:"Point",title:"Adicionar ponto",icon:"fas fa-circle"},{value:"LineString",title:"Adicionar linha",icon:"pi pi-minus"},{value:"Polygon",title:"Adicionar pol\xedgono",icon:"fas fa-draw-polygon"},{value:"Select",title:"Selecionar elemento",icon:"fas fa-mouse-pointer"},{value:"Modify",title:"Editar elemento",icon:"pi pi-pencil"}].map((function(e){return Object(J.jsx)(bt.a,{icon:e.icon,label:e.label?e.label:"",tooltip:e.title,className:"p-button-sm p-mr-2 tool"+(e.value===v?" active":""),onClick:function(t){return function(e,t){e.preventDefault(),e.target.blur(),O(v!=t?t:null)}(t,e.value)}},e.value)}))}),W=Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsx)(bt.a,{icon:"pi pi-trash",tooltip:"Eliminar elemento selecionado",className:"p-button-sm p-mr-2 tool",onClick:function(e){return function(){var e=r.current.getSource().getFeatures();E.current&&E.current.getFeatures().getLength()>0?(E.current.getFeatures().forEach((function(e){r.current.getSource().removeFeature(e)})),E.current.getFeatures().clear()):e&&e.length>1?D(e):e&&1==e.length&&e.forEach((function(e){r.current.getSource().removeFeature(e)})),p.render()}()}}),Object(J.jsx)(bt.a,{icon:"fas fa-search-plus",tooltip:"Ver todos os elementos",className:"p-button-sm p-mr-2 tool",onClick:function(e){return function(){if(r&&r.current&&r.current.getSource().getFeatures().length>0){var e=r.current.getSource().getExtent();if(!e)return;var t=[e[0]+(e[2]-e[0])/2,e[1]+(e[3]-e[1])/2];(e[2]-e[0]<500||e[3]-e[1]<500)&&(e=[t[0]-250,t[1]-250,t[0]+250,t[1]+250]),f(u.map_set_extent(t,e))}}()}})]});return Object(J.jsxs)("div",{className:"print-panel2",children:[h(Object(J.jsx)(ui.a,{ref:G})),Object(J.jsx)("h3",{children:e.printGroup.title}),!1!==n.allow_drawing&&Object(J.jsxs)("div",{className:"p-fluid",children:[Object(J.jsx)("h4",{children:"Marca\xe7\xe3o do Local"}),Object(J.jsx)("div",{children:Object(J.jsx)(oa.a,{left:V,right:W})}),n.location_marking&&Object(J.jsx)(mt.a,{severity:"info",text:"Dever\xe1 marcar no mapa a localiza\xe7\xe3o pretendida"})]}),n.form_fields&&n.form_fields.groups&&Object(J.jsx)(z.a.Fragment,{children:Object.entries(n.form_fields.groups).map((function(e){var t=Object(X.a)(e,2),n=t[0],r=t[1];if(r.active)return Object(J.jsxs)("div",{className:"p-fluid",children:[Object(J.jsx)("h4",{children:r.title}),r.fields&&Object.entries(r.fields).map((function(e){var t=Object(X.a)(e,2),r=t[0],i=t[1],o=n+"."+r;if(i.active)return Object(J.jsxs)("div",{className:"p-field",children:[i.header&&Object(J.jsx)("h4",{children:i.header}),i.label&&Object(J.jsx)("label",{children:i.label}),Object(J.jsx)(jt.a,{id:o,className:"p-inputtext-sm p-d-block",placeholder:i.title,tooltip:i.title,value:a[o],onChange:c},o),i.required&&!a[o]&&Object(J.jsx)("small",{id:o+"-help",className:"p-error",children:"Campo de preenchimento obrigat\xf3rio."})]})}))]},n)}))}),n.form_fields&&n.form_fields.fields&&Object(J.jsx)(z.a.Fragment,{children:Object.entries(n.form_fields.fields).map((function(e){var t=Object(X.a)(e,2),n=t[0],r=t[1],i=n;if(r.active)return Object(J.jsx)(z.a.Fragment,{children:Object(J.jsxs)("div",{className:"p-fluid",children:[r.header&&Object(J.jsx)("h4",{children:r.header}),Object(J.jsxs)("div",{className:"p-field",children:[r.label&&Object(J.jsx)("label",{children:r.label}),Object(J.jsx)(jt.a,{id:i,className:"p-inputtext-sm p-d-block",placeholder:r.title,tooltip:r.title,value:a[i],onChange:c}),r.required&&!a[i]&&Object(J.jsx)("small",{id:i+"-help",className:"p-error",children:"Campo de preenchimento obrigat\xf3rio."})]})]},i)})}))}),Object(J.jsx)("div",{className:"card",children:Object(J.jsxs)("div",{className:"p-grid",children:[Object(J.jsx)("div",{className:"p-col p-text-left",children:!s&&Object(J.jsx)(bt.a,{label:"Voltar",icon:"pi pi-chevron-left",className:"p-button-sm",onClick:function(t){e.setPrintGroup(null),y&&p.removeInteraction(y),e.changeActivePanel("p1")}})}),Object(J.jsx)("div",{className:"p-col p-text-right",children:Object(J.jsx)(bt.a,{label:"Continuar",icon:I?"pi pi-spin pi-spinner":"",className:"p-button-sm",onClick:function(c){!function(){var c=!1,s={};if(n.form_fields&&n.form_fields.groups&&Object.entries(n.form_fields.groups).forEach((function(e){var t=Object(X.a)(e,2),n=t[0],r=t[1];Object.entries(r.fields).forEach((function(e){var t=Object(X.a)(e,2),r=t[0],i=t[1],o=a[n+"."+r];if(o){var l=i.name||r;s[l]=o}else i.required&&(c=!0)}))})),n.form_fields&&n.form_fields.fields&&Object.entries(n.form_fields.fields).forEach((function(e){var t=Object(X.a)(e,2),n=t[0],r=t[1],i=a[n];if(i){var o=r.name||n;s[o]=i}else r.required&&(c=!0)})),n.location_marking&&!c&&0==r.current.getSource().getFeatures().length&&(c=!0),!c){O(null),M(!0);var l=[];r.current.getSource().getFeatures().forEach((function(e){l.push(e.getGeometry().clone())})),o(l);var u={geom_filter:l.map((function(e){return j.MapModel.getWKTFromGeometry(e)})),geom_srid:j.MapModel.getProjectionSrid(p.getView().getProjection().getCode())},d={headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify(u)},f=(new ft.a).get(t.COOKIE_AUTH_NAME);f&&(d.headers["X-API-KEY"]=f.token);var h=n.resource_url;fetch(h,d).then((function(e){return e.json()})).then((function(t){M(!1);var n=Object(Y.a)({},t);n.userFormData=Object(Y.a)({},s);var r=[];!function e(t,n){t.prints.forEach((function(e){e.uuid=String(Object(sr.v4)()),e.selected=!0,n.push(e.uuid)})),t.children.forEach((function(t){e(t,n)}))}(n,r),n.selected=r,i(n),e.changeActivePanel("p3")})).catch((function(e){M(!1)}))}}()},disabled:I})})]})})]})}var la=n(146);function ua(e){e.control,e.printLayer;var t=e.printGroup,n=e.printDetails,r=e.groupItem,i=e.config,a=e.actions,o=e.selectedPrints,c=e.setSelectedPrints,s=(i.viewer,i.mainMap,i.dispatch,i.Models,function(e){var t=Object(ae.a)(o);e.checked?t.push(e.value):t.splice(t.indexOf(e.value),1),c(t)});return Object(J.jsx)("ul",{children:Object(J.jsxs)("li",{children:[Object(J.jsx)("span",{children:Object(J.jsx)("b",{children:r.title})}),r.children&&r.children.length>0&&Object(J.jsx)(z.a.Fragment,{children:r.children.map((function(e){return Object(J.jsx)(ua,{config:i,actions:a,printGroup:t,printDetails:n,groupItem:e,selectedPrints:o,setSelectedPrints:c})}))}),r.prints&&r.prints.length>0&&Object(J.jsx)("ul",{children:r.prints.map((function(e){return Object(J.jsxs)("li",{children:[n.allow_selection&&Object(J.jsx)(Zr.a,{value:e.uuid,onChange:s,checked:o.includes(e.uuid)}),Object(J.jsx)("span",{className:"task-name p-ml-1",children:e.title})]})}))})]})})}function da(e){e.control;var t=e.printGroup,n=(e.printLayer,e.printDetails),r=e.setFinalPrints,i=e.fields,a=e.handleFieldChange,o=e.config,c=e.actions,s=o.viewer,l=(o.mainMap,o.dispatch,o.Models,s.exclusive_mapcontrol,Object(H.useState)(!1)),u=Object(X.a)(l,2),d=u[0],p=(u[1],Object(H.useState)(null)),f=Object(X.a)(p,2),j=f[0],h=f[1],b=Object(H.useState)(Object(ae.a)(n.selected)),m=Object(X.a)(b,2),g=m[0],v=m[1];return Object(H.useEffect)((function(){var e={};n.layouts.group.forEach((function(t){var n=t.format,r=t.orientation,i=n+"-"+r;e[i]||(e[i]={format:n,orientation:r,label:n+" - "+r})})),n.layouts.prints.forEach((function(t){var n=t.format,r=t.orientation,i=n+"-"+r;e[i]||(e[i]={format:n,orientation:r,label:n+" - "+r})}));var t=[];Object.keys(e).forEach((function(n){t.push(e[n])})),h(t),t.length>0&&a({target:{id:"layout",value:t[0]}})}),[]),Object(J.jsxs)("div",{className:"print-panel3",children:[Object(J.jsx)("h3",{children:n.title}),Object(J.jsx)("div",{className:"p-fluid",children:Object(J.jsx)(mt.a,{severity:"info",text:"Seleccione o formato e as plantas pretendidas e clique em Continuar"})}),Object(J.jsxs)("div",{className:"p-fluid",children:[Object(J.jsx)("h4",{children:"Formato"}),Object(J.jsx)(nr.a,{id:"layout",optionLabel:"label",value:i.layout,options:j,onChange:a,placeholder:"Selecione um Formato"})]}),Object(J.jsxs)("div",{className:"p-fluid",children:[Object(J.jsx)("h4",{children:"Plantas"}),Object(J.jsx)(ua,{config:o,actions:c,printGroup:t,printDetails:n,groupItem:n,selectedPrints:g,setSelectedPrints:v}),n.allow_selection&&n.children.length+n.prints.length>1?Object(J.jsxs)("div",{className:"p-d-flex",children:[Object(J.jsx)(bt.a,{label:"Nenhuma",className:"p-button-sm p-button-warning p-button-text",onClick:function(){}}),Object(J.jsx)(bt.a,{label:"Todas",style:{float:"right"},className:"p-button-sm p-button-warning p-button-text",onClick:function(){}})]}):null]}),Object(J.jsx)("div",{className:"card",children:Object(J.jsxs)("div",{className:"p-grid",children:[Object(J.jsx)("div",{className:"p-col p-text-left",children:Object(J.jsx)(bt.a,{label:"Voltar",icon:"pi pi-chevron-left",className:"p-button-sm",onClick:function(t){e.changeActivePanel("p2")}})}),Object(J.jsx)("div",{className:"p-col p-text-right",children:Object(J.jsx)(bt.a,{label:"Continuar",icon:d?"pi pi-spin pi-spinner":"",className:"p-button-sm",onClick:function(t){!function(){var t=[];!function e(n){n.prints.forEach((function(e){if(g.includes(e.uuid)){var r=Object(Y.a)(Object(Y.a)({},e),{},{groupId:n.id,groupTitle:n.title,processed:!1,error:!1});t.push(r)}})),n.children.forEach((function(t){e(t)}))}(n),r(t),e.changeActivePanel("p4")}()},disabled:d})})]})})]})}function pa(e){var t=e.core,n=(e.control,e.printGroup,e.printLayer,e.printDetails),r=e.finalPrints,i=e.setFinalPrints,a=e.fields,o=e.geometries,c=e.config,s=(e.actions,c.viewer),l=c.mainMap,u=(c.dispatch,c.Models),d=u.MapModel.getScaleForResolution,p=u.Utils.showOnPortal,f=Object(H.useState)(!0),j=Object(X.a)(f,2),h=j[0],b=j[1],m=Object(H.useState)(!1),g=Object(X.a)(m,2),v=g[0],O=g[1],_=Object(H.useState)(null),x=Object(X.a)(_,2),y=x[0],w=x[1],E=Object(H.useRef)(null),S=t.API_URL;function P(e){var n=[];e?e.forEach((function(e){e.filename&&n.push(e.filename)})):r.forEach((function(e){e.filename&&n.push(e.filename)}));var i={viewerId:s.id,files:n},a={headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify(i)},o=(new ft.a).get(t.COOKIE_AUTH_NAME);o&&(a.headers["X-API-KEY"]=o.token);var c=S+"/app/viewer/"+s.id+"/print/merge";O(!0),fetch(c,a).then((function(e){return e.json()})).then((function(e){if(O(!1),!e.Success)throw"Ocorreu um erro ao gerar o ficheiro";w({filename:e.Data.filename,url:e.Data.url})})).catch((function(e){O(!1),w(null)}))}return Object(H.useEffect)((function(){var e={headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"},method:"POST",body:{}},c=(new ft.a).get(t.COOKIE_AUTH_NAME);c&&(e.headers["X-API-KEY"]=c.token);var p=Object(ae.a)(r),f=r.map(function(){var t=Object(_t.a)(Object(Ot.a)().mark((function t(c){var f,j,h,b,m,g,v,O;return Object(Ot.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return f=S+"/app/viewer/"+s.id+"/print/"+c.code+"/generate",j=d(l.getView().getResolution(),"m"),h=Object(Y.a)(Object(Y.a)({},n.userFormData),{},{viewerId:s.id,printId:c.id,groupId:c.groupId,srid:c.srid||3857,layout:"A4|Portrait",scale:j,extentWKT:""}),n.userFormData&&(h.formFields=JSON.stringify(n.userFormData)),a.layout&&(h.layout=a.layout.format+"|"+a.layout.orientation),b=c.srid?"EPSG:"+c.srid:l.getView().getProjection().getCode(),(m=u.MapModel.transformExtent(l.getView().getProjection().getCode(),b,l.getView().calculateExtent(l.getSize())))&&(h.extentWKT=u.MapModel.getWKTFromGeometry(u.MapModel.getPolygonFromExtent(m))),g=[],o&&o.length>0&&o.forEach((function(e){g.push(u.MapModel.getWKTFromGeometry(e.clone().transform(l.getView().getProjection().getCode(),b)))})),v=Object.keys(h).map((function(e){return e+"="+h[e]})).join("&"),g&&g.length>0&&(v+="&"+g.map((function(e){return"geomWKT[]="+e})).join("&")),O=Object(Y.a)(Object(Y.a)({},e),{},{body:v}),t.abrupt("return",fetch(f,O).then((function(e){return e.json()})).then((function(e){var t=Object(Y.a)({},c);if(!e.Success)throw e.Message||"Ocorreu um erro ao gerar a planta";var n=r.findIndex((function(e){return e.uuid==c.uuid}));return t.processed=!0,t.processing=!1,t.error=!1,t.filename=e.Data.filename,t.url=e.Data.url,p[n]=t,setTimeout((function(){i(p)}),500),Object(Y.a)({},t)})).catch((function(e){var t=r.findIndex((function(e){return e.uuid==c.uuid})),n=Object(Y.a)({},c);return n.processed=!1,n.processing=!1,n.error="N\xe3o foi poss\xedvel gerar a planta",p[t]=n,setTimeout((function(){i(p)}),500),Object(Y.a)({},n)})));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());Promise.all(f).then((function(e){var t=!1;e.forEach((function(e){e.error&&(t=!0)})),t&&E.current.show({severity:"warn",summary:n.title||"Emiss\xe3o de plantas",detail:"N\xe3o foi poss\xedvel gerar todas as plantas",life:3e3}),i(Object(ae.a)(e)),b(!1),n.merge_prints&&setTimeout(P(Object(ae.a)(e)),1e3)}))}),[]),Object(J.jsxs)("div",{className:"print-panel4",children:[p(Object(J.jsx)(ui.a,{ref:E,position:"top-right"})),Object(J.jsx)("h3",{children:n.title}),Object(J.jsx)("div",{className:"p-fluid",children:h?Object(J.jsx)(mt.a,{severity:"info",text:"A gerar as plantas ..."}):Object(J.jsx)(mt.a,{severity:"info",text:"Plantas geradas. Pode descarregar as plantas pretendidas."})}),Object(J.jsx)("div",{className:"p-mt-4",children:r.map((function(e){return e.error?Object(J.jsxs)("div",{className:"p-grid",children:[Object(J.jsx)("div",{className:"p-col-fixed",style:{width:"30px"},children:Object(J.jsx)("div",{className:"p-pl-2",children:Object(J.jsx)("i",{className:"pi pi-times-circle print-error"})})}),Object(J.jsx)("div",{className:"p-col-9",children:e.groupTitle?e.groupTitle+" - "+e.title:e.title}),Object(J.jsx)("div",{className:"p-col",children:Object(J.jsx)("i",{className:"pi pi-external-link p-pl-2"})})]}):n.merge_prints?Object(J.jsxs)("div",{className:"p-grid",children:[Object(J.jsx)("div",{className:"p-col-fixed",style:{width:"30px"},children:Object(J.jsx)("div",{className:"p-pl-2",children:Object(J.jsx)("i",{className:e.processed?"pi pi-check print-success":"pi pi-spin pi-spinner"})})}),Object(J.jsx)("div",{className:"p-col",children:e.groupTitle?e.groupTitle+" - "+e.title:e.title})]}):Object(J.jsxs)("div",{className:"p-grid",children:[Object(J.jsx)("div",{className:"p-col-fixed",style:{width:"30px"},children:Object(J.jsx)("div",{className:"p-pl-2",children:Object(J.jsx)("i",{className:e.processed?"pi pi-check print-success":"pi pi-spin pi-spinner"})})}),Object(J.jsx)("div",{className:"p-col-9",children:e.groupTitle?e.groupTitle+" - "+e.title:e.title}),Object(J.jsx)("div",{className:"p-col",children:e.processed?Object(J.jsx)("a",{href:e.url,target:"_blank",title:"Abrir planta",style:{textDecoration:"none",color:"#2196f3"},children:Object(J.jsx)("i",{className:"pi pi-external-link p-pl-2"})}):null})]})}))}),y?Object(J.jsx)("div",{className:"card p-text-center",children:Object(J.jsxs)("a",{href:y.url,target:"_blank",style:{textDecoration:"none",color:"#2196f3"},children:[Object(J.jsx)("i",{className:"pi pi-external-link p-pl-2"})," Abrir PDF com todas as plantas"]})}):null,!h&&!y&&r.map((function(e){return e.error?0:1})).reduce((function(e,t){return e+t}))>1?Object(J.jsx)("div",{className:"card p-text-center",children:Object(J.jsx)(bt.a,{label:"Criar PDF com todas as plantas",icon:v?"pi pi-spin pi-spinner":"",className:"p-button",onClick:function(e){P()}})}):null,Object(J.jsx)("div",{className:"card",children:Object(J.jsx)("div",{className:"p-grid",children:Object(J.jsx)("div",{className:"p-col p-text-left",children:Object(J.jsx)(bt.a,{label:"Voltar",icon:"pi pi-chevron-left",className:"p-button-sm",onClick:function(t){i([]),e.changeActivePanel("p3")}})})})})]})}function fa(e){var t=e.core,n=e.control,r=e.printItem,i=e.printLayer,a=e.fields,o=e.handleFieldChange,c=e.standalone,s=e.config,l=e.actions,u=s.viewer,d=s.mainMap,p=s.dispatch,f=s.Models,j=f.Utils,h=j.showOnPortal,b=j.findOLInteraction,m=f.MapModel,g=m.getScaleForResolution,v=m.getWMSVisibleLayers,O=m.getArcGISVisibleLayers,_=u.exclusive_mapcontrol,x=u.config_json.selected_menu,y=Object(H.useRef)(null),w=Object(H.useRef)(null),E=Object(H.useRef)(),S=Object(H.useState)(!1),P=Object(X.a)(S,2),A=P[0],C=P[1],T=Object(H.useState)(null),R=Object(X.a)(T,2),N=R[0],k=R[1],I=Object(H.useState)(null),M=Object(X.a)(I,2),L=M[0],F=M[1],U=Object(H.useRef)(null),G=Object(H.useRef)(),D=Object(H.useState)(null),V=Object(X.a)(D,2),W=V[0],K=V[1],B=Object(H.useState)(null),q=Object(X.a)(B,2),Z=q[0],$=q[1],Q=Object(H.useState)(0),ee=Object(X.a)(Q,2),te=ee[0],ne=ee[1],re=Object(H.useState)([]),ie=Object(X.a)(re,2),oe=ie[0],ce=ie[1],se=Object(H.useState)(null),le=Object(X.a)(se,2),de=le[0],je=le[1],he=Object(H.useState)(null),be=Object(X.a)(he,2),me=be[0],ge=be[1],ve=Object(H.useState)(null),Oe=Object(X.a)(ve,2),_e=Oe[0],xe=Oe[1],ye=Object(H.useState)(!1),we=Object(X.a)(ye,2),Ee=we[0],Se=we[1],Pe=Object(H.useState)(!1),Ae=Object(X.a)(Pe,2),Ce=(Ae[0],Ae[1]),Te=Object(H.useState)(null),Re=Object(X.a)(Te,2),Ne=Re[0],ke=Re[1];var Ie=function(e){Object(ca.a)({message:" Deseja eliminar todos os elementos?",header:"Confirma\xe7\xe3o",icon:"pi pi-exclamation-triangle",acceptLabel:"Sim",rejectLabel:"N\xe3o",accept:function(){e.forEach((function(e){i.current.getSource().removeFeature(e)})),Le(),d.render()},reject:function(){}})};function Me(){var e=[];return r.restrict_scales&&e.push(Object(J.jsx)(er.a,{header:"Predefinida",children:Object(J.jsx)(nr.a,{className:"p-inputgroup",options:Z,optionLabel:"label",optionValue:"value",value:me,onChange:function(e){return ge(e.value)}})},"predefined")),r.free_scale&&e.push(Object(J.jsx)(er.a,{header:"Livre",children:Object(J.jsx)(ir.a,{value:_e,onChange:function(e){return xe(e.value)},prefix:"1:"})},"freescale")),r.map_scale&&e.push(Object(J.jsx)(er.a,{header:"Mapa",children:Object(J.jsx)(mt.a,{severity:"info",text:"A planta ser\xe1 emitida em fun\xe7\xe3o da escala de visualiza\xe7\xe3o do mapa"})},"map")),e}function Le(){if(!E.current.getSource())return null;if(!de)return null;if(E.current.getSource().clear(),!A)return null;if("print"!==x)return null;var e,t,n;if("map"===de)e=g(d.getView().getResolution(),"m");else if("free"===de)e=_e;else{if("restricted"!==de)return null;e=me}if(i.current.getSource().getFeatures().length>0){var o=new Kt.j;i.current.getSource().getFeatures().forEach((function(e){o=Object(Kt.p)(o,e.getGeometry().getExtent())})),t=(o[0]+o[2])/2,n=(o[1]+o[3])/2}else t=d.getView().getCenter()[0],n=d.getView().getCenter()[1];var c=r.layouts.find((function(e){return e.orientation===a.layout.orientation&&a.layout.format===r.format}));if(!c||!c.config)return null;var s=JSON.parse(null===c||void 0===c?void 0:c.config)[0],l=1/(1/e*39.37*22),u=s.map.width*l/2,p=s.map.height*l/2,f=t-u,j=n-p,h=t+u,b=n+p,m=[[[f,j],[f,b],[h,b],[h,j],[f,j]]],v=new Vt.b(m),O=new or.a(v);E.current.getSource().addFeature(O)}Object(H.useEffect)((function(){var e={};r.layouts.forEach((function(t){var n=t.format,r=t.orientation,i=n+"-"+r;e[i]||(e[i]={format:n,orientation:r,label:n+" - "+r})}));var t=[];Object.keys(e).forEach((function(n){t.push(e[n])})),K(t),t.length>0&&o({target:{id:"layout",value:t[0]}});var i=[];r.restrict_scales&&i.push("restricted"),r.free_scale&&i.push("free"),r.map_scale&&i.push("map"),ce(i);var a=[];r.restrict_scales_list&&r.restrict_scales_list.split(",").forEach((function(e){a.push({value:parseInt(e),label:"1:"+e})})),$(a),a.length>0&&ge(a[0].value);var c=Me().findIndex((function(e){var t;return e.key===(null===n||void 0===n||null===(t=n.config_json)||void 0===t?void 0:t.defaultScaleSelector)}));i.length>0&&(c>-1?(ne(c),je(i[c])):je(i[0]))}),[]),Object(H.useEffect)((function(){Ce(!1)}),[a]),Object(H.useEffect)((function(){E.current=new wt.a({id:"paperbox-layer",renderMode:"vector",source:new It.a({}),style:new ue.c({stroke:new fe.a({color:"rgba(100, 100, 100, 0.8)",width:7,lineDash:[4,8]}),fill:new pe.a({color:"rgba(255, 255, 255, 0.2)"})})}),d.addLayer(E.current)}),[]),Object(H.useEffect)((function(){Le()}),[a,me,_e,de,A,d.getView().calculateExtent()]),Object(H.useEffect)((function(){if(N)p(l.viewer_set_exclusive_mapcontrol("Print")),function(e){if(L&&d.removeInteraction(L),U.current&&U.current.setActive(!1),G.current&&G.current.setActive(!1),["Point","LineString","Polygon"].includes(e)){var t=i.current.getSource(),n=new Or.a({source:t,type:e});d.addInteraction(n),n.on("drawend",(function(e){r.multi_geom||(U.current&&U.current.getFeatures().clear(),i.current.getSource().getFeatures().forEach((function(t){t!==e.feature&&i.current.getSource().removeFeature(t)}))),A&&Le()})),F(n)}else"Select"===e?U.current.setActive(!0):"Modify"===e&&(b(d,mr.a).setActive(!1),G.current.setActive(!0))}(N);else{L&&(d.removeInteraction(L),F(null)),U.current&&U.current.setActive(!1),G.current&&G.current.setActive(!1);var e=b(d,mr.a);e&&e.setActive(!0)}}),[N]),Object(H.useEffect)((function(){N&&"Print"!==_&&k(null)}),[_]),Object(H.useEffect)((function(){var e=new xr.a({condition:yr.m,hitTolerance:5,wrapX:!1,filter:function(e,t){return"print"===t.get("id")}});e.on("select",(function(e){d.render()})),d.addInteraction(e),e.setActive(!1),U.current=e;var t=new _r.a({source:i.current.getSource(),deleteCondition:function(e){return Object(yr.m)(e)&&Object(yr.j)(e)}});return d.addInteraction(t),t.setActive(!1),G.current=t,d.controls.forEach((function(e){e.dragPan&&e.dragPan.deactivate()})),function(){e&&d.removeInteraction(e),t&&d.removeInteraction(t)}}),[d]);var Fe=Object(J.jsx)(z.a.Fragment,{children:[{value:"Point",title:"Adicionar ponto",icon:"fas fa-circle"},{value:"LineString",title:"Adicionar linha",icon:"pi pi-minus"},{value:"Polygon",title:"Adicionar pol\xedgono",icon:"fas fa-draw-polygon"},{value:"Select",title:"Selecionar elemento",icon:"fas fa-mouse-pointer"},{value:"Modify",title:"Editar elemento",icon:"pi pi-pencil"}].map((function(e){return Object(J.jsx)(bt.a,{icon:e.icon,label:e.label?e.label:"",tooltip:e.title,className:"p-button-sm p-mr-2 tool"+(e.value===N?" active":""),onClick:function(t){return function(e,t){e.preventDefault(),e.target.blur(),k(N!==t?t:null)}(t,e.value)}},e.value)}))}),Ue=Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsx)(bt.a,{icon:"pi pi-trash",tooltip:"Eliminar elemento(s)",className:"p-button-sm p-mr-2 tool",onClick:function(e){return function(){var e=i.current.getSource().getFeatures();U.current&&U.current.getFeatures().getLength()>0?(U.current.getFeatures().forEach((function(e){i.current.getSource().removeFeature(e)})),U.current.getFeatures().clear()):e&&e.length>1?Ie(e):e&&1===e.length&&e.forEach((function(e){i.current.getSource().removeFeature(e)})),Le(),d.render()}()}}),Object(J.jsx)(bt.a,{icon:"fas fa-search-plus",tooltip:"Ver todos os elementos",className:"p-button-sm p-mr-2 tool",onClick:function(e){return function(){if(i&&i.current&&i.current.getSource().getFeatures().length>0){var e=i.current.getSource().getExtent();if(!e)return;var t=[e[0]+(e[2]-e[0])/2,e[1]+(e[3]-e[1])/2];(e[2]-e[0]<500||e[3]-e[1]<500)&&(e=[t[0]-250,t[1]-250,t[0]+250,t[1]+250]),p(l.map_set_extent(t,e))}}()}})]});return Object(J.jsxs)("div",{className:"print-panel-item",children:[h(Object(J.jsx)(ui.a,{ref:y,position:"top-right"})),h(Object(J.jsx)(ui.a,{ref:w})),Object(J.jsx)("h3",{children:e.printItem.title}),!1!==r.allow_drawing&&Object(J.jsxs)("div",{className:"p-fluid",children:[Object(J.jsx)("h4",{children:"Marca\xe7\xe3o do Local"}),Object(J.jsx)("div",{children:Object(J.jsx)(oa.a,{left:Fe,right:Ue})}),r.location_marking&&Object(J.jsx)(mt.a,{severity:"info",text:"Dever\xe1 marcar no mapa a localiza\xe7\xe3o pretendida"})]}),(r.restrict_scales||r.free_scale||r.map_scale)&&Object(J.jsxs)("div",{className:"p-fluid",children:[Object(J.jsx)("h4",{children:"Escala de Sa\xedda"}),Object(J.jsx)(er.b,{activeIndex:te,onTabChange:function(e){return function(e){ne(e.index),je(oe[e.index])}(e)},children:Me().map((function(e){return e}))})]}),Object(J.jsxs)("div",{className:"p-fluid",children:[Object(J.jsx)("h4",{children:"Formato"}),Object(J.jsx)(nr.a,{id:"layout",optionLabel:"label",value:a.layout,options:W,onChange:o,placeholder:"Selecione um Formato"})]}),r.form_fields&&r.form_fields.groups&&Object(J.jsx)(z.a.Fragment,{children:Object.entries(r.form_fields.groups).map((function(e){var t=Object(X.a)(e,2),n=t[0],r=t[1];if(r.active)return Object(J.jsxs)("div",{className:"p-fluid",children:[Object(J.jsx)("h4",{children:r.title}),r.fields&&Object.entries(r.fields).map((function(e){var t=Object(X.a)(e,2),r=t[0],i=t[1],c=n+"."+r;if(i.active)return Object(J.jsxs)("div",{className:"p-field",children:[i.header&&Object(J.jsx)("h4",{children:i.header}),i.label&&Object(J.jsx)("label",{children:i.label}),Object(J.jsx)(jt.a,{id:c,className:"p-inputtext-sm p-d-block",placeholder:i.title,tooltip:i.title,value:a[c],onChange:o}),i.required&&!a[c]&&Object(J.jsx)("small",{id:c+"-help",className:"p-error",children:"Campo de preenchimento obrigat\xf3rio."})]},c)}))]},n)}))}),r.form_fields&&r.form_fields.fields&&Object(J.jsx)(z.a.Fragment,{children:Object.entries(r.form_fields.fields).map((function(e){var t=Object(X.a)(e,2),n=t[0],r=t[1],i=n;if(r.active)return Object(J.jsx)(z.a.Fragment,{children:Object(J.jsxs)("div",{className:"p-fluid",children:[r.header&&Object(J.jsx)("h4",{children:r.header}),Object(J.jsxs)("div",{className:"p-field",children:[r.label&&Object(J.jsx)("label",{children:r.label}),Object(J.jsx)(jt.a,{id:i,className:"p-inputtext-sm p-d-block",placeholder:r.title,tooltip:r.title,value:a[i],onChange:o}),r.required&&!a[i]&&Object(J.jsx)("small",{id:i+"-help",className:"p-error",children:"Campo de preenchimento obrigat\xf3rio."})]})]},i)})}))}),Ee?Object(J.jsx)("div",{className:"card p-text-center p-mt-4",style:{backgroundColor:"#add8e6",borderRadius:"4px"},children:Object(J.jsxs)("div",{children:[Object(J.jsx)("i",{className:"pi pi-spin pi-spinner"})," A gerar a planta ..."]})}):null,!Ee&&Ne?Object(J.jsx)("div",{className:"card p-text-center p-mt-4",style:{backgroundColor:"#add8e6",borderRadius:"4px"},children:Object(J.jsxs)("a",{href:Ne.url,target:"_blank",children:[Object(J.jsx)("i",{className:"pi pi-external-link p-pl-2"})," Abrir PDF da planta"]})}):null,Object(J.jsx)("div",{className:"card",children:Object(J.jsxs)("div",{className:"p-grid",children:[Object(J.jsx)("div",{className:"p-col p-text-left",children:!c&&Object(J.jsx)(bt.a,{label:"Voltar",icon:"pi pi-chevron-left",className:"p-button-sm",onClick:function(t){e.setPrintItem(null),L&&d.removeInteraction(L),e.changeActivePanel("p1")}})}),Object(J.jsx)("div",{className:"p-col p-text-right",children:Object(J.jsx)(bt.a,{label:"Imprimir",icon:"pi pi-print",className:"p-button-sm",onClick:function(e){!function(){var e=!1;ke(null);var n={};if(r.form_fields&&r.form_fields.groups&&Object.entries(r.form_fields.groups).forEach((function(t){var r=Object(X.a)(t,2),i=r[0],o=r[1];Object.entries(o.fields).forEach((function(t){var r=Object(X.a)(t,2),o=r[0],c=r[1],s=a[i+"."+o];if(s){var l=c.name||o;n[l]=s}else c.required&&(e=!0)}))})),r.form_fields&&r.form_fields.fields&&Object.entries(r.form_fields.fields).forEach((function(t){var r=Object(X.a)(t,2),i=r[0],o=r[1],c=a[i];if(c){var s=o.name||i;n[s]=c}else o.required&&(e=!0)})),r.location_marking&&!e&&0===i.current.getSource().getFeatures().length&&(e=!0),!e){k(null),Se(!0);var o={headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"},method:"POST",body:{}},c=(new ft.a).get(t.COOKIE_AUTH_NAME);c&&(o.headers["X-API-KEY"]=c.token);var s=t.API_URL+"/app/viewer/"+u.id+"/print/"+r.code+"/generate",l=g(d.getView().getResolution(),"m"),p=Object(Y.a)(Object(Y.a)({},n),{},{viewerId:u.id,printId:r.id,srid:r.srid||3857,layout:"A4|Portrait",scale:l,extentWKT:""});n&&(p.formFields=JSON.stringify(n)),a.layout&&(p.layout=a.layout.format+"|"+a.layout.orientation),"restricted"===de&&me?p.userScale=me:"free"===de&&_e&&(p.userScale=_e);var j=r.srid?"EPSG:"+r.srid:d.getView().getProjection().getCode(),h=f.MapModel.transformExtent(d.getView().getProjection().getCode(),j,d.getView().calculateExtent(d.getSize()));h&&(p.extentWKT=f.MapModel.getWKTFromGeometry(f.MapModel.getPolygonFromExtent(h)));var b=[];i.current.getSource().getFeatures().forEach((function(e){b.push(f.MapModel.getWKTFromGeometry(e.getGeometry().clone().transform(d.getView().getProjection().getCode(),j)))}));var m=Object.keys(p).map((function(e){return e+"="+p[e]})).join("&");b&&b.length>0&&(m+="&"+b.map((function(e){return"geomWKT[]="+e})).join("&"));var _=v(d)||[],x=O(d)||[],w=[].concat(Object(ae.a)(_.map((function(e){return"wms;"+e.url+";"+e.params.LAYERS+";"+e.opacity+";"+e.minScale+";"+e.maxScale+";"+(e.params.CQL_FILTER||"")+";"+(e.params.STYLES||e.params.STYLE||"")}))),Object(ae.a)(x.map((function(e){return"esri_rest;"+e.url+";"+e.params.LAYERS+";"+e.opacity+";"+e.minScale+";"+e.maxScale+";"+(e.params.CQL_FILTER||"")+";"+(e.params.STYLES||e.params.STYLE||"")}))));w.length&&(m+="&"+w.map((function(e){return"layers[]="+e})).join("&"));var E=Object(Y.a)(Object(Y.a)({},o),{},{body:m});fetch(s,E).then((function(e){return e.json()})).then((function(e){if(Se(!1),!e.Success)throw e.Message||"Ocorreu um erro ao gerar a planta";ke({filename:e.Data.filename,url:e.Data.url})})).catch((function(e){Se(!1),y.current.show({severity:"warn",summary:r.title||"Emiss\xe3o de plantas",detail:"N\xe3o foi poss\xedvel gerar a planta",life:3e3})}))}}()},disabled:Ee})})]})}),s.showPreview?Object(J.jsx)("div",{className:"card",children:Object(J.jsxs)("div",{className:"field-checkbox",children:[Object(J.jsx)(Zr.a,{inputId:"binary",checked:A,onChange:function(e){return C(e.checked)}}),Object(J.jsx)("label",{htmlFor:"binary",children:" Visualizar \xe1rea de impress\xe3o"})]})}):null]})}function ja(e){var t=e.core,n=e.config,r=e.actions,i=e.dispatch,a=e.record,o=n.viewer,c=n.mainMap,s=n.Models,l=Object(H.useState)("p1"),u=Object(X.a)(l,2),d=u[0],p=u[1],f=Object(H.useState)(!1),j=Object(X.a)(f,2),h=j[0],b=j[1],m=Object(H.useState)(null),g=Object(X.a)(m,2),v=g[0],O=g[1],_=Object(H.useState)(null),x=Object(X.a)(_,2),y=x[0],w=x[1],E=Object(H.useState)(null),S=Object(X.a)(E,2),P=S[0],A=S[1],C=Object(H.useState)(null),T=Object(X.a)(C,2),R=T[0],N=T[1],k=function(e){var t=Object(H.useState)(e),n=Object(X.a)(t,2),r=n[0],i=n[1];return[r,function(e){i(Object(Y.a)(Object(Y.a)({},r),{},Object(la.a)({},e.target.id,e.target.value)))}]}({}),I=Object(X.a)(k,2),M=I[0],L=I[1],F=Object(H.useState)([]),U=Object(X.a)(F,2),G=U[0],D=U[1],V=Object(H.useRef)();new ue.c({image:new de.a({radius:4,fill:new pe.a({color:"#fff"}),stroke:new fe.a({color:"#FF0000",width:2})})});return Object(H.useEffect)((function(){var e=function(){var e=0;return o.printing?(o.printing.groups&&o.printing.groups.length&&(e+=o.printing.groups.length),o.printing.prints&&o.printing.prints.length&&(e+=o.printing.prints.length),e):e}();0==e?(p("p-noprints"),b(!1)):e>1?(p("p1"),b(!1)):o.printing&&o.printing.groups&&o.printing.groups.length>0?(O(o.printing.groups[0]),p("p2"),b(!0)):o.printing&&o.printing.prints&&o.printing.prints.length>0&&(w(o.printing.prints[0]),p("p2-item"),b(!0))}),[]),Object(H.useEffect)((function(){if(c){V.current=new wt.a({id:"print",renderMode:"vector",source:new It.a({}),selectable:!1});var e=s.Utils.findOlLayer(c,"overlays");e?e.getLayers().getArray().push(V.current):c.addLayer(V.current)}}),[c]),Object(J.jsxs)("div",{style:{height:"100%"},children:["p-noprints"===d?Object(J.jsx)(ia,{core:t,config:n,control:a,actions:r,dispatch:i,activePanel:d,changeActivePanel:p}):null,"p1"===d?Object(J.jsx)(aa,{core:t,config:n,control:a,actions:r,dispatch:i,activePanel:d,changeActivePanel:p,printGroup:v,setPrintGroup:O,printItem:y,setPrintItem:w,printLayer:V,fields:M,handleFieldChange:L}):null,"p2"===d?Object(J.jsx)(sa,{core:t,standalone:h,config:n,control:a,actions:r,dispatch:i,activePanel:d,changeActivePanel:p,printGroup:v,setPrintGroup:O,printLayer:V,printDetails:P,setPrintDetails:A,fields:M,setGeometries:D,handleFieldChange:L}):null,"p3"===d?Object(J.jsx)(da,{core:t,config:n,control:a,actions:r,dispatch:i,activePanel:d,changeActivePanel:p,printGroup:v,setPrintGroup:O,printLayer:V,printDetails:P,setFinalPrints:N,fields:M,handleFieldChange:L}):null,"p4"===d?Object(J.jsx)(pa,{core:t,config:n,control:a,actions:r,dispatch:i,activePanel:d,changeActivePanel:p,printGroup:v,setPrintGroup:O,printLayer:V,printDetails:P,finalPrints:R,setFinalPrints:N,fields:M,geometries:G}):null,"p2-item"===d?Object(J.jsx)(fa,{core:t,standalone:h,config:n,control:a,actions:r,dispatch:i,activePanel:d,changeActivePanel:p,printItem:y,setPrintItem:w,printLayer:V,printDetails:P,finalPrints:R,setFinalPrints:N,fields:M,handleFieldChange:L,geometries:G}):null]})}function ha(e){var t=e.className,n=e.core,r=e.config,i=e.actions,a=e.record,o=(r.viewer,r.dispatch),c=r.Models.Utils,s=c.getWindowSize,l=c.showOnPortal,u=Object(H.useState)(!1),d=Object(X.a)(u,2),p=d[0],f=d[1],j=a.config_json||{},h=a.title||"Imprimir",b=j.header||h,m=s()[0]<=768;if("popup"===a.as){var g=j.closeLabel||"Fechar";return Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsx)(bt.a,{title:h,className:t,icon:"pi pi-print",style:{margin:"0.5em 1em"},onClick:function(e){return f(!0)}}),l(Object(J.jsx)(vt.a,{header:b,visible:p,style:{width:m?"90%":"35vw"},modal:!0,footer:Object(J.jsx)("div",{className:"p-grid",children:Object(J.jsx)("div",{className:"p-col",style:{textAlign:"right"},children:Object(J.jsx)(bt.a,{label:g,onClick:function(e){return f(!1)}})})}),onHide:function(e){return f(!1)},children:Object(J.jsx)(ja,{core:n,config:r,actions:i,dispatch:o,record:a})}))]})}return Object(J.jsx)(bt.a,{title:h,className:t,icon:"pi pi-print",style:{margin:"0.5em 1em"},onClick:function(e){return r.dispatch(i.viewer_set_selectedmenu(a.id))}})}function ba(e){var t=e.type,n=e.region,r=e.as,i=e.core,a=e.config,o=e.actions,c=e.record,s=e.utils,l=a.viewer,u=a.dispatch,d=a.Models,p=l.config_json.selected_menu,f=d?d.Utils:s,j=f.getWindowSize,h=(f.showOnPortal,c.config_json||{}),b=c.title||"Imprimir",m=h.header||b,g=j()[0]<=768;return Object(H.useEffect)((function(){p===c.id&&u(o.viewer_set_exclusive_mapcontrol("Print"))}),[p]),"link"===t&&n===c.links?Object(J.jsx)(bt.a,{title:b,icon:"pi pi-print",className:"p-button-rounded p-button-raised",onClick:function(e){u(o.viewer_set_selectedmenu(c.id)),u(o.layout_show_menu(!g))}}):"panel"===r?Object(J.jsx)(Fn.a,{header:m,children:Object(J.jsx)("div",{className:"print",children:Object(J.jsx)(ja,{core:i,config:a,actions:o,dispatch:u,record:c})})}):null}var ma=n(809),ga="SEARCHLAYERS_SET_LAYER";var va={SEARCHLAYERS_SET_LAYER:ga,searchlayers_set_layer:function(e,t){return{type:ga,control:e,layer:t}}},Oa={searchlayers:{SEARCHLAYERS_SET_LAYER:function(e,t){var n={};return e[t.control]?n[t.control]=Object(Y.a)(Object(Y.a)({},e[t.control]),{},{layers:[t.layer]}):(n={})[t.control]={layers:[t.layer]},Object.assign({},Object(Y.a)({},e),n)}}},_a=n(70),xa=n(564),ya=n(125),wa=n.n(ya),Ea=n(62),Sa=(n(747),function(e,t,n,r,i,a,o){return e.map((function(e,c){return Object(J.jsx)("div",{className:o?"p-field ".concat(o):"p-field",children:Object(J.jsx)(_a.JsonFormsDispatch,{uischema:e,schema:t,path:n,enabled:r,renderers:i,cells:a})},"".concat(n,"-").concat(c))}))}),Pa=Object(Ea.rankWith)(3,Object(Ea.uiTypeIs)("VerticalLayout")),Aa=function(e){e.visible;var t=e.elements,n=e.schema,r=e.path,i=e.enabled,a=(e.direction,e.renderers),o=e.cells;return wa()(t)?null:Object(J.jsx)("div",{className:"p-fluid p-jsonform",children:Sa(t,n,r,i,a,o)})},Ca=Object(_a.withJsonFormsLayoutProps)((function(e){var t=e.uischema,n=e.schema,r=e.path,i=e.enabled,a=e.visible,o=e.renderers,c=e.cells,s={elements:t.elements,schema:n,path:r,enabled:i,direction:"column",visible:a};return Object(J.jsx)(Aa,Object(Y.a)(Object(Y.a)({},s),{},{renderers:o,cells:c}))})),Ta=Object(Ea.rankWith)(3,Object(Ea.uiTypeIs)("HorizontalLayout")),Ra=function(e){e.visible;var t=e.elements,n=e.schema,r=e.path,i=e.enabled,a=(e.direction,e.renderers),o=e.cells;return wa()(t)?null:Object(J.jsx)("div",{className:"p-fluid p-formgrid p-grid p-jsonform",children:Sa(t,n,r,i,a,o,"p-col")})},Na=Object(_a.withJsonFormsLayoutProps)((function(e){var t=e.uischema,n=e.schema,r=e.path,i=e.enabled,a=e.visible,o=e.renderers,c=e.cells,s={elements:t.elements,schema:n,path:r,enabled:i,direction:"row",visible:a};return Object(J.jsx)(Ra,Object(Y.a)(Object(Y.a)({},s),{},{renderers:o,cells:c}))})),ka=n(256),Ia=function(e){if(0!==e.indexOf("http"))return!0;var t=new URL(window.location.href),n=new URL(e);return t.origin===n.origin},Ma=function(e){if(0!==e.indexOf("http"))return!0;var t=new URL(window.location.href),n=new URL(e);return t.hostname===n.hostname},La=function(e){var t=e.core,n=e.cfg,r=e.viewer,i=e.auth,a="".concat(n.feature_prefix,":").concat(n.feature_type),o=n.source_url+(n.source_url.indexOf("?")>-1?"":"?");(o="".concat(o,"&service=WFS&version=2.0.0&request=DescribeFeatureType&typeName=").concat(a,"&outputFormat=application/json"),Ma(o)&&r.integrated_authentication)&&(i&&i.data&&i.data.auth_token&&(o=o+"&"+((null===r||void 0===r?void 0:r.integrated_authentication_key)||"authkey")+"="+i.data.auth_token));return Ia(o)||(o=t.MAP_PROXY_URL+encodeURIComponent(o)),fetch(o).then((function(e){return e.json()})).then((function(e){var t=function(e){var t={};return e.properties.forEach((function(e){switch(e.localType.toLowerCase()){case"int":t[e.name]={type:"integer"};break;case"number":t[e.name]={type:"number"};break;case"bool":t[e.name]={type:"boolean"};break;case"string":t[e.name]={type:"string"}}})),{type:"object",properties:t}}(e.featureTypes[0]),n=function(e){var t=[];return Object.entries(e.properties).forEach((function(e){var n=Object(X.a)(e,2),r=n[0];n[1],t.push({type:"Control",scope:"#/properties/".concat(r)})})),{type:"VerticalLayout",elements:t}}(t),r=function(e){var t=null;return e.properties.forEach((function(e){"geometry"===e.localType.toLowerCase()&&(t=e.name)})),t}(e.featureTypes[0]),i={schema:t,uischema:n,geometry_field:r};return Promise.resolve(i)})).catch((function(e){return Promise.reject(e)}))},Fa=function(e){var t=e.core,n=e.cfg,r=e.schema,i=e.startIndex,a=e.maxFeatures,o=e.filter,c=e.sort,s=e.viewer,l=e.auth,u=n.source_url+(n.source_url.indexOf("?")>-1?"":"?");Ma(u)&&s.integrated_authentication&&(l&&l.data&&l.data.auth_token&&(u=u+"&"+((null===s||void 0===s?void 0:s.integrated_authentication_key)||"authkey")+"="+l.data.auth_token));Ia(u)||(u=t.MAP_PROXY_URL+encodeURIComponent(u));var d={srsName:"EPSG:4326",featureNS:n.feature_namespace,featurePrefix:n.feature_prefix,featureTypes:[n.feature_type],outputFormat:"application/json"};null!=i&&(d.startIndex=i),null!=a&&(d.maxFeatures=a);var p=null;if(n.fields_list&&Object.keys(n.fields_list).length>0?p=Object.keys(n.fields_list):r&&r.properties&&Object.keys(r.properties).length>0&&(p=Object.keys(r.properties)),p&&(!0===n.all_geometries&&n.geometry_field&&-1===Object.keys(p).indexOf(n.geometry_field)&&p.push(n.geometry_field),d.propertyNames=p),o&&Object.keys(o).length>0){var f=[];Object.entries(o).forEach((function(e){var t=Object(X.a)(e,2),n=t[0],i=t[1];i&&(r&&r.properties&&r.properties[n]&&"integer"===r.properties[n].type?f.push(Object(ka.c)(n,i)):f.push(Object(ka.d)(n,i,"*",".","!",!1)))}));var j=null;1===f.length?j=f[0]:f.length>1&&(j=ka.a.apply(void 0,f)),j&&(d.filter=j)}var h=(new Gt.a).writeGetFeature(d),b="http://www.opengis.net/ogc";h.setAttribute("xmlns:ogc",b);var m=new XMLSerializer,g=m.serializeToString(h),v=null;if(c&&Object.keys(c).length>0?v=Object(Y.a)({},c):n.sort&&Object.keys(n.sort).length>0&&(v=Object(Y.a)({},n.sort)),v&&Object.keys(v).length>0){var O=(new DOMParser).parseFromString(g,"text/xml"),_=O.getElementsByTagName("Query")[0],x=O.createElementNS(b,"ogc:SortBy");Object.entries(v).forEach((function(e){var t=Object(X.a)(e,2),n=t[0],r=t[1],i=O.createElementNS(b,"ogc:SortProperty"),a=O.createElementNS(b,"ogc:PropertyName");a.appendChild(O.createTextNode(n));var o=O.createElementNS(b,"ogc:SortOrder");o.appendChild(O.createTextNode(r)),i.appendChild(a),i.appendChild(o),x.appendChild(i)})),_.appendChild(x),g=m.serializeToString(O)}return fetch(u,{method:"POST",body:g}).then((function(e){return e.json()})).then((function(e){var t=(new le.a).readFeatures(e);return Promise.resolve({features:t,total:e.totalFeatures})})).catch((function(e){return Promise.reject(e)}))},Ua=function(e){var t=e.core,n=e.viewer,r=e.auth,i=e.cfg,a=e.featureId,o=e.crs,c=void 0===o?"EPSG:4326":o,s=e.format,l=void 0===s?"application/json":s,u=i.source_url;(u+=u.indexOf("?")<0?"?":"",u+="&service=WFS",u+="&request=GetFeature",u+="&typeNames="+(i.feature_prefix?i.feature_prefix+":"+i.feature_type:i.feature_type),u+="&featureID="+a,u+="&srsName="+c,Ma(u+="&outputFormat="+l)&&n.integrated_authentication)&&(r&&r.data&&r.data.auth_token&&(u=u+"&"+((null===n||void 0===n?void 0:n.integrated_authentication_key)||"authkey")+"="+r.data.auth_token));return Ia(u)||(u=t.MAP_PROXY_URL+encodeURIComponent(u)),fetch(u).then((function(e){return e.json()})).then((function(e){return Promise.resolve(e)})).catch((function(e){return Promise.reject(e)}))},Ga=n(316);function Da(e){var t=e.core,n=e.viewer,r=e.auth,i=e.actions,a=e.dispatch,o=e.mainMap,c=e.layer,s=e.searchConfig,l=e.doSearch,u=e.results,d=e.pubsub?e.pubsub:{},p=d.publish,f=(d.subscribe,Object(H.useState)([])),j=Object(X.a)(f,2),h=j[0],b=j[1],m=Object(H.useState)([]),g=Object(X.a)(m,2),v=g[0],O=g[1],_=Object(H.useState)(null),x=Object(X.a)(_,2),y=x[0],w=x[1],E=Object(H.useState)(null),S=Object(X.a)(E,2),P=S[0],A=S[1],C=Object(H.useState)(null),T=Object(X.a)(C,2),R=T[0],N=T[1];function k(){var e=c.current.getSource().getExtent();if(e){var t=500;e=[e[0]-t,e[1]-t,e[2]+t,e[3]+t],a(i.map_set_extent(Object(Kt.w)(e),e))}}Object(H.useEffect)((function(){if(!u&&!u.features&&!u.features.length>0)return b([]),O([]),A(null),void N(null);var e=[];u.features.forEach((function(t){var n=t.getProperties();n=Object(Y.a)({id_:t.getId()},n),e.push(n)}));var t=[];if(u&&u.features&&u.features.length>0&&(t=u.features[0].getKeys().filter((function(e){return"geometry"!==e.toLowerCase()}))),b(e),O(t),(0===u.startIndex&&u.total<u.maxFeatures||u.total>=u.maxFeatures)&&w(u.total),u.sort&&Object.keys(u.sort).length>0){var n=Object.keys(u.sort)[0];A(n),N("ASC"===u.sort[n]?1:-1)}}),[u]);var I={layout:"RowsPerPageDropdown CurrentPageReport",RowsPerPageDropdown:function(e){return Object(J.jsxs)(J.Fragment,{children:[Object(J.jsx)("span",{className:"p-mx-1",style:{color:"var(--text-color)",userSelect:"none"},children:"Registos: "}),Object(J.jsx)(nr.a,{value:u.maxFeatures,options:[{label:10,value:10},{label:20,value:20},{label:50,value:50}],onChange:function(e){return l(0,e.value,u.filter,u.sort)}})]})},CurrentPageReport:function(e){return Object(J.jsxs)("span",{style:{color:"var(--text-color)",userSelect:"none",width:"120px",textAlign:"center"},children:[u.startIndex+1," - ",u.startIndex+h.length," de ",e.totalRecords]})}},M={layout:"CurrentPageReport",CurrentPageReport:function(e){return Object(J.jsxs)("span",{style:{color:"var(--text-color)",userSelect:"none",width:"120px",textAlign:"center"},children:[e.totalRecords," registos"]})}},L=function(){var e=null==s.pagination||!0===s.pagination;return u&&0===u.startIndex&&u.total<=1&&(e=!1),e},F=function(e,t){var n=t,r=n&&n.match?n.match(/[^{}]+(?=})/g):null;if(r)if(1===r.length){var i=r[0];i in e&&(n=e[i])}else r.forEach((function(t){n=n.replace("{".concat(t,"}"),e[t]||"")}));return n};return Object(J.jsxs)(J.Fragment,{children:[Object(J.jsxs)(Nn.a,Object(Y.a)(Object(Y.a)({value:h,lazy:!0},{paginator:L(),paginatorTemplate:!1===s.pagination?M:I}),{},{first:u.startIndex,rows:u.maxFeatures,totalRecords:y,sortField:P,sortOrder:R,onSort:function(e){var t={};t[e.sortField]=1===e.sortOrder?"ASC":"DESC",l(0,u.maxFeatures,u.filter,t)},paginatorClassName:"p-jc-end",className:"p-mt-4",children:[v&&v.length>0&&Object(J.jsx)(kn.a,{body:function(e){return Object(J.jsx)(z.a.Fragment,{children:Object(J.jsx)(bt.a,{icon:"pi pi-search",className:"p-button-rounded p-button-text p-mr-2",onClick:function(){if(c.current.getSource().clear(),null==e.geometry)Ua({cfg:s,featureId:e.id_,core:t,viewer:n,auth:r}).then((function(e){if(e.features&&!(!e.features.length>0)){var t={dataProjection:"EPSG:4326",featureProjection:o.getView().getProjection().getCode()},n=new le.a(t).readFeatures(e);c.current.getSource().addFeatures(n),k()}}));else{var i=e.geometry.clone().transform("EPSG:4326",o.getView().getProjection().getCode()),a=new or.a(Object(Y.a)(Object(Y.a)({},e),{},{geometry:i}));a.setId(e.id_),c.current.getSource().addFeature(a),k()}}})})},style:{width:"30px"}},0),function(e,t){return(e.fields_list&&Object.keys(e.fields_list).length>0?Object.entries(e.fields_list).map((function(e){var t=Object(X.a)(e,2),n=t[0];return[n,t[1].label||n]})):t.map((function(e){return[e,e]}))).map((function(t,n){var r=e.fields_sort&&e.fields_sort.length>0&&e.fields_sort.includes(t[0]),i=e.fields_list[t[0]];return i?"html"===i.type?Object(J.jsx)(kn.a,{field:t[0],header:t[1],sortable:r,body:function(e){return function(e,t){var n=t.value?t.value:e[t.name],r=n&&n.match?n.match(/[^{}]+(?=})/g):null;return r&&r.forEach((function(t){n=n.replace("{".concat(t,"}"),e[t]||"")})),Object(J.jsx)("div",{dangerouslySetInnerHTML:{__html:n}})}(e,Object(Y.a)(Object(Y.a)({},i),{},{name:t[0]}))}},n+1):"action"===i.type?Object(J.jsx)(kn.a,{field:t[0],header:t[1],sortable:r,body:function(e){return function(e,t){var n=Object(Y.a)({},t.action);if(t.action.data){var r={};Object.entries(t.action.data).forEach((function(t){var n=Object(X.a)(t,2),i=n[0],a=n[1];r[i]=F(e,a)})),n.data=r}var i=n.icon?n.label:n.label||"Abrir";i=F(e,i);var a=n.tooltip;a=F(e,a);var o=t.value?t.value:e[t.name];return o=F(e,o),!0===n.show_null||null!=o?Object(J.jsx)(bt.a,{label:i,icon:n.icon,className:n.classname||n.className,title:a,onClick:function(e){return p(n.type,n.data)}}):null}(e,Object(Y.a)(Object(Y.a)({},i),{},{name:t[0]}))}},n+1):Object(J.jsx)(kn.a,{field:t[0],header:t[1],sortable:r,body:function(e){return function(e,t){var n=t.value?t.value:e[t.name],r=n&&n.match?n.match(/[^{}]+(?=})/g):null;return r&&r.forEach((function(t){n=n.replace("{".concat(t,"}"),e[t]||"")})),n}(e,Object(Y.a)(Object(Y.a)({},i),{},{name:t[0]}))}},n+1):Object(J.jsx)(kn.a,{field:t[0],header:t[1],sortable:r},n+1)}))}(s,v).map((function(e){return e}))]})),L()&&Object(J.jsx)(Ga.a,{first:u.startIndex,rows:u.maxFeatures,totalRecords:y,pageLinkSize:3,onPageChange:function(e){l(e.first,u.maxFeatures,u.filter,u.sort)},style:{fontSize:".8rem"}})]})}var Va=null,Wa=[].concat(Object(ae.a)(xa.vanillaRenderers),[{tester:Pa,renderer:Ca},{tester:Ta,renderer:Na}]);function Ha(e){var t=e.core,n=e.viewer,r=e.auth,i=e.actions,a=e.pubsub,o=e.dispatch,c=e.mainMap,s=e.Models,l=e.layers,u=e.layer,d=e.searchConfig,p=e.schemaConfig,f=e.updateLayerSchema,j=e.goPanelSearchPrev,h=s.Utils.showOnPortal,b=p||{},m=b.schema,g=void 0===m?{}:m,v=b.uischema,O=void 0===v?{}:v,_=b.geometry_field,x=null===d||void 0===d?void 0:d.id,y=Object(H.useState)(!1),w=Object(X.a)(y,2),E=w[0],S=w[1],P=Object(H.useState)(null),A=Object(X.a)(P,2),C=A[0],T=A[1],R=Object(H.useState)({}),N=Object(X.a)(R,2),k=N[0],I=N[1],M=Object(H.useState)({}),L=Object(X.a)(M,2),F=L[0],U=L[1];Object(H.useEffect)((function(){T(null),g&&Object.keys(g).length>0&&O&&Object.keys(O).length?S(!0):(S(!1),e.setBlockedPanel(!0),La({cfg:d,core:t,viewer:n,auth:r}).then((function(e){try{f(x,e)}catch(t){return Promise.reject(t)}S(!0)})).catch((function(e){console.log(e),T({message:"N\xe3o foi poss\xedvel obter informa\xe7\xe3o do tema"})})).finally((function(){e.setBlockedPanel(!1)})))}),[x]);var G=function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0,c=arguments.length>3?arguments[3]:void 0,s=null,l=null;null!=d.pagination&&!0!==d.pagination||(s=i,l=a||d.maxFeatures||10);var p=Object(Y.a)({geometry_field:_},d);e.setBlockedPanel(!0),Fa({core:t,cfg:p,schema:g,startIndex:s,maxFeatures:l,filter:o,sort:c,viewer:n,auth:r}).then((function(e){var t=Object(Y.a)({},F);t[x]={filter:o||{},sort:c||{},startIndex:i,maxFeatures:l,total:e.total,features:e.features},u&&u.current&&u.current.getSource().clear(),U(t)})).catch((function(e){console.log(e),Va.show({severity:"error",summary:"Ocorreu um erro",detail:"N\xe3o foi poss\xedvel realizar a pesquisa",sticky:!0})})).finally((function(){return e.setBlockedPanel(!1)}))};return Object(J.jsxs)(J.Fragment,{children:[h(Object(J.jsx)(ui.a,{ref:function(e){return Va=e}})),j&&Object(J.jsx)("div",{className:"p-mt-2",children:Object(J.jsx)("div",{className:"p-grid",children:Object(J.jsx)("div",{className:"p-col p-text-left",children:Object(J.jsx)(bt.a,{label:"Voltar",icon:"pi pi-chevron-left",className:"p-button-sm",onClick:function(e){j()}})})})}),Object(J.jsx)("div",{className:"p-mt-2",children:d.title}),Object(J.jsx)("hr",{}),C&&Object(J.jsx)(z.a.Fragment,{children:Object(J.jsx)(mt.a,{severity:"warn",text:C.message})}),E&&Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsx)("div",{className:"p-mt-3",children:Object(J.jsx)(_a.JsonForms,{schema:g,uischema:O,data:k[x],renderers:Wa,cells:xa.vanillaCells,onChange:function(e){var t=e.data,n=(e._errors,Object(Y.a)({},k));n[x]=t,I(n)}})}),Object(J.jsxs)("div",{className:"p-text-center",children:[Object(J.jsx)(bt.a,{onClick:function(){var e=Object(Y.a)({},k);e[x]={},I(e);var t=Object(Y.a)({},F);t[x]=null,U(t),u&&u.current&&u.current.getSource().clear()},className:"p-mr-2",color:"primary",children:"Limpar"}),Object(J.jsx)(bt.a,{onClick:function(e){var t=function(e,t,n){if(!t||!n)return t;var r={};Object.entries(t).forEach((function(e){var t=Object(X.a)(e,2),n=t[0],i=t[1],a="number"==typeof i&&Number.isNaN(i)?null:i+"";null!==a&&""!==a&&(r[n]=i)}));var i=Object.entries(r).map((function(e){var t=Object(X.a)(e,2),i=t[0],a=t[1],o=a;return i in n&&n[i].expression&&(o=n[i].expression.replace("{value}",a),Object.entries(r).forEach((function(e){var t=Object(X.a)(e,2),n=t[0],r=t[1];o=o.replace("{"+n+"}",r)}))),Object(la.a)({},i,o)})).reduce((function(e,t){return Object.assign(e,t)}),{}),a=Object.entries(n).filter((function(n){var r=Object(X.a)(n,2),i=r[0];r[1];return!(i in(t||{}))&&!(i in((null===e||void 0===e?void 0:e.properties)||{}))})).map((function(e){var t=Object(X.a)(e,2),n=t[0],i=t[1].expression;return Object.entries(r).forEach((function(e){var t=Object(X.a)(e,2),n=t[0],r=t[1];i=i.replace("{"+n+"}",r)})),Object(la.a)({},n,i)})).reduce((function(e,t){return Object.assign(e,t)}),{});return Object(Y.a)(Object(Y.a)({},a),i)}(g,k[x],d.fields_form);G(0,null,t)},color:"primary",children:"Pesquisar"})]}),F&&F[x]&&0===F[x].total&&Object(J.jsx)("div",{className:"p-mt-4",style:{textAlign:"center"},children:Object(J.jsx)(mt.a,{severity:"info",text:"Pesquisa sem resultados"})}),F&&F[x]&&F[x].total>0&&Object(J.jsx)(Da,{core:t,viewer:n,auth:r,actions:i,pubsub:a,dispatch:o,mainMap:c,layers:l,layer:u,searchConfig:d,results:F[x],doSearch:G})]})]})}function za(e){var t=e.core,n=e.config,r=e.layer,i=e.layers,a=e.actions,o=e.pubsub,c=e.dispatch,s=e.mainMap,l=e.Models,u=e.record,d=n.viewer,p=n.auth,f=u.config_json?Object(Y.a)({show_icon:!0},u.config_json):{show_icon:!0},j=f.show_icon,h=Object(H.useState)(null),b=Object(X.a)(h,2),m=b[0],g=b[1],v=Object(H.useState)({}),O=Object(X.a)(v,2),_=O[0],x=O[1];Object(H.useEffect)((function(){1!==i.length||f.show_main||g(i[0])}),[i,f.show_main]);if(m){var y=null;m.schema&&(y={schema:Object(Y.a)({},m.schema),uischema:Object(Y.a)({},m.uischema)}),_[m.id]&&(y=Object(Y.a)({},_[m.id]));var w=!!(f.layers&&f.layers.length>1||!0===f.show_main);return Object(J.jsx)(Ha,{core:t,viewer:d,auth:p,actions:a,pubsub:o,dispatch:c,mainMap:s,Models:l,layers:i,layer:r,searchConfig:m,schemaConfig:y,updateLayerSchema:function(e,t){var n=Object(Y.a)({},_);n[e]=t,x(n)},goPanelSearchPrev:w&&function(e){r.current.getSource().clear(),g(null)},setBlockedPanel:e.setBlockedPanel})}return f.layers&&f.layers.length>1||!0===f.show_main?Object(J.jsx)("div",{children:f.layers.map((function(e,t){var n={pi:!e.icon,"p-mt-3":!0};n[e.icon]=!!e.icon,n["pi-bars"]=!e.icon;var r=Object(J.jsx)("div",{style:{cursor:"pointer"},title:e.tooltip,onClick:function(t){return g(e)},children:Object(J.jsx)("i",{className:Q()(n),style:{fontSize:"3em"}})}),i=Object(J.jsx)("div",{style:{cursor:"pointer"},title:e.tooltip,onClick:function(t){return g(e)},children:e.title});return Object(J.jsx)(Un.a,{header:j&&r,title:i,subTitle:e.subtitle&&e.subtitle,style:{marginBottom:"2em"},onClick:function(e){return console.log(e)},children:Object(J.jsx)("div",{className:"p-m-0",dangerouslySetInnerHTML:{__html:e.description||""}})},t)}))}):Object(J.jsx)(J.Fragment,{})}var Ka=new ue.c({stroke:new fe.a({color:"#ff0000",width:3}),image:new de.a({radius:4,fill:new pe.a({color:"#ff0000"}),stroke:new fe.a({color:"#fff",width:2})})});function Ba(e,t,n,r){var i=function(e,t){var n;return Ya(t.getLayers(),(function(t){t.get("id")===e&&(n=t)})),n}(t,n);i?e.current=i:(e.current=new wt.a({id:t,renderMode:"vector",source:new It.a({}),style:r?qa(r):Ka,selectable:!1}),n.addLayer(e.current))}function Ya(e,t){e.forEach((function(e){t(e),e instanceof se.b&&Ya(e.getLayers(),t)}))}var qa=function(e){var t=e.fill,n=e.stroke,r=e.image,i=Ka.clone();try{if(t&&i.setFill(new pe.a(t)),n&&i.setStroke(new fe.a(n)),r){var a=r.radius,o=r.displacement,c=r.scale,s=r.rotation,l=r.rotateWithView,u=new de.a({fill:r.fill?new pe.a(r.fill):null,stroke:r.stroke?new fe.a(r.stroke):null,radius:a,displacement:o,scale:c,rotation:s,rotateWithView:l});i.setImage(u)}}catch(d){console.log(d)}return i};n(1394);function Xa(e){var t=e.className,n=e.config,r=e.actions,i=e.record,a=(i.config_json,i.title||"Pesquisar Temas"),o=i.icon||"pi pi-search";return"child"!==i.mode?Object(J.jsx)(bt.a,{title:a,className:t,icon:o,style:{margin:"0.5em 1em"},onClick:function(e){return n.dispatch(r.viewer_set_selectedmenu(i.id))}}):null}var Ja=Object(Y.a)({},va),Za=Object(Y.a)({},Oa);function $a(e){var t=e.as,n=e.core,r=e.config,i=e.actions,a=e.record,o=r.viewer,c=r.dispatch,s=r.mainMap,l=r.Models,u=o.config_json.selected_menu,d=a.config_json||{},p=a.title||"Pesquisar Temas",f=d.header||p,j=!0===d.exclusive_layer?a.id:"searchlayers",h=Object(H.useRef)(),b=Object(H.useRef)(null),m=Object(H.useState)(!1),g=Object(X.a)(m,2),v=g[0],O=g[1],_=Object(H.useState)(d.layers||[]),x=Object(X.a)(_,2),y=x[0],w=x[1],E=Object(q.d)((function(e){return(null===e||void 0===e?void 0:e.searchlayers)||{}}));Object(H.useEffect)((function(){s&&Ba(h,j,s,d.style)}),[s]),Object(H.useEffect)((function(){}),[u]),Object(H.useEffect)((function(){if(E&&E[a.id]){var e=E[a.id].layers.map((function(e){return Object(Y.a)({id:e.id,title:e.title,description:e.description},e.datatable)}));w(e)}}),[E,a.id]);return"panel"===t?Object(J.jsxs)("div",{ref:b,className:"p-blockui-container",style:{height:"calc(100%)"},children:[Object(J.jsx)(Fn.a,{header:f,children:Object(J.jsx)("div",{className:"search-layers",children:Object(J.jsx)(za,{core:n,config:r,layer:h,layers:y,actions:i,pubsub:n.pubsub,dispatch:c,mainMap:s,record:a,Models:l,setBlockedPanel:O})})}),v&&Object(J.jsx)("div",{className:"p-blockui p-component-overlay p-component-overlay-enter",style:{zIndex:1003,height:function(){var e=b.current,t=0,n=0;try{t=e.clientHeight;var r=e.style.overflow,i=e.style.height;e.style.overflow="",e.style.height="",n=e.offsetHeight,e.style.height=i,e.style.overflow=r}catch(a){}return t>n?t:n}()},children:Object(J.jsx)(ma.a,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"#EEEEEE",animationDuration:".5s"})})]}):null}var Qa=n(567);n(1395);function eo(e){var t=e.core,n=e.viewer,r=e.mainMap,i=e.dispatch,a=e.actions,o=e.record,c=e.utils,s=n.exclusive_mapcontrol,l=(a.viewer_update_mapcontrol,a.viewer_set_selectedmenu,a.map_set_extent,a.viewer_set_exclusive_mapcontrol),u=c.getWindowSize,d=c.showOnPortal,p=Object(H.useState)(!1),f=Object(X.a)(p,2),j=f[0],h=f[1],b=Object(H.useState)(),m=Object(X.a)(b,2),g=m[0],v=m[1],O=Object(H.useState)(),_=Object(X.a)(O,2),x=(_[0],_[1],Object(H.useRef)()),y=Object(H.useRef)(),w=Object(H.useRef)(),E=u()[0]<=768,S=o.config_json||{},P=o.title||"Google StreetView",A=S.header||P,C=new ue.c({fill:new pe.a({color:"rgba(255, 0, 0, 0.2)"}),image:new Qa.a({src:t.CLIENT_URL+"assets/images/location-heading.svg",imgSize:[27,55]})}),T=function(e,n){var r=e.fill,i=e.stroke,a=e.image,o=C.clone();try{if(r&&o.setFill(new pe.a(r)),i&&o.setStroke(new fe.a(i)),a)if(a.icon){var c=a.icon,s=c.displacement,l=c.scale,u=c.color,d=c.rotateWithView,p=new Qa.a({imgSize:a.icon.imgSize||o.getImage().getSize(),src:a.icon.src?t.CLIENT_URL+a.icon.src:o.getImage().getSrc(),color:u,displacement:s,scale:l,rotation:n,rotateWithView:d});o.setImage(p)}else{var f=a.radius,j=a.displacement,h=a.scale,b=a.rotateWithView,m=new de.a({fill:a.fill?new pe.a(a.fill):null,stroke:a.stroke?new fe.a(a.stroke):null,radius:f,displacement:j,scale:h,rotateWithView:b});o.setImage(m)}}catch(g){console.log(g)}return o};function R(e){var t=Object(Wt.u)(e.coordinate,r.getView().getProjection().getCode(),"EPSG:4326");if(null!==y&&void 0!==y&&y.current){var n=y.current.getSource();if(n){n.clear();var i=new or.a({geometry:new cr.a(e.coordinate)});n.addFeature(i)}}if(null!==w&&void 0!==w&&w.current){var a=w.current.getPosition();console.log([a.lng(),a.lat()]);var o=new window.google.maps.LatLng(t[1],t[0]);console.log([o.lng(),o.lat()]),w.current.setPosition(o)}else v(t),h(!0)}return Object(H.useEffect)((function(){r&&(y.current=new wt.a({id:"streetview",renderMode:"vector",source:new It.a({}),selectable:!1}),y.current.setStyle(C),r.addLayer(y.current))}),[r]),Object(H.useEffect)((function(){if(s)return"StreetView"===s?r.on("singleclick",R):r.un("singleclick",R),function(){r.un("singleclick",R)}}),[s]),window.google&&window.google.maps?Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsx)("div",{id:"streetview",className:"streetview",children:Object(J.jsx)(bt.a,{title:P,icon:"fas fa-street-view",className:"StreetView"===s?"p-button-rounded p-button-raised active":"p-button-rounded p-button-raised",onClick:function(e){e.currentTarget.blur(),i(l("StreetView"))}})}),d(Object(J.jsx)(vt.a,{ref:x,header:A,visible:!!j,style:{width:E?"90%":"50vw",height:"80%"},modal:!1,onShow:function(){var e={position:new window.google.maps.LatLng(g[1],g[0]),pov:{heading:34,pitch:10}},t=x.current.contentEl,n=new window.google.maps.StreetViewPanorama(t,e);n.addListener("position_changed",(function(){var e=w.current.getPosition(),t=w.current.getPov(),n=Object(Wt.u)([e.lng(),e.lat()],"EPSG:4326",r.getView().getProjection().getCode());if(null!==y&&void 0!==y&&y.current){var i=y.current.getSource();if(i){var a,c;i.clear();var s=Math.PI/180*t.heading,l=T(null===o||void 0===o||null===(a=o.config_json)||void 0===a?void 0:a.style,s),u=new or.a({geometry:new cr.a(n)});if(u.setStyle(l),i.addFeature(u),null!==o&&void 0!==o&&null!==(c=o.config_json)&&void 0!==c&&c.tracking)if("extent"===o.config_json.tracking){var d=r.getView().calculateExtent(r.getSize());Object(Kt.h)(d,n[0],n[1])||r.getView().animate({center:n})}else"always"===o.config_json.tracking&&r.getView().animate({center:n})}}})),n.addListener("pov_changed",(function(){var e=w.current.getPosition(),t=w.current.getPov(),n=Object(Wt.u)([e.lng(),e.lat()],"EPSG:4326",r.getView().getProjection().getCode());if(null!==y&&void 0!==y&&y.current){var i=y.current.getSource();if(i){var a;i.clear();var c=Math.PI/180*t.heading,s=T(null===o||void 0===o||null===(a=o.config_json)||void 0===a?void 0:a.style,c),l=new or.a({geometry:new cr.a(n)});l.setStyle(s),i.addFeature(l)}}})),w.current=n},onResizeEnd:function(){window.google.maps.event.trigger(w.current,"resize")},onHide:function(e){if(null!==y&&void 0!==y&&y.current){var t=y.current.getSource();t&&t.clear()}null!==w&&void 0!==w&&w.current&&(w.current=null),h(!1),"StreetView"===s&&i(l(null))}}))]}):null}function to(e){e.className,e.config,e.actions,e.record;return z.a.Fragment}function no(e){var t=e.as,n=e.core,r=e.config,i=e.utils,a=e.record,o=r.actions,c=r.mainMap,s=r.viewer,l=r.dispatch,u=a.config_json||{},d=a.title||"Google StreetView",p=u.header||d;function f(){return Object(J.jsx)("div",{title:d,children:Object(J.jsx)(eo,{core:n,viewer:s,actions:o,dispatch:l,mainMap:c,record:a,utils:i})})}return"panel"===t?Object(J.jsx)(Fn.a,{header:p,children:f()}):f()}var ro=n(810);function io(e){var t=e.types,n=Object(H.useState)(e.wizardData.type),r=Object(X.a)(n,2),i=r[0],a=r[1];return Object(J.jsxs)("div",{children:[Object(J.jsx)("div",{className:"p-mt-2",children:t.map((function(e){return Object(J.jsxs)("div",{className:"p-field-radiobutton",children:[Object(J.jsx)(ar.a,{id:"wizard_type"+e.value,value:e.value,name:"type",onChange:function(e){return a(e.value)},checked:i===e.value}),Object(J.jsx)("label",{htmlFor:"wizard_type"+e.value,children:e.label})]},e.value)}))}),Object(J.jsx)("div",{style:{padding:"0.571rem 1rem",textAlign:"right"},children:Object(J.jsx)(bt.a,{disabled:!i,onClick:function(t){var n=e.initialData,r=n.type;n.type=i,r!==i&&(n.items=[],n.dataitems=[],n.url=""),e.onSave(n)},label:"Seguinte"})})]})}var ao=n(1405),oo=[{key:"default",value:"default",label:"Especificada pela Servi\xe7o"},{key:"1.1.0",value:"1.1.0",label:"1.1.0"},{key:"1.1.1",value:"1.1.1",label:"1.1.1"},{key:"1.3.0",value:"1.3.0",label:"1.3.0"}],co=function(e){Object(ne.a)(n,e);var t=Object(re.a)(n);function n(e){var r;return Object(ee.a)(this,n),(r=t.call(this,e)).state={showAdvanceOptions:!1},r}return Object(te.a)(n,[{key:"loadWMSCapabilities",value:function(){var e=this.props,t=e.core,n=e.auth,r=e.mainMap,i=e.viewer,a=e.data,o=e.setLoading,c=e.setData,s=e.setError,l=e.cookies,u=e.Models,d=u.Utils,p=d.isUrlAppOrigin,f=d.isUrlAppHostname,j=d.rememberUrl,h=d.removeUrlParam;if(a.url){var b={srid:u.MapModel.getProjectionSrid(r.getView().getProjection()),bbox:i.config_json.full_extent||i.config_json.restricted_extent||r.getView().calculateExtent(),ignore_url:a.wmsIgnoreServiceUrl,version:a.wmsVersion,tiled:a.wmsTiled},m=a.url;if(m=h(m,"request"),m=h(m,"service"),m=h(m,"version"),m+=m.indexOf("?")>-1?"":"?",m+="&SERVICE=WMS&REQUEST=GetCapabilities",a.wmsVersion&&"default"!==a.wmsVersion&&(m=m+"&VERSION="+a.wmsVersion),f(m)&&i.integrated_authentication)if(n&&n.data&&n.data.auth_token)m=m+"&"+((null===i||void 0===i?void 0:i.integrated_authentication_key)||"authkey")+"="+n.data.auth_token;p(m)||(m=t.MAP_PROXY_URL+encodeURIComponent(m)),o(!0),fetch(m).then((function(e){if(!e.ok)throw Error(e.statusText);return e})).then((function(e){return e.text()})).then((function(e){try{var t=(new ao.a).read(e),n=u.OWSModel.convertWMS2Themes(t,a.url,b);c(Object(Y.a)(Object(Y.a)({},a),{},{dataitems:n})),l&&j(l,"wms",a.url),o(!1)}catch(r){o(!1),s(""+r)}})).catch((function(e){c(Object(Y.a)(Object(Y.a)({},a),{},{dataitems:[]})),o(!1),s(""+e)}))}}},{key:"componentDidMount",value:function(){var e=this.props.data;"wms"===e.dataType&&e.url&&this.loadWMSCapabilities()}},{key:"render",value:function(){var e=this,t=this.props,n=t.loading,r=t.data,i=t.editField,a=t.getUrlHistory,o=(t.winSize,r.wmsIgnoreServiceUrl),c=r.wmsVersion,s=r.wmsTiled,l=this.state.showAdvanceOptions;return Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsxs)("div",{className:"p-inputgroup",children:[Object(J.jsx)(jt.a,{placeholder:"http://...",value:r.url,list:"urlhistory",onChange:function(e){return i("url",e.target.value.trim())}}),Object(J.jsx)(bt.a,{icon:n?"pi pi-spin pi-spinner":"pi pi-search",tooltip:"Carregar",tooltipOptions:{position:"bottom"},disabled:n,onClick:function(t){t.preventDefault(),e.loadWMSCapabilities()}})]}),Object(J.jsx)("datalist",{id:"urlhistory",children:a().map((function(e,t){return Object(J.jsx)("option",{value:e},t)}))}),Object(J.jsx)(Vr.a,{activeIndex:l?0:-1,className:"p-pt-2",children:Object(J.jsx)(Vr.b,{header:"Op\xe7\xf5es Avan\xe7adas",children:Object(J.jsxs)("div",{className:"p-fluid",children:[Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{className:"p-col-12 p-md-7",children:"Vers\xe3o"}),Object(J.jsx)("div",{className:"p-col-12 p-md-5",children:Object(J.jsx)(nr.a,{options:oo,value:c,onChange:function(e){return i("wmsVersion",e.value)}})})]}),Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{className:"p-col-12 p-md-7",children:"Ignorar URL do servi\xe7o"}),Object(J.jsx)("div",{className:"p-col-12 p-md-5",style:{textAlign:"right"},children:Object(J.jsx)(gt.a,{id:"Ignorar URL do servi\xe7o",checked:o,onChange:function(e){return i("wmsIgnoreServiceUrl",!o)}})})]}),Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{className:"p-col-12 p-md-7",children:"Usar quadr\xedculas"}),Object(J.jsx)("div",{className:"p-col-12 p-md-5",style:{textAlign:"right"},children:Object(J.jsx)(gt.a,{id:"Usar quadr\xedculas",checked:s,onChange:function(e){return i("wmsTiled",!s)}})})]})]})})})]})}}]),n}(H.Component),so=n(1410),lo=[{key:"default",value:"default",label:"Especificada pelo Servi\xe7o"},{key:"1.0.0",value:"1.0.0",label:"1.0.0"}],uo=function(e){Object(ne.a)(n,e);var t=Object(re.a)(n);function n(e){var r;return Object(ee.a)(this,n),(r=t.call(this,e)).state={showAdvanceOptions:!1},r}return Object(te.a)(n,[{key:"loadWMTSCapabilities",value:function(){var e=this.props,t=e.core,n=e.auth,r=e.mainMap,i=e.viewer,a=e.data,o=e.setLoading,c=e.setData,s=e.setError,l=e.cookies,u=e.Models,d=u.Utils,p=d.isUrlAppOrigin,f=d.isUrlAppHostname,j=d.rememberUrl,h=d.removeUrlParam;if(a.url){var b={srid:u.MapModel.getProjectionSrid(r.getView().getProjection()),bbox:i.config_json.full_extent||i.config_json.restricted_extent||r.getView().calculateExtent(),ignore_url:a.wmtsIgnoreServiceUrl,version:a.wmtsVersion},m=a.url;if(m=h(m,"request"),m=h(m,"service"),m=h(m,"version"),m+=m.indexOf("?")>-1?"":"?",m+="&SERVICE=WMTS&REQUEST=GetCapabilities",a.wmtsVersion&&"default"!==a.wmtsVersion&&(m=m+"&VERSION="+a.wmtsVersion),f(m)&&i.integrated_authentication)if(n&&n.data&&n.data.auth_token)m=m+"&"+((null===i||void 0===i?void 0:i.integrated_authentication_key)||"authkey")+"="+n.data.auth_token;p(m)||(m=t.MAP_PROXY_URL+encodeURIComponent(m)),o(!0),fetch(m).then((function(e){if(!e.ok)throw Error(e.statusText);return e})).then((function(e){return e.text()})).then((function(e){try{var t=(new so.a).read(e);a.dataitems=u.OWSModel.convertWMTS2Themes(t,a.url,b),a.wmtsTileMatrixSet=[],t.Contents&&t.Contents.TileMatrixSet&&(a.wmtsTileMatrixSet=t.Contents.TileMatrixSet.map((function(e){return{Identifier:e.Identifier,SupportedCRS:e.SupportedCRS}}))),c(a),l&&j(l,"wmts",a.url),o(!1)}catch(n){s(""+n),o(!1)}})).catch((function(e){c(Object(Y.a)(Object(Y.a)({},a),{},{dataitems:[]})),s(""+e),o(!1)}))}}},{key:"componentDidMount",value:function(){var e=this.props.data;"wmts"===e.dataType&&e.url&&this.loadWMTSCapabilities()}},{key:"render",value:function(){var e=this,t=this.props,n=t.loading,r=t.data,i=t.editField,a=t.getUrlHistory,o=(t.winSize,r.wmtsIgnoreServiceUrl),c=r.wmtsVersion,s=this.state.showAdvanceOptions;return Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsxs)("div",{className:"p-inputgroup",children:[Object(J.jsx)(jt.a,{placeholder:"http://...",value:r.url,list:"urlhistory",onChange:function(e){return i("url",e.target.value.trim())}}),Object(J.jsx)(bt.a,{icon:n?"pi pi-spin pi-spinner":"pi pi-search",tooltip:"Carregar",tooltipOptions:{position:"bottom"},disabled:n,onClick:function(t){t.preventDefault(),e.loadWMTSCapabilities()}})]}),Object(J.jsx)("datalist",{id:"urlhistory",children:a().map((function(e,t){return Object(J.jsx)("option",{value:e},t)}))}),Object(J.jsx)(Vr.a,{activeIndex:s?0:-1,className:"p-pt-2",children:Object(J.jsx)(Vr.b,{header:"Op\xe7\xf5es Avan\xe7adas",children:Object(J.jsxs)("div",{className:"p-fluid",children:[Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{className:"p-col-12 p-md-7",children:"Vers\xe3o"}),Object(J.jsx)("div",{className:"p-col-12 p-md-5",children:Object(J.jsx)(nr.a,{options:lo,value:c,onChange:function(e,t){var n=t.value;return i("wmtsVersion",n)}})})]}),Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{className:"p-col-12 p-md-7",children:"Ignorar URL do servi\xe7o"}),Object(J.jsx)("div",{className:"p-col-12 p-md-5",style:{textAlign:"right"},children:Object(J.jsx)(gt.a,{id:"Ignorar URL do servi\xe7o",checked:o,onChange:function(e){return i("wmtsIgnoreServiceUrl",!o)}})})]})]})})})]})}}]),n}(H.Component),po=function(e){Object(ne.a)(n,e);var t=Object(re.a)(n);function n(){return Object(ee.a)(this,n),t.apply(this,arguments)}return Object(te.a)(n,[{key:"loadWFSCapabilities",value:function(){var e=this.props,t=e.core,n=e.auth,r=e.mainMap,i=e.viewer,a=e.data,o=e.setLoading,c=e.setData,s=e.setError,l=e.cookies,u=e.Models,d=u.Utils,p=d.isUrlAppOrigin,f=d.isUrlAppHostname,j=d.rememberUrl;if(a.url){var h={srid:u.MapModel.getProjectionSrid(r.getView().getProjection()),bbox:i.config_json.full_extent||i.config_json.restricted_extent||r.getView().calculateExtent()},b=a.url;if(b=(b=b.replace(/request=getcapabilities/gi,"")).replace(/service=wfs/gi,""),b+=b.indexOf("?")>-1?"":"?",f(b+="&SERVICE=WFS&REQUEST=GetCapabilities")&&i.integrated_authentication)if(n&&n.data&&n.data.auth_token)b=b+"&"+((null===i||void 0===i?void 0:i.integrated_authentication_key)||"authkey")+"="+n.data.auth_token;p(b)||(b=t.MAP_PROXY_URL+encodeURIComponent(b)),o(!0),fetch(b).then((function(e){if(!e.ok)throw Error(e.statusText);return e})).then((function(e){return e.text()})).then((function(e){Yt.a.parseString(e,(function(e,t){if(e)return console.error(e),s(""+e),void o(!1);a.dataitems=u.OWSModel.convertWFS2Themes(t,a.url,h),c(a),l&&j(l,"wfs",a.url),o(!1)}))})).catch((function(e){c(Object(Y.a)(Object(Y.a)({},a),{},{dataitems:[]})),s(""+e),o(!1)}))}}},{key:"componentDidMount",value:function(){var e=this.props.data;"wfs"===e.dataType&&e.url&&this.loadWFSCapabilities()}},{key:"render",value:function(){var e=this,t=this.props,n=t.loading,r=t.data,i=t.editField,a=t.getUrlHistory;t.winSize;return Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsxs)("div",{className:"p-inputgroup",children:[Object(J.jsx)(jt.a,{placeholder:"http://...",value:r.url,list:"urlhistory",onChange:function(e){return i("url",e.target.value.trim())}}),Object(J.jsx)(bt.a,{icon:n?"pi pi-spin pi-spinner":"pi pi-search",tooltip:"Carregar",tooltipOptions:{position:"bottom"},disabled:n,onClick:function(t){t.preventDefault(),e.loadWFSCapabilities()}})]}),Object(J.jsx)("datalist",{id:"urlhistory",children:a().map((function(e,t){return Object(J.jsx)("option",{value:e},t)}))})]})}}]),n}(H.Component),fo=po,jo=function(e){Object(ne.a)(n,e);var t=Object(re.a)(n);function n(e){var r;return Object(ee.a)(this,n),(r=t.call(this,e)).state={showAdvanceOptions:!1},r}return Object(te.a)(n,[{key:"loadArcGISMapCapabilities",value:function(){var e=this.props,t=e.core,n=(e.auth,e.mainMap),r=e.viewer,i=e.data,a=e.setLoading,o=e.setData,c=e.setError,s=e.cookies,l=e.Models,u=l.Utils,d=u.isUrlAppOrigin,p=(u.isUrlAppHostname,u.rememberUrl);u.removeUrlParam;if(i.url){var f={srid:l.MapModel.getProjectionSrid(n.getView().getProjection()),bbox:r.config_json.full_extent||r.config_json.restricted_extent||n.getView().calculateExtent(),tiled:i.wmsTiled},j="".concat(i.url,"?f=json"),h="".concat(i.url,"/layers?f=json");d(i.url)||(j=t.MAP_PROXY_URL+encodeURIComponent(j),h=t.MAP_PROXY_URL+encodeURIComponent(h)),a(!0),Promise.all([fetch(j).catch((function(e){return e})),fetch(h).catch((function(e){return e}))]).then(function(){var e=Object(_t.a)(Object(Ot.a)().mark((function e(t){var n,r;return Object(Ot.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={service:null,layers:null},!t[0].ok){e.next=5;break}return e.next=4,t[0].json();case 4:n.service=e.sent;case 5:if(!t[1].ok){e.next=10;break}return e.next=8,t[1].json();case 8:r=e.sent,n.layers=null!==r&&void 0!==r&&r.layers?null===r||void 0===r?void 0:r.layers:null;case 10:return e.abrupt("return",n);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(e){var t=l.OWSModel.convertArcGISMap2Themes(e,i.url,f);o(Object(Y.a)(Object(Y.a)({},i),{},{dataitems:t})),s&&p(s,"arcgismap",i.url),a(!1)})).catch((function(e){o(Object(Y.a)(Object(Y.a)({},i),{},{dataitems:[]})),a(!1),c(""+e)}))}}},{key:"componentDidMount",value:function(){var e=this.props.data;"arcgismap"===e.dataType&&e.url&&this.loadArcGISMapCapabilities()}},{key:"render",value:function(){var e=this,t=this.props,n=t.loading,r=t.data,i=t.editField,a=t.getUrlHistory,o=(t.winSize,r.wmsTiled),c=this.state.showAdvanceOptions;return Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsxs)("div",{className:"p-inputgroup",children:[Object(J.jsx)(jt.a,{placeholder:"http://...",value:r.url,list:"urlhistory",onChange:function(e){return i("url",e.target.value.trim())}}),Object(J.jsx)(bt.a,{icon:n?"pi pi-spin pi-spinner":"pi pi-search",tooltip:"Carregar",tooltipOptions:{position:"bottom"},disabled:n,onClick:function(t){t.preventDefault(),e.loadArcGISMapCapabilities()}})]}),Object(J.jsx)("datalist",{id:"urlhistory",children:a().map((function(e,t){return Object(J.jsx)("option",{value:e},t)}))}),Object(J.jsx)(Vr.a,{activeIndex:c?0:-1,className:"p-pt-2",children:Object(J.jsx)(Vr.b,{header:"Op\xe7\xf5es Avan\xe7adas",children:Object(J.jsx)("div",{className:"p-fluid",children:Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{className:"p-col-12 p-md-7",children:"Usar quadr\xedculas"}),Object(J.jsx)("div",{className:"p-col-12 p-md-5",style:{textAlign:"right"},children:Object(J.jsx)(gt.a,{id:"Usar quadr\xedculas",checked:o,onChange:function(e){return i("wmsTiled",!o)}})})]})})})})]})}}]),n}(H.Component),ho=jo,bo=function(e){Object(ne.a)(n,e);var t=Object(re.a)(n);function n(){return Object(ee.a)(this,n),t.apply(this,arguments)}return Object(te.a)(n,[{key:"loadShapeFile",value:function(e){var t=this.props,n=t.core,r=(t.mainMap,t.viewer),i=t.data,a=t.setLoading,o=t.setData,c=t.Models,s=t.fastFetch,l=c.Utils.isUrlAppOrigin,u=r.upload_url||n.UPLOAD_URL,d=e.files[0].name,p=e.files[0],f=new FormData;f.append("files",p),f.append("ext","json"),a(!0),s(u,{method:"POST",body:f},8e3).then((function(e){return e.json()})).then((function(e){if(a(!1),!e.Success)return a(!1);var t=n.API_URL+e.Data.url,r=t;l(r)||(r=n.MAP_PROXY_URL+encodeURIComponent(r)),fetch(r).then((function(e){return e.json()})).then((function(e){i.dataitems=c.OWSModel.convertGeoJSON2Themes(e,t,d,i.crs),o(Object.assign({},i)),a(!1)})).catch((function(e){console.error(e),a(!1)}))})).catch((function(e){console.error(e),a(!1)}))}},{key:"render",value:function(){var e=this.props,t=e.viewer,n=e.loading,r=e.data,i=e.editField;return Object(J.jsx)(z.a.Fragment,{children:Object(J.jsxs)("div",{className:"p-fluid",children:[Object(J.jsxs)("div",{className:"p-field",children:[Object(J.jsx)("label",{children:"Sistema de Coordenadas"}),Object(J.jsx)(nr.a,{placeholder:"Escolha o sistema de coordenadas",options:t.config_json.crs_list.map((function(e){return{value:String(e.srid),label:e.title}})),value:r.crs||"4326",onChange:function(e){return i("crs",e.value)}})]}),Object(J.jsxs)("div",{className:"p-field",children:[Object(J.jsx)("label",{children:"Ficheiro ZIP contendo os ficheiros SHP, DBF e SHX"}),Object(J.jsx)(Hn.a,{name:"upload",accept:"application/zip",maxFileSize:1024*this.props.maxFileSize,customUpload:!0,uploadHandler:this.loadShapeFile.bind(this),disabled:n,url:"./upload",chooseLabel:"Escolher",uploadLabel:"Carregar",cancelLabel:"Cancelar",invalidFileSizeMessageDetail:"",invalidFileSizeMessageSummary:"O ficheiro n\xe3o poder\xe1 ter mais de "+Math.round(this.props.maxFileSize/1024*100)/100+" MB"}),this.props.maxFileSize&&this.props.maxFileSize>0?Object(J.jsxs)("small",{id:"upload-help",className:"p-warn",children:["Dimens\xe3o m\xe1xima do ficheiro: ",Math.round(this.props.maxFileSize/1024*100)/100," MB"]}):null]})]})})}}]),n}(H.Component),mo=bo,go=function(e){Object(ne.a)(n,e);var t=Object(re.a)(n);function n(){return Object(ee.a)(this,n),t.apply(this,arguments)}return Object(te.a)(n,[{key:"loadGeoJSONFile",value:function(e){var t=this.props,n=t.core,r=(t.mainMap,t.viewer),i=t.data,a=t.setLoading,o=t.setData,c=t.setError,s=t.Models,l=t.fastFetch,u=s.Utils.isUrlAppOrigin,d=r.upload_url||n.UPLOAD_URL,p=e.files[0].name,f=e.files[0],j=new FormData;j.append("files",f),j.append("ext","json"),a(!0),l(d,{method:"POST",body:j},8e3).then((function(e){if(e&&e.ok)return e.json();throw new Error("N\xe3o foi poss\xedvel obter uma resposta v\xe1lida.")})).then((function(e){if(!e.Success)return c("Ocorreu um erro ao processar o ficheiro GeoJSON!"),a(!1);var t=n.API_URL+e.Data.url,r=t;u(r)||(r=n.MAP_PROXY_URL+encodeURIComponent(r)),fetch(r).then((function(e){return e.json()})).then((function(e){i.dataitems=s.OWSModel.convertGeoJSON2Themes(e,t,p,i.crs),o(Object.assign({},i)),a(!1)})).catch((function(e){a(!1),c(""+e)}))})).catch((function(e){a(!1),c(""+e)}))}},{key:"changeURL",value:function(e){var t=this.props,n=t.data,r=t.setData;n.url=e.trim(),r(Object.assign({},n))}},{key:"loadFromUserURL",value:function(){var e=this.props,t=e.core,n=e.data,r=e.setData,i=e.setSelected,a=e.setError,o=(e.cookies,e.setLoading),c=e.Models,s=c.Utils.isUrlAppOrigin,l=n.url||"";l.trim()&&(s(l)||(l=t.MAP_PROXY_URL+encodeURIComponent(l)),o(!0),fetch(l).then((function(e){if(e.ok)return e.json();throw new Error("N\xe3o foi poss\xedvel obter uma resposta v\xe1lida.")})).then((function(e){try{if(n.dataitems=c.OWSModel.convertGeoJSON2Themes(e,n.url,"GeoJSON",n.crs),!(n.dataitems&&n.dataitems.length>0))throw Error("N\xe3o foi poss\xedvel obter uma resposta v\xe1lida.");o(!1),r(Object.assign({},n))}catch(t){o(!1),a(""+t)}})).catch((function(e){r(Object(Y.a)(Object(Y.a)({},n),{},{dataitems:[]})),i({}),o(!1),a(""+e)})))}},{key:"render",value:function(){var e=this,t=this.props,n=t.viewer,r=t.loading,i=t.data,a=t.editField;t.winSize;return Object(J.jsx)(z.a.Fragment,{children:Object(J.jsxs)("div",{className:"p-fluid",children:[Object(J.jsxs)("div",{className:"p-field",children:[Object(J.jsx)("label",{children:"Sistema de Coordenadas"}),Object(J.jsx)(nr.a,{placeholder:"Escolha o sistema de coordenadas",options:n.config_json.crs_list.map((function(e){return{value:String(e.srid),label:e.title}})),value:i.crs||"4326",onChange:function(e){return a("crs",e.value)}})]}),Object(J.jsxs)(er.b,{children:[Object(J.jsx)(er.a,{header:"Ficheiro",children:Object(J.jsxs)("div",{className:"p-field",children:[Object(J.jsx)("label",{children:"Ficheiro GeoJSON"}),Object(J.jsx)(Hn.a,{name:"upload",accept:"application/json,.geojson",maxFileSize:1024*this.props.maxFileSize,customUpload:!0,uploadHandler:this.loadGeoJSONFile.bind(this),disabled:r,url:"./upload",chooseLabel:"Escolher",uploadLabel:"Carregar",cancelLabel:"Cancelar",invalidFileSizeMessageDetail:"",invalidFileSizeMessageSummary:"O ficheiro n\xe3o poder\xe1 ter mais de "+Math.round(this.props.maxFileSize/1024*100)/100+" MB"}),this.props.maxFileSize&&this.props.maxFileSize>0?Object(J.jsxs)("small",{id:"upload-help",className:"p-warn",children:["Dimens\xe3o m\xe1xima do ficheiro: ",Math.round(this.props.maxFileSize/1024*100)/100," MB"]}):null]})}),Object(J.jsx)(er.a,{header:"URL",children:Object(J.jsxs)("div",{className:"p-field",children:[Object(J.jsx)("label",{children:"URL"}),Object(J.jsxs)("div",{className:"p-inputgroup",children:[Object(J.jsx)(jt.a,{placeholder:"URL...",value:i.url,onChange:function(t){return e.changeURL(t.target.value)},style:{width:"100%"}}),Object(J.jsx)(bt.a,{icon:r?"pi pi-spin pi-spinner":"pi pi-search",tooltip:"Carregar",tooltipOptions:{position:"bottom"},disabled:r,onClick:function(t){t.preventDefault(),e.loadFromUserURL()}})]})]})})]})]})})}}]),n}(H.Component),vo=go,Oo=function(e){Object(ne.a)(n,e);var t=Object(re.a)(n);function n(e){var r;return Object(ee.a)(this,n),r=t.call(this,e),(0,e.editField)("crs",4326),r}return Object(te.a)(n,[{key:"loadKMLData",value:function(e,t){var n=this.props,r=n.core,i=(n.mainMap,n.viewer),a=n.data,o=n.setLoading,c=n.setData,s=n.setError,l=n.Models,u=n.fastFetch,d=l.Utils.isUrlAppOrigin,p=i.upload_url||r.UPLOAD_URL,f=new FormData;f.append("files",e),f.append("ext","kml"),o(!0),u(p,{method:"POST",body:f},8e3).then((function(e){return e.json()})).then((function(e){if(!e.Success)return s("Ocorreu um erro ao processar o ficheiro KML!"),o(!1);var n=r.API_URL+e.Data.url,i=n;d(i)||(i=r.MAP_PROXY_URL+encodeURIComponent(i)),fetch(i).then((function(e){return e.json()})).then((function(e){a.dataitems=l.OWSModel.convertGeoJSON2Themes(e,n,t,a.crs),c(Object.assign({},a)),o(!1)})).catch((function(e){o(!1),s(""+e)}))})).catch((function(e){o(!1),s(""+e)}))}},{key:"loadKMLFile",value:function(e){var t=e.files[0].name,n=e.files[0];this.loadKMLData(n,t)}},{key:"changeURL",value:function(e){var t=this.props,n=t.data,r=t.setData;n.url=e.trim(),r(Object.assign({},n))}},{key:"loadFromUserURL",value:function(){var e=this.props,t=e.core,n=e.data,r=e.setData,i=e.setSelected,a=e.setError,o=(e.cookies,e.setLoading),c=e.Models,s=c.Utils.isUrlAppOrigin,l=n.url||"";l.trim()&&(s(l)||(l=t.MAP_PROXY_URL+encodeURIComponent(l)),o(!0),fetch(l).then((function(e){return e.text()})).then((function(e){try{Object(Bt.parseString)(e,(function(t,i){if(n.dataitems=c.OWSModel.convertKML2Themes(i,n.url,e,n.crs),!(n.dataitems&&n.dataitems.length>0))throw Error("N\xe3o foi poss\xedvel obter uma resposta v\xe1lida.");o(!1),r(Object.assign({},n))}))}catch(t){o(!1),a(""+t)}})).catch((function(e){r(Object(Y.a)(Object(Y.a)({},n),{},{dataitems:[]})),i({}),o(!1),a(""+e)})))}},{key:"render",value:function(){var e=this,t=this.props,n=(t.viewer,t.loading),r=t.data;t.editField,t.winSize;return Object(J.jsx)(z.a.Fragment,{children:Object(J.jsx)("div",{className:"p-fluid",children:Object(J.jsxs)(er.b,{children:[Object(J.jsx)(er.a,{header:"Ficheiro",children:Object(J.jsxs)("div",{className:"p-field",children:[Object(J.jsx)("label",{children:"Ficheiro - KML/KMZ"}),Object(J.jsx)(Hn.a,{name:"upload",accept:".kml,.kmz",maxFileSize:1024*this.props.maxFileSize,customUpload:!0,uploadHandler:this.loadKMLFile.bind(this),disabled:n,url:"./upload",chooseLabel:"Escolher",uploadLabel:"Carregar",cancelLabel:"Cancelar",invalidFileSizeMessageDetail:"",invalidFileSizeMessageSummary:"O ficheiro n\xe3o poder\xe1 ter mais de "+Math.round(this.props.maxFileSize/1024*100)/100+" MB"}),this.props.maxFileSize&&this.props.maxFileSize>0?Object(J.jsxs)("small",{id:"upload-help",className:"p-warn",children:["Dimens\xe3o m\xe1xima do ficheiro: ",Math.round(this.props.maxFileSize/1024*100)/100," MB"]}):null]})}),Object(J.jsx)(er.a,{header:"URL",children:Object(J.jsxs)("div",{className:"p-field",children:[Object(J.jsx)("label",{children:"URL - KML"}),Object(J.jsxs)("div",{className:"p-inputgroup",children:[Object(J.jsx)(jt.a,{placeholder:"URL...",value:r.url,onChange:function(t){return e.changeURL(t.target.value)},style:{width:"100%"}}),Object(J.jsx)(bt.a,{icon:n?"pi pi-spin pi-spinner":"pi pi-search",tooltip:"Carregar",tooltipOptions:{position:"bottom"},disabled:n,onClick:function(t){t.preventDefault(),e.loadFromUserURL()}})]})]})})]})})})}}]),n}(H.Component),_o=function(e){Object(ne.a)(n,e);var t=Object(re.a)(n);function n(){return Object(ee.a)(this,n),t.apply(this,arguments)}return Object(te.a)(n,[{key:"loadGMLFile",value:function(e){var t=this.props,n=t.core,r=(t.mainMap,t.viewer),i=t.data,a=t.setLoading,o=t.setData,c=t.Models,s=t.fastFetch,l=c.Utils.isUrlAppOrigin,u=r.upload_url||n.UPLOAD_URL,d=e.files[0].name,p=e.files[0],f=new FormData;f.append("files",p),f.append("ext","xml"),a(!0),s(u,{method:"POST",body:f},8e3).then((function(e){return e.json()})).then((function(e){if(a(!1),!e.Success)return a(!1);var t=n.API_URL+e.Data.url,r=t;l(r)||(r=n.MAP_PROXY_URL+encodeURIComponent(r)),fetch(r).then((function(e){return e.json()})).then((function(e){i.dataitems=c.OWSModel.convertGeoJSON2Themes(e,t,d,i.crs),o(Object.assign({},i)),a(!1)})).catch((function(e){console.error(e),a(!1)}))})).catch((function(e){console.error(e),a(!1)}))}},{key:"render",value:function(){var e=this.props,t=e.viewer,n=e.loading,r=e.data,i=e.editField;return Object(J.jsx)(z.a.Fragment,{children:Object(J.jsxs)("div",{className:"p-fluid",children:[Object(J.jsxs)("div",{className:"p-field",children:[Object(J.jsx)("label",{children:"Sistema de Coordenadas"}),Object(J.jsx)(nr.a,{placeholder:"Escolha o sistema de coordenadas",options:t.config_json.crs_list.map((function(e){return{value:String(e.srid),label:e.title}})),value:r.crs||"4326",onChange:function(e){return i("crs",e.value)}})]}),Object(J.jsxs)("div",{className:"p-field",children:[Object(J.jsx)("label",{children:"Ficheiro GML"}),Object(J.jsx)(Hn.a,{name:"upload",accept:"text/xml",maxFileSize:1024*this.props.maxFileSize,customUpload:!0,uploadHandler:this.loadGMLFile.bind(this),disabled:n,url:"./upload",chooseLabel:"Escolher",uploadLabel:"Carregar",cancelLabel:"Cancelar",invalidFileSizeMessageDetail:"",invalidFileSizeMessageSummary:"O ficheiro n\xe3o poder\xe1 ter mais de "+Math.round(this.props.maxFileSize/1024*100)/100+" MB"}),this.props.maxFileSize&&this.props.maxFileSize>0?Object(J.jsxs)("small",{id:"upload-help",className:"p-warn",children:["Dimens\xe3o m\xe1xima do ficheiro: ",Math.round(this.props.maxFileSize/1024*100)/100," MB"]}):null]})]})})}}]),n}(H.Component),xo=_o,yo=function(e){Object(ne.a)(n,e);var t=Object(re.a)(n);function n(){return Object(ee.a)(this,n),t.apply(this,arguments)}return Object(te.a)(n,[{key:"loadDXFFile",value:function(e){var t=this.props,n=t.core,r=(t.mainMap,t.viewer),i=t.data,a=t.setLoading,o=t.setData,c=t.Models,s=t.fastFetch,l=c.Utils.isUrlAppOrigin,u=r.upload_url||n.UPLOAD_URL,d=e.files[0].name,p=e.files[0],f=new FormData;f.append("files",p),f.append("ext","dxf"),a(!0),s(u,{method:"POST",body:f},8e3).then((function(e){return e.json()})).then((function(e){if(a(!1),!e.Success)return a(!1);var t=n.API_URL+e.Data.url,r=t;l(r)||(r=n.MAP_PROXY_URL+encodeURIComponent(r)),fetch(r).then((function(e){return e.json()})).then((function(e){i.dataitems=c.OWSModel.convertGeoJSON2Themes(e,t,d,i.crs),o(Object.assign({},i)),a(!1)})).catch((function(e){console.error(e),a(!1)}))})).catch((function(e){console.error(e),a(!1)}))}},{key:"render",value:function(){var e=this.props,t=e.viewer,n=e.loading,r=e.data,i=e.editField;return Object(J.jsx)(z.a.Fragment,{children:Object(J.jsxs)("div",{className:"p-fluid",children:[Object(J.jsxs)("div",{className:"p-field",children:[Object(J.jsx)("label",{children:"Sistema de Coordenadas"}),Object(J.jsx)(nr.a,{placeholder:"Escolha o sistema de coordenadas",options:t.config_json.crs_list.map((function(e){return{value:String(e.srid),label:e.title}})),value:r.crs||"4326",onChange:function(e){return i("crs",e.value)}})]}),Object(J.jsxs)("div",{className:"p-field",children:[Object(J.jsx)("label",{children:"Ficheiro DXF"}),Object(J.jsx)(Hn.a,{name:"upload",accept:".dxf",maxFileSize:1024*this.props.maxFileSize,customUpload:!0,uploadHandler:this.loadDXFFile.bind(this),disabled:n,url:"./upload",chooseLabel:"Escolher",uploadLabel:"Carregar",cancelLabel:"Cancelar",invalidFileSizeMessageDetail:"",invalidFileSizeMessageSummary:"O ficheiro n\xe3o poder\xe1 ter mais de "+Math.round(this.props.maxFileSize/1024*100)/100+" MB"}),this.props.maxFileSize&&this.props.maxFileSize>0?Object(J.jsxs)("small",{id:"upload-help",className:"p-warn",children:["Dimens\xe3o m\xe1xima do ficheiro: ",Math.round(this.props.maxFileSize/1024*100)/100," MB"]}):null]})]})})}}]),n}(H.Component),wo=yo,Eo=function(e){Object(ne.a)(n,e);var t=Object(re.a)(n);function n(){return Object(ee.a)(this,n),t.apply(this,arguments)}return Object(te.a)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.data,n=e.setData,r=e.setSelected,i={type:"GROUP",active:!0,id:String(Object(sr.v4)()),title:"Grupo",opacity:1,open:!0,children:[],selectable:!1};0===t.dataitems.length?t.dataitems.push(i):"GROUP"!==t.dataitems[0].type?t.dataitems=[i]:i=t.dataitems[0],n(t),setTimeout((function(){var e={};e[i.id]={checked:!0,partialChecked:!1},r(e)}),0)}},{key:"changeName",value:function(e){var t=this.props,n=t.data,r=t.editField,i=t.setSelected,a=e.trim();if(a){var o=n.dataitems[0];o?(o.title=a,r("dataitems",Object.assign([],n.dataitems))):(o={type:"GROUP",active:!0,id:String(Object(sr.v4)()),title:a,opacity:1,open:!0,children:[],selectable:!1},r("dataitems",Object.assign([],[o])));var c={};c[o.id]={checked:!0,partialChecked:!1},i(c)}else r("dataitems",[]),i([])}},{key:"render",value:function(){var e=this,t=this.props.data,n=t.dataitems.length?t.dataitems[0]:null;return Object(J.jsx)(z.a.Fragment,{children:Object(J.jsx)(jt.a,{placeholder:"Nome do grupo...",value:n?n.title:"",onChange:function(t){return e.changeName(t.target.value)},style:{width:"100%"}})})}}]),n}(H.Component),So=Eo,Po=n(56),Ao=n(318);function Co(e,t){var n={key:e.id,label:e.title,data:e,selectable:!0,children:[]};return e.children?n.children=e.children.map((function(e){return Co(e,t)})):n.leaf=!0,n}var To=function(e){var t=e.themes,n=e.selected,r=e.setSelected,i=e.readOnly,a=e.expandAllGroups,o=Object(H.useState)({}),c=Object(X.a)(o,2),s=c[0],l=c[1],u=Object(H.useState)(!1),d=Object(X.a)(u,2),p=d[0],f=d[1],j=t.map((function(e){return Co(e)}));function h(e){var t=Object(Y.a)({},s);if(e.children&&e.children.length){t[e.key]=!0;var n,r=Object(Po.a)(e.children);try{for(r.s();!(n=r.n()).done;){h(n.value)}}catch(i){r.e(i)}finally{r.f()}}l(t)}function b(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!e)return r({});t.forEach((function(t,r){n[t.key]={checked:e,partial:!1},t.children&&b(e,t.children,n,i+1)})),0===i&&r(n)}return Object(H.useEffect)((function(){r&&b(p,j,{})}),[p]),Object(H.useEffect)((function(){if(a){var e,t={},n=function e(n){if(n.children&&n.children.length){t[n.key]=!0;var r,i=Object(Po.a)(n.children);try{for(i.s();!(r=i.n()).done;){e(r.value)}}catch(a){i.e(a)}finally{i.f()}}},r=Object(Po.a)(j);try{for(r.s();!(e=r.n()).done;){n(e.value)}}catch(c){r.e(c)}finally{r.f()}l(t)}else{var i,o=Object(Po.a)(j);try{for(o.s();!(i=o.n()).done;){h(i.value)}}catch(c){o.e(c)}finally{o.f()}}}),[t]),j.length?Object(J.jsxs)(z.a.Fragment,{children:[r&&j.length?Object(J.jsxs)("h5",{children:["\xa0",Object(J.jsx)("a",{style:{float:"right",cursor:"pointer"},onClick:function(e){return f(!p)},children:"Selecionar/Remover Todos"})]}):null,Object(J.jsx)(Ao.a,{value:j,expandedKeys:s,filter:!i&&0!==j.length,filterMode:i?null:"lenient",selectionMode:i?null:"checkbox",selectionKeys:i?null:n,onSelectionChange:function(e){var t={};Object.keys(e.value).forEach((function(n){var r=e.value[n];(r.checked||r.partialChecked)&&(t[n]=Object(Y.a)({},r))})),r(t)},onToggle:function(e){l(e.value)}})]}):null},Ro=function(e){var t=e.themes,n=e.tileMatrixSet,r=e.data,i=e.setData,a=e.selected,o=e.setSelected,c=e.readOnly,s=Object(H.useState)({}),l=Object(X.a)(s,2),u=l[0],d=l[1],p=Object(H.useState)(!1),f=Object(X.a)(p,2),j=f[0],h=f[1],b=Object(H.useState)(),m=Object(X.a)(b,2),g=m[0],v=m[1],O=t.map((function(e){return Co(e)})),_=n.map((function(e){return{label:e.Identifier,value:e.Identifier}}));function x(e){var t=Object(Y.a)({},u);if(e.children&&e.children.length){t[e.key]=!0;var n,r=Object(Po.a)(e.children);try{for(r.s();!(n=r.n()).done;){x(n.value)}}catch(i){r.e(i)}finally{r.f()}}d(t)}function y(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!e)return o({});t.forEach((function(t,i){n[t.key]={checked:e,partial:!1},t.children&&y(e,t.children,n,r+1)})),0===r&&o(n)}return Object(H.useEffect)((function(){o&&y(j,O,{})}),[j]),Object(H.useEffect)((function(){var e,t=Object(Po.a)(O);try{for(t.s();!(e=t.n()).done;){x(e.value)}}catch(n){t.e(n)}finally{t.f()}}),[]),O.length?Object(J.jsxs)("div",{children:[Object(J.jsx)("div",{className:"p-d-flex p-mt-2 p-mb-2",children:Object(J.jsx)(nr.a,{options:_,value:g,showClear:!0,placeholder:"Selecione a Grelha",style:{width:"100%"},onChange:function(e){return function(e){var t=r.dataitems.map((function(t){return Object(Y.a)(Object(Y.a)({},t),{},{wmts_tilematrixset:e})}));i(Object(Y.a)(Object(Y.a)({},r),{},{dataitems:t})),v(e)}(e.value)}})}),o&&O.length?Object(J.jsxs)("h5",{children:["\xa0",Object(J.jsx)("a",{style:{float:"right",cursor:"pointer"},onClick:function(e){return h(!j)},children:"Selecionar/Remover Todos"})]}):null,Object(J.jsx)(Ao.a,{value:O,expandedKeys:u,filter:!c&&0!==O.length,filterMode:c?null:"lenient",selectionMode:c?null:"checkbox",selectionKeys:c?null:a,onSelectionChange:function(e){var t={};Object.keys(e.value).forEach((function(n){var r=e.value[n];(r.checked||r.partialChecked)&&(t[n]=Object(Y.a)({},r))})),o(t)}})]}):null},No=function(e){var t=e.themes,n=e.selected,r=e.setSelected,i=e.readOnly,a=e.hide,o=Object(H.useState)({}),c=Object(X.a)(o,2),s=c[0],l=c[1],u=Object(H.useState)(!1),d=Object(X.a)(u,2),p=d[0],f=d[1],j=t.map((function(e){return Co(e)}));function h(e){var t=Object(Y.a)({},s);if(e.children&&e.children.length){t[e.key]=!0;var n,r=Object(Po.a)(e.children);try{for(r.s();!(n=r.n()).done;){h(n.value)}}catch(i){r.e(i)}finally{r.f()}}l(t)}function b(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!e)return r({});t.forEach((function(t,r){n[t.key]={checked:e,partial:!1},t.children&&b(e,t.children,n,i+1)})),0===i&&r(n)}return Object(H.useEffect)((function(){r&&b(p,j,{})}),[p]),Object(H.useEffect)((function(){var e,t=Object(Po.a)(j);try{for(t.s();!(e=t.n()).done;){h(e.value)}}catch(n){t.e(n)}finally{t.f()}}),[]),j.length?a?null:Object(J.jsxs)(z.a.Fragment,{children:[r&&j.length?Object(J.jsxs)("h5",{children:["\xa0",Object(J.jsx)("a",{style:{float:"right",cursor:"pointer"},onClick:function(e){return f(!p)},children:"Selecionar/Remover Todos"})]}):null,Object(J.jsx)(Ao.a,{value:j,expandedKeys:s,filter:!(i||j.length<10),filterMode:i?null:"lenient",selectionMode:i?null:"checkbox",selectionKeys:i?null:n,onSelectionChange:function(e){var t={};Object.keys(e.value).forEach((function(n){var r=e.value[n];(r.checked||r.partialChecked)&&(t[n]=Object(Y.a)({},r))})),r(t)}})]}):null},ko=null;function Io(e){var t=e.Models,n=e.fastFetch,r=Object(H.useState)(e.wizardData),i=Object(X.a)(r,2),a=i[0],o=i[1],c=Object(H.useState)(""),s=Object(X.a)(c,2),l=s[0],u=(s[1],Object(H.useState)({})),d=Object(X.a)(u,2),p=d[0],f=d[1],j=t.Utils,h=j.getWindowSize,b=j.showOnPortal,m=h(),g=2048;e.viewer&&e.viewer.upload_maxfilesize&&(g=e.viewer.upload_maxfilesize),e.record&&e.record.config_json&&e.record.config_json.upload_maxfilesize&&(g=e.record.config_json.upload_maxfilesize);var v=null;switch(a.type){case"wms":v=co;break;case"wmts":v=uo;break;case"wfs":v=fo;break;case"arcgismap":v=ho;break;case"shape":v=mo;break;case"geojson":v=vo;break;case"kml":v=Oo;break;case"gml":v=xo;break;case"dxf":v=wo;break;case"group":v=So;break;default:v=null}return Object(J.jsxs)("div",{children:[b(Object(J.jsx)(ui.a,{ref:function(e){return ko=e}})),Object(J.jsx)(v,{core:e.core,auth:e.auth,record:e.record,Models:e.Models,data:a,mainMap:e.mainMap,viewer:e.viewer,loading:e.loading,setLoading:e.setLoading,setError:function(e){ko.show({severity:"error",summary:"Ocorreu um erro inesperado",detail:e,sticky:!0})},setData:o,setSelected:f,getUrlHistory:function(){return e.cookies||[]},editField:function(e,t){o(Object(Y.a)(Object(Y.a)({},a),{},Object(la.a)({},e,t)))},winSize:m,fastFetch:n,maxFileSize:g}),{wms:Object(J.jsx)(To,{core:e.core,record:e.record,themes:a.dataitems,selected:p,filter:l,setSelected:f}),wmts:Object(J.jsx)(Ro,{core:e.core,record:e.record,themes:a.dataitems,tileMatrixSet:a.wmtsTileMatrixSet||[],selected:p,filter:l,setSelected:f,data:a,setData:o})}[e.wizardData.type]||Object(J.jsx)(No,{core:e.core,record:e.record,hide:"group"===a.type,themes:a.dataitems,selected:p,filter:l,setSelected:f}),Object(J.jsx)("div",{style:{padding:"0.571rem 1rem",textAlign:"right"},children:Object(J.jsx)(bt.a,{onClick:function(t){return function(){var t=JSON.parse(JSON.stringify(a.dataitems));t=function e(t){return t.filter((function(t){if(t.children){var n=e(t.children);t.children=n}return Object.keys(p).includes(t.id)}))}(t),a.items=t,e.onSave(a)}()},label:"Seguinte",disabled:e.loading||0===Object.keys(p).length||1===Object.keys(p).length&&!p[Object.keys(p)[0]].checked,style:{marginTop:"1em"}})})]})}function Mo(e){var t=e.wizardData;return Object(J.jsxs)("div",{children:[Object(J.jsx)("h1",{children:"Confirmar"}),t.items&&t.items.length>0?"wms"===t.type?Object(J.jsx)(To,{themes:t.items,selected:t.selected,readOnly:!0,expandAllGroups:!0}):Object(J.jsx)(No,{themes:t.items,selected:t.selected,readOnly:!0}):Object(J.jsx)(mt.a,{severity:"info",text:"N\xe3o h\xe1 nenhum tema selecionado. Volte \xe0 etapa anterior e selecione pelo menos um tema."}),Object(J.jsx)("div",{style:{padding:"0.571rem 1rem",textAlign:"right"},children:Object(J.jsx)(bt.a,{onClick:function(n){return e.onSave(t)},label:"Concluir",disabled:e.loading||0===t.items.length,style:{marginTop:"1em"}})})]})}n(1396);var Lo=[{label:"Tipo"},{label:"Dados"},{label:"Confirmar"}],Fo=[{value:"wms",label:"WMS - Web Map service"},{value:"wmts",label:"WMTS - Web Map Tile Service"},{value:"wfs",label:"WFS - web Feature Service"},{value:"arcgismap",label:"ArcGIS REST - Map Service"},{value:"shape",label:"Shapefile - ficheiro .zip contendo .shp"},{value:"kml",label:"KML - Keyhole Markup Language"},{value:"gml",label:"GML - Geographic Markup Language"},{value:"geojson",label:"GeoJSON"},{value:"dxf",label:"DXF (v2000)"},{value:"group",label:"Grupo de Temas"}],Uo={crs:"4326",dataitems:[],get_feature_info_format:"text/plain",get_map_format:"image/png",items:[],type:"",url:"",wmsIgnoreServiceUrl:!0,wmsTiled:!0,wmsVersion:"1.3.0",wmtsIgnoreServiceUrl:!0,wmtsVersion:"1.0.0"};function Go(e){var t=e.className,n=e.config,r=e.actions,i=e.record,a=i.config_json||{},o=i.title||"Adicionar Temas";a.header;return Object(J.jsx)(bt.a,{title:o,className:t,icon:"pi pi-plus-circle",style:{margin:"0.5em 1em"},onClick:function(e){return n.dispatch(r.viewer_set_selectedmenu(i.id))}})}function Do(e){var t=e.record.config_json,n=e.record.title||"Adicionar Temas",r=t.header||n,i=Object(H.useState)(e.config.data.type?e.config.data.items.length?2:1:0),a=Object(X.a)(i,2),o=a[0],c=a[1],s=Object(H.useState)(e.config.data),l=Object(X.a)(s,2),u=l[0],d=l[1],p=Object(H.useState)(!1),f=Object(X.a)(p,2),j=f[0],h=f[1],b=Object(H.useState)(Fo),m=Object(X.a)(b,2),g=m[0],v=m[1];function O(t){var n=e.actions,r=n.viewer_add_themes,i=n.viewer_set_selectedmenu,a=n.layers_set_checked,o=n.layers_set_opened,s=e.config,l=s.viewer,u=(s.mainMap,s.dispatch);if(u&&r){var p=[],f=[],j=[],h=function e(t,n){t.forEach((function(t){f.push(t.id);var i=[];t.children&&t.children.length&&(i=Object(ae.a)(t.children),t.type="GROUP",t.children=[],j.push(t.id)),u(r(n?n.id:"main",[t])),i&&i.length&&e(i,t)}))};if(function e(t){t.forEach((function(t){t.children&&t.children.length?e(t.children):p.push(t)}))}(t.items),p&&1===p.length?h(p,null):h(t.items,null),j.length&&e.record.config_json&&e.record.config_json.layer_group_opened){var b=Object(ae.a)(l.config_json.opened);b=b.concat(j),u(o(b))}if(f.length&&e.record.config_json&&e.record.config_json.layer_visible){var m=Object(ae.a)(l.config_json.checked);m=m.concat(f),u(a(m))}d(Uo),c(0),u(i("toc"))}}function _(){var t=null;switch(o){case 2:t=Object(J.jsx)(Mo,{core:e.core,auth:e.config.auth,record:e.record,wizardData:u,onSave:function(e){return O(u)},onCancel:null});break;case 1:t=Object(J.jsx)(Io,{core:e.core,auth:e.config.auth,record:e.record,Models:e.config.Models,wizardData:u,mainMap:e.config.mainMap,viewer:e.config.viewer,loading:j,setLoading:h,onSave:function(e){d(e),c(o+1)},onCancel:null,fastFetch:Vo});break;default:t=Object(J.jsx)(io,{core:e.core,auth:e.config.auth,record:e.record,types:g,initialData:Uo,wizardData:u,onSave:function(e){d(e),c(o+1)},onCancel:null})}return Object(J.jsxs)("div",{id:"themewizard",children:[Object(J.jsx)(ro.a,{model:Lo,activeIndex:o,onSelect:function(e){return t=o,void((n=e.index)>0&&!u.type||n>1&&!u.items.length>0?c(t):c(n));var t,n},readOnly:!1}),t]})}return Object(H.useEffect)((function(){if(t&&t.exclude_types&&t.exclude_types.length){var e=g.filter((function(e){return!t.exclude_types.includes(e.value)}));v(e)}}),[]),"panel"===e.as?Object(J.jsx)(Fn.a,{header:r,children:_()}):_()}function Vo(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8e3;return new Promise((function(r,i){var a=new AbortController,o=Object(Y.a)(Object(Y.a)({},t),{},{signal:a.signal}),c=setTimeout((function(){a.abort(),console.log("Fetch timeout at "+n+" ms"),r({})}),n);fetch(e,o).then((function(e){clearTimeout(c),r(e)})).catch((function(e){clearTimeout(c),i(e)}))}))}function Wo(e){var t=e.i,n=e.parent,r=e.action,i=e.deep,a=Object(H.useState)(!1),o=Object(X.a)(a,2),c=o[0],s=o[1];return Object(J.jsx)("li",{className:"drag-slot"+(c?" drag-over":""),"data-deep":i,onDrop:function(e){return function(e,t,n){e.stopPropagation(),s(!1);var i=e.dataTransfer.getData("index");i=i.split(",");var a=[t,n];r(i[0],i[1],parseInt(a[0],10),a[1])}(e,t,n)},onDragOver:function(e){e.preventDefault()},onDragLeave:function(e){return(t=e).preventDefault(),t.stopPropagation(),void s(!1);var t},onDragEnter:function(e){return(t=e).preventDefault(),t.stopPropagation(),void s(!0);var t}})}var Ho=function(e){Object(ne.a)(n,e);var t=Object(re.a)(n);function n(){var e;Object(ee.a)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).onDragStart=function(t,n,r){t.stopPropagation();var i=[n,r].join(",");t.dataTransfer.setData("index",i),e.props.onDragStart()},e}return Object(te.a)(n,[{key:"render",value:function(){var e=this;if(!1===this.props.draggable){var t=this.props.id;return Object(J.jsx)("li",{"data-id":t,children:this.props.children})}var n=this.props,r=(n.i,n.parent),i=n.id;return Object(J.jsx)("li",{"data-id":i,draggable:!0,className:"draggable",onDragStart:function(t){return e.onDragStart(t,i,r)},children:this.props.children})}}]),n}(z.a.Component),zo=Ho,Ko={};function Bo(e){var t=e.data,n=e.core,r=(e.actions,e.models.Utils.isUrlAppOrigin),i=(t.legend_type,t.legend_label,Object(H.useState)([])),a=Object(X.a)(i,2),o=a[0],c=a[1];return Object(H.useEffect)((function(){if(null!==t&&void 0!==t&&t.url){var e="".concat(t.url,"/legend?f=pjson");if(!o.length&&Ko[t.url]){var i=Ko[t.url].layers.filter((function(e){return t.layerId.includes(e.layerId)}));c(i||[])}else r(e)||(e=n.MAP_PROXY_URL+encodeURIComponent(e)),fetch(e).then((function(e){if(e.ok)return e.json();throw e})).then((function(e){if(null===e||void 0===e||!e.layers)throw e;var n=e.layers.filter((function(e){return t.layerId.includes(e.layerId)}));c(n),Ko[t.url]=e})).catch((function(e){console.log(e)}))}}),[]),o&&o.length?Object(J.jsx)("div",{className:"legend-container",children:o.map((function(e){return Object(J.jsxs)(z.a.Fragment,{children:[o.length>1&&Object(J.jsx)("div",{children:e.layerName}),e.legend.map((function(e){return Object(J.jsx)("ul",{children:Object(J.jsx)("li",{children:Object(J.jsxs)("div",{children:[Object(J.jsx)("img",{src:"data:".concat(e.contentType,";base64,").concat(e.imageData),style:{verticalAlign:"middle",maxHeight:"25px"},alt:""}),e.label&&Object(J.jsxs)("span",{children:[" ",e.label]})]})})})}))]})}))}):null}function Yo(e){var t=e.data,n=e.core,r=e.actions,i=e.models,a=t.legend_type||"image",o=t.legend_label||"Legenda";return"ArcGISMap"!==t.type||t.legend_url?t.legend_url?"link"===a?Object(J.jsx)("div",{className:"legend-container",children:Object(J.jsx)("a",{target:"_blank",title:"Clique para abrir num separador",rel:"noopener noreferrer",href:r.getThemeLegendUrl(t),children:o})}):Object(J.jsx)("div",{className:"legend-container",children:Object(J.jsx)("a",{target:"_blank",title:"Clique para abrir num separador",rel:"noopener noreferrer",href:r.getThemeLegendUrl(t),children:Object(J.jsx)("img",{src:r.getThemeLegendUrl(t),alt:""})})}):null:Object(J.jsx)(Bo,{data:t,core:n,actions:r,models:i})}var qo=function(e){Object(ne.a)(n,e);var t=Object(re.a)(n);function n(){var e;Object(ee.a)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).state={detailsOpen:!1},e}return Object(te.a)(n,[{key:"isChecked",value:function(){var e=this.props,t=e.data;return e.checked.indexOf(t.id)>-1}},{key:"isOpen",value:function(){var e=this.props,t=e.data;return e.opened.indexOf(t.id)>-1}},{key:"onClickZoom",value:function(e,t){e.preventDefault(),this.props.actions.onZoomTheme(t)}},{key:"render",value:function(){var e=this,t=this.props,n=t.i,r=t.parent,i=t.record,a=t.data,o=t.layers,c=t.config,s=t.deep,l=t.opened,u=t.checked,d=t.radioName,p=t.items,f=t.disabled,j=t.olmap,h=t.editNode,b=t.actions,m=t.core,g=this.state.detailsOpen;if(a.filtered)return null;var v=b.isThemeOnScale(j,a),O="GROUP"===a.type,_=(a.children||[]).map((function(e){return o.find((function(t){return t.id===e}))})).filter((function(e){return!!e}));return Object(J.jsx)(z.a.Fragment,{children:Object(J.jsx)(zo,{i:n,parent:r,action:b.moveTheme,models:c.Models,onDragStart:this.props.onDragStart,id:a.id,draggable:c.draggable,children:Object(J.jsx)("table",{style:{width:"100%"},children:Object(J.jsxs)("tbody",{children:[Object(J.jsxs)("tr",{children:[Object(J.jsxs)("td",{className:"activate",children:[O&&Object(J.jsx)(bt.a,{className:"p-button-sm p-button-text",title:"Mostrar/esconder subtemas",icon:this.isOpen()?"pi pi-chevron-down":"pi pi-chevron-right",onClick:function(e){return b.open(e,a.id)}}),d?Object(J.jsx)(ar.a,{title:"Ligar/desligar tema",id:a.id,name:d,checked:this.isChecked(),onChange:function(e){return b.toggle(a.id,a,p)},className:O?"":"toc-leaf"}):Object(J.jsx)(Zr.a,{title:"Ligar/desligar tema",id:a.id,checked:this.isChecked(),onChange:function(e){return b.toggle(a.id,a)},className:O?"":"toc-leaf"})]}),Object(J.jsxs)("td",{className:(v?"title":"title outofscale")+(O?" title-grp":""),children:[a.style_color?Object(J.jsx)("i",{className:"pi pi-square",style:{color:"rgba(".concat(a.style_color,")")}}):null,Object(J.jsx)("label",{htmlFor:a.id,className:"label"+(O?" label-grp":""),children:a.title}),!a.system&&Object(J.jsx)("div",{className:"theme-tools"+(g?"":" hidden"),children:m.renderComponents({region:"layer_tools",props:{layer:a,actions:b,viewer:c.viewer,dispatch:c.dispatch,models:c.Models,mainMap:c.mainMap},separator:" ",parent:i})})]}),Object(J.jsxs)("td",{className:"buttons",children:[!1!==a.show_details?Object(J.jsx)(bt.a,{className:"p-button-sm"+(g?"":" p-button-text"),title:"Mostrar/esconder detalhes",icon:(this.isOpen(),"pi pi-cog"),onClick:function(t){return e.setState(Object(Y.a)(Object(Y.a)({},e.state),{},{detailsOpen:!g}))}}):null," ",a.bbox&&!1!==a.show_zoom_extent?Object(J.jsx)(bt.a,{className:"p-button-sm p-button-text",title:"Zoom \xe0 extens\xe3o do tema",icon:"pi pi-search",onClick:function(t){return e.onClickZoom(t,a)}}):null]})]}),g?Object(J.jsx)("tr",{children:Object(J.jsx)("td",{colSpan:"3",children:m.renderComponents({region:"layer_tools_block",props:{layer:a,actions:b,viewer:c.viewer,dispatch:c.dispatch,models:c.Models,mainMap:c.mainMap},separator:" ",parent:i})})}):null,g?Object(J.jsx)("tr",{className:"detail-container",children:Object(J.jsxs)("td",{colSpan:"3",children:[!!a.description&&Object(J.jsx)("div",{className:"theme-description",dangerouslySetInnerHTML:{__html:a.description}}),Object(J.jsx)(Yo,{data:a,core:m,actions:b,models:c.Models})]})}):null,O&&this.isOpen()?Object(J.jsx)("tr",{children:Object(J.jsx)("td",{colSpan:"3",children:Object(J.jsx)(Zo,{id:a.id,record:i,items:_,layers:o,config:c,core:m,deep:s+1,opened:l,exclusive:a.exclusive,checked:u,actions:b,disabled:!this.isChecked()||f,editNode:h,olmap:j,onDragStart:this.props.onDragStart})})}):null]})})})})}}]),n}(z.a.Component),Xo=qo,Jo=function(e){Object(ne.a)(n,e);var t=Object(re.a)(n);function n(){return Object(ee.a)(this,n),t.apply(this,arguments)}return Object(te.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.id,r=t.core,i=t.record,a=t.config,o=t.layers,c=t.deep,s=t.checked,l=t.opened,u=t.exclusive,d=t.disabled,p=t.olmap,f=t.actions,j=this.props.items||[];return Object(J.jsx)("div",{children:Object(J.jsxs)("ul",{children:[Object(J.jsx)(Wo,{i:0,parent:n,action:f.moveTheme,deep:c}),j.map((function(t,h){return Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsx)(Xo,{i:h,parent:n,data:t,record:i,config:a,layers:o,core:r,deep:c,opened:l,radioName:u?n:"",checked:s,toggle:f.toggle,items:u?j:null,disabled:d,olmap:p,actions:f,onDragStart:e.props.onDragStart}),Object(J.jsx)(Wo,{i:h+1,parent:n,action:f.moveTheme,deep:c})]},t.id)}))]})})}}]),n}(z.a.Component),Zo=Jo,$o=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(t=t||[]).map((function(i,a){return n(i,a,t,r),e(i.children,n,i),i}))},Qo=function e(t,n){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=[],a=0;a<t.length;a++)if(Array.isArray(t[a].children)&&t[a].children.includes(n)){i.push(t[a].id);var o=e(t,t[a].id,r+1);i=i.concat(o)}return i},ec=function e(t,n){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=Object.assign([],n),a=0;a<t.length;a++)if(n.includes(t[a].id)&&Array.isArray(t[a].children)){var o=e(t,t[a].children,r+1);Array.isArray(o)&&(i=i.concat(o))}return i},tc=(n(1397),{toc_action1:function(){return console.log("Called toc_helper")}});function nc(e){var t=e.className,n=e.config,r=e.actions,i=e.record;return Object(J.jsx)(bt.a,{title:"Temas",className:t,icon:"pi pi-list",style:{margin:"0.5em 1em"},onClick:function(e){return n.dispatch(r.viewer_set_selectedmenu(i.id))}})}var rc=function(e){Object(ne.a)(n,e);var t=Object(re.a)(n);function n(e){var r;Object(ee.a)(this,n),(r=t.call(this,e)).traverseTree=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(e=e||[]).map((function(r,i){return t(r,i,e,n),$o(r.children,t,r),r}))};var i=e.core,a=e.config.viewer.config_json.opened,o=i.COOKIE_AUTH_NAME,c=i.API_URL;return r.state={dragging:!1,config:e.config,filter:"",opened:a||[],cookieAuthName:o,API_URL:c},r}return Object(te.a)(n,[{key:"openTheme",value:function(e,t){var n=this.state.opened,r=n.indexOf(t);-1===r?n.push(t):n.splice(r,1),this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{opened:n})),this.props.actions.layers_set_opened&&this.props.config.dispatch&&this.props.config.dispatch(this.props.actions.layers_set_opened(n))}},{key:"toggle",value:function(e,t,n){var r=this.props.config,i=r.activate_parents,a=r.deactivate_children,o=r.open_children,c=r.viewer,s=c.config_json.layers,l=Object.assign([],c.config_json.checked),u=l.indexOf(e);(-1===u?l.push(e):l.splice(u,1),n&&n.length&&n.forEach((function(t){var n=l.indexOf(t.id);t.id!==e&&n>-1&&l.splice(n,1)})),-1===u&&(i&&!1!==(null===t||void 0===t?void 0:t.activate_parents)||!0===(null===t||void 0===t?void 0:t.activate_parents)))&&Qo(s,e).filter((function(e){return!!e})).forEach((function(e){-1===l.indexOf(e)&&l.push(e)}));u>-1&&(a&&!1!==(null===t||void 0===t?void 0:t.deactivate_children)||!0===(null===t||void 0===t?void 0:t.deactivate_children))&&ec(s,[e]).forEach((function(t){var n=l.indexOf(t);t!==e&&n>-1&&l.splice(n,1)}));if(this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{checked:l})),this.props.actions.layers_set_checked&&this.props.config.dispatch&&this.props.config.dispatch(this.props.actions.layers_set_checked(l)),(o&&!1!==(null===t||void 0===t?void 0:t.open_children)||null!==t&&void 0!==t&&t.open_children)&&l.includes(e)&&"GROUP"===t.type){var d=this.state.opened;-1===d.indexOf(e)&&(d.push(e),this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{opened:d})),this.props.actions.layers_set_opened&&this.props.config.dispatch&&this.props.config.dispatch(this.props.actions.layers_set_opened(d)))}}},{key:"opacity",value:function(e,t,n){var r=this.props.config.viewer.config_json.layers,i=r.indexOf(t),a=Object.assign({},t);a.opacity=n/100,r.splice(i,1,a),this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{layers:r})),this.props.actions.layers_update_theme&&this.props.config.dispatch&&this.props.config.dispatch(this.props.actions.layers_update_theme(a))}},{key:"removeThemes",value:function(e){var t=this;this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{confirmDeleteTheme:!1}));var n=this.props.config.viewer.config_json.opened,r=this.props.config.viewer.config_json.checked;e.forEach((function(e){n.includes(e)&&t.openTheme(null,e),r.includes(e)&&t.toggle(e)})),this.props.actions.layers_remove_items&&this.props.config.dispatch&&this.props.config.dispatch(this.props.actions.layers_remove_items(e))}},{key:"applyThemeChanges",value:function(e){var t=this.props.config.viewer.config_json.layers,n=t.indexOf(e),r=Object.assign({},e);t.splice(n,1,r),this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{layers:t})),this.props.actions.layers_update_theme&&this.props.config.dispatch&&this.props.config.dispatch(this.props.actions.layers_update_theme(r))}},{key:"moveTheme",value:function(e,t,n,r){var i=this.props.config.viewer.config_json.layers,a=Object.assign([],i),o=a.findIndex((function(e){return e.id===t})),c=a.findIndex((function(e){return e.id===r})),s=a[o].children.indexOf(e),l=Object.assign({},a[c]);if(l.children.includes(r))return this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{dragging:!1}));t===r&&s<n&&n--,a[o].children.splice(s,1),l.children.splice(n,0,e),a.splice(c,1,l),this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{layers:a,dragging:!1})),this.props.actions.layers_update_theme&&this.props.config.dispatch&&(this.props.config.dispatch(this.props.actions.layers_update_theme(a[o])),this.props.config.dispatch(this.props.actions.layers_update_theme(l)))}},{key:"onZoomTheme",value:function(e){var t=this.props.config.dispatch,n=this.props.actions,r=n.transform_extent,i=n.map_set_extent;if(e.crs&&e.bbox&&r&&i&&t)try{var a=this.props.config.mainMap.getView().getProjection().getCode(),o=r(e.crs,a,e.bbox.split(" "));t(i([o[0]+(o[2]-o[0])/2,o[1]+(o[3]-o[1])/2],o))}catch(c){console.log(c)}}},{key:"filterThemes",value:function(e,t){var n=[],r=new RegExp(t,"i");e.forEach((function(i){if(!n.includes(i.id)&&(i.filtered=!!t&&(!r.test(i.title)&&!r.test(i.description)),n.push(i.id),!i.filtered)){var a=Qo(e,i.id);e.forEach((function(e){n.includes(e.id)||a.includes(e.id)&&(e.filtered=!1,n.push(e.id))}))}}))}},{key:"endDragging",value:function(e){this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{dragging:!1}))}},{key:"changeFilter",value:function(e){this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{filter:e.target.value}))}},{key:"clearFilter",value:function(e){this.setState(Object(Y.a)(Object(Y.a)({},this.state),{},{filter:""}))}},{key:"saveSession",value:function(e){var t=this;this.props.config.dispatch(this.props.actions.viewer_save_http_loading());var n=this.props.config.Models.MapModel.getViewerSessionConfig,r=this.state,i=r.cookieAuthName,a=r.API_URL,o=this.props.config.viewer,c=n(o),s={id:o.id,config_json:JSON.stringify(c)},l={headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify(s)},u=(new ft.a).get(i);u&&(l.headers["X-API-KEY"]=u.token);var d=a+"/app/viewer/session";fetch(d+="/"+s.id,l).then((function(e){return e.json()})).then((function(n){if(!n.success)throw new Error("N\xe3o foi poss\xedvel gravar a sess\xe3o.");e.show({severity:"success",summary:"Gravar Sess\xe3o",detail:"A sess\xe3o foi gravada com sucesso.",sticky:!1}),t.props.config.dispatch(t.props.actions.viewer_session_saved(n.session))})).catch((function(n){e.show({severity:"error",summary:"Ocorreu um erro inesperado",detail:"N\xe3o foi poss\xedvel gravar a sess\xe3o.",sticky:!1}),t.props.config.dispatch(t.props.actions.viewer_save_http_error())}))}},{key:"loadSession",value:function(){var e=this.props.config.history;this.props.config.dispatch(this.props.actions.viewer_session_load(e)),window.location.reload()}},{key:"renderContent",value:function(){var e=this,t=this.props,n=t.core,r=t.record,i=t.config,a=t.actions,o=t.withHeading,c=i.mainMap,s=r.config_json||{},l=this.state,u=l.filter,d=l.dragging,p=i.viewer.config_json,f=p.layers,j=p.checked,h=p.opened,b=i.Models.Utils.showOnPortal;if(!Array.isArray(f))return null;var m=f.find((function(e){return"main"===e.id}));if(!m)return null;var g=new ft.a,v=n.COOKIE_AUTH_NAME,O=g.get(v);this.filterThemes(f,u);var _=m.children.map((function(e){return f.find((function(t){return t.id===e}))})).filter((function(e){return!!e})),x=Object(Y.a)(Object(Y.a)({},a),{},{open:this.openTheme.bind(this),toggle:this.toggle.bind(this),opacity:this.opacity.bind(this),moveTheme:this.moveTheme.bind(this),removeThemes:this.removeThemes.bind(this),onZoomTheme:this.onZoomTheme.bind(this),applyThemeChanges:this.applyThemeChanges.bind(this)}),y=null;return Object(J.jsxs)("div",{style:{height:"100%"},onMouseLeave:this.endDragging.bind(this),onDrop:function(t){e.endDragging.bind(e)},children:[b(Object(J.jsx)(ui.a,{ref:function(e){return y=e}})),Object(J.jsxs)("div",{id:"layer-switcher",className:"plugin-main"+(d?" dragging":""),children:[!!o&&Object(J.jsx)("h3",{children:"Temas"}),!!O&&!!i.viewer.allow_user_session&&Object(J.jsx)(oa.a,{className:"p-mb-2",left:i.viewer.is_session&&Object(J.jsx)(bt.a,{label:"Sess\xe3o",className:"p-button-sm p-button-rounded p-button-info",icon:"pi pi-check",tooltip:"Gravada em "+i.viewer.session.date}),right:Object(J.jsxs)(z.a.Fragment,{children:[i.viewer.session&&!i.viewer.is_session&&Object(J.jsx)(bt.a,{label:"Abrir Sess\xe3o",icon:"pi pi-folder-open",className:"p-button-text p-button-sm",onClick:function(t){return e.loadSession()},disabled:i.viewer.save_loading,tooltip:"Gravada em "+i.viewer.session.date}),Object(J.jsx)(bt.a,{label:"Gravar Sess\xe3o",icon:i.viewer.save_loading?"pi pi-spin pi-spinner":"pi pi-save",className:"p-button-text p-button-sm",onClick:function(t){return e.saveSession(y)},disabled:i.viewer.save_loading})]})}),_.length?Object(J.jsx)(J.Fragment,{children:!1!==s.show_filter?Object(J.jsxs)("div",{className:"p-inputgroup",children:[Object(J.jsx)(jt.a,{placeholder:"Filtro...",className:"p-inputtext-sm p-mb-2",value:u,onChange:this.changeFilter.bind(this)}),Object(J.jsx)(bt.a,{icon:"pi pi-times",label:"Limpar",className:"p-button-sm p-mb-2",onClick:this.clearFilter.bind(this)})]}):null}):Object(J.jsx)(mt.a,{severity:"info",text:"N\xe3o existem temas. Clique no menu + para adicionar."}),Object(J.jsx)(Zo,{id:"main",deep:0,core:n,record:r,items:_,config:i,layers:f,checked:j,opened:h,olmap:c,actions:x,onDragStart:function(t){return e.setState(Object(Y.a)(Object(Y.a)({},e.state),{},{dragging:!0}))}})]})]})}},{key:"render",value:function(){var e=this.props.as;return"panel"===e?Object(J.jsx)(Fn.a,{header:"Temas",children:this.renderContent()}):"button"===e?Object(J.jsx)(bt.a,{label:"teste"}):this.renderContent()}}]),n}(z.a.Component),ic=rc,ac=n(139),oc=n(106),cc=new ft.a;var sc=Object(q.b)((function(e){return{auth:e.root.auth}}))((function(e){var t,n,r,i=e.auth,a=e.history,o=e.redirect,c=e.core,s=e.dispatch,l=e.actions,u=e.record,d=e.showRegistration,p=u.config_json||{},f=Object(H.useState)("login"),j=Object(X.a)(f,2),h=j[0],b=j[1],m=l.login_post,g=l.login_clear_error,v=l.login_reset_password,O=l.logout,_=cc.get(c.COOKIE_AUTH_NAME),x=Object(ac.b)({defaultLoginValues:{username:"",password:""}}),y=x.control,w=x.formState.errors,E=x.trigger,S=x.getValues,P=x.setValue,A=x.handleSubmit;if(Object(H.useEffect)((function(){s(g())}),[]),_){var C=_.username;return Object(J.jsxs)("div",{children:[Object(J.jsxs)("p",{children:["Ol\xe1 ",C,"."]}),Object(J.jsxs)("p",{children:["Clique para",Object(J.jsx)(bt.a,{className:"p-button-link",onClick:function(e){return s(O())},label:"terminar sess\xe3o"}),"."]})]})}function T(e){e.preventDefault(),P("username",""),P("password",""),b("login"),s(g())}var R=function(){var e=Object(_t.a)(Object(Ot.a)().mark((function e(t){return Object(Ot.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.code){e.next=6;break}return t.preventDefault(),e.next=4,E(["username","password"]);case 4:e.sent&&N(S());case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),N=function(e){if("password_reset"===h){var t,n,r,i;if(null!==u&&void 0!==u&&null!==(t=u.config_json)&&void 0!==t&&null!==(n=t.actions)&&void 0!==n&&n.reset_password)return void c.pubsub.publish(null===u||void 0===u||null===(r=u.config_json)||void 0===r||null===(i=r.actions)||void 0===i?void 0:i.reset_password,{post:{username:e.username,redirect:o},history:a,redirect:o});s(v({username:e.username,redirect:o},a,o))}else{var l,d,p,f;if(null!==u&&void 0!==u&&null!==(l=u.config_json)&&void 0!==l&&null!==(d=l.actions)&&void 0!==d&&d.login)return void c.pubsub.publish(null===u||void 0===u||null===(p=u.config_json)||void 0===p||null===(f=p.actions)||void 0===f?void 0:f.login,null);s(m({username:e.username,password:e.password},a,o))}},k=function(e,t){if(e&&e[t])return"required"===e[t].type?Object(J.jsx)("small",{className:"p-error",children:e[t].message||"Campo obrigat\xf3rio"}):"maxLength"===e[t].type?Object(J.jsx)("small",{className:"p-error",children:e[t].message||"O n\xfamero de caracteres \xe9 superior \xe0 dimens\xe3o m\xe1xima permitida"}):"pattern"===e[t].type?Object(J.jsx)("small",{className:"p-error",children:e[t].message||"Formato inv\xe1lido"}):Object(J.jsx)("small",{className:"p-error",children:e[t].message})};return"password_reset"!==h||!0!==(null===i||void 0===i||null===(t=i.response)||void 0===t?void 0:t.reset_password)||null!==i&&void 0!==i&&null!==(n=i.response)&&void 0!==n&&n.error?Object(J.jsxs)("form",{onSubmit:A(N),autoComplete:"off",children:[Object(J.jsxs)("div",{className:"p-fluid",children:[Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{htmlFor:"username",className:"p-col-12 p-md-4",children:"Utilizador / E-mail"}),Object(J.jsxs)("div",{className:"p-col-12 p-md-8",children:[Object(J.jsx)(ac.a,{name:"username",control:y,rules:{required:"Preenchimento obrigat\xf3rio."},render:function(e){var t=e.field,n=e.fieldState;return Object(J.jsx)(jt.a,Object(Y.a)(Object(Y.a)({id:t.name},t),{},{autoFocus:!0,className:Object(oc.a)({"p-invalid":n.invalid}),autoComplete:"off","aria-autocomplete":"none",onKeyPress:R}))}}),k(w,"username")]})]}),"login"===h&&Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{htmlFor:"password",className:"p-col-12 p-md-4",children:"Palavra-passe"}),Object(J.jsxs)("div",{className:"p-col-12 p-md-8",children:[Object(J.jsx)(ac.a,{name:"password",control:y,rules:{required:"Preenchimento obrigat\xf3rio."},render:function(e){var t=e.field,n=e.fieldState;return Object(J.jsx)(xn.a,Object(Y.a)(Object(Y.a)({id:t.name},t),{},{toggleMask:!0,feedback:!1,className:Object(oc.a)({"p-invalid":n.invalid}),autoComplete:"off","aria-autocomplete":"none",onKeyPress:R}))}}),k(w,"password")]})]}),(!0===p.reset_password||p.user_registration)&&Object(J.jsxs)("div",{className:"p-field p-grid",children:[(!p.reset_password||!p.user_registration)&&Object(J.jsx)("div",{className:"p-col-12 p-md-6"}),p.reset_password&&Object(J.jsx)("div",{className:"p-col-12 p-md-6 p-p-2 p-text-center",children:Object(J.jsx)(bt.a,{className:"p-button-link",style:{width:"auto"},label:"Recuperar palavra-passe",onClick:function(e){e.preventDefault(),P("username",""),P("password",""),b("password_reset"),s(g())}})}),p.user_registration&&Object(J.jsx)("div",{className:"p-col-12 p-md-6 p-p-2 p-text-center",children:Object(J.jsx)(bt.a,{className:"p-button-link",style:{width:"auto"},label:"Novo utilizador",onClick:function(e){e.preventDefault(),d()}})})]})]}),"password_reset"===h&&Object(J.jsx)("div",{className:"p-field p-grid",children:Object(J.jsx)("div",{className:"p-col-12 p-text-center",children:Object(J.jsx)(bt.a,{className:"p-button-link",style:{width:"auto"},label:"Login",onClick:T})})})]}),Object(J.jsx)("div",{className:"p-dialog-myfooter",children:Object(J.jsx)(bt.a,{type:"submit",color:"green",icon:i.loading?"pi pi-spin pi-spinner":"pi pi-check",label:"password_reset"===h?"Enviar":"Entrar",disabled:i.loading})}),i.http_error&&!i.response&&Object(J.jsx)(mt.a,{style:{width:"100%"},severity:"error",text:"Servi\xe7o Indispon\xedvel"}),i.response&&!!i.response&&!!i.response.message&&Object(J.jsx)(mt.a,{style:{width:"100%"},severity:"error",text:null===i||void 0===i||null===(r=i.response)||void 0===r?void 0:r.message})]}):Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsxs)("div",{className:"p-fluid",children:[Object(J.jsxs)("div",{className:"p-d-flex p-ai-center p-dir-col p-pt-2 p-px-3",children:[Object(J.jsx)("h3",{children:"Recupera\xe7\xe3o de palavra-passe"}),Object(J.jsx)("p",{children:i.response.message}),Object(J.jsx)("p",{style:{fontSize:"0.9rem"},children:"Caso n\xe3o receba o email com as instru\xe7\xf5es para recupera\xe7\xe3o da palavra-passe durante os pr\xf3ximos minutos, verifique se este n\xe3o foi direcionado para a \xe1rea de SPAM do seu correio eletr\xf3nico."})]}),Object(J.jsx)("div",{className:"p-field p-grid",children:Object(J.jsx)("div",{className:"p-col-12",children:Object(J.jsx)(bt.a,{className:"p-button-link",label:"Login",onClick:T})})})]}),Object(J.jsx)("div",{className:"p-dialog-myfooter",children:Object(J.jsx)(bt.a,{color:"green",icon:i.loading?"pi pi-spin pi-spinner":"pi pi-check",label:"Fechar",onClick:function(t){b("login"),e.onHide()}})})]})})),lc=n(451),uc=new ft.a,dc={weakLabel:"Fraca",mediumLabel:"M\xe9dia",strongLabel:"Forte"};var pc=Object(q.b)((function(e){return{auth:e.root.auth}}))((function(e){var t,n,r,i=e.auth,a=e.viewer,o=e.history,c=e.redirect,s=e.core,l=e.dispatch,u=e.actions,d=(e.record,e.showLogin),p=u.login_user_registration,f=(u.logout,uc.get(s.COOKIE_AUTH_NAME));f&&console.log(f);var j,h,b=Object(ac.b)({defaultValues:{name:null,email:null,username:null,password:"",accept:!1}}),m=b.control,g=b.formState.errors,v=b.handleSubmit,O=null===a||void 0===a||null===(t=a.config_json)||void 0===t?void 0:t.terms_of_service_url,_=function(e,t){if(e&&e[t])return"required"===e[t].type?Object(J.jsx)("small",{className:"p-error",children:e[t].message||"Campo obrigat\xf3rio"}):"maxLength"===e[t].type?Object(J.jsx)("small",{className:"p-error",children:e[t].message||"O n\xfamero de caracteres \xe9 superior \xe0 dimens\xe3o m\xe1xima permitida"}):"pattern"===e[t].type?Object(J.jsx)("small",{className:"p-error",children:e[t].message||"Formato inv\xe1lido"}):Object(J.jsx)("small",{className:"p-error",children:e[t].message})},x=Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsx)(lc.a,{className:"p-mt-2"}),Object(J.jsx)("p",{className:"p-mt-2",children:"Sugest\xf5es:"}),Object(J.jsxs)("ul",{className:"p-pl-2 p-ml-2 p-mt-0",style:{lineHeight:"1.5"},children:[Object(J.jsx)("li",{children:"Pelo menos uma min\xfascula"}),Object(J.jsx)("li",{children:"Pelo menos uma mai\xfascula"}),Object(J.jsx)("li",{children:"Pelo menos um d\xedgito"}),Object(J.jsx)("li",{children:"Pelo menos 8 caracteres"})]})]});return!0!==(null===i||void 0===i||null===(n=i.response)||void 0===n?void 0:n.register_user)||null!==i&&void 0!==i&&null!==(r=i.response)&&void 0!==r&&r.error?Object(J.jsxs)("form",{onSubmit:v((function(e){l(p(Object(Y.a)({},e),o,c))})),autoComplete:"off",children:[Object(J.jsxs)("div",{className:"p-fluid p-mt-2",children:[Object(J.jsx)("h3",{children:"Dados de registo"}),Object(J.jsxs)("div",{className:"p-field",children:[Object(J.jsxs)("span",{className:"p-float-label",children:[Object(J.jsx)(ac.a,{name:"name",control:m,rules:{required:"Campo obrigat\xf3rio."},render:function(e){var t=e.field,n=e.fieldState;return Object(J.jsx)(jt.a,Object(Y.a)(Object(Y.a)({id:t.name},t),{},{autoFocus:!0,className:Object(oc.a)({"p-invalid":n.invalid})}))}}),Object(J.jsx)("label",{htmlFor:"name",className:Object(oc.a)({"p-error":g.name}),children:"Nome*"})]}),_(g,"name")]}),Object(J.jsxs)("div",{className:"p-field",children:[Object(J.jsxs)("span",{className:"p-float-label p-input-icon-right",children:[Object(J.jsx)("i",{className:"pi pi-envelope"}),Object(J.jsx)(ac.a,{name:"email",control:m,rules:{required:"Campo obrigat\xf3rio",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,message:"Email inv\xe1lido. E.g. exemplo@email.pt"}},render:function(e){var t=e.field,n=e.fieldState;return Object(J.jsx)(jt.a,Object(Y.a)(Object(Y.a)({id:t.name},t),{},{disabled:!!f,className:Object(oc.a)({"p-invalid":n.invalid})}))}}),Object(J.jsx)("label",{htmlFor:"email",className:Object(oc.a)({"p-error":!!g.email}),children:"Email*"})]}),_(g,"email")]}),Object(J.jsxs)("div",{className:"p-field",children:[Object(J.jsxs)("span",{className:"p-float-label",children:[Object(J.jsx)(ac.a,{name:"username",control:m,rules:{required:"Campo obrigat\xf3rio."},render:function(e){var t=e.field,n=e.fieldState;return Object(J.jsx)(jt.a,Object(Y.a)(Object(Y.a)({id:t.name},t),{},{className:Object(oc.a)({"p-invalid":n.invalid}),autoComplete:"off"}))}}),Object(J.jsx)("label",{htmlFor:"username",className:Object(oc.a)({"p-error":g.username}),children:"Username*"})]}),_(g,"username")]}),Object(J.jsxs)("div",{className:"p-field",children:[Object(J.jsxs)("span",{className:"p-float-label",children:[Object(J.jsx)(ac.a,{name:"password",control:m,rules:{required:"Campo obrigat\xf3rio."},render:function(e){var t=e.field,n=e.fieldState;return Object(J.jsx)(xn.a,Object(Y.a)(Object(Y.a)(Object(Y.a)({id:t.name},t),{},{toggleMask:!0,promptLabel:"Introduza a password"},dc),{},{className:Object(oc.a)({"p-invalid":n.invalid}),footer:x,autoComplete:"off","aria-autocomplete":"none"}))}}),Object(J.jsx)("label",{htmlFor:"password",className:Object(oc.a)({"p-error":g.password}),children:"Password*"})]}),_(g,"password")]}),Object(J.jsxs)("div",{className:"p-field-checkbox",children:[Object(J.jsx)(ac.a,{name:"accept",control:m,rules:{required:!0},render:function(e){var t=e.field,n=e.fieldState;return Object(J.jsx)(Zr.a,{inputId:t.name,onChange:function(e){return t.onChange(e.checked)},checked:t.value,className:Object(oc.a)({"p-invalid":n.invalid})})}}),Object(J.jsxs)("label",{htmlFor:"accept",className:Object(oc.a)({"p-error":g.accept}),children:["Aceito os ",Object(J.jsx)("a",{href:O,target:"_blank",rel:"noopener noreferrer",className:Object(oc.a)({"p-error":g.accept}),children:"termos e condi\xe7\xf5es de utiliza\xe7\xe3o"}),"*"]})]})]}),d&&Object(J.jsx)("div",{className:"p-fluid",children:Object(J.jsx)("div",{className:"p-field p-grid",children:Object(J.jsx)("div",{className:"p-col-12",children:Object(J.jsx)(bt.a,{className:"p-button-link",label:"Login",onClick:function(e){e.preventDefault(),d()}})})})}),Object(J.jsx)("div",{className:"p-dialog-myfooter",children:Object(J.jsx)(bt.a,{color:"green",icon:i.loading?"pi pi-spin pi-spinner":"pi pi-check",label:"Registar",type:"submit",disabled:i.loading})}),i.http_error&&!i.response&&Object(J.jsx)(mt.a,{style:{width:"100%"},severity:"error",text:"Servi\xe7o Indispon\xedvel"}),i.response&&!!i.response&&!!i.response.message&&Object(J.jsx)(mt.a,{style:{width:"100%"},severity:"error",text:i.response.message})]}):Object(J.jsxs)("div",{className:"p-d-flex p-ai-center p-dir-col p-pt-6 p-px-3",children:[Object(J.jsx)("i",{className:"pi pi-check-circle",style:{fontSize:"5rem",color:"var(--green-500)"}}),Object(J.jsx)("h3",{children:"Registo realizado com sucesso!"}),Object(J.jsxs)("p",{style:{lineHeight:1.5},children:["A sua conta foi registada com o username ",Object(J.jsx)("b",{children:null===i||void 0===i||null===(j=i.response)||void 0===j?void 0:j.username}),", dever\xe1 proceder \xe0 sua ativa\xe7\xe3o durante as pr\xf3ximas 24 horas. Por favor, verifique as instru\xe7\xf5es de ativa\xe7\xe3o da conta enviadas para o email ",Object(J.jsx)("b",{children:null===i||void 0===i||null===(h=i.response)||void 0===h?void 0:h.email}),"."]}),Object(J.jsx)("div",{className:"p-col-12 p-md-6 p-p-2 p-text-center",children:Object(J.jsx)(bt.a,{className:"p-button-link",style:{width:"auto"},label:"Login",onClick:function(e){e.preventDefault(),d()}})})]})})),fc={USERLOGIN_SHOW:"UserLogin/Show",USERLOGIN_LOGIN:"UserLogin/Show",USERLOGIN_REGISTRATION:"UserLogin/Registration"},jc=new ft.a,hc="ScalarGIS";function bc(e){e.region,e.as;var t,n,r,i,a,o=e.core,c=e.config,s=e.actions,l=e.record,u=c.viewer,d=(c.mainMap,c.dispatch),p=c.Models.Utils,f=p.getWindowSize,j=(p.showOnPortal,Object(H.useState)(!0)),h=Object(X.a)(j,2),b=h[0],m=h[1],g=Object(H.useState)(!1),v=Object(X.a)(g,2),O=v[0],_=v[1],x=Object(H.useState)(!1),y=Object(X.a)(x,2),w=y[0],E=y[1],S=Object(H.useState)(!1),P=Object(X.a)(S,2),A=P[0],C=P[1],T=Object(H.useRef)(),R=s.logout,N=jc.get(o.COOKIE_AUTH_NAME),k=f(),I=(k[0],k[0]<=440);if(Object(H.useEffect)((function(){var e;if(null!==o&&void 0!==o&&null!==(e=o.pubsub)&&void 0!==e&&e.subscribe)return[o.pubsub.subscribe(fc.USERLOGIN_SHOW,(function(e){E(!1),_(!0)})),o.pubsub.subscribe(fc.USERLOGIN_REGISTRATION,(function(e){_(!1),E(!0)}))]}),[]),Object(H.useEffect)((function(){c&&c.roles&&1===c.roles.length&&"Anonymous"===c.roles[0].name&&m(!1)}),[c]),N){var M=N.username,L=[{label:"Terminar Sess\xe3o",icon:"pi pi-lock",command:function(){d(R())}}];return I&&L.unshift({label:M,disabled:!0,style:{wordBreak:"break-all"}}),Object(J.jsxs)("span",{style:{position:"relative"},children:[b?Object(J.jsxs)("button",{className:"p-link",onClick:function(e){return C(!A)},children:[Object(J.jsx)("span",{className:"layout-topbar-item-text",children:I?"":M}),Object(J.jsx)("span",{className:"layout-topbar-icon pi pi-user"})," ",I?"":M]}):null,Object(J.jsx)(_n.a,{model:L,ref:function(e){return T.current=e},id:"user_menu",style:{display:A?"block":"none"}})]})}return O?Object(J.jsx)(vt.a,{header:null!==l&&void 0!==l&&null!==(t=l.config_json)&&void 0!==t&&t.header?null===l||void 0===l||null===(n=l.config_json)||void 0===n?void 0:n.header:"Entrar - "+(hc||"ScalarGIS"),visible:O,style:{width:k[0]<768?"90%":"35vw"},modal:!0,closable:!1!==(null===l||void 0===l||null===(r=l.config_json)||void 0===r?void 0:r.closable),onHide:function(e){return _(!1)},children:Object(J.jsx)(sc,{core:o,dispatch:d,actions:s,record:l,redirect:null===u||void 0===u?void 0:u.name,onHide:function(){var e;!1!==(null===l||void 0===l||null===(e=l.config_json)||void 0===e?void 0:e.closable)&&_(!1)},showRegistration:function(){var e,t,n,r;if(null!==l&&void 0!==l&&null!==(e=l.config_json)&&void 0!==e&&null!==(t=e.actions)&&void 0!==t&&t.registration)return _(!1),E(!1),void o.pubsub.publish(null===l||void 0===l||null===(n=l.config_json)||void 0===n||null===(r=n.actions)||void 0===r?void 0:r.registration,null);_(!1),E(!0)}})}):w?Object(J.jsx)(vt.a,{header:null!==l&&void 0!==l&&null!==(i=l.config_json)&&void 0!==i&&i.header?null===l||void 0===l||null===(a=l.config_json)||void 0===a?void 0:a.header:"Registo de Utilizador - "+(hc||"ScalarGIS"),visible:w,style:{width:k[0]<768?"90%":"35vw"},modal:!0,onHide:function(e){return E(!1)},children:Object(J.jsx)(pc,{core:o,dispatch:d,actions:s,viewer:u,record:l,redirect:null===u||void 0===u?void 0:u.name,showLogin:function(){E(!1),_(!0)}})}):b?Object(J.jsxs)("button",{className:"p-link",onClick:function(e){return _(!0)},title:c.tooltip_login||"",children:[Object(J.jsx)("span",{className:"layout-topbar-item-text",children:"Utilizador"}),Object(J.jsx)("span",{className:"layout-topbar-icon pi pi-unlock"})]}):null}var mc="AUTH_HTTP_LOADING",gc="AUTH_HTTP_ERROR",vc="AUTH_CLEAR_ERROR",Oc="AUTH_RESPONSE",_c="AUTH_LOGIN",xc="PASSWORD_HTTP_LOADING",yc="PASSWORD_HTTP_ERROR",wc="PASSWORD_RESPONSE",Ec="REGISTRATION_HTTP_LOADING",Sc="REGISTRATION_HTTP_ERROR",Pc="REGISTRATION_RESPONSE",Ac="VIEWER_LOAD",Cc="VIEWER_LOAD_DONE",Tc="VIEWER_SAVE_HTTP_LOADING",Rc="VIEWER_SAVE_HTTP_ERROR",Nc="VIEWER_SAVE_RESPONSE",kc="VIEWER_SESSION_LOAD",Ic="VIEWER_SESSION_SAVED",Mc="VIEWER_SET_CONFIG",Lc="VIEWER_LOAD_ERROR",Fc="VIEWER_NOT_FOUND",Uc="VIEWER_NOT_AUTHORIZED",Gc="VIEWER_LOAD_COMPONENTS",Dc="VIEWER_UNLOAD_COMPONENTS",Vc="VIEWER_SET_SELECTEDMENU",Wc="VIEWER_SET_FEATUREINFO",Hc="VIEWER_SET_GEOLOCATION",zc="VIEWER_SET_DRAWINGS",Kc="VIEWER_SET_COORDINATES",Bc="MAP_SET_EXTENT",Yc="MAP_SET_SIZE",qc="MAP_SET_CLASS",Xc="LAYERS_SET_CHECKED",Jc="LAYERS_SET_OPENED",Zc="LAYERS_UPDATE_THEME",$c="LAYERS_REMOVE_ITEMS",Qc="VIEWER_SET_DISPLAYCRS",es="VIEWER_ADD_THEMES",ts="VIEWER_REMOVE_THEMES",ns="VIEWER_SET_CONFIGJSON",rs="VIEWER_UPDATE_MAPCONTROL",is="VIEWER_SET_EXCUSIVE_MAPCONTROL",as="LAYOUT_WRAPPER_CLICK",os="LAYOUT_TOGGLE_OVERLAYMENU",cs="LAYOUT_TOGGLE_STATICMENU",ss="LAYOUT_TOGGLE_MOBILEMENU",ls="/static/viewer/config.json",us=Re(),ds=Ne(),ps=Me(),fs="/",js=parseInt("150",10);function hs(e,t,n){return function(t,n){t(ms());var r={headers:{Accept:"application/json","Content-Type":"application/json"},method:e.id?"PUT":"POST",body:JSON.stringify(e)},i=(new ft.a).get(ps);i&&(r.headers["X-API-KEY"]=i.token);var a=us+"/app/viewer";e.id&&(a+="/"+e.id),fetch(a,r).then((function(e){return e.json()})).then((function(n){var r=e.id?{name:e.name,title:e.title,description:e.description,allow_user_session:e.allow_user_session||!1,allow_anonymous:e.allow_anonymous,is_active:e.is_active}:null;t(gs(n,r))})).catch((function(e){console.log("error",e),t(bs())}))}}function bs(){return{type:Rc,error:!0}}function ms(){return{type:Tc}}function gs(e,t){return{type:Nc,res:e,save_options:t}}function vs(){return{type:mc}}function Os(e,t,n,r){return function(i,a){i(vs());var o={method:"POST",body:JSON.stringify(e)};fetch(us+"/authentication/authenticate",o).then((function(e){return e.json()})).then((function(e){if(i(Es(e)),e.authenticated){var a=new ft.a,o=new Date;o.setDate(o.getDate()+parseInt(js)),a.set(ps,e,{path:r||fs,expires:o}),r?window.location.assign(r):n&&t?t.push({pathname:n}):window.location.reload()}else i(ys({status:401,message:"Nome de Utilizador ou Palavra-passe inv\xe1lido"}))})).catch((function(e){console.log("error",e),i(ys())}))}}function _s(e,t,n,r){return function(i,a){if(i(Es(e)),e.authenticated){var o=new ft.a,c=new Date;c.setDate(c.getDate()+parseInt(js)),o.set(ps,e,{path:r||fs,expires:c}),r?window.location.assign(r):n&&t?t.push({pathname:n}):window.location.reload()}}}function xs(){(new ft.a).remove(ps,{path:fs}),window.location.reload()}function ys(e){return{type:gc,res:e}}function ws(){return{type:vc}}function Es(e){return{type:Oc,res:e}}function Ss(e,t,n){return function(t,r){t(vs());var i={method:"POST",body:JSON.stringify(Object(Y.a)(Object(Y.a)({},e),{},{redirect:n}))};fetch(us+"/security/reset_password",i).then((function(e){return e.json()})).then((function(e){e.error?t(ys({status:e.status,message:e.message})):t(Es(Object(Y.a)({reset_password:!0},e)))})).catch((function(e){t(ys())}))}}function Ps(){return{type:xc}}function As(e,t,n){return function(t,n){t(Ps());var r={method:"POST",body:JSON.stringify(e)};fetch(us+"/security/reset_password_validation",r).then((function(e){return e.json()})).then((function(e){e.error?t(ys({status:e.status,valid_token:!1,message:e.message})):t(Ts(e))})).catch((function(e){t(ys({status:401,valid_token:!1,message:"Servi\xe7o indispon\xedvel"}))}))}}function Cs(e,t,n){return function(t,n){t(Ps());var r={method:"POST",body:JSON.stringify(e)};fetch(us+"/security/set_password",r).then((function(e){return e.json()})).then((function(e){e.error?t(ys({status:e.status,message:e.message})):t(Ts(e))})).catch((function(e){t(Rs())}))}}function Ts(e){return{type:wc,res:e}}function Rs(e){return{type:yc,res:e}}function Ns(e,t,n){return function(t,r){t(vs());var i=e.username,a=e.email,o={method:"POST",body:JSON.stringify(Object(Y.a)(Object(Y.a)({},e),{},{redirect:n}))};fetch(us+"/security/register_user",o).then((function(e){return e.json()})).then((function(e){e.error?t(ys({status:e.status,message:e.message})):t(Es(Object(Y.a)({register_user:!0,username:i,email:a,redirect:n},e)))})).catch((function(e){t(ys())}))}}function ks(){return{type:Ec}}function Is(e,t,n){return function(r,i){r(ks());var a={method:"POST",body:JSON.stringify(e)};fetch(us+"/security/registration/confirmation",a).then((function(e){return e.json()})).then((function(e){if(r(Fs(e)),e.authenticated){var i=new ft.a,a=new Date;a.setDate(a.getDate()+parseInt(js)),i.set(ps,e,{path:fs,expires:a}),n&&t?t.push({pathname:n}):window.location.reload()}})).catch((function(e){r(Us())}))}}function Ms(e,t,n){return function(t,n){t(vs());var r={method:"POST",body:JSON.stringify(e)};fetch(us+"/security/registration/confirmation",r).then((function(e){return e.json()})).then((function(e){e.error?t(ys({status:e.status,valid_token:!1,message:e.message})):t(Fs(e))})).catch((function(e){t(ys())}))}}function Ls(e,t,n){return function(t,r){t(vs());var i={method:"POST",body:JSON.stringify(Object(Y.a)(Object(Y.a)({},e),{},{redirect:n}))};fetch(us+"/security/registration/send_confirmation",i).then((function(e){return e.json()})).then((function(e){e.error?t(ys({status:e.status,message:e.message})):t(Es(e))})).catch((function(e){t(ys())}))}}function Fs(e){return{type:Pc,res:e}}function Us(e){return{type:Sc,res:e}}function Gs(e){return{type:zc,data:e}}function Ds(e){return{type:Wc,data:e}}function Vs(e){return{type:Hc,data:e}}function Ws(e){return{type:Kc,data:e}}function Hs(e){return{type:Mc,config:e,viewer:e}}function zs(e){return{type:Gc,components:e}}function Ks(e){return function(t,n){e.unloadComponents(),t({type:Dc})}}function Bs(e){var t={type:Lc,redirect:"/not-found"};return t.redirect&&e&&e.push({pathname:t.redirect}),t}function Ys(e){var t={type:Fc,redirect:"/not-found"};return t.redirect&&e&&e.push({pathname:t.redirect}),t}function qs(e,t){var n={type:Uc,redirect:t||"/not-allowed"};return n.redirect&&e&&e.push({pathname:n.redirect}),n}function Xs(e){return{type:Cc}}function Js(e){return{type:Vc,selected_menu:e}}function Zs(e){return{type:is,exclusive_mapcontrol:e}}function $s(e,t,n){return function(r,i){var a=(new ft.a).get(ps),o=t?us+"/app/viewer/"+t+(n.location.search||""):ls;o||(o=us+"/app/viewer"+(n.location.search||""));var c={headers:{}};a&&(c.headers["X-API-KEY"]=a.token),fetch(o,c).then((function(e){if(401===e.status)throw new Error("Unauthorized");if(200!==e.status)throw new Error("Not found");return e.json()})).then((function(t){var i,a,o;if(!t)return r(Ys(n));if(!t.config_json)return r(Ys(n));null!==t&&void 0!==t&&null!==(i=t.user_info)&&void 0!==i&&i.username||(new ft.a).remove(ps,{path:fs});r(Ks(e)),t.checked=t.config_json.checked?t.config_json.checked:[],t.removed=[],t.featureinfo=[],t.geolocation=null,t.coordinates=[],t.exclusive_mapcontrol=null,e.setConfig(t),!1!==(null===t||void 0===t||null===(a=t.config_json)||void 0===a?void 0:a.show_menu)&&null!==t&&void 0!==t&&null!==(o=t.config_json)&&void 0!==o&&o.selected_menu||(t.staticMenuInactive=!0),r(Hs(t));var c=0,s=t.config_json.components;s.forEach((function(t){e.addComponent(e,t,(function(){if(++c===s.length){var e={};s.forEach((function(t){return e[t.id]=t})),r(zs(e)),r(Xs())}}))}))})).catch((function(i){if("Unauthorized"===i.message)if(a)r(qs(n));else{var o="/login?redirect="+(t||"/");window.location.pathname.toLowerCase().indexOf(e.BASE_URL+"mapa")>-1?o+="&path=/mapa/":window.location.pathname.toLowerCase().indexOf(e.BASE_URL+"map")>-1?o+="&path=/map/":window.location.pathname.toLowerCase().indexOf(e.BASE_URL)<0&&(o+="&url_redirect=/"+t),n.push(o)}else r(Ys(n))}))}}function Qs(e){var t={type:kc,redirect:e.location.pathname+(e.location.search?e.location.search+"&session=true":"?session=true")};return t.redirect&&e&&e.push({pathname:t.redirect}),t}function el(e){return{type:Ic,session:e}}function tl(e,t){return jn(e,t)}function nl(e,t,n){return{type:Bc,center:e,extent:t,srid:n}}function rl(e){return{type:Yc,size:e}}function il(e){return{type:qc,className:e}}function al(e){return{type:Xc,checked:e}}function ol(e){return{type:Jc,opened:e}}function cl(e){return{type:Zc,theme:e}}function sl(e){return{type:es,parentId:e,themes:arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],top:arguments.length>2?arguments[2]:void 0}}function ll(e){return{type:$c,ids:e}}function ul(e){return{type:ts,ids:e}}function dl(e){return{type:ns,config_json:e}}function pl(e){return{type:rs,control:e}}function fl(e){return{type:Qc,crs:e}}function jl(){return{type:as,overlayMenuActive:!1,mobileMenuActive:!1}}function hl(){return{type:os}}function bl(){return{type:cs}}function ml(){return{type:ss}}function gl(e){return function(t,n){e?"overlay"===n().root.viewer.layoutMode?t(hl()):"static"===n().root.viewer.layoutMode&&t(bl()):t(ml())}}function vl(e){return function(t,n){e?"overlay"===n().root.viewer.layoutMode?n().root.viewer.overlayMenuActive&&t(hl()):"static"===n().root.viewer.layoutMode&&n().root.viewer.staticMenuInactive&&t(bl()):"overlay"===n().root.viewer.layoutMode?n().root.viewer.overlayMenuActive&&t(hl()):"static"===n().root.viewer.layoutMode&&(n().root.viewer.mobileMenuActive||t(ml()))}}function Ol(e){var t=e.legend_url;t||"WMS"!==e.type?"https:"!==window.location.protocol||Se(t)||-1!=navigator.userAgent.indexOf("Firefox")||"http:"===new URL(t).protocol&&(t=ds+encodeURIComponent(t)):t=_l(e.url,e.wms_layers||e.layers,e.crs);return t}var _l=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4326,r=e;(r=(r+=-1===r.indexOf("?")?"?":"")+"&"+["SERVICE=WMS","VERSION=1.1.1","REQUEST=GetLegendGraphic","FORMAT=image%2Fpng","SRS="+(-1===String(n).indexOf(":")?"EPSG:"+n:n),"CRS="+(-1===String(n).indexOf(":")?"EPSG:"+n:n),"LAYER="+t].join("&"),"https:"!=window.location.protocol||Se(r)||-1!=navigator.userAgent.indexOf("Firefox"))||"http:"===new URL(r).protocol&&(r=ds+encodeURIComponent(r));return r},xl=function(e,t,n){return $t(e,t,n)},yl={};function wl(e,t){yl[e]||(yl[e]={});var n=Object(oe.a)();return yl[e][n]=t,function(){yl[e][n]=null,delete yl[e][n]}}function El(e,t){yl[e]&&Object.values(yl[e]).forEach((function(e){e&&e(t)}))}function Sl(e,t){var n=function(e){var t=Object(Y.a)({},e),n={},r=Object(pt.b)(t),i=[];return{getReducerMap:function(){return t},reduce:function(e,t){if(i.length>0){e=Object(Y.a)({},e);for(var n=0,a=i;n<a.length;n++)delete e[a[n]];i=[]}return r(e,t)},add:function(e,i){n[e]?n[e]=Object(Y.a)(Object(Y.a)({},n[e]),i):n[e]=Object(Y.a)({},i);var a=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;return n[e]&&n[e][r.type]?(0,n[e][r.type])(t,r):t};Object.defineProperty(a,"name",{value:e}),t[e]=a,r=Object(pt.b)(t)},remove:function(e){e&&t[e]&&(delete t[e],i.push(e),r=Object(pt.b)(t))}}}(t),r=Object(pt.c)(n.reduce,Object(pt.a)(dt.a));r.reducerManager=n;for(var i=0,a=Object.entries(e);i<a.length;i++){var o=Object(X.a)(a[i],2),c=o[0],s=o[1];this[c]=s}this.config={},this.actions=V,this.pubsub=W,this.store=r,this.__components={},this.__mainmenu={},this.__secureProps=["config","actions","store","Renderer","__components","__mainmenu"]}Sl.prototype.setConfig=function(e){this.config=e},Sl.prototype.addComponent=function(e,t,r){var i=this,a=Object(Y.a)(Object(Y.a)({},l),D);if(a[t.type]){var o=a[t.type];if(o.actions&&"object"===typeof o.actions&&(e.actions=Object(ut.a)(e.actions,Object(ut.b)(o.actions,this.__secureProps))),o.reducers&&"object"===typeof o.reducers&&Object.entries(o.reducers).forEach((function(t){var n=Object(X.a)(t,2),r=n[0],i=n[1];e.store.reducerManager.add(r,i)})),o.default&&!this.__components[t.type]){var c=o.default;this.__components[t.type]=c}if(o.MainMenu&&!this.__mainmenu[t.type]){var s=o.MainMenu;this.__mainmenu[t.type]=s}r()}else n(1398)("./"+t.type+"/src/Main.js").then((function(n){if(n.actions&&"object"===typeof n.actions&&(e.actions=Object(ut.a)(e.actions,Object(ut.b)(n.actions,i.__secureProps))),n.reducers&&"object"===typeof n.reducers&&Object.entries(n.reducers).forEach((function(t){var n=Object(X.a)(t,2),r=n[0],i=n[1];e.store.reducerManager.add(r,i)})),n.default&&!i.__components[t.type]){var a=n.default;i.__components[t.type]=a}if(n.MainMenu&&!i.__mainmenu[t.type]){var o=n.MainMenu;i.__mainmenu[t.type]=o}r()})).catch((function(e){console.log("Error loading module:",e),r()}))},Sl.prototype.unloadComponents=function(){this.__components={}},Sl.prototype.renderMainMenu=function(e){var t=this,n=e.selected_menu,i=e.props;return 0===Object.keys(this.__mainmenu).length?null:this.config.config_json.components.filter((function(e){return"mainmenu"===e.target})).map((function(e){var a=t.__mainmenu[e.type];if(!a)return null;var o=n===e.id?"p-button-rounded p-button-raised p-button-sm":"p-button-rounded p-button-raised p-button-sm p-button-outlined";return Object(J.jsx)(z.a.Fragment,{children:Object(J.jsx)(a,{className:o,record:e,config:Object(Y.a)(Object(Y.a)({className:o},i),e.config_json),core:t,actions:t.actions,utils:r})},e.id)}))},Sl.prototype.renderComponentById=function(e){var t=e.id,n=e.as,i=void 0===n?"":n,a=e.props;if(!t)return null;if(0===Object.keys(this.__components).length)return null;var o=this.config.config_json.components.find((function(e){return e.id===t})),c=this.__components[o.type];return c?Object(J.jsx)(c,{record:o,config:Object(Y.a)(Object(Y.a)({},a),o.config_json),core:this,actions:this.actions,as:i,utils:r}):null},Sl.prototype.renderComponents=function(e){var t=this,n=e.region,i=e.as,a=void 0===i?"":i,o=e.props,c=e.parent,s=e.separator,l=void 0===s?"":s,u=e.style,d=void 0===u?null:u,p=e.className,f=void 0===p?"":p;if(0===Object.keys(this.__components).length)return null;var j=this.config.config_json.components;return c&&(j=j.filter((function(e){return c.children.includes(e.id)}))),j.filter((function(e){return e.target===n})).map((function(e){var i=t.__components[e.type];return i?Object(J.jsxs)("div",{className:f,style:d?d(e):null,children:[Object(J.jsx)(i,{record:e,config:Object(Y.a)(Object(Y.a)({},o),e.config_json),core:t,actions:t.actions,region:n,as:e.as||a,utils:r}),l]},e.id):null}))},Sl.prototype.renderComponentsLinks=function(e){var t=this,n=e.region,i=e.as,a=void 0===i?"":i,o=e.props,c=e.parent,s=e.separator,l=void 0===s?"":s,u=e.style,d=void 0===u?null:u,p=e.className,f=void 0===p?"":p;if(0===Object.keys(this.__components).length)return null;var j=this.config.config_json.components;return c&&(j=j.filter((function(e){return c.children.includes(e.id)}))),j.filter((function(e){return e.links===n})).map((function(e){var i=t.__components[e.type];return i?Object(J.jsxs)("div",{className:f,style:d?d(e):null,children:[Object(J.jsx)(i,{type:"link",region:n,record:e,config:Object(Y.a)(Object(Y.a)({},o),e.config_json),core:t,actions:t.actions,as:a,utils:r}),l]},e.id):null}))};var Pl=Sl,Al={layoutMode:"static",layoutColorMode:"light",staticMenuInactive:!1,overlayMenuActive:!1,mobileMenuActive:!1,config_json:{layers:[],removed:[],map_controls:[]}},Cl=new ft.a,Tl=Me(),Rl={root:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{loading:!0,auth:{data:Cl.get(Tl)},registration:{},password:{},config:null,viewer:Al,components:{}},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case mc:return Object(Y.a)(Object(Y.a)({},e),{},{auth:{loading:!0,http_error:!1,error:null}});case gc:return Object(Y.a)(Object(Y.a)({},e),{},{auth:{loading:!1,http_error:!0,response:t.res}});case vc:return Object(Y.a)(Object(Y.a)({},e),{},{auth:{loading:!1,http_error:!1,response:null}});case Oc:return Object(Y.a)(Object(Y.a)({},e),{},{auth:{loading:!1,response:t.res}});case xc:return Object(Y.a)(Object(Y.a)({},e),{},{password:{loading:!0,http_error:!1,error:null}});case yc:return Object(Y.a)(Object(Y.a)({},e),{},{password:{loading:!1,http_error:!0,response:t.res}});case wc:return Object(Y.a)(Object(Y.a)({},e),{},{password:{loading:!1,response:t.res}});case Ec:return Object(Y.a)(Object(Y.a)({},e),{},{registration:{loading:!0,http_error:!1,error:null}});case Sc:return Object(Y.a)(Object(Y.a)({},e),{},{registration:{loading:!1,http_error:!0,response:t.res}});case Pc:return Object(Y.a)(Object(Y.a)({},e),{},{registration:{loading:!1,response:t.res}});case Ac:return Object(Y.a)(Object(Y.a)({},e),{},{loading:!0});case Mc:return Object(Y.a)(Object(Y.a)({},e),{},{config:t.config,viewer:Object(Y.a)(Object(Y.a)({},Al),t.viewer)});case Tc:return Object(Y.a)(Object(Y.a)({},e),{},{viewer:Object(Y.a)(Object(Y.a)({},e.viewer),{},{save_loading:!0,save_response:null,save_error:null})});case Rc:return Object(Y.a)(Object(Y.a)({},e),{},{viewer:Object(Y.a)(Object(Y.a)({},e.viewer),{},{save_loading:!1,save_error:t.error})});case Nc:var n={name:t.save_options?t.save_options.name:e.viewer.name,title:t.save_options?t.save_options.title:e.viewer.title,description:t.save_options?t.save_options.description:e.viewer.description,allow_anonymous:t.save_options?t.save_options.allow_anonymous:e.viewer.allow_anonymous,allow_user_session:t.save_options?t.save_options.allow_user_session:e.viewer.allow_user_session,is_active:t.save_options?t.save_options.is_active:e.viewer.is_active};return Object(Y.a)(Object(Y.a)({},e),{},{viewer:Object(Y.a)(Object(Y.a)(Object(Y.a)({},e.viewer),n),{},{save_loading:!1,save_response:t.res})});case Gc:return Object(Y.a)(Object(Y.a)({},e),{},{components:t.components});case Dc:return Object(Y.a)(Object(Y.a)({},e),{},{components:{}});case Cc:return Object(Y.a)(Object(Y.a)({},e),{},{loading:!1});case Vc:return Object(Y.a)(Object(Y.a)({},e),{},{viewer:Object(Y.a)(Object(Y.a)({},e.viewer),{},{config_json:Object(Y.a)(Object(Y.a)({},e.viewer.config_json),{},{selected_menu:t.selected_menu})})});case is:return Object(Y.a)(Object(Y.a)({},e),{},{viewer:Object(Y.a)(Object(Y.a)({},e.viewer),{},{exclusive_mapcontrol:t.exclusive_mapcontrol})});case zc:return Object(Y.a)(Object(Y.a)({},e),{},{viewer:Object(Y.a)(Object(Y.a)({},e.viewer),{},{config_json:Object(Y.a)(Object(Y.a)({},e.viewer.config_json),{},{drawings:Object(ae.a)(t.data)})})});case Wc:return Object(Y.a)(Object(Y.a)({},e),{},{viewer:Object(Y.a)(Object(Y.a)({},e.viewer),{},{featureinfo:Object(ae.a)(t.data)})});case Hc:return Object(Y.a)(Object(Y.a)({},e),{},{viewer:Object(Y.a)(Object(Y.a)({},e.viewer),{},{geolocation:t.data})});case Kc:return Object(Y.a)(Object(Y.a)({},e),{},{viewer:Object(Y.a)(Object(Y.a)({},e.viewer),{},{coordinates:Object(ae.a)(t.data)})});case Bc:return Object(Y.a)(Object(Y.a)({},e),{},{viewer:Object(Y.a)(Object(Y.a)({},e.viewer),{},{config_json:Object(Y.a)(Object(Y.a)({},e.viewer.config_json),{},{center:t.center,extent:t.extent})})});case Yc:return Object(Y.a)(Object(Y.a)({},e),{},{viewer:Object(Y.a)(Object(Y.a)({},e.viewer),{},{size:t.size})});case qc:return Object(Y.a)(Object(Y.a)({},e),{},{viewer:Object(Y.a)(Object(Y.a)({},e.viewer),{},{className:t.className})});case Xc:var r=Object(ae.a)(t.checked);return Object(Y.a)(Object(Y.a)({},e),{},{viewer:Object(Y.a)(Object(Y.a)({},e.viewer),{},{config_json:Object(Y.a)(Object(Y.a)({},e.viewer.config_json),{},{checked:r})})});case Jc:var i=Object(ae.a)(t.opened);return Object(Y.a)(Object(Y.a)({},e),{},{viewer:Object(Y.a)(Object(Y.a)({},e.viewer),{},{config_json:Object(Y.a)(Object(Y.a)({},e.viewer.config_json),{},{opened:i})})});case Zc:var a=e.viewer.config_json.layers,o=a.findIndex((function(e){return e.id===t.theme.id}));return a.splice(o,1,t.theme),Object(Y.a)(Object(Y.a)({},e),{},{viewer:Object(Y.a)(Object(Y.a)({},e.viewer),{},{config_json:Object(Y.a)(Object(Y.a)({},e.viewer.config_json),{},{layers:a})})});case $c:var c=Object.assign([],e.viewer.config_json.layers);return Be(c,null,(function(e,n){e.children&&(e.children=e.children.filter((function(e){return!1===t.ids.includes(e)})))})),Be(c,null,(function(e,n){t.ids.includes(e.id)&&c.splice(c.indexOf(e),1)})),Object(Y.a)(Object(Y.a)({},e),{},{viewer:Object(Y.a)(Object(Y.a)({},e.viewer),{},{config_json:Object(Y.a)(Object(Y.a)({},e.viewer.config_json),{},{layers:c})})});case Qc:return Object(Y.a)(Object(Y.a)({},e),{},{viewer:Object(Y.a)(Object(Y.a)({},e.viewer),{},{config_json:Object(Y.a)(Object(Y.a)({},e.viewer.config_json),{},{display_crs:t.crs})})});case es:var s=e.viewer.config_json.layers,l=Object.assign([],s);l=l.concat(t.themes.map((function(e){return Object(Y.a)(Object(Y.a)({},e),{},{opacity:void 0!=e.opacity?e.opacity:1})})));var u=t.parentId||"main",d=l.findIndex((function(e){return e.id===u})),p=Object.assign({},l[d]);return t.top?p.children=t.themes.map((function(e){return e.id})).concat(p.children):p.children=p.children.concat(t.themes.map((function(e){return e.id}))),l.splice(d,1,p),Object(Y.a)(Object(Y.a)({},e),{},{viewer:Object(Y.a)(Object(Y.a)({},e.viewer),{},{config_json:Object(Y.a)(Object(Y.a)({},e.viewer.config_json),{},{layers:l})})});case ts:var f=e.viewer.removed;return f=f.concat(t.ids),Object(Y.a)(Object(Y.a)({},e),{},{viewer:Object(Y.a)(Object(Y.a)({},e.viewer),{},{removed:f})});case rs:var j=e.viewer.config_json.map_controls,h=j.findIndex((function(e){return e.id===t.control.id}));return j.splice(h,1,t.control),Object(Y.a)(Object(Y.a)({},e),{},{viewer:Object(Y.a)(Object(Y.a)({},e.viewer),{},{config_json:Object(Y.a)(Object(Y.a)({},e.viewer.config_json),{},{map_controls:j})})});case ns:return Object(Y.a)(Object(Y.a)({},e),{},{viewer:Object(Y.a)(Object(Y.a)({},e.viewer),{},{configjson:t.configjson})});case Ic:return Object(Y.a)(Object(Y.a)({},e),{},{viewer:Object(Y.a)(Object(Y.a)({},e.viewer),{},{is_session:!0,session:t.session,save_loading:!1,save_response:null,save_error:null})});case as:return Object(Y.a)(Object(Y.a)({},e),{},{viewer:Object(Y.a)(Object(Y.a)({},e.viewer),{},{overlayMenuActive:!1})});case os:return Object(Y.a)(Object(Y.a)({},e),{},{viewer:Object(Y.a)(Object(Y.a)({},e.viewer),{},{overlayMenuActive:!e.viewer.overlayMenuActive})});case cs:return Object(Y.a)(Object(Y.a)({},e),{},{viewer:Object(Y.a)(Object(Y.a)({},e.viewer),{},{staticMenuInactive:!e.viewer.staticMenuInactive})});case ss:return Object(Y.a)(Object(Y.a)({},e),{},{viewer:Object(Y.a)(Object(Y.a)({},e.viewer),{},{mobileMenuActive:!e.viewer.mobileMenuActive})});default:return e}}},Nl=new Pl({ROOT_PATH:Ae(),BASE_URL:Ce(),CLIENT_URL:Te(),API_URL:Re(),MAP_PROXY_URL:Ne(),UPLOAD_URL:ke(),COOKIE_AUTH_NAME:Me()},Rl),kl={controls:new lt.a,interactions:new lt.a,view:new ct.a({center:[-878528,4465088],zoom:12})},Il=new st.a(kl),Ml=z.a.createContext();n(1399);var Ll=Object(q.b)((function(e){return{auth:e.root.auth,config:e.root.config,viewer:e.root.viewer}}))((function(e){var t,n,r=e.olMap,i=e.config,a=e.viewer,o=e.mainMapEl,c=e.core,s=e.dispatch,l=e.auth;Object(H.useEffect)((function(){if(i){r&&o.current&&r.setTarget(o.current);var e=i.config_json,t=e.center,n=e.extent,l=r.getView().getResolutionForExtent(n);return r.getView().setCenter(t),r.getView().setResolution(l),r.on("moveend",u),a.config_json.crs_list&&Array.isArray(a.config_json.crs_list)&&Xt(a.config_json.crs_list),function(){r.un("moveend",u)}}function u(){var e=r.getView().getCenter(),t=r.getView().calculateExtent();s(c.actions.map_set_extent(e,t))}}),[i]);var u=a.config_json,d=u.center,p=u.extent;Object(H.useEffect)((function(){if(r)if(p){var e=r.getView().getResolutionForExtent(p);r.getView().setResolution(e),r.getView().fit(p,r.getSize(),{closest:!0})}else d&&r.getView().setCenter(d)}),[d,p]);var f=a.config_json,j=f.constrained_extent,h=f.min_zoom,b=f.max_zoom,m=f.max_resolution,g=f.min_resolution,v=f.min_zoom_authenticated,O=f.max_zoom_authenticated,_=f.max_resolution_authenticated,x=f.min_resolution_authenticated;Object(H.useEffect)((function(){if(r&&(j||h||b||m||g||v||O||_||x)){var e={center:r.getView().getCenter(),zoom:r.getView().getZoom()};j&&(e.extent=j),h&&(e.minZoom=h),b&&(e.maxZoom=b),m&&(e.maxResolution=m),g&&(e.minResolution=g),l&&l.data&&l.data.authenticated&&(v&&(e.minZoom=v),O&&(e.maxZoom=O),_&&(e.maxResolution=_),x&&(e.minResolution=x)),r.setView(new ct.a(e))}}),[j,h,b,m,g,v,O,_,x]);var y={};return null!=(null===a||void 0===a||null===(t=a.size)||void 0===t?void 0:t.width)&&(y=Object(Y.a)(Object(Y.a)({},y),{},{width:a.size.width})),null!=(null===a||void 0===a||null===(n=a.size)||void 0===n?void 0:n.height)&&(y=Object(Y.a)(Object(Y.a)({},y),{},{height:a.size.height})),Object(J.jsx)(z.a.Fragment,{children:Object(J.jsx)("div",{id:"map",ref:o,style:Object(Y.a)({},y),className:null===a||void 0===a?void 0:a.className,children:e.children})})})),Fl=function(e){var t=/:(\d+)$/g.exec(e)?parseInt(/:(\d+)$/g.exec(e)[1],10):null;return t||-1!==e.indexOf("www.opengis.net/def/crs/EPSG")&&(t=e.substr(e.lastIndexOf("/")+1)),t},Ul=function(e,t,n,r){var i=[parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return t!==n&&(i=Wt.v(e,t,n)),r&&(i=[i[1],i[0],i[3],i[2]]),i},Gl=function(e){var t={};return e.MetadataUrl&&(t.url=e.MetadataUrl.URL,t.media_type=e.MetadataUrl.MediaType),t.language=e.ResponseLanguage.Language,t.supported_languages={default:e.SupportedLanguages.DefaultLanguage.Language,languages:e.SupportedLanguages.SupportedLanguage?e.SupportedLanguages.SupportedLanguage.map((function(e,t){return e.Language})):[]},t},Dl={projOptions:function(e){return e.map((function(e){return{key:""+e.srid,text:e.label,value:""+e.srid,extent:e.extent.split(" "),defs:e.defs,label:e.label,label_long:e.label_long,labelx:e.labelx,labely:e.labely,precision:e.precision}}))},convertWFS2Themes:function(e,t,n){var r,i=[];n.extent&&(r=Ul(n.extent));var a=e["wfs:WFS_Capabilities"]?"wfs:":"",o=e[a+"WFS_Capabilities"]["ows:ServiceProvider"]?"ows:":"",c=e[a+"WFS_Capabilities"][a+"FeatureTypeList"]?a:"";return e[a+"WFS_Capabilities"][c+"FeatureTypeList"][0][c+"FeatureType"].map((function(s,l){var u=[null,""+n.srid],d=e[a+"WFS_Capabilities"].$.version,p=t?t.replace("request=GetCapabilities","")+"&":"wfs_features.xml";(p=p.replace(/request=getcapabilities/i,"")).indexOf("?")<0&&(p=p.replace(/&+$/gm,""),p+="?"),["1.0.0","1.1.0"].indexOf(d)>-1&&(s.SRS?u=Fl(s.SRS[0])?parseInt(Fl(s.SRS[0]),10):u:s.DefaultSRS&&(u=Fl(s.DefaultSRS[0])?parseInt(Fl(s.DefaultSRS[0]),10):u),s[a+"DefaultCRS"]&&(u=Fl(s[a+"DefaultCRS"][0])?parseInt(Fl(s[a+"DefaultCRS"][0]),10):u),s.LatLongBoundingBox&&(r=[s.LatLongBoundingBox[0].$.minx,s.LatLongBoundingBox[0].$.miny,s.LatLongBoundingBox[0].$.maxx,s.LatLongBoundingBox[0].$.maxx],r=Ul(r)),s[o+"WGS84BoundingBox"]&&(r=[s[o+"WGS84BoundingBox"][0][o+"LowerCorner"][0].split(" ")[0],s[o+"WGS84BoundingBox"][0][o+"LowerCorner"][0].split(" ")[1],s[o+"WGS84BoundingBox"][0][o+"UpperCorner"][0].split(" ")[0],s[o+"WGS84BoundingBox"][0][o+"UpperCorner"][0].split(" ")[1]],r=Ul(r))),"2.0.0"===d&&(s[a+"DefaultCRS"]?u=Fl(s[a+"DefaultCRS"][0])?parseInt(Fl(s[a+"DefaultCRS"][0]),10):u:s.DefaultCRS&&(u=Fl(s.DefaultCRS[0])?parseInt(Fl(s.DefaultCRS[0]),10):u),s[o+"WGS84BoundingBox"]&&(u=4326,r=[s[o+"WGS84BoundingBox"][0][o+"LowerCorner"][0].split(" ")[0],s[o+"WGS84BoundingBox"][0][o+"LowerCorner"][0].split(" ")[1],s[o+"WGS84BoundingBox"][0][o+"UpperCorner"][0].split(" ")[0],s[o+"WGS84BoundingBox"][0][o+"UpperCorner"][0].split(" ")[1]],r=Ul(r)),4326!==u&&(r=Ul(r,"EPSG:"+u,"EPSG:4326"),u=4326));var f={id:Object(oe.a)(),title:s[c+"Title"][0].trim(),description:s[c+"Keywords"]?s[c+"Keywords"][0].trim():"",active:!1,open:!1,opacity:1,type:"WFS",url:p,layers:s[c+"Name"][0],servertype:"mapserver",crs:u,tiled:!0,version:d,bbox:r.join(" "),style_color:Oe(),style_stroke_color:Oe(),style_stroke_width:1};if(s.$){var j=Object.entries(s.$).find((function(e){return Object(X.a)(e,1)[0].includes("xmlns:"+c)})),h=s[c+"Name"][0].split(":").length>1?s[c+"Name"][0].split(":")[0]:"",b=s[c+"Name"][0].split(":").length>1?s[c+"Name"][0].split(":")[1]:s[c+"Name"][0];j&&(f.datatable={source_type:"wfs",source_url:p,feature_namespace:j[1],feature_prefix:h,feature_type:b,all_geometries:!0})}return i.push(f),s})),i},convertWMS2Themes:function(e,t,n){var r=[],i=e.Capability.Request.GetMap.Format.join(","),a="";if(i){var o=i.split(",");["image/png","image/png8","image/png24","image/png32","image/gif","image/jpeg","image/bmp","image/tiff","image/svg+xml"].forEach((function(e){a||o.includes(e)&&(a=e)}))}var c=e.Capability.Request.GetFeatureInfo.Format.join(","),s="";if(c){var l=c.split(",");["application/json","application/geojson","application/vnd.ogc.gml","application/vnd.ogc.gml/3.1.1","text/xml; subtype=gml/3.1.1","text/xml","text/html","text/plain"].forEach((function(e){s||l.includes(e)&&(s=e)}))}var u,d,p=4326;if(n.extent&&(u=Ul(n.extent)),e.Capability.Inspire&&(d=Gl(e.Capability.Inspire)),n.version&&"default"!==n.version&&e.version!==n.version)throw new Error("O servi\xe7o respondeu com a vers\xe3o "+e.version);var f=function e(r,o,l){var f=[];f=o.CRS&&o.CRS.length?o.CRS.filter((function(e,t,n){return n.indexOf(e)===t})):r.Capability.Layer.CRS.filter((function(e,t,n){return n.indexOf(e)===t}));var j=[],h="";o.Style&&"object"===typeof o.Style&&o.Style.length&&o.Style.map((function(e){return j.push(e.Name),!h&&"object"===typeof e.LegendURL&&e.LegendURL.length&&(h=e.LegendURL[0].OnlineResource),e}));var b=t;if(n.ignore_url?b=_e(b,"request"):r.Capability.Request.GetMap.DCPType?r.Capability.Request.GetMap.DCPType.map((function(e){return e.HTTP.Get.OnlineResource&&(b=e.HTTP.Get.OnlineResource),e})):r.Service.OnlineResource&&(b=r.Service.OnlineResource),b.indexOf("localhost")>-1&&(b=t),o.EX_GeographicBoundingBox&&o.EX_GeographicBoundingBox.length)p=4326,u=Ul(o.EX_GeographicBoundingBox,"EPSG:4326","EPSG:4326",!1);else{var m=[];(m=o.BoundingBox&&o.BoundingBox.length?o.BoundingBox.filter((function(e){return"EPSG:4326"===e.crs})):r.Capability.Layer.BoundingBox.filter((function(e){return"EPSG:4326"===e.crs}))).length&&(p=4326,u=m[0].extent,u=Ul(m[0].extent,"EPSG:4326","EPSG:4326",!1))}var g,v=null,O=null;o.MinScaleDenominator&&(v=o.MinScaleDenominator),o.MaxScaleDenominator&&(O=o.MaxScaleDenominator),o.Inspire&&(g=Gl(o.Inspire));var _={id:Object(oe.a)(),title:o.Title,description:o.Abstract,active:!1,open:!1,opacity:1,type:"WMS",url:b,layers:o.Name,children:[],servertype:"mapserver",crs:p,tiled:"undefined"===typeof n.tiled||n.tiled,version:r.version,crs_options:f.join(","),get_map_formats:i,get_map_format:a||"image/png",get_feature_info_formats:c,get_feature_info_format:s||"text/plain",wms_styles:j.join(","),wms_style:(j&&j.length)>0?j[0]:"",legend_url:h,bbox:u.join(" "),source_min_scale:v,source_max_scale:O,inspire_metadata:g||d,authkey:n.authkey};return l.push(_),o.Layer&&o.Layer.length&&o.Layer.map((function(t,n){return e(r,t,_.children),t})),_};return[e.Capability.Layer].map((function(t,n){return f(e,t,r),t})),r},convertWMTS2Themes:function(e,t,n){var r=[],i=["image/png","image/png8","image/png24","image/png32","image/gif","image/jpeg","image/bmp","image/tiff","image/svg-+xml"],a=["application/json","application/geojson","application/vnd.ogc.gml","application/vnd.ogc.gml/3.1.1","text/xml; subtype=gml/3.1.1","text/xml","text/html","text/plain"],o=t;if(n.ignore_url?o=_e(o,"request"):e.OperationsMetadata.GetTile.DCP&&e.OperationsMetadata.GetTile.DCP.HTTP.Get.map((function(e){return e.href&&(o=e.href),e})),o.indexOf("localhost")>-1&&(o=t),n.version&&"default"!==n.version&&e.version!==n.version)throw new Error("O servi\xe7o respondeu com a vers\xe3o "+e.version);return e.Contents.Layer.map((function(t,n){var c=[];t.TileMatrixSetLink&&t.TileMatrixSetLink.length>0&&(c=t.TileMatrixSetLink.map((function(e){return e.TileMatrixSet})));var s="",l=[];t.Format&&t.Format.length>0&&(l=Object(ae.a)(t.Format)),l.length>0&&i.forEach((function(e){s||l.includes(e)&&(s=e)}));var u=[],d="";t.Style&&"object"===typeof t.Style&&t.Style.length&&t.Style.map((function(e){return u.push(e.Identifier),!d&&"object"===typeof e.LegendURL&&e.LegendURL.length&&(d=e.LegendURL[0].href),e}));var p=o,f="",j=[];t.ResourceURL&&t.ResourceURL.length>0&&(j=t.ResourceURL.filter((function(e){return"FeatureInfo"===e.resourceType})).map((function(e){return e.format}))),j.length>0&&a.forEach((function(e){f||j.includes(e)&&(f=e)}));var h={id:Object(oe.a)(),title:t.Title,description:t.Abstract,active:!1,open:!1,opacity:1,type:"WMTS",url:o,layer:t.Identifier,version:e.version,crs:4326,bbox:t.WGS84BoundingBox&&t.WGS84BoundingBox.length>0?t.WGS84BoundingBox.join(" "):null,servertype:"mapserver",wmts_capabilities:e,wmts_tilematrixsets:c.join(","),wmts_tilematrixset:t.tilematrixset||"EPSG:900913",wmts_format:s||"image/png",wmts_formats:l.join(","),wmts_styles:u.join(","),wmts_style:"",get_feature_info_url:j.length>0?p:null,get_feature_info_format:f||"text/plain",get_feature_info_formats:j.join(","),legend_url:d};return r.push(h),t})),r},convertArcGISMap2Themes:function(e,t,n){var r=[],i=e.service,a=e.layers,o=i.supportedImageFormatTypes,c="";if(o){var s=o.split(",");["PNG32","PNG24","PNG","JPG","DIB","TIFF","EMF","PS","PDF","GIF","SVG","SVGZ","BMP"].forEach((function(e){c||s.includes(e)&&(c=e)}))}var l,u=4326;try{var d=i.fullExtent;if(d&&d.xmin&&d.ymin&&d.xmax&&d.ymax)if(console.log(Wt.l("EPSG:".concat(d.spatialReference.wkid))),d.spatialReference.wkid&&Wt.l("EPSG:".concat(d.spatialReference.wkid)))l=Ul([d.xmin,d.ymin,d.xmax,d.ymax],"EPSG:".concat(d.spatialReference.wkid),"EPSG:".concat(u));else if(d.spatialReference.wkt){var p=Object(zt.a)(d.spatialReference.wkt,"EPSG:4326",[d.xmin,d.ymin]),f=Object(zt.a)(d.spatialReference.wkt,"EPSG:4326",[d.xmax,d.ymax]);l=[].concat(Object(ae.a)(p),Object(ae.a)(f))}}catch(h){console.log(h)}var j=function e(r,a,o){var c,s=["EPSG:4326","EPSG:3857"];null!==i&&void 0!==i&&null!==(c=i.spatialReference)&&void 0!==c&&c.wkid&&s.push("EPSG:".concat(i.spatialReference.wkid)),a.sourceSpatialReference&&!s.includes("EPSG:".concat(a.sourceSpatialReference.wkid))&&s.push("EPSG:".concat(a.sourceSpatialReference.wkid));var d=t,p=l;try{var f=a.extent;if(f&&f.xmin&&f.ymin&&f.xmax&&f.ymax)if(f.spatialReference.wkid&&Wt.l("EPSG:".concat(f.spatialReference.wkid)))p=Ul([f.xmin,f.ymin,f.xmax,f.ymax],"EPSG:".concat(f.spatialReference.wkid),"EPSG:".concat(u));else if(f.spatialReference.wkt){var j=Object(zt.a)(f.spatialReference.wkt,"EPSG:4326",[f.xmin,f.ymin]),b=Object(zt.a)(f.spatialReference.wkt,"EPSG:4326",[f.xmax,f.ymax]);p=[].concat(Object(ae.a)(j),Object(ae.a)(b))}}catch(h){console.log(h)}var m=null!=a.maxScale?a.maxScale:null,g=null!=a.minScale?a.minScale:null,v={id:Object(oe.a)(),title:a.name,description:a.description,active:!1,open:!1,opacity:1,type:"ArcGISMap",url:d,layers:a.subLayers&&a.subLayers.length?null:"show:".concat(a.id),layerId:[a.id],children:[],servertype:"arcgismap",crs:4326,tiled:"undefined"===typeof n.tiled||n.tiled,get_feature_info_layers:"visible:".concat(a.id),crs_options:s.length?s.join(","):null,bbox:p&&p.length?p.join(" "):null,source_min_scale:m,source_max_scale:g};return o.push(v),a.subLayers&&a.subLayers.length&&a.subLayers.map((function(t,n){var i=r.layers.filter((function(e){return e.id===t.id}))[0];return e(r,i,v.children),t})),v};return a.filter((function(e){return!e.parentLayer})).map((function(t,n){return j(e,t,r),t})),r},convertKML2Themes:function(e,t,n,r){var i=[],a=new Dt.a({extractStyles:!1}),o={dataProjection:"EPSG:"+r,featureProjection:"EPSG:"+r},c=a.readFeatures(n,o),s=Kt.j();c.map((function(e){return e.getGeometry()&&Kt.p(s,e.getGeometry().getExtent()),e}));var l=[parseFloat(s[0]),parseFloat(s[1]),parseFloat(s[2]),parseFloat(s[3])];if(e&&e.kml&&e.kml.Document){var u=e.kml.Document[0],d="Documento";if(u.name&&(d=u.name[0].trim()),u.Folder)u.Folder.map((function(e,n){return i.push({id:Object(oe.a)(),title:d+" | "+e.name[0].trim(),description:e.description?e.description[0].trim():"",active:!1,open:!1,opacity:1,type:"KML",url:t,crs:parseInt(r,10),crs_options:"EPSG:"+r,bbox:l.join(" "),style_color:Oe(),style_stroke_color:Oe(),style_stroke_width:1}),e}));else if(u.name){var p=u.name[0].trim();i.push({id:Object(oe.a)(),title:p,description:u.description?u.description[0].trim():"",active:!1,open:!1,opacity:1,type:"KML",url:t,crs:parseInt(r,10),crs_options:"EPSG:"+r,bbox:l.join(" "),style_color:Oe(),style_stroke_color:Oe(),style_stroke_width:1})}else i.push({id:Object(oe.a)(),title:d,description:"",active:!1,open:!1,opacity:1,type:"KML",url:t,crs:parseInt(r,10),crs_options:"EPSG:"+r,bbox:l.join(" "),style_color:Oe(),style_stroke_color:Oe(),style_stroke_width:1})}return i},convertGeoJSON2Themes:function(e,t,n,r){var i=[],a={dataProjection:"EPSG:"+r,featureProjection:"EPSG:"+r},o=(new le.a).readFeatures(e,a),c=Kt.j();o.map((function(e){return e.getGeometry()&&Kt.p(c,e.getGeometry().getExtent()),e}));var s=[parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3])];return i.push({id:Object(oe.a)(),title:n,description:"",active:!1,open:!1,opacity:1,type:"GeoJSON",url:t,crs:parseInt(r,10),crs_options:"EPSG:"+r,bbox:s.join(" "),style_color:Oe(),style_stroke_color:Oe(),style_stroke_width:1}),i},convertGML2Themes:function(e,t,n,r){var i=[],a={dataProjection:"EPSG:"+r,featureProjection:"EPSG:"+r},o=(new Ft.a).readFeatures(e,a),c=Kt.j();o.map((function(e){return e.getGeometry()&&Kt.p(c,e.getGeometry().getExtent()),e}));var s=[parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3])];return i.push({id:Object(oe.a)(),title:n,description:"",active:!1,open:!1,opacity:1,type:"GML",url:t,crs:parseInt(r,10),crs_options:"EPSG:"+r,bbox:s.join(" "),style_color:Oe(),style_stroke_color:Oe(),style_stroke_width:1}),i},createGroup:function(e,t,n){return[{type:"GROUP",id:Object(oe.a)(),title:e,description:"",active:!0,open:!0,opacity:1,crs:t,bbox:n.join(" "),children:[]}]}};function Vl(e){var t=e.components,n=e.history,i=e.core,a=e.viewer,o=e.dispatch,c=e.mainMap,s=e.auth,l=e.onMenuClick,u=a.config_json.selected_menu;return Object(J.jsxs)("div",{className:"layout-sidebar-panel",children:[Object(J.jsx)("div",{id:"mainmenu",onClick:l,children:i.renderMainMenu({selected_menu:u,props:{components:t,history:n,viewer:a,dispatch:o,mainMap:c,Models:{MapModel:bn,OWSModel:Dl,Utils:r},auth:s}})}),Object(J.jsxs)("div",{id:"content",className:"p-d-flex p-flex-column p-jc-between",children:[i.renderComponents({id:u,region:"mainmenu",props:{history:n,viewer:a,dispatch:o,mainMap:c,Models:{MapModel:bn,OWSModel:Dl,Utils:r},auth:s},as:"panel",style:function(e){return{display:e.id!==u?"none":"block",overflowY:"auto",height:"calc(100%)"}}}),Object(J.jsx)("div",{id:"content-bottom",children:i.renderComponents({id:u,region:"mainmenu-bottom",props:{history:n,viewer:a,dispatch:o,mainMap:c,Models:{MapModel:bn,OWSModel:Dl,Utils:r},auth:s},as:""})}),i.renderComponents({region:"popup",props:{history:n,viewer:a,dispatch:o,mainMap:c,Models:{MapModel:bn,OWSModel:Dl,Utils:r},auth:s},as:"popup"})]})]})}var Wl=Object(q.b)((function(e){var t=ge(e);return{viewer:t.viewer,components:t.components,auth:t.auth}}))((function(e){var t=Object(H.useContext)(Ml),n=t.core,r=t.mainMap,i=Object(q.c)(),a=Object(H.useState)([]),o=Object(X.a)(a,2),c=o[0],s=o[1],l=e.history,u=e.viewer,d=e.components,p=e.auth,f=e.onMenuClick;return Object(H.useEffect)((function(){var e=Object.keys(d).filter((function(e){return"mainmenu"===d[e].target})).map((function(e){return d[e]}));s(e)}),[d]),Object(J.jsx)(Vl,{auth:p,history:l,core:n,mainMap:r,dispatch:i,components:c,viewer:u,onMenuClick:f})})),Hl=function(e){var t=e.children;return Object(J.jsx)("div",{children:t})},zl=function(e){var t=e.config,n=e.source,r=e.group,i=e.checked,a=Object(H.useContext)(Ml).mainMap,o=Object(H.useRef)();return Object(H.useEffect)((function(){if(a)return t.attributions&&n.setAttributions(t.attributions),o.current=new xt.a(Object(Y.a)(Object(Y.a)({},t),{},{source:n})),r.getLayers().push(o.current),function(){r.getLayers().remove(o.current)}}),[a]),Object(H.useEffect)((function(){o.current.setVisible(i.includes(t.id))}),[i]),Object(H.useEffect)((function(){o.current.setOpacity(t.opacity)}),[t]),null},Kl=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4326,r=e;return(r+=-1===r.indexOf("?")?"?":"")+"&"+["SERVICE=WMS","VERSION=1.1.1","REQUEST=GetLegendGraphic","FORMAT=image%2Fpng","SRS="+(-1===String(n).indexOf(":")?"EPSG:"+n:n),"CRS="+(-1===String(n).indexOf(":")?"EPSG:"+n:n),"LAYER="+t].join("&")},Bl=function(e){var t=e.config,n=e.group,r=e.checked,i=e.viewer,a=Object(H.useContext)(Ml),o=a.core,c=a.mainMap,s=Object(H.useRef)(),l=o.store.getState().root.auth,u=o.MAP_PROXY_URL;return Object(H.useEffect)((function(){if(c)return s.current=function(e){var t=e.url;t=_e(t,"service"),t=_e(t,"version"),t=_e(t,"request");var n=!1;i&&i.config_json&&i.config_json.proxy_http_image_requests&&(n=!0),e&&null!=e.proxy_http_image_requests&&(n=e.proxy_http_image_requests);var r={url:t,hidpi:!1,params:{LAYERS:e.layers,TILED:e.tiled,VERSION:e.version,FORMAT:e.get_map_format||e.format||"image/png",STYLES:e.wms_style||e.styles}};if(Pe(t)&&i.integrated_authentication&&l&&l.data&&l.data.auth_token){var a=(null===i||void 0===i?void 0:i.integrated_authentication_key)||"authkey";r.params[a]=l.data.auth_token}n&&("https:"!==window.location.protocol||Se(t)||-1!=navigator.userAgent.indexOf("Firefox")?n=!1:"http:"===new URL(t).protocol?e.tiled?r.tileLoadFunction=function(e,t){e.getImage().src=u+encodeURIComponent(t)}:r.imageLoadFunction=function(e,t){e.getImage().src=u+encodeURIComponent(t)}:n=!1);var o,s=c.getView().getProjection().getCode();if(e.crs_options&&-1===e.crs_options.indexOf(s)&&(-1!==e.crs_options.indexOf("EPSG:4326")?r.projection="EPSG:4326":r.projection="CRS:84"),e.attributions&&(r.attributions=e.attributions),(o=e.tiled?new xt.a({id:e.id,title:e.title,type:e.type,visible:e.active,opacity:e.opacity?e.opacity:1,source:new Ct.a(r)}):new yt.a({id:e.id,title:e.title,type:e.type,visible:e.active,opacity:e.opacity?e.opacity:1,source:new Tt.a(r)}))&&e.datasource&&o.set("datasource",e.datasource),o&&e.get_feature_info_format&&o.set("get_feature_info_format",e.get_feature_info_format),o&&e.min_resolution&&o.setMinResolution(e.min_resolution),o&&e.max_resolution&&o.setMaxResolution(e.max_resolution),o&&e.min_scale){var d=pn(e.min_scale,c.getView().getProjection().getUnits());o.setMinResolution(d)}if(o&&e.max_scale){var p=pn(e.max_scale,c.getView().getProjection().getUnits());o.setMaxResolution(p)}var f=Kl(e.url,e.wms_layers||e.layers,e.crs);return n&&(f=u+encodeURIComponent(f)),o.set("legendURL",f),o}(t),n.getLayers().push(s.current),function(){n.getLayers().remove(s.current)}}),[c]),Object(H.useEffect)((function(){s.current.setVisible(r.includes(t.id))}),[r]),Object(H.useEffect)((function(){var e={LAYERS:t.layers,TILED:t.tiled,VERSION:t.version,FORMAT:t.get_map_format||t.format||"image/png",STYLES:t.wms_style||t.styles};s.current.getSource().updateParams(e),s.current.set("selectable",t.selectable),s.current.set("get_feature_info_format",t.get_feature_info_format),s.current.setOpacity(t.opacity)}),[t]),null},Yl=n(369),ql=function(e){var t=e.config,n=e.group,r=e.checked,i=e.viewer,a=Object(H.useContext)(Ml),o=a.core,c=a.mainMap,s=Object(H.useRef)(),l=o.store.getState().root.auth,u=o.MAP_PROXY_URL;function d(e){var t=c.getView().getProjection().getCode(),n={srsName:"EPSG:"+e.crs,dataProjection:"EPSG:"+e.crs},r="GML2",a=new Ft.a(n),o={featureProjection:t},d="EPSG:"+e.crs;["2.0.0"].indexOf(e.version)>-1&&(n={srsName:"EPSG:"+e.crs,dataProjection:"EPSG:"+e.crs},r="GML3",a=new Gt.a(n),o={srsName:"EPSG:"+e.crs,dataProjection:"EPSG:"+e.crs,featureProjection:t},d="urn:ogc:def:crs:EPSG::"+e.crs);var p=new It.a({loader:function(n,c,p,f,j){var h=e.bbox?e.bbox.split(" "):null,b=(null===e||void 0===e?void 0:e.bbox_crs)||(null===e||void 0===e?void 0:e.crs),m=e.url;(m=(m=m.replace(/&$/gi,""))+(m.indexOf("?")>-1?"":"?")+"&service=WFS&version="+e.version+"&request=GetFeature&typename="+encodeURIComponent(e.layers)+"&outputFormat="+r+"&srsname="+d,"bbox"===e.strategy?parseInt(e.crs)!==parseInt(hn(t))?m+="&bbox="+(h=$t(t,"EPSG:"+e.crs,n)).join(",")+",EPSG:"+e.crs:m+="&bbox="+n.join(",")+","+t:h&&(m+="&bbox="+h.join(",")+",EPSG:"+b),null!==e&&void 0!==e&&e.max_features&&(m=e.version.startsWith("2")?m+"&count="+e.max_features:m+"&maxFeatures="+e.max_features),Pe(m)&&i.integrated_authentication)&&(l&&l.data&&l.data.auth_token&&(m=m+"&"+((null===i||void 0===i?void 0:i.integrated_authentication_key)||"authkey")+"="+l.data.auth_token));Se(m)||(m=u+encodeURIComponent(m)),fetch(m).then((function(e){return e.text()})).then((function(e){var t=[];(t=a.readFeatures(e,o)).forEach((function(e){return e.ollayer=s.current})),s.current.getSource().addFeatures(t)})).catch((function(e){console.log(e),s.current.getSource().removeLoadedExtent(n)}))},strategy:"bbox"===(null===e||void 0===e?void 0:e.strategy)?Yl.b:Yl.a,attributions:e.attributions||[]}),f=function(e){console.log(e.style_stroke_color);var t=null===e.style_color?null:e.style_color?"rgba(".concat(e.style_color,")"):"black",n=null===e.style_stroke_color?null:e.style_stroke_color?"rgba(".concat(e.style_stroke_color,")"):"black",r=null===e.style_stroke_width?null:"undefined"===typeof e.style_stroke_width?1:Number(e.style_stroke_width),i=e.style_text_font?e.style_text_font:"12px Calibri,sans-serif",a=e.style_text_fill_color?"rgba(".concat(e.style_text_fill_color,")"):"#000",o=null===e.style_text_stroke_color?null:e.style_text_stroke_color?"rgba(".concat(e.style_text_stroke_color,")"):"#fff",c=null===e.style_text_stroke_width?null:"undefined"===typeof e.style_text_stroke_width?2:Number(e.style_text_stroke_width),s=e.style_text_value,l={image:new de.a({radius:8,snapToPixel:!1,fill:new pe.a({color:t}),stroke:new fe.a({color:n,width:r})})};return t&&(l.fill=new pe.a({color:t})),(n||r)&&(l.stroke=new fe.a({color:n,width:r})),s&&(l.text=new je.a({font:i,fill:new pe.a({color:a}),stroke:new fe.a({color:o,width:c}),text:s})),new ue.c(l)}(e),j=new wt.a(Object(Y.a)(Object(Y.a)({},e),{},{visible:e.active,source:p,style:e.style_text_value?function(t,n){var r=e.style_text_value||"";if(e.style_text_value&&null!==t&&void 0!==t&&t.get){var i=r&&r.match?r.match(/[^{}]+(?=})/g):null;i&&i.forEach((function(e){r=r.replace("{".concat(e,"}"),t.get(e)||"")}))}return f.getText().setText(r),f}:f}));if(j&&e.min_resolution&&j.setMinResolution(e.min_resolution),j&&e.max_resolution&&j.setMaxResolution(e.max_resolution),j&&e.min_scale){var h=pn(e.min_scale,c.getView().getProjection().getUnits());j.setMinResolution(h)}if(j&&e.max_scale){var b=pn(e.max_scale,c.getView().getProjection().getUnits());j.setMaxResolution(b)}return j}return Object(H.useEffect)((function(){if(c)return s.current=d(t),n.getLayers().push(s.current),function(){n.getLayers().remove(s.current)}}),[c]),Object(H.useEffect)((function(){s.current.setVisible(r.includes(t.id))}),[r]),Object(H.useEffect)((function(){s.current.setProperties(t),s.current.set("selectable",t.selectable),s.current.setOpacity(t.opacity),s.current.changed()}),[t]),null},Xl=function(e){var t=e.config,n=e.group,r=e.checked,i=e.viewer,a=Object(H.useContext)(Ml),o=a.core,c=a.mainMap,s=Object(H.useRef)(),l=o.store.getState().root.auth;return Object(H.useEffect)((function(){if(c)return s.current=function(e){var t=e.url,n=!1;i&&i.config_json&&i.config_json.proxy_http_image_requests&&(n=!0),e&&null!=e.proxy_http_image_requests&&(n=e.proxy_http_image_requests);var r=Object(kt.b)(e.wmts_capabilities,{layer:e.layer,matrixSet:e.wmts_tilematrixset||"EPSG:900913",format:"image/png"});if(Pe(t)&&i.integrated_authentication&&l&&l.data&&l.data.auth_token){var a=(null===i||void 0===i?void 0:i.integrated_authentication_key)||"authkey";if(r.urls&&r.urls.length){var c=r.urls.map((function(e){var t=_e(e,a);return xe(t,a,l.data.auth_token)}));r.urls=c}}return n&&("https:"!==window.location.protocol||Se(t)||-1!=navigator.userAgent.indexOf("Firefox")?n=!1:"http:"===new URL(t).protocol?r.tileLoadFunction=function(e,t){e.getImage().src=o.MAP_PROXY_URL+encodeURIComponent(t)}:n=!1),e.attributions&&(r.attributions=e.attributions),new xt.a(Object(Y.a)(Object(Y.a)({},e),{},{visible:e.active,source:new kt.a(r)}))}(t),n.getLayers().push(s.current),function(){n.getLayers().remove(s.current)}}),[c]),Object(H.useEffect)((function(){s.current.setVisible(r.includes(t.id))}),[r]),Object(H.useEffect)((function(){var e=Object(kt.b)(t.wmts_capabilities,{layer:t.layer,matrixSet:t.wmts_tilematrixset||"EPSG:900913",format:"image/png"});t.wmts_style&&(e.style=t.wmts_style),t.wmts_format&&-1!==t.wmts_format.toLowerCase().indexOf("image/")&&(e.format=t.wmts_format),s.current.setSource(new kt.a(e)),s.current.set("selectable",t.selectable),s.current.set("wmts_format",t.wmts_format),s.current.set("wmts_style",t.wmts_style),s.current.set("get_feature_info_format",t.get_feature_info_format),s.current.setOpacity(t.opacity)}),[t]),null},Jl=n(453),Zl=n(817),$l=n(818),Ql=n(111),eu=function(e){var t=e.config,n=e.group,r=e.checked,i=Object(H.useContext)(Ml),a=i.core,o=i.mainMap,c=Object(H.useRef)(),s=a.MAP_PROXY_URL;return Object(H.useEffect)((function(){if(o)return c.current=function(e){function t(t,n){return!e.style||!e.style.label||n>e.style.label_resolution?"":e.style&&e.style.label&&t?new je.a({font:e.style.label_font?e.style.label_font:"12px sans-serif",text:t.get(e.style.label_field).toString(),fill:new pe.a({color:e.style.label_fill_color?e.style.label_fill_color:"rgba(0,0,0,1)"}),stroke:new fe.a({color:e.style.label_stroke_color?e.style.label_stroke_color:"rgba(200,200,200,1)",width:3}),offsetX:0,offsetY:-10}):""}var n=e.url;return 1==e.ignoreProxy||Se(n)||(n=s+n),new Jl.a(Object(Y.a)(Object(Y.a)({},e),{},{visible:e.active,style:function(n,r){return!e.style||r>e.style.resolution?"":new ue.c({image:e.style&&e.style.point_shape&&e.style.point_shape.length>2?new de.a({fill:new pe.a({color:e.style.point_color}),stroke:new fe.a({color:e.style.point_stroke_color,width:e.style.point_stroke_width}),radius:e.style.point_radius}):null,fill:new pe.a({color:e.style.fill_color}),stroke:new fe.a({color:e.style.stroke_color,width:e.style.stroke_width}),text:t(n,r)})},source:new Zl.a({tilePixelRatio:1,tileGrid:Object(Ql.a)({maxZoom:19}),format:new $l.a,url:n,attributions:e.attributions||[]})}))}(t),n.getLayers().push(c.current),function(){n.getLayers().remove(c.current)}}),[o]),Object(H.useEffect)((function(){c.current.setVisible(r.includes(t.id))}),[r]),Object(H.useEffect)((function(){c.current.setOpacity(t.opacity)}),[t]),null},tu=function(e){var t=e.config,n=(e.source,e.style,e.group),r=e.checked,i=e.viewer,a=Object(H.useContext)(Ml).mainMap,o=Object(H.useRef)();Object(H.useEffect)((function(){if(a)return o.current=new wt.a(Object(Y.a)(Object(Y.a)({},t),{},{source:new It.a({features:new lt.a,attributions:t.attributions||[]})})),n.getLayers().push(o.current),function(){n.getLayers().remove(o.current)}}),[a]);var c=i.config_json.drawings;return Object(H.useEffect)((function(){var e=null;if(o.current&&"userlayer"===o.current.get("id")&&(e=o.current),e){var t=a.getView().getProjection().getCode();e.getSource().forEachFeature((function(t){t.get("state")&&(0===c.filter((function(e){return e.id===t.getId()})).length&&e.getSource().removeFeature(t))})),c.forEach((function(n){if(!e.getSource().getFeatureById(n.id)){var r=Ve(n,t);e.getSource().addFeature(r)}}))}return function(){}}),[c]),Object(H.useEffect)((function(){o.current.setVisible(r.includes(t.id))}),[r]),null},nu=function(e){var t=e.config,n=e.group,r=e.checked,i=Object(H.useContext)(Ml),a=i.core,o=i.mainMap,c=Object(H.useRef)(),s=a.MAP_PROXY_URL;function l(e){var n=t.style_color?"rgba(".concat(t.style_color,")"):"black",r=t.style_stroke_color?"rgba(".concat(t.style_stroke_color,")"):"black",i="undefined"===typeof t.style_stroke_width?1:Number(t.style_stroke_width),a="undefined"===typeof t.style_image_radius?3:Number(t.style_image_radius);if(e.ollayer){var o=e.ollayer.getProperties();n="rgba(".concat(o.style_color,")"),r="rgba(".concat(o.style_stroke_color,")"),i="undefined"===typeof o.style_stroke_width?1:Number(o.style_stroke_width),a="undefined"===typeof o.style_image_radius?3:Number(o.style_image_radius)}return new ue.c({image:new de.a({radius:a,snapToPixel:!1,fill:new pe.a({color:n}),stroke:new fe.a({color:r,width:i})}),fill:new pe.a({color:n}),stroke:new fe.a({color:r,width:i})})}return Object(H.useEffect)((function(){if(o)return c.current=function(e){var t={dataProjection:"EPSG:"+e.crs,featureProjection:o.getView().getProjection().getCode()},n=new le.a(t),r=new It.a({format:n,attributions:e.attributions||[],loader:function(t){var r=e.url;Se(r)||(r=s+encodeURIComponent(r)),fetch(r).then((function(e){return e.text()})).then((function(e){var t=[];(t=n.readFeatures(e)).forEach((function(e){return e.ollayer=c.current})),c.current.getSource().addFeatures(t)})).catch((function(e){console.log(e),c.current.getSource().removeLoadedExtent(t)}))}});return new wt.a(Object(Y.a)(Object(Y.a)({},e),{},{visible:e.active,source:r,style:l}))}(t),n.getLayers().push(c.current),function(){n.getLayers().remove(c.current)}}),[o]),Object(H.useEffect)((function(){c.current.setVisible(r.includes(t.id))}),[r]),Object(H.useEffect)((function(){c.current.setProperties(t),c.current.set("selectable",t.selectable),c.current.setOpacity(t.opacity),c.current.changed()}),[t]),null},ru=function(e){var t=e.config,n=e.group,r=e.checked,i=Object(H.useContext)(Ml),a=i.core,o=i.mainMap,c=Object(H.useRef)(),s=a.MAP_PROXY_URL;function l(e){var n=t.style_color?"rgba(".concat(t.style_color,")"):"black",r=t.style_stroke_color?"rgba(".concat(t.style_stroke_color,")"):"black",i="undefined"===typeof t.style_stroke_width?1:Number(t.style_stroke_width);if(e.ollayer){var a=e.ollayer.getProperties();n="rgba(".concat(a.style_color,")"),r="rgba(".concat(a.style_stroke_color,")"),i="undefined"===typeof a.style_stroke_width?1:Number(a.style_stroke_width)}return new ue.c({image:new de.a({radius:8,snapToPixel:!1,fill:new pe.a({color:n}),stroke:new fe.a({color:r,width:i})}),fill:new pe.a({color:n}),stroke:new fe.a({color:r,width:i})})}return Object(H.useEffect)((function(){if(o)return c.current=function(e){new Dt.a;var t=e.url;Se(t)||(t=s+encodeURIComponent(t));var n=new It.a({url:t,format:new Dt.a({extractStyles:!1}),attributions:e.attributions||[]});return new wt.a(Object(Y.a)(Object(Y.a)({},e),{},{visible:e.active,source:n,style:l}))}(t),n.getLayers().push(c.current),function(){n.getLayers().remove(c.current)}}),[o]),Object(H.useEffect)((function(){c.current.setVisible(r.includes(t.id))}),[r]),Object(H.useEffect)((function(){c.current.setProperties(t),c.current.set("selectable",t.selectable),c.current.setOpacity(t.opacity),c.current.changed()}),[t]),null},iu=function(e){var t=e.config,n=e.group,r=e.checked,i=e.viewer,a=Object(H.useContext)(Ml),o=a.core,c=a.mainMap,s=Object(H.useRef)(),l=o.MAP_PROXY_URL;return Object(H.useEffect)((function(){if(c)return s.current=function(e){var t=e.url,n=!1;i&&i.config_json&&i.config_json.proxy_http_image_requests&&(n=!0),e&&null!=e.proxy_http_image_requests&&(n=e.proxy_http_image_requests);var r={url:t,params:{LAYERS:e.layers}};n&&("https:"!==window.location.protocol||Se(t)||-1!=navigator.userAgent.indexOf("Firefox")?n=!1:"http:"===new URL(t).protocol?e.tiled?r.tileLoadFunction=function(e,t){e.getImage().src=l+encodeURIComponent(t)}:r.imageLoadFunction=function(e,t){e.getImage().src=l+encodeURIComponent(t)}:n=!1);var a,o=c.getView().getProjection().getCode();if(e.crs_options&&-1===e.crs_options.indexOf(o)&&(r.projection="EPSG:4326"),e.attributions&&(r.attributions=e.attributions),(a=e.tiled?new xt.a({id:e.id,title:e.title,type:e.type,visible:e.active,opacity:e.opacity?e.opacity:1,source:new Rt.a(r)}):new yt.a({id:e.id,title:e.title,type:e.type,visible:e.active,opacity:e.opacity?e.opacity:1,source:new Nt.a(r)}))&&e.datasource&&a.set("datasource",e.datasource),a&&e.get_feature_info_layers&&a.set("get_feature_info_layers",e.get_feature_info_layers),a&&e.get_feature_info_tolerance&&a.set("get_feature_info_tolerance",e.get_feature_info_tolerance),a&&e.min_resolution&&a.setMinResolution(e.min_resolution),a&&e.max_resolution&&a.setMaxResolution(e.max_resolution),a&&e.min_scale){var s=pn(e.min_scale,c.getView().getProjection().getUnits());a.setMinResolution(s)}if(a&&e.max_scale){var u=pn(e.max_scale,c.getView().getProjection().getUnits());a.setMaxResolution(u)}return a&&null!=e.layerId&&a.set("layerId",Array.isArray(e.layerId)?e.layerId:[e.layerId]),a&&e.layerName&&a.set("layerName",Array.isArray(e.layerName)?e.layerName:[e.layerName]),a}(t),n.getLayers().push(s.current),function(){n.getLayers().remove(s.current)}}),[c]),Object(H.useEffect)((function(){s.current.setVisible(r.includes(t.id))}),[r]),Object(H.useEffect)((function(){var e={LAYERS:t.layers};s.current.getSource().updateParams(e),s.current.set("selectable",t.selectable),s.current.set("get_feature_info_layers",t.get_feature_info_layers),s.current.set("get_feature_info_tolerance",t.get_feature_info_tolerance),s.current.setOpacity(t.opacity)}),[t]),null},au=function(e){var t=e.layers,n=e.config,r=e.group,i=e.checked,a=e.viewer,o=Object(H.useContext)(Ml).mainMap,c=Object(H.useState)(!1),s=Object(X.a)(c,2),l=s[0],u=s[1],d=Object(H.useRef)();if(Object(H.useEffect)((function(){if(o)return u(!1),d.current=new se.b({id:n.id,title:n.title,type:n.type,visible:n.active}),r?r.getLayers().push(d.current):o.addLayer(d.current),u(!0),function(){d.current&&(r?r.getLayers().remove(d.current):o.removeLayer(d.current))}}),[o]),Object(H.useEffect)((function(){d.current.setVisible(i.includes(n.id))}),[i]),!n.children)return null;if(!l)return null;var p=n.children.map((function(e){return t.find((function(t){return t.id===e}))})).filter((function(e){return!!e}));return p.reverse(),p.map((function(e,n){return Object(J.jsx)(ou,{config:e,layers:t,group:d.current,checked:i,viewer:a},e.id+n)}))};var ou=function(e){var t,n,r=e.layers,i=e.config,a=e.group,o=e.checked,c=e.viewer;if(!i)return null;switch(i.type){case"VTILE":n=eu;break;case"VECTOR":n=tu;break;case"GeoJSON":n=nu;break;case"KML":n=ru;break;case"WMS":n=Bl;break;case"WFS":n=ql;break;case"WMTS":n=Xl;break;case"OSM":t=new St.a,n=zl;break;case"XYZ":t=new Et.a({url:i.url}),n=zl;break;case"WMTSXYZ":t=new Et.a({tileUrlFunction:function(e){var t=i.url;t=_e(t,"service"),t=xe(t,"service","WMTS"),t=_e(t,"request"),t=xe(t,"request","GetTile"),i.wmts_version&&(t=_e(t,"version"),t=xe(t,"version",i.wmts_version));var n=("0"+e[0]).slice(-2);return"integer"===i.zformat&&(n=e[0]),t=(t=(t=t.replace("{z}",n)).replace("{x}",e[1])).replace("{y}",e[2]),i.layer&&(t=_e(t,"layer"),t=xe(t,"layer",i.layer)),i.wmts_layer&&(t=_e(t,"layer"),t=xe(t,"layer",i.wmts_layer)),i.wmts_tilematrixset&&(t=_e(t,"tilematrixset"),t=(t=xe(t,"tilematrixset",i.wmts_tilematrixset)).replace("{tilematrixset}",i.wmts_tilematrixset)),i.wmts_style&&(t=_e(t,"style"),t=xe(t,"style",i.wmts_style)),i.get_tile_format&&(t=_e(t,"format"),t=xe(t,"format",i.get_tile_format)),i.wmts_format&&(t=_e(t,"format"),t=xe(t,"format",i.wmts_format)),t}}),n=zl;break;case"BING":n=zl;break;case"TileJSON":t=new Pt.a({url:i.url}),n=zl;break;case"ArcGISMap":n=iu;break;case"GROUP":n=au;break;default:return null}return Object(J.jsx)(n,{config:i,layers:r,group:a,source:t,checked:o,viewer:c},i.id)};function cu(e){var t=e.core,n=e.viewer,i=e.dispatch,a=e.mainMap;return Object(J.jsx)(z.a.Fragment,{children:t.renderComponents({region:"footer_left",props:{viewer:n,dispatch:i,mainMap:a,Models:{MapModel:bn,OWSModel:Dl,Utils:r}},as:"popup"})})}var su=Object(q.b)((function(e){var t=ge(e);return{viewer:t.viewer,components:t.components,auth:t.auth}}))((function(e){var t=Object(H.useContext)(Ml),n=t.core,r=t.mainMap,i=Object(q.c)(),a=e.viewer;return Object(J.jsx)(cu,{core:n,mainMap:r,dispatch:i,viewer:a})}));function lu(e){var t=e.core,n=e.viewer,i=e.dispatch,a=e.mainMap;return Object(J.jsx)(z.a.Fragment,{children:t.renderComponents({region:"footer_right",props:{viewer:n,dispatch:i,mainMap:a,Models:{MapModel:bn,OWSModel:Dl,Utils:r}},as:"popup"})})}var uu=Object(q.b)((function(e){var t=ge(e);return{viewer:t.viewer,components:t.components,auth:t.auth}}))((function(e){var t=Object(H.useContext)(Ml),n=t.core,r=t.mainMap,i=Object(q.c)(),a=e.viewer;return Object(J.jsx)(lu,{core:n,mainMap:r,dispatch:i,viewer:a})}));function du(e){var t=e.core,n=e.viewer,i=e.dispatch,a=e.mainMap;return Object(J.jsx)(z.a.Fragment,{children:t.renderComponents({region:"topbar_right",props:{viewer:n,dispatch:i,mainMap:a,Models:{MapModel:bn,OWSModel:Dl,Utils:r}}})})}var pu=Object(q.b)((function(e){var t=ge(e);return{viewer:t.viewer,components:t.components,auth:t.auth}}))((function(e){var t=Object(H.useContext)(Ml),n=t.core,r=t.mainMap,i=Object(q.c)(),a=e.viewer;return Object(J.jsx)(du,{core:n,mainMap:r,dispatch:i,viewer:a})}));function fu(e){var t=e.core,n=e.viewer,r=e.dispatch,i=e.mainMap;return Object(J.jsx)(z.a.Fragment,{children:t.renderComponents({region:"map_controls_top_left",props:{viewer:n,dispatch:r,mainMap:i},className:"map-region-top-left"})})}var ju=Object(q.b)((function(e){var t=ge(e);return{viewer:t.viewer,components:t.components,auth:t.auth}}))((function(e){var t=Object(H.useContext)(Ml),n=t.core,r=t.mainMap,i=Object(q.c)(),a=e.viewer;return Object(J.jsx)(fu,{core:n,mainMap:r,dispatch:i,viewer:a})}));function hu(e){var t=e.core,n=e.viewer,r=e.dispatch,i=e.mainMap;return Object(J.jsx)(z.a.Fragment,{children:t.renderComponents({region:"map_controls_top_right",props:{viewer:n,dispatch:r,mainMap:i},className:"map-region-top-right"})})}var bu=Object(q.b)((function(e){var t=ge(e);return{viewer:t.viewer,components:t.components,auth:t.auth}}))((function(e){var t=Object(H.useContext)(Ml),n=t.core,r=t.mainMap,i=Object(q.c)(),a=e.viewer;return Object(J.jsx)(hu,{core:n,mainMap:r,dispatch:i,viewer:a})}));function mu(e){var t=e.core,n=e.viewer,r=e.dispatch,i=e.mainMap;return Object(J.jsxs)(z.a.Fragment,{children:[t.renderComponents({region:"map_controls_left",props:{viewer:n,dispatch:r,mainMap:i,actions:t.actions},className:"map-region-left-component"}),t.renderComponentsLinks({region:"map_controls_left",props:{viewer:n,dispatch:r,mainMap:i,actions:t.actions},className:"map-region-left-component-link"})]})}var gu=Object(q.b)((function(e){var t=ge(e);return{viewer:t.viewer,components:t.components,auth:t.auth}}))((function(e){var t=Object(H.useContext)(Ml),n=t.core,r=t.mainMap,i=Object(q.c)(),a=e.viewer;return Object(J.jsx)("div",{className:"map-region-left",children:Object(J.jsx)(mu,{core:n,mainMap:r,dispatch:i,viewer:a})})}));function vu(e){var t=e.core,n=e.viewer,r=e.dispatch,i=e.mainMap;return Object(J.jsx)(z.a.Fragment,{children:t.renderComponents({region:"map_controls_bottom_left",props:{viewer:n,dispatch:r,mainMap:i},className:"map-region-bottom-left"})})}var Ou=Object(q.b)((function(e){var t=ge(e);return{viewer:t.viewer,components:t.components,auth:t.auth}}))((function(e){var t=Object(H.useContext)(Ml),n=t.core,r=t.mainMap,i=Object(q.c)(),a=e.viewer;return Object(J.jsx)(vu,{core:n,mainMap:r,dispatch:i,viewer:a})}));function _u(e){var t=e.core,n=e.viewer,r=e.dispatch,i=e.mainMap;return Object(J.jsx)(z.a.Fragment,{children:t.renderComponents({region:"map_controls_bottom_right",props:{viewer:n,dispatch:r,mainMap:i},className:"map-region-bottom-right"})})}var xu=Object(q.b)((function(e){var t=ge(e);return{viewer:t.viewer,components:t.components,auth:t.auth}}))((function(e){var t=Object(H.useContext)(Ml),n=t.core,r=t.mainMap,i=Object(q.c)(),a=e.viewer;return Object(J.jsx)(_u,{core:n,mainMap:r,dispatch:i,viewer:a})})),yu=n(814),wu=n(813),Eu=new ue.c({image:new de.a({radius:4,fill:new pe.a({color:"#FF0000"}),stroke:new fe.a({color:"#fff",width:2})}),stroke:new fe.a({color:"#ff0000",width:3})});var Su=function(){function e(t){Object(ee.a)(this,e),this.core=t}return Object(te.a)(e,[{key:"getWFSFeaturesFilterByGeom",value:function(e,t,n,r,i,a){var o=["SERVICE=wfs","REQUEST=GetFeature","VERSION=1.1.0","typeNames="+t,"srsName="+n,"outputFormat=application/json","COUNT="+(r||50)];i&&o.push("bbox="+i.join(",")),a&&o.push("cql_filter="+a);var c=e+o.join("&");Se(c)||(c=this.core.MAP_PROXY_URL+encodeURIComponent(c));return fetch(c,{body:null,method:"GET"})}},{key:"getFeatureInfoGeoJSON",value:function(e,t,n,r,i,a,o,c){var s=a.call(this,e,t,n,r,i,"application/geojson");fetch(s).then((function(e){return e.json()})).then((function(e){var t=new le.a;e.crs&&e.crs.properties&&e.crs.properties.name&&(-1!=e.crs.properties.name.indexOf("EPSG::4326")||e.crs.properties.name.indexOf("CRS::84"));var n={dataProjection:i,featureProjection:i},r=t.readFeatures(e,n);r.length?o(r):c()})).catch((function(e){console.log("getFeatureInfoGeoJSON error",e),c()}))}},{key:"getFeatureInfoJSON",value:function(e,t,n,r,i,a,o,c){var s=a.call(this,e,t,n,r,i,"application/json");fetch(s).then((function(e){return e.json()})).then((function(e){var t=new le.a,n=i;e.crs&&e.crs.properties&&e.crs.properties.name&&(-1!==e.crs.properties.name.indexOf("EPSG::4326")||-1!==e.crs.properties.name.indexOf("CRS::84"))&&(n="EPSG:4326");var r={dataProjection:n,featureProjection:i},a=t.readFeatures(e,r);a.length?o(a):c()})).catch((function(e){c()}))}},{key:"getFeatureInfoXML",value:function(e,t,n,r,i,a,o,c){var s=a.call(this,e,t,n,r,i,"text/xml");fetch(s).then((function(e){return e.text()})).then((function(e){var t=[],n=new Lt.a,r={dataProjection:i,featureProjection:i},a=n.readFeatures(e,r);if(a&&a.length)return o(a[0]);Yt.a.parseString(e,(function(e,n){if(e)return c();n.FeatureInfoResponse&&n.FeatureInfoResponse.FIELDS.forEach((function(e){t.push(e.$)})),t.length?o(t):c()}))})).catch((function(e){c()}))}},{key:"getFeatureInfoGML",value:function(e,t,n,r,i,a,o,c,s){var l=t.getProperties(),u=o.call(this,e,t,n,r,i,a||"application/vnd.ogc.gml");fetch(u).then((function(e){return e.text()})).then((function(e){var t=e.replace("the_geom","geometry");t=(t=(t=t.replace("the_geom","geometry")).replace("st_union","geometry")).replace("st_union","geometry");var n=[],r=new Lt.a,a={dataProjection:i,featureProjection:i};try{n=r.readFeatures(t,a)}catch(o){}if(!n.length){r=new Ft.a,a={dataProjection:i,featureProjection:i};try{n=r.readFeatures(t,a)}catch(o){}}if(!n.length){r=new Ut.a,a={dataProjection:i,featureProjection:i,featureType:l.layers};try{n=r.readFeatures(t,a)}catch(o){}}if(!n.length){a={dataProjection:i,featureProjection:i};try{n=(new wu.a).readFeatures(t,a)}catch(o){}}n.length?c(n):s()})).catch((function(e){s()}))}},{key:"getFeatureInfoHtml",value:function(e,t,n,r,i,a,o,c){var s=a.call(this,e,t,n,r,i,"text/html");fetch(s).then((function(e){return e.text()})).then((function(e){o(e)})).catch((function(e){c()}))}},{key:"getFeatureInfoText",value:function(e,t,n,r,i,a,o,c){var s=a.call(this,e,t,n,r,i,"text/plain");fetch(s).then((function(e){return e.text()})).then((function(e){o(e)})).catch((function(e){c()}))}},{key:"getFeatureInfoEsriJSON",value:function(e,t,n,r,i,a,o,c){var s=a.call(this,e,t,n,r,i,"application/json");fetch(s).then((function(e){return e.json()})).then((function(e){var n=new yu.a,r={dataProjection:"EPSG:4326",featureProjection:i},a=e.results||[];(t.get("layerId")||t.get("layerName"))&&(a=a.filter((function(e){return!!(t.get("layerId")||[]).includes(e.layerId)||(t.get("layerName")||[]).includes(e.layerName)})));var s=a.map((function(e){return n.readFeatures(e,r)[0]}));s.length?o(s):c()})).catch((function(e){c()}))}},{key:"parseFeatureInfo",value:function(){var e=Object(_t.a)(Object(Ot.a)().mark((function e(t,n,r,i,a,o){var c,s,l,u=this;return Object(Ot.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=function(e){return new Promise((function(o,c){var s=u.buildFeatureInfoWMSUrl;n.getSource()instanceof kt.a&&(s=u.buildFeatureInfoWMTSUrl),"WMTSXYZ"===n.get("type")&&(s=u.buildFeatureInfoWMTSXYZUrl),/gml/gi.test(e)?u.getFeatureInfoGML(t,n,r,i,a,e,s,o,c):/xml/gi.test(e)?u.getFeatureInfoXML(t,n,r,i,a,s,o,c):/geojson/gi.test(e)?u.getFeatureInfoGeoJSON(t,n,r,i,a,s,o,c):/json/gi.test(e)?u.getFeatureInfoJSON(t,n,r,i,a,s,o,c):/html/gi.test(e)?u.getFeatureInfoHtml(t,n,r,i,a,s,o,c):/plain/gi.test(e)?u.getFeatureInfoText(t,n,r,i,a,s,o,c):c()}))},s=n.getProperties(),l=s.get_feature_info_format||"application/json",c(l).then((function(e){o(e)})).catch((function(e){o(!1)}));case 4:case"end":return e.stop()}}),e)})));return function(t,n,r,i,a,o){return e.apply(this,arguments)}}()},{key:"parseArcGISFeatureInfo",value:function(){var e=Object(_t.a)(Object(Ot.a)().mark((function e(t,n,r,i,a,o){var c,s,l,u=this;return Object(Ot.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=function(e){return new Promise((function(o,c){var s=u.buildFeatureInfoArcGISUrl;/json/gi.test(e)?u.getFeatureInfoEsriJSON(t,n,r,i,a,s,o,c):c()}))},s=n.getProperties(),l=s.get_feature_info_format||"application/json",c(l).then((function(e){o(e)})).catch((function(e){o(!1)}));case 4:case"end":return e.stop()}}),e)})));return function(t,n,r,i,a,o){return e.apply(this,arguments)}}()},{key:"findActiveWMSLayer",value:function(e){var t=this,n=[];return e.forEach((function(e){(e.getVisible()&&e.getSource&&(e.getSource()instanceof Ct.a||e.getSource()instanceof Tt.a||e.getSource()instanceof kt.a)&&n.push(e),e.getVisible()&&"WMTSXYZ"===e.get("type")&&n.push(e),e instanceof se.b&&e.getVisible())&&t.findActiveWMSLayer(e.getLayers()).forEach((function(e){return n.push(e)}))})),n}},{key:"buildFeatureInfoWMSUrl",value:function(e,t,n,r,i,a){var o=t.getSource().getFeatureInfoUrl(r,n,i,{INFO_FORMAT:a,FEATURE_COUNT:10});return Se(o)||(o=this.core.MAP_PROXY_URL+encodeURIComponent(o)),o}},{key:"buildFeatureInfoWMTSUrl",value:function(e,t,n,r,i,a){for(var o,c,s=t.getSource(),l=s.getTileGrid(),u=l.getResolutions(),d=1/0,p=0;p<u.length;p++){var f=u[p],j=Math.abs(n-f);if(j<d&&(d=j,o=p,c=f),f<n)break}var h=l.getTileSize(o),b=Array.isArray(h)?h[0]:h,m=Array.isArray(h)?h[1]:h,g=l.getOrigin(o),v=(r[0]-g[0])/(c*b),O=(g[1]-r[1])/(c*m),_=Math.floor(v),x=Math.floor(O),y=Math.floor((v-_)*b),w=Math.floor((O-x)*m),E=l.getMatrixIds()[o],S=s.getMatrixSet(),P=t.get("get_feature_info_url");return P.indexOf("?")<0&&(P+="?"),P=P+"SERVICE=WMTS&REQUEST=GetFeatureInfo&TILEMATRIXSET="+S+"&TILEMATRIX="+E+"&LAYER="+t.get("layer")+"&STYLE="+(t.get("wmts_style")||"")+"&INFOFORMAT="+a+"&TileCol="+_+"&TileRow="+x+"&I="+y+"&J="+w,Se(P)||(P=this.core.MAP_PROXY_URL+encodeURIComponent(P)),P}},{key:"buildFeatureInfoWMTSXYZUrl",value:function(e,t,n,r,i,a){for(var o,c,s=t.getSource().getTileGrid(),l=s.getResolutions(),u=1/0,d=0;d<l.length;d++){var p=l[d],f=Math.abs(n-p);if(f<u&&(u=f,o=d,c=p),p<n)break}var j=s.getTileSize(o),h=Array.isArray(j)?j[0]:j,b=Array.isArray(j)?j[1]:j,m=s.getOrigin(o),g=(r[0]-m[0])/(c*h),v=(m[1]-r[1])/(c*b),O=Math.floor(g),_=Math.floor(v),x=Math.floor((g-O)*h),y=Math.floor((v-_)*b),w=("0"+o).slice(-2);"integer"===t.get("zformat")&&(w=o);var E=t.get("wmts_tilematrixset")||"",S=E+":"+w,P=t.get("url");return t.get("get_feature_info_url")&&(P=t.get("get_feature_info_url")),P.indexOf("?")<0&&(P+="?"),P=P+"SERVICE=WMTS&REQUEST=GetFeatureInfo&TILEMATRIXSET="+E+"&TILEMATRIX="+S+"&LAYER="+(t.get("wmts_layer")||t.get("layer")||"")+"&STYLE="+(t.get("wmts_style")||"")+"&INFOFORMAT="+a+"&TileCol="+O+"&TileRow="+_+"&I="+x+"&J="+y,Se(P)||!1===t.get("get_feature_info_proxy_request")||(P=this.core.MAP_PROXY_URL+encodeURIComponent(P)),P}},{key:"buildFeatureInfoArcGISUrl",value:function(e,t,n,r,i,a){var o=e.getSize(),c=Object(Wt.v)(e.getView().calculateExtent(o),i,"EPSG:4326"),s=["geometry=".concat(Object(Wt.u)(r,i,"EPSG:4326").join(",")),"geometryType=".concat("esriGeometryPoint"),"layers=".concat(t.get("get_feature_info_layers")||"visible"),"sr=4326","tolerance=".concat(t.get("get_feature_info_tolerance")||1),"mapExtent=".concat(c.join(",")),"imageDisplay=".concat(o.join(","),",96"),"returnGeometry=true","f=json"],l=t.getSource().getUrls?t.getSource().getUrls()[0]:t.getSource().getUrl();return l="".concat(l,"/identify?").concat(s.join("&")),Se(l)||(l=this.core.MAP_PROXY_URL+encodeURIComponent(l)),l}},{key:"findActiveArcGISMapLayer",value:function(e){var t=this,n=[];return e.forEach((function(e){(e.getVisible()&&e.getSource&&(e.getSource()instanceof Rt.a||e.getSource()instanceof Nt.a)&&n.push(e),e instanceof se.b&&e.getVisible())&&t.findActiveArcGISMapLayer(e.getLayers()).forEach((function(e){return n.push(e)}))})),n}}]),e}(),Pu=new ue.c({image:new de.a({radius:4,fill:new pe.a({color:"#fff"}),stroke:new fe.a({color:"#FF0000",width:2})})}),Au=new ue.c({image:new de.a({radius:6,fill:new pe.a({color:"#FF0000"}),stroke:new fe.a({color:"#fff",width:2})})});var Cu=n(815),Tu=new ue.c({image:new de.a({radius:6,fill:new pe.a({color:"#3399CC"}),stroke:new fe.a({color:"#fff",width:2})})});var Ru=n(306);var Nu={FeatureInfo:function(e){var t=e.core,n=e.config,r=e.actions,i=n.viewer,a=n.mainMap,o=n.dispatch,c=i.featureinfo,s=i.config_json.map_controls.find((function(e){return"FeatureInfo"===e.id})),l=i.config_json.components.find((function(e){return e.config_json&&"FeatureInfo"===e.config_json.map_control})),u=(i.config_json.layers,Object(H.useState)(null)),d=Object(X.a)(u,2),p=d[0],f=d[1],j=Object(H.useRef)(),h=new Su(t);function b(e){f({coords:e.coordinate,pixel:e.pixel}),l&&o(r.viewer_set_selectedmenu(l.id))}return Object(H.useEffect)((function(){if(s)return s.active?a.on("singleclick",b):a.un("singleclick",b),function(){a.un("singleclick",b)}}),[s]),Object(H.useEffect)((function(){p&&function(e,t){var n=[],i=[],c=function(e,t){if("object"===typeof e){if(e instanceof or.a)return{id:Object(oe.a)(),type:"ol",data:dn([e]),layer:t?t.get("title"):"",feature_tpl:t.get("feature_tpl")?t.get("feature_tpl"):null};var n={};return Object.keys(e).filter((function(t){return"object"!==typeof e[t]})).forEach((function(t){return n[t]=e[t]})),{id:Object(oe.a)(),type:"object",data:n,layer:t?t.get("title"):""}}},s=[],l=[];a.forEachFeatureAtPixel(t,(function(e,t){if(t&&t!=j.current&&0!=t.get("selectable"))if(t instanceof Jl.a){var n=new or.a,r=e.getProperties();Object.keys(r).forEach((function(e){n.set(e,r[e])})),r.id&&n.setId(r.id),t.get("datasource")&&t.get("datasource").cql_fields&&t.get("datasource").cql_filter?!1===t.get("datasource").allow_multi?l.includes(t.get("id"))||(s.push({feature:n,layer:t}),l.push(t.get("id"))):s.push({feature:n,layer:t}):i.push({feature:n,layer:t})}else i.push({feature:e,layer:t})})),i.length&&i.forEach((function(e){n.push(c(e.feature,e.layer)),o(r.viewer_set_featureinfo(n))})),s.forEach((function(t){var i=t.layer.get("datasource").crs||"EPSG:4326",s=t.layer.get("datasource").cql_filter;t.layer.get("datasource").cql_fields.forEach((function(e,n){s=(s=s.replaceAll("{"+e+"}",t.feature.get(e))).replaceAll("{"+n+"}",t.feature.get(e))}));var l=Object(Wt.u)(e,a.getView().getProjection().getCode(),i);s=(s=s.replaceAll("{X}",l[0])).replaceAll("{Y}",l[1]),h.getWFSFeaturesFilterByGeom(t.layer.get("datasource").url,t.layer.get("datasource").typeNames,i,50,null,s).then((function(e){return e.json()})).then((function(e){var a=new le.a,s={dataProjection:i,featureProjection:d},l=a.readFeatures(e,s);l&&(l.forEach((function(e){n.push(c(e,t.layer))})),o(r.viewer_set_featureinfo(n)))})).catch((function(e){return console.log(e)}))}));var u=a.getView().getResolution(),d=a.getView().getProjection().getCode();if(h.findActiveWMSLayer(a.getLayers()).forEach((function(t){if(!1!==t.get("selectable"))if(t.get("datasource")){var i=t.get("datasource").crs||"EPSG:4326",s=[e[0]-2,e[1]-2,e[0]+2,e[1]+2],l=Object(Wt.v)(s,d,i);h.getWFSFeaturesFilterByGeom(t.get("datasource").url,t.get("datasource").typeNames,i,50,l).then((function(e){return e.json()})).then((function(e){var a=new le.a,s={dataProjection:i,featureProjection:d},l=a.readFeatures(e,s);l&&(l.forEach((function(e){n.push(c(e,t))})),o(r.viewer_set_featureinfo(n)))})).catch((function(e){return console.log(e)}))}else h.parseFeatureInfo(a,t,u,e,d,(function(e){var i=t.getProperties().get_feature_info_format||"application/json";e||n.push({id:Object(oe.a)(),type:"error",format:i}),"object"===typeof e?Array.isArray(e)?e.forEach((function(e){n.push(c(e,t))})):n.push(c(e,t)):n.push({id:Object(oe.a)(),type:"text",data:e,layer:t.get("title")||"teste"}),o(r.viewer_set_featureinfo(n))}))})),h.findActiveArcGISMapLayer(a.getLayers()).forEach((function(t){!1!==t.get("selectable")&&(t.get("datasource")||h.parseArcGISFeatureInfo(a,t,u,e,d,(function(e){var i=t.getProperties().get_feature_info_format||"application/json";e||n.push({id:Object(oe.a)(),type:"error",format:i}),"object"===typeof e?Array.isArray(e)?e.forEach((function(e){n.push(c(e,t))})):n.push(c(e,t)):n.push({id:Object(oe.a)(),type:"text",data:e,layer:t.get("title")||"teste"}),o(r.viewer_set_featureinfo(n))})))})),0===i.length&&0===s.length){var p=[{id:Object(oe.a)(),type:"text",data:"<p>N\xe3o foram encontrados resultados</p>"}];o(r.viewer_set_featureinfo(p))}}(p.coords,p.pixel)}),[p]),Object(H.useEffect)((function(){a&&(j.current=new wt.a({id:"featureinfo",renderMode:"vector",source:new It.a({}),style:Eu,selectable:!1}),a.addLayer(j.current))}),[a]),Object(H.useEffect)((function(){var e;if(j.current)return j.current.getSource().clear(),c.forEach((function(t){"ol"===t.type&&(e=(e=un(t.data))instanceof lt.a?e.getArray():e,j.current.getSource().addFeatures(e))})),function(){j.current.getSource().clear()}}),[c]),null},Coordinates:function(e){var t=e.core,n=e.config,r=e.actions,i=n.viewer,a=n.mainMap,o=n.dispatch,c=i.coordinates,s=Object(H.useState)(null),l=Object(X.a)(s,2),u=l[0],d=l[1],p=i.config_json.map_controls.find((function(e){return"Coordinates"===e.id})),f=(i.config_json.components.find((function(e){return e.config_json&&"Coordinates"===e.config_json.map_control})),Object(H.useRef)());function j(e){!function(e,n){var r=t.API_URL+"/app/utils/transcoord",o=hn(a.getView().getProjection()),c={headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify({x:e,y:n,srid:o})};fetch(r,c).then((function(e){return e.json()})).then((function(t){if(t.results){var r={};i.config_json.crs_list.forEach((function(e){var n=[];t.results[e.code]&&(n=[t.results[e.code].x,t.results[e.code].y],r[e.code]={code:e.code,title:e.title,description:e.description,srid:e.srid,precision:e.precision,coordinates:n})}));var o=[e,n],c={id:Object(oe.a)(),coordinates:o,crs:a.getView().getProjection().getCode(),results:r};d(c)}})).catch((function(e){console.log("error",e)}))}(e.coordinate[0],e.coordinate[1])}return Object(H.useEffect)((function(){}),[]),Object(H.useEffect)((function(){if(f.current){f.current.getSource().clear();var e=0;c.forEach((function(t){var n=new or.a;n.setGeometry(new cr.a(t.coordinates)),0==e&&n.setStyle(Au),f.current.getSource().addFeatures([n]),e+=1}))}}),[c]),Object(H.useEffect)((function(){u&&o(r.viewer_set_coordinates([u].concat(Object(ae.a)(c))))}),[u]),Object(H.useEffect)((function(){if(p)return p.active?a.on("singleclick",j):a.un("singleclick",j),p.active&&!i.config_json.checked.includes("coordinates")&&o(r.layers_set_checked([].concat(Object(ae.a)(i.config_json.checked),["coordinates"]))),function(){a.un("singleclick",j)}}),[p]),Object(H.useEffect)((function(){a&&(f.current=new wt.a({id:"coordinates",renderMode:"vector",source:new It.a({}),style:Pu,selectable:!1}),a.addLayer(f.current))}),[a]),null},GeoLocation:function(e){var t=e.config,n=e.actions,r=t.viewer,i=t.mainMap,a=t.dispatch,o=r.geolocation,c=r.config_json.map_controls.find((function(e){return"GeoLocation"===e.id})),s=(r.config_json.components.find((function(e){return e.config_json&&"GeoLocation"===e.config_json.map_control})),Object(H.useState)(!1)),l=Object(X.a)(s,2),u=l[0],d=l[1],p=Object(H.useState)(null),f=Object(X.a)(p,2),j=f[0],h=f[1],b=Object(H.useRef)();function m(e){var t=j?j.getPosition():null;if(t){var n={coordinates:t,accuracy:j.getAccuracy(),altitude:j.getAltitude(),altitudeAccuracy:j.getAltitudeAccuracy(),heading:j.getHeading(),speed:j.getSpeed()};g(n),e&&e(n)}else window.navigator.geolocation.getCurrentPosition((function(t){if(t.coords){var n={coordinates:[t.coords.longitude,t.coords.latitude],accuracy:t.coords.accuracy,altitude:t.coords.altitude,altitudeAccuracy:t.coords.altitudeAccuracy,heading:t.coords.heading,speed:t.coords.speed};g(n),e&&e(n)}else g({error:{code:0,message:"N\xe3o foi poss\xedvel obter localiza\xe7\xe3o."}})}),(function(e){g({error:{code:e.code||0,message:e.message}})}))}function g(e){a(n.viewer_set_geolocation(e))}function v(e){if(e&&e.coordinates){var t=Object(Wt.u)(e.coordinates,"EPSG:4326",i.getView().getProjection()),r=[t[0]-500,t[1]-500,t[0]+500,t[1]+500],o=hn(i.getView().getProjection());a(n.map_set_extent(t,r,o))}}return Object(H.useEffect)((function(){c&&j&&j.setTracking(c.tracking)}),[c.tracking]),Object(H.useEffect)((function(){if(c){if(!c.active)return j&&j.setTracking(!1),void a(n.viewer_set_geolocation(null));j&&j.setTracking(!!c.tracking),u&&(c.zoom?m((function(e){return v(e)})):m()),a(n.layers_set_checked([].concat(Object(ae.a)(r.config_json.checked),["geolocation"])))}}),[c.active]),Object(H.useEffect)((function(){if(b.current&&(b.current.getSource().clear(),c.active&&o&&o.coordinates)){var e=new or.a,t=Object(Wt.u)([o.coordinates[0],o.coordinates[1]],"EPSG:4326",i.getView().getProjection());e.setGeometry(new cr.a(t)),b.current.getSource().addFeatures([e])}}),[o]),Object(H.useEffect)((function(){if(i){b.current=new wt.a({id:"geolocation",renderMode:"vector",source:new It.a({}),style:Tu,selectable:!1}),i.addLayer(b.current),d(!0),c.active&&(c.zoom_init?m((function(e){return v(e)})):m());var e=new Cu.a({});e.on("change",(function(){g({coordinates:e.getPosition(),accuracy:e.getAccuracy(),altitude:e.getAltitude(),altitudeAccuracy:e.getAltitudeAccuracy(),heading:e.getHeading(),speed:e.getSpeed()})})),e.on("error",(function(e){g({error:{code:e.code,message:e.message,type:e.type}})})),h(e)}}),[i]),null},Attribution:function(e){var t=e.config,n=(e.actions,e.record),r=t.mainMap,i=(t.viewer,Object(H.useState)(!1)),a=Object(X.a)(i,2),o=a[0],c=a[1];return Object(H.useEffect)((function(){}),[]),Object(H.useEffect)((function(){if(r&&!o){c(!0);var e=Ee(),t=null!=n.collapsed&&n.collapsed;e&&(t=null!=n.collapsed_mobile?n.collapsed_mobile:t);var i=null==n.collapsible||n.collapsible;e&&(i=null!=n.collapsible_mobile?n.collapsible_mobile:i);var a={collapsed:t,collapsible:i},s=new Ru.a(a);r.addControl(s)}}),[r]),null}},ku=n(566),Iu=function(e){ku.a.initialize(e)},Mu=function(){ku.a.pageview(window.location.pathname+window.location.search)};var Lu=Object(q.b)((function(e){return{viewer:ge(e).viewer}}))(Object(nt.g)((function(e){var t=e.match.url,n=e.match.params.id,r=e.history,i=e.loading,a=e.viewer,o=e.config,c=a.exclusive_mapcontrol,s=a.config_json.layers,l=a.config_json.map_controls,u=Object(H.useRef)(null),d=Object(q.c)(),p=Object(H.useContext)(Ml),f=p.core,j=p.mainMap,h=f.actions,b=h.viewer_load,m=h.layout_wrapper_click,g=h.layout_toggle_menu,v=h.layout_show_menu,O=h.viewer_update_mapcontrol,_=Object({NODE_ENV:"production",PUBLIC_URL:"/static/viewer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"/api",REACT_APP_BASE_URL:"",REACT_APP_CLIENT_URL:"/static/viewer",REACT_APP_CONFIG_URL:"/static/viewer/config.json",REACT_APP_COOKIE_AUTH_NAME:"scalargis_webgis",REACT_APP_COOKIE_EXPIRES_DAYS:"150",REACT_APP_COOKIE_INFO_URL:"/static/viewer/rgpd.html",REACT_APP_COOKIE_MESSAGE:"This website uses cookies to improve your browsing experience. By pressing 'I Accept' you are agreeing to its use.",REACT_APP_COOKIE_NAME:"scalargis_rgpd",REACT_APP_COOKIE_PATH:"/",REACT_APP_COOKIE_VALUE:"2",REACT_APP_DEFAULT_THEME:"default",REACT_APP_DESCRIPTION:"ScalarGIS - Web GIS framework",REACT_APP_ENTITY_NAME:"ScalarGIS",REACT_APP_ENTITY_NAME_ABREV:"ScalarGIS",REACT_APP_ENTITY_URL:"https://www.scalargis.com",REACT_APP_MAP_PROXY:"/proxy?url=",REACT_APP_ROOT_PATH:"",REACT_APP_TITLE:"ScalarGIS",REACT_APP_UPLOAD_URL:"/spatial_toolbox/convert2geojson"}).REACT_APP_GA_TRACKING_ID;if(z.a.useEffect((function(){_&&(Iu(_),Mu()),t.indexOf("/session")<0?d(b(f,n,r)):d(b(f,n,r,!0))}),[n]),Object(H.useEffect)((function(){a.config_json&&a.config_json.map_controls.filter((function(e){return e.exclusive})).forEach((function(e){e.id===c?d(O(Object(Y.a)(Object(Y.a)({},e),{},{active:!0}))):d(O(Object(Y.a)(Object(Y.a)({},e),{},{active:!1})))}))}),[c]),i)return null;var x=["overlays","main","background","basemaps"];a.config_json&&a.config_json.root_layers&&a.config_json.root_layers.length>0&&(x=a.config_json.root_layers);var y=s.filter((function(e){return x.includes(e.id)})).reverse();return Object(J.jsx)(ot,{history:r,core:f,viewer:a,layout_wrapper_click:function(e){return d(m())},layout_toggle_menu:function(e){return d(g(e))},mainMenu:Object(J.jsx)(Wl,{history:r,onMenuClick:function(e){return d(v(e))}}),topbarRight:Object(J.jsx)(pu,{}),footerLeft:Object(J.jsx)(su,{}),footerRight:Object(J.jsx)(uu,{}),mainOlMap:j,children:Object(J.jsxs)(Ll,{olMap:j,config:o,viewer:a,mainMapEl:u,dispatch:d,core:f,children:[Object(J.jsx)(Hl,{children:y.map((function(e){return Object(J.jsx)(ou,{config:e,layers:s,checked:a.config_json.checked,viewer:a},e.id)}))}),Object(J.jsx)(ju,{}),Object(J.jsx)(bu,{}),Object(J.jsx)(gu,{}),Object(J.jsx)(Ou,{}),Object(J.jsx)(xu,{}),!!l&&l.map((function(e){var t=Nu[e.type];return Object(J.jsx)(t,{core:f,config:{viewer:a,mainMap:j,dispatch:d},actions:f.actions,record:e},e.id)}))]})})}))),Fu=n(196);var Uu=Object(nt.g)((function(e){var t=e.history;return Object(J.jsx)("div",{className:"p-d-flex p-jc-center",style:{height:"100%"},children:Object(J.jsxs)("div",{className:"p-as-center",style:{backgroundColor:"white",padding:"6rem"},children:[Object(J.jsx)("h1",{children:"Ops..."}),Object(J.jsx)("p",{children:"O visualizador pedido n\xe3o existe."}),Object(J.jsx)("p",{children:"Clique para voltar a p\xe1gina inicial"}),Object(J.jsx)("p",{children:Object(J.jsx)(bt.a,{label:"P\xe1gina Inicial",onClick:function(e){return t.push({pathname:"/"})}})})]})})}));var Gu=Object(nt.g)((function(e){var t=e.history;return Object(J.jsx)("div",{className:"p-d-flex p-jc-center",style:{height:"100%"},children:Object(J.jsxs)("div",{className:"p-as-center",style:{backgroundColor:"white",padding:"6rem"},children:[Object(J.jsx)("h1",{children:"Ops..."}),Object(J.jsx)("p",{children:"N\xe3o est\xe1 autorizado a aceder ao visualizador pedido."}),Object(J.jsx)("p",{children:"Clique para voltar a p\xe1gina inicial ou clique para efetuar login"}),Object(J.jsxs)("p",{children:[Object(J.jsx)(bt.a,{label:"P\xe1gina Inicial",onClick:function(e){return t.push({pathname:"/"})}})," ",Object(J.jsx)(bt.a,{label:"Entrar",onClick:function(e){return t.push({pathname:"/login"})}})]})]})})}));var Du=Object(nt.g)((function(e){var t=e.location.search,n=new URLSearchParams(t),r=n.get("redirect"),i=n.get("path"),a=n.get("url_redirect"),o=Object(H.useContext)(Ml).core.CLIENT_URL+"assets/images/logo.png";return Object(J.jsx)("div",{id:"login-page",className:"p-d-flex p-jc-center",style:{height:"100%"},children:Object(J.jsxs)("div",{className:"p-as-center",style:{backgroundColor:"white",padding:"6rem"},children:[Object(J.jsx)("div",{className:"login-logo",children:Object(J.jsx)("img",{alt:"Logo",src:o})}),Object(J.jsx)(wn,{history:e.history,redirect:r||null,path:i||null,urlRedirect:a||null})]})})})),Vu=new ft.a;var Wu=Object(q.b)((function(e){return{auth:e.root.auth,registration:e.root.registration}}))((function(e){var t=e.token,n=e.auth,r=e.registration,i=e.history,a=e.redirect,o=e.urlRedirect,c=Object(H.useState)(""),s=Object(X.a)(c,2),l=s[0],u=s[1],d=Object(H.useState)(!1),p=Object(X.a)(d,2),f=p[0],j=p[1],h=Object(q.c)(),b=Object(H.useContext)(Ml).core,m=b.actions,g=m.registration_confirmation,v=m.registration_send_confirmation,O=m.login,_=m.logout,x=Vu.get(b.COOKIE_AUTH_NAME);if(Object(H.useEffect)((function(){x||h(g({token:t},i,a))}),[]),x){var y=x.username;return Object(J.jsxs)("div",{children:[Object(J.jsxs)("p",{children:["Existe uma sess\xe3o ativa para o utilizador ",Object(J.jsx)("i",{children:Object(J.jsx)("strong",{children:y})}),"."]}),Object(J.jsxs)("p",{children:["Clique para",Object(J.jsx)(bt.a,{className:"p-button-link",label:"terminar sess\xe3o",onClick:function(e){return h(_())}}),"e concluir registo de novo utilizador."]})]})}return r.response&&r.response&&r.response.authenticated?Object(J.jsxs)("div",{className:"p-d-flex p-ai-center p-dir-col p-px-3",children:[Object(J.jsx)("h3",{children:"Registo de utilizador"}),Object(J.jsx)("i",{className:"pi pi-check-circle",style:{fontSize:"5rem",color:"var(--green-500)"}}),Object(J.jsx)("p",{style:{lineHeight:1.5},children:"Registo de utilizador confirmado com sucesso!"}),Object(J.jsx)(bt.a,{label:"Continuar",onClick:function(e){j(!0),h(O(r.response,i,a,o))},icon:f?"pi pi-spin pi-spinner":"pi pi-check",disabled:f})]}):Object(J.jsxs)(z.a.Fragment,{children:[n.http_error&&!n.response&&Object(J.jsx)(mt.a,{style:{width:"100%"},severity:"error",text:"Servi\xe7o Indispon\xedvel"}),n.http_error&&n.response&&!!n.response.message&&Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsxs)("div",{className:"p-fluid",style:{maxWidth:"500px"},children:[Object(J.jsx)("div",{className:"p-field p-grid",children:Object(J.jsx)("div",{className:"p-col-12",children:Object(J.jsx)("h3",{children:"Confirma\xe7\xe3o de registo de utilizador"})})}),Object(J.jsx)("div",{className:"p-field p-grid",children:Object(J.jsx)("div",{className:"p-col-12 ",children:Object(J.jsx)(mt.a,{style:{width:"100%"},severity:"error",text:n.response.message})})}),Object(J.jsx)("div",{className:"p-field p-grid",children:Object(J.jsx)("div",{className:"p-col-12",children:"Indique o email utilizado no registo do utilizador para que seja enviada nova confirma\xe7\xe3o de registo."})}),Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{className:"p-col-12 p-md-2",children:"Email"}),Object(J.jsx)("div",{className:"p-col-12 p-md-10",children:Object(J.jsx)(jt.a,{value:l,onChange:function(e){return u(e.target.value)}})})]})]}),Object(J.jsx)("div",{className:"p-dialog-myfooter",children:Object(J.jsx)(bt.a,{color:"green",icon:n.loading?"pi pi-spin pi-spinner":"pi pi-check",label:"Enviar",onClick:function(){h(v({email:l},i,a))},disabled:n.loading})})]}),!n.http_error&&n.response&&!!n.response.message&&Object(J.jsxs)("div",{className:"p-fluid",style:{maxWidth:"500px"},children:[Object(J.jsx)("div",{className:"p-field p-grid",children:Object(J.jsx)("div",{className:"p-col-12",children:Object(J.jsx)("h3",{children:"Confirma\xe7\xe3o de registo de utilizador"})})}),Object(J.jsx)(mt.a,{style:{width:"100%"},severity:"info",text:n.response.message})]})]})}));var Hu=Object(nt.g)((function(e){var t=e.location.search,n=Object(H.useContext)(Ml).core.CLIENT_URL,r=new URLSearchParams(t).get("token"),i=/redirect=(.*)/i.exec(t),a=/url_redirect=(.*)/i.exec(t),o=n+"assets/images/logo.png";return Object(J.jsx)("div",{id:"login-page",className:"p-d-flex p-jc-center",style:{height:"100%"},children:Object(J.jsxs)("div",{className:"p-as-center",style:{backgroundColor:"white",padding:"6rem"},children:[Object(J.jsx)("div",{className:"login-logo",children:Object(J.jsx)("img",{alt:"Logo",src:o})}),Object(J.jsx)(Wu,{token:r,history:e.history,redirect:i?i[1]:null,urlRedirect:a?a[1]:null})]})})})),zu=new ft.a;var Ku=Object(q.b)((function(e){return{auth:e.root.auth,pwd:e.root.password}}))((function(e){var t=e.token,n=e.auth,r=e.pwd,i=e.history,a=e.redirect,o=e.urlRedirect,c=Object(H.useState)("set"),s=Object(X.a)(c,2),l=s[0],u=s[1],d=Object(H.useState)(""),p=Object(X.a)(d,2),f=p[0],j=p[1],h=Object(H.useState)(""),b=Object(X.a)(h,2),m=b[0],g=b[1],v=Object(H.useState)(!1),O=Object(X.a)(v,2),_=O[0],x=O[1],y=Object(q.c)(),w=Object(H.useContext)(Ml).core,E=w.actions,S=E.login_reset_password,P=E.password_reset_validation,A=E.password_post,C=E.login_post,T=E.logout,R=zu.get(w.COOKIE_AUTH_NAME),N={weakLabel:"Fraca",mediumLabel:"M\xe9dia",strongLabel:"Forte"};Object(H.useEffect)((function(){R||y(P({token:t},i,a))}),[]),Object(H.useEffect)((function(){n.response&&!1===n.response.valid_token&&u("reset")}),[n]);var k,I,M=Object(ac.b)({defaultValues:{newPassword:"",confirmPassword:""}}),L=M.control,F=M.formState.errors,U=M.getValues,G=M.handleSubmit,D=function(e,t){if(e&&e[t])return"required"===e[t].type?Object(J.jsx)("small",{className:"p-error",children:e[t].message||"Campo obrigat\xf3rio"}):"maxLength"===e[t].type?Object(J.jsx)("small",{className:"p-error",children:e[t].message||"O n\xfamero de caracteres \xe9 superior \xe0 dimens\xe3o m\xe1xima permitida"}):"pattern"===e[t].type?Object(J.jsx)("small",{className:"p-error",children:e[t].message||"Formato inv\xe1lido"}):Object(J.jsx)("small",{className:"p-error",children:e[t].message})},V=Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsx)(lc.a,{className:"p-mt-2"}),Object(J.jsx)("p",{className:"p-mt-2",children:"Sugest\xf5es:"}),Object(J.jsxs)("ul",{className:"p-pl-2 p-ml-2 p-mt-0",style:{lineHeight:"1.5"},children:[Object(J.jsx)("li",{children:"Pelo menos uma min\xfascula"}),Object(J.jsx)("li",{children:"Pelo menos uma mai\xfascula"}),Object(J.jsx)("li",{children:"Pelo menos um d\xedgito"}),Object(J.jsx)("li",{children:"Pelo menos 8 caracteres"})]})]});if(R){var W=R.username;return Object(J.jsxs)("div",{children:[Object(J.jsxs)("p",{children:["Existe uma sess\xe3o ativa para o utilizador ",Object(J.jsx)("i",{children:Object(J.jsx)("strong",{children:W})}),"."]}),Object(J.jsxs)("p",{children:["Clique para",Object(J.jsx)(bt.a,{className:"p-button-link",label:"terminar sess\xe3o",onClick:function(e){return y(T())}}),"e fazer a altera\xe7\xe3o da palavra-passe."]})]})}if(r.response&&r.response&&r.response.authenticated){var K=r.response.username;return Object(J.jsxs)("div",{className:"p-d-flex p-ai-center p-dir-col p-px-3",children:[Object(J.jsx)("h3",{children:"Defini\xe7\xe3o de Palavra-passe"}),Object(J.jsx)("i",{className:"pi pi-check-circle",style:{fontSize:"5rem",color:"var(--green-500)"}}),Object(J.jsx)("p",{style:{lineHeight:1.5},children:"A Palavra-passe foi alterada com sucesso!"}),Object(J.jsx)(bt.a,{label:"Continuar",onClick:function(e){x(!0),y(C({username:K,password:m},i,a,o))},icon:_?"pi pi-spin pi-spinner":"pi pi-check",disabled:_})]})}return"reset"===l?null!==n&&void 0!==n&&null!==(k=n.response)&&void 0!==k&&k.reset_password?Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsxs)("div",{className:"p-fluid",children:[Object(J.jsx)("div",{className:"p-field p-grid",children:Object(J.jsx)("div",{className:"p-col-12",children:Object(J.jsx)("h3",{children:"Altera\xe7\xe3o de Palavra-passe"})})}),Object(J.jsx)("div",{className:"p-field p-grid",children:Object(J.jsx)("div",{className:"p-col-12 ",children:Object(J.jsx)(mt.a,{style:{width:"100%"},severity:"info",text:n.response.message})})}),Object(J.jsx)("div",{className:"p-field p-grid",children:Object(J.jsx)("div",{className:"p-col-12",children:Object(J.jsx)(bt.a,{className:"p-button-link",label:"Login",onClick:function(){i.push("login?redirect="+(a||"/"))}})})})]}),Object(J.jsx)("div",{className:"p-dialog-myfooter"})]}):Object(J.jsxs)(z.a.Fragment,{children:[Object(J.jsxs)("div",{className:"p-fluid",children:[Object(J.jsx)("div",{className:"p-field p-grid",children:Object(J.jsxs)("div",{className:"p-col-12",children:[Object(J.jsx)("h3",{children:"Altera\xe7\xe3o de Palavra-passe"}),Object(J.jsxs)("p",{children:["Indique o seu ",Object(J.jsx)("i",{children:"username"})," ou ",Object(J.jsx)("i",{children:"email"})," para receber um email com instru\xe7\xf5es para alterar a palavra-passe."]})]})}),Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{className:"p-col-12 p-md-4",children:"Nome de Utilizador / E-mail"}),Object(J.jsx)("div",{className:"p-col-12 p-md-8",children:Object(J.jsx)(jt.a,{value:f,placeholder:"Nome de Utilizador",onChange:function(e){return j(e.target.value)}})})]})]}),Object(J.jsx)("div",{className:"p-dialog-myfooter",children:Object(J.jsx)(bt.a,{color:"green",icon:n.loading?"pi pi-spin pi-spinner":"pi pi-check",label:"Enviar",onClick:function(e){e.preventDefault(),y(S({username:f},i,a))},disabled:n.loading})}),n.response&&!!n.response&&!!n.response.message&&Object(J.jsx)(mt.a,{style:{width:"100%"},severity:n.http_error?"error":"info",text:null===n||void 0===n||null===(I=n.response)||void 0===I?void 0:I.message})]}):"set"===l?Object(J.jsxs)("form",{onSubmit:G((function(e){g(e.newPassword),y(A({token:t,password:e.newPassword},i,a))})),autoComplete:"new-password",children:[Object(J.jsxs)("div",{className:"p-fluid",children:[Object(J.jsx)("div",{className:"p-field p-grid",children:Object(J.jsxs)("div",{className:"p-col-12",children:[Object(J.jsx)("h3",{children:"Defini\xe7\xe3o de Password"}),Object(J.jsx)("p",{children:"Por favor, defina e confirme a sua nova palavra-passe"})]})}),Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{htmlFor:"newPassword",className:Object(oc.a)({"p-col-12 p-md-4":!0,"p-error":F.newPassword}),children:"Palavra-passe*"}),Object(J.jsxs)("div",{className:"p-col-12 p-md-8",children:[Object(J.jsx)(ac.a,{name:"newPassword",control:L,rules:{required:"Preenchimento obrigat\xf3rio."},render:function(e){var t=e.field,n=e.fieldState;return Object(J.jsx)(xn.a,Object(Y.a)(Object(Y.a)(Object(Y.a)({id:t.name},t),{},{toggleMask:!0,promptLabel:"Introduza a palavra-passe"},N),{},{className:Object(oc.a)({"p-invalid":n.invalid}),footer:V,autoComplete:"off","aria-autocomplete":"none"}))}}),D(F,"newPassword")]})]}),Object(J.jsxs)("div",{className:"p-field p-grid",children:[Object(J.jsx)("label",{htmlFor:"confirmPassword",className:Object(oc.a)({"p-col-12 p-md-4":!0,"p-error":F.confirmPassword}),children:"Confirmar Palavra-passe*"}),Object(J.jsxs)("div",{className:"p-col-12 p-md-8",children:[Object(J.jsx)(ac.a,{name:"confirmPassword",control:L,rules:{required:"Preenchimento obrigat\xf3rio.",validate:function(){if(U("newPassword")!==U("confirmPassword"))return"As passwords n\xe3o s\xe3o iguais."}},render:function(e){var t=e.field,n=e.fieldState;return Object(J.jsx)(xn.a,Object(Y.a)(Object(Y.a)({id:t.name},t),{},{toggleMask:!0,feedback:!1,className:Object(oc.a)({"p-invalid":n.invalid}),autoComplete:"off","aria-autocomplete":"none"}))}}),D(F,"confirmPassword")]})]})]}),Object(J.jsx)("div",{className:"p-dialog-myfooter",children:Object(J.jsx)(bt.a,{color:"green",icon:r.loading?"pi pi-spin pi-spinner":"pi pi-check",label:"Aceitar",type:"submit",disabled:r.loading})}),r.http_error&&!r.response&&Object(J.jsx)(mt.a,{style:{width:"100%"},severity:"error",text:"Servi\xe7o Indispon\xedvel"}),r.response&&!!r.response&&!r.authenticated&&!!r.response.message&&Object(J.jsx)(mt.a,{style:{width:"100%"},severity:"error",text:"Dados inv\xe1lidos"})]}):void 0}));var Bu=Object(nt.g)((function(e){var t=e.location.search,n=Object(H.useContext)(Ml).core.CLIENT_URL,r=new URLSearchParams(t).get("token"),i=/redirect=(.*)/i.exec(t),a=/url_redirect=(.*)/i.exec(t),o=n+"assets/images/logo.png";return Object(H.useEffect)((function(){}),[]),Object(J.jsx)("div",{id:"login-page",className:"p-d-flex p-jc-center",style:{height:"100%"},children:Object(J.jsxs)("div",{className:"p-as-center",style:{backgroundColor:"white",padding:"6rem",maxWidth:"700px"},children:[Object(J.jsx)("div",{className:"login-logo",children:Object(J.jsx)("img",{alt:"Logo",src:o})}),Object(J.jsx)(Ku,{token:r,history:e.history,redirect:i?i[1]:null,urlRedirect:a?a[1]:null})]})})}));var Yu=Object(nt.g)((function(e){e.history;var t=e.children,n=Object(H.useContext)(Ml).core.CLIENT_URL,r=n+"assets/images/logo-splash.png",i=n+"assets/images"+(e.location.pathname||"")+"/logo-splash.png";return Object(J.jsx)("div",{className:"splashscreen p-d-flex p-jc-center",children:Object(J.jsxs)("div",{className:"p-as-center",children:[Object(J.jsx)("div",{className:"login-logo p-text-center",children:Object(J.jsx)("img",{onError:function(e){e.target.src=r},className:"img-responsive",src:i,alt:"Logo"})}),Object(J.jsx)("h3",{children:"Bem-vindo!"}),Object(J.jsx)("p",{children:"This website uses cookies to improve your browsing experience. By pressing 'I Accept' you are agreeing to its use."}),Object(J.jsx)("p",{children:Object(J.jsx)("a",{href:"/static/viewer/rgpd.html",target:"_blank",rel:"noopener noreferrer",children:"Mais informa\xe7\xe3o"})}),t]})})})),qu=n(1409),Xu=n(816),Ju=n.n(Xu),Zu="scalargis_rgpd",$u="2",Qu="/",ed=parseInt("150",10);var td=Object(qu.a)((function(e){var t=e.cookies,n=e.children,r=Object(H.useState)(t.get(Zu)),i=Object(X.a)(r,2),a=i[0],o=i[1];return Object(J.jsx)(Z,{theme:"default",children:Object(J.jsxs)(z.a.Fragment,{children:[a!==$u&&Object(J.jsx)(Yu,{children:Object(J.jsx)(Ju.a,{location:"bottom",buttonText:"Aceito",cookieName:Zu,cookieValue:$u,expires:ed,onAccept:function(){if(o($u),"http:"===window.location.protocol){var e=new Date;e.setDate(e.getDate()+parseInt(ed)),(new ft.a).set(Zu,$u,{path:Qu,expires:e,secure:!1,httpOnly:!1})}},extraCookieOptions:{path:Qu},debug:!0,cookieSecurity:!1,disableStyles:!0})}),a?n:Object(J.jsx)(J.Fragment,{})]})})})),nd=function(){var e=Ce();return Object(J.jsx)(z.a.StrictMode,{children:Object(J.jsx)(Ml.Provider,{value:{core:Nl,mainMap:Il},children:Object(J.jsx)(q.a,{store:Nl.store,children:Object(J.jsx)(Fu.a,{basename:e,children:Object(J.jsx)(td,{children:Object(J.jsxs)(nt.d,{children:[Object(J.jsx)(nt.b,{path:"/login",children:Object(J.jsx)(Du,{})}),Object(J.jsx)(nt.b,{path:"/registration",children:Object(J.jsx)(Hu,{})}),Object(J.jsx)(nt.b,{path:"/password",children:Object(J.jsx)(Bu,{})}),Object(J.jsx)(nt.b,{path:"/not-found",children:Object(J.jsx)(Uu,{})}),Object(J.jsx)(nt.b,{path:"/not-allowed",children:Object(J.jsx)(Gu,{})}),Object(J.jsx)(nt.b,{path:"/mapa/session/:id?",children:Object(J.jsx)(Lu,{})}),Object(J.jsx)(nt.b,{path:"/map/session/:id?",children:Object(J.jsx)(Lu,{})}),Object(J.jsx)(nt.b,{path:"/mapa/:id?",children:Object(J.jsx)(Lu,{})}),Object(J.jsx)(nt.b,{path:"/map/:id?",children:Object(J.jsx)(Lu,{})}),Object(J.jsx)(nt.b,{path:"/:id",children:Object(J.jsx)(Lu,{})}),Object(J.jsx)(nt.b,{path:"/",render:function(e){return Object(J.jsx)(nt.a,{to:"/map/".concat(e.location.search||"")})}})]})})})})})})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));B.a.render(Object(J.jsx)(nd,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},215:function(e,t,n){},664:function(e,t,n){},665:function(e,t,n){},668:function(e,t,n){},701:function(e,t,n){},703:function(e,t,n){}},[[1400,1,2]]]);
//# sourceMappingURL=main.4ecebc79.chunk.js.map