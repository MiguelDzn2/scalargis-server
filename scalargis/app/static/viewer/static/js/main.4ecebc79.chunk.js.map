{"version":3,"sources":["themes lazy /^/.*/src/main$/ groupOptions: {} namespace object","components lazy /^/.*/src/Main/.js$/ groupOptions: {} namespace object","core/components/ThemeSelector.js","core/components/AppTopbar.js","core/components/Portal.js","core/utils.js","core/components/Script.js","core/components/Style.js","core/components/LoadingScreen.js","core/components/Layout.js","core/containers/Layout.js","core/model/MapModel.js","core/components/ShareViewerWidget.js","core/components/SaveViewerWidget.js","core/components/LoginWidget.js","core/components/TopButtonAuth.js","core/components/TopButtonContact.js","core/components/TopButtonHelp.js","../../components/src/AttributesTable/src/Main.js","../../components/src/Basemaps/src/BasemapItem.js","../../components/src/Basemaps/src/Basemaps.js","../../components/src/Basemaps/src/Main.js","../../components/src/ContactForm/src/ContactInfo.js","../../components/src/ContactForm/src/ContactForm.js","../../components/src/ContactForm/src/Main.js","../../components/src/Coordinates/src/Coordinates.js","../../components/src/Coordinates/src/Main.js","../../components/src/CRSSelect/src/Main.js","../../components/src/DrawTools/src/DrawTools.js","../../components/src/DrawTools/src/Main.js","../../components/src/ExportMapFeatures/src/Main.js","../../components/src/FeatureInfo/src/messages.js","../../components/src/FeatureInfo/src/FeatureResults.js","../../components/src/FeatureInfo/src/Main.js","../../components/src/GeoLocation/src/GeoLocation.js","../../components/src/GeoLocation/src/Main.js","../../components/src/HelpButton/src/HelpHmtlContent.js","../../components/src/HelpButton/src/Main.js","../../components/src/HtmlContent.js","../../components/src/LayerAttributesTable/src/ThemeAttributes.js","../../components/src/LayerAttributesTable/src/Main.js","../../components/src/LayerDownload/src/Main.js","../../components/src/LayerEdit/src/EditNode.js","../../components/src/LayerEdit/src/Main.js","../../components/src/LayerMetadata/src/ThemeInfo.js","../../components/src/LayerMetadata/src/Main.js","../../components/src/LayerOpacity/src/Main.js","../../components/src/LayerRemove/src/Main.js","../../components/src/MapControls/src/MapControls.js","../../components/src/MapControls/src/Main.js","../../components/src/MapScaleInput/src/Main.js","../../components/src/MapScaleLine/src/Main.js","../../components/src/MapTools/src/actions.js","../../components/src/MapTools/src/MapTools.js","../../components/src/MapTools/src/Main.js","../../components/src/PanelHTML/src/PanelHmtlContent.js","../../components/src/PanelHTML/src/Main.js","../../components/src/PlacesSearch/src/useOutsideClick.js","../../components/src/PlacesSearch/src/Main.js","../../components/src/PopupInfo/src/Main.js","../../components/src/Print/src/PrintPanelNoPrints.js","../../components/src/Print/src/PrintPanel1.js","../../components/src/Print/src/PrintPanel2.js","../../components/src/Print/src/PrintGroupItem.js","../../components/src/Print/src/PrintPanel3.js","../../components/src/Print/src/PrintPanel4.js","../../components/src/Print/src/PrintPanelItem.js","../../components/src/Print/src/Print.js","../../components/src/Print/src/useFormFields.js","../../components/src/Print/src/Main.js","../../components/src/SearchLayers/src/actions.js","../../components/src/SearchLayers/src/reducers.js","../../components/src/SearchLayers/src/renderes/util/layout.js","../../components/src/SearchLayers/src/renderes/layouts/PrimereactVerticalLayoutRenderer.js","../../components/src/SearchLayers/src/renderes/layouts/PrimereactHorizontalLayoutRenderer.js","../../components/src/SearchLayers/src/utils.js","../../components/src/SearchLayers/src/service.js","../../components/src/SearchLayers/src/SearchLayerResults.js","../../components/src/SearchLayers/src/SearchLayerForm.js","../../components/src/SearchLayers/src/SearchLayers.js","../../components/src/SearchLayers/src/map.js","../../components/src/SearchLayers/src/Main.js","../../components/src/StreetView/src/StreetView.js","../../components/src/StreetView/src/Main.js","../../components/src/ThemeWizard/src/wizard/stepType.js","../../components/src/ThemeWizard/src/wizard/type/WMS.js","../../components/src/ThemeWizard/src/wizard/type/WMTS.js","../../components/src/ThemeWizard/src/wizard/type/WFS.js","../../components/src/ThemeWizard/src/wizard/type/ArcGISMap.js","../../components/src/ThemeWizard/src/wizard/type/Shapefile.js","../../components/src/ThemeWizard/src/wizard/type/GeoJSON.js","../../components/src/ThemeWizard/src/wizard/type/KML.js","../../components/src/ThemeWizard/src/wizard/type/GML.js","../../components/src/ThemeWizard/src/wizard/type/DXF.js","../../components/src/ThemeWizard/src/wizard/type/Group.js","../../components/src/ThemeWizard/src/wizard/layerNode.js","../../components/src/ThemeWizard/src/wizard/WMSThemesSelector.js","../../components/src/ThemeWizard/src/wizard/WMTSThemesSelector.js","../../components/src/ThemeWizard/src/wizard/ThemesSelector.js","../../components/src/ThemeWizard/src/wizard/stepData.js","../../components/src/ThemeWizard/src/wizard/stepConfirm.js","../../components/src/ThemeWizard/src/Main.js","../../components/src/TOC/src/TOC/DragSlot.js","../../components/src/TOC/src/TOC/DraggableItem.js","../../components/src/TOC/src/TOC/LegendArcGIS.js","../../components/src/TOC/src/TOC/Legend.js","../../components/src/TOC/src/TOC/Node.js","../../components/src/TOC/src/TOC/Tree.js","../../components/src/TOC/src/TOC/Model.js","../../components/src/TOC/src/Main.js","../../components/src/UserLogin/src/LoginWidget.js","../../components/src/UserLogin/src/RegistrationWidget.js","../../components/src/UserLogin/src/messages.js","../../components/src/UserLogin/src/Main.js","core/actions/index.js","core/pubsub/index.js","Core.js","core/reducers/index.js","AppContext.js","core/components/MainMap.js","core/model/OWSModel.js","core/components/MainMenu.js","core/containers/MainMenu.js","core/components/Layers.js","core/components/Layers/TileLayer.js","core/components/Layers/WMSLayer.js","core/components/Layers/WFSLayer.js","core/components/Layers/WMTSLayer.js","core/components/Layers/VectorTileLayer.js","core/components/Layers/VectorLayer.js","core/components/Layers/GeoJSONLayer.js","core/components/Layers/KMLLayer.js","core/components/Layers/ArcGISMapLayer.js","core/components/Layers/GroupLayer.js","core/components/Layers/MorphLayer.js","core/components/FooterLeft.js","core/containers/FooterLeft.js","core/components/FooterRight.js","core/containers/FooterRight.js","core/components/TopbarRight.js","core/containers/TopbarRight.js","core/components/MapControlsTopLeft.js","core/containers/MapControlsTopLeft.js","core/components/MapControlsTopRight.js","core/containers/MapControlsTopRight.js","core/components/MapControlsLeft.js","core/containers/MapControlsLeft.js","core/components/MapControlsBottomLeft.js","core/containers/MapControlsBottomLeft.js","core/components/MapControlsBottomRight.js","core/containers/MapControlsBottomRight.js","core/map_control/FeatureInfo.js","core/map_control/Coordinates.js","core/map_control/GeoLocation.js","core/map_control/index.js","core/map_control/Attribution.js","core/components/Tracking/index.js","core/containers/Viewer.js","core/components/Page404.js","core/components/Page401.js","core/components/PageLogin.js","core/components/RegistrationConfirmationWidget.js","core/components/PageRegistrationConfirmation.js","core/components/PasswordWidget.js","core/components/PagePassword.js","core/components/SplashScreen.js","core/components/RGPD.js","core/containers/App.js","serviceWorker.js","index.js"],"names":["webpackEmptyAsyncContext","req","Promise","resolve","then","e","Error","code","keys","module","exports","id","ThemeSelector","props","theme","children","Theme","React","lazy","_jsxs","_Fragment","_jsx","Suspense","fallback","AppTopbar","_Component","_inherits","_super","_createSuper","_classCallCheck","apply","arguments","_createClass","key","value","className","onClick","this","onToggleMenu","logo","regionComponents","Component","defaultProps","Portal","_ref","el","document","createElement","root","getElementById","_useState","useState","_useState2","_slicedToArray","val","setVal","portalDiv","useRef","useEffect","current","appendChild","removeChild","createPortal","_getAppRootPath","_window","_window2","window","SCALARGIS_ROOT_PATH","_getAppBaseUrl","_window3","_window4","SCALARGIS_ROOT_PATH_BASE_URL","mapStateToProps","state","Object","entries","map","_ref2","assign","_toConsumableArray","rememberUrl","cookies","type","url","cookieName","process","REACT_APP_COOKIE_PREFIX","urlhistory","get","indexOf","push","set","generateRGBA","Math","floor","random","join","removeUrlParam","sourceURL","param","rtn","split","params_arr","new_params","queryString","i","length","RegExp","test","addUrlParam","getWindowSize","w","d","documentElement","g","getElementsByTagName","innerWidth","clientWidth","innerHeight","clientHeight","isDesktop","isMobile","isUrlAppOrigin","url1","URL","location","href","url2","origin","isUrlAppHostname","hostname","getAppRootPath","getAppBaseUrl","root_path","endsWith","getAppClientUrl","getAppApiUrl","startsWith","protocol","toLowerCase","getAppMapProxyUrl","getAppUploadUrl","getViewerPublicUrl","uuid","appUrl","viewerPath","pathname","tmpPath","substring","getCookieAuthName","traverseOlLayers","collection","cb","forEach","l","OLGroupLayer","getLayers","findOlLayer","mainMap","layer","findOLInteraction","classname","result","getInteractions","item","serializeDrawing","feature","crs","getId","uuidv4","setId","getGeometry","getType","draw_symbol","draw_text","draw_geom","fill","stroke","size","symbol_type","text_style","text_size","text_font","text_value","serializeOptions","dataProjection","featureProjection","decimals","geojson","OlFormatGeoJSON","writeFeatureObject","urn_crs","replace","createStyle","drawing","altStroke","style","createDrawingStyle","createDrawingSymbol","createDrawingText","deserializeDrawing","_drawing$properties$s","properties","readFeature","setStyle","fillStr","concat","r","b","a","strokeStr","OlStyleStyle","OlStyleStroke","color","width","parseInt","OlStyleFill","image","OlStyleCircle","radius","lineDash","label","fontStr","text","OlStyleText","font","textAlign","textBaseline","OlStyleRegularShape","points","angle","PI","rotation","radius2","showOnPortal","traverseLayersTree","layers","parent","filter","cid","isAdminOrManager","auth","_auth$response","data","userroles","response","s","x","includes","useScript","async","script","src","body","useScriptHmtl","createTextNode","Script","_ref$async","ScriptHtml","useStyle","elem","rel","useStyleHtml","Style","StyleHtml","onLoaded","withRouter","ProgressBar","mode","height","Layout","_config$config_json","core","config","viewer","sidebar","onWrapperClick","onSidebarClick","CLIENT_URL","loaded","setLoaded","custom_style","copyrightYear","Date","getFullYear","entityName","entityUrl","wrapperClass","classNames","layoutMode","staticMenuInactive","overlayMenuActive","mobileMenuActive","config_json","layout_class","sidebarClassName","layoutColorMode","img_logo","title_logo","logoComponent","alt","dangerouslySetInnerHTML","__html","topbarRight","ref","mainMenu","target","footerLeft","footerRight","LoadingScreen","scripts","k","styles","setTimeout","custom_script","connect","gstate","history","mainOlMap","layout_toggle_menu","layout_wrapper_click","activeTheme","setActiveTheme","menuClick","manifest_url","manifest_json","encodeURIComponent","JSON","stringify","querySelector","setAttribute","title","description","content","keywords","icon_url","img_icon","element","classList","add","remove","removeClass","updateSize","LayoutComponent","_objectSpread","event","preventDefault","loading","addProjections","projections","OlProj","srid","Proj4","defs","proj4register","newProj","fromLonLat","extent","worldExtent","Number","setWorldExtent","applyTransform","undefined","setExtent","INCHES_PER_UNIT","getViewerSessionConfig","newlayers","removed","newl","slice","layersIds","newchecked","checked","c","transformExtent","sourceProj","targetProj","re","isFinite","parseFloat","sourceCrs","String","targetCrs","createLayer","all","defaultStyle","style_color","style_stroke_color","style_stroke_width","style_image_radius","ollayer","layerProps","getProperties","snapToPixel","getView","getProjection","getCode","OlLayerTile","visible","active","source","OlSourceXYZ","tileUrlFunction","coordinate","wmts_url","z","OlSourceOSM","preload","Infinity","OlSourceBingMaps","imagerySet","opacity","OlSourceTileJSON","sourceConfig","hidpi","params","tiled","version","get_map_format","format","wms_style","crs_options","OlSourceTileWMS","OlLayerImage","OlSourceImageWMS","legendUrl","createLegendUrl","wms_layers","wmts_options","OlSourceWMTS","optionsFromCapabilities","wmts_capabilities","matrixSet","wfsFormatOptions","srsName","formatOutput","wfsformat","OlFormatGML2","readFeaturesOptions","srsname","OlFormatWFS","vectorSource","OlSourceVector","loader","bbox","proxy","REACT_APP_PROXY_URL","checkLoading","fetch","res","features","readFeatures","f","getSource","addFeatures","catch","error","console","log","removeLoadedExtent","OlLayerVector","OlFormatKML","extractStyles","defaultDataProjection","OlGroup","OlCollection","Array","isArray","inverted","reverse","config2","sub","setLayers","on","setProperties","max_scale","maxres","getResolutionForScale","getUnits","setMaxResolution","min_scale","minres","setMinResolution","setVisible","signal","srs","finalurl","getFeatureInfoGeoJSON","viewResolution","reject","REACT_APP_PUBLIC_URL","getGetFeatureInfoUrl","json","err","getFeatureInfoJSON","getFeatureInfoXML","xml","gmlFeatures","OlFormatGML","xml2js","parseString","getFeatureInfoGML","gml","parser","parseOptions","OlFormatGML3","featureType","getFeatureInfoHtml","getFeatureInfoText","parseFeatureInfo","_asyncToGenerator","_regeneratorRuntime","mark","_callee","callFormat","wrap","_context","prev","next","get_feature_info_format","stop","_x","_x2","_x3","_x4","deserializeFeatures","serializeFeatures","writeFeatures","scale","units","getScaleForResolution","resolution","round","isThemeOnScale","olmap","onScale","mapResolution","getResolution","source_max_scale","themeMaxResolution","source_min_scale","themeMinResolution","layerMaxResolution","layerMinResolution","getProjectionSrid","proj","processVisibility","traverseTree","items","child","processOpacity","ollayers","setOpacity","processRemoveThemes","ids","removeAt","addBaseLayers","olMap","addLayer","addLayers","toggleinteractionDragBox","findActiveWMSLayer","getVisible","t","toggleGetFeatureInfo","disableZoomExtent","updateBBOXCenter","setFeatureInfo","getFeatureInfo","getState","zoomTheme","fit","nearest","getCurrentScale","getThemeLegendUrl","legend_url","getPolygonFromExtent","separator","v","coords","OlGeom","getWKTFromGeometry","geom","OlWKT","writeGeometry","getGeometryFromWKT","wkt","options","readGeometry","getWMSVisibleLayers","vlayers","_getLayers","list","lls","getArray","getUrl","getUrls","p","getParams","ldata","getOpacity","getMaxResolution","getMinResolution","pitem","cql_filter","maxResolution","minScale","minResolution","maxScale","rootLayers","getArcGISVisibleLayers","OlSourceTileArcGISRest","OlSourceImageArcGISRest","Cookies","_viewer$config_json","_viewer$config_json2","_record$config_json4","_record$config_json5","_record$config_json6","record","showForm","setShowForm","_useState3","_useState4","_useState5","_useState6","name","setName","_useState7","_useState8","setTitle","_useState9","_useState10","setDescription","_useState11","_useState12","slug","setSlug","_useState13","_useState14","allow_add_layers","setAllowAddLayers","_useState15","_useState16","allow_user_session","setAllowUserSession","_useState17","_useState18","allow_anonymous","setAllowAnonymous","dispatch","useDispatch","useContext","AppContext","_core$actions","actions","viewer_save_record","viewer_save_response","cookieData","COOKIE_AUTH_NAME","allow_sharing","submit","newconfig","parent_id","Fragment","_record$config_json","_record$config_json3","_record$config_json2","anonymous","openForm","Dialog","header","modal","onHide","onSubmit","InputText","placeholder","onChange","InputTextarea","rows","show_allow_add_layers","InputSwitch","show_allow_user_session","show_allow_anonymous","save_response","wordBreak","Button","marginLeft","icon","currentTarget","blur","str","position","left","select","execCommand","copyToClipboard","tooltip","tooltipOptions","save_loading","disabled","save_error","Message","severity","message","is_active","setIsActive","is_owner","redirect","path","urlRedirect","username","setUsername","password","setPassword","login_post","login_clear_error","logout","Password","feedback","http_error","appEntityNameAbrev","showLoginButton","setShowLoginButton","showLogin","setShowLogin","showMenu","setShowMenu","popupMenu","wsize","isMobileSmall","roles","userMenu","command","unshift","Menu","model","display","LoginWidget","validateEmail","email","match","_viewer$user_info3","_viewer$user_info4","setEmail","infoMessage","setInfoMessage","sending","setSending","headers","method","logged","token","API_URL","success","show_contact","_viewer$user_info","_viewer$user_info2","user_info","htmlFor","contact_info","help_url","paginatorLeft","paginatorRight","Main","open","as","onOpen","onClose","fields","DataTable","paginator","paginatorTemplate","currentPageReportTemplate","rowsPerPageOptions","field","Column","sortable","filterPlaceholder","row","BasemapItem","selected","setSelected","subtitle","img","thumbnail","itemClass","Card","subTitle","Basemaps","selectedLayer","auto_close","autoClose","opened","setOpened","selectLayer","layers_set_checked","MainMenu","margin","viewer_set_selectedmenu","utils","_i","_layers","renderContent","Panel","ContactInfo","hideContactInfo","readUploadedFile","file","reader","FileReader","onerror","abort","DOMException","onload","filename","readAsDataURL","handleUpload","fileContents","sent","abrupt","t0","warn","ContactFrom","_viewer$user_info5","upload_cfg","Utils","upload","showCaptcha","captcha_key","captchaResponse","setCaptchaResponse","files","setFiles","enableSubmit","setEnableSubmit","isProcessingFiles","setIsProcessingFiles","_useState19","_useState20","isComplete","setIsComplete","fileUploadRef","final_files","isFileSelected","minFiles","maxFiles","requiredFieldMessage","enabled","FileUpload","uploadOptions","chooseLabel","cancelLabel","itemTemplate","Tag","formatSize","onTemplateRemove","onRemove","onSelect","upload_files","from","promises","values","new_files","obj","onClear","multiple","accept","maxFileSize","invalidFileSizeMessageSummary","invalidFileSizeMessageDetail","emptyTemplate","emptyMessage","toFixed","Captcha","siteKey","language","onResponse","onExpire","Models","_Models$Utils","showPopup","setShowPopup","component_cfg","closeLabel","footer","hideForm","ContactForm","region","_Models$Utils2","Coordinates","MapModel","coordinates","listCRS","setListCRS","CRS","setCRS","coordX","setCoordX","coordY","setCoordY","setUnits","showDegrees","setShowDegrees","optLatitude","setOptLatitude","optLongitude","setOptLongitude","coordLon","setCoordLon","coordLat","setCoordLat","_useState21","_useState22","newCoord","setNewCoord","buildSaveBtnItems","exportItem","serializeCoordinatesGeoJSON","export_crs","display_crs","rec","OlFeature","geometry","OlPoint","results","_ref3","found","find","field_prefix","writeFeaturesObject","crsinfo","serializeCoordinatesCSV","csv","_ref4","_ref5","convertDMS2DD","dms","parts","convertDD2DMS","deg","is_lon","abs","minfloat","m","secfloat","download","click","zoomItem","transform","map_set_extent","exportAll","renderCoordinatesItem","SplitButton","index","findIndex","updated","splice","viewer_set_coordinates","removeItem","_ref6","_ref7","crs_units","prj","colspan","precision","crs_list","isDegrees","y","lon","lat","Dropdown","RadioButton","InputNumber","onValueChange","minFractionDigits","maxFractionDigits","InputMask","mask","trans_coords","new_coords","uuidV4","transformCoordinatesByApi","padding","DataView","layout","alwaysShowPaginator","pageLinkSize","fontSize","selected_menu","viewer_set_exclusive_mapcontrol","expand_menu","layout_show_menu","expand_menu_mobile","isCoordInExtent","proj_coords","wgsCoords","containsCoordinate","parseExtent","center","viewer_set_displaycrs","cursorRef","crs_filtered","mousePosition","MousePosition","coordinateFormat","createStringXY","projection","addControl","removeControl","changeCRS","proj_code","fixedLength","drawElementsOptions","selectTools","historyTools","colorTools","defaultExportFormats","typeLabels","DrawTools","_React$Component","_this","call","changeSize","setState","getFeatures","getLength","updateStyle","changeFill","rgb","changeStroke","changeSymbol","changeTextStyle","changeTextSize","changeTextFont","changeTextValue","toggleFillPicker","displayFillPicker","displayStrokePicker","closeFillPicker","toggleStrokePicker","closeStrokePicker","drawings","exclude_export_formats","exportFormats","hist","history_now","editing","selectedTool","sizeOptions","symbolOptions","textStyleOptions","textSizeOptions","textFontOptions","drawingsLayer","getFeaturesCollection","modify","OlInteractionSelect","condition","singleClick","hitTolerance","wrapX","oldSelect","deselected","un","onMOdifyEnd","bind","_assertThisInitialized","removeInteraction","editFeature","draw","OlFormatWKT","_props$state","_this$props","viewer_set_drawings","_this2","feat","_this3","OlInteractionModify","deleteCondition","shiftKeyOnly","addInteraction","setActive","prevProps","_this4","_this$state","_this$props2","OlInteractionDraw","findInteraction","OlInteractionDragPan","OlInteractionDoubleClickZoom","OlInteractionPinchZoom","drawings_update","history_item","_this5","_this$props3","_this5$props","clickDrawSymbol","clickDrawText","clickDrawPoint","clickDrawLine","clickDrawPolygon","toggleInteraction","_this6","_this7","_this8","_this$props4","clear","_this8$state","_this9","_this$props5","_this9$state","_this$props6","_this$props7","getEditingFeature","dispatchEvent","finishEditing","_this$props8","serializer","Blob","FileSaver","saveAs","opt","_this$state2","backgroundColor","parseOlFeatures","_this$props9","_this10","_this$state3","disableTools","enableTools","startDraw","getButtonStyle","zIndex","top","right","bottom","CompactPicker","marginBottom","clickUndo","clickRedo","clickDelete","removeFeature","minWidth","dataKey","table","zoom","deleteItem","links","selectSingleClick","olLayer","coord","exportSelected","GeoJSON","Select","mapBrowserEvent","VectorSource","Feature","Point","FeatureResults","pubsub","publish","subscribe","activeIndex","setActiveIndex","userRoles","setUserRoles","showExport","setShowExport","showExportAll","setShowExportAll","showExportRecord","setShowExportRecord","grouped","feature_tpl","groupResults","showExportAllFeatures","groups","show","allowExportFeatures","getShowExportAllFeatures","user_roles","export_roles","export_all","export_record","valueTemplate","rowData","action","show_null","viewer_set_featureinfo","outCRS","Accordion","onTabChange","layerRecordExport","featureinfo_export_roles","AccordionTab","new_value","rf","fld","new_data","formatValue","geometryName","getGeometryName","getKeys","getFeatureRows","hasGeometry","isText","getExtent","zoomFeature","groupField","whiteSpace","overflowWrap","layerKey","allowExport","tmpjson","parse","source_unit","output_unit","unit","toNumeric","toLocaleString","locale","useGrouping","expression","featureinfo","GeoLocation","_component_cfg$messag","_component_cfg$messag2","geolocation","geo_location_control","map_controls","geoLocationActive","geoLocationTracking","tracking","viewer_update_mapcontrol","setResults","buildResultsTable","display_coords","accuracy","altitude","altitudeAccuracy","heading","speed","messages","_messages$error","getErrorMessage","intro","inputId","toggleGeoLocationControl","Checkbox","trackingGeoLocationControl","zoomGeoLocation","HelpHtmlContent","dialogContent","setDialogContent","html","setSize","maximized","setMaximized","dialog","maximizable","onShow","contentEl","onResize","onMaximize","iframe","border","openAs","HtmlContent","htmlContent","setHtmlContent","ThemeAttributes","hasAttributes","layer_has_attributes","_layer$datatable","_props$config","_models$Utils","models","modalThemeAttributesOpen","setModalThemeAttributesOpen","datatable","exclude_components","searchlayers_set_layer","outputFormat","isDownloading","setIsDownloading","downloadFormat","setDownloadFormat","toast","linkDownload","link","externalDownload","external","datasourceDownload","downloadVectorTheme","summary","detail","life","datasource","showDownloadBtn","Toast","downloadLink","typeNames","count","cqlFilter","propertyName","downloadDatasource","alert","EditNode","edit","showAdvanceOptions","selectable","editField","wmsFormatOptions","wmsFeatureFormatOptions","wmsStyleOptions","wmtsFormatOptions","wmtsFeatureFormatOptions","wmtsStyleOptions","map_formats","get_map_formats","finfo_formats","get_feature_info_formats","wstyles","wms_styles","j","tile_formats","wmts_formats","wmts_finfo_formats","wmts_styles","cursor","wmts_format","wmts_style","ColorPicker","convertToRGB","convertToRGBString","convertToRGBAString","_ref8","min","onSave","modalEditOpen","setModalEditOpen","applyThemeChanges","ThemeInfo","metadata","exclude_service_metadata","getTypeDescription","renderComponents","modalThemeInfoOpen","setModalThemeInfoOpen","downloadTheme","except","Slider","discrete","max","confirmDeleteTheme","setConfirmDeleteTheme","removeThemes","autoFocus","mapControls","mapInteractions","zoomToExtentControl","dragBoxInteraction","MapControls","exclusive_mapcontrol","coordinates_control","coordinatesActive","feature_info_control","featureInfoActive","geo_location_component","components","map_control","dragBox","setDragBox","geoLocationSettings","setGeoLocationSettings","getComponentMapButton","show_button","toggleCoordinatesControl","toggleFeatureInfoControl","navigator","onMouseOver","onMouseLeave","toggleGeoLocationTracking","elem_zoom","zoom_opts","tipLabel","full_extent","ZoomToExtent","attribution","exclude_map_controls","o","defaultControls","extend","FullScreen","DragBox","defaultInteractions","altShiftDragRotate","pinchRotate","DragRotate","evt","originalEvent","ctrlKey","box","setEditing","setScale","input","onChangeScale","onKeyUp","which","keyCode","current_scale","substr","isNaN","setResolution","onSetScale","onBlur","setScaleLineControl","scaleLineControl","OlScaleLine","MAPTOOLS_SET_SELECTEDCONTROL","maptools_set_selectedcontrol","selected_control","helpModal","helpLengthShowed","helpAreaShowed","control","area","drawingsStyle","OlStyle","OlFill","OlStroke","drawStyle","OlCircle","sketch","helpTooltipElement","helpTooltip","measureTooltipElement","measureTooltip","pointerMoveHandler","dragging","helpMsg","Polygon","LineString","innerHTML","setPosition","onMouseOutViewport","formatLength","line","_this$props$record","_this$props$record$co","_this$props$record$co2","OlSphere","clone","output","formatArea","polygon","_this$props$record2","_this$props$record2$c","_this$props$record2$c2","getArea","createHelpTooltip","parentNode","Overlay","offset","positioning","addOverlay","vector","ft","getViewport","removeEventListener","listener","OlDraw","ev","unByKey","addEventListener","onControlSelect","showHelp","removeOverlay","SelectButton","optionLabel","optionValue","changeMeasureControl","option","fluid","closeHelp","maptoolsReducer","component_store_state","store","maptools","componentActions","reducerManager","getReducerMap","MapTools","PanelHtmlContent","useOutsideClick","callback","handleClick","contains","setFilter","activeSources","setActiveSources","places","setPlaces","selectedPlace","isLoading","setIsLoading","buildDefaultItem","iconClass","admin_level","admin_level4","admin_level3","admin_level2","admin_level1","sources_ids","sources","max_rows","min_similarity","origem","changeFilterFunc","marginTop","ListBox","_types$templates","_types$defaultTemplat","_types$defaultTemplat2","types","defaultTemplate","designacao","concelho","buildLegacyDefaultItem","_types$defaultTemplat3","templates","tpl","geom_wkt","_config$sources","buffer","geom_ext","selectPlace","cookiePopupName","REACT_APP_COOKIE_POPUP_NAME","cookiePath","permanent","setPermanent","hidePopup","_record$config_json$a","_record$config_json2$","maxAge","hide","_auth$data","hideOption","authenticated","hideAuthenticated","getInitialState","_record$config_json3$","_record$config_json4$","PrintPanelNoPrints","PrintPanel1","printing","group","setPrintGroup","changeActivePanel","goPanelPrintGroup","prints","print","setPrintItem","PrintPanel2","printGroup","printLayer","setPrintDetails","setGeometries","handleFieldChange","standalone","drawTool","setDrawTool","setDraw","setModify","setShowErrors","toastDialog","confirmDeleteAll","confirmDialog","acceptLabel","rejectLabel","render","di","multi_geom","slct","mdf","toolbarLeftContents","tool","selectDrawTool","toolbarRightContents","feats","deletedSelectedFeature","zoomFeaturesExtent","allow_drawing","Toolbar","location_marking","form_fields","groupKey","_ref9","_ref10","fieldKey","field_key","required","_ref11","_ref12","isFormInvalid","formData","fieldName","geoms","geom_filter","geom_srid","resource_url","printsIds","setExtraPropsRecursive","goPanelPrintNext","PrintGroupItem","printDetails","groupItem","selectedPrints","setSelectedPrints","onSelectedPrintChange","allow_selection","PrintPanel3","setFinalPrints","formats","setFormats","frmts","layouts","orientation","ff","float","finalPrints","getSelectedPrintsRecursive","groupId","groupTitle","processed","PrintPanel4","geometries","isProcessing","setIsProcessing","isMergingFiles","setIsMergingFiles","mergedFile","setMergedFile","mergePrintFiles","viewerId","Success","Data","newFinalPrints","outProj","geomWKT","opts","userFormData","printId","extentWKT","calculateExtent","getSize","processing","hasInvalidPrints","merge_prints","textDecoration","reduce","sum","PrintPanelItem","printItem","_Models$MapModel","paperBoxLayer","paperBox","setPaperBox","restrictScales","setRestrictScales","scaleTabIndex","setScaleTabIndex","scaleModes","setScaleModes","selectedScaleMode","setSelectedScaleMode","restrictedScale","setRestrictedScale","freeScale","setFreeScale","isPrinting","setIsPrinting","_useState23","_useState24","_useState25","_useState26","printFile","setPrintFile","drawPaperBox","getScalesTabs","tabs","restrict_scales","TabPanel","free_scale","prefix","map_scale","center_x","center_y","f_extent","createEmpty","getCenter","layout_conf","layout_conf_json","half_w","half_h","xmin","ymin","xmax","ymax","corners_pts","paperbox","paperbox_Feature","addFeature","scale_types","scales","restrict_scales_list","defaultTab","_control$config_json","defaultScaleSelector","VectorLayer","renderMode","Vector","Stroke","Fill","olit","platformModifierKeyOnly","controls","dragPan","deactivate","TabView","onScaleTabChange","tab","borderRadius","wmsLayers","arcgisLayers","allLayers","LAYERS","CQL_FILTER","STYLES","STYLE","doPrint","showPreview","Print","activePanel","setStandalone","_useFormFields","initialState","setValues","_defineProperty","useFormFields","_useFormFields2","CircleStyle","total","getTotalPrints","parentLayer","SEARCHLAYERS_SET_LAYER","searchlayers","renderLayoutElements","elements","schema","renderers","cells","JsonFormsDispatch","uischema","primereactVerticalLayoutTester","rankWith","uiTypeIs","PrimereactVerticalLayoutRendererComponent","direction","isEmpty","withJsonFormsLayoutProps","childProps","primereactHorizontalLayoutTester","PrimereactHorizontalLayoutRendererComponent","getDescribeFeatureType","cfg","feature_prefix","feature_type","source_url","integrated_authentication","auth_token","integrated_authentication_key","MAP_PROXY_URL","sch","localType","buildSchemaFromFeatureType","featureTypes","uisch","buildUiSchemaFromSchema","geometry_field","getGeometryFieldFromFeatureType","startIndex","maxFeatures","sort","requestOptions","featureNS","feature_namespace","featurePrefix","fields_list","all_geometries","conditions","equalToFilter","likeFilter","wfsFilter","andFilter","featureRequest","WFS","writeGetFeature","ogcNS","xmlSerializer","XMLSerializer","serializeToString","new_sort","xmlDoc","DOMParser","parseFromString","sortElem","createElementNS","sortPropertyElem","propertyNameElem","sortOrderElem","totalFeatures","getFeatureById","featureId","_options$crs","_options$format","SearchLayerResults","searchConfig","doSearch","setData","columns","setColumns","totalRecords","setTotalRecords","sortField","setSortField","sortOrder","setSortOrder","zoomLayerFeatures","bufferValue","olGetCenter","id_","new_cols","userSelect","totalPaginatorTemplate","showPagination","pagination","formatTemplateValue","first","onSort","paginatorClassName","fields_sort","field_cfg","htmlTemplate","actionTemplate","buildColumns","Paginator","onPageChange","toastEl","vanillaRenderers","tester","renderer","PrimereactVerticalLayoutRenderer","PrimereactHorizontalLayoutRenderer","SearchLayerForm","schemaConfig","updateLayerSchema","goPanelSearchPrev","_ref$schema","_ref$uischema","errorSchema","setErrorSchema","setFormData","setBlockedPanel","finally","start","numRecords","new_results","sticky","JsonForms","vanillaCells","new_formdata","_errors","template","formvalues","fielddata","final_value","virtualdata","_ref13","_ref14","_ref15","getFormData","fields_form","SearchLayers","show_icon","schemas","setSchemas","show_main","showPanelPrev","layerId","setFill","setStroke","displacement","rotateWithView","circleStyle","setImage","reducers","componentReducers","layer_id","exclusive_layer","blockedPanel","useSelector","new_layers","oDiv","sOriginalOverflow","overflow","sOriginalHeight","offsetHeight","_unused","getBlockFullHeight","ProgressSpinner","strokeWidth","animationDuration","StreetView","modalStreetViewOpen","setModalStreetViewOpen","streetviewLayer","panorama","streetviewStyle","OlStyleIcon","imgSize","_image$icon","iconStyle","getImage","getSrc","streetviewSingleClick","lonlat","pos","getPosition","lng","newPos","google","maps","LatLng","panoramaOptions","pov","pitch","pan","StreetViewPanorama","addListener","getPov","containsXY","animate","onResizeEnd","trigger","WizardStepType","wizardData","setType","stepdata","initialData","previousType","dataitems","versions","WMS","setLoading","setError","restricted_extent","ignore_url","wmsIgnoreServiceUrl","wmsVersion","wmsTiled","turl","ok","statusText","wms","WMSCapabilities","read","OWSModel","convertWMS2Themes","dataType","loadWMSCapabilities","getUrlHistory","winSize","trim","WMTS","wmtsIgnoreServiceUrl","wmtsVersion","wmts","WMTSCapabilities","convertWMTS2Themes","wmtsTileMatrixSet","Contents","TileMatrixSet","Identifier","SupportedCRS","loadWMTSCapabilities","capabilities","convertWFS2Themes","loadWFSCapabilities","ArcGISMap","murl","lurl","layers_data","service","convertArcGISMap2Themes","loadArcGISMapCapabilities","Shapefile","fastFetch","endpoint","upload_url","UPLOAD_URL","FormData","append","orginal_url","convertGeoJSON2Themes","customUpload","uploadHandler","loadShapeFile","uploadLabel","loadGeoJSONFile","changeURL","loadFromUserURL","KML","loadKMLData","kml","convertKML2Themes","loadKMLFile","GML","loadGMLFile","DXF","loadDXFFile","Group","selection","partialChecked","changeName","layerNode","node","WMSThemesSelector","themes","readOnly","expandAllGroups","expandedKeys","setExpandedKeys","isSelectAll","setIsSelectAll","nodes","expandNode","newExpandedKeys","_step","_iterator","_createForOfIteratorHelper","n","done","selectAll","lvl","partial","_step3","getGroupsKeys","_step2","_iterator2","_iterator3","_step4","_iterator4","Tree","filterMode","selectionMode","selectionKeys","onSelectionChange","sel","selItem","onToggle","WMTSThemesSelector","tileMatrixSet","tilematrixset","setTilematrixset","matrixItems","showClear","wmts_tilematrixset","selectTileMatrixSet","ThemesSelector","WizardStepData","upload_maxfilesize","TypeComponent","filterSelectedLayerItems","saveSelection","WizardStepConfirm","source_types","setWizardData","setTypes","onComplete","_props$actions","viewer_add_themes","layers_set_opened","simpleLayers","allIds","parentIds","addLayerItems","getSimpleLayers","layer_group_opened","layer_visible","step","onCancel","Steps","previous","exclude_types","filtered_types","timeout","controller","AbortController","toptions","fetchTimeout","clearTimeout","DragSlot","deep","over","setOver","onDrop","stopPropagation","dataTransfer","getData","to","onDragOver","onDragLeave","onDragEnter","DraggableItem","_len","args","_key","onDragStart","draggable","legendCache","LegendArcGIS","legend_type","legend_label","legend","layerName","leg","contentType","imageData","verticalAlign","maxHeight","Legend","Node","detailsOpen","onZoomTheme","radioName","editNode","filtered","isGroup","nodeChildren","moveTheme","isOpen","isChecked","toggle","system","show_details","show_zoom_extent","onClickZoom","colSpan","exclusive","findAllParents","level","result2","findAllChildren","toc_action1","cookieAuthName","layer_data","_this$props$config","activate_parents","deactivate_children","open_children","update","layers_update_theme","openTheme","layers_remove_items","fromIndex","fromParent","toIndex","toParent","parentIndex","targetIndex","idIndex","_this$props$actions","transform_extent","target_proj","filterDone","filterRegEx","parents","viewer_save_http_loading","viewer_session_saved","session","viewer_save_http_error","viewer_session_load","reload","withHeading","_config$viewer$config","main","filterThemes","tree","tocActions","endDragging","is_session","date","loadSession","saveSession","show_filter","changeFilter","clearFilter","_auth$response2","_auth$response3","showRegistration","componentCfg","setMode","login_reset_password","_useForm","useForm","defaultLoginValues","errors","formState","getValues","setValue","handleSubmit","switchLoginMode","checkKeyDown","reset_password","post","login","getFormValidationErrorMessage","autoComplete","Controller","rules","fieldState","invalid","onKeyPress","toggleMask","user_registration","passwordStrengthLabels","weakLabel","mediumLabel","strongLabel","login_user_registration","_auth$response4","defaultValues","TERMS_OF_SERVICE_URL","terms_of_service_url","passwordFooter","Divider","lineHeight","register_user","pattern","promptLabel","USERLOGIN_SHOW","USERLOGIN_LOGIN","USERLOGIN_REGISTRATION","_record$config_json7","_record$config_json8","setShowRegistration","_core$pubsub","componentMessages","closable","_record$config_json5$","_record$config_json6$","registration","RegistrationWidget","tooltip_login","AUTH_HTTP_LOADING","AUTH_HTTP_ERROR","AUTH_CLEAR_ERROR","AUTH_RESPONSE","AUTH_LOGIN","PASSWORD_HTTP_LOADING","PASSWORD_HTTP_ERROR","PASSWORD_RESPONSE","REGISTRATION_HTTP_LOADING","REGISTRATION_HTTP_ERROR","REGISTRATION_RESPONSE","VIEWER_LOAD","VIEWER_LOAD_DONE","VIEWER_SAVE_HTTP_LOADING","VIEWER_SAVE_HTTP_ERROR","VIEWER_SAVE_RESPONSE","VIEWER_SESSION_LOAD","VIEWER_SESSION_SAVED","VIEWER_SET_CONFIG","VIEWER_LOAD_ERROR","VIEWER_NOT_FOUND","VIEWER_NOT_AUTHORIZED","VIEWER_LOAD_COMPONENTS","VIEWER_UNLOAD_COMPONENTS","VIEWER_SET_SELECTEDMENU","VIEWER_SET_FEATUREINFO","VIEWER_SET_GEOLOCATION","VIEWER_SET_DRAWINGS","VIEWER_SET_COORDINATES","MAP_SET_EXTENT","MAP_SET_SIZE","MAP_SET_CLASS","LAYERS_SET_CHECKED","LAYERS_SET_OPENED","LAYERS_UPDATE_THEME","LAYERS_REMOVE_ITEMS","VIEWER_SET_DISPLAYCRS","VIEWER_ADD_THEMES","VIEWER_REMOVE_THEMES","VIEWER_SET_CONFIGJSON","VIEWER_UPDATE_MAPCONTROL","VIEWER_SET_EXCUSIVE_MAPCONTROL","LAYOUT_WRAPPER_CLICK","LAYOUT_TOGGLE_OVERLAYMENU","LAYOUT_TOGGLE_STATICMENU","LAYOUT_TOGGLE_MOBILEMENU","CONFIG_URL","MAP_PROXY","cookieExpiresDays","save_options","login_http_loading","login_response","expireDate","setDate","getDate","expires","login_http_error","status","password_http_loading","password_reset_validation","valid_token","password_response","password_post","password_http_error","registration_http_loading","registration_post","registration_response","registration_http_error","registration_confirmation","registration_send_confirmation","viewer_set_geolocation","viewer_set_config","viewer_load_components","viewer_unload_components","unloadComponents","viewer_error","viewer_not_found","viewer_not_authorized","viewer_load_done","viewer_load","search","_config$user_info","_config$config_json2","setConfig","show_menu","component","addComponent","pitems","BASE_URL","isThemeOnScaleMapModel","map_set_size","map_set_class","parentId","viewer_remove_themes","viewer_set_configjson","layout_toggle_overlaymenu","layout_toggle_staticmenu","layout_toggle_mobilemenu","userAgent","topics","topic","fn","Core","initialReducers","reducers_list","combinedReducer","combineReducers","keysToRemove","_keysToRemove","reducer","new_reducer","reducer_func","defineProperty","createReducerManager","createStore","applyMiddleware","thunk","_i2","_Object$entries","_Object$entries$_i","__components","__mainmenu","__secureProps","prototype","local_components","core_components","omit","default","ReactComponent","renderMainMenu","PluginComponent","renderComponentById","_ref6$as","_ref7$as","_ref7$separator","_ref7$style","_ref7$className","renderComponentsLinks","_ref8$as","_ref8$separator","_ref8$style","_ref8$className","initialViewer","tlayers","mindex","configjson","ROOT_PATH","rootReducer","interactions","view","View","Map","createContext","_viewer$size","_viewer$size2","mainMapEl","setTarget","getResolutionForExtent","setCenter","onMoveEnd","closest","constrained_extent","min_zoom","max_zoom","max_resolution","min_resolution","min_zoom_authenticated","max_zoom_authenticated","max_resolution_authenticated","min_resolution_authenticated","viewOptions","getZoom","setView","map_style","getCRSCode","retVal","exec","lastIndexOf","parseBBOX","fromCRS","toCRS","parseInspireMetadata","MetadataUrl","MediaType","ResponseLanguage","Language","SupportedLanguages","DefaultLanguage","languages","SupportedLanguage","projOptions","coordsyss","label_long","labelx","labely","wfs","originUrl","wfsns","owsns","ns","SRS","DefaultSRS","LatLongBoundingBox","servertype","featurerns","featureprefix","faturetype","Capability","Request","GetMap","Format","tmformats","gmf","GetFeatureInfo","tformats","gfif","inspire_service_metadata","Inspire","createThemeFromLayer","array","Layer","Name","LegendURL","OnlineResource","finalUrl","DCPType","HTTP","Get","Service","EX_GeographicBoundingBox","findBBOX","BoundingBox","inspire_layer_metadata","MinScaleDenominator","MaxScaleDenominator","Title","Abstract","inspire_metadata","authkey","get_tile_format_preference","get_feature_info_format_preference","OperationsMetadata","GetTile","DCP","wmts_tilematrixsets","TileMatrixSetLink","gtf","get_feature_info_url","ResourceURL","resourceType","WGS84BoundingBox","supportedImageFormatTypes","fullExtent","spatialReference","wkid","proj4","_service$spatialRefer","sourceSpatialReference","layer_bbox","subLayers","get_feature_info_layers","child_layer","cl","raw","OlExtent","Document","doc","Folder","convertGML2Themes","createGroup","onMenuClick","overflowY","_useContext","componentsOrdered","setComponentsOrdered","MainMenuComponent","Layers","TileLayer","attributions","setAttributions","OLTileLayer","WMSLayer","proxy_requests","proxy_http_image_requests","imageTile","OLImageLayer","updateParams","WFSLayer","failure","bbox_crs","strategy","max_features","bboxStrategy","allStrategy","style_text_font","style_text_fill_color","style_text_stroke_color","style_text_stroke_width","style_text_value","style_objs","new_layer","getText","setText","changed","WMTSLayer","urls","u","new_url","setSource","VectorTileLayer","label_resolution","Text","label_font","label_field","toString","label_fill_color","label_stroke_color","offsetX","offsetY","ignoreProxy","point_shape","Circle","point_color","point_stroke_color","point_stroke_width","point_radius","fill_color","stroke_color","stroke_width","VectorTile","tilePixelRatio","tileGrid","createXYZ","maxZoom","MVT","OLVectorLayer","forEachFeature","GeoJSONLayer","formatOptions","KMLLayer","ArcGISMapLayer","get_feature_info_tolerance","GroupLayer","removeLayer","MorphLayer","LayerComponent","OSM","wmts_version","zformat","wmts_layer","get_tile_format","FooterLeft","FooterLeftComponent","FooterRight","FooterRightComponent","TopbarRight","TopbarRightComponent","MapControlsTopLeft","MapControlsTopLeftComponent","MapControlsTopRight","MapControlsTopRightComponent","MapControlsLeft","MapControlsLeftComponent","MapControlsBottomLeft","MapControlsBottomLeftComponent","MapControlsBottomRight","MapControlsBottomRightComponent","selectionLayerStyle","FeatureInfoUtils","serviceUrl","requestBuilder","data_crs","gmlt","WMSGetFeatureInfo","OlFormatEsriJSON","_parseFeatureInfo","buildFeatureInfoWMSUrl","buildFeatureInfoWMTSUrl","buildFeatureInfoWMTSXYZUrl","_x5","_x6","_parseArcGISFeatureInfo","_callee2","_context2","buildFeatureInfoArcGISUrl","getFeatureInfoEsriJSON","_x7","_x8","_x9","_x10","_x11","_x12","getFeatureInfoUrl","zoomIdx","tilegrid","getTileGrid","tileResolutions","getResolutions","diff","tileResolution","diffP","tileSize","getTileSize","tileSizeX","tileSizeY","tileOrigin","getOrigin","fx","fy","tileCol","tileRow","tileI","tileJ","matrixIds","getMatrixIds","getMatrixSet","tileMatix","mapSize","mapExtent","findActiveArcGISMapLayer","coordinatesStyle","selectedCoordinatesStyle","locationStyle","FeatureInfo","feature_info_component","setSearch","selectionLayer","pixel","acc","displayFeature","fvt_remote","layers_selected","forEachFeatureAtPixel","OlVectorTileLayer","fvt","cql_fields","allow_multi","fl","nativeCRS","replaceAll","getWFSFeaturesFilterByGeom","mapCRS","nativeBBOX","parseArcGISFeatureInfo","emptyResults","searchAll","coordinatesLayer","coordinatesSingleClick","setGeometry","olgeolocation","setOlgeolocation","locationLayer","getGeoLocation","getAccuracy","getAltitude","getAltitudeAccuracy","getHeading","getSpeed","saveGeoLocation","getCurrentPosition","longitude","latitude","setTracking","positionFeature","zoom_init","OLGeolocation","Attribution","controlLoaded","setControlLoaded","mobile","collapsed","collapsed_mobile","collapsible","collapsible_mobile","OLAttribution","initGA","trackingID","ReactGA","initialize","PageView","pageview","gaTrackingId","REACT_APP_GA_TRACKING_ID","rlayers","root_layers","MainMap","ctrl","OlControl","OlControls","URLSearchParams","url_redirect","emailConfirmation","setEmailConfirmation","goRedirect","setGoRedirect","foundRedirect","foundUrlRedirect","RegistrationConfirmationWidget","pwd","newPassword","confirmPassword","validate","maxWidth","PasswordWidget","defaultLogo","viewerLogo","onError","cookieValue","withCookies","cookiergpd","setCookiergpd","SplashScreen","CookieConsent","buttonText","onAccept","secure","httpOnly","extraCookieOptions","debug","cookieSecurity","disableStyles","App","base_url","StrictMode","Provider","Router","basename","RGPD","Switch","Route","PageLogin","PageRegistrationConfirmation","PagePassword","Page404","Page401","Viewer","Redirect","Boolean","ReactDOM","serviceWorker","ready","unregister"],"mappings":"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","file":"static/js/main.4ecebc79.chunk.js","sourcesContent":["function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(function() {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = function() { return []; };\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nmodule.exports = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = 1062;","function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(function() {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = function() { return []; };\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nmodule.exports = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = 1398;","import React from 'react';\r\n\r\nexport default function ThemeSelector(props) {\r\n  const { theme, children } = props;\r\n  \r\n  let Theme = null;\r\n\r\n  if (!theme || theme === 'default') {\r\n    Theme = React.lazy(() => import('../../themes/default/main'));\r\n  } else {\r\n    Theme = React.lazy(() => import('../../themes/' + theme + '/src/main'));\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <React.Suspense fallback={<></>}>\r\n        <Theme />\r\n      </React.Suspense>\r\n      {children}\r\n    </>\r\n  )\r\n}","import React, {Component} from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nexport class AppTopbar extends Component {\r\n\r\n    static defaultProps = {\r\n        onToggleMenu: null,\r\n        logo: null,\r\n        regionComponents: null\r\n    }\r\n\r\n    static propTypes = {\r\n        onToggleMenu: PropTypes.func.isRequired\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div className=\"layout-topbar clearfix\">\r\n                <button className=\"p-link layout-menu-button\" onClick={this.props.onToggleMenu}>\r\n                    <span className=\"pi pi-bars\"/>\r\n                </button>\r\n                {this.props.logo}\r\n                <div className=\"layout-topbar-icons topbar-right\">\r\n                    {this.props.regionComponents}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}","import { useEffect, useState, useRef } from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\n\r\nconst Portal = ({children}) => {\r\n  const el = document.createElement(\"div\");\r\n\r\n  const root = document.getElementById(\"portal-root\");\r\n\r\n  // this val and setVal is done to toggle render the portal area after\r\n  // portalDiv is updated\r\n  const [val, setVal] = useState(true);\r\n\r\n  const portalDiv = useRef(null);\r\n\r\n  // First useEffect to persist the div\r\n  useEffect(() => {\r\n    if ( !portalDiv.current) {\r\n        portalDiv.current = el\r\n        setVal(!val)\r\n    }\r\n  }, [portalDiv]);\r\n\r\n  useEffect(() => {\r\n    root.appendChild(portalDiv.current);\r\n    return () =>{\r\n      return root.removeChild(portalDiv.current)\r\n    }; // you are removing it\r\n  }, [portalDiv, root]);\r\n\r\n  if(portalDiv.current) {\r\n    return createPortal(children, portalDiv.current)\r\n  }\r\n\r\n  return null;\r\n  // In your case as the return happened first and found out the el\r\n};\r\n\r\nexport default Portal;","import React from 'react'\r\nimport { v4 as uuidv4 } from 'uuid'\r\nimport Portal from './components/Portal'\r\nimport OLGroupLayer from \"ol/layer/Group\"\r\nimport OlFormatGeoJSON from \"ol/format/GeoJSON\"\r\nimport OlStyleStyle from \"ol/style/Style\"\r\nimport OlStyleCircle from \"ol/style/Circle\"\r\nimport OlStyleFill from \"ol/style/Fill\"\r\nimport OlStyleStroke from \"ol/style/Stroke\"\r\nimport OlStyleText from \"ol/style/Text\"\r\nimport OlStyleRegularShape from \"ol/style/RegularShape\"\r\n\r\n\r\nconst _getAppRootPath = () => {\r\n  if (window?.SCALARGIS_ROOT_PATH !== '__SCALARGIS_ROOT_PATH__') {\r\n    return window?.SCALARGIS_ROOT_PATH || process.env.REACT_APP_ROOT_PATH || '';\r\n  } else {\r\n    return process.env.REACT_APP_ROOT_PATH || '';\r\n  }\r\n}\r\n\r\nconst _getAppBaseUrl = () => {\r\n  if (window?.SCALARGIS_ROOT_PATH_BASE_URL !== '__SCALARGIS_ROOT_PATH_BASE_URL__') {\r\n    return window?.SCALARGIS_ROOT_PATH_BASE_URL || process.env.REACT_APP_BASE_URL || '';\r\n  } else {\r\n    return process.env.REACT_APP_BASE_URL || '';\r\n  }\r\n}\r\n\r\nexport const mapStateToProps = state => {\r\n  if (!state) return;\r\n  const props = Object.entries(state).map(([k,v])=>v);\r\n  return Object.assign(...props);\r\n};\r\n\r\nexport function rememberUrl(cookies, type, url) {\r\n  const prefix = process.env.REACT_APP_COOKIE_PREFIX || 'sniguserurl';\r\n  const cookieName = prefix + type;\r\n  let urlhistory = cookies.get(cookieName) || [];\r\n  if (urlhistory.indexOf(url) === -1) urlhistory.push(url);\r\n  cookies.set(cookieName, urlhistory);\r\n}\r\n\r\nexport const  generateRGBA = () => {\r\n  const r = Math.floor(Math.random() * 255);\r\n  const g = Math.floor(Math.random() * 255);\r\n  const b = Math.floor(Math.random() * 255);\r\n  return [r, g, b, 1].join(',');\r\n}\r\n\r\nexport const removeUrlParam = (sourceURL, key) => {\r\n  let rtn = sourceURL.split(\"?\")[0],\r\n    param,\r\n    params_arr = [],\r\n    new_params = [],\r\n    queryString = (sourceURL.indexOf(\"?\") !== -1) ? sourceURL.split(\"?\")[1] : \"\";\r\n  if (queryString !== \"\") {\r\n    params_arr = queryString.split(\"&\");\r\n    for (var i = params_arr.length - 1; i >= 0; i -= 1) {\r\n      param = params_arr[i].split(\"=\")[0];\r\n      let regex = new RegExp(key, \"ig\");\r\n      if (!regex.test(param)) {\r\n        new_params.push(params_arr[i]);\r\n      }\r\n    }\r\n    rtn = rtn + \"?\" + new_params.join(\"&\");\r\n  }\r\n  return rtn;\r\n}\r\n\r\nexport const addUrlParam = (sourceURL, key, value) => {\r\n  let rtn = sourceURL.split(\"?\")[0],\r\n    params_arr = [],\r\n    queryString = (sourceURL.indexOf(\"?\") !== -1) ? sourceURL.split(\"?\")[1] : \"\";\r\n  if (queryString !== \"\") {\r\n    params_arr = queryString.split(\"&\");\r\n  }\r\n  params_arr.push(key + \"=\" + value);\r\n  rtn = rtn + \"?\" + params_arr.join(\"&\");\r\n  return rtn;\r\n}\r\n\r\nexport const getWindowSize = () => {\r\n  var w = window,\r\n  d = document,\r\n  e = d.documentElement,\r\n  g = d.getElementsByTagName('body')[0],\r\n  x = w.innerWidth || e.clientWidth || g.clientWidth,\r\n  y = w.innerHeight|| e.clientHeight|| g.clientHeight;\r\n  return [x, y];\r\n}\r\n\r\nexport const isDesktop = () => {\r\n  return window.innerWidth > 1024;\r\n}\r\n\r\nexport const isMobile = () => {\r\n  const wsize = getWindowSize();\r\n  const isMobile = wsize[0] <= 768;\r\n\r\n  return isMobile;\r\n}\r\n\r\nexport const isUrlAppOrigin = (url) => {\r\n  //Considers it is same origin if is relative path\r\n  if (url.indexOf('http') !== 0) return true;\r\n\r\n  //Check if is same origin\r\n  const url1 = new URL(window.location.href);\r\n  const url2 = new URL(url);\r\n  return (url1.origin === url2.origin);\r\n}\r\n\r\nexport const isUrlAppHostname = (url) => {\r\n  //Considers it is same origin if is relative path\r\n  if (url.indexOf('http') !== 0) return true;\r\n\r\n  //Check if is same origin\r\n  const url1 = new URL(window.location.href);\r\n  const url2 = new URL(url);\r\n  return (url1.hostname === url2.hostname);\r\n}\r\n\r\nexport const getAppRootPath = () => {\r\n  return _getAppRootPath();\r\n}\r\n\r\nexport const getAppBaseUrl = () => {\r\n  const root_path = _getAppRootPath();\r\n  let url = root_path + '';\r\n  if (_getAppBaseUrl()) {\r\n    url = root_path + _getAppBaseUrl();\r\n  }\r\n  if (!url.endsWith(\"/\")) {\r\n    url += '/';\r\n  }\r\n  return url;\r\n}\r\n\r\nexport const getAppClientUrl = () => {\r\n  const root_path = _getAppRootPath();\r\n  let url = root_path + '/static/viewer/';\r\n  if (process.env.REACT_APP_CLIENT_URL) {\r\n    url = root_path + process.env.REACT_APP_CLIENT_URL;\r\n  }\r\n  if (!url.endsWith(\"/\")) {\r\n    url += '/';\r\n  }\r\n  return url;\r\n}\r\n\r\nexport const getAppApiUrl = () => {\r\n  const root_path = _getAppRootPath();\r\n  let url = root_path + '/api';\r\n  if (process.env.REACT_APP_API_URL) {\r\n    url = root_path + process.env.REACT_APP_API_URL;\r\n  }\r\n  if (url.startsWith('//')) {\r\n    url = window.location.protocol + url;\r\n  }\r\n  if (!url.toLowerCase().startsWith('http')) {\r\n    url =  window.location.origin + url;\r\n  }\r\n  return url;\r\n}\r\n\r\nexport const getAppMapProxyUrl = () => {\r\n  const root_path = _getAppRootPath();\r\n  let url = root_path + '/map/proxy?url=';\r\n  if (process.env.REACT_APP_MAP_PROXY) {\r\n    url = root_path + process.env.REACT_APP_MAP_PROXY;\r\n  }\r\n  if (url.startsWith('//')) {\r\n    url = window.location.protocol + url;\r\n  }\r\n  if (!url.toLowerCase().startsWith('http')) {\r\n    url =  window.location.origin + url;\r\n  }\r\n  return url;\r\n}\r\n\r\nexport const getAppUploadUrl = () => {\r\n  const root_path = _getAppRootPath();\r\n  let url = '';\r\n  if (process.env.REACT_APP_UPLOAD_URL) {\r\n    url = root_path + process.env.REACT_APP_UPLOAD_URL;\r\n  }\r\n  if (url.startsWith('//')) {\r\n    url = window.location.protocol + url;\r\n  }\r\n  if (!url.toLowerCase().startsWith('http')) {\r\n    url =  window.location.origin + url;\r\n  }\r\n  return url;\r\n}\r\n\r\nexport const getViewerPublicUrl = (uuid) => {\r\n    const appUrl = new URL(window.location.href.toLowerCase());\r\n    let viewerPath = 'map/';\r\n    if (appUrl.pathname.startsWith(getAppBaseUrl())) {\r\n      let tmpPath = appUrl.pathname.substring(getAppBaseUrl().length);\r\n      if (tmpPath.indexOf('/') > -1) {\r\n        tmpPath = tmpPath.substring(0, tmpPath.indexOf('/'));\r\n        if (!tmpPath.endsWith(\"/\")) {\r\n          tmpPath += '/';\r\n        }\r\n        viewerPath = tmpPath;\r\n      }\r\n    }\r\n    return appUrl.origin + getAppBaseUrl() + viewerPath + uuid;\r\n}\r\n\r\nexport const getCookieAuthName = () => {\r\n  return process.env.REACT_APP_COOKIE_AUTH_NAME || 'scalargis_webgis';\r\n}\r\n\r\nexport function traverseOlLayers(collection, cb) {\r\n  collection.forEach(l => {\r\n    cb(l);\r\n    if (l instanceof OLGroupLayer) traverseOlLayers(l.getLayers(), cb);\r\n  })\r\n}\r\n  \r\nexport function findOlLayer(mainMap, id) {\r\n  let layer;\r\n  traverseOlLayers(mainMap.getLayers(), l => {\r\n    if (l.get('id') === id) layer = l;\r\n  });\r\n  return layer;\r\n}\r\n\r\nexport function findOLInteraction(map, classname) {\r\n  let result = false;\r\n  map.getInteractions().forEach(function(item) {\r\n    if (item instanceof classname) result = item;\r\n  });\r\n  return result;\r\n}\r\n  \r\nexport const serializeDrawing = (feature, state, crs) => {\r\n  const id = feature.getId() ? feature.getId() : uuidv4();\r\n  feature.setId(id);\r\n  feature.set('id', id);\r\n  let type = feature.getGeometry().getType();\r\n  if (state.draw_symbol) type = 'Symbol';\r\n  if (state.draw_text) type = 'Text';\r\n  feature.set('type', type);\r\n  feature.set('state', {\r\n    draw_geom: state.draw_geom,\r\n    draw_symbol: state.draw_symbol,\r\n    draw_text: state.draw_text,\r\n    fill: Object.assign({}, state.fill),\r\n    stroke: Object.assign({}, state.stroke),\r\n    size: state.size,\r\n    symbol_type: state.symbol_type,\r\n    text_style: state.text_style,\r\n    text_size: state.text_size,\r\n    text_font: state.text_font,\r\n    text_value: state.text_value\r\n  });\r\n  const serializer = new OlFormatGeoJSON();\r\n\r\n  // Export defaults to EPSG:3857\r\n  const serializeOptions = {\r\n    dataProjection: crs || 'EPSG:3857',\r\n    featureProjection: crs || 'EPSG:3857',\r\n    decimals: 6\r\n  }\r\n  const geojson = serializer.writeFeatureObject(feature, serializeOptions);\r\n  \r\n  // Hack: OL does not serialize with CRS attribute\r\n  const urn_crs = (crs || 'EPSG:3857').replace(':', '::');\r\n  geojson.crs = { \"type\": \"name\", \"properties\": { \"name\": \"urn:ogc:def:crs:\" + urn_crs } }\r\n  return geojson;\r\n}\r\n\r\nexport const createStyle = (feature, drawing, altStroke) => {\r\n  let { symbol_type, size, fill, stroke, text_style, text_size, text_font, text_value } = drawing;\r\n  stroke = altStroke ? altStroke : stroke;\r\n  let style = createDrawingStyle(feature.getGeometry().getType(), size, fill, stroke);\r\n  if (feature.get('type') === 'Symbol') {\r\n      style = createDrawingSymbol(symbol_type, size, fill, stroke);\r\n  }\r\n  if (feature.get('type') === 'Text') {\r\n      style = createDrawingText(feature, size, fill, stroke, text_style, text_size, text_font, text_value);\r\n  }\r\n  return style;\r\n}\r\n\r\nexport const deserializeDrawing = (drawing, crs) => {\r\n  const { draw_geom, draw_symbol, draw_text, symbol_type, size, fill, stroke, text_style, text_size, text_font, text_value } = drawing.properties.state;\r\n  const serializer = new OlFormatGeoJSON();\r\n\r\n  // Export defaults to EPSG:3857\r\n  const serializeOptions = {\r\n    dataProjection: crs || 'EPSG:3857',\r\n    featureProjection: crs || 'EPSG:3857',\r\n    decimals: 6\r\n  }\r\n  const feature = serializer.readFeature(drawing, serializeOptions);\r\n  let style = createStyle(feature, drawing.properties.state);\r\n  feature.setStyle(style);\r\n  feature.set('state', {\r\n    draw_geom,\r\n    draw_symbol,\r\n    draw_text,\r\n    fill: Object.assign({}, fill),\r\n    stroke: Object.assign({}, stroke),\r\n    size,\r\n    symbol_type,\r\n    text_style,\r\n    text_size,\r\n    text_font,\r\n    text_value\r\n  });\r\n  return feature;\r\n}\r\n  \r\nexport const createDrawingStyle = (type, size, fill, stroke) => {\r\n  const fillStr = `rgba(${ fill.r }, ${ fill.g }, ${ fill.b }, ${ fill.a })`;\r\n  const strokeStr = `rgba(${ stroke.r }, ${ stroke.g }, ${ stroke.b }, ${ stroke.a })`;\r\n  let style = new OlStyleStyle({\r\n    stroke: new OlStyleStroke({\r\n      color: strokeStr,\r\n      width: parseInt(10, 10)\r\n    }),\r\n    fill: new OlStyleFill({\r\n      color: fillStr\r\n    })\r\n  });\r\n  switch (type) {\r\n    case 'Point': \r\n      style = new OlStyleStyle({\r\n        image: new OlStyleCircle({\r\n          radius: parseInt(size, 10),\r\n          fill: new OlStyleFill({ color: fillStr }),\r\n          stroke: new OlStyleStroke({ color: strokeStr, width: 2 })\r\n        }),\r\n        stroke: new OlStyleStroke({\r\n          color: strokeStr,\r\n          lineDash: [4],\r\n          width: parseInt(size, 10)\r\n        }),\r\n        fill: new OlStyleFill({ color: fillStr})\r\n      });\r\n      break;\r\n    case 'LineString':\r\n      style = new OlStyleStyle({\r\n          stroke: new OlStyleStroke({ color: strokeStr, width: parseInt(size, 10) })\r\n      });\r\n      break;\r\n    case 'Polygon':\r\n      style = new OlStyleStyle({\r\n        stroke: new OlStyleStroke({\r\n          color: strokeStr,\r\n          lineDash: [4],\r\n          width: parseInt(size, 10)\r\n        }),\r\n        fill: new OlStyleFill({ color: fillStr})\r\n      });\r\n      break;\r\n    case 'Circle':\r\n      style = new OlStyleStyle({\r\n        stroke: new OlStyleStroke({\r\n          color: strokeStr,\r\n          width: parseInt(size, 10)\r\n        }),\r\n        fill: new OlStyleFill({\r\n          color: fillStr\r\n        })\r\n      });\r\n    break;\r\n    default: ;\r\n      break;\r\n  }\r\n  return style;\r\n}\r\n  \r\nexport const createDrawingText = (feature, size, fill, stroke, text_style, text_size, text_font, text_value) => {\r\n  const fillStr = `rgba(${ fill.r }, ${ fill.g }, ${ fill.b }, ${ fill.a })`;\r\n  const strokeStr = `rgba(${ stroke.r }, ${ stroke.g }, ${ stroke.b }, ${ stroke.a })`;\r\n  \r\n  let label = text_value;\r\n  let fontStr = [text_style, text_size, text_font].join(' ');\r\n\r\n  let style = new OlStyleStyle({\r\n    text: new OlStyleText({\r\n      font: fontStr,\r\n      textAlign: \"left\",\r\n      fill: new OlStyleFill({ color: fillStr }),\r\n      stroke: new OlStyleStroke({ \"color\": strokeStr, \"width\": parseInt(size, 10) }),\r\n      textBaseline: \"top\",\r\n      text: label\r\n    })\r\n  });\r\n  return style;\r\n}\r\n  \r\nexport const createDrawingSymbol = (type, size, fill, stroke) => {\r\n  const fillStr = `rgba(${ fill.r }, ${ fill.g }, ${ fill.b }, ${ fill.a })`;\r\n  const strokeStr = `rgba(${ stroke.r }, ${ stroke.g }, ${ stroke.b }, ${ stroke.a })`;\r\n  let style = null;\r\n  switch(type) {\r\n    case 'square':\r\n      style = new OlStyleStyle({\r\n        image: new OlStyleRegularShape({\r\n          fill: new OlStyleFill({ color: fillStr }),\r\n          stroke: new OlStyleStroke({ color: strokeStr, width: 2 }),\r\n          radius: parseInt(size, 10),\r\n          points: 4,\r\n          angle: Math.PI / 4\r\n        })\r\n      });\r\n      break;\r\n    case 'triangle': \r\n      style = new OlStyleStyle({\r\n        image: new OlStyleRegularShape({\r\n          fill: new OlStyleFill({ color: fillStr }),\r\n          stroke: new OlStyleStroke({ color: strokeStr, width: 2 }),\r\n          radius: parseInt(size, 10),\r\n          points: 3,\r\n          rotation: 0,\r\n          angle: 0\r\n        })\r\n      });\r\n      break;\r\n    case 'star': \r\n      style = new OlStyleStyle({\r\n        image: new OlStyleRegularShape({\r\n          fill: new OlStyleFill({ color: fillStr }),\r\n          stroke: new OlStyleStroke({ color: strokeStr, width: 2 }),\r\n          radius: parseInt(size, 10),\r\n          points: 5,\r\n          radius2: 4,\r\n          angle: 0\r\n        })\r\n      });\r\n      break;\r\n    case 'cross':\r\n      style = new OlStyleStyle({\r\n        image: new OlStyleRegularShape({\r\n          fill: new OlStyleFill({ color: fillStr }),\r\n          stroke: new OlStyleStroke({ color: strokeStr, width: 2 }),\r\n          radius: parseInt(size, 10),\r\n          points: 4,\r\n          radius2: 0,\r\n          angle: 0\r\n        })\r\n      });\r\n      break;\r\n    case 'circle':\r\n      style = new OlStyleStyle({\r\n        image: new OlStyleCircle({\r\n          fill: new OlStyleFill({ color: fillStr }),\r\n          stroke: new OlStyleStroke({ color: strokeStr, width: 2 }),\r\n          radius: parseInt(size, 10),\r\n        })\r\n      });\r\n      break;\r\n    case 'x':\r\n    default: \r\n      style = new OlStyleStyle({\r\n        image: new OlStyleRegularShape({\r\n          fill: new OlStyleFill({ color: fillStr }),\r\n          stroke: new OlStyleStroke({ color: strokeStr, width: 2 }),\r\n          points: 4,\r\n          radius: 10,\r\n          radius2: 0,\r\n          angle: Math.PI / 4\r\n        })\r\n      });\r\n  }\r\n  return style;\r\n}\r\n\r\nexport const showOnPortal = (children) => {\r\n  return <Portal>{children}</Portal>;\r\n}\r\n\r\nexport const traverseLayersTree = (layers, parent, cb) => {\r\n  let items = parent ? layers.filter(l => l.id === parent) : layers;\r\n  items.forEach((l, i) => {\r\n    if (l.children) {\r\n      l.children.forEach(cid => {\r\n        traverseLayersTree(layers, cid, cb);\r\n      });\r\n    }\r\n    cb(l, i, parent);\r\n  });\r\n};\r\n\r\nexport const isAdminOrManager = (auth) => {\r\n  let retVal = false;\r\n\r\n  const roles = auth?.data ? (auth.data.userroles || []) : (auth?.response?.userroles || []);\r\n\r\n  retVal = roles.map(s => s.toLowerCase()).filter(x => ['admin','manager'].includes(x)).length > 0;\r\n\r\n  return retVal;\r\n}\r\n","import { useEffect } from 'react';\r\n\r\nconst useScript = (url, async) => {\r\n  useEffect(() => {\r\n    const script = document.createElement('script');\r\n\r\n    script.src = url;\r\n    script.async = (typeof async === 'undefined' ? true : async );\r\n\r\n    document.body.appendChild(script);\r\n\r\n    return () => {\r\n      document.body.removeChild(script);\r\n    }\r\n  }, [url])\r\n}\r\n\r\nconst useScriptHmtl = (code) => {\r\n  useEffect(() => {\r\n    const script = document.createElement('script');\r\n\r\n    try {\r\n      script.appendChild(document.createTextNode(code));\r\n      document.body.appendChild(script);\r\n    } catch (e) {\r\n      script.text = code;\r\n      document.body.appendChild(script);\r\n    }    \r\n\r\n    return () => {\r\n      document.body.removeChild(script);\r\n    }\r\n  }, [code])  \r\n}\r\n\r\nexport default function Script({ src, async=true}) {\r\n  useScript(src, async);\r\n  return null;\r\n}\r\n\r\nexport function ScriptHtml({code}) {\r\n  useScriptHmtl(code)\r\n  return null;\r\n}","import { useEffect } from 'react';\r\n\r\nconst useStyle = (url, async) => {\r\n  useEffect(() => {\r\n    const elem = document.createElement('link');\r\n\r\n    elem.href = url;\r\n    elem.rel = 'stylesheet';\r\n    elem.type = 'text/css';\r\n    elem.async = (typeof async === 'undefined' ? true : async );\r\n\r\n    document.body.appendChild(elem);\r\n\r\n    return () => {\r\n      document.body.removeChild(elem);\r\n    }\r\n  }, [url])\r\n}\r\n\r\nconst useStyleHtml = (style) => {\r\n  useEffect(() => {\r\n    const elem = document.createElement('style');\r\n    elem.type = 'text/css';\r\n\r\n    try {\r\n      elem.appendChild(document.createTextNode(style));\r\n      document.body.appendChild(elem);\r\n    } catch (e) {\r\n      elem.text = style;\r\n      document.body.appendChild(elem);\r\n    }\r\n\r\n    return () => {\r\n      document.body.removeChild(elem);\r\n    }\r\n  }, [style])  \r\n}\r\n\r\nexport default function Style({ src, async=true}) {\r\n  useStyle(src, async);\r\n  return null;\r\n}\r\n\r\nexport function StyleHtml({style, onLoaded}) {\r\n  useStyleHtml(style);\r\n  if (onLoaded) onLoaded();\r\n  return null;\r\n}","import React from 'react'\r\nimport { withRouter } from 'react-router-dom'\r\nimport { ProgressBar } from 'primereact/progressbar';\r\n\r\n\r\nfunction LoadingScreen(props) {\r\n  return (\r\n    <div className=\"loadingscreen\">\r\n      <div>\r\n        <ProgressBar mode=\"indeterminate\" style={{ height: '6px' }}></ProgressBar>\r\n      </div>\r\n    </div>    \r\n  )\r\n}\r\n\r\nexport default withRouter(LoadingScreen);","import React,  {useState, useEffect} from 'react'\r\nimport classNames from 'classnames'\r\nimport {AppTopbar} from './AppTopbar'\r\nimport 'primereact/resources/primereact.min.css'\r\nimport 'primeicons/primeicons.css'\r\nimport 'primeflex/primeflex.css'\r\nimport { getWindowSize } from '../utils'\r\nimport Script, {ScriptHtml} from './Script'\r\nimport Style, {StyleHtml} from './Style'\r\nimport LoadingScreen from './LoadingScreen'\r\n\r\n\r\nfunction Layout(props) {\r\n\r\n  const {\r\n    core,\r\n    config,\r\n    viewer,\r\n    sidebar,\r\n    onWrapperClick,\r\n    onSidebarClick,\r\n    onToggleMenu\r\n  } = props;\r\n\t\r\n  const { CLIENT_URL } = core;\r\n\r\n  const [loaded, setLoaded] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (!config) return;\r\n    if (!config.custom_style) setLoaded(true);\r\n  }, [config]);\r\n\r\n  const copyrightYear = new Date().getFullYear();\r\n  const entityName = process.env.REACT_APP_ENTITY_NAME;\r\n  const entityUrl = process.env.REACT_APP_ENTITY_URL;\r\n\r\n  const wrapperClass = classNames('layout-wrapper', {\r\n    'layout-overlay': viewer.layoutMode === 'overlay',\r\n    'layout-static': viewer.layoutMode === 'static',\r\n    'layout-static-sidebar-inactive': viewer.staticMenuInactive && viewer.layoutMode === 'static',\r\n    'layout-overlay-sidebar-active': viewer.overlayMenuActive && viewer.layoutMode === 'overlay',\r\n    'layout-mobile-sidebar-active': viewer.mobileMenuActive\r\n  }, config?.config_json?.layout_class || config?.layout_class);\r\n\r\n  const sidebarClassName = classNames(\"layout-sidebar\", {\r\n    'layout-sidebar-dark': viewer.layoutColorMode === 'dark',\r\n    'layout-sidebar-light': viewer.layoutColorMode === 'light'\r\n  });\r\n\r\n  // Use window width for sidebar in mobile\r\n  const size = getWindowSize();\r\n\r\n  let logo = viewer.layoutColorMode === 'dark' ?\r\n    CLIENT_URL + 'assets/images/logo-light.png':\r\n    CLIENT_URL + 'assets/images/logo.png';\r\n\r\n  if (viewer.staticMenuInactive && viewer.layoutMode === 'static') {\r\n    logo = CLIENT_URL + 'assets/images/logo-light.png';\r\n  }\r\n\r\n  if (config && config.img_logo) {\r\n    logo = CLIENT_URL + config.img_logo;\r\n  }\r\n\r\n  let title_logo = null;\r\n\r\n  if (config && config.title_logo) {\r\n    title_logo = config.title_logo;\r\n  }\r\n  if (config && config.config_json && config.config_json.title_logo)  {\r\n    title_logo = config.config_json.title_logo;\r\n  }\r\n\r\n  const logoComponent = size[0] > 768 ? <div className=\"layout-logo\">\r\n      <img alt=\"Logo\" src={logo} />\r\n      { title_logo ?\r\n        <div dangerouslySetInnerHTML={{__html: title_logo }}></div> : null\r\n      }\r\n    </div> : null\r\n\r\n  return (\r\n    <div className={wrapperClass} onClick={onWrapperClick}>\r\n        { loaded && <AppTopbar onToggleMenu={onToggleMenu} logo={logoComponent} regionComponents={props.topbarRight} /> }\r\n\r\n        <div ref={(el) => sidebar.current = el} \r\n          className={sidebarClassName} \r\n          onClick={onSidebarClick}\r\n          style={{ width: viewer.mobileMenuActive && size[0] <= 768 ? size[0] : null }}\r\n          >\r\n            { viewer.mobileMenuActive &&\r\n            <div className=\"layout-logo\">\r\n                { title_logo ?\r\n                  <div dangerouslySetInnerHTML={{__html: title_logo }}></div> : null\r\n                }\r\n                <img alt=\"Logo\" src={logo} />\r\n            </div>\r\n            }\r\n\r\n            { props.mainMenu }\r\n\r\n        </div>\r\n\r\n        <div className=\"layout-main\">\r\n            { props.children }\r\n        </div>\r\n\r\n        { loaded && <div className=\"layout-footer\">\r\n            <div className=\"footer-left\">\r\n              { entityName && (\r\n                entityUrl ? \r\n                <span className=\"footer-text\">&copy; {copyrightYear} <a href={entityUrl} target=\"_blank\" rel=\"noopener noreferrer\">{entityName}</a></span>  \r\n                : <span className=\"footer-text\">&copy; {copyrightYear} {entityName}</span>\r\n              )}\r\n              <div>\r\n                { props.footerLeft }\r\n              </div>\r\n            </div>\r\n            <div className=\"footer-right\">\r\n                { props.footerRight }\r\n            </div>\r\n        </div> }\r\n\r\n        <div className=\"layout-mask\"></div>\r\n\r\n        { !loaded && <LoadingScreen /> }         \r\n\r\n        { (config && config.scripts) ? config.scripts.map((k, i) => <Script key={i} src={k} async={false} />) : null }\r\n        { (config && config.styles) ? config.styles.map((k, i) => <Style key={i} src={k} async={false} />) : null }\r\n        \r\n        { (config && config.custom_style) ? <StyleHtml style={config.custom_style} \r\n            onLoaded={()=>{setTimeout(()=>setLoaded(true), 500);}} /> : null }\r\n        { (config && config.custom_script) ? <ScriptHtml code={config.custom_script} /> : null }\r\n\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Layout;\r\n","import React, { useRef, useEffect, useState } from 'react'\r\nimport { connect } from 'react-redux';\r\nimport ThemeSelector from '../components/ThemeSelector'\r\nimport LayoutComponent from '../components/Layout'\r\nimport { mapStateToProps, isDesktop } from '../utils'\r\n\r\nfunction Layout(props) {\r\n\r\n  const { core, history, config, viewer, mainOlMap, layout_toggle_menu, layout_wrapper_click } = props;\r\n\r\n  const [activeTheme, setActiveTheme] = useState(null);\r\n\r\n  let sidebar = useRef(null);\r\n  let menuClick = useRef(false);\r\n\r\n  function addClass(element, className) {\r\n    if (element.classList) element.classList.add(className);\r\n    else element.className += ' ' + className;\r\n  }\r\n\r\n  function removeClass(element, className) {\r\n    if (element.classList) element.classList.remove(className);\r\n    else element.className = element.className.replace(new RegExp('(^|\\\\b)' + className.split(' ').join('|') + '(\\\\b|$)', 'gi'), ' ');\r\n  }\r\n\r\n  function onWrapperClick(event) {\r\n    if (!menuClick.current) layout_wrapper_click();\r\n    menuClick.current = false;\r\n  }\r\n\r\n  function onSidebarClick(event) {\r\n    menuClick.current = true;\r\n  }\r\n\r\n  function onToggleMenu(event) {\r\n    event.preventDefault();\r\n    menuClick.current = true;\r\n    layout_toggle_menu(isDesktop());\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (!config) return;\r\n\r\n    // Set Theme\r\n    let theme = process.env.REACT_APP_DEFAULT_THEME || 'default';\r\n    if (config && config.theme) {\r\n      theme = config.theme;\r\n    }\r\n    if (config && config.config_json && config.config_json.theme) {\r\n      theme = config.config_json.theme;\r\n    }\r\n    setActiveTheme(theme);\r\n\r\n    const { CLIENT_URL } = core;\r\n\r\n    // -- Override document properties --//\r\n    //Set Manifest\r\n    let manifest_url = CLIENT_URL + 'manifest.json';    \r\n    if (config.manifest_json) {\r\n      let manifest = encodeURIComponent(JSON.stringify(config.manifest_json));\r\n      manifest_url = \"data:application/manifest+json,\"+manifest;\r\n    }\r\n    let elem = document.querySelector(\"link[rel='manifest']\");\r\n    if (elem) {\r\n      elem.href = manifest_url;\r\n    } else {\r\n      elem = document.createElement('link'); \r\n      elem.setAttribute('rel', 'manifest'); \r\n      elem.setAttribute('href', manifest_url); \r\n      document.querySelector('head').appendChild(elem);\r\n    }\r\n\r\n    //Set document title\r\n    if (config.title) document.title = config.title;\r\n    \r\n    //Set document description\r\n    if (config.description) {\r\n      elem = document.querySelector(\"meta[name='description']\");\r\n      if (elem) elem.content = config.description; \r\n    }\r\n\r\n    //Set document keywords\r\n    if (config.keywords && config.keywords.length > 0) {\r\n      elem = document.querySelector(\"meta[name='keywords']\");      \r\n      if (elem) elem.content = config.keywords.join(', ');\r\n    }\r\n\r\n    //Set document icons\r\n    let icon_url = CLIENT_URL + 'assets/images/logo32.png';\r\n    if (config.img_icon) {\r\n      icon_url = CLIENT_URL + config.img_icon;\r\n    }\r\n    elem = document.querySelector(\"link[rel='shortcut icon']\");\r\n    if (!elem) elem = document.querySelector(\"link[rel='icon']\");\r\n    if (elem) {\r\n      elem.href = icon_url;\r\n    } else {\r\n      elem = document.createElement('link'); \r\n      elem.setAttribute('rel', 'shortcut icon'); \r\n      elem.setAttribute('href', icon_url); \r\n      document.querySelector('head').appendChild(elem);        \r\n    }\r\n\r\n    icon_url = CLIENT_URL + 'assets/images/logo192.png';\r\n    elem = document.querySelector(\"link[rel='apple-touch-icon']\");\r\n    if (elem) {\r\n      elem.href = icon_url;\r\n    } else {\r\n      elem = document.createElement('link'); \r\n      elem.setAttribute('rel', 'apple-touch-icon'); \r\n      elem.setAttribute('href', icon_url); \r\n      document.querySelector('head').appendChild(elem);      \r\n    }\r\n  }, [config]);   \r\n\r\n  useEffect(() => {\r\n      if (viewer.mobileMenuActive) addClass(document.body, 'body-overflow-hidden');\r\n      else removeClass(document.body, 'body-overflow-hidden');\r\n      setTimeout(() => {\r\n        if (mainOlMap) mainOlMap.updateSize(); // TODO: improve first map render check\r\n      }, 210);\r\n  }, [viewer]);\r\n\r\n  return (\r\n    <ThemeSelector theme={activeTheme}>\r\n      <LayoutComponent\r\n        { ...props }\r\n        sidebar={sidebar}\r\n        onWrapperClick={onWrapperClick}\r\n        onSidebarClick={onSidebarClick}\r\n        onToggleMenu={onToggleMenu}\r\n      />\r\n    </ThemeSelector>\r\n  )\r\n}\r\n\r\nexport default connect(state => {\r\n  const gstate = mapStateToProps(state);\r\n  return ({ config: gstate.config, viewer: gstate.viewer, auth: gstate.auth })\r\n})(Layout);\r\n","import OlCollection from \"ol/Collection\";\r\nimport OlGroup from \"ol/layer/Group\";\r\nimport OlLayerTile from \"ol/layer/Tile\";\r\nimport OlLayerImage from \"ol/layer/Image\";\r\nimport OlLayerVector from \"ol/layer/Vector\";\r\nimport OlSourceXYZ from \"ol/source/XYZ\";\r\nimport OlSourceOSM from \"ol/source/OSM\";\r\nimport OlSourceTileJSON from \"ol/source/TileJSON\";\r\nimport OlSourceBingMaps from \"ol/source/BingMaps\";\r\nimport OlSourceTileWMS from 'ol/source/TileWMS';\r\nimport OlSourceImageWMS from 'ol/source/ImageWMS';\r\nimport OlSourceTileArcGISRest from 'ol/source/TileArcGISRest';\r\nimport OlSourceImageArcGISRest from 'ol/source/ImageArcGISRest';\r\nimport OlSourceWMTS from 'ol/source/WMTS';\r\nimport OlSourceVector from \"ol/source/Vector\";\r\nimport OlWKT from \"ol/format/WKT\";\r\nimport OlFormatGeoJSON from \"ol/format/GeoJSON\";\r\nimport OlFormatGML from \"ol/format/GML\";\r\nimport OlFormatGML2 from \"ol/format/GML2\";\r\nimport OlFormatGML3 from \"ol/format/GML3\";\r\nimport OlFormatWFS from \"ol/format/WFS\";\r\nimport OlFormatKML from \"ol/format/KML\";\r\nimport OlStyleStyle from \"ol/style/Style\";\r\nimport OlStyleStroke from \"ol/style/Stroke\";\r\nimport OlStyleFill from \"ol/style/Fill\";\r\nimport OlStyleCircle from \"ol/style/Circle\";\r\nimport * as OlGeom from \"ol/geom\";\r\nimport * as OlProj from 'ol/proj';\r\nimport {register as proj4register } from 'ol/proj/proj4'\r\nimport Proj4 from 'proj4';\r\nimport OlProjection from 'ol/proj/Projection';\r\nimport {applyTransform} from 'ol/extent';\r\nimport xml2js from 'xml2js';\r\nimport { removeUrlParam } from '../utils';\r\nimport { listen } from \"ol/events\";\r\n\r\nlet loading = 0;\r\n// TODO: cache layer styles\r\n\r\n// Add projections\r\nexport const addProjections = (projections) => {\r\n  projections.map(i => {\r\n    if (!OlProj.get('EPSG:'+i.srid)) {\r\n      Proj4.defs('EPSG:'+i.srid, i.defs);\r\n      //This function should be called whenever changes are made to the proj4 registry,\r\n      //e.g. after calling proj4.defs(). Existing transforms will not be modified by this function.\r\n      proj4register(Proj4);\r\n      const newProj = OlProj.get('EPSG:'+i.srid);\r\n      const fromLonLat = OlProj.getTransform('EPSG:4326', newProj);\r\n      if (i.extent) {\r\n        const worldExtent = i.extent.split(' ').map(Number);\r\n        newProj.setWorldExtent(worldExtent);\r\n        const extent = applyTransform(worldExtent, fromLonLat, undefined, 8);\r\n        newProj.setExtent(extent);\r\n      }\r\n    }\r\n    return i;\r\n  });\r\n}\r\n\r\nconst INCHES_PER_UNIT = {\r\n  'm': 39.37,\r\n  'degrees': 4374754\r\n};\r\n\r\nconst DOTS_PER_INCH = 72;\r\n\r\nconst processVisibility = (layers, active = []) => {\r\n  if (!layers) return;\r\n  layers.forEach(layer => {\r\n    if (active.indexOf(layer.get(\"id\")) > -1 || layer.get('always_visible')) layer.setVisible(true);\r\n    else layer.setVisible(false);\r\n    if (layer instanceof OlGroup) {\r\n      processVisibility(layer.getLayers(), active);\r\n    }\r\n  });\r\n}\r\n\r\n/*\r\nconst traverseTree = (items, cb) => {\r\n  items = items || [];\r\n  items.map(child => {\r\n    cb(child);\r\n    traverseTree(child.children, cb);\r\n    return child;\r\n  });\r\n};\r\n*/\r\n\r\nconst traverseTree = (items, cb, parent = {}) => {\r\n  items = items || [];\r\n  items.map((child, i) => {\r\n    cb(child, i, items, parent);\r\n    traverseTree(child.children, cb, child);\r\n    return child;\r\n  });\r\n};\r\n\r\nconst processOpacity = (ollayers, layers) => {\r\n  if (!ollayers) return;\r\n  ollayers.forEach(layer => {\r\n    layers.forEach(item => {\r\n      if (item.id === layer.get(\"id\") && (typeof item.opacity !== 'undefined')) {\r\n        layer.setOpacity(item.opacity);\r\n        layer.setProperties(item);\r\n      }\r\n    });\r\n    if (layer instanceof OlGroup) {\r\n      processOpacity(layer.getLayers(), layers);\r\n    }\r\n  });\r\n}\r\n\r\nconst processRemoveThemes = (layers, ids) => {\r\n  if (!layers) return;\r\n  layers.forEach((layer, i) => {\r\n    if (layer && ids.includes(String(layer.get('id')))) layers.removeAt(i);\r\n    if (layer instanceof OlGroup) {\r\n      processRemoveThemes(layer.getLayers(), ids);\r\n    }\r\n  });\r\n}\r\n\r\nexport const getViewerSessionConfig = (viewer) => {\r\n  const newlayers = [];\r\n\r\n  viewer.config_json.layers.forEach((l) => {\r\n    if (!viewer.removed.includes(l.id) && l.id != 'featureinfo') {\r\n      let newl = {...l};\r\n      if (l.children) {\r\n        newl.children = l.children.slice();\r\n      }\r\n      newlayers.push(newl);\r\n    }\r\n  });\r\n\r\n  const layersIds = newlayers.map(l => l.id);\r\n  newlayers.forEach((l) => {\r\n    if (l.children) {\r\n      l.children = l.children.filter(id => layersIds.includes(id));\r\n    }\r\n  });\r\n\r\n  let newchecked = viewer.config_json.checked.filter(c => {\r\n    return !viewer.removed.includes(c); \r\n  });    \r\n  newchecked = newchecked.filter(c => {\r\n      return c != 'featureinfo';\r\n  });\r\n\r\n  return {\r\n    ...viewer.config_json,\r\n    layers: newlayers,\r\n    checked: newchecked\r\n  }  \r\n}\r\n\r\nexport const transformExtent = (sourceProj, targetProj, extent, fallback) => {\r\n  let re = Object.assign([], extent);\r\n  if (!isFinite(re[0])) re = fallback;\r\n  re = [parseFloat(re[0]), parseFloat(re[1]), parseFloat(re[2]), parseFloat(re[3])];\r\n  let sourceCrs = (String(sourceProj).indexOf(':') === -1 ? 'EPSG:' + sourceProj : sourceProj);\r\n  let targetCrs = (String(targetProj).indexOf(':') === -1 ? 'EPSG:' + targetProj : targetProj);\r\n  re = OlProj.transformExtent(re, sourceCrs, targetCrs);\r\n  return re;\r\n}\r\n\r\nexport const createStyle = (config) => {\r\n  const style_color = config.style_color ? `rgba(${config.style_color})` : 'rgba(255,255,255,0.7)';\r\n  const style_stroke_color = config.style_stroke_color ? `rgba(${config.style_stroke_color})` : 'rgba(37,150,190,1)';\r\n  const style_stroke_width = typeof config.style_stroke_width === 'undefined' ? 3 : Number(config.style_stroke_width);\r\n  const style_image_radius = typeof config.style_image_radius === 'undefined' ? 3 : Number(config.style_image_radius);\r\n\r\n  return new OlStyleStyle({\r\n    image: new OlStyleCircle({\r\n      radius: style_image_radius,\r\n      snapToPixel: false,\r\n      fill: new OlStyleFill({color: style_color }),\r\n      stroke: new OlStyleStroke({color: style_stroke_color, width: style_stroke_width })       \r\n    }),\r\n    fill: new OlStyleFill({color: style_color }),\r\n    stroke: new OlStyleStroke({\r\n      color: style_stroke_color,\r\n      width: style_stroke_width\r\n    })\r\n  });\r\n}\r\n\r\n\r\nconst createLayer = (config, map, all) => {\r\n  var layer;\r\n  if (!config) return;\r\n\r\n  // Default style\r\n  const defaultStyle = (feature) => {\r\n    let style_color = config.style_color ? `rgba(${config.style_color})` : 'black';\r\n    let style_stroke_color = config.style_stroke_color ? `rgba(${config.style_stroke_color})` : 'rgba(0, 0, 255, 1.0)';\r\n    let style_stroke_width = typeof config.style_stroke_width === 'undefined' ? 2 : Number(config.style_stroke_width);\r\n    let style_image_radius = typeof config.style_image_radius === 'undefined' ? 8 : Number(config.style_image_radius);\r\n\r\n    if (feature.ollayer) {\r\n      const layerProps = feature.ollayer.getProperties();\r\n      style_color = `rgba(${layerProps.style_color})`;\r\n    }\r\n    return new OlStyleStyle({\r\n      image: new OlStyleCircle({\r\n        radius: style_image_radius,\r\n        snapToPixel: false,\r\n        fill: new OlStyleFill({color: style_color }),\r\n        stroke: new OlStyleStroke({color: style_stroke_color, width: style_stroke_width })\r\n      }),\r\n      fill: new OlStyleFill({color: style_color }),\r\n      stroke: new OlStyleStroke({\r\n        color: style_stroke_color,\r\n        width: style_stroke_width\r\n      })\r\n    });\r\n  }\r\n\r\n  let crs = map.getView().getProjection().getCode();\r\n\r\n  switch (config.type) {\r\n\r\n    /**\r\n     * Generic XYZ layer type\r\n     */\r\n    case \"XYZ\":\r\n      layer = new OlLayerTile({\r\n        visible: config.active,\r\n        source: new OlSourceXYZ({\r\n            url: config.url\r\n        })\r\n      });\r\n      break;\r\n\r\n    /**\r\n     * WMTS XYZ layer type\r\n     */\r\n    case \"WMTSXYZ\":\r\n      layer = new OlLayerTile({\r\n        visible: config.active,\r\n        source: new OlSourceXYZ({\r\n            tileUrlFunction: function(coordinate) {\r\n              let wmts_url = config.url;\r\n              let z = ('0' + coordinate[0]).slice(-2);\r\n              wmts_url = wmts_url.replace('{z}', z);\r\n              wmts_url = wmts_url.replace('{x}', coordinate[1]);\r\n              wmts_url = wmts_url.replace('{y}', coordinate[2]);\r\n              return wmts_url;\r\n            }\r\n        })\r\n      });\r\n      break;\r\n\r\n    /**\r\n     * OSM layer type\r\n     */\r\n    case \"OSM\":\r\n      layer = new OlLayerTile({\r\n        visible: config.active,\r\n        source: new OlSourceOSM()\r\n      });\r\n      break;\r\n\r\n    /**\r\n     * Bing Maps layer type\r\n     */\r\n    case \"BING\":\r\n      layer = new OlLayerTile({\r\n        visible: config.active,\r\n        preload: Infinity,\r\n        source: new OlSourceBingMaps({\r\n          key:\r\n            \"AuwLFA-O1AcL74VKikVahe1-ERPMta838eby5eIXMswtCKNdsioHUpMrJFyj5c1g\",\r\n          imagerySet: \"AerialWithLabels\"\r\n        })\r\n      });\r\n      break;\r\n\r\n    /**\r\n     * TileJSON layer type\r\n     */\r\n    case \"TileJSON\":\r\n      layer = new OlLayerTile({\r\n        visible: config.active,\r\n        opacity: config.opacity ? config.opacity : 1,\r\n        source: new OlSourceTileJSON({\r\n          url: config.url\r\n        })\r\n      });\r\n      break;\r\n\r\n    /**\r\n     * WMS layer type\r\n     */\r\n    case \"WMS\":\r\n      let url = config.url;\r\n      url = removeUrlParam(url, 'service');\r\n      url = removeUrlParam(url, 'version');\r\n      url = removeUrlParam(url, 'request');\r\n\r\n      let sourceConfig = {\r\n        url: url,\r\n        hidpi: false,\r\n        //serverType: config.servertype,\r\n        //crossOrigin: 'anonymous',\r\n        //crossOrigin: null, // Quirks: some services does not work with this value\r\n        params: {\r\n          'LAYERS': config.layers,\r\n          'TILED': config.tiled,\r\n          'VERSION': config.version,\r\n          'FORMAT': config.get_map_format || config.format || 'image/jpeg',\r\n          'STYLES': config.wms_style || config.styles\r\n        }\r\n      };\r\n\r\n      // Check theme has map CRS      \r\n      if (config.crs_options && config.crs_options.indexOf(crs) === -1) {\r\n        if (config.crs_options.indexOf('EPSG:4326') != -1) {\r\n          sourceConfig['projection'] = 'EPSG:4326';\r\n        } else {\r\n          sourceConfig['projection'] = 'CRS:84';\r\n        }\r\n      }      \r\n\r\n      // Create layer\r\n      if (config.tiled) {\r\n        layer = new OlLayerTile({\r\n          visible: config.active,\r\n          opacity: config.opacity ? config.opacity : 1,\r\n          source: new OlSourceTileWMS(sourceConfig)\r\n        });\r\n      } else {\r\n        layer = new OlLayerImage({\r\n          visible: config.active,\r\n          opacity: config.opacity ? config.opacity : 1,\r\n          source: new OlSourceImageWMS(sourceConfig)\r\n        })\r\n      }\r\n\r\n      // Set legend URL\r\n      const legendUrl = createLegendUrl(config.url, config.wms_layers || config.layers, config.crs)\r\n      layer.set('legendURL', legendUrl);\r\n\r\n      break;\r\n\r\n    /**\r\n     * WMTS layer type\r\n     */\r\n    case \"WMTS\":\r\n     var wmts_options = OlSourceWMTS.optionsFromCapabilities(config.wmts_capabilities, {\r\n        layer: config.layer,\r\n        matrixSet: 'EPSG:3857'\r\n      });\r\n      \r\n      layer = new OlLayerTile({\r\n        visible: config.active,\r\n        opacity: config.opacity ? config.opacity : 1,\r\n        source: new OlSourceWMTS(wmts_options)\r\n      });\r\n\r\n      break;\r\n    /**\r\n     * WFS layer type\r\n     */\r\n    case \"WFS\":\r\n      let wfsFormatOptions = {\r\n        srsName: 'EPSG:' + config.crs,\r\n        dataProjection: 'EPSG:' + config.crs\r\n      };\r\n      let formatOutput = 'GML2';\r\n      let wfsformat = new OlFormatGML2(wfsFormatOptions);\r\n      let readFeaturesOptions = {\r\n        featureProjection: crs\r\n      }\r\n      let srsname = 'EPSG:' + config.crs\r\n      if (['2.0.0'].indexOf(config.version) > -1) {\r\n        wfsFormatOptions = {\r\n          srsName: 'EPSG:' + config.crs,\r\n          dataProjection: 'EPSG:' + config.crs\r\n        };\r\n        formatOutput = 'GML3';\r\n        wfsformat = new OlFormatWFS(wfsFormatOptions);\r\n        readFeaturesOptions = {\r\n          srsName: 'EPSG:' + config.crs,\r\n          dataProjection: 'EPSG:' + config.crs,\r\n          featureProjection: crs\r\n        }\r\n        srsname = \"urn:ogc:def:crs:EPSG::\" + config.crs\r\n      }\r\n      const vectorSource = new OlSourceVector({\r\n        loader: (extent) => {\r\n          let bbox = config.bbox.split(' ');\r\n          let url = config.url\r\n          url = url.replace(/&$/ig, '')\r\n          url = url + (url.indexOf('?') > -1 ? '' : '?')\r\n            + '&service=WFS&'\r\n            + 'version=' + config.version\r\n            + '&request=GetFeature'\r\n            + '&typename=' + encodeURIComponent(config.layers)\r\n            + '&outputFormat=' + formatOutput\r\n            + '&srsname=' + srsname\r\n            + '&bbox=' + bbox.join(',') + ',EPSG:'+config.crs;\r\n          const proxy = process.env.REACT_APP_PROXY_URL || '';\r\n          checkLoading('start');\r\n          fetch(proxy + url).then(res => res.text()).then(res => {\r\n            let features = [];\r\n            features = wfsformat.readFeatures(res, readFeaturesOptions);\r\n            features.forEach(f => f.ollayer = layer);\r\n            layer.getSource().addFeatures(features);\r\n            checkLoading('end');\r\n          })\r\n          .catch(error => {\r\n            console.log(error);\r\n            layer.getSource().removeLoadedExtent(extent);\r\n            checkLoading('end');\r\n          });\r\n        }\r\n      });\r\n      layer = new OlLayerVector({\r\n        visible: config.active,\r\n        source: vectorSource,\r\n        style: defaultStyle\r\n      });\r\n      break;\r\n\r\n    /**\r\n     * KML layer type\r\n     */\r\n    case 'KML':\r\n      layer = new OlLayerVector({\r\n        visible: config.active,\r\n        source: new OlSourceVector({\r\n          url: config.url,\r\n          format: new OlFormatKML({\r\n            extractStyles: false\r\n          })\r\n        }),\r\n        style: defaultStyle\r\n      });\r\n      break;\r\n\r\n    /**\r\n     * GeoJSON layer type\r\n     */\r\n    case \"GeoJSON\":\r\n      layer = new OlLayerVector({\r\n        visible: config.active,\r\n        source: new OlSourceVector({\r\n          url: config.url,\r\n          format: new OlFormatGeoJSON()\r\n        }),\r\n        style: defaultStyle\r\n      });\r\n      break;\r\n\r\n    /**\r\n     * GML layer type\r\n     */\r\n    case 'GML':\r\n      const gmlOptions = {\r\n        srsName: 'EPSG:3763',\r\n        defaultDataProjection: 'EPSG:3763'\r\n      }\r\n      layer = new OlLayerVector({\r\n        visible: config.active,\r\n        source: new OlSourceVector({\r\n          url: config.url,\r\n          format: new OlFormatGML2(gmlOptions)\r\n        }),\r\n        style: defaultStyle\r\n      });\r\n      break;\r\n\r\n    /**\r\n     * Group layer type\r\n     */\r\n    case \"GROUP\":\r\n      layer = new OlGroup({\r\n        visible: config.active\r\n      });\r\n      let children = new OlCollection();\r\n      if (Array.isArray(config.children)) {\r\n        let inverted = Object.assign([], all.filter(i => config.children.includes(i.id)));\r\n        inverted.reverse();\r\n        inverted.map(config2 => {\r\n          let sub = createLayer(config2, map, all);\r\n          children.push(sub);\r\n          return true;\r\n        });\r\n        layer.setLayers(children);\r\n      }\r\n      break;\r\n    default:;\r\n  }\r\n\r\n  // Add tile load observer but not for Group layers\r\n  if (!(layer instanceof OlGroup)) {\r\n    if (layer.getSource() instanceof OlSourceTileWMS || layer.getSource() instanceof OlSourceOSM) {\r\n      layer.getSource().on(\"tileloadstart\", () => {\r\n        checkLoading('start');\r\n      });\r\n      layer.getSource().on(\"tileloadend\", () => {\r\n        checkLoading('end');\r\n      });\r\n      layer.getSource().on(\"tileloaderror\", () => {\r\n        checkLoading('end');\r\n      });\r\n    }\r\n    if (layer.getSource() instanceof OlSourceImageWMS) {\r\n      layer.getSource().on(\"imageloadstart\", () => {\r\n        checkLoading('start');\r\n      });\r\n      layer.getSource().on(\"imageloadend\", () => {\r\n        checkLoading('end');\r\n      });\r\n      layer.getSource().on(\"imageloaderror\", () => {\r\n        checkLoading('end');\r\n      });\r\n    }\r\n  }\r\n\r\n  // Validate group properties - prop layers shouldn't be populated\r\n  if (layer instanceof OlGroup) delete config.layers;\r\n\r\n  // Add theme properties to layer\r\n  layer.setProperties(config, true);\r\n\r\n  if (config.max_scale && config.max_scale > 0) {\r\n    let maxres  = getResolutionForScale(config.max_scale, map.getView().getProjection().getUnits());\r\n    layer.setMaxResolution(maxres);\r\n  }\r\n  if (config.min_scale && config.min_scale > 0) {\r\n    let minres  = getResolutionForScale(config.min_scale, map.getView().getProjection().getUnits());\r\n    layer.setMinResolution(minres);\r\n  } \r\n\r\n  // Set layer visibility\r\n  layer.setVisible(!!config.active);\r\n\r\n  // Return created layer\r\n  return layer;\r\n}\r\n\r\nexport const zoomTheme = (theme, olmap = null) => {\r\n  let bbox = null;\r\n  let crs = olmap.getView().getProjection().getCode();\r\n  if (theme.crs !== crs && theme.bbox) {\r\n    bbox = transformExtent(\r\n      'EPSG:'+theme.crs,\r\n      crs,\r\n      theme.bbox.split(' ')\r\n    ).join(' ');\r\n  }\r\n  bbox = bbox.split(' ').map(c => parseFloat(c));\r\n  if (olmap) olmap.getView().fit(bbox, { nearest: true });\r\n}\r\n\r\nconst checkLoading = (signal) => {\r\n  //return; // TODO: fix bug when changing state here\r\n  const lastCount = loading;\r\n  if (signal === 'start') loading++;\r\n  if (signal === 'end') loading--;\r\n  loading = loading < 0 ? 0 : loading;\r\n  if (lastCount === 0 && loading > 0) {\r\n    //Store.set('map.loading', true);\r\n  }\r\n  if (lastCount > 0 && loading === 0) {\r\n    //Store.set('map.loading', false);\r\n  }\r\n}\r\n\r\nconst addBaseLayers = (olMap, layers) => {\r\n  var layer;\r\n  if (!olMap) return;\r\n  if (!layers) return;\r\n  layers.map(config => {\r\n    layer = createLayer(config, olMap);\r\n    olMap.addLayer(layer);\r\n    return layer;\r\n  });\r\n}\r\n\r\nconst addLayers = (olMap, layers) => {\r\n  var layer;\r\n  if (!olMap) return;\r\n  if (!layers) return;\r\n  const inverted = Object.assign([], layers);\r\n  inverted.reverse();\r\n  inverted.map(config => {\r\n    layer = createLayer(config, olMap, layers);\r\n    olMap.addLayer(layer);\r\n    return layer;\r\n  });\r\n}\r\n\r\nconst createLegendUrl = (url, layer, srs) => {\r\n    var finalurl = url;\r\n    finalurl += finalurl.indexOf('?') === -1 ? '?' : '';\r\n\r\n    //console.log('SRS=' + (srs.indexOf(':') === -1 ? 'EPSG:' + srs : srs));\r\n\r\n    return finalurl + '&' + ([\r\n        'SERVICE=WMS',\r\n        'VERSION=1.1.1',\r\n        'REQUEST=GetLegendGraphic',\r\n        'FORMAT=image%2Fpng',\r\n        'SRS=' + (srs.indexOf(':') === -1 ? 'EPSG:' + srs : srs),\r\n        'CRS=' + (srs.indexOf(':') === -1 ? 'EPSG:' + srs : srs),\r\n        'LAYER=' + layer\r\n    ].join('&'));\r\n};\r\n\r\nconst findActiveWMSLayer = (layers) => {\r\n  let result = [];\r\n  layers.forEach(l => {\r\n    if (l.getVisible() \r\n      && l.getSource \r\n      && (l.getSource() instanceof OlSourceTileWMS || l.getSource() instanceof OlSourceImageWMS)\r\n    ) {\r\n      result.push(l);\r\n    }\r\n    if ((l instanceof OlGroup) && l.getVisible()) {\r\n      let temp = findActiveWMSLayer(l.getLayers());\r\n      temp.forEach(t => result.push(t));\r\n    }\r\n  });\r\n  return result;\r\n}\r\n\r\nconst disableZoomExtent = () => {\r\n  //Store.set('map.zoomExtent', false);\r\n}\r\n\r\nconst updateBBOXCenter = (bbox, center = false) => {\r\n  //if (center) Store.update('display', { bbox, center });\r\n  //else Store.update('display', { bbox });\r\n}\r\n\r\nconst setFeatureInfo = (data) => {\r\n  //Store.set('map.featureInfo', data);\r\n}\r\n\r\nconst getFeatureInfo = () => {\r\n  //return Store.get('map.featureInfo');\r\n}\r\n\r\nconst toggleGetFeatureInfo = () => {\r\n  //const state = Store.get('map');\r\n  /*\r\n  Store.update('map', {\r\n    ...state,\r\n    getFeatureInfo: !state.getFeatureInfo,\r\n    featureInfo: []\r\n  });\r\n  */\r\n}\r\n\r\nconst toggleinteractionDragBox = (active) => {\r\n  //Store.set('map.zoomExtent', active);\r\n}\r\n\r\nconst getState = () => {\r\n  //return Store.get('map');\r\n}\r\n\r\nconst getFeatureInfoGeoJSON = (l, viewResolution, coordinate, resolve, reject) => {\r\n  const proxy = process.env.REACT_APP_PROXY_URL || process.env.REACT_APP_PUBLIC_URL;\r\n  const url = l.getSource().getGetFeatureInfoUrl(\r\n    coordinate,\r\n    viewResolution,\r\n    'EPSG:3857',\r\n    { 'INFO_FORMAT': 'application/geojson' }\r\n  );\r\n  fetch(proxy + url)\r\n  .then(res => res.json())\r\n  .then(geojson => {\r\n\r\n    // Parse JSON feature\r\n    const parser = new OlFormatGeoJSON();\r\n    const parseOptions = {\r\n      dataProjection: 'EPSG:3857',\r\n      featureProjection: 'EPSG:3857'\r\n    };\r\n    const features = parser.readFeatures(geojson, parseOptions);\r\n\r\n    // Found GeoJSON features\r\n    if (features.length) resolve(features[0]);\r\n    else reject();\r\n  })\r\n  .catch(err => {\r\n    reject();\r\n  })\r\n}\r\n\r\nconst getFeatureInfoJSON = (l, viewResolution, coordinate, resolve, reject) => {\r\n  const proxy = process.env.REACT_APP_PROXY_URL || process.env.REACT_APP_PUBLIC_URL;\r\n  const url = l.getSource().getGetFeatureInfoUrl(\r\n    coordinate,\r\n    viewResolution,\r\n    'EPSG:3857',\r\n    { 'INFO_FORMAT': 'application/json' }\r\n  );\r\n  fetch(proxy + url)\r\n  .then(res => res.json())\r\n  .then(json => {\r\n\r\n    // Parse JSON feature\r\n    const parser = new OlFormatGeoJSON();\r\n    const parseOptions = {\r\n      dataProjection: 'EPSG:3857',\r\n      featureProjection: 'EPSG:3857'\r\n    };\r\n    const features = parser.readFeatures(json, parseOptions);\r\n\r\n    // Found GeoJSON features\r\n    if (features.length) resolve(features[0]);\r\n    else reject();\r\n  })\r\n  .catch(err => {\r\n    reject();\r\n  })\r\n}\r\n\r\nconst getFeatureInfoXML = (l, viewResolution, coordinate, resolve, reject) => {\r\n  const proxy = process.env.REACT_APP_PROXY_URL || process.env.REACT_APP_PUBLIC_URL;\r\n  const url = l.getSource().getGetFeatureInfoUrl(\r\n    coordinate,\r\n    viewResolution,\r\n    'EPSG:3857',\r\n    { 'INFO_FORMAT': 'text/xml' }\r\n  );\r\n  fetch(proxy + url)\r\n  .then(res => res.text())\r\n  .then(xml => {\r\n\r\n    // Found features\r\n    let features = [];\r\n\r\n    // Try GML format (in some services)\r\n    let parser = new OlFormatGML();\r\n    let parseOptions = {\r\n      dataProjection: 'EPSG:3857',\r\n      featureProjection: 'EPSG:3857'\r\n    };\r\n    let gmlFeatures = parser.readFeatures(xml, parseOptions);\r\n    if (gmlFeatures && gmlFeatures.length) return resolve(gmlFeatures[0]);\r\n\r\n    // Load raw XML with field \"FeatureInfoResponse\"\r\n    xml2js.parseString(xml, (err, res) => {\r\n      if (err) return reject();\r\n\r\n      // Parse XML\r\n      if (res['FeatureInfoResponse']) {\r\n        res['FeatureInfoResponse']['FIELDS'].forEach(f => {\r\n          features.push(f['$']);\r\n        });\r\n      }\r\n\r\n      // Return features not found\r\n      if (!features.length) return reject();\r\n      resolve(features[0]);\r\n    });\r\n  })\r\n  .catch(err => {\r\n    reject();\r\n  });\r\n}\r\n\r\nconst getFeatureInfoGML = (l, viewResolution, coordinate, resolve, reject) => {\r\n  let layerProps = l.getProperties();\r\n  const proxy = process.env.REACT_APP_PROXY_URL || process.env.REACT_APP_PUBLIC_URL;\r\n  const url = l.getSource().getGetFeatureInfoUrl(\r\n    coordinate,\r\n    viewResolution,\r\n    'EPSG:3857',\r\n    { 'INFO_FORMAT': 'application/vnd.ogc.gml' }\r\n  );\r\n  fetch(proxy + url)\r\n  .then(res => res.text())\r\n  .then(gml => {\r\n\r\n    // Parse GML feature\r\n    let parser = new OlFormatGML();\r\n    let parseOptions = {\r\n      dataProjection: 'EPSG:3857',\r\n      featureProjection: 'EPSG:3857'\r\n    };\r\n    let features = parser.readFeatures(gml, parseOptions);\r\n\r\n    // Try parse with GML v2\r\n    if (!features.length) {\r\n      parser = new OlFormatGML2();\r\n      parseOptions = {\r\n        dataProjection: 'EPSG:3857',\r\n        featureProjection: 'EPSG:3857'\r\n      };\r\n      features = parser.readFeatures(gml, parseOptions);\r\n    }\r\n\r\n    // Try parse with GML v3\r\n    if (!features.length) {\r\n      parser = new OlFormatGML3();\r\n      parseOptions = {\r\n        dataProjection: 'EPSG:3857',\r\n        featureProjection: 'EPSG:3857',\r\n        featureType: layerProps.layers\r\n      };\r\n      features = parser.readFeatures(gml, parseOptions);\r\n    }\r\n\r\n    // Found GML features\r\n    if (features.length) resolve(features[0]);\r\n    else reject();\r\n  })\r\n  .catch(err => {\r\n    reject();\r\n  });\r\n}\r\n\r\nconst getFeatureInfoHtml = (l, viewResolution, coordinate, resolve, reject) => {\r\n  const proxy = process.env.REACT_APP_PROXY_URL || process.env.REACT_APP_PUBLIC_URL;\r\n  const url = l.getSource().getGetFeatureInfoUrl(\r\n    coordinate,\r\n    viewResolution,\r\n    'EPSG:3857',\r\n    { 'INFO_FORMAT': 'text/html' }\r\n  );\r\n  fetch(proxy + url)\r\n  .then(res => res.text())\r\n  .then(text => {\r\n    resolve(text);\r\n  })\r\n  .catch(err => {\r\n    reject();\r\n  });\r\n}\r\n\r\nconst getFeatureInfoText = (l, viewResolution, coordinate, resolve, reject) => {\r\n  const proxy = process.env.REACT_APP_PROXY_URL || process.env.REACT_APP_PUBLIC_URL;\r\n  const url = l.getSource().getGetFeatureInfoUrl(\r\n    coordinate,\r\n    viewResolution,\r\n    'EPSG:3857',\r\n    { 'INFO_FORMAT': 'text/plain' }\r\n  );\r\n  fetch(proxy + url)\r\n  .then(res => res.text())\r\n  .then(text => {\r\n    resolve(text);\r\n  })\r\n  .catch(err => {\r\n    reject();\r\n  });\r\n}\r\n\r\nconst parseFeatureInfo = async (l, viewResolution, coordinate, cb) => {\r\n  \r\n  const callFormat = (format) => {\r\n    return new Promise((resolve, reject) => {\r\n      if (/xml/ig.test(format)) {\r\n        getFeatureInfoXML(l, viewResolution, coordinate, resolve, reject);\r\n      }\r\n      else if (/gml/ig.test(format)) {\r\n        getFeatureInfoGML(l, viewResolution, coordinate, resolve, reject);\r\n      }\r\n      else if (/geojson/ig.test(format)) {\r\n        getFeatureInfoGeoJSON(l, viewResolution, coordinate, resolve, reject);\r\n      }\r\n      else if (/json/ig.test(format)) {\r\n        getFeatureInfoJSON(l, viewResolution, coordinate, resolve, reject);\r\n      }\r\n      else if (/html/ig.test(format)) {\r\n        getFeatureInfoHtml(l, viewResolution, coordinate, resolve, reject);\r\n      }\r\n      else if (/plain/ig.test(format)) {\r\n        getFeatureInfoText(l, viewResolution, coordinate, resolve, reject);\r\n      }\r\n      else reject();\r\n    });\r\n  }\r\n\r\n  // Start request\r\n  const layerProps = l.getProperties();\r\n  callFormat(layerProps.get_feature_info_format)\r\n  .then(result => {\r\n    cb(result);\r\n  })\r\n  .catch(err => {\r\n    cb(false);\r\n  });\r\n}\r\n\r\nexport const deserializeFeatures = (data) => {\r\n  const parser = new OlFormatGeoJSON();\r\n  const parseOptions = {\r\n    dataProjection: 'EPSG:3857',\r\n    featureProjection: 'EPSG:3857'\r\n  };\r\n  const features = parser.readFeatures(data, parseOptions);\r\n  return features;\r\n}\r\n\r\nexport const serializeFeatures = (features) => {\r\n  const parser = new OlFormatGeoJSON();\r\n  const parseOptions = {\r\n    dataProjection: 'EPSG:3857',\r\n    featureProjection: 'EPSG:3857'\r\n  };\r\n  const geojson = parser.writeFeatures(features, parseOptions);\r\n  return geojson;\r\n}\r\n\r\n/*\r\nconst parseFeatureInfoByTry = async (l, viewResolution, coordinate, cb) => {\r\n\r\n  const tryGeoJSON = () => {\r\n    return new Promise((resolve, reject) => {\r\n      getFeatureInfoGeoJSON(l, viewResolution, coordinate, resolve, reject);\r\n    });\r\n  }\r\n\r\n  const tryXML = () => {\r\n    return new Promise((resolve, reject) => {\r\n      getFeatureInfoXML(l, viewResolution, coordinate, resolve, reject);\r\n    });\r\n  }\r\n\r\n  const tryGML = () => {\r\n    return new Promise((resolve, reject) => {\r\n      getFeatureInfoGML(l, viewResolution, coordinate, resolve, reject); \r\n    });\r\n  }\r\n\r\n  const requests = {\r\n    tryGeoJSON,\r\n    tryGML,\r\n    tryXML\r\n  };\r\n\r\n  const tryNext = (index) => {\r\n    return new Promise((resolve, reject) => {\r\n      const keys = Object.keys(requests);\r\n      const fn = requests[keys[index]];\r\n      fn().then(resolve).catch(err => {\r\n        if (index+1 === keys.length) reject();\r\n        index++;\r\n        tryNext(index).then(resolve).catch(reject);\r\n      });\r\n    });\r\n  }\r\n\r\n  // Start HTTP requests\r\n  tryNext(0)\r\n  .then(feature => cb(feature))\r\n  .catch(err => cb(false))\r\n}\r\n*/\r\n\r\nexport const getResolutionForScale = (scale, units) => {\r\n  /*\r\n  const dpi = 90 * OlHas.DEVICE_PIXEL_RATIO;\r\n  const mpu = OlProj.METERS_PER_UNIT[units];\r\n  //const inchesPerMeter = 39.37;\r\n  return parseFloat(scale) / (mpu * dpi);\r\n  */\r\n  return parseFloat(scale) / (INCHES_PER_UNIT[units] * DOTS_PER_INCH)\r\n}\r\n\r\nexport const getScaleForResolution = (resolution, units) => {\r\n  const scale = INCHES_PER_UNIT[units] * DOTS_PER_INCH * resolution;\r\n  let value = Math.round(scale);\r\n  return value\r\n}\r\n\r\nexport const getCurrentScale = (map) => {\r\n    /*\r\n    const view = map.getView(); ;\r\n    const resolution = view.getResolution();\r\n    const units = map.getView().getProjection().getUnits();\r\n    const dpi = 25.4 / 0.28;\r\n    const mpu = OlProj.METERS_PER_UNIT[units];\r\n    let scale = resolution * mpu * 39.37 * dpi;\r\n    return scale;\r\n    */\r\n    const view = map.getView(); ;\r\n    const resolution = view.getResolution();\r\n    const units = map.getView().getProjection().getUnits();   \r\n    let value = getScaleForResolution(resolution, units);\r\n    return value;\r\n}\r\n\r\nexport const isThemeOnScale = (olmap, theme) => {\r\n  let onScale = true;\r\n  const mapResolution = olmap.getView().getResolution();\r\n  if (theme.source_max_scale) {\r\n    const themeMaxResolution = getResolutionForScale(theme.source_max_scale, olmap.getView().getProjection().getUnits());\r\n    onScale = onScale && (mapResolution <= themeMaxResolution);\r\n  }\r\n  if (theme.source_min_scale) {\r\n    const themeMinResolution = getResolutionForScale(theme.source_min_scale,  olmap.getView().getProjection().getUnits());\r\n    onScale = onScale && (mapResolution >= themeMinResolution);\r\n  }\r\n  if (theme.max_scale) {\r\n    const layerMaxResolution = getResolutionForScale(theme.max_scale,  olmap.getView().getProjection().getUnits());\r\n    onScale = onScale && (mapResolution <= layerMaxResolution);\r\n  }\r\n  if (theme.min_scale) {\r\n    const layerMinResolution = getResolutionForScale(theme.min_scale,  olmap.getView().getProjection().getUnits());\r\n    onScale = onScale && (mapResolution >= layerMinResolution);\r\n  }\r\n  return onScale;\r\n}\r\n\r\nexport const getThemeLegendUrl = (theme) => {\r\n  let url = theme.legend_url;\r\n  let style = theme.wms_style;\r\n  if (style) {\r\n    if (/style=/i.test(url)) url = url.replace(/style=(.*)&?/i, 'style=' + style + '&');\r\n    else url += '&style=' + style;\r\n  }\r\n  return url;\r\n}\r\n\r\nexport const getProjectionSrid = (proj) => {\r\n  const code = (typeof proj === 'object' && proj !== null) ? proj.getCode() : proj;\r\n  const srid = code.split(':')[1];\r\n  return parseInt(srid);\r\n}\r\n\r\nexport const getPolygonFromExtent = (extent, separator) => {\r\n  let v = extent;\r\n\r\n  if (typeof extent === 'string') {\r\n      v = extent.split(separator || \" \");\r\n  }\r\n\r\n  const coords = [\r\n      [parseFloat(v[0]), parseFloat(v[3])],\r\n      [parseFloat(v[2]), parseFloat(v[3])],\r\n      [parseFloat(v[2]), parseFloat(v[1])],\r\n      [parseFloat(v[0]), parseFloat(v[1])],\r\n      [parseFloat(v[0]), parseFloat(v[3])]\r\n  ];\r\n\r\n  let poly = new OlGeom.Polygon(new Array(coords));\r\n\r\n  return poly;\r\n};\r\n\r\nexport const getWKTFromGeometry = function (geom) {\r\n  const format = new OlWKT();\r\n\r\n  let wkt = format.writeGeometry(geom);\r\n\r\n  return wkt;\r\n};\r\n\r\nexport const getGeometryFromWKT = function (wkt, options) {\r\n  const format = new OlWKT();\r\n\r\n  let geom = options ? format.readGeometry(wkt, options) : format.readGeometry(wkt);\r\n\r\n  return geom;\r\n};\r\n\r\nexport const getWMSVisibleLayers = function (map, scale) {\r\n  const vlayers = [];\r\n\r\n  const _getLayers = function (layer, list) {\r\n      if (layer.getVisible()) {\r\n          if (layer instanceof OlGroup) {\r\n              const lls = layer.getLayers().getArray();\r\n              for (let i=0; i<lls.length; i++) {\r\n                  _getLayers(lls[i], list);\r\n              }\r\n          } else {\r\n              const source = layer.getSource();\r\n              if (source instanceof OlSourceTileWMS || source instanceof OlSourceImageWMS) {\r\n                  let url = '';\r\n\r\n                  if (source.getUrl) {\r\n                      url = source.getUrl();\r\n                  } else {\r\n                      url = source.getUrls()[0];\r\n                  }\r\n\r\n                  const params = {};\r\n                  const p = source.getParams()\r\n                  for (let key in p) {\r\n                      params[key] = p[key];\r\n                  }\r\n\r\n                  const ldata = {\r\n                      'url': url,\r\n                      'params': params,\r\n                      'opacity': layer.getOpacity(),\r\n                      'minScale': 0,\r\n                      'maxScale': 0\r\n                  };\r\n\r\n                  if (layer.getMaxResolution && layer.getMaxResolution() > 0) {\r\n                      ldata['minScale'] = getScaleForResolution(layer.getMaxResolution(), map.getView().getProjection().getUnits());\r\n                  }\r\n                  if (layer.getMinResolution && layer.getMinResolution() > 0) {\r\n                      ldata['maxScale'] = getScaleForResolution(layer.getMinResolution(), map.getView().getProjection().getUnits());\r\n                  }\r\n\r\n                  list.push(ldata);\r\n              } else if (layer.get('print')) {\r\n                const print = layer.get('print').length ? layer.get('print') : [layer.get('print')];\r\n\r\n                print.forEach(pitem => {\r\n                  if (pitem.type === 'wms') {\r\n                    const params = {};\r\n                    params['FORMAT'] = pitem.format || 'image/png';\r\n                    if (pitem.layers) params['LAYERS'] = pitem.layers;\r\n                    params['STYLES'] = pitem.styles || '';\r\n                    params['VERSION'] = pitem.version || '1.3.0';\r\n                    if (pitem.cql_filter) params['CQL_FILTER'] = pitem.cql_filter;\r\n\r\n                    const ldata = {\r\n                      'url': pitem.url,\r\n                      'params': params,\r\n                      'opacity': layer.getOpacity(),\r\n                      'minScale': 0,\r\n                      'maxScale': 0\r\n                    };\r\n\r\n                    if (layer.getMaxResolution && layer.getMaxResolution() > 0) {\r\n                      ldata['minScale'] = getScaleForResolution(layer.getMaxResolution(), map.getView().getProjection().getUnits());\r\n                    }\r\n                    if (pitem.maxResolution && pitem.maxResolution > 0) {\r\n                      ldata['minScale'] = getScaleForResolution(pitem.maxResolution, map.getView().getProjection().getUnits());\r\n                    }\r\n                    if (pitem.minScale && pitem.minScale > 0) {\r\n                      ldata['minScale'] = pitem.minScale;\r\n                    }\r\n\r\n                    if (layer.getMinResolution && layer.getMinResolution() > 0) {\r\n                        ldata['maxScale'] = getScaleForResolution(layer.getMinResolution(), map.getView().getProjection().getUnits());\r\n                    }\r\n                    if (pitem.minResolution && pitem.minResolution > 0) {\r\n                      ldata['maxScale'] = getScaleForResolution(pitem.minResolution, map.getView().getProjection().getUnits());\r\n                    }\r\n                    if (pitem.maxScale && pitem.maxScale > 0) {\r\n                      ldata['maxScale'] = pitem.maxScale;\r\n                    }\r\n\r\n                    list.push(ldata);\r\n                  }\r\n                });\r\n              }\r\n          }\r\n      }\r\n  }\r\n\r\n  const rootLayers = map.getLayers().getArray();\r\n  for (let i=0; i<rootLayers.length; i++) {\r\n      _getLayers(rootLayers[i], vlayers);\r\n  }\r\n\r\n  return vlayers;    \r\n};\r\n\r\nexport const getArcGISVisibleLayers = function (map, scale) {\r\n  const vlayers = [];\r\n\r\n  const _getLayers = function (layer, list) {\r\n      if (layer.getVisible()) {\r\n          if (layer instanceof OlGroup) {\r\n              const lls = layer.getLayers().getArray();\r\n              for (let i=0; i<lls.length; i++) {\r\n                  _getLayers(lls[i], list);\r\n              }\r\n          } else {\r\n              const source = layer.getSource();\r\n              if (source instanceof OlSourceTileArcGISRest || source instanceof OlSourceImageArcGISRest) {\r\n                  let url = '';\r\n\r\n                  if (source.getUrl) {\r\n                      url = source.getUrl();\r\n                  } else {\r\n                      url = source.getUrls()[0];\r\n                  }\r\n\r\n                  const params = {};\r\n                  const p = source.getParams()\r\n                  for (let key in p) {\r\n                      params[key] = p[key];\r\n                  }\r\n\r\n                  const ldata = {\r\n                      'url': url,\r\n                      'params': params,\r\n                      'opacity': layer.getOpacity(),\r\n                      'minScale': 0,\r\n                      'maxScale': 0\r\n                  };\r\n\r\n                  if (layer.getMaxResolution && layer.getMaxResolution() > 0) {\r\n                      ldata['minScale'] = getScaleForResolution(layer.getMaxResolution(), map.getView().getProjection().getUnits());\r\n                  }\r\n                  if (layer.getMinResolution && layer.getMinResolution() > 0) {\r\n                      ldata['maxScale'] = getScaleForResolution(layer.getMinResolution(), map.getView().getProjection().getUnits());\r\n                  }\r\n\r\n                  list.push(ldata);\r\n              } else if (layer.get('print')) {\r\n                const print = layer.get('print').length ? layer.get('print') : [layer.get('print')];\r\n\r\n                print.forEach(pitem => {\r\n                  if (pitem.type === 'ArcGIS') {\r\n                    const params = {};\r\n                    params['FORMAT'] = pitem.format || 'image/png';\r\n                    if (pitem.layers) params['LAYERS'] = pitem.layers;\r\n                    params['STYLES'] = pitem.styles || '';\r\n                    params['VERSION'] = pitem.version || '1.3.0';\r\n                    if (pitem.cql_filter) params['CQL_FILTER'] = pitem.cql_filter;\r\n\r\n                    const ldata = {\r\n                      'url': pitem.url,\r\n                      'params': params,\r\n                      'opacity': layer.getOpacity(),\r\n                      'minScale': 0,\r\n                      'maxScale': 0\r\n                    };\r\n\r\n                    if (layer.getMaxResolution && layer.getMaxResolution() > 0) {\r\n                      ldata['minScale'] = getScaleForResolution(layer.getMaxResolution(), map.getView().getProjection().getUnits());\r\n                    }\r\n                    if (pitem.maxResolution && pitem.maxResolution > 0) {\r\n                      ldata['minScale'] = getScaleForResolution(pitem.maxResolution, map.getView().getProjection().getUnits());\r\n                    }\r\n                    if (pitem.minScale && pitem.minScale > 0) {\r\n                      ldata['minScale'] = pitem.minScale;\r\n                    }\r\n\r\n                    if (layer.getMinResolution && layer.getMinResolution() > 0) {\r\n                        ldata['maxScale'] = getScaleForResolution(layer.getMinResolution(), map.getView().getProjection().getUnits());\r\n                    }\r\n                    if (pitem.minResolution && pitem.minResolution > 0) {\r\n                      ldata['maxScale'] = getScaleForResolution(pitem.minResolution, map.getView().getProjection().getUnits());\r\n                    }\r\n                    if (pitem.maxScale && pitem.maxScale > 0) {\r\n                      ldata['maxScale'] = pitem.maxScale;\r\n                    }\r\n\r\n                    list.push(ldata);\r\n                  }\r\n                });\r\n              }\r\n          }\r\n      }\r\n  }\r\n\r\n  const rootLayers = map.getLayers().getArray();\r\n  for (let i=0; i<rootLayers.length; i++) {\r\n      _getLayers(rootLayers[i], vlayers);\r\n  }\r\n\r\n  return vlayers;    \r\n};\r\n\r\nexport default {\r\n  processVisibility,\r\n  traverseTree,\r\n  processOpacity,\r\n  processRemoveThemes,\r\n  getViewerSessionConfig,\r\n  transformExtent,\r\n  createStyle,\r\n  createLayer,\r\n  checkLoading,\r\n  addBaseLayers,\r\n  addLayers,\r\n  createLegendUrl,\r\n  toggleinteractionDragBox,\r\n  findActiveWMSLayer,\r\n  toggleGetFeatureInfo,\r\n  disableZoomExtent,\r\n  updateBBOXCenter,\r\n  setFeatureInfo,\r\n  getFeatureInfo,\r\n  getState,\r\n  zoomTheme,\r\n  parseFeatureInfo,\r\n  getResolutionForScale,\r\n  getScaleForResolution,\r\n  getCurrentScale,\r\n  getThemeLegendUrl,\r\n  serializeFeatures,\r\n  deserializeFeatures,\r\n  getProjectionSrid,\r\n  getPolygonFromExtent,\r\n  getWKTFromGeometry,\r\n  getGeometryFromWKT,\r\n  getWMSVisibleLayers,\r\n  getArcGISVisibleLayers\r\n}\r\n","import React, { useContext, useState } from 'react'\r\nimport Cookies from 'universal-cookie'\r\nimport { InputText } from 'primereact/inputtext'\r\nimport { InputTextarea } from 'primereact/inputtextarea'\r\nimport { Button } from 'primereact/button'\r\nimport { connect, useDispatch } from 'react-redux'\r\nimport AppContext from '../../AppContext'\r\nimport { Message } from 'primereact/message'\r\nimport { InputSwitch } from 'primereact/inputswitch'\r\nimport { Dialog } from 'primereact/dialog'\r\nimport { getWindowSize, showOnPortal, getViewerPublicUrl } from '../utils'\r\nimport { getViewerSessionConfig } from '../model/MapModel'\r\n\r\nconst cookies = new Cookies();\r\n\r\nfunction ShareViewerWidget({ viewer, record }) {\r\n  const [showForm, setShowForm] = useState(false);\r\n  const [id, setId] = useState(null);\r\n  const [name, setName] = useState('');\r\n  const [title, setTitle] = useState('');\r\n  const [description, setDescription] = useState('');\r\n  const [slug, setSlug] = useState('');\r\n  const [allow_add_layers, setAllowAddLayers] = useState(true);\r\n  const [allow_user_session, setAllowUserSession] = useState(false);\r\n  const [allow_anonymous, setAllowAnonymous] = useState(true);\r\n\r\n  const wsize = getWindowSize();\r\n  const isMobile = wsize[0] <= 768;\r\n  \r\n  // Enable redux actions\r\n  const dispatch = useDispatch();\r\n  const { core } = useContext(AppContext);\r\n  const { viewer_save_record, viewer_save_response } = core.actions;\r\n\r\n  const cookieData = cookies.get(core.COOKIE_AUTH_NAME);\r\n\r\n  let allow_sharing = true;\r\n  if (viewer?.allow_sharing === false) {\r\n    allow_sharing = false;\r\n  };\r\n  if (viewer?.config_json?.allow_sharing === false) {\r\n    allow_sharing = false;\r\n  } else if (viewer?.config_json?.allow_sharing === true) {\r\n    allow_sharing = true;\r\n  }\r\n\r\n  function openForm() {\r\n    dispatch(viewer_save_response(null));\r\n    setId(null);\r\n    setName(null);\r\n    setTitle(viewer.title);\r\n    setDescription(viewer.description);\r\n    setSlug(null);\r\n    if (record?.config_json?.allow_add_layers === false) {\r\n      setAllowAddLayers(false);\r\n    }\r\n    if (cookieData) {\r\n      let anonymous = viewer.allow_anonymous == null ? true : viewer.allow_anonymous;\r\n      if (record?.config_json?.allow_anonymous === false) {\r\n        anonymous = false;\r\n      }\r\n      setAllowAnonymous(anonymous);\r\n    } else {\r\n      setAllowAnonymous(true);\r\n    }\r\n    if (record?.config_json?.allow_user_session === true) {\r\n      setAllowUserSession(true);\r\n    }\r\n    setShowForm(true);\r\n  }\r\n\r\n  function submit(e) {\r\n    e.preventDefault();\r\n\r\n    if (!title || title.length===0) {\r\n      return false;\r\n    }\r\n\r\n    //Get current session viewer config\r\n    const newconfig = getViewerSessionConfig(viewer);\r\n\r\n    let record = {\r\n      id,\r\n      name,\r\n      title,\r\n      description,\r\n      slug,\r\n      allow_add_layers,\r\n      allow_user_session,\r\n      allow_anonymous,\r\n      config_json: JSON.stringify(newconfig),\r\n      parent_id: viewer.id\r\n    }\r\n    dispatch(viewer_save_record(record, null, null))\r\n  }\r\n\r\n  const copyToClipboard = str => {\r\n    const el = document.createElement('textarea');\r\n    el.value = str;\r\n    el.setAttribute('readonly', '');\r\n    el.style.position = 'absolute';\r\n    el.style.left = '-9999px';\r\n    document.body.appendChild(el);\r\n    el.select();\r\n    document.execCommand('copy');\r\n    document.body.removeChild(el);\r\n    return false;\r\n  };\r\n\r\n  return (\r\n    allow_sharing ? <React.Fragment>\r\n      <button className=\"p-link\" onClick={e => openForm()} title=\"Partilhar mapa\">\r\n        <span className=\"layout-topbar-item-text\">Partilhar</span>\r\n        <span className=\"layout-topbar-icon pi pi-share-alt\"/>\r\n      </button>\r\n\r\n      {showOnPortal(<Dialog\r\n        header=\"Partilhar Mapa\"\r\n        visible={showForm}\r\n        style={{width: isMobile ? '90%' : '35vw' }} \r\n        modal \r\n        onHide={e => setShowForm(false)}>\r\n\r\n          <form onSubmit={e => submit()}>\r\n            <div className=\"p-fluid\">\r\n              <div className=\"p-field p-grid\">\r\n                <label className=\"p-col-12 p-md-4\">Título</label>\r\n                <div className=\"p-col-12 p-md-8\">\r\n                  <InputText\r\n                    className={(!title || title.length === 0 ? 'p-invalid' : '')}\r\n                    value={title}\r\n                    placeholder=\"Título\"\r\n                    onChange={e => setTitle(e.target.value)}\r\n                  />\r\n                  { (!title || title.length == 0) &&\r\n                  <small className=\"p-invalid p-d-block\">Campo de preenchimento obrigatório</small> }\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"p-field p-grid\">\r\n                <label className=\"p-col-12 p-md-4\">Descrição</label>\r\n                <div className=\"p-col-12 p-md-8\">\r\n                  <InputTextarea rows={3}\r\n                    value={description}\r\n                    placeholder=\"Descrição\"\r\n                    onChange={e => setDescription(e.target.value)}\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              { record?.config_json?.show_allow_add_layers !== false && <div className=\"p-field p-grid\">\r\n                <label className=\"p-col-12 p-md-4\">Permitir adicionar temas ao mapa?</label>\r\n                <div className=\"p-col-12 p-md-8\">\r\n                  <InputSwitch\r\n                    checked={allow_add_layers}\r\n                    onChange={(e) => setAllowAddLayers(!allow_add_layers)}\r\n                  />\r\n                </div>\r\n              </div> }\r\n\r\n              { cookieData && record?.config_json?.show_allow_user_session !== false && <div className=\"p-field p-grid\">\r\n                <label className=\"p-col-12 p-md-4\">Permitir gravar sessão?</label>\r\n                <div className=\"p-col-12 p-md-8\">\r\n                  <InputSwitch\r\n                    checked={allow_user_session}\r\n                    onChange={(e) => setAllowUserSession(!allow_user_session)}\r\n                  />\r\n                </div>\r\n              </div> }\r\n\r\n              { cookieData && record?.config_json?.show_allow_anonymous !== false && <div className=\"p-field p-grid\">\r\n                <label className=\"p-col-12 p-md-4\">Permitir acesso anónimo?</label>\r\n                <div className=\"p-col-12 p-md-8\">\r\n                  <InputSwitch\r\n                    checked={allow_anonymous}\r\n                    onChange={(e) => setAllowAnonymous(!allow_anonymous)}\r\n                  />\r\n                </div>\r\n              </div> }\r\n            </div>\r\n\r\n            { viewer.save_response &&  \r\n            <div className=\"p-grid\">\r\n                <label className=\"p-col-12\"><strong>Url</strong></label>\r\n                <div className=\"p-col-12 p-md-10\">\r\n                    <a style={{wordBreak: \"break-all\"}} href={getViewerPublicUrl(viewer.save_response.uuid)}\r\n                      target=\"_blank\" rel=\"noopener noreferrer\">{getViewerPublicUrl(viewer.save_response.uuid)}</a>\r\n                </div>\r\n                <div className=\"p-col-12 p-md-2\">\r\n                    <Button\r\n                        style={{marginLeft:\"0px\", color: \"#2196F\"}} \r\n                        icon=\"pi pi-copy\"\r\n                        className=\"p-button p-component p-button-rounded p-button-outlined p-button-help p-button-icon-only\"\r\n                        onClick={(e) => { e.preventDefault(); e.currentTarget.blur(); copyToClipboard(getViewerPublicUrl(viewer.save_response.uuid)) }}\r\n                        tooltip=\"Copiar Url\" tooltipOptions={{position: 'top'}}\r\n                    />\r\n                </div>\r\n            </div>\r\n            }            \r\n\r\n            <div className=\"p-dialog-myfooter\">\r\n              <Button \r\n                color='green'\r\n                icon={ viewer.save_loading ? \"pi pi-spin pi-spinner\": \"pi pi-check\" }\r\n                label=\"Obter Link\" \r\n                onClick={submit}\r\n                disabled={(viewer.save_loading)}\r\n              />\r\n            </div>\r\n\r\n            { viewer.save_error && \r\n              <Message style={{ width: '100%' }} severity=\"error\" text=\"Serviço Indisponível\"></Message>\r\n            }\r\n\r\n            { viewer.save_response && !!viewer.save_response.message && \r\n              <Message style={{ width: '100%' }} severity=\"error\" text=\"Ocorreu um erro\"></Message>\r\n            }           \r\n          </form>\r\n      </Dialog>)}\r\n\r\n    </React.Fragment> : null\r\n  )\r\n}\r\n\r\nexport default connect(state => ({ viewer: state.root.viewer }))(ShareViewerWidget)","import React, { useContext, useState } from 'react'\r\nimport Cookies from 'universal-cookie'\r\nimport { InputText } from 'primereact/inputtext'\r\nimport { InputTextarea } from 'primereact/inputtextarea';\r\nimport { Button } from 'primereact/button'\r\nimport { connect, useDispatch } from 'react-redux'\r\nimport AppContext from '../../AppContext'\r\nimport { Message } from 'primereact/message'\r\nimport { InputSwitch } from 'primereact/inputswitch'\r\nimport { Dialog } from 'primereact/dialog'\r\nimport { getWindowSize, showOnPortal } from '../utils'\r\nimport { getViewerSessionConfig } from '../model/MapModel'\r\n\r\nconst cookies = new Cookies();\r\n\r\nfunction SaveViewerWidget({ viewer }) {\r\n\r\n  const [showForm, setShowForm] = useState(false);\r\n  const [id, setId] = useState(null);\r\n  const [name, setName] = useState('');\r\n  const [title, setTitle] = useState('');\r\n  const [description, setDescription] = useState('');\r\n  const [is_active, setIsActive] = useState(true);\r\n  const [allow_add_layers, setAllowAddLayers] = useState(true);\r\n  const [allow_user_session, setAllowUserSession] = useState(false);\r\n  const [allow_anonymous, setAllowAnonymous] = useState(true);\r\n\r\n  const wsize = getWindowSize();\r\n  const isMobile = wsize[0] <= 768;\r\n  \r\n  // Enable redux actions\r\n  const dispatch = useDispatch();\r\n  const { core } = useContext(AppContext);\r\n  const { viewer_save_record } = core.actions;\r\n\r\n  const cookieData = cookies.get(core.COOKIE_AUTH_NAME);\r\n\r\n  function openForm() {\r\n    setId(viewer.id);\r\n    setName(viewer.name);\r\n    setTitle(viewer.title);\r\n    setDescription(viewer.description);\r\n    setIsActive(viewer.is_active === null ? true : viewer.is_active);\r\n    setAllowAddLayers(viewer.allow_add_layers);\r\n    setAllowUserSession(viewer.allow_user_session == null ? false : viewer.allow_user_session);\r\n    setAllowAnonymous(viewer.allow_anonymous == null ? true : viewer.allow_anonymous);\r\n    setShowForm(true);\r\n  }\r\n  \r\n  // Render user\r\n  if (!cookieData || !viewer.is_owner) return null;\r\n\r\n  function submit(e) {\r\n    e.preventDefault();\r\n\r\n    if (!name || name.length==0 || !title || title.length==0) {\r\n      return false;\r\n    }\r\n\r\n    //Get current session viewer config\r\n    const newconfig = getViewerSessionConfig(viewer);\r\n\r\n    let record = {\r\n      id,\r\n      name,\r\n      title,\r\n      description,\r\n      is_active,\r\n      allow_add_layers,\r\n      allow_user_session,\r\n      allow_anonymous,\r\n      config_json: JSON.stringify(newconfig)\r\n    }\r\n    dispatch(viewer_save_record(record, null, null))\r\n  }\r\n\r\n  // Render save button\r\n  return (\r\n    <React.Fragment>\r\n      <button className=\"p-link\" onClick={e => openForm()}>\r\n        <span className=\"layout-topbar-item-text\">Guardar</span>\r\n        <span className=\"layout-topbar-icon pi pi-save\"/>\r\n      </button>\r\n\r\n      {showOnPortal(<Dialog\r\n        header=\"Guardar Visualizador\"\r\n        visible={showForm}\r\n        style={{width: isMobile ? '90%' : '35vw' }} \r\n        modal \r\n        onHide={e => setShowForm(false)}>\r\n\r\n          <form onSubmit={e => submit()}>\r\n\r\n            <div className=\"p-fluid\">\r\n\r\n              <div className=\"p-field p-grid\">\r\n                <label className=\"p-col-12 p-md-4\">Nome</label>\r\n                <div className=\"p-col-12 p-md-8\">\r\n                  <InputText\r\n                    className={(!name || name.length == 0 ? 'p-invalid' : '')}\r\n                    value={name}\r\n                    placeholder=\"Nome do Visualizador\"\r\n                    onChange={e => setName(e.target.value)}\r\n                  />\r\n                  { (!name || name.length == 0) &&\r\n                  <small className=\"p-invalid p-d-block\">Campo de preenchimento obrigatório</small> }                  \r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"p-field p-grid\">\r\n                <label className=\"p-col-12 p-md-4\">Título</label>\r\n                <div className=\"p-col-12 p-md-8\">\r\n                  <InputText\r\n                    className={(!title || title.length == 0 ? 'p-invalid' : '')}\r\n                    value={title}\r\n                    placeholder=\"Título\"\r\n                    onChange={e => setTitle(e.target.value)}\r\n                  />\r\n                  { (!title || title.length == 0) &&\r\n                  <small className=\"p-invalid p-d-block\">Campo de preenchimento obrigatório</small> }                  \r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"p-field p-grid\">\r\n                <label className=\"p-col-12 p-md-4\">Descrição</label>\r\n                <div className=\"p-col-12 p-md-8\">\r\n                  <InputTextarea rows={3}\r\n                    value={description}\r\n                    placeholder=\"Descrição\"\r\n                    onChange={e => setDescription(e.target.value)}\r\n                  />\r\n                </div>\r\n              </div>              \r\n\r\n              <div className=\"p-field p-grid\">\r\n                <label className=\"p-col-12 p-md-4\">Está ativo?</label>\r\n                <div className=\"p-col-12 p-md-8\">\r\n                  <InputSwitch\r\n                    checked={is_active}\r\n                    onChange={(e) => setIsActive(!is_active)}\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              {/*\r\n              <div className=\"p-field p-grid\">\r\n                <label className=\"p-col-12 p-md-4\">Permitir adicionar temas ao mapa?</label>\r\n                <div className=\"p-col-12 p-md-8\">\r\n                  <InputSwitch\r\n                    checked={allow_add_layers}\r\n                    onChange={(e) => setAllowAddLayers(!allow_add_layers)}\r\n                  />\r\n                </div>\r\n              </div>\r\n              */}\r\n\r\n              <div className=\"p-field p-grid\">\r\n                <label className=\"p-col-12 p-md-4\">Permitir gravar sessão?</label>\r\n                <div className=\"p-col-12 p-md-8\">\r\n                  <InputSwitch\r\n                    checked={allow_user_session}\r\n                    onChange={(e) => setAllowUserSession(!allow_user_session)}\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"p-field p-grid\">\r\n                <label className=\"p-col-12 p-md-4\">Permitir acesso anónimo?</label>\r\n                <div className=\"p-col-12 p-md-8\">\r\n                  <InputSwitch\r\n                    checked={allow_anonymous}\r\n                    onChange={(e) => setAllowAnonymous(!allow_anonymous)}\r\n                  />\r\n                </div>\r\n              </div>              \r\n\r\n            </div>\r\n\r\n            <div className=\"p-dialog-myfooter\">\r\n              <Button \r\n                color='green'\r\n                icon={ viewer.save_loading ? \"pi pi-spin pi-spinner\": \"pi pi-check\" }\r\n                label=\"Guardar\" \r\n                onClick={submit}\r\n                disabled={(viewer.save_loading)}\r\n              />\r\n            </div>\r\n\r\n            { viewer.save_error && \r\n              <Message style={{ width: '100%' }} severity=\"error\" text=\"Serviço Indisponível\"></Message>\r\n            }\r\n\r\n            { viewer.save_response && !!viewer.save_response.message && \r\n              <Message style={{ width: '100%' }} severity=\"error\" text=\"Chave de URL inválida\"></Message>\r\n            }\r\n\r\n          </form>\r\n      </Dialog>)}\r\n\r\n    </React.Fragment>\r\n  )\r\n}\r\n\r\nexport default connect(state => ({ viewer: state.root.viewer }))(SaveViewerWidget)","import React, { useContext, useEffect, useState } from 'react'\r\nimport Cookies from 'universal-cookie'\r\nimport { InputText } from 'primereact/inputtext'\r\nimport { Password } from 'primereact/password'\r\nimport { Button } from 'primereact/button'\r\nimport { connect, useDispatch } from 'react-redux'\r\nimport AppContext from '../../AppContext'\r\nimport { Message } from 'primereact/message'\r\n\r\nconst cookies = new Cookies();\r\n\r\nfunction LoginWidget({ auth, history, redirect, path, urlRedirect }) {\r\n\r\n  const [username, setUsername] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  \r\n  // Enable redux actions\r\n  const dispatch = useDispatch();\r\n  const { core } = useContext(AppContext);\r\n  const { login_post, login_clear_error, logout } = core.actions;\r\n\r\n  const cookieData = cookies.get(core.COOKIE_AUTH_NAME);\r\n\r\n  useEffect(() => {\r\n    dispatch(login_clear_error());\r\n  }, []);\r\n  \r\n  // Render user\r\n  if (cookieData) {\r\n    const { username } = cookieData;\r\n    return (\r\n      <div>\r\n        <p>Olá { username }.</p>\r\n        <p>\r\n          Clique para \r\n          <Button\r\n            className=\"p-button-link\" onClick={e => dispatch(logout())}\r\n            label=\"terminar sessão\"\r\n          />.\r\n        </p>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  function submit(e) {\r\n    e.preventDefault();\r\n    dispatch(login_post({ username, password }, history, path ? path + redirect : redirect, urlRedirect))\r\n  }\r\n\r\n  return (\r\n    <form onSubmit={e => submit()}>\r\n\r\n      <div className=\"p-fluid\">\r\n\r\n        <div className=\"p-field p-grid\">\r\n          <label className=\"p-col-12 p-md-4\">Nome de Utilizador / E-mail</label>\r\n          <div className=\"p-col-12 p-md-8\">\r\n            <InputText\r\n              value={username}\r\n              placeholder=\"Nome de Utilizador\"\r\n              onChange={e => setUsername(e.target.value)}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"p-field p-grid\">\r\n          <label className=\"p-col-12 p-md-4\">Palavra-passe</label>\r\n          <div className=\"p-col-12 p-md-8\">\r\n            <Password\r\n              value={password}\r\n              placeholder=\"Palavra-passe\"\r\n              feedback={false}\r\n              onChange={e => setPassword(e.target.value)}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n      </div>\r\n\r\n      <div className=\"p-dialog-myfooter\">\r\n        <Button \r\n          color='green'\r\n          icon={ auth.loading ? \"pi pi-spin pi-spinner\": \"pi pi-check\" }\r\n          label=\"Entrar\" \r\n          onClick={submit}\r\n          disabled={auth.loading}\r\n        />\r\n      </div>\r\n      \r\n      { auth.http_error && !auth.response &&\r\n        <Message style={{ width: '100%' }} severity=\"error\" text=\"Serviço Indisponível\"></Message>\r\n      }\r\n\r\n      { auth.response && !!auth.response && !!auth.response.message && \r\n        <Message style={{ width: '100%' }} severity=\"error\" text=\"Nome de Utilizador ou Palavra-passe inválido\"></Message>\r\n      }\r\n\r\n    </form>\r\n  )\r\n}\r\n\r\nexport default connect(state => ({ auth: state.root.auth }))(LoginWidget)","import React, { useContext, useRef, useState, useEffect } from 'react'\r\nimport { Dialog } from 'primereact/dialog'\r\nimport Cookies from 'universal-cookie'\r\nimport { Menu } from 'primereact/menu'\r\nimport { getWindowSize } from '../utils'\r\nimport { connect, useDispatch } from 'react-redux'\r\nimport AppContext from '../../AppContext'\r\nimport LoginWidget from './LoginWidget'\r\n\r\nconst cookies = new Cookies();\r\n\r\nconst appEntityNameAbrev = process.env.REACT_APP_ENTITY_NAME_ABREV || '';\r\n//let popupMenu;\r\n\r\nfunction TopButtonAuth(props) {\r\n  const [showLoginButton, setShowLoginButton] = useState(true);\r\n  const [showLogin, setShowLogin] = useState(false);\r\n  const [showMenu, setShowMenu] = useState(false);\r\n  const popupMenu = useRef();\r\n\r\n  // Enable redux actions\r\n  const dispatch = useDispatch();\r\n  const { core } = useContext(AppContext);\r\n  const { logout } = core.actions;\r\n\r\n  const cookieData = cookies.get(core.COOKIE_AUTH_NAME);\r\n  const wsize = getWindowSize();\r\n  const isMobile = wsize[0] <= 768;\r\n  const isMobileSmall = wsize[0] <= 440;\r\n\r\n  useEffect(() => {\r\n    //Hide login button if viewer only has anonymous access\r\n    if (core.config && core.config.roles && core.config.roles.length === 1 && core.config.roles[0].name === 'Anonymous') {\r\n      setShowLoginButton(false);\r\n    }\r\n  }, [props.config]);\r\n\r\n  // Render user\r\n  if (cookieData) {\r\n    const { username } = cookieData;\r\n    const userMenu = [\r\n      {\r\n        label: 'Terminar Sessão',\r\n        icon: 'pi pi-lock',\r\n        command: () => {\r\n          dispatch(logout())  \r\n        }\r\n      }\r\n    ]\r\n    if (isMobileSmall) {\r\n      userMenu.unshift({\r\n          label: username,\r\n          disabled: true,\r\n          style: { wordBreak: 'break-all' }\r\n        });\r\n    }\r\n    return (\r\n      <span style={{ position: 'relative' }}>\r\n        { showLoginButton ?\r\n        <button className=\"p-link\" onClick={e => setShowMenu(!showMenu)}>\r\n          <span className=\"layout-topbar-item-text\">{ !isMobileSmall ? username : '' }</span>\r\n          <span className=\"layout-topbar-icon pi pi-user\"/>\r\n          {' '}{ !isMobileSmall ? username : '' }\r\n        </button> : null }\r\n        <Menu \r\n          model={userMenu} \r\n          ref={el => popupMenu.current = el} id=\"user_menu\"\r\n          style={{ display: showMenu ? 'block' : 'none' }}\r\n        />\r\n      </span>\r\n    )\r\n  }\r\n\r\n  if (showLogin) {\r\n    return (\r\n      <Dialog\r\n        header={\"Entrar - \" + (appEntityNameAbrev || 'ScalarGIS')}\r\n        visible={showLogin}\r\n        style={{width: wsize[0] < 768 ? '90%' : '35vw' }} \r\n        modal \r\n        onHide={e => setShowLogin(false)}>\r\n          <LoginWidget />\r\n      </Dialog>\r\n    )\r\n  }\r\n\r\n  if (showLoginButton) {\r\n    // Render login button\r\n    return (\r\n      true ? <button className=\"p-link\" onClick={e => setShowLogin(true)}>\r\n          <span className=\"layout-topbar-item-text\">Utilizador</span>\r\n          <span className=\"layout-topbar-icon pi pi-unlock\"/>\r\n      </button> : null\r\n    )\r\n  } else {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport default connect(state => ({ auth: state.root.auth, config: state.root.config }))(TopButtonAuth)","import React, { useContext, useState } from 'react'\r\nimport Cookies from 'universal-cookie'\r\nimport { InputText } from 'primereact/inputtext'\r\nimport { InputTextarea } from 'primereact/inputtextarea'\r\nimport { Button } from 'primereact/button'\r\nimport { Message } from 'primereact/message'\r\nimport { Dialog } from 'primereact/dialog'\r\nimport { connect, useDispatch } from 'react-redux'\r\nimport AppContext from '../../AppContext'\r\nimport { getWindowSize, showOnPortal } from '../utils'\r\n\r\n\r\nconst cookies = new Cookies();\r\n\r\nconst validateEmail = (email) => {\r\n  return email.match(\r\n    /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/\r\n  );\r\n};\r\n\r\nfunction TopButtonContact({ viewer }) {\r\n  const [showForm, setShowForm] = useState(false);\r\n  const [name, setName] = useState('');\r\n  const [email, setEmail] = useState('');\r\n  const [description, setDescription] = useState('');\r\n  const [infoMessage, setInfoMessage] = useState(null);\r\n  const [sending, setSending] = useState(false);\r\n\r\n  const wsize = getWindowSize();\r\n  const isMobile = wsize[0] <= 768;\r\n  \r\n  // Enable redux actions\r\n  const dispatch = useDispatch();\r\n  const { core } = useContext(AppContext);\r\n\r\n  const cookieData = cookies.get(core.COOKIE_AUTH_NAME);\r\n\r\n  function openForm() {\r\n    setName(viewer?.user_info?.name ? viewer.user_info.name : null);\r\n    setEmail(viewer?.user_info?.email  ? viewer.user_info.email : null);\r\n    setDescription(null);\r\n    setInfoMessage(null);\r\n    setShowForm(true);\r\n  }\r\n\r\n  function submit(e) {\r\n    e.preventDefault();\r\n\r\n    if (!name || !email || !description) {\r\n      setInfoMessage({\r\n        type: 'error',\r\n        message: 'Campos obrigatórios não preenchidos'\r\n      });\r\n      return false;\r\n    } else if (!validateEmail(email)) { \r\n      setInfoMessage({\r\n        type: 'error',\r\n        message: 'Formato de email incorreto'\r\n      }); \r\n      return false;\r\n    } else {\r\n      setInfoMessage(null);\r\n    }\r\n\r\n    let record = {\r\n      name,\r\n      email,\r\n      description\r\n    }\r\n\r\n    // Save request\r\n    let options = {\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'Content-Type': 'application/json'        \r\n      },\r\n      method: 'POST',\r\n      body: JSON.stringify(record)\r\n    }\r\n\r\n    // Get logged user\r\n    const cookies = new Cookies();\r\n    const logged = cookies.get(core.COOKIE_AUTH_NAME);\r\n    if (logged) options.headers['X-API-KEY'] = logged.token;\r\n\r\n    setSending(true);\r\n\r\n    // Auth url. TODO: check for proxy\r\n    let url = core.API_URL + '/app/viewer/' + viewer.id + '/contact_message';\r\n    fetch(url, options)\r\n      .then(res => res.json())\r\n      .then(res => {\r\n        setSending(false);\r\n        if (res.success) {\r\n          setInfoMessage({\r\n            type: 'success',\r\n            message: res.message\r\n          });\r\n        } else {\r\n          setInfoMessage({\r\n            type: 'error',\r\n            message: res.message\r\n          });   \r\n        }\r\n      }).catch(error => {\r\n        setSending(false);\r\n        setInfoMessage({\r\n          type: 'error',\r\n          message: 'Ocorreu um erro.'\r\n        });\r\n      });\r\n  }\r\n \r\n  if (!viewer || !viewer.show_contact) return null;\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <button className=\"p-link\" onClick={e => openForm()} title=\"Contacto\">\r\n        <span className=\"layout-topbar-item-text\">Contacto</span>\r\n        <span className=\"layout-topbar-icon far fa-envelope\" />\r\n      </button>\r\n\r\n      {showOnPortal(<Dialog\r\n        header=\"Formulário de Contacto\"\r\n        visible={showForm}\r\n        style={{width: isMobile ? '90%' : '35vw' }} \r\n        modal \r\n        onHide={e => setShowForm(false)}>\r\n\r\n          <form onSubmit={e => submit()}>\r\n\r\n            <div className=\"p-fluid\">\r\n              <div className=\"p-field\">\r\n                  <label htmlFor=\"contact_name\">Nome</label>\r\n                  <InputText\r\n                      id=\"contact_name\"\r\n                      className={(!name || name.length === 0 ? 'p-invalid' : '')}\r\n                      value={name}\r\n                      placeholder=\"Nome\"\r\n                      disabled={viewer?.user_info?.name}\r\n                      onChange={e => {setName(e.target.value); setInfoMessage(null);}}\r\n                    />\r\n                    { (!name || name.length === 0) &&\r\n                    <small className=\"p-invalid p-d-block\">Campo de preenchimento obrigatório</small> }                                  \r\n              </div>\r\n              <div className=\"p-field\">\r\n                  <label htmlFor=\"contact_email\">Email</label>\r\n                  <InputText\r\n                      id=\"contact_email\"\r\n                      className={(!email || email.length === 0 ? 'p-invalid' : '')}\r\n                      value={email}\r\n                      placeholder=\"Email\"\r\n                      disabled={viewer?.user_info?.email}\r\n                      onChange={e => {setEmail(e.target.value); setInfoMessage(null);}}\r\n                    />\r\n                    { (!email || email.length === 0) &&\r\n                    <small className=\"p-invalid p-d-block\">Campo de preenchimento obrigatório</small> }                                  \r\n              </div>\r\n              <div className=\"p-field\">\r\n                  <label htmlFor=\"contact_description\">Descrição</label>\r\n                  <InputTextarea rows={3}\r\n                      id=\"contact_description\"\r\n                      className={(!description || description.length === 0 ? 'p-invalid' : '')}\r\n                      value={description}\r\n                      placeholder=\"Descrição\"\r\n                      onChange={e => {setDescription(e.target.value); setInfoMessage(null);}}\r\n                    />\r\n                    { (!description || description.length === 0) &&\r\n                    <small className=\"p-invalid p-d-block\">Campo de preenchimento obrigatório</small> }\r\n              </div>            \r\n            </div>\r\n            \r\n            { viewer.contact_info && \r\n              <div dangerouslySetInnerHTML={{__html: viewer.contact_info}}></div>            \r\n            }\r\n                      \r\n            <div className=\"p-mb-2\">\r\n              { (infoMessage && infoMessage.type) && \r\n                <Message style={{ width: '100%' }} severity={infoMessage.type} text={infoMessage.message}></Message>\r\n              }\r\n            </div>                   \r\n\r\n            <div className=\"p-dialog-myfooter\">\r\n              <Button \r\n                color='green'\r\n                icon={ sending ? \"pi pi-spin pi-spinner\": \"pi pi-check\" }\r\n                label=\"Enviar\" \r\n                onClick={submit}\r\n                disabled={sending}\r\n              />\r\n            </div>         \r\n          </form>\r\n      </Dialog>)}\r\n\r\n    </React.Fragment>\r\n  )\r\n}\r\n\r\nexport default connect(state => ({ viewer: state.root.viewer }))(TopButtonContact)","import React, { useContext, useState } from 'react'\r\nimport { connect, useDispatch } from 'react-redux'\r\nimport AppContext from '../../AppContext'\r\nimport { getWindowSize } from '../utils'\r\n\r\n//let popupMenu;\r\n\r\nfunction TopButtonHelp({ viewer }) {\r\n\r\n  const { core } = useContext(AppContext);\r\n\r\n  const wsize = getWindowSize();\r\n  const isMobile = wsize[0] <= 768;\r\n  const isMobileSmall = wsize[0] <= 440;\r\n\r\n  if (!viewer || !viewer.config_json || !viewer.config_json.help_url) return null;\r\n\r\n  // Render help button\r\n  return (\r\n    <button className=\"p-link\" title=\"Ajuda\" onClick={e => { return; }}>\r\n        <a href={viewer.config_json.help_url} target=\"_blank\" style={{\"color\": \"#ffffff\"}}>\r\n          <span className=\"layout-topbar-item-text\">Ajuda</span>\r\n          <span className=\"layout-topbar-icon pi pi-question-circle\"/>\r\n        </a>\r\n    </button>\r\n  )\r\n}\r\n\r\nexport default connect(state => ({ viewer: state.root.viewer }))(TopButtonHelp)","import React from 'react'\r\nimport { DataTable } from 'primereact/datatable'\r\nimport { Column } from 'primereact/column'\r\nimport { Button } from 'primereact/button'\r\nimport { Dialog } from 'primereact/dialog';\r\n\r\nconst paginatorLeft = <Button type=\"button\" icon=\"pi pi-refresh\" className=\"p-button-text\" />;\r\nconst paginatorRight = <Button type=\"button\" icon=\"pi pi-cloud\" className=\"p-button-text\" />;\r\n\r\nexport default function Main({ open, as, onOpen, onClose, data, fields }) {\r\n\r\n  if (as === 'button') return (\r\n    <Button icon=\"pi pi-table\"\r\n      title=\"Tabela de atributos\"\r\n      color=\"blue\"\r\n      className=\"p-button-sm p-button-rounded p-button-text tool\"\r\n      onClick={e => onOpen(true)}\r\n    />\r\n  )\r\n\r\n  return (\r\n      <React.Fragment>\r\n        <Dialog\r\n          header=\"Tabela de Attributos\"\r\n          visible={open}\r\n          style={{width: '50vw'}} \r\n          modal \r\n          onHide={e => onClose(false)}>\r\n            <DataTable \r\n              value={data} \r\n              paginator rows={4} \r\n              paginatorTemplate=\"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown\"\r\n              currentPageReportTemplate=\"A mostrar de {first} até {last} de um total de {totalRecords}\"\r\n              rowsPerPageOptions={[2,4]}\r\n              paginatorLeft={paginatorLeft}\r\n              paginatorRight={paginatorRight}\r\n              className=\"p-datatable-striped\">\r\n                \r\n                { fields.map(field =>\r\n                  <Column \r\n                    key={field.name}\r\n                    field={field.name} \r\n                    header={field.label}\r\n                    sortable={field.type !== 'url'}\r\n                    filter={field.type !== 'url'}\r\n                    filterPlaceholder={\"Procurar por \" + field.label.toLowerCase()}\r\n                    body={row => \r\n                      field.type === 'url' ?\r\n                        <div>\r\n                          <a href={row[field.name]} title={row[field.name]} target=\"_blank\" rel=\"noopener noreferrer\">\r\n                            <i className=\"pi pi-external-link\"></i>\r\n                          </a>\r\n                        </div>\r\n                      : row[field.name]\r\n                    }\r\n                  />\r\n                )}\r\n\r\n            </DataTable>\r\n          </Dialog>\r\n      </React.Fragment>\r\n  )\r\n}","import React, { useEffect, useState } from 'react'\r\nimport { Card } from 'primereact/card';\r\n\r\nimport './style.css'\r\n\r\nexport default function BasemapItem({ core, viewer, mainMap, layer, selected, setSelected }) {\r\n\r\n    const { CLIENT_URL } = core;\r\n\r\n    const title = layer.title || '';\r\n    const subtitle = layer.description || '';\r\n\r\n    const img = CLIENT_URL + (layer.thumbnail || 'assets/images/basemaps/TERRAIN.jpg');\r\n\r\n    const header = <img alt=\"Card\" src={img} className={ !selected ? 'disabled' : ''}\r\n                        title={(selected ? 'Clicar para desligar' : 'Clicar para ligar' )}\r\n                        onClick={() => setSelected(selected ? null : layer.id) } />\r\n\r\n    const itemClass = 'p-mr-2 p-mb-1 basemaps-control-item' + (selected ? ' active' : '');\r\n\r\n    return (\r\n        <div className={itemClass}>\r\n            <Card className=\"p-text-center\" title={title} subTitle={subtitle} header={header}></Card>                        \r\n        </div>\r\n    )\r\n}","import { Button } from 'primereact/button'\r\nimport { Card } from 'primereact/card';\r\nimport React, { useEffect, useState } from 'react'\r\nimport BasemapItem from './BasemapItem'\r\nimport './style.css'\r\n\r\nexport default function Basemaps({ core, viewer, mainMap, config, actions, record, layers, selectedLayer }) {\r\n    \r\n  const dispatch = config.dispatch;\r\n\r\n  const [autoClose, setAutoClose] = useState(record.config_json && record.config_json.auto_close)\r\n  const [opened, setOpened] = useState(false);\r\n\r\n  const layersIds = layers.map(l => l.id);\r\n\r\n  function selectLayer (layer) {\r\n    let checked = viewer.config_json.checked.filter(c => { return !layersIds.includes(c); });\r\n    if (layer) {\r\n      checked.push(layer);\r\n    }\r\n    if (layer && autoClose) {\r\n      setOpened(false);\r\n    }\r\n    dispatch(actions.layers_set_checked(checked));\r\n  }\r\n\r\n  return (\r\n    record.target === 'mainmenu' ?\r\n    <div className=\"basemaps-menu\">\r\n          { layers.map((item, i) => <BasemapItem key={item.id}  viewer={viewer} mainMap={mainMap} layer={item} \r\n            selected={selectedLayer && selectedLayer===item.id} setSelected={selectLayer} core={core} />) }\r\n    </div> :\r\n    <div className=\"basemaps map-controls\">\r\n      <Button \r\n        icon=\"pi pi-image\"\r\n        className={opened ? \"p-button-rounded p-button-raised active\" : \"p-button-rounded p-button-raised\" } \r\n        onClick={(e) => { e.currentTarget.blur(); setOpened(!opened) } } \r\n      />\r\n      { opened &&\r\n      <div className=\"basemaps-control\">\r\n        <div className=\"p-d-inline-flex p-flex-row p-flex-wrap\">\r\n          { layers.map((item, i) => <BasemapItem key={item.id}  viewer={viewer} mainMap={mainMap} layer={item} \r\n            selected={selectedLayer && selectedLayer===item.id} setSelected={selectLayer} core={core} />) }\r\n        </div>      \r\n      </div>\r\n      }\r\n    </div>\r\n  )\r\n}","import React from 'react'\r\nimport { Button } from 'primereact/button';\r\nimport { Panel } from 'primereact/panel';\r\nimport Basemaps from './Basemaps'\r\n\r\n/**\r\n * Main menu component\r\n */\r\nexport function MainMenu({ className, config, actions, record }) {\r\n  \r\n  if (record && record.target === 'mainmenu') {\r\n      return (\r\n          <Button\r\n            title=\"Mapas de Base\"\r\n            className={className}\r\n            icon=\"pi pi-image\"\r\n            style={{ margin: '0.5em 1em' }}\r\n            onClick={e => config.dispatch(actions.viewer_set_selectedmenu(record.id))}\r\n          />\r\n      )\r\n    } else {\r\n      return null;\r\n    }\r\n}\r\n\r\nexport default function Main({as, core, config, actions, record, utils}) {\r\n  \r\n  const { viewer, mainMap } = config;\r\n\r\n  let layers = [];\r\n  let selectedLayer = null;\r\n\r\n  //Get list of basemap layers\r\n  if (viewer && viewer.config_json && viewer.config_json.layers) {\r\n    const parent = viewer.config_json.layers.filter(l => { return l.id === 'basemaps'});\r\n    if (parent && parent[0] && parent[0].children) {\r\n      viewer.config_json.layers.forEach(layer => {\r\n        if (parent[0].children.includes(layer.id)) {\r\n          layers.push(layer);\r\n        }\r\n      });\r\n      /* Reduce method doesnot work in IE11\r\n      layers = viewer.config_json.layers.reduce(function(filtered, layer) {\r\n        if (parent[0].children.includes(layer.id)) {\r\n          filtered.push(layer);\r\n        }\r\n        return filtered;\r\n      }, []);\r\n      */\r\n    }\r\n  }\r\n\r\n  //Basemap selectedLayer is the first checked layer\r\n  for (var l of layers) {\r\n    if (viewer.config_json.checked.includes(l.id)) {\r\n      selectedLayer = l.id;\r\n      break;\r\n    }\r\n  }\r\n\r\n  function renderContent() {\r\n    return (\r\n      <div title=\"Mapas de Base\">\r\n        <Basemaps\r\n          core={core}\r\n          config={config}\r\n          actions={actions}\r\n          viewer={viewer}\r\n          mainMap={mainMap}\r\n          record={record}\r\n          layers={layers}\r\n          selectedLayer={selectedLayer}\r\n        />\r\n      </div>  \r\n    )  \r\n  }\r\n\r\n  if (as === 'panel') return (    \r\n    <Panel header=\"Mapas de Base\">\r\n      { renderContent() }\r\n    </Panel>\r\n  )  \r\n\r\n  // Render component\r\n  return renderContent()\r\n}","import React, { useState, useRef } from 'react'\r\nimport './style.css'\r\n\r\nexport default function ContactInfo(props) {\r\n\r\n  const { viewer, config } = props;\r\n\r\n  const contact_info = config.contact_info || viewer.contact_info;\r\n\r\n  if (config?.hideContactInfo === true || !contact_info) {\r\n    return null\r\n  }\r\n\r\n  return (\r\n    contact_info && \r\n      <div dangerouslySetInnerHTML={{__html: contact_info}}></div>            \r\n  )\r\n\r\n}","import React, { useState, useRef } from 'react';\r\nimport Cookies from 'universal-cookie';\r\nimport { FileUpload } from 'primereact/fileupload';\r\nimport { InputText } from 'primereact/inputtext';\r\nimport { InputTextarea } from 'primereact/inputtextarea';\r\nimport { Button } from 'primereact/button';\r\nimport { Message } from 'primereact/message';\r\nimport { Tag } from 'primereact/tag';\r\nimport { Captcha } from 'primereact/captcha';\r\nimport ContactInfo from './ContactInfo';\r\nimport './style.css';\r\n\r\n\r\nconst cookies = new Cookies();\r\n\r\nconst validateEmail = (email) => {\r\n  return email.match(\r\n    /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/\r\n  );\r\n};\r\n\r\nconst readUploadedFile = (file) => {\r\n  const reader = new FileReader();\r\n\r\n  return new Promise((resolve, reject) => {\r\n    reader.onerror = () => {\r\n      reader.abort();\r\n      reject(new DOMException(\"Problem parsing input file.\"));\r\n    };\r\n\r\n    reader.onload = () => {\r\n      const f = {\r\n        filename: file.name,\r\n        type: file.type, \r\n        size: file.size, \r\n        data: reader.result \r\n      }\r\n      resolve(f);\r\n    };\r\n    reader.readAsDataURL(file);\r\n  });\r\n};\r\n\r\nconst handleUpload = async (file) => {\r\n  try {\r\n    const fileContents = await readUploadedFile(file);\r\n    return fileContents;\r\n  } catch (e) {\r\n    console.warn(e.message)\r\n    return null;\r\n  }\r\n}\r\n\r\nexport default function ContactFrom(props) {\r\n\r\n  const { core, viewer, config, Utils } = props;\r\n\r\n  const upload_cfg = config.upload || {};\r\n\r\n  const showCaptcha = (!viewer?.user_info?.name && viewer.captcha_key) ? true : false;\r\n\r\n  //const [showForm, setShowForm] = useState(false);\r\n  const [name, setName] = useState(viewer?.user_info?.name ? viewer.user_info.name : null);\r\n  const [email, setEmail] = useState(viewer?.user_info?.email  ? viewer.user_info.email : null);\r\n  const [captchaResponse, setCaptchaResponse] = useState(null);\r\n  const [files, setFiles] = useState([]);\r\n  const [description, setDescription] = useState(null);\r\n  const [infoMessage, setInfoMessage] = useState(null);\r\n  const [enableSubmit, setEnableSubmit] = useState(showCaptcha ? false: true);\r\n  const [isProcessingFiles, setIsProcessingFiles] =  useState(false);\r\n  const [sending, setSending] = useState(false);\r\n  const [isComplete, setIsComplete] = useState(false);\r\n\r\n  const fileUploadRef = useRef(null);\r\n\r\n  const onFileSelect = (e) => {\r\n    const upload_files = Array.from(e.files).filter(f => fileUploadRef.current.isFileSelected(f)).map(f=>f);\r\n    const promises = Array.from(upload_files).map(file => handleUpload(file));\r\n    if (promises && promises.length) setIsProcessingFiles(true);\r\n    Promise.all(promises).then((values) => {;\r\n      setFiles([...files, ...values]);\r\n      setIsProcessingFiles(false);\r\n      setInfoMessage(null);\r\n    });\r\n  }\r\n\r\n  const onFileRemove = (e) => {\r\n    if (files && files.length) {\r\n      const new_files = files.filter(obj => obj.filename !== e.file.name);\r\n      setFiles(new_files);\r\n      setInfoMessage(null);\r\n    }\r\n  }\r\n  const onTemplateRemove = (file, callback) => {\r\n      callback();\r\n  }  \r\n\r\n  const onFileClear = () => {\r\n    setFiles([]);\r\n    setInfoMessage(null);\r\n  }\r\n\r\n  const onCaptchaResponse = (e) => {\r\n    setCaptchaResponse(e.response);\r\n    if (e.response) setEnableSubmit(true);\r\n  }\r\n\r\n  const onCaptchaExpire = () => {\r\n    setCaptchaResponse(null);\r\n    setEnableSubmit(false);\r\n  }  \r\n\r\n  function submit(e) {\r\n    e.preventDefault();\r\n\r\n    const final_files = fileUploadRef.current && fileUploadRef.current.files ? \r\n      fileUploadRef.current.files.filter(f=>fileUploadRef.current.isFileSelected(f)).map(f=>f.name) \r\n      :[];    \r\n\r\n    if (!name || !email || !description) {\r\n      setInfoMessage({\r\n        type: 'error',\r\n        message: 'Campos obrigatórios não preenchidos'\r\n      });\r\n      return false;\r\n    } else if (!validateEmail(email)) { \r\n      setInfoMessage({\r\n        type: 'error',\r\n        message: 'Formato de email incorreto'\r\n      }); \r\n      return false;\r\n    } else if (upload_cfg?.minFiles != null && (upload_cfg.minFiles  > final_files.length)) {\r\n      setInfoMessage({\r\n        type: 'error',\r\n        message: `Tem de anexar pelo menos ${upload_cfg.minFiles} ficheiro(s).`\r\n      });\r\n      return false;\r\n    } else if (upload_cfg?.maxFiles !=null && upload_cfg?.maxFiles < final_files.length) {\r\n      setInfoMessage({\r\n        type: 'error',\r\n        message: `Apenas pode anexar até ${upload_cfg.maxFiles} ficheiro(s).`\r\n      });\r\n      return false;\r\n    } else {\r\n      setInfoMessage(null);\r\n    }\r\n      \r\n    let record = {\r\n      name,\r\n      email,\r\n      description\r\n    }\r\n\r\n    if (files && files.length) {\r\n      record['files'] = files.filter(f=>final_files.includes(f.filename));\r\n    }\r\n\r\n    if (showCaptcha) {\r\n      record['captcha'] = captchaResponse;\r\n    }\r\n\r\n    // Save request\r\n    let options = {\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'Content-Type': 'application/json'        \r\n      },\r\n      method: 'POST',\r\n      body: JSON.stringify(record)\r\n    }\r\n\r\n    // Get logged user\r\n    const cookies = new Cookies();\r\n    const logged = cookies.get(core.COOKIE_AUTH_NAME);\r\n    if (logged) options.headers['X-API-KEY'] = logged.token;\r\n\r\n    setSending(true);\r\n\r\n    // Auth url. TODO: check for proxy\r\n    let url = core.API_URL + '/app/viewer/' + viewer.id + '/contact_message';\r\n    fetch(url, options)\r\n      .then(res => res.json())\r\n      .then(res => {\r\n        setSending(false);\r\n        if (res.success) {\r\n          setInfoMessage({\r\n            type: 'success',\r\n            message: res.message\r\n          });\r\n          setIsComplete(true);\r\n        } else {\r\n          setInfoMessage({\r\n            type: 'error',\r\n            message: res.message\r\n          });\r\n          setIsComplete(false);   \r\n        }\r\n      }).catch(error => {\r\n        setSending(false);\r\n        setInfoMessage({\r\n          type: 'error',\r\n          message: 'Ocorreu um erro.'\r\n        });\r\n        setIsComplete(false);\r\n      });\r\n  }\r\n\r\n  const itemTemplate = (file, props) => {\r\n      return (\r\n          <div className=\"p-d-flex p-ai-center p-flex-wrap\">\r\n              <div className=\"p-d-flex p-ai-center\" style={{width: '70%'}}>\r\n                  <span className=\"p-d-flex p-dir-col p-text-left p-ml-0 p-mr-1\" style={{\"wordBreak\": \"break-all\"}}>\r\n                      {file.name}\r\n                  </span>\r\n              </div>\r\n              <Tag value={props.formatSize} className=\"p-px-1 p-py-1\" />\r\n              <Button type=\"button\" icon=\"pi pi-times\" className=\"p-button-outlined p-button-rounded p-button-danger p-ml-auto\" onClick={() => onTemplateRemove(file, props.onRemove)} />\r\n          </div>\r\n      )\r\n  }\r\n\r\n  const emptyTemplate = () => {\r\n      return (\r\n          <div className=\"p-d-flex p-ai-center p-dir-col\">\r\n              <i className=\"pi pi-image p-mt-3 p-p-5\" style={{'fontSize': '5em', borderRadius: '50%', backgroundColor: 'var(--surface-b)', color: 'var(--surface-d)'}}></i>\r\n              <span style={{'fontSize': '1.2em', color: 'var(--text-color-secondary)'}} className=\"p-my-5\">Drag and Drop Image Here</span>\r\n          </div>\r\n      )\r\n  }\r\n\r\n  if (isComplete) {\r\n    return (\r\n      <div className=\"p-fluid\">\r\n        <div className=\"p-field\">\r\n          <label htmlFor=\"contact_name\">Nome</label>\r\n          <InputText\r\n              id=\"contact_name\"\r\n              value={name}\r\n              placeholder=\"Nome\"\r\n              disabled\r\n            />                                 \r\n        </div>\r\n        <div className=\"p-field\">\r\n          <label htmlFor=\"contact_email\">Email</label>\r\n          <InputText\r\n              id=\"contact_email\"\r\n              value={email}\r\n              placeholder=\"Email\"\r\n              disabled\r\n            />                                  \r\n        </div>\r\n        <div className=\"p-field\">\r\n          <label htmlFor=\"contact_description\">Descrição</label>\r\n          <InputTextarea rows={3}\r\n              id=\"contact_description\"\r\n              value={description}\r\n              placeholder=\"Descrição\"\r\n              disabled\r\n            />\r\n        </div>      \r\n        <div className=\"p-field\">    \r\n          <div className=\"p-mb-2\">\r\n            { (infoMessage && infoMessage.type) && \r\n              <Message style={{ width: '100%' }} severity={infoMessage.type} text={infoMessage.message}></Message>\r\n            }\r\n          </div> \r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <form onSubmit={e => submit()}>\r\n\r\n        <div className=\"p-fluid\">\r\n          <div className=\"p-field\">\r\n              <label htmlFor=\"contact_name\">Nome</label>\r\n              <InputText\r\n                  id=\"contact_name\"\r\n                  className={(!name || name.length === 0 ? 'p-invalid' : '')}\r\n                  value={name}\r\n                  placeholder=\"Nome\"\r\n                  disabled={viewer?.user_info?.name}\r\n                  onChange={e => {setName(e.target.value); setInfoMessage(null);}}\r\n                />\r\n                { (!name || name.length === 0) &&\r\n                <small className=\"p-invalid p-d-block\">{config.requiredFieldMessage || 'Campo de preenchimento obrigatório'}</small> }                                  \r\n          </div>\r\n          <div className=\"p-field\">\r\n              <label htmlFor=\"contact_email\">Email</label>\r\n              <InputText\r\n                  id=\"contact_email\"\r\n                  className={(!email || email.length === 0 ? 'p-invalid' : '')}\r\n                  value={email}\r\n                  placeholder=\"Email\"\r\n                  disabled={viewer?.user_info?.email}\r\n                  onChange={e => {setEmail(e.target.value); setInfoMessage(null);}}\r\n                />\r\n                { (!email || email.length === 0) &&\r\n                <small className=\"p-invalid p-d-block\">{config.requiredFieldMessage || 'Campo de preenchimento obrigatório'}</small> }                                  \r\n          </div>\r\n          <div className=\"p-field\">\r\n              <label htmlFor=\"contact_description\">Descrição</label>\r\n              <InputTextarea rows={3}\r\n                  id=\"contact_description\"\r\n                  className={(!description || description.length === 0 ? 'p-invalid' : '')}\r\n                  value={description}\r\n                  placeholder=\"Descrição\"\r\n                  onChange={e => {setDescription(e.target.value); setInfoMessage(null);}}\r\n                />\r\n                { (!description || description.length === 0) &&\r\n                <small className=\"p-invalid p-d-block\">{config.requiredFieldMessage || 'Campo de preenchimento obrigatório'}</small> }\r\n          </div>\r\n\r\n          { upload_cfg.enabled &&\r\n          <div className=\"p-field\">\r\n            <label htmlFor=\"contact_description\">Anexos</label>\r\n\r\n            <FileUpload ref={fileUploadRef} name=\"files[]\"\r\n                uploadOptions={{\"style\" : {\"display\": 'none'}}}\r\n                className=\"contact-form-upload-file\"\r\n                chooseLabel={ upload_cfg.chooseLabel || \"Selecionar\" }\r\n                cancelLabel={ upload_cfg.cancelLabel || \"Limpar\" }\r\n                itemTemplate={itemTemplate}\r\n                onSelect={onFileSelect}\r\n                onRemove={onFileRemove}\r\n                onClear={onFileClear}                               \r\n                multiple\r\n                disabled={isProcessingFiles} \r\n                accept={ upload_cfg.accept || \"image/*, application/pdf\" }\r\n                maxFileSize={ upload_cfg.maxFileSize || 1000000}\r\n                invalidFileSizeMessageSummary=\"{0}\"\r\n                invalidFileSizeMessageDetail={ upload_cfg.invalidFileSizeMessageDetail || \"Ficheiro com dimensão superior ao permitido ({0}).\" }\r\n                emptyTemplate={<p className=\"m-0\">{ upload_cfg.emptyMessage || \"Arraste para aqui o ficheiros a enviar.\" }</p>} \r\n              />\r\n\r\n              { (upload_cfg.maxFileSize) && <small className=\"p-invalid p-d-block\">Tamanho máximo do ficheiro: {(upload_cfg.maxFileSize / 1048576).toFixed(2)} MB</small> } \r\n\r\n          </div> }\r\n          \r\n          { showCaptcha ?\r\n          <div className=\"p-field\">\r\n            <Captcha siteKey={viewer.captcha_key}\r\n              language='pt'\r\n              onResponse={onCaptchaResponse} \r\n              onExpire={onCaptchaExpire}\r\n              />\r\n          </div> : null }\r\n        </div>\r\n        \r\n        <ContactInfo\r\n          viewer={viewer} \r\n          config={config} \r\n        />\r\n                  \r\n        <div className=\"p-mb-2\">\r\n          { (infoMessage && infoMessage.type) && \r\n            <Message style={{ width: '100%' }} severity={infoMessage.type} text={infoMessage.message}></Message>\r\n          }\r\n        </div>                   \r\n\r\n        <div className=\"p-dialog-myfooter\">\r\n          <Button\r\n            className='p-button-secondary'\r\n            icon={ sending ? \"pi pi-spin pi-spinner\": \"pi pi-check\" }\r\n            label=\"Enviar\" \r\n            onClick={submit}\r\n            disabled={!enableSubmit || sending}\r\n          />\r\n        </div>         \r\n      </form>\r\n    </React.Fragment>\r\n  )\r\n}","import React, { useState } from 'react';\r\nimport { Button } from 'primereact/button';\r\nimport { Panel } from 'primereact/panel';\r\nimport { Dialog } from 'primereact/dialog';\r\nimport ContactForm from './ContactForm';\r\nimport ContactInfo from './ContactInfo';\r\n\r\n/**\r\n * Main menu component\r\n */\r\nexport function MainMenu({ className, core, config, actions, record }) {\r\n\r\n  const { viewer, dispatch, Models } = config;\r\n  const { getWindowSize, showOnPortal } = Models.Utils;\r\n\r\n  const [showPopup, setShowPopup] = useState(false);\r\n\r\n  const component_cfg = record.config_json || {};\r\n  const title = record.title || '';\r\n  const header = component_cfg.header || title || \"Formulário de Contacto\";\r\n\r\n  const wsize = getWindowSize();\r\n  const isMobile = wsize[0] <= 768;\r\n\r\n  if (record.as === 'popup') {    \r\n    const closeLabel = component_cfg.closeLabel || \"Fechar\";    \r\n    return (\r\n      <React.Fragment>\r\n\r\n        <Button\r\n          title={title}\r\n          className={className}\r\n          icon=\"far fa-question-circle\"\r\n          style={{ margin: '0.5em 1em' }}\r\n          onClick={e => setShowPopup(true)}\r\n        />\r\n\r\n        {showOnPortal(<Dialog\r\n          header={header}\r\n          visible={showPopup}\r\n          style={{width: isMobile ? '90%' : '45vw' }} \r\n          modal\r\n          footer={(\r\n            <div className=\"p-grid\">\r\n              <div className=\"p-col\" style={{ textAlign: 'right'}}>\r\n                <Button label={closeLabel} onClick={e => setShowPopup(false)} />\r\n              </div>\r\n            </div>\r\n          )}          \r\n          onHide={e => setShowPopup(false)}>\r\n          \r\n          { component_cfg.hideForm !== true ?\r\n            <ContactForm\r\n              core={core}\r\n              viewer={viewer}\r\n              dispatch={dispatch}\r\n              config={component_cfg}\r\n              Utils={Models.Utils}\r\n            />\r\n            :\r\n            <ContactInfo\r\n              core={core}\r\n              viewer={viewer}\r\n              dispatch={dispatch}\r\n              config={component_cfg}\r\n              Utils={Models.Utils}\r\n            />\r\n          }\r\n\r\n        </Dialog>)}\r\n\r\n      </React.Fragment>\r\n    )\r\n  }  else {\r\n    return (\r\n      <Button\r\n        title={title}\r\n        className={className}\r\n        icon=\"far fa-question-circle\"\r\n        style={{ margin: '0.5em 1em' }}\r\n        onClick={e => config.dispatch(actions.viewer_set_selectedmenu(record.id))}\r\n      />\r\n    )\r\n  }\r\n}\r\n\r\nexport default function Main({ region, as, core, config, actions, record }) {\r\n\r\n  const { viewer, dispatch, Models } = config;\r\n  const { getWindowSize, showOnPortal } = Models.Utils;\r\n\r\n  const [showForm, setShowForm] = useState(false);\r\n\r\n  const component_cfg = record.config_json || {};\r\n  const title = record.title || '';\r\n  const header = component_cfg.header || title || \"Formulário de Contacto\";\r\n\r\n  const wsize = getWindowSize();\r\n  const isMobile = wsize[0] <= 768; \r\n\r\n  const closeLabel = component_cfg.closeLabel || \"Fechar\";\r\n\r\n  function renderContent() {\r\n    return  (\r\n      component_cfg.hideForm !== true ?\r\n      <ContactForm\r\n        core={core}\r\n        viewer={viewer}\r\n        dispatch={dispatch}\r\n        config={component_cfg}\r\n        Utils={Models.Utils}\r\n      />\r\n      :\r\n      <ContactInfo\r\n        core={core}\r\n        viewer={viewer}\r\n        dispatch={dispatch}\r\n        config={component_cfg}\r\n        Utils={Models.Utils}\r\n      />\r\n    )\r\n  }\r\n\r\n  if (as === 'panel') {\r\n   return (\r\n    <Panel header={header}>\r\n      { renderContent() }\r\n    </Panel>\r\n   )\r\n   } else {\r\n      return (\r\n        <React.Fragment>\r\n          <button className=\"p-link\" onClick={e => setShowForm(true)} title=\"Contacto\">\r\n            <span className=\"layout-topbar-item-text\"></span>\r\n            <span className=\"layout-topbar-icon far fa-envelope\" />\r\n          </button>\r\n\r\n          {showOnPortal(<Dialog\r\n            header={header}\r\n            visible={showForm}\r\n            style={{width: isMobile ? '90%' : '45vw' }} \r\n            modal\r\n            footer={(\r\n              <div className=\"p-grid\">\r\n                <div className=\"p-col\" style={{ textAlign: 'right'}}>\r\n                  <Button label={closeLabel} onClick={e => setShowForm(false)} />\r\n                </div>\r\n              </div>\r\n            )}             \r\n            onHide={e => setShowForm(false)}>\r\n              { component_cfg.hideForm !== true ?\r\n              <ContactForm\r\n                core={core}\r\n                viewer={viewer}\r\n                dispatch={dispatch}\r\n                config={component_cfg}\r\n                Utils={Models.Utils}\r\n              />\r\n              :\r\n              <ContactInfo\r\n                core={core}\r\n                viewer={viewer}\r\n                dispatch={dispatch}\r\n                config={component_cfg}\r\n                Utils={Models.Utils}\r\n              />\r\n              }\r\n\r\n          </Dialog>)}\r\n\r\n        </React.Fragment>\r\n      )       \r\n   }\r\n\r\n}","import React, { useState, useEffect } from 'react'\r\nimport { DataView, DataViewLayoutOptions } from 'primereact/dataview';\r\nimport { TabView,TabPanel } from 'primereact/tabview';\r\nimport { transform } from 'ol/proj'\r\nimport { Button } from 'primereact/button'\r\nimport {SplitButton} from 'primereact/splitbutton';\r\nimport { Message } from 'primereact/message';\r\nimport { Dropdown } from 'primereact/dropdown';\r\nimport { InputText } from 'primereact/inputtext';\r\nimport { InputMask } from 'primereact/inputmask';\r\nimport { InputNumber } from 'primereact/inputnumber';\r\nimport { RadioButton } from 'primereact/radiobutton';\r\nimport OlFeature from 'ol/Feature';\r\nimport OlPoint from 'ol/geom/Point'\r\nimport OlFormatGeoJSON from 'ol/format/GeoJSON';\r\nimport * as OlProj from 'ol/proj';\r\nimport { v4 as uuidV4 } from 'uuid';\r\nimport './style.css'\r\nimport { last } from 'underscore';\r\n\r\nexport default function Coordinates({ core, config, actions, dispatch, record }) {\r\n\r\n  const { viewer, mainMap, Models } = config;  \r\n  const { getProjectionSrid } = Models.MapModel;  \r\n  const { coordinates }  = viewer;\r\n\r\n  const [listCRS, setListCRS] = useState([]);\r\n  const [CRS, setCRS] = useState(null);\r\n  const [coordX, setCoordX] = useState(null);\r\n  const [coordY, setCoordY] = useState(null);\r\n  const [units, setUnits] = useState('m');\r\n  const [showDegrees, setShowDegrees] = useState(false);\r\n  const [optLatitude, setOptLatitude] = useState('N');\r\n  const [optLongitude, setOptLongitude] = useState('W');\r\n  const [coordLon, setCoordLon] = useState(null);\r\n  const [coordLat, setCoordLat] = useState(null);\r\n  const [newCoord, setNewCoord] = useState(null);\r\n\r\n\r\n  const buildSaveBtnItems = data => {\r\n    const btns = [\r\n      {\r\n          label: 'CSV',\r\n          icon: 'pi pi-align-justify',\r\n          data: data,\r\n          command: (e) => {\r\n            exportItem(e.item.data, 'csv');\r\n          }\r\n      },\r\n      {\r\n          label: 'GeoJSON',\r\n          icon: 'pi pi-globe',\r\n          data: data,\r\n          command: (e) => {\r\n            exportItem(e.item.data, 'geojson');\r\n          }\r\n      }\r\n    ]\r\n\r\n    return btns;\r\n  }\r\n\r\n  const serializeCoordinatesGeoJSON = (list) => {\r\n    const features = [];\r\n\r\n    const component_cfg = record ? record.config_json : null;\r\n\r\n    let crs = null;\r\n    if (component_cfg && component_cfg.export_crs) {\r\n      crs = component_cfg.export_crs;\r\n    } else if (viewer.config_json && viewer.config_json.export_crs) {\r\n      crs = viewer.config_json.export_crs;    \r\n    } else if (viewer.config_json && viewer.config_json.display_crs) {\r\n      crs = viewer.config_json.display_crs;\r\n    } else {\r\n      crs = 4326;\r\n    }\r\n\r\n    const parser = new OlFormatGeoJSON();\r\n    const parseOptions = {\r\n      dataProjection: 'EPSG:' + crs,\r\n      featureProjection: mainMap.getView().getProjection().getCode()\r\n    };\r\n\r\n    list.forEach(item => {\r\n      const rec =  new OlFeature({\r\n        geometry: new OlPoint(item.coordinates)\r\n      });\r\n\r\n      Object.entries(item.results).map(([key, elem]) => {\r\n        let found = true;            \r\n        if (listCRS && listCRS.length) {\r\n          const ss = listCRS.find(c => c.value == key);\r\n          if (!ss) {\r\n            found = false;\r\n          } \r\n        }\r\n        if (found) {\r\n          const field_prefix = (key || '').replace(':','');\r\n\r\n          rec.set(field_prefix + '_x', elem.coordinates[0]);\r\n          rec.set(field_prefix + '_y', elem.coordinates[1]);\r\n        }\r\n      });\r\n\r\n      features.push(rec);\r\n    });\r\n\r\n    //const geojson = parser.writeFeatures(features, parseOptions);\r\n    const geojson = parser.writeFeaturesObject(features, parseOptions);\r\n\r\n    // Hack: OL does not serialize with CRS attribute\r\n    //json.crs = { \"type\": \"name\", \"properties\": { \"name\": \"urn:ogc:def:crs:EPSG::4326\" } }\r\n    const crsinfo = {\r\n      \"type\": \"name\",\r\n      \"properties\": {\r\n          \"name\": \"urn:ogc:def:crs:EPSG::\" + crs\r\n      }\r\n    };\r\n    geojson.crs = crsinfo;    \r\n    const data = JSON.stringify(geojson);\r\n\r\n    return data;\r\n  }\r\n\r\n  const serializeCoordinatesCSV = (list) => {\r\n    \r\n    if (list == null || !list.length) {\r\n      return null;\r\n    }    \r\n    \r\n    const col_dlm = ';';\r\n    const ln_dlm = '\\n';\r\n\r\n    const keys  = [];\r\n    let csv = '';\r\n    \r\n    //Build field names\r\n    const fields = [];\r\n    Object.entries(list[0].results).map(([key, elem]) => {\r\n      let found = true;            \r\n      if (listCRS && listCRS.length) {\r\n        const ss = listCRS.find(c => c.value == key);\r\n        if (!ss) {\r\n          found = false;\r\n        } \r\n      }\r\n      if (found) {\r\n        keys.push(key);      \r\n        const field_prefix = (key || '').replace(':','');      \r\n        fields.push((field_prefix + '_x').replace(':',''));\r\n        fields.push((field_prefix + '_y').replace(':',''));\r\n      }\r\n    });\r\n    csv = fields.join(col_dlm);\r\n    csv += ln_dlm;\r\n\r\n    //Build values\r\n    const rows = [];\r\n    list.forEach(item => {\r\n      let values = [];     \r\n      keys.forEach(key => {\r\n        let found = true;            \r\n        if (listCRS && listCRS.length) {\r\n          const ss = listCRS.find(c => c.value == key);\r\n          if (!ss) {\r\n            found = false;\r\n          } \r\n        }\r\n        if (found) {\r\n          values.push(item.results[key].coordinates[0]);\r\n          values.push(item.results[key].coordinates[1]);\r\n        }\r\n      });\r\n      rows.push(values.join(col_dlm));\r\n    });\r\n    csv += rows.join(ln_dlm);\r\n\r\n    return csv;\r\n  }  \r\n\r\n  function transformCoordinates () {\r\n    let x;\r\n    let y;\r\n\r\n    if (units === 'dms') {\r\n      if (!coordLon || !coordLat) return;\r\n\r\n      x = convertDMS2DD(optLongitude + ' ' + coordLon);\r\n      y = convertDMS2DD(optLatitude + ' ' + coordLat);\r\n      setCoordX(x);\r\n      setCoordY(y);\r\n    } else {\r\n      x = coordX;\r\n      y = coordY;\r\n    }\r\n\r\n    if (!(CRS && (x != null) || (x != null))) return;\r\n\r\n    const trans_coords = {};\r\n\r\n    const new_coords = transform([parseFloat(x), parseFloat(y)], CRS, mainMap.getView().getProjection());\r\n\r\n    viewer.config_json.crs_list.forEach(crs => {\r\n      const coords = transform(new_coords,  mainMap.getView().getProjection(), crs.code);\r\n      trans_coords[crs.code] = { code: crs.code, title: crs.title, description: crs.description, \r\n        srid: crs.srid, precision: crs.precision, coordinates: coords }\r\n    }); \r\n\r\n    let item = { id: uuidV4(), coordinates: new_coords, crs: mainMap.getView().getProjection().getCode(), results: trans_coords };\r\n    setNewCoord(item);\r\n    zoomItem(item);\r\n  }\r\n\r\n  function transformCoordinatesByApi() {\r\n\r\n    let x;\r\n    let y;\r\n\r\n    if (units === 'dms') {\r\n      if (!coordLon || !coordLat) return;\r\n\r\n      x = convertDMS2DD(optLongitude + ' ' + coordLon);\r\n      y = convertDMS2DD(optLatitude + ' ' + coordLat);\r\n      setCoordX(x);\r\n      setCoordY(y);\r\n    } else {\r\n      x = coordX;\r\n      y = coordY;\r\n    }\r\n\r\n    if (!(CRS && (x != null) || (x != null))) return;\r\n\r\n    const url = core.API_URL + '/app/utils/transcoord';\r\n\r\n    let options = {\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'Content-Type': 'application/json'        \r\n      },\r\n      method: 'POST',\r\n      body: JSON.stringify({ x: x, y: y, srid: getProjectionSrid(CRS)})\r\n    }\r\n\r\n    fetch(url, options).then(res => {\r\n        return res.json();\r\n    }).then(result => {\r\n        if (result.results) {\r\n          const trans_coords = {};\r\n          viewer.config_json.crs_list.forEach(crs => {\r\n            let coords = [];\r\n            if (result.results[crs.code]) {\r\n              coords = [result.results[crs.code].x, result.results[crs.code].y];\r\n              trans_coords[crs.code] = { code: crs.code, title: crs.title, description: crs.description, \r\n                srid: crs.srid, precision: crs.precision, coordinates: coords }\r\n            }\r\n          });          \r\n          const new_coords = trans_coords[mainMap.getView().getProjection().getCode()].coordinates;    \r\n          const item = { id: uuidV4(), coordinates: new_coords, crs: mainMap.getView().getProjection().getCode(), results: trans_coords };\r\n          setNewCoord(item);\r\n          zoomItem(item);\r\n        }\r\n    })\r\n    .catch(error => {\r\n        console.log('error', error);\r\n    })\r\n  }   \r\n  \r\n\tfunction convertDMS2DD (dms) {\r\n    var val = null;\r\n\r\n    var parts = dms.replace(\"º\", \"\").replace(\"''\",\"\").replace(\"'\",\"\").split(\" \");\r\n\r\n    parts[1] = parseInt(parts[1]);\r\n    parts[2] = parseInt(parts[2]);\r\n    parts[3] = parseFloat(parts[3]);\r\n\r\n    val = parts[1] + parts[2]/60 + parts[3]/3600;\r\n    if (parts[0] == 'W' || parts[0] == 'O' || parts[0] == 'S') {\r\n        val = val * -1;\r\n    }\r\n    return val;\r\n  }\r\n\r\n  function convertDD2DMS (deg, is_lon) {\r\n      var val = null;\r\n\r\n      var d = Math.floor(Math.abs(deg));\r\n      var minfloat = (Math.abs(deg)-d)*60;\r\n      var m = Math.floor(minfloat);\r\n      var secfloat = (minfloat-m)*60;\r\n      var s = parseFloat(Math.round(secfloat * 100) / 100).toFixed(2);\r\n\r\n      if (is_lon) {\r\n          val = (\"000\" + Math.abs(d)).slice(-3) + \"º \" + (\"00\" + m).slice(-2) + \"' \" + (\"0000\" + s).slice(-5) + \"''\";\r\n      } else {\r\n          val = (\"00\" + Math.abs(d)).slice(-2) + \"º \" + (\"00\" + m).slice(-2) + \"' \" + (\"0000\" + s).slice(-5) + \"''\";\r\n      }\r\n\r\n      return  val;\r\n  }  \r\n  \r\n  function download(filename, text, format) {\r\n    const element = document.createElement('a');\r\n    element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));\r\n    element.setAttribute('download', filename + '.' + format);\r\n    element.style.display = 'none';\r\n    document.body.appendChild(element);\r\n    element.click();\r\n    document.body.removeChild(element);\r\n  }\r\n\r\n  // Remove all items\r\n  function removeAll() {\r\n    dispatch(actions.viewer_set_coordinates([]));\r\n  }\r\n\r\n  // Zoom to coordinates\r\n  function zoomItem(item) {\r\n    if (item && item.coordinates) {\r\n      const coords = transform(item.coordinates, item.crs || mainMap.getView().getProjection(), mainMap.getView().getProjection());\r\n      const extent = [coords[0] - 500, coords[1] - 500, \r\n                      coords[0] + 500, coords[1] + 500];\r\n\r\n      const srid = getProjectionSrid(mainMap.getView().getProjection()); \r\n      dispatch(actions.map_set_extent(coords, extent));\r\n    }\r\n  }\r\n\r\n  // Export item\r\n  function exportItem(data, format='geojson') {\r\n    let text = '';\r\n    switch (format) {\r\n      case 'csv':\r\n        text = serializeCoordinatesCSV([data], format);\r\n        break;\r\n      case 'geojson':\r\n        text = serializeCoordinatesGeoJSON([data], format);\r\n        break;\r\n      default:\r\n        text = serializeCoordinatesGeoJSON([data], format);\r\n    }\r\n    download('coordenadas', text, format);\r\n  }\r\n\r\n  // Export all results\r\n  function exportAll(format='geojson') {\r\n    let text = '';\r\n    switch (format) {\r\n      case 'csv':\r\n        text = serializeCoordinatesCSV(coordinates, format);\r\n        break;\r\n      case 'geojson':\r\n        text = serializeCoordinatesGeoJSON(coordinates, format);\r\n        break;\r\n      default:\r\n        text = serializeCoordinatesGeoJSON(coordinates, 'geojson');\r\n    }    \r\n    download('coordenadas', text, format);\r\n  }  \r\n\r\n  // Remove one item\r\n  function removeItem(item) {\r\n    let index = coordinates.findIndex(c => c.id === item.id);\r\n    if (index === -1) return;\r\n    let updated = [...coordinates];\r\n    updated.splice(index, 1);\r\n    dispatch(actions.viewer_set_coordinates(updated));\r\n  }   \r\n\r\n  function renderCoordinatesItem(data) {\r\n    return (data ? (\r\n      <div className=\"p-col-12 coordinates-item\">\r\n        <div className=\"coordinates-item-tools p-text-right\">\r\n          <Button\r\n            title=\"Aproximar ao elemento\"\r\n            icon=\"pi pi-search\"\r\n            onClick={e => zoomItem(data)}\r\n          />\r\n          <SplitButton label=\"\" icon=\"pi pi-download\" model={buildSaveBtnItems(data)} />\r\n          <Button\r\n            title=\"Remover elemento\"\r\n            icon=\"pi pi-times\"\r\n            onClick={e => removeItem(data)}\r\n          />\r\n        </div>              \r\n        <table>\r\n          { Object.entries(data.results).map(([key, item]) => {\r\n            let found = true;            \r\n            if (listCRS && listCRS.length) {\r\n              const ss = listCRS.find(c => c.value == key);\r\n              if (!ss) {\r\n                found = false;\r\n              } \r\n            }\r\n\r\n            if (found) {\r\n              let crs_units = 'm';\r\n              const prj = OlProj.get(item.code);\r\n              if (prj) {\r\n                crs_units = prj.getUnits();\r\n              }\r\n\r\n              return <React.Fragment>\r\n                <tr>\r\n                  <td colspan=\"2\" className=\"coordinates-item-title\">{item.title} ({item.code})</td>\r\n                </tr>          \r\n                <tr>\r\n                  <td>{crs_units === 'degrees'? 'lon (dd): ' : (crs_units ? 'x (' +  crs_units + '): ': 'x: ')}<span>{(Math.round(item.coordinates[0] * item.precision)  / item.precision)}</span></td>\r\n                  <td>{crs_units === 'degrees'? 'lat (dd): ' : (crs_units ? 'y (' +  crs_units + '): ': 'y: ')}<span>{(Math.round(item.coordinates[1] * item.precision)  / item.precision)}</span></td>\r\n                </tr>\r\n                {crs_units === 'degrees' && \r\n                <tr>\r\n                  <td>lon: <span>{convertDD2DMS(item.coordinates[0], true)}  {item.coordinates[0] < 0 ? 'W': 'E'}</span></td>\r\n                  <td>lat: <span>{convertDD2DMS(item.coordinates[1], false)}  {item.coordinates[1] < 0 ? 'S': 'N'}</span></td>\r\n                </tr>}\r\n              </React.Fragment>\r\n            } else {\r\n              return null;\r\n            }\r\n          }) }\r\n        </table>\r\n      </div> ) : null\r\n    );\r\n  }\r\n\r\n  function itemTemplate(item, layout) {\r\n    if (layout === 'list')\r\n      return item && renderCoordinatesItem(item);\r\n    else if (layout === 'grid')\r\n      return null;\r\n  }  \r\n\r\n  useEffect(()=>{\r\n    let list = viewer.config_json.crs_list.map( item => ({ label: (item.title + ' (' + item.code + ')'),\r\n      value: item.code}));\r\n\r\n    if (record && record.config_json && record.config_json.crs_list && record.config_json.crs_list.length) {\r\n      list = (viewer.config_json.crs_list || []).filter( c => {\r\n        return record.config_json.crs_list.includes(c.srid);\r\n      }).map( item => ({ label: (item.title + ' (' + item.code + ')'), value: item.code}));\r\n    }\r\n\r\n    setListCRS(list);\r\n  }, []);\r\n\r\n  useEffect(() => {      \r\n    if (newCoord) dispatch(actions.viewer_set_coordinates([newCoord, ...coordinates]));\r\n  }, [newCoord]);   \r\n\r\n  useEffect(() => {\r\n    let isDegrees = false;\r\n    if (CRS) {\r\n      const prj = OlProj.get(CRS);\r\n      if (prj) {\r\n        const units = prj.getUnits();\r\n        if (units === 'degrees') isDegrees = true;\r\n      }\r\n    }\r\n    if (isDegrees) {\r\n      setCoordX(null);\r\n      setCoordY(null);\r\n      setCoordLat(null);\r\n      setCoordLon(null);\r\n    }    \r\n    setShowDegrees(isDegrees);\r\n    setUnits(isDegrees ? 'dd' : 'm');\r\n  }, [CRS]);\r\n\r\n  useEffect(() => {\r\n\r\n    if (!showDegrees) return;\r\n\r\n    if (units==='dd' && coordLon && coordLat) {\r\n      const x = convertDMS2DD(optLongitude + ' ' + coordLon);\r\n      const y = convertDMS2DD(optLatitude + ' ' + coordLat);\r\n      setCoordX(x);\r\n      setCoordY(y);\r\n    } else if (units==='dms' && coordX && coordY) {\r\n      const lon = convertDD2DMS(Math.abs(coordX), true);\r\n      const lat = convertDD2DMS(Math.abs(coordY), false);\r\n      setCoordLon(lon);\r\n      setOptLongitude(coordX < 0 ? 'W': 'E');\r\n      setCoordLat(lat);\r\n      setOptLatitude(coordY < 0 ? 'S': 'N');      \r\n    }\r\n  }, [units]);\r\n\r\n  useEffect(() => {\r\n    if (coordinates && coordinates.length > 0) dispatch(actions.viewer_set_selectedmenu('coordinates'));\r\n  }, [coordinates]);\r\n\r\n  /*\r\n  useEffect(()=>{\r\n    buildResultsTable();\r\n  }, [coordinates]);\r\n  */\r\n\r\n  {/*\r\n  if (!coordinates || coordinates.length == 0) return (\r\n    <Message\r\n      severity=\"info\"\r\n      text={\"Ative o botão 'Obter coordenadas' e clique no mapa.\"} \r\n    />\r\n  )\r\n  */}\r\n\r\n  return (\r\n    <div>\r\n\r\n      { ( !coordinates || !coordinates.length ?\r\n          <div className=\"p-mt-2 p-mb-3\">\r\n            <Message\r\n              severity=\"info\"\r\n              text=\"Clique no mapa para obter as coordenadas ou indique os seus valores através seguinte formulário.\" \r\n            />\r\n          </div> : null \r\n      ) }\r\n\r\n      {(showDegrees &&\r\n      <React.Fragment>\r\n        <div className=\"p-fluid p-formgrid p-grid p-mt-2\">\r\n          <div className=\"p-field p-col-12\">\r\n            <label htmlFor=\"coordsys\">Sistema de Coordenadas</label>\r\n            <Dropdown options={listCRS} value={CRS} onChange={(e) => setCRS(e.value)} placeholder=\"Selecione um CRS\"/>\r\n          </div>\r\n          <div className=\"p-field p-col-12\">\r\n            <div className=\"p-formgroup-inline flex-no-wrap\">\r\n                <div className=\"p-field-checkbox\">\r\n                    <RadioButton value=\"dd\" onChange={(e) => setUnits(e.value)} checked={units === 'dd'}  />\r\n                    <label>Graus decimais</label>\r\n                </div>\r\n                <div className=\"p-field-checkbox\">\r\n                    <RadioButton value=\"dms\" onChange={(e) => setUnits(e.value)} checked={units === 'dms'}  />\r\n                    <label>Graus / Minutos / Segundos</label>\r\n                </div>\r\n            </div>\r\n          </div>\r\n          <div className=\"p-field p-col-12\">\r\n          { units === 'dd' &&\r\n            <div className=\"p-fluid p-formgrid p-grid\">\r\n              <div className=\"p-field p-col\">\r\n                <label>Longitude</label>\r\n                <InputNumber value={coordX} onValueChange={(e) => setCoordX(e.value)} mode=\"decimal\" minFractionDigits={1} maxFractionDigits={8} className=\"p-inputtext-sm\" />\r\n              </div>\r\n              <div className=\"p-field p-col\">\r\n                <label>Latitude</label>              \r\n                <InputNumber value={coordY} onValueChange={(e) => setCoordY(e.value)} mode=\"decimal\" minFractionDigits={1} maxFractionDigits={8} className=\"p-inputtext-sm\" />\r\n              </div>\r\n            </div>          \r\n          }\r\n          { units === 'dms' &&\r\n            <div className=\"p-fluid p-formgrid p-grid\">\r\n              <div className=\"p-field p-col\">\r\n                <label>Longitude</label>\r\n                <div className=\"p-inputgroup\">\r\n                  <select value={optLongitude} onChange={e => setOptLongitude(e.target.value)}>\r\n                    <option value=\"E\">E</option>\r\n                    <option value=\"W\">W</option>\r\n                  </select>\r\n                  <InputMask mask=\"999º 99' 99?.99''\" value={coordLon} onChange={(e) => setCoordLon(e.value)} />\r\n                </div>\r\n              </div>\r\n              <div className=\"p-field p-col\">\r\n                <label>Latitude</label>\r\n                <div className=\"p-inputgroup\">\r\n                <select value={optLatitude} onChange={e => setOptLatitude(e.target.value)}>\r\n                    <option value=\"N\">N</option>\r\n                    <option value=\"S\">S</option>\r\n                  </select>\r\n                  <InputMask mask=\"99º 99' 99?.99''\" value={coordLat} onChange={(e) => setCoordLat(e.value)} />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          }\r\n          </div>\r\n        </div>\r\n      </React.Fragment>      \r\n      )}\r\n      {(!showDegrees &&\r\n      <React.Fragment>\r\n        <div className=\"p-fluid p-formgrid p-grid p-mt-2\">\r\n            <div className=\"p-field p-col-12\">\r\n              <label htmlFor=\"coordsys\">Sistema de Coordenadas</label>\r\n              <Dropdown options={listCRS} value={CRS} onChange={(e) => setCRS(e.value)} placeholder=\"Selecione um CRS\"/>\r\n            </div>\r\n            <div className=\"p-field p-col\">\r\n                <label htmlFor=\"coordX\">X</label>\r\n                <InputNumber id=\"coordX\" value={coordX} onValueChange={(e) => setCoordX(e.value)} mode=\"decimal\" minFractionDigits={1} maxFractionDigits={8} className=\"p-inputtext-sm\" />\r\n            </div>\r\n            <div className=\"p-field p-col\">\r\n                <label htmlFor=\"coordY\">Y</label>              \r\n                <InputNumber id=\"coordY\" value={coordY} onValueChange={(e) => setCoordY(e.value)} mode=\"decimal\" minFractionDigits={1} maxFractionDigits={8} className=\"p-inputtext-sm\" />\r\n            </div>\r\n        </div>      \r\n      </React.Fragment>)}\r\n      <div className=\"card p-text-center\">\r\n        <Button\r\n            label=\"Localizar\"\r\n            icon=\"pi pi-pi-search\"\r\n            className=\"p-button-md\"\r\n            onClick={e => { transformCoordinatesByApi(); }}\r\n        />\r\n        </div>           \r\n\r\n      { ( coordinates && coordinates.length && coordinates.length > 0 ? \r\n        <React.Fragment>\r\n          <hr className=\"rounded\" />\r\n\r\n          <div style={ {padding: \"1rem 0\", textAlign: \"right\"} }>\r\n            <Button\r\n              title=\"Limpar resultados\"\r\n              label=\"Limpar\"\r\n              icon=\"pi pi-times\"\r\n              className=\"p-button-outlined p-button-sm\"\r\n              onClick={e => removeAll()}\r\n            />\r\n            <Button\r\n              title=\"Exportar resultados\"\r\n              label=\"CSV\"\r\n              icon=\"pi pi-download\"\r\n              className=\"p-button-outlined p-button-sm p-ml-2\"\r\n              onClick={e => exportAll('csv')}\r\n            />\r\n            <Button\r\n              title=\"Exportar resultados\"\r\n              label=\"GeoJSON\"\r\n              icon=\"pi pi-download\"\r\n              className=\"p-button-outlined p-button-sm p-ml-2\"\r\n              onClick={e => exportAll('geojson')}\r\n            />                       \r\n          </div>         \r\n\r\n          { renderCoordinatesItem(coordinates[0]) }\r\n        </React.Fragment> : null \r\n      ) }\r\n\r\n      { ( coordinates.length > 1 ?\r\n        <React.Fragment><h4>Resultados anteriores</h4>\r\n          <DataView value={coordinates.slice(1)} layout=\"list\"\r\n            itemTemplate={itemTemplate} paginator alwaysShowPaginator={false} pageLinkSize={2} rows={9} style={{fontSize: \".8rem\"}} />\r\n        </React.Fragment> : null)\r\n      }    \r\n\r\n    </div>\r\n  )\r\n\r\n}","import React, { useEffect } from 'react'\r\nimport { Button } from 'primereact/button'\r\nimport OLGroupLayer from \"ol/layer/Group\"\r\nimport { Panel } from 'primereact/panel'\r\nimport Coordinates from './Coordinates'\r\nimport './style.css'\r\n\r\n/**\r\n * Main menu component\r\n */\r\nexport function MainMenu({ className, config, actions, record }) {\r\n\r\n  const component_cfg = record.config_json || {};\r\n  const title = record.title || 'Pesquisa por Coordenadas';\r\n\r\n  return (\r\n    <Button\r\n      title={title}\r\n      className={className}\r\n      icon=\"fas fa-bullseye\"\r\n      style={{ margin: '0.5em 1em' }}\r\n      onClick={e => config.dispatch(actions.viewer_set_selectedmenu(record.id))}\r\n    />\r\n  )\r\n}\r\n\r\nexport default function Main({ as, core, config, actions, record }) {\r\n\r\n  const { viewer, dispatch, Models } = config;\r\n  const { getWindowSize, showOnPortal } = Models.Utils;\r\n  const { selected_menu } = viewer.config_json;\r\n\r\n  const component_cfg = record.config_json || {};\r\n  const title = record.title || 'Pesquisa por Coordenadas';\r\n  const header = component_cfg.header || title;\r\n\r\n  const wsize = getWindowSize();\r\n  const isMobile = wsize[0] <= 768;\r\n\r\n  useEffect(() => {\r\n    if (selected_menu === 'coordinates') dispatch(actions.viewer_set_exclusive_mapcontrol('Coordinates'));\r\n  }, [selected_menu]);\r\n\r\n  useEffect(() => {\r\n    if (selected_menu === 'coordinates') {\r\n      if (!isMobile && component_cfg.expand_menu === true) {\r\n        dispatch(actions.layout_show_menu(true));\r\n      }\r\n      if (isMobile && component_cfg.expand_menu_mobile === true) {\r\n        dispatch(actions.layout_show_menu(false));\r\n      }\r\n    }\r\n  }, [viewer.coordinates]); \r\n\r\n  // Render content\r\n  function renderContent() {\r\n    return (\r\n      <div className=\"coordinates\">\r\n        <Coordinates\r\n          core={core}\r\n          config={config}\r\n          actions={actions}\r\n          dispatch={dispatch}\r\n          record={record}\r\n        />\r\n      </div>\r\n    )\r\n    \r\n  }\r\n\r\n  if (as === 'panel') return (\r\n    <Panel header={header}>\r\n      { renderContent() }\r\n    </Panel>\r\n  )\r\n\r\n  return null\r\n}","import React, { useEffect, useRef, useState } from 'react';\r\nimport { Dropdown } from 'primereact/dropdown';\r\nimport { InputText } from 'primereact/inputtext';\r\nimport { containsCoordinate } from 'ol/extent';\r\nimport { transform } from 'ol/proj';\r\nimport MousePosition from 'ol/control/MousePosition';\r\nimport {createStringXY} from 'ol/coordinate';\r\nimport './index.css'\r\n\r\nfunction parseExtent(extent) {\r\n  if (!extent) return [0,0,1,1];\r\n  return extent.split(' ').map(v => Number(v));\r\n}\r\n\r\nfunction isCoordInExtent(coords, proj_coords, extent) {\r\n  if (!coords) return false;\r\n  const wgsCoords = transform(coords, proj_coords, 'EPSG:4326');\r\n  return containsCoordinate(parseExtent(extent), wgsCoords) === false\r\n}\r\n\r\nexport default function Main({ config, actions, record }) {\r\n  const { viewer, mainMap, dispatch } = config;\r\n  const { display_crs, center } = viewer.config_json;\r\n  const { viewer_set_displaycrs } = actions;\r\n  \r\n  const [listCRS, setListCRS] = useState(viewer.config_json.crs_list || []);\r\n\r\n  const cursorRef = useRef()\r\n\r\n  const handleChange = (event) => {\r\n    dispatch(viewer_set_displaycrs(event.value));\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (record && record.config_json && record.config_json.crs_list && record.config_json.crs_list.length) {\r\n      let crs_filtered = (viewer.config_json.crs_list || []).filter( c => {\r\n        return record.config_json.crs_list.includes(c.srid);\r\n      });\r\n      setListCRS(crs_filtered);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const selected = listCRS.find(v => v.srid === display_crs);\r\n    let precision = String(selected.precision).length-1;\r\n    const mousePosition = new MousePosition({\r\n      target:  cursorRef.current,\r\n      coordinateFormat: createStringXY(precision),\r\n      className: 'viewer-mouse-position',\r\n      projection: 'EPSG:' + display_crs\r\n    });\r\n    mainMap.addControl(mousePosition);\r\n\r\n    // Cleanup on dismount\r\n    return () => {\r\n      mainMap.removeControl(mousePosition);\r\n    }\r\n  }, [display_crs]);\r\n\r\n  // On change center, change display_crs if necessary\r\n  useEffect(() => {\r\n    let changeCRS = false;\r\n    const proj_code = mainMap.getView().getProjection().getCode();\r\n    if (display_crs && center) {\r\n      listCRS.map(i => {\r\n        const disabled = isCoordInExtent(center, proj_code, i.extent)\r\n        if ((i.srid === display_crs) && disabled) changeCRS = true;\r\n        return i;\r\n      });\r\n      if (changeCRS) dispatch(viewer_set_displaycrs(4326));\r\n    }\r\n  }, [center]);\r\n\r\n  // Prepare render options\r\n  if (listCRS.length === 0) return null;\r\n  let proj_code = mainMap ? mainMap.getView().getProjection().getCode() : 'EPSG:3857';\r\n  let display = center;\r\n  let selected = listCRS.find(v => v.srid === display_crs);\r\n  if (selected.code !== proj_code) display = transform(center, proj_code, 'EPSG:' + selected.srid);\r\n  let fixedLength = String(selected.precision).length-1;\r\n  display = display.map(v => (Math.round(parseFloat(v) * selected.precision) / selected.precision).toFixed(fixedLength));\r\n  return (\r\n    <div className=\"crsselect\">\r\n      <div id=\"cursor_coords\" ref={cursorRef}></div>\r\n      <Dropdown \r\n        value={display_crs} \r\n        options={listCRS.map(i => {\r\n          return {\r\n            ...i,\r\n            value: i.srid,\r\n            label: i.label || i.title,\r\n            disabled: isCoordInExtent(center, proj_code, i.extent)\r\n          }\r\n        })} \r\n        onChange={handleChange} \r\n        placeholder={listCRS ? listCRS.find(v => v.srid === display_crs).label : 'Escolha'}\r\n      />      \r\n      {/*\r\n      <InputText \r\n        value={display.join(selected.separator)}\r\n        readOnly \r\n        style={{ width: '240px' }}\r\n        className=\"p-inputtext-sm p-d-block p-mb-2\"\r\n      />\r\n      */}\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { Button } from 'primereact/button';\r\nimport { InputText } from 'primereact/inputtext';\r\nimport { Dropdown } from 'primereact/dropdown';\r\nimport { DataTable } from 'primereact/datatable';\r\nimport { Column } from 'primereact/column';\r\nimport OlFormatWKT from \"ol/format/WKT\";\r\nimport OlFormatGeoJSON from \"ol/format/GeoJSON\";\r\nimport OlInteractionDragPan from \"ol/interaction/DragPan\";\r\nimport OlInteractionDoubleClickZoom from \"ol/interaction/DoubleClickZoom\";\r\nimport OlInteractionPinchZoom from \"ol/interaction/PinchZoom\";\r\nimport OlInteractionDraw from \"ol/interaction/Draw\";\r\nimport OlInteractionModify from \"ol/interaction/Modify\";\r\nimport OlInteractionSelect from \"ol/interaction/Select\";\r\nimport { shiftKeyOnly, singleClick } from \"ol/events/condition\";\r\nimport OlCollection from \"ol/Collection\";\r\nimport { SketchPicker as CompactPicker } from 'react-color';\r\nimport FileSaver from 'file-saver';\r\nimport './index.css';\r\n\r\nconst drawElementsOptions = [\r\n  { value: \"symbol\", title: \"Adicionar símbolo\", icon: \"pi pi-star-o\" },\r\n  { value: \"text\", title: \"Adicionar texto\", icon: \"pi pi-info-circle\" },\r\n  { value: \"point\", title: \"Adicionar ponto\", icon: \"pi pi-circle-on\" },\r\n  { value: \"line\", title: \"Adicionar linha\", icon: \"pi pi-minus\" },\r\n  { value: \"polygon\", title: \"Adicionar polígono\", icon: \"pi pi-th-large\" }  \r\n];\r\n\r\nconst selectTools = [\r\n  { value: \"select\", title: \"Selecionar\", icon: \"pi pi-pencil\" }\r\n]\r\n\r\nconst historyTools = [\r\n  { value: \"undo\", title: \"Desfazer\", icon: \"pi pi-replay\" },\r\n  { value: \"redo\", title: \"Refazer\", icon: \"pi pi-refresh\" },\r\n  { value: \"clear\", title: \"Limpar Tudo\", icon: \"pi pi-trash\" }\r\n];\r\n\r\nconst colorTools = [\r\n  { value: \"fill\", title: \"Côr de preenchimento\", icon: \"pi pi-palette\" },\r\n  { value: \"stroke\", title: \"Côr de rebordo\", icon: \"pi pi-palette\" }\r\n];\r\n\r\nconst defaultExportFormats = [\r\n  { value: \"geojson\", title: \"GeoJSON\", icon: \"pi pi-file\", tooltip: \"Exportar para ficheiro GeoJSON\" },\r\n  { value: \"gml\", title: \"GML\", icon: \"pi pi-file\", tooltip: \"Exportar para ficheiro GML\" },\r\n  { value: \"shape\", title: \"ShapeFile\", icon: \"pi pi-file\", tooltip: \"Exportar para ficheiro ShapeFile\" },\r\n  { value: \"kml\", title: \"KML\", icon: \"pi pi-file\", tooltip: \"Exportar para ficheiro KML\" }\r\n];\r\n\r\nconst typeLabels = {\r\n  \"Symbol\": \"símbolo\",\r\n  \"Text\": \"texto\",\r\n  \"Point\": \"ponto\",\r\n  \"LineString\": \"trajeto\",\r\n  \"Polygon\": \"polígono\"\r\n};\r\n\r\nclass DrawTools extends React.Component {\r\n  \r\n  constructor(props) {\r\n    super(props);\r\n\r\n    const drawings = Object.assign([], props.viewer.config_json.drawings);\r\n\r\n    const component_cfg = props.record.config_json;\r\n\r\n    if  (component_cfg && component_cfg.exclude_export_formats && component_cfg.exclude_export_formats.length) {\r\n      this.exportFormats = defaultExportFormats.filter(t => !component_cfg.exclude_export_formats.includes(t.value));\r\n    } else if (props.viewer && props.viewer.config_json && props.viewer.config_json.exclude_export_formats) {\r\n      this.exportFormats = defaultExportFormats.filter(t => !props.viewer.config_json.exclude_export_formats.includes(t.value));    \r\n    } else {\r\n      this.exportFormats = [...defaultExportFormats];\r\n    }\r\n\r\n    this.state = {\r\n      enabled: true,\r\n      hist: [drawings],\r\n      history_now: 0,\r\n      click: false,\r\n      draw_geom: false,\r\n      draw_symbol: false,\r\n      draw_text: false,\r\n      fill: { r: '255', g: '255', b: '255', a: '1' },\r\n      stroke: { r: '0', g: '0', b: '0', a: '1' },\r\n      size: '2',\r\n      symbol_type: 'x',\r\n      text_style: 'normal',\r\n      text_size: '20px',\r\n      text_font: 'Arial, Helvetica, sans-serif',\r\n      text_value: 'Introduza o texto...',\r\n      displayFillPicker: false,\r\n      displayStrokePicker: false,\r\n      editing: null,\r\n      selectedTool: null\r\n    }\r\n    \r\n    this.sizeOptions = [\r\n      { key: '1', label: '1', value: '1' },\r\n      { key: '2', label: '2', value: '2' },\r\n      { key: '3', label: '3', value: '3' },\r\n      { key: '4', label: '4', value: '4' },\r\n      { key: '5', label: '5', value: '5' },\r\n      { key: '10', label: '10', value: '10' },\r\n      { key: '15', label: '15', value: '15' },\r\n      { key: '20', label: '20', value: '20' },\r\n    ];\r\n\r\n    this.symbolOptions = [\r\n      { key: '1', label: 'circulo', value: 'circle' },\r\n      { key: '2', label: 'quadrado', value: 'square' },\r\n      { key: '3', label: 'triângulo', value: 'triangle' },\r\n      { key: '4', label: 'estrela', value: 'star' },\r\n      { key: '5', label: 'cruz', value: 'cross' },\r\n      { key: '10', label: 'xis', value: 'x' }\r\n    ];\r\n\r\n    this.textStyleOptions = [\r\n      { key: '1', label: 'normal', value: 'normal' },\r\n      { key: '2', label: 'italico', value: 'italic' },\r\n      { key: '3', label: 'negrito', value: 'bold' },\r\n    ];\r\n\r\n    this.textSizeOptions = [\r\n      { key: '1', label: '8px', value: '8px' },\r\n      { key: '2', label: '11px', value: '11px' },\r\n      { key: '3', label: '15px', value: '15px' },\r\n      { key: '4', label: '20px', value: '20px' },\r\n      { key: '5', label: '25px', value: '25px' },\r\n    ];\r\n\r\n    this.textFontOptions = [\r\n      { key: '1', label: 'Arial', value: 'Arial, Helvetica, sans-serif' },\r\n      { key: '2', label: 'Georgia', value: 'Georgia, serif' },\r\n    ];\r\n\r\n    const olmap = this.props.mainMap;\r\n    this.drawingsLayer = props.utils.findOlLayer(olmap, 'userlayer');\r\n    this.vectorSource = this.drawingsLayer.getSource();\r\n    this.features = this.vectorSource.getFeaturesCollection();\r\n    \r\n    this.modify = null;\r\n\r\n    this.select = new OlInteractionSelect({\r\n      condition: singleClick,\r\n      hitTolerance: 5,\r\n      wrapX: false,\r\n      filter: (feature, layer) => {\r\n\r\n        // TODO: improve validate drawings layer\r\n        /*\r\n        olmap.getLayers().forEach(l => {\r\n          console.log('layer', l.get('id'));\r\n        });\r\n        */\r\n        if (layer.get('id') !== 'userlayer') return false;\r\n        return true;\r\n      }\r\n    });\r\n    const oldSelect = new OlCollection();\r\n    this.select.on('select', (e) => {\r\n      let selected = e.selected;\r\n      let deselected = e.deselected;\r\n      if (selected) {\r\n        selected.forEach((feature) => {\r\n          if (feature.get('state')) {\r\n            oldSelect.push(feature);\r\n            const style = this.createStyle(feature, {r: 255, g: 0, b: 0, a: 1});\r\n            feature.setStyle(style);\r\n          }\r\n        });\r\n      }\r\n      if (deselected) {\r\n        deselected.forEach((feature) => {\r\n          if (feature.get('state')) {\r\n            const props = feature.getProperties();\r\n            const style = this.createStyle(feature, props.state.stroke);\r\n            feature.setStyle(style);\r\n          }\r\n        });\r\n      }\r\n      if (!selected && !deselected) {\r\n        oldSelect.forEach((feature) => {\r\n          if (feature.get('state')) {\r\n            const props = feature.getProperties();\r\n            const style = this.createStyle(feature, props.state.stroke);\r\n            feature.setStyle(style);\r\n          }\r\n        });\r\n      }\r\n      //this.drawingsLayer.getSource().refresh();\r\n      if (!selected || selected.length === 0) {\r\n        if (this.modify) {\r\n          this.modify.un('modifyend', this.onMOdifyEnd.bind(this));\r\n          olmap.removeInteraction(this.modify);\r\n          this.modify = null;\r\n        }\r\n        return this.setState({\r\n          ...this.state,\r\n          draw_geom: false,\r\n          draw_symbol: false,\r\n          draw_text: false,\r\n          editing: null\r\n        });\r\n      } else {\r\n        this.editFeature(selected[0]);\r\n      }\r\n    });\r\n    \r\n    this.draw = null;\r\n    this.format = new OlFormatWKT();\r\n  }\r\n\r\n  changeSize = ({ value }) => {\r\n    this.setState({...this.state, size: value }, () => {\r\n      const selected = this.select.getFeatures();\r\n      if (selected.getLength()) this.updateStyle(selected.item(0));\r\n    });\r\n  }\r\n  \r\n  changeFill = (color) => {\r\n    this.setState({...this.state, fill: color.rgb }, () => {\r\n      const selected = this.select.getFeatures();\r\n      if (selected.getLength()) this.updateStyle(selected.item(0));\r\n    });\r\n  }\r\n  \r\n  changeStroke = (color) => {\r\n    this.setState({...this.state, stroke: color.rgb }, () => {\r\n      const selected = this.select.getFeatures();\r\n      if (selected.getLength()) this.updateStyle(selected.item(0));  \r\n    });\r\n  }\r\n\r\n  changeSymbol = ({ value }) => {\r\n    this.setState({...this.state, symbol_type: value }, () => {\r\n      const selected = this.select.getFeatures();\r\n      if (selected.getLength()) this.updateStyle(selected.item(0));  \r\n    });\r\n  }\r\n\r\n  changeTextStyle = ({ value }) => {\r\n    this.setState({...this.state, text_style: value }, () => {\r\n      const selected = this.select.getFeatures();\r\n      if (selected.getLength()) this.updateStyle(selected.item(0));  \r\n    });\r\n  }\r\n\r\n  changeTextSize = ({ value }) => {\r\n    this.setState({...this.state, text_size: value }, () => {\r\n      const selected = this.select.getFeatures();\r\n      if (selected.getLength()) this.updateStyle(selected.item(0));  \r\n    });\r\n  }\r\n\r\n  changeTextFont = ({ value }) => {\r\n    this.setState({...this.state, text_font: value }, () => {\r\n      const selected = this.select.getFeatures();\r\n      if (selected.getLength()) this.updateStyle(selected.item(0));  \r\n    });\r\n  }\r\n\r\n  changeTextValue = (e) => {\r\n    this.setState({...this.state, text_value: e.target.value }, () => {\r\n      const selected = this.select.getFeatures();\r\n      if (selected.getLength()) this.updateStyle(selected.item(0));  \r\n    });\r\n  }\r\n\r\n  toggleFillPicker = () => {\r\n    this.setState({ ...this.state, displayFillPicker: !this.state.displayFillPicker, displayStrokePicker: false })\r\n  };\r\n\r\n  closeFillPicker = () => {\r\n    this.setState({ ...this.state, displayFillPicker: false })\r\n  };\r\n\r\n  toggleStrokePicker = () => {\r\n    this.setState({ ...this.state, displayStrokePicker: !this.state.displayStrokePicker, displayFillPicker: false })\r\n  };\r\n\r\n  closeStrokePicker = () => {\r\n    this.setState({ ...this.state, displayStrokePicker: false })\r\n  };\r\n\r\n  createStyle(feature, stroke) {\r\n    const props = feature.getProperties();\r\n    const utils = this.props.utils;\r\n    const { symbol_type, size, fill, text_style, text_size, text_font, text_value } = props.state;\r\n    let style = utils.createDrawingStyle(feature.getGeometry().getType(), size, fill, stroke);\r\n    if (props.type === 'Symbol') {\r\n        style = utils.createDrawingSymbol(symbol_type, size, fill, stroke);\r\n    }\r\n    if (props.type === 'Text') {\r\n        style = utils.createDrawingText(feature, size, fill, stroke, text_style, text_size, text_font, text_value);\r\n    }\r\n    return style;\r\n  }\r\n\r\n  updateStyle(feature) {\r\n    const { viewer, actions, dispatch, utils } = this.props;\r\n    const map = this.props.mainMap;\r\n    const crs = map.getView().getProjection().getCode();    \r\n    const style = utils.createStyle(feature, this.state, {r: 255, g: 0, b: 0, a: 1});\r\n    feature.setStyle(style);\r\n    const geojson = utils.serializeDrawing(feature, this.state, crs);\r\n    const drawings = viewer.config_json.drawings.map(d => {\r\n      if (d.id === geojson.id) return geojson;\r\n      return d;\r\n    });\r\n    dispatch(actions.viewer_set_drawings(drawings));\r\n  }\r\n\r\n  onMOdifyEnd(e) {\r\n    e.features.forEach(feat => {\r\n      this.updateStyle(feat);\r\n    });\r\n  }\r\n\r\n  editFeature(feature) {\r\n    const state = feature.get('state');\r\n    const olmap = this.props.mainMap;\r\n    this.setState({\r\n      ...this.state,\r\n      editing: feature.getProperties(),\r\n      ...state\r\n    }, () => {\r\n      const features = new OlCollection();\r\n      features.push(feature);\r\n      this.modify = new OlInteractionModify({\r\n        features,\r\n        deleteCondition: function(event) {\r\n          return shiftKeyOnly(event) && singleClick(event);\r\n        }\r\n      });\r\n      this.modify.on('modifyend', this.onMOdifyEnd.bind(this));\r\n      olmap.addInteraction(this.modify);\r\n      this.modify.setActive(true);\r\n    });\r\n  }\r\n\r\n  componentDidMount() {\r\n    const olmap = this.props.mainMap;\r\n    this.drawingsLayer = this.props.utils.findOlLayer(olmap, 'userlayer');\r\n    this.vectorSource = this.drawingsLayer.getSource();\r\n    this.features = this.vectorSource.getFeaturesCollection();\r\n    this.props.mainMap.addInteraction(this.select);\r\n    this.select.setActive(false);\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    //TODO: may need more work\r\n      if (this.state.selectedTool && this.props.viewer.config_json.selected_menu != 'drawtools') {\r\n      this.select.setActive(false);\r\n      this.setState({\r\n        ...this.state,\r\n        selectedTool: ''\r\n      });\r\n    }\r\n  }   \r\n\r\n  addInteraction(type, cb) {\r\n    const { hist, history_now } = this.state;\r\n    const { viewer, actions, dispatch, utils } = this.props;\r\n    const map = this.props.mainMap;\r\n    const crs = map.getView().getProjection().getCode();\r\n    this.draw = new OlInteractionDraw({\r\n        features: new OlCollection(),\r\n        type: type\r\n    });\r\n    this.findInteraction(OlInteractionDragPan).setActive(false);\r\n    this.findInteraction(OlInteractionDoubleClickZoom).setActive(false);\r\n    this.findInteraction(OlInteractionPinchZoom).setActive(false);\r\n\r\n    dispatch(actions.viewer_set_exclusive_mapcontrol('DrawTools'));\r\n    \r\n    map.addInteraction(this.draw);\r\n    this.draw.on('drawend', (e) => {\r\n        \r\n      // Add drawing\r\n      const geojson = utils.serializeDrawing(e.feature, this.state, crs);\r\n      const drawings_update = [...viewer.config_json.drawings, geojson];\r\n      dispatch(actions.viewer_set_drawings(drawings_update));\r\n\r\n      setTimeout(() => {\r\n        let history_item = [];\r\n        drawings_update.forEach(function(item) {\r\n          history_item.push(Object.assign({}, item));\r\n        });\r\n        hist.push(history_item);\r\n        this.setState({\r\n          ...this.state,\r\n          hist,\r\n          history_now: history_now+1,\r\n          selectedTool: null,\r\n          draw_geom: false,\r\n          draw_symbol: false,\r\n          draw_text: false\r\n        });\r\n\r\n        // Terminate\r\n        map.removeInteraction(this.draw);\r\n        this.findInteraction(OlInteractionDragPan).setActive(true);\r\n        this.findInteraction(OlInteractionDoubleClickZoom).setActive(true);\r\n        this.findInteraction(OlInteractionPinchZoom).setActive(true);\r\n        //this.select.setActive(true);\r\n\r\n        dispatch(actions.viewer_set_exclusive_mapcontrol(null));\r\n      }, 350);\r\n    });\r\n  }\r\n\r\n  findInteraction(classname) {\r\n    let result = false;\r\n    const { mainMap } = this.props;\r\n    mainMap.getInteractions().forEach(function(item) {\r\n      if (item instanceof classname) result = item;\r\n    });\r\n    return result;\r\n  }\r\n\r\n  // toggle geometry interaction\r\n  toggleInteraction(type) {\r\n    const { mainMap } = this.props;\r\n    if (this.draw) mainMap.removeInteraction(this.draw);\r\n    this.addInteraction(type);\r\n    this.findInteraction(OlInteractionDragPan).setActive(false);\r\n  }\r\n\r\n  startDraw(e, type) {\r\n    e.preventDefault();\r\n    e.target.blur();\r\n\r\n    // Disable interaction\r\n    if (type === this.state.selectedTool) {\r\n      // Terminate\r\n      const { mainMap, actions, dispatch } = this.props;\r\n\r\n      if (type === 'select') {\r\n        this.select.setActive(false);\r\n      } else {\r\n        mainMap.removeInteraction(this.draw);\r\n        this.findInteraction(OlInteractionDragPan).setActive(true);\r\n        this.findInteraction(OlInteractionDoubleClickZoom).setActive(true);\r\n        this.findInteraction(OlInteractionPinchZoom).setActive(true);\r\n      }      \r\n      \r\n      return this.setState({\r\n        ...this.state,\r\n        selectedTool: null,\r\n        draw_geom: false,\r\n        draw_symbol: false,\r\n        draw_text: false\r\n      }, () => {\r\n        dispatch(actions.viewer_set_exclusive_mapcontrol(null));\r\n      });      \r\n    }\r\n\r\n    if (type === 'select') {     \r\n      // Enable interaction\r\n      this.setState({ ...this.state, \r\n        selectedTool: type,\r\n        draw_geom: false,\r\n        draw_symbol: false,\r\n        draw_text: false }, () => {\r\n          this.select.setActive(true);\r\n\r\n          const { mainMap, actions, dispatch } = this.props;\r\n          if (this.draw) mainMap.removeInteraction(this.draw);\r\n\r\n          dispatch(actions.viewer_set_exclusive_mapcontrol('DrawTools'));\r\n        //this.addInteraction(type);\r\n        //this.findInteraction(OlInteractionDragPan).setActive(false);\r\n        }\r\n      );\r\n    } else {\r\n      // Enable interaction\r\n      this.setState({ ...this.state, selectedTool: type }, () => {\r\n        this.select.setActive(false);\r\n        switch(type) {\r\n          case 'symbol': this.clickDrawSymbol(); break;\r\n          case 'text': this.clickDrawText(); break;\r\n          case 'point': this.clickDrawPoint(); break;\r\n          case 'line': this.clickDrawLine(); break;\r\n          case 'polygon': this.clickDrawPolygon(); break;\r\n          default: this.clickDrawPoint();\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  // Enable draw point\r\n  clickDrawPoint() {\r\n    this.toggleInteraction('Point');\r\n    this.setState({\r\n      ...this.state,\r\n      draw_geom: true,\r\n      draw_symbol: false,\r\n      draw_text: false,\r\n      editing: null\r\n    });\r\n  }\r\n\r\n  // Enable draw line\r\n  clickDrawLine() {\r\n    this.toggleInteraction('LineString');\r\n    this.setState({\r\n      ...this.state,\r\n      draw_geom: true,\r\n      draw_symbol: false,\r\n      draw_text: false,\r\n      editing: null\r\n    });\r\n }\r\n\r\n  // Enable draw polygon\r\n  clickDrawPolygon() {\r\n    this.toggleInteraction('Polygon');\r\n    this.setState({\r\n      ...this.state,\r\n      draw_geom: true,\r\n      draw_symbol: false,\r\n      draw_text: false,\r\n      editing: null\r\n    });\r\n  }\r\n\r\n  // Enable draw text\r\n  clickDrawText() {\r\n    const { mainMap } = this.props;\r\n    this.setState({\r\n      ...this.state,\r\n      draw_geom: false,\r\n      draw_symbol: false,\r\n      draw_text: true,\r\n      editing: null\r\n    }, () => {\r\n      mainMap.removeInteraction(this.draw);\r\n      this.addInteraction('Point');\r\n    });\r\n  }\r\n\r\n  // Enable draw symbol\r\n  clickDrawSymbol() {\r\n    const { mainMap } = this.props;\r\n    this.setState({\r\n      ...this.state,\r\n      draw_geom: false,\r\n      draw_symbol: true,\r\n      draw_text: false,\r\n      editing: null\r\n    }, () => {\r\n      mainMap.removeInteraction(this.draw);\r\n      this.addInteraction('Point');\r\n    });\r\n  }\r\n\r\n  // Draw undo\r\n  clickUndo(e) {\r\n    e.preventDefault();\r\n    const { actions, dispatch, mainMap } = this.props;\r\n    if (this.modify) {\r\n      this.modify.un('modifyend', this.onMOdifyEnd.bind(this));\r\n      mainMap.removeInteraction(this.modify);\r\n      this.modify = null;\r\n    }\r\n    this.select.getFeatures().clear();\r\n    this.setState({\r\n      ...this.state,\r\n      editing: null\r\n    }, () => {\r\n      const drawings = [];\r\n      let { hist, history_now } = this.state;\r\n      if (history_now > 0) {\r\n        history_now--;\r\n        hist[history_now].forEach(item => {\r\n          drawings.push(item);\r\n        });\r\n        this.setState({\r\n            ...this.state,\r\n            hist,\r\n            history_now: history_now\r\n        }, () => {\r\n          dispatch(actions.viewer_set_drawings(drawings));\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  // Draw redo\r\n  clickRedo(e) {\r\n    e.preventDefault();\r\n    const { actions, dispatch, mainMap } = this.props;\r\n    if (this.modify) {\r\n      this.modify.un('modifyend', this.onMOdifyEnd.bind(this));\r\n      mainMap.removeInteraction(this.modify);\r\n      this.modify = null;\r\n    }\r\n    this.select.getFeatures().clear();\r\n    this.setState({\r\n      ...this.state,\r\n      editing: null\r\n    }, () => {\r\n      const drawings = [];\r\n      let { hist, history_now } = this.state;\r\n      if (history_now + 1 < hist.length) {\r\n        history_now++;\r\n        hist[history_now].forEach(item => {\r\n          drawings.push(item);\r\n        });\r\n        this.setState({\r\n          ...this.state,\r\n          hist,\r\n          history_now: history_now\r\n        }, () => {\r\n          dispatch(actions.viewer_set_drawings(drawings));\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  // Draw delete current\r\n  clickDelete(e) {\r\n    e.preventDefault();\r\n    const { actions, dispatch, mainMap } = this.props;\r\n    if (this.modify) {\r\n      this.modify.un('modifyend', this.onMOdifyEnd.bind(this));\r\n      mainMap.removeInteraction(this.modify);\r\n      this.modify = null;\r\n    }\r\n    this.select.getFeatures().clear();\r\n    dispatch(actions.viewer_set_drawings([]));\r\n    this.setState({\r\n      ...this.state,\r\n      hist: [[]],\r\n      history_now: 0,\r\n      editing: null\r\n    });\r\n  }\r\n\r\n  // Get editing feature\r\n  getEditingFeature(id) {\r\n    let found = null;\r\n    this.features.forEach(feat => {\r\n      if (feat.get('id') === id) found = feat;\r\n    });\r\n    return found;\r\n  }\r\n\r\n  // Remove feature\r\n  removeFeature() {\r\n    const { viewer, actions, dispatch, mainMap } = this.props;\r\n    let drawings = viewer.config_json.drawings;\r\n    const { editing } = this.state;\r\n    const feature = this.getEditingFeature(editing.id);\r\n    if (feature) {\r\n      if (this.modify) {\r\n        this.modify.un('modifyend', this.onMOdifyEnd.bind(this));\r\n        mainMap.removeInteraction(this.modify);\r\n        this.modify = null;\r\n      }\r\n      this.select.getFeatures().clear();\r\n      drawings = drawings.filter(d => d.id !== feature.getId());\r\n      dispatch(actions.viewer_set_drawings(drawings));\r\n    }\r\n    this.setState({\r\n      ...this.state,\r\n      draw_geom: false,\r\n      draw_symbol: false,\r\n      draw_text: false,\r\n      editing: null\r\n    });\r\n  }\r\n\r\n  // Finish editing\r\n  finishEditing() {\r\n    this.select.getFeatures().clear();\r\n    this.select.dispatchEvent('select');\r\n  }\r\n\r\n  // Disable draw tools\r\n  disableTools() {\r\n    const map = this.props.mainMap;\r\n    if (this.state.selectedTool) {\r\n      if (this.draw) map.removeInteraction(this.draw);\r\n      this.findInteraction(OlInteractionDragPan).setActive(true);\r\n      this.findInteraction(OlInteractionDoubleClickZoom).setActive(true);\r\n      this.findInteraction(OlInteractionPinchZoom).setActive(true);\r\n      this.setState({ ...this.state, selectedTool: null });\r\n    }\r\n    if (this.state.editing) this.finishEditing();\r\n    if (this.modify) {\r\n      this.modify.un('modifyend', this.onMOdifyEnd.bind(this));\r\n      map.removeInteraction(this.modify);\r\n      this.modify = null;\r\n    }\r\n    //this.select.setActive(false);\r\n    this.setState({\r\n      ...this.state,\r\n      enabled: false,\r\n      draw_geom: false,\r\n      draw_symbol: false,\r\n      draw_text: false,\r\n      editing: null\r\n    });\r\n  }\r\n\r\n  // Enable draw tools\r\n  enableTools() {\r\n    if (!this.state.enabled) {\r\n      this.setState({ ...this.state, enabled: true });\r\n      //RS\r\n      //this.select.setActive(true);\r\n    }\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    const { mainMap } = this.props;\r\n    mainMap.removeInteraction(this.select);\r\n    if (this.modify) {\r\n      this.modify.un('modifyend', this.onMOdifyEnd.bind(this));\r\n      mainMap.removeInteraction(this.modify);\r\n      this.modify = null;\r\n    }\r\n    mainMap.removeInteraction(this.draw);\r\n    this.findInteraction(OlInteractionDragPan).setActive(true);\r\n    this.findInteraction(OlInteractionDoubleClickZoom).setActive(true);\r\n    this.findInteraction(OlInteractionPinchZoom).setActive(true);\r\n  }\r\n\r\n  download(format) {\r\n    const { viewer, record } = this.props;\r\n    const component_cfg = record ? record.config_json : null;\r\n\r\n    const serializer = new OlFormatGeoJSON();\r\n\r\n    let crs = null;\r\n    if (component_cfg && component_cfg.export_crs) {\r\n      crs = component_cfg.export_crs;\r\n    } else if (viewer.config_json && viewer.config_json.export_crs) {\r\n      crs = viewer.config_json.export_crs;\r\n    } else if (viewer.config_json && viewer.config_json.display_crs) {\r\n      crs = viewer.config_json.display_crs;\r\n    } else {\r\n      crs = 4326;\r\n    }\r\n\r\n    // Export defaults to EPSG:4326\r\n    const serializeOptions = {\r\n      dataProjection: 'EPSG:' + crs,\r\n      featureProjection: this.props.mainMap.getView().getProjection().getCode(),\r\n      decimals: 6\r\n    }\r\n    const json = serializer.writeFeaturesObject(this.features.getArray(), serializeOptions);\r\n    \r\n    // Hack: OL does not serialize with CRS attribute\r\n    //json.crs = { \"type\": \"name\", \"properties\": { \"name\": \"urn:ogc:def:crs:EPSG::4326\" } }\r\n    const crsinfo = {\r\n      \"type\": \"name\",\r\n      \"properties\": {\r\n          \"name\": \"urn:ogc:def:crs:EPSG::\" + crs\r\n      }\r\n    };\r\n    json.crs = crsinfo;    \r\n    const data = JSON.stringify(json)\r\n\r\n    // Build file\r\n    const file = new Blob([data], {type: 'application/json'});\r\n    FileSaver.saveAs(file, 'geojson');\r\n\r\n    // TODO: upload and convert\r\n    /*\r\n    // Upload data\r\n    const endpoint = process.env.REACT_APP_SERVER_URL || process.env.REACT_APP_PUBLIC_URL;\r\n    const upload = new FormData();\r\n    upload.append('upload', file);\r\n    upload.append('ext', 'geojson');\r\n    fetch(endpoint + '/resource', { method: 'POST', body: upload })\r\n    .then(res => res.json())\r\n    .then(res => {\r\n      if (!res.success) {\r\n        console.log(res.error);\r\n        return;\r\n      }\r\n\r\n      // Convert to format\r\n      const url = endpoint + '/convert/' + res.filename + '/' + format\r\n      fetch(url, { responseType: 'blob' })\r\n        .then(res => res.blob())\r\n        .then(res => {\r\n\r\n          // Download result\r\n          FileSaver.saveAs(res, format)\r\n        }).catch((error) => {\r\n          console.error(error);\r\n        });\r\n    });\r\n    */\r\n  }\r\n\r\n  getButtonStyle(opt) {\r\n    const { fill, stroke } = this.state;\r\n    const fillStr = `rgba(${ fill.r }, ${ fill.g }, ${ fill.b }, ${ fill.a })`;\r\n    const strokeStr = `rgba(${ stroke.r }, ${ stroke.g }, ${ stroke.b }, ${ stroke.a })`;\r\n    switch(opt.value) {\r\n      case 'fill':\r\n        return {\r\n          backgroundColor: fillStr,\r\n          color: 'black'\r\n        }\r\n      case 'stroke':\r\n        return {\r\n          backgroundColor: strokeStr,\r\n          color: 'white'\r\n        }\r\n      default:;\r\n    }\r\n  }\r\n\r\n  // TODO: get better BBOX for points\r\n  zoom(item) {\r\n    const { mainMap } = this.props;\r\n    let features = parseOlFeatures(JSON.stringify(item), mainMap.getView().getProjection().getCode());\r\n    if (features.length) {\r\n      mainMap.getView().fit(features[0].getGeometry());\r\n    }\r\n  }\r\n\r\n  deleteItem(item) {\r\n    const { viewer, mainMap, dispatch, actions } = this.props;\r\n    if (this.modify) {\r\n      this.modify.un('modifyend', this.onMOdifyEnd.bind(this));\r\n      mainMap.removeInteraction(this.modify);\r\n      this.modify = null;\r\n    }\r\n    this.select.getFeatures().clear();\r\n    this.setState({\r\n      ...this.state,\r\n      draw_geom: false,\r\n      draw_symbol: false,\r\n      draw_text: false,\r\n      editing: null\r\n    }, () => {\r\n      let drawings = viewer.config_json.drawings.filter(d => d.id !== item.id);\r\n      dispatch(actions.viewer_set_drawings(drawings));\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      enabled,\r\n      draw_text,\r\n      draw_symbol,\r\n      size,\r\n      fill,\r\n      stroke,\r\n      symbol_type,\r\n      text_style,\r\n      text_size,\r\n      text_font,\r\n      text_value,\r\n      editing,\r\n      selectedTool\r\n    } = this.state;\r\n    const { viewer } = this.props;\r\n\r\n    const styles = () => {\r\n      return {\r\n        swatch: {\r\n          padding: '5px',\r\n          background: '#fff',\r\n          borderRadius: '1px',\r\n          boxShadow: '0 0 0 1px rgba(0,0,0,.1)',\r\n          display: 'inline-block',\r\n          cursor: 'pointer',\r\n        },\r\n        popover: {\r\n          position: 'absolute',\r\n          zIndex: '2',\r\n        },\r\n        cover: {\r\n          position: 'fixed',\r\n          top: '0px',\r\n          right: '0px',\r\n          bottom: '0px',\r\n          left: '0px',\r\n        }\r\n      }\r\n    }\r\n\r\n    // Enable/disable tools\r\n    if (enabled && (viewer.config_json.selected_menu !== 'drawtools')) this.disableTools();\r\n    if (!enabled && (viewer.config_json.selected_menu === 'drawtools')) this.enableTools();\r\n\r\n    return (\r\n      <div id=\"drawtools\">\r\n\r\n        <div className=\"p-shadow-5 toolbar\">\r\n        \r\n          { drawElementsOptions.map(opt =>\r\n            <Button\r\n              key={opt.value}\r\n              icon={opt.icon}\r\n              label={ opt.label ? opt.label : ''}\r\n              tooltip={opt.title}\r\n              className={\"p-button-secondary tool \" + (opt.value === selectedTool ? \"active\" : \"\") }\r\n              onClick={(e) => this.startDraw(e, opt.value) }\r\n            />\r\n          )}\r\n\r\n          {' '}\r\n\r\n          { selectTools.map(opt =>\r\n            <Button\r\n              key={opt.value}\r\n              icon={opt.icon}\r\n              tooltip={opt.title}\r\n              className={\"p-button-secondary tool \" + (opt.value === selectedTool ? \"active\" : \"\") }\r\n              onClick={(e) => this.startDraw(e, opt.value) }\r\n            />\r\n          )}\r\n\r\n          <br />\r\n\r\n          { colorTools.map(opt =>\r\n            <Button\r\n              key={opt.value}\r\n              icon={opt.icon}\r\n              tooltip={opt.title}\r\n              className={\"p-button-secondary tool \" + (opt.value === selectedTool ? \"p-highlight\" : \"\") }\r\n              style={this.getButtonStyle(opt)}\r\n              onClick={(e) => {\r\n                switch(opt.value) {\r\n                  case 'fill': this.toggleFillPicker(e); break;\r\n                  case 'stroke': this.toggleStrokePicker(e); break;\r\n                  default:;\r\n                }\r\n              }}\r\n            />\r\n          )}\r\n\r\n          { this.state.displayFillPicker ? <div style={ styles().popover }>\r\n            <div style={ styles().cover } onClick={ this.closeFillPicker.bind(this) }/>\r\n            <CompactPicker color={ fill } onChange={ this.changeFill.bind(this) } />\r\n          </div> : null }\r\n\r\n          { this.state.displayStrokePicker ? <div style={ styles().popover }>\r\n            <div style={ styles().cover } onClick={ this.closeStrokePicker.bind(this) }/>\r\n            <CompactPicker color={ stroke } onChange={ this.changeStroke.bind(this) } />\r\n          </div> : null }\r\n\r\n          <Dropdown \r\n            text={size}\r\n            tooltip=\"Tamanho da linha/símbolo\"\r\n            value={size}\r\n            options={this.sizeOptions}\r\n            onChange={opt => this.changeSize(opt)}\r\n            style={{ marginBottom: '1px' }}\r\n          />\r\n\r\n          <br /><br />\r\n\r\n          { historyTools.map(opt =>\r\n            <Button\r\n              key={opt.value}\r\n              icon={opt.icon}\r\n              tooltip={opt.title}\r\n              className={opt.value !== \"clear\" ? \"p-button-info tool\" : \"p-button-danger tool\" }\r\n              onClick={(e) => {\r\n                switch(opt.value) {\r\n                  case 'undo': this.clickUndo(e); break;\r\n                  case 'redo': this.clickRedo(e); break;\r\n                  case 'clear': this.clickDelete(e); break;\r\n                  default:;\r\n                }\r\n              }}\r\n            />\r\n          )}          \r\n\r\n        </div>\r\n\r\n        { editing ? (\r\n          <React.Fragment>\r\n            <h5>A editar { typeLabels[editing.type] }</h5>\r\n            <div>\r\n              <Button\r\n                onClick={e => this.finishEditing()}\r\n                icon=\"pi pi-save\"\r\n                label=\"Aplicar\"\r\n                tooltip=\"Aplicar alterações\"\r\n              />\r\n              <Button\r\n                onClick={e => this.removeFeature()}\r\n                icon=\"pi pi-trash\"\r\n                className=\"p-button-danger\"\r\n                tooltip=\"Apagar desenho\"\r\n              />\r\n            </div>\r\n          </React.Fragment>\r\n        ) : null }\r\n\r\n        { draw_symbol ? (\r\n          <div>\r\n            <h5>Opções de Simbologia</h5>\r\n            <Dropdown\r\n              text={symbol_type}\r\n              tooltip=\"Escolha o Símbolo\"\r\n              value={symbol_type}\r\n              options={this.symbolOptions}\r\n              onChange={this.changeSymbol.bind(this)}\r\n              style={{ minWidth: '120px' }}\r\n            />\r\n          </div>\r\n        ) : null }\r\n\r\n        { draw_text ? (\r\n          <div>\r\n            <h5>Opções de Texto</h5>\r\n            <Dropdown text={text_style}\r\n              tooltip=\"Estilo do Texto\"\r\n              value={text_style}\r\n              options={this.textStyleOptions}\r\n              onChange={this.changeTextStyle.bind(this)}\r\n            />\r\n\r\n            <Dropdown text={text_size}\r\n              tooltip=\"Tamanho do Texto\"\r\n              value={text_size}\r\n              options={this.textSizeOptions}\r\n              onChange={this.changeTextSize.bind(this)}\r\n            />\r\n\r\n            <Dropdown text={text_font}\r\n              tooltip=\"Tipo de Letra\"\r\n              value={text_font}\r\n              options={this.textFontOptions}\r\n              onChange={this.changeTextFont.bind(this)}\r\n            />\r\n            <br />\r\n            <InputText \r\n              className=\"drawtools-text-input\"\r\n              value={text_value}\r\n              onChange={this.changeTextValue.bind(this)}\r\n              tooltip=\"Texto para a etiqueta\"\r\n              onClick={e => e.target.select()}\r\n            />\r\n        </div>\r\n        ) : null }\r\n\r\n        <hr />\r\n\r\n        <div>\r\n          { viewer.config_json.drawings.length > 0 &&\r\n            this.exportFormats.map(opt =>\r\n              <Button\r\n                key={opt.value}\r\n                icon={opt.icon}\r\n                label={opt.title}\r\n                tooltip={opt.tooltip}\r\n                className=\"p-button-outlined p-button-sm p-button-info format-tool\"\r\n                onClick={(e) => this.download(opt.value)}\r\n              /> \r\n            )\r\n          }\r\n        </div>\r\n\r\n        <hr />\r\n\r\n        <h5>Desenhos</h5>\r\n        { viewer.config_json.drawings.length === 0 ? (\r\n          <p>Não existem desenhos</p>\r\n        ) : (\r\n          <DataTable \r\n            value={viewer.config_json.drawings}\r\n            dataKey=\"id\"\r\n            paginator\r\n            rows={10}\r\n            rowsPerPageOptions={[5, 10, 25]}\r\n            paginatorTemplate=\"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown\"\r\n            currentPageReportTemplate=\"Mostrando {first} até {last} de {totalRecords} items\"\r\n            >\r\n            <Column \r\n              field=\"properties.id\" \r\n              header=\"ID\"\r\n              body={(row, table) => table.value.indexOf(row) + 1}\r\n            />\r\n            <Column \r\n              field=\"properties.type\" \r\n              header=\"Tipo\"\r\n              body={row => typeLabels[row.properties.type]}\r\n            />\r\n            <Column \r\n              body={row => (\r\n                <React.Fragment>\r\n                  <Button \r\n                    icon=\"pi pi-search\" \r\n                    className=\"p-mr-2\" \r\n                    onClick={() => this.zoom(row)}\r\n                    tooltip=\"Centrar\"\r\n                  />\r\n                  <Button \r\n                    icon=\"pi pi-trash\" \r\n                    className=\"p-button-danger\" \r\n                    onClick={() => this.deleteItem(row)}\r\n                    tooltip=\"Apagar\"\r\n                  />\r\n                </React.Fragment>\r\n              )}\r\n            />\r\n          </DataTable>\r\n        )}\r\n\r\n      </div>\r\n    );\r\n  }\r\n\r\n}\r\n\r\nfunction parseOlFeatures(data, projection) {\r\n\r\n  // Parse OL feature\r\n  const parser = new OlFormatGeoJSON();\r\n  const parseOptions = {\r\n    dataProjection: projection,\r\n    featureProjection: projection\r\n  };\r\n  let features = parser.readFeatures(data, parseOptions);\r\n  features = features instanceof OlCollection ? features.getArray() : features;\r\n  return features;\r\n}\r\n\r\nexport default DrawTools;","import React, { useEffect } from 'react'\r\nimport { Button } from 'primereact/button';\r\nimport { Panel } from 'primereact/panel';\r\nimport DrawTools from './DrawTools'\r\n\r\n/**\r\n * Main menu component\r\n */\r\nexport function MainMenu({ className, config, actions, record }) {\r\n\r\n  const component_cfg = record.config_json || {};\r\n  const title = record.title || 'Ferramentas de Desenho';\r\n  const header = component_cfg.header || title;\r\n\r\n  return (\r\n    <Button\r\n      title={title}\r\n      className={className}\r\n      icon=\"pi pi-palette\"\r\n      style={{ margin: '0.5em 1em' }}\r\n      onClick={e => config.dispatch(actions.viewer_set_selectedmenu(record.id))}\r\n    />\r\n  )\r\n}\r\n\r\nexport default function Main({ type, region, as, config, actions, record, utils }) {\r\n\r\n  const { core, mainMap, viewer, dispatch, Models } = config;\r\n  const { selected_menu } = viewer.config_json;\r\n  const { getWindowSize } = Models ? Models.Utils : utils;  \r\n\r\n  const component_cfg = record.config_json || {};\r\n  const title = record.title || 'Ferramentas de Desenho';\r\n  const header = component_cfg.header || title;\r\n\r\n  const wsize = getWindowSize();\r\n  const isMobile = wsize[0] <= 768;  \r\n\r\n  useEffect(() => {\r\n    if (selected_menu === 'drawtools') dispatch(actions.viewer_set_exclusive_mapcontrol('DrawTools'));\r\n  }, [selected_menu])   \r\n\r\n  function renderContent() {\r\n    return (\r\n      <div>\r\n        <DrawTools\r\n          record={record}\r\n          viewer={viewer}\r\n          core={core}\r\n          actions={actions}\r\n          dispatch={dispatch}\r\n          mainMap={mainMap}\r\n          utils={utils}\r\n        />\r\n      </div>  \r\n    )  \r\n  }\r\n\r\n  if (type === 'link' && region === record.links) {\r\n    return <Button\r\n      title={title}\r\n      icon=\"pi pi-palette\"\r\n      className=\"p-button-rounded p-button-raised\"\r\n      onClick={e => {\r\n        dispatch(actions.viewer_set_selectedmenu(record.id));\r\n        dispatch(actions.layout_show_menu(!isMobile));\r\n      }}\r\n    />\r\n  }\r\n\r\n  if (as === 'panel') return (\r\n    <Panel header={header}>\r\n      { renderContent() }\r\n    </Panel>\r\n  )\r\n\r\n  // Render component\r\n  return renderContent()\r\n}\r\n","import React, { useEffect, useState } from 'react'\r\nimport GeoJSON from 'ol/format/GeoJSON'\r\nimport { Button } from 'primereact/button'\r\nimport { Feature } from 'ol'\r\nimport Point from 'ol/geom/Point'\r\nimport OLGroupLayer from \"ol/layer/Group\"\r\nimport Select from 'ol/interaction/Select'\r\nimport {InputSwitch} from 'primereact/inputswitch'\r\nimport VectorSource from \"ol/source/Vector\"\r\nimport './index.css'\r\n\r\nexport function traverseOlLayers(collection, cb) {\r\n  collection.forEach(l => {\r\n    cb(l);\r\n    if (l instanceof OLGroupLayer) traverseOlLayers(l.getLayers(), cb);\r\n  })\r\n}\r\n\r\nlet selectSingleClick;\r\nlet olLayer;\r\n\r\nexport default function Main({ config }) {\r\n\r\n  //console.log('ExportMapFeatures', config);\r\n  const { layer, actions, dispatch, mainMap } = config;\r\n\r\n  const [active, setActive] = useState(false);\r\n  const [selected, setSelected] = useState({ items: [], coord: null });\r\n\r\n  function exportSelected() {\r\n    const format = new GeoJSON();\r\n    const text = format.writeFeatures(selected.items);\r\n    //console.log(text);\r\n    download('selecao.geojson', text);\r\n  }\r\n\r\n  function exportCoord() {\r\n    const feat = new Feature({\r\n      name: 'Coordenada',\r\n      geometry: new Point(selected.coord)\r\n    });\r\n    const format = new GeoJSON();\r\n    const text = format.writeFeatures([feat]);\r\n    download('coordenada.geojson', text);\r\n  }\r\n\r\n  function findOlLayer(id) {\r\n    let layer;\r\n    traverseOlLayers(mainMap.getLayers(), l => {\r\n      if (l.get('id') === id) layer = l;\r\n    });\r\n    return layer;\r\n  }\r\n\r\n  useEffect(() => {\r\n    olLayer = findOlLayer(layer.id);\r\n    selectSingleClick = new Select({\r\n      layers: [olLayer]\r\n    });\r\n    selectSingleClick.on('select', e => {\r\n      if (e.selected.length) setSelected({ items: e.selected, coord: e.mapBrowserEvent.coordinate });\r\n    })\r\n    mainMap.addInteraction(selectSingleClick);\r\n    return () => {\r\n      mainMap.removeInteraction(selectSingleClick)\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    selectSingleClick.setActive(active);\r\n  }, [active]);\r\n\r\n  // Filter by layer type\r\n  if (!olLayer) return null;\r\n  //console.log('type', olLayer.getSource() instanceof VectorSource);\r\n  if (!(olLayer.getSource() instanceof VectorSource)) return null;\r\n\r\n  return (\r\n    <div className=\"export-map-features\">\r\n\r\n      <table>\r\n        <thead>\r\n          <tr>\r\n            <th>Selecionar Elementos</th>\r\n            <th>\r\n              <InputSwitch checked={active} onChange={(e) => setActive(!active)} />\r\n            </th>\r\n          </tr>\r\n          \r\n        </thead>\r\n        <tbody>\r\n          \r\n          { !!selected.coord && selected.coord.length && (\r\n          <tr>\r\n            <td>Ponto</td>\r\n            <td>\r\n              <Button className=\"p-button-sm\" onClick={exportCoord} label=\"Exportar\" icon=\"pi pi-arrow-circle-down\" />\r\n            </td>\r\n          </tr>\r\n          ) }\r\n\r\n          { selected.items.map((feat, i) => (\r\n          <tr>\r\n            <td>Geometria</td>\r\n            <td>\r\n              <Button className=\"p-button-sm\" onClick={exportSelected} label=\"Exportar\" icon=\"pi pi-arrow-circle-down\" />\r\n            </td>\r\n          </tr>\r\n          )) }\r\n\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction download(filename, text) {\r\n  const element = document.createElement('a');\r\n  element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));\r\n  element.setAttribute('download', filename);\r\n  element.style.display = 'none';\r\n  document.body.appendChild(element);\r\n  element.click();\r\n  document.body.removeChild(element);\r\n}","export const FEATUREINFO_DO_ACTION = 'FeatureInfo/DoAction';\r\n\r\nexport default {\r\n  FEATUREINFO_DO_ACTION\r\n}","import React, { useState, useEffect } from 'react'\r\nimport Cookies from 'universal-cookie';\r\nimport { Column } from 'primereact/column'\r\nimport { DataTable } from 'primereact/datatable'\r\nimport OlCollection from 'ol/Collection'\r\nimport OlFeature from 'ol/Feature'\r\nimport OlFormatGeoJSON from \"ol/format/GeoJSON\"\r\nimport { Accordion, AccordionTab } from 'primereact/accordion'\r\nimport { Message } from 'primereact/message'\r\nimport { Button } from 'primereact/button'\r\nimport { unit } from 'mathjs'\r\n\r\nimport componentMessages from './messages'\r\n\r\nexport default function FeatureResults({ core, config, features, layers, actions, pubsub, dispatch, mainMap, record }) {\r\n\r\n  const { viewer } = config;\r\n  const { publish, subscribe } = pubsub ? pubsub : {}\r\n\r\n  const [activeIndex, setActiveIndex] = useState(null);\r\n\r\n  //Export permissions\r\n  const [userRoles, setUserRoles] = useState([]);\r\n  const [showExport, setShowExport] = useState(true);  \r\n  const [showExportAll, setShowExportAll] = useState(true);\r\n  const [showExportRecord, setShowExportRecord] = useState(true);  \r\n\r\n  // Group by layer\r\n  const grouped = groupResults(features, mainMap);\r\n\r\n  const showExportAllFeatures = getShowExportAllFeatures(grouped, layers, userRoles);\r\n\r\n  //Set Export permissions\r\n  useEffect(() => {\r\n    const cookies = new Cookies();\r\n    const logged = cookies.get(core.COOKIE_AUTH_NAME);\r\n  \r\n    let user_roles = [];\r\n    if (logged && logged.userroles && logged.userroles.length) {\r\n      user_roles = [...logged.userroles];\r\n    }\r\n\r\n    let roles = [];\r\n    let showExport = true;    \r\n    if (record.config_json && record.config_json.export_roles && record.config_json.export_roles.length) {\r\n      roles = record.config_json.export_roles.filter(x => user_roles.includes(x));\r\n      if (!roles || roles.length === 0) {\r\n        showExport = false;\r\n      }\r\n    }\r\n  \r\n    const showExportAll = (record.config_json && record.config_json.export_all != null) ? record.config_json.export_all : true;\r\n    const showExportRecord = (record.config_json && record.config_json.export_record != null) ? record.config_json.export_record : true;\r\n    \r\n    setUserRoles(user_roles || []);\r\n    setShowExport(showExport);\r\n    setShowExportAll(showExportAll);\r\n    setShowExportRecord(showExportRecord);\r\n  }, []);\r\n\r\n  // Update accordion active items\r\n  useEffect(() => {\r\n    let active = Object.keys(grouped).map((title, i) => i);\r\n\r\n    if (active && active.length) {\r\n      setActiveIndex(active);\r\n    } else {\r\n      setActiveIndex([0]);\r\n    }\r\n  }, [features.length]);\r\n\r\n  // Zoom to feature\r\n  function zoomFeature(feat) {\r\n    if (feat.getGeometry()) {\r\n      const extent = feat.getGeometry().getExtent();\r\n      //extent validation\r\n      if (!extent) return;\r\n      if (!extent.length) return;\r\n      if (extent[0] === Infinity) return;\r\n      //zoom to extent\r\n      let center = [extent[0] + (extent[2] - extent[0])/2, extent[1] + (extent[3] - extent[1])/2]\r\n      dispatch(actions.map_set_extent(center, extent));\r\n    }\r\n  }\r\n\r\n  // Remove one item\r\n  function removeItem(item) {\r\n    let index = -1;\r\n    if (item.get) {\r\n      index = features.findIndex(f => f.id === item.get('resultId'));\r\n    } else if (item.id) {\r\n      index = features.findIndex(f => f.id === item.id);\r\n    }\r\n    if (index === -1) return;\r\n    let updated = [...features];\r\n    updated.splice(index, 1);\r\n    dispatch(actions.viewer_set_featureinfo(updated));\r\n  }\r\n\r\n  // Remove all items\r\n  function removeAll() {\r\n    dispatch(actions.viewer_set_featureinfo([]));\r\n  }\r\n\r\n  // Export one\r\n  function exportItem(item) {\r\n    let outCRS = null;\r\n    if (record && record.config_json && record.config_json.export_crs) {\r\n      outCRS = record.config_json.export_crs;\r\n    }\r\n\r\n    let results = [item];\r\n    let text = serializeFeatures(results, mainMap, viewer, outCRS);\r\n    download('selecao.geojson', text);\r\n  }\r\n\r\n  // Export all results\r\n  function exportAll() {\r\n    let outCRS = null;\r\n    if (record && record.config_json && record.config_json.export_crs) {\r\n      outCRS = record.config_json.export_crs;\r\n    }\r\n\r\n    let results = [];\r\n    Object.keys(grouped).map(title => {\r\n      if (allowExportFeatures(title, layers, userRoles)) {\r\n        results = results.concat(grouped[title]);\r\n      }\r\n    });\r\n    let text = serializeFeatures(results, mainMap, viewer, outCRS);\r\n    download('selecao.geojson', text);\r\n  }\r\n\r\n  const valueTemplate = (rowData) => {    \r\n    let val = rowData.value;\r\n    if (rowData.action && rowData.action.type) {\r\n      const action = rowData.action || {};\r\n\r\n      if (action.show_null === true || rowData.value != null) {\r\n        val = <Button label={action.label} icon={action.icon}\r\n            className={action.classname || action.className}\r\n            title={action.tooltip}\r\n            onClick={(e) => publish(action.type, action.data)}\r\n          />\r\n      } else {\r\n        val = null;\r\n      }\r\n    } else if ((rowData.type || '') === 'html') {\r\n      val = <div\r\n          dangerouslySetInnerHTML={{__html: rowData.value}}\r\n        />\r\n    }\r\n    return val;\r\n  }\r\n\r\n  if (Object.keys(grouped).length === 0) return (\r\n    <Message\r\n      severity=\"info\"\r\n      text=\"Sem resultados. Clique no mapa para identificar.\" \r\n    />\r\n  ) \r\n\r\n  return (\r\n    <div>\r\n      <div style={ {padding: \"0.571rem 1rem\", textAlign: \"right\"} }>\r\n        <Button\r\n          title=\"Limpar resultados\"\r\n          label=\"Limpar\"\r\n          icon=\"pi pi-times\"\r\n          className=\"p-button-outlined p-button-sm\"\r\n          onClick={e => removeAll()}\r\n        />\r\n        { (showExport && showExportAll && showExportAllFeatures) ?\r\n        <Button\r\n          title=\"Exportar resultados\"\r\n          label=\"Exportar\"\r\n          icon=\"pi pi-download\"\r\n          className=\"p-button-outlined p-button-sm p-ml-2\"\r\n          onClick={e => exportAll()}\r\n        /> : null }\r\n      </div>\r\n\r\n      <Accordion\r\n        className=\"p-pt-2\"\r\n        multiple\r\n        activeIndex={activeIndex} \r\n        onTabChange={(e) => setActiveIndex(e.index)}>\r\n          { Object.keys(grouped).map(title => {\r\n\r\n            // Validate layer\r\n            const layer = layers.find(l => l.title === title);\r\n            //if (!layer) return null;\r\n\r\n            //Get export permissions from layer config\r\n            let layerRecordExport = true;\r\n            if (layer && layer.featureinfo_export_roles && layer.featureinfo_export_roles.length) {\r\n              const roles = layer.featureinfo_export_roles.filter(x => userRoles.includes(x));\r\n              if (roles && roles.length === 0) {\r\n                layerRecordExport = false;\r\n              }\r\n            }\r\n            \r\n            return (\r\n              <AccordionTab header={title}>\r\n                { grouped[title].map((feat, i) => {\r\n                    \r\n                  let key;                  \r\n                  if (feat.getId) key = feat.getId();\r\n                  else if (feat.get) key = feat.get('id') || feat.get('uid') || feat.get('fid');\r\n                  else if (feat.id) key = feat.id;\r\n                  else key = String(i);\r\n\r\n                  const rows = getFeatureRows(feat, layer);\r\n\r\n                  const hasGeometry = (feat.getGeometry && feat.getGeometry() != null);\r\n                  const isText = (feat.type === 'text');\r\n                  return (\r\n                    <div key={key} className=\"fi-result-feat\">\r\n                      <div className=\"fi-result-tools\">\r\n                        {hasGeometry &&\r\n                        <Button\r\n                          title=\"Aproximar ao elemento\"\r\n                          icon=\"pi pi-search\"\r\n                          onClick={e => zoomFeature(feat)}\r\n                        />}\r\n                        {(!isText && showExport && showExportRecord && layerRecordExport) &&\r\n                        <Button\r\n                          title=\"Exportar elemento\"\r\n                          icon=\"pi pi-download\"\r\n                          onClick={e => exportItem(feat)}\r\n                        />}\r\n                        <Button\r\n                          title=\"Remover elemento\"\r\n                          icon=\"pi pi-times\"\r\n                          onClick={e => removeItem(feat)}\r\n                        />\r\n                      </div>\r\n                      <DataTable\r\n                        value={rows}\r\n                        groupField=\"layer\"\r\n                        className=\"p-datatable-striped\">\r\n                          {!isText &&\r\n                          <Column\r\n                            header=\"&nbsp;\"\r\n                            field=\"name\"\r\n                            style={{whiteSpace: \"pre-wrap\", overflowWrap: \"break-word\"}}\r\n                          />}\r\n                          <Column\r\n                            header=\"&nbsp;\"\r\n                            field=\"value\"\r\n                            body={valueTemplate}\r\n                            style={{whiteSpace: \"pre-wrap\", overflowWrap: \"break-word\"}}\r\n                          />\r\n                      </DataTable>\r\n                    </div>\r\n                  )\r\n                \r\n                })} \r\n              </AccordionTab>\r\n            )\r\n          }) }\r\n      </Accordion>\r\n    </div>\r\n    \r\n  )\r\n}\r\n\r\nfunction getFeatureRows(feat, layer) {\r\n  const rows = [];\r\n  if (feat.type === 'text') {\r\n    rows.push({ name: 'name', value: feat.data, type: 'text' });\r\n  } else {\r\n    let feature_tpl = null;\r\n    if (layer && layer.feature_tpl && layer.feature_tpl.fields && layer.feature_tpl.fields.length) {\r\n      feature_tpl = layer.feature_tpl;\r\n    } else if (feat.get('feature_tpl') && feat.get('feature_tpl').fields && feat.get('feature_tpl').fields.length) {\r\n      feature_tpl = feat.get('feature_tpl');\r\n    }\r\n\r\n    if (feat instanceof OlFeature) {\r\n      if (feature_tpl) {\r\n        feature_tpl.fields.forEach((field, i) => {\r\n          let key = field.name;\r\n          if (typeof feat.get(key) != 'object') {\r\n\r\n            let new_value = feat.get(field.name);\r\n\r\n            //Apply field template\r\n            if (field.value) {\r\n              new_value = field.value;\r\n            }\r\n            const rf = (new_value && new_value.match) ? new_value.match(/[^{}]+(?=})/g) : null;\r\n            if (rf) {\r\n              rf.forEach(fld => {\r\n                new_value = new_value.replace(`{${fld}}`, feat.get(fld) || '');      \r\n              });                 \r\n            }\r\n\r\n            if (field.action) {              \r\n              const action = {...field.action, data: {...feat.getProperties()}};\r\n              delete action.data.feature_tpl;\r\n\r\n              if (field.action.data) {\r\n                const new_data = {}\r\n                Object.entries(field.action.data).forEach(([key, value]) => {                                    \r\n                  let new_value = value;\r\n                  //Apply field template\r\n                  const rf = (value && value.match) ? value.match(/[^{}]+(?=})/g) : null;\r\n                  if (rf) {\r\n                    const fld = rf[0];\r\n                    if (rf.length === 1 && value === `{${fld}}` ) {\r\n                      if (rf[0] in action.data) {\r\n                        new_value = action.data[rf[0]];\r\n                      }\r\n                    } else {\r\n                      rf.forEach(fld => {\r\n                        if (fld in action.data) {\r\n                          new_value = new_value.replace(`{${fld}}`, action.data[fld]);\r\n                        }                      \r\n                      });\r\n                    }                    \r\n                  }\r\n                  new_data[key] = new_value;\r\n                });\r\n                action.data = new_data;\r\n              }\r\n              rows.push({ \r\n                key, \r\n                name: field.title,\r\n                action,\r\n                value: new_value,\r\n                type: field.type\r\n              });\r\n            } else {\r\n              rows.push({ \r\n                key,\r\n                name: field.title,\r\n                value: formatValue(new_value, field.format),\r\n                type: field.type\r\n              });\r\n            }\r\n          }\r\n        })\r\n      } else {\r\n        let geometryName = feat.getGeometryName() || 'geometry';\r\n        feat.getKeys().forEach((key, i) => {\r\n          if ((typeof feat.get(key) !='object') && (![geometryName, 'st_union', 'boundedBy', 'resultId'].includes(key))) {\r\n            rows.push({ key, name: key, value: feat.get(key) });\r\n          }\r\n        });\r\n      }\r\n    } else {\r\n      if (feature_tpl) {\r\n        feature_tpl.fields.forEach((field, i) => {\r\n          let key = field.name;\r\n          if (typeof feat.get(key) != 'object') {\r\n\r\n            let new_value = feat.data[field.name];\r\n\r\n            //Apply field template\r\n            if (field.value) {\r\n              new_value = field.value;\r\n            }\r\n            const rf = (new_value && new_value.match) ? new_value.match(/[^{}]+(?=})/g) : null;\r\n            if (rf) {\r\n              rf.forEach(fld => {\r\n                new_value = new_value.replace(`{${fld}}`, feat.get(fld) || '');      \r\n              });                 \r\n            }\r\n\r\n            //rows.push({ key, name: field.title, value: formatValue(feat.data[field.name],field.format), type: field.type });\r\n            rows.push({ \r\n              key, \r\n              name: field.title, \r\n              value: formatValue(new_value,field.format), \r\n              type: field.type \r\n            });\r\n          }\r\n        })\r\n      } else {\r\n        Object.keys(feat.data).forEach(k => {\r\n          if (typeof feat.data[k] != 'object') {\r\n            rows.push({ name: k, value: feat.data[k] })\r\n          }\r\n        });\r\n        //rows.push({ name: 'name', value: JSON.stringify(feat.data) });\r\n      }\r\n    }\r\n  }\r\n  return rows;\r\n}\r\n\r\nfunction groupResults(features, map) {\r\n  const grouped = {};\r\n  features.forEach(feat => {\r\n    if (feat.layer && feat.data) {\r\n      if (!grouped[feat.layer]) grouped[feat.layer] = [];\r\n      if (feat.type === 'ol') {\r\n        let items = parseOlFeatures(feat.data, map);\r\n        items.forEach(f => {\r\n          f.set('resultId', feat.id)\r\n          f.set('feature_tpl', {...feat.feature_tpl});\r\n        });\r\n        grouped[feat.layer] = grouped[feat.layer].concat(items);\r\n      }\r\n      else {\r\n        grouped[feat.layer].push(feat);\r\n      }\r\n    }\r\n  });\r\n  return grouped;\r\n}\r\n\r\nfunction allowExportFeatures(layerKey, layers, userRoles) {\r\n  let allowExport = false;\r\n\r\n  const layer = layers.find(l => l.title === layerKey);\r\n  if (layer) {\r\n    //Get export permissions from layer config\r\n    if (layer && layer.featureinfo_export_roles && layer.featureinfo_export_roles.length) {\r\n      const roles = layer.featureinfo_export_roles.filter(x => userRoles.includes(x));\r\n      if (roles && roles.length > 0) {\r\n        allowExport = true;\r\n      }\r\n    } else {\r\n      allowExport = true;\r\n    }\r\n  }\r\n\r\n  return allowExport;\r\n}\r\n\r\nfunction getShowExportAllFeatures(groups, layers, userRoles) {\r\n  let show = false;\r\n\r\n  Object.keys(groups).forEach((key, i) => {\r\n    if (allowExportFeatures(key, layers, userRoles)) {\r\n      show = true;\r\n    }\r\n  });\r\n\r\n  return show;\r\n}\r\n\r\nfunction parseOlFeatures(data, map) {\r\n  // Parse OL feature\r\n  const parser = new OlFormatGeoJSON();\r\n  const parseOptions = {\r\n    dataProjection: map.getView().getProjection().getCode(),\r\n    featureProjection: map.getView().getProjection().getCode()\r\n  };\r\n  let features = parser.readFeatures(data, parseOptions);\r\n  features = features instanceof OlCollection ? features.getArray() : features;\r\n  return features;\r\n}\r\n\r\nfunction serializeFeatures(features, map, viewer, outCRS) {\r\n  let crs = outCRS;\r\n  if (!crs) {\r\n    if (viewer.config_json && viewer.config_json.export_crs) {\r\n      crs = viewer.config_json.export_crs;    \r\n    } else if (viewer.config_json && viewer.config_json.display_crs) {\r\n      crs = viewer.config_json.display_crs;\r\n    } else {\r\n      crs = 4326;\r\n    }\r\n  }\r\n\r\n  const parser = new OlFormatGeoJSON();\r\n  const parseOptions = {\r\n    dataProjection: 'EPSG:' + crs,\r\n    featureProjection: map.getView().getProjection().getCode()\r\n  };\r\n  const tmpjson = parser.writeFeatures(features, parseOptions);\r\n  const geojson = JSON.parse(tmpjson);\r\n  const crsinfo = {\r\n                  \"type\": \"name\",\r\n                  \"properties\": {\r\n                      \"name\": \"urn:ogc:def:crs:EPSG::\" + crs\r\n                  }\r\n              };\r\n  geojson['crs'] = crsinfo;  \r\n  return JSON.stringify(geojson);\r\n}\r\n\r\nfunction download(filename, text) {\r\n  const element = document.createElement('a');\r\n  element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));\r\n  element.setAttribute('download', filename);\r\n  element.style.display = 'none';\r\n  document.body.appendChild(element);\r\n  element.click();\r\n  document.body.removeChild(element);\r\n}\r\n\r\nfunction formatValue(value, format) {\r\n  let new_value = value;\r\n  if (format) {\r\n    let val = value;\r\n    if (format.source_unit && format.output_unit) {\r\n      val = unit(val, format.source_unit).toNumeric(format.output_unit);\r\n    }\r\n    if (format.options) {\r\n      val =  val.toLocaleString(format.locale || 'en-US', format.options);\r\n      if (format.options.useGrouping !== false) {\r\n        val = val.replace(/,/g,\" \");\r\n      }\r\n    }\r\n    if (format.expression) {\r\n      val = format.expression.replace('{value}', val);\r\n    }\r\n    new_value = val;\r\n  }\r\n  return new_value;\r\n}\r\n\r\nconst formatTemplateValue = (rowData, value) => {\r\n  let new_value = value;\r\n\r\n  const rf = (new_value && new_value.match) ? new_value.match(/[^{}]+(?=})/g) : null;\r\n  if (rf) {\r\n    if (rf.length === 1) {\r\n      const fld = rf[0];\r\n      if (fld in rowData) {\r\n        new_value = rowData[fld];\r\n      }\r\n    } else {\r\n      rf.forEach(fld => {\r\n        new_value = new_value.replace(`{${fld}}`, rowData[fld] || '');      \r\n      });\r\n    }\r\n  }\r\n \r\n  return new_value;\r\n}","import React, { useEffect } from 'react'\r\nimport { Button } from 'primereact/button'\r\nimport OLGroupLayer from \"ol/layer/Group\"\r\nimport { Panel } from 'primereact/panel'\r\n\r\nimport componentMessages from './messages'\r\n\r\nimport FeatureResults from './FeatureResults'\r\nimport './index.css'\r\n\r\nexport function traverseOlLayers(collection, cb) {\r\n  collection.forEach(l => {\r\n    cb(l);\r\n    if (l instanceof OLGroupLayer) traverseOlLayers(l.getLayers(), cb);\r\n  })\r\n}\r\n\r\n/**\r\n * Main menu component\r\n */\r\nexport function MainMenu({ className, config, actions, record }) {\r\n\r\n  const component_cfg = record.config_json || {};\r\n  const title = record.title || 'Identificar Elementos';\r\n\r\n  return (\r\n    <Button\r\n      title={title}\r\n      className={className}\r\n      icon=\"pi pi-info-circle\"\r\n      style={{ margin: '0.5em 1em' }}\r\n      onClick={e => config.dispatch(actions.viewer_set_selectedmenu(record.id))}\r\n    />\r\n  )\r\n}\r\n\r\nexport default function Main({ as, core, config, actions, record }) {\r\n\r\n  const { viewer, dispatch, Models, mainMap } = config;\r\n  //const { publish, subscribe } = core.pubsub ? core.pubsub : {}\r\n  const { featureinfo } = viewer;\r\n  const { getWindowSize, showOnPortal } = Models.Utils;\r\n  const { selected_menu, layers } = viewer.config_json;\r\n\r\n  const component_cfg = record.config_json || {};\r\n  const title = record.title || 'Identificar Elementos';\r\n  const header = component_cfg.header || title;\r\n\r\n  const wsize = getWindowSize();\r\n  const isMobile = wsize[0] <= 768;  \r\n\r\n  useEffect(() => {\r\n    if (selected_menu === 'featureinfo') dispatch(actions.viewer_set_exclusive_mapcontrol('FeatureInfo'));\r\n  }, [selected_menu]);\r\n\r\n  useEffect(() => {\r\n    if (selected_menu === 'featureinfo') {\r\n      if (!isMobile && component_cfg.expand_menu === true) {\r\n        dispatch(actions.layout_show_menu(true));\r\n      }\r\n      if (isMobile && component_cfg.expand_menu_mobile === true) {\r\n        dispatch(actions.layout_show_menu(false));\r\n      }\r\n    }\r\n  }, [viewer.featureinfo]);  \r\n\r\n  // Render content\r\n  function renderContent() {\r\n    return (\r\n      <div className=\"feature-info\">\r\n\r\n        <FeatureResults\r\n          core={core}\r\n          config={config}\r\n          features={featureinfo}\r\n          layers={layers}\r\n          actions={actions}\r\n          pubsub={core.pubsub}\r\n          dispatch={dispatch}\r\n          mainMap={mainMap}\r\n          record={record}\r\n        />\r\n        \r\n      </div>\r\n    )\r\n    \r\n  }\r\n\r\n  if (as === 'panel') return (\r\n    <Panel header={header}>\r\n      { renderContent() }\r\n    </Panel>\r\n  )\r\n\r\n  return null\r\n}\r\n","import React, { useState, useEffect } from 'react'\r\nimport { transform } from 'ol/proj'\r\nimport { Button } from 'primereact/button'\r\nimport { InputSwitch } from 'primereact/inputswitch'\r\nimport { ToggleButton } from 'primereact/togglebutton';\r\nimport {Checkbox} from 'primereact/checkbox';\r\nimport { Column } from 'primereact/column'\r\nimport { DataTable } from 'primereact/datatable'\r\nimport { Message } from 'primereact/message'\r\n\r\nexport default function GeoLocation({ config, actions, dispatch, record }) {\r\n\r\n  const { viewer, mainMap, Models } = config;\r\n  const { getProjectionSrid } = Models.MapModel;\r\n  const { geolocation }  = viewer;\r\n\r\n  const component_cfg = record.config_json;\r\n\r\n  const geo_location_control = viewer.config_json.map_controls.find(c => c.id === 'GeoLocation');\r\n  const geoLocationActive = geo_location_control ? geo_location_control.active : false;\r\n  const geoLocationTracking = geo_location_control ? geo_location_control.tracking : false;\r\n  const { viewer_update_mapcontrol, viewer_set_selectedmenu, map_set_extent, viewer_set_exclusive_mapcontrol } = actions;\r\n\r\n  const [results, setResults] = useState([]);\r\n\r\n  function getErrorMessage(error, messages) {\r\n    let message = error.message;\r\n\r\n    switch(error.code) {\r\n      case 1:\r\n        //The acquisition of the geolocation information failed because the page did not have the permission to do it.\r\n        message = 'Não foi autorizada a obtenção da localização.';\r\n        break;\r\n      case 2:\r\n        //The acquisition of the geolocation failed because one or several internal sources of position returned an internal error.\r\n        message = 'Ocorreu um erro interno ao obter-se a localização.';\r\n        break;\r\n      case 3:\r\n        //The time allowed to acquire the geolocation, defined by PositionOptions.timeout information that was reached before the information was obtained.\r\n        message = 'Ocorreu um timeout antes de ter sido possível obter a localização.';\r\n        break;\r\n      default:\r\n        message = messages?.error?.text ? messages.error.text : 'Não foi possível obter a localização.';\r\n    }\r\n\r\n    if (error.code && messages && messages['error' + error.code] && messages['error' + error.code].text) {\r\n      message = messages['error' + error.code].text;\r\n    }\r\n\r\n    return message;\r\n  }\r\n\r\n  function buildResultsTable() {\r\n    const results = [];\r\n\r\n    const precision = 10000;\r\n\r\n    if (geolocation && geolocation.coordinates) {\r\n      results.push({ field: 'Longitude (dd)', value: (Math.round(geolocation.coordinates[0] * precision) / precision) });\r\n      results.push({ field: 'Latitude (dd)', value: (Math.round(geolocation.coordinates[1] * precision) / precision) });\r\n\r\n      if (viewer.config_json.display_crs && viewer.config_json.display_crs != 4326) {\r\n        const display_coords = transform(geolocation.coordinates, 'EPSG:4326', 'EPSG:' + viewer.config_json.display_crs);\r\n        results.push({ field: 'X [EPSG:' + viewer.config_json.display_crs + ']', value: (Math.round(display_coords[0] * 100) / 100) });\r\n        results.push({ field: 'Y [EPSG:' + viewer.config_json.display_crs + ']', value: (Math.round(display_coords[1] * 100) / 100) });\r\n      }\r\n\r\n      geolocation.accuracy && results.push({ field: 'Precisão', value: ((Math.round(geolocation.accuracy * 100) / 100) + ' m')});\r\n      geolocation.altitude && results.push({ field: 'Altitude', value: ((Math.round(geolocation.altitude * 100) / 100) + ' m')});\r\n      geolocation.altitudeAccuracy && results.push({ field: 'Precisão da Altitude', value: ((Math.round(geolocation.altitudeAccuracy * 100) /100) + ' m')});\r\n      geolocation.heading && results.push({ field: 'Direção', value: ((Math.round(geolocation.heading * 100) / 100) + ' rad')});\r\n      geolocation.speed && results.push({ field: 'Velocidade', value: ((Math.round(geolocation.speed  * 100) / 100) + ' m/s')});\r\n    }\r\n    setResults(results);\r\n  }\r\n\r\n  function toggleGeoLocationControl(val) {\r\n    const active = val;\r\n    dispatch(viewer_update_mapcontrol({ ...geo_location_control, active }));\r\n    /*\r\n    const active = !geoLocationActive;\r\n    dispatch(viewer_update_mapcontrol({ ...geo_location_control, active }));\r\n    if (active && geo_location_component) dispatch(viewer_set_selectedmenu('geolocation'));\r\n    */\r\n  }\r\n\r\n  function trackingGeoLocationControl(val) {\r\n    const tracking = val;\r\n    dispatch(viewer_update_mapcontrol({ ...geo_location_control, tracking }));\r\n    /*\r\n    const active = !geoLocationActive;\r\n    dispatch(viewer_update_mapcontrol({ ...geo_location_control, active }));\r\n    if (active && geo_location_component) dispatch(viewer_set_selectedmenu('geolocation'));\r\n    */\r\n  }\r\n\r\n  function zoomGeoLocation(position) {\r\n    // Zoom to extent        \r\n    if (position && position.coordinates) {\r\n        const coordinates = transform(position.coordinates, 'EPSG:4326', mainMap.getView().getProjection());\r\n        const extent = [coordinates[0] - 500, coordinates[1] - 500, \r\n                        coordinates[0] + 500, coordinates[1] + 500];\r\n        const srid = getProjectionSrid(mainMap.getView().getProjection()); \r\n        dispatch(actions.map_set_extent(coordinates, extent, srid));\r\n    }\r\n  }  \r\n\r\n  useEffect(()=>{\r\n    buildResultsTable();\r\n  },[viewer.config_json.display_crs]);\r\n\r\n  useEffect(()=>{\r\n    buildResultsTable();\r\n  }, [geolocation]);\r\n\r\n  if (geolocation && geolocation.error) return (\r\n    <Message\r\n      severity=\"warn\"\r\n      text={getErrorMessage(geolocation.error, component_cfg?.messages)}\r\n    />\r\n  )\r\n\r\n  return (\r\n    <div>\r\n      <Message\r\n        severity=\"info\"\r\n        text={component_cfg?.messages?.intro?.text ? component_cfg.messages.intro.text : \"Selecione a opção 'Ver Posição' para ativar a visualização da sua posição.\"}\r\n      />\r\n\r\n      <div className=\"p-mt-3 p-pt-3 p-pr-2 p-pl-2\" style={{\"border\": \"1px solid rgb(111 57 57 / 12%)\"}}>\r\n        <div className=\"p-grid\">\r\n          <div className=\"p-col\" style={{ textAlign: 'left'}}>\r\n            <InputSwitch\r\n              className=\"p-mr-1\"\r\n              inputId=\"geolocationSwitch\"\r\n              checked={geoLocationActive}\r\n              onChange={(e) => toggleGeoLocationControl(e.value)}\r\n            />\r\n            {' '}\r\n            <label htmlFor=\"geolocationSwitch\">\r\n              <span className=\"p-text-bold\">Ver Posição</span>\r\n            </label>\r\n          </div>\r\n        </div>\r\n        <div className=\"p-grid p-mt-2\">\r\n          <div className=\"p-col\" style={{ textAlign: 'left'}}>\r\n            <div className=\"p-field-checkbox p-mb-1\">\r\n            <Checkbox onChange={e => trackingGeoLocationControl(e.checked)} checked={geoLocationTracking} disabled={!geoLocationActive}></Checkbox>\r\n            <label className={\"p-checkbox-label\" + (!geoLocationActive ? \" p-disabled\" : \"\")}>Atualizar</label>\r\n            </div>\r\n          </div>\r\n          <div className=\"p-col\" style={{ textAlign: 'right'}}>\r\n            <Button\r\n              label=\"Localizar\"\r\n              icon=\"pi pi-search\"\r\n              className=\"p-button-sm\"\r\n              onClick={e => { zoomGeoLocation(geolocation); }}\r\n              disabled={!geoLocationActive}\r\n            />\r\n          </div>        \r\n        </div>\r\n      </div>\r\n\r\n      { geolocation &&\r\n      <div className=\"card p-pt-1\">          \r\n          <DataTable value={results}>\r\n            <Column field=\"field\" header=\"\"></Column>\r\n            <Column field=\"value\" header=\"\"></Column>\r\n          </DataTable>          \r\n      </div> }\r\n  </div>\r\n  )\r\n\r\n}","import React from 'react'\r\nimport { Button } from 'primereact/button'\r\nimport OLGroupLayer from \"ol/layer/Group\"\r\nimport { Panel } from 'primereact/panel'\r\nimport GeoLocation from './GeoLocation'\r\nimport './style.css'\r\n\r\n/**\r\n * Main menu component\r\n */\r\nexport function MainMenu({ className, config, actions, record }) {\r\n  return (\r\n    <Button\r\n      title=\"A minha localização\"\r\n      className={className}\r\n      icon=\"pi pi-globe\"\r\n      style={{ margin: '0.5em 1em' }}\r\n      onClick={e => config.dispatch(actions.viewer_set_selectedmenu(record.id))}\r\n    />\r\n  )\r\n}\r\n\r\nexport default function Main({ as, config, actions, record }) {\r\n\r\n  const { viewer, dispatch } = config;\r\n\r\n  // Render content\r\n  function renderContent() {\r\n    return (\r\n      <div className=\"geo-location\">\r\n\r\n        <GeoLocation\r\n          config={config}\r\n          actions={actions}\r\n          dispatch={dispatch}\r\n          record={record}\r\n        />\r\n        \r\n      </div>\r\n    )\r\n    \r\n  }\r\n\r\n  if (as === 'panel') return (\r\n    <Panel header=\"A minha localização\">\r\n      { renderContent() }\r\n    </Panel>\r\n  )\r\n\r\n  return null\r\n}","import React, { useEffect, useState } from 'react';\r\nimport './style.css'\r\n\r\n\r\nexport default function HelpHtmlContent({ config }) {\r\n\r\n  const [dialogContent, setDialogContent ] = useState(null);\r\n\r\n  useEffect(() => {    \r\n    if (config.url) {\r\n      const url = config.url;\r\n      fetch(url).then(res => {\r\n          return res.text();\r\n      }).then(result => {\r\n          //console.log(result);\r\n          setDialogContent(result);\r\n      }).catch(error => {        \r\n          //console.log('error', error);\r\n          setDialogContent(config.html || '');\r\n      })\r\n    } else {\r\n      setDialogContent(config.html || '');\r\n    }    \r\n  }, []);\r\n\r\n  return (\r\n    <div dangerouslySetInnerHTML={{ __html: dialogContent }}></div>\r\n  )\r\n\r\n}","import React, { useState, useRef } from 'react';\r\nimport { Button } from 'primereact/button'\r\nimport { Panel } from 'primereact/panel'\r\nimport { Dialog } from 'primereact/dialog'\r\nimport HelpHtmlContent from './HelpHmtlContent'\r\nimport './style.css'\r\n\r\n/**\r\n * Main menu component\r\n */\r\nexport function MainMenu({ className, config, actions, record }) {\r\n\r\n  const { viewer, dispatch, Models } = config;\r\n  const { getWindowSize, showOnPortal } = Models.Utils;\r\n\r\n  const [showPopup, setShowPopup] = useState(false);\r\n  const [size, setSize] = useState(null);\r\n  const [maximized, setMaximized] = useState(false);\r\n\r\n  const dialog = useRef();\r\n\r\n  const component_cfg = record.config_json || {};\r\n  const title = record.title || 'Ajuda';\r\n  const header = component_cfg.header || title;\r\n\r\n  const wsize = getWindowSize();\r\n  const isMobile = wsize[0] <= 768;\r\n\r\n  if (record.as === 'popup') {    \r\n    const closeLabel = component_cfg.closeLabel || \"Fechar\";    \r\n    return (\r\n      <React.Fragment>\r\n\r\n        <Button\r\n          title={title}\r\n          className={className}\r\n          icon=\"far fa-question-circle\"\r\n          style={{ margin: '0.5em 1em' }}\r\n          onClick={e => setShowPopup(true)}\r\n        />\r\n\r\n        {showOnPortal(<Dialog\r\n          ref={dialog}        \r\n          header={header}\r\n          visible={showPopup}\r\n          style={{width: isMobile ? '90%' : '50vw', height: '80%' }}\r\n          maximizable\r\n          maximized={maximized} \r\n          modal\r\n          footer={(\r\n            <div className=\"p-grid\">\r\n              <div className=\"p-col\" style={{ textAlign: 'right'}}>\r\n                <Button label={closeLabel} onClick={e => setShowPopup(false)} />\r\n              </div>\r\n            </div>\r\n          )}\r\n          onShow={() => {\r\n            const elem = dialog.current.contentEl;\r\n            setSize({x: elem.clientWidth, y: elem.clientHeight - 25 });\r\n          }}\r\n          onResize={e => {\r\n            const elem = dialog.current.contentEl;\r\n            setSize({x: elem.clientWidth, y: elem.clientHeight - 25 });\r\n          }}\r\n          onMaximize={e => {\r\n            setMaximized(e.maximized);\r\n            const elem = dialog.current.contentEl;\r\n            setTimeout(() => {setSize({x: elem.clientWidth, y: elem.clientHeight - 25 }, 200)});\r\n          }}\r\n          onHide={e => setShowPopup(false)}>\r\n          \r\n          { component_cfg.iframe === true ?\r\n            <iframe title={title} src={component_cfg.url} style={ size ? { border: 'none', width: '100%', height: size.y } : {border: 'none', width: '100%'}}></iframe>\r\n            :\r\n            <HelpHtmlContent\r\n              config={component_cfg}\r\n              size={size}\r\n            />\r\n          }\r\n\r\n        </Dialog>)}\r\n\r\n      </React.Fragment>\r\n    )\r\n  } else if (record.as === 'external') { \r\n    const help_url = component_cfg.url ? component_cfg.url : viewer?.config_json?.help_url ;\r\n\r\n    if (!help_url) return null;\r\n    return (\r\n      <Button\r\n        title={title}\r\n        className={className}\r\n        icon=\"far fa-question-circle\"\r\n        style={{ margin: '0.5em 1em' }}\r\n        onClick={e => window.open(help_url)} />\r\n    )\r\n  }  else {\r\n    return (\r\n      <Button\r\n        title={title}\r\n        className={className}\r\n        icon=\"far fa-question-circle\"\r\n        style={{ margin: '0.5em 1em' }}\r\n        onClick={e => config.dispatch(actions.viewer_set_selectedmenu(record.id))}\r\n      />\r\n    )\r\n  }\r\n}\r\n\r\nexport default function Main({ as, config, actions, record }) {\r\n\r\n  const { viewer, dispatch, Models } = config;\r\n  const { getWindowSize, showOnPortal } = Models.Utils;\r\n\r\n  const [showPopup, setShowPopup] = useState(false);\r\n  const [size, setSize] = useState(null);\r\n  const [maximized, setMaximized] = useState(false);\r\n\r\n  const dialog = useRef();    \r\n\r\n  const component_cfg = record.config_json || {};\r\n  const title = record.title || 'Ajuda';\r\n  const header = component_cfg.header || title;\r\n\r\n  const wsize = getWindowSize();\r\n  const isMobile = wsize[0] <= 768;\r\n\r\n  const closeLabel = component_cfg.closeLabel || \"Fechar\";\r\n  \r\n  const openAs = record?.as || as;\r\n\r\n  // Render content\r\n  function renderContent() {\r\n    return (\r\n      <HelpHtmlContent\r\n        config={component_cfg}\r\n      />\r\n    )\r\n  }\r\n\r\n  if (openAs === 'panel') return (\r\n    <Panel header={header}>\r\n      { renderContent() }\r\n    </Panel>\r\n  )\r\n\r\n  if (openAs === 'popup') return (\r\n    <React.Fragment>\r\n      <button className=\"p-link\" onClick={e => setShowPopup(true)} title={title}>\r\n        <span className=\"layout-topbar-item-text\"></span>\r\n        <span className=\"layout-topbar-icon far far fa-question-circle\" />\r\n      </button>\r\n\r\n      {showOnPortal(<Dialog\r\n          ref={dialog}        \r\n          header={header}\r\n          visible={showPopup}\r\n          style={{width: isMobile ? '90%' : '50vw', height: '80%' }}\r\n          maximizable\r\n          maximized={maximized} \r\n          modal\r\n          footer={(\r\n            <div className=\"p-grid\">\r\n              <div className=\"p-col\" style={{ textAlign: 'right'}}>\r\n                <Button label={closeLabel} onClick={e => setShowPopup(false)} />\r\n              </div>\r\n            </div>\r\n          )}\r\n          onShow={() => {\r\n            const elem = dialog.current.contentEl;\r\n            setSize({x: elem.clientWidth, y: elem.clientHeight - 25 });\r\n          }}\r\n          onResize={e => {\r\n            const elem = dialog.current.contentEl;\r\n            setSize({x: elem.clientWidth, y: elem.clientHeight - 25 });\r\n          }}\r\n          onMaximize={e => {\r\n            setMaximized(e.maximized);\r\n            const elem = dialog.current.contentEl;\r\n            setTimeout(() => {setSize({x: elem.clientWidth, y: elem.clientHeight - 25 }, 200)});\r\n          }}\r\n          onHide={e => setShowPopup(false)}>\r\n          \r\n          { component_cfg.iframe === true ?\r\n            <iframe title={title} src={component_cfg.url} style={ size ? { border: 'none', width: '100%', height: size.y } : {border: 'none', width: '100%'}}></iframe>\r\n            :\r\n            <HelpHtmlContent\r\n              config={component_cfg}\r\n              size={size}\r\n            />\r\n          }\r\n\r\n        </Dialog>)}\r\n\r\n    </React.Fragment>\r\n  )\r\n\r\n  if (openAs === 'external') {    \r\n    const help_url = component_cfg.url ? component_cfg.url : viewer?.config_json?.help_url ;\r\n\r\n    if (!help_url) return null;\r\n\r\n    // Render help button\r\n    return (\r\n      <button className=\"p-link\" title={title} onClick={e => { return; }}>\r\n        <a href={help_url} target=\"_blank\" style={{\"color\": \"#ffffff\"}}>\r\n          <span className=\"layout-topbar-item-text\">{title}</span>\r\n          <span className=\"layout-topbar-icon pi pi-question-circle\"/>\r\n        </a>\r\n      </button>\r\n    )\r\n  }\r\n\r\n  return null\r\n}","import React, { useState, useEffect } from 'react'\r\n\r\nexport default function HtmlContent({ region, as, config, actions, record }) {\r\n  const component_cfg = record.config_json || {};\r\n  const title = record.title || '';\r\n\r\n  const [htmlContent, setHtmlContent ] = useState(null);\r\n\r\n  useEffect(() => {    \r\n    if (component_cfg.url) {\r\n      const url = component_cfg.url;\r\n      fetch(url).then(res => {\r\n          return res.text();\r\n      }).then(result => {\r\n          setHtmlContent(result);\r\n      }).catch(error => {        \r\n          setHtmlContent(component_cfg.html || '');\r\n      })\r\n    } else {\r\n      setHtmlContent(component_cfg.html || '');\r\n    }    \r\n  }, []);  \r\n\r\n  return (\r\n    <div \r\n      title={title}\r\n      className={component_cfg.classname ? component_cfg.classname : null} \r\n      dangerouslySetInnerHTML={{ __html: htmlContent }} />\r\n  )\r\n}","import React from 'react';\r\n\r\nclass ThemeAttributes extends React.Component {\r\n  render() {\r\n    const { theme } = this.props;\r\n    return (\r\n      <div>\r\n        <div className=\"p-grid\">\r\n            <div className=\"p-col-4\">Título</div>\r\n            <div className=\"p-col-8\">{theme.title}</div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default ThemeAttributes;","import { Button } from 'primereact/button';\r\nimport { Dialog } from 'primereact/dialog';\r\nimport React, { useState } from 'react';\r\nimport ThemeAttributes from './ThemeAttributes';\r\n\r\nfunction hasAttributes(theme) {\r\n  return !['GROUP'].includes(theme.type);\r\n}\r\n\r\n/**\r\n * Actions\r\n */\r\nexport const actions = {\r\n  layer_has_attributes: hasAttributes\r\n}\r\n\r\n/**\r\n * Main component\r\n */\r\nexport default function Main(props) {\r\n\r\n  const { config } = props;\r\n  const { layer, dispatch, actions, models } = config;\r\n  const { getWindowSize, showOnPortal } = models.Utils;  \r\n  const [modalThemeAttributesOpen, setModalThemeAttributesOpen] = useState(false);\r\n\r\n  const wsize = getWindowSize();\r\n  const isMobile = wsize[0] <= 768;\r\n\r\n  const target = layer?.datatable?.target || props?.config?.target;\r\n\r\n  // Use layers.exclude_components prop to exclude component\r\n  if (layer && layer.exclude_components && layer.exclude_components.includes('LayerAttributesTable')) return null;\r\n\r\n  // If doesn't have datable reference info\r\n  if (!layer || !layer.datatable || !target) return null;\r\n\r\n  if (!hasAttributes(layer)) return null;\r\n  return (\r\n    <React.Fragment>\r\n\r\n      {' '}\r\n\r\n      <Button icon=\"pi pi-table\"\r\n        title=\"Tabela de atributos\"\r\n        color=\"blue\"\r\n        className=\"p-button-sm p-button-rounded p-button-text tool\"\r\n        onClick={e => {\r\n          dispatch(actions.searchlayers_set_layer(target, layer));\r\n          dispatch(actions.viewer_set_selectedmenu(target));\r\n          //setModalThemeAttributesOpen(layer)\r\n        }}\r\n      />\r\n\r\n      {showOnPortal(<Dialog \r\n        header=\"Tabela de Atributos\"\r\n        visible={!!modalThemeAttributesOpen}\r\n        style={{width: isMobile ? '90%' : '50vw' }} \r\n        modal \r\n        onHide={e => setModalThemeAttributesOpen(false)}>\r\n        <ThemeAttributes theme={modalThemeAttributesOpen} />\r\n      </Dialog>)}\r\n    </React.Fragment>\r\n  )\r\n}\r\n","import React, { useEffect, useState, useRef } from 'react'\r\nimport { Button } from 'primereact/button';\r\nimport { Toast } from 'primereact/toast'\r\nimport OlFormatGeoJSON from 'ol/format/GeoJSON';\r\n\r\n/*\r\n// TODO: implement theme download\r\nfunction downloadTheme(theme) {\r\n\r\n}\r\n\r\nexport const actions = {\r\n  downloadTheme\r\n}\r\n*/\r\n\r\nconst defaultExportFormats = [\r\n  { value: \"geojson\", title: \"GeoJSON\", icon: \"pi pi-file\", tooltip: \"Exportar para ficheiro GeoJSON\",\r\n    outputFormat: \"application/json\" },\r\n  { value: \"gml\", title: \"GML\", icon: \"pi pi-file\", tooltip: \"Exportar para ficheiro GML\",\r\n    outputFormat: \"text/xml; subtype=gml/2.1.2\" },\r\n  { value: \"shape\", title: \"ShapeFile\", icon: \"pi pi-file\", tooltip: \"Exportar para ficheiro ShapeFile\",\r\n    outputFormat: \"SHAPE-ZIP\" },\r\n  { value: \"kml\", title: \"KML\", icon: \"pi pi-file\", tooltip: \"Exportar para ficheiro KML\",\r\n    outputFormat: \"application/vnd.google-earth.kml+xml\" }\r\n];\r\n\r\nexport default function Main({ core, config, record }) {\r\n\r\n  const { viewer, layer, actions, mainMap, models } = config;\r\n  const { showOnPortal } = models.Utils;\r\n\r\n  const [isDownloading, setIsDownloading] = useState(false);\r\n  const [downloadFormat, setDownloadFormat] = useState(null);\r\n\r\n  const toast = useRef(null)\r\n\r\n  const component_cfg = record.config_json;\r\n\r\n  let exportFormats = [...defaultExportFormats];\r\n  if (layer && layer.exclude_export_formats && layer.exclude_export_formats.length) {\r\n    exportFormats = defaultExportFormats.filter(t => !layer.exclude_export_formats.includes(t.value));\r\n  } else if  (component_cfg && component_cfg.exclude_export_formats && component_cfg.exclude_export_formats.length) {\r\n    exportFormats = defaultExportFormats.filter(t => !component_cfg.exclude_export_formats.includes(t.value));\r\n  } else if (viewer && viewer.config_json && viewer.config_json.exclude_export_formats) {\r\n    exportFormats = defaultExportFormats.filter(t => !viewer.config_json.exclude_export_formats.includes(t.value));\r\n  }\r\n\r\n  let linkDownload = null;\r\n  if (layer && layer.download && layer.download.link) {\r\n    linkDownload = {...layer.download.link}\r\n  }\r\n\r\n  let externalDownload = null;\r\n  if (layer && layer.download && layer.download.external) {\r\n    externalDownload  = {...layer.download.external}\r\n  }\r\n\r\n  let datasourceDownload = null;\r\n  if (layer && layer.download && layer.datasource) {\r\n    datasourceDownload  = {...layer.download.datasource}\r\n  }\r\n\r\n  function getWFSFeatures(request) {\r\n    let params = [\r\n      \"SERVICE=WFS\",\r\n      \"REQUEST=GetFeature\",\r\n      \"VERSION=\" + (request.version || \"2.0.0\"), //1.1.0\r\n      \"typeNames=\" + request.typeNames,\r\n      \"srsName=\" + request.srsName,\r\n      \"outputFormat=\" + (request.outputFormat || \"application/json\")\r\n    ];\r\n\r\n    // Add count\r\n    if (request.count) params.push(\"count=\" + request.count);\r\n\r\n    // Add bbox\r\n    if (request.bbox) params.push(\"bbox=\" + request.bbox.join(\",\"));\r\n\r\n    // Add CQL_FILTER\r\n    if (request.cqlFilter) params.push(\"cql_filter=\" + request.cqlFilter)\r\n\r\n    // Add propertyName\r\n    if (request.propertyName) params.push(\"propertyName=\" + request.propertyName)\r\n    \r\n    // Build final URL\r\n    let url = request.url + params.join('&');\r\n\r\n    // Use map proxy\r\n    if (!models.Utils.isUrlAppOrigin(url)) {\r\n      url = core.MAP_PROXY_URL + encodeURIComponent(url);\r\n    };\r\n\r\n    // Set headers\r\n    let headers = {\r\n      \"accept\": \"application/json, text/javascript, */*; q=0.01\",\r\n      \"accept-language\": \"pt-PT,pt;q=0.9,en-US;q=0.8,en;q=0.7,es;q=0.6\",\r\n      \"cache-control\": \"no-cache\",\r\n      \"pragma\": \"no-cache\",\r\n      \"sec-fetch-dest\": \"empty\",\r\n      \"sec-fetch-mode\": \"cors\",\r\n      \"sec-fetch-site\": \"same-origin\",\r\n      \"x-requested-with\": \"XMLHttpRequest\"\r\n    };\r\n\r\n    // Set request options\r\n    const options = {\r\n      //\"headers\": headers,\r\n      //\"referrer\": \"\",\r\n      //\"referrerPolicy\": \"strict-origin-when-cross-origin\",\r\n      \"body\": null,\r\n      \"method\": \"GET\",\r\n      //\"mode\": \"cors\",\r\n      //\"credentials\": \"include\"\r\n    };\r\n\r\n    // return request\r\n    return fetch(url, options);\r\n  }\r\n\r\n  function download(filename, text, format) {\r\n    const element = document.createElement('a');\r\n    element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));\r\n    element.setAttribute('download', filename + '.' + format);\r\n    element.style.display = 'none';\r\n    document.body.appendChild(element);\r\n    element.click();\r\n    document.body.removeChild(element);\r\n  }\r\n\r\n  function downloadLink(filename, url) {\r\n    const element = document.createElement('a');\r\n    element.setAttribute('href', url);\r\n    element.setAttribute('target', '_blank');\r\n    element.setAttribute('download', url);\r\n    element.style.display = 'none';\r\n    document.body.appendChild(element);\r\n    element.click();\r\n    document.body.removeChild(element);\r\n  }\r\n\r\n  function downloadVectorTheme(theme, format) {\r\n    setDownloadFormat(format);\r\n\r\n    // Get map layer\r\n    const layer = models.Utils.findOlLayer(mainMap, theme.id);\r\n    \r\n    if (!layer) return null;\r\n    \r\n    const component_cfg = record ? record.config_json : null;\r\n\r\n    let features = [];\r\n\r\n    let crs = null;\r\n    if (component_cfg && component_cfg.export_crs) {\r\n      crs = component_cfg.export_crs;\r\n    } else if (viewer.config_json && viewer.config_json.export_crs) {\r\n      crs = viewer.config_json.export_crs;    \r\n    } else if (viewer.config_json && viewer.config_json.display_crs) {\r\n      crs = viewer.config_json.display_crs;\r\n    } else {\r\n      crs = 4326;\r\n    }\r\n\r\n    features = layer.getSource().getFeatures();\r\n\r\n    if (!features || !features.length) return null;\r\n\r\n    const parser = new OlFormatGeoJSON();\r\n    const parseOptions = {\r\n      dataProjection: 'EPSG:' + crs,\r\n      featureProjection: mainMap.getView().getProjection().getCode()\r\n    }\r\n\r\n    const geojson = parser.writeFeaturesObject(features, parseOptions);\r\n\r\n    // Hack: OL does not serialize with CRS attribute\r\n    //json.crs = { \"type\": \"name\", \"properties\": { \"name\": \"urn:ogc:def:crs:EPSG::4326\" } }\r\n    const crsinfo = {\r\n      \"type\": \"name\",\r\n      \"properties\": {\r\n          \"name\": \"urn:ogc:def:crs:EPSG::\" + crs\r\n      }\r\n    };\r\n    geojson.crs = crsinfo;    \r\n    const data = JSON.stringify(geojson);    \r\n\r\n    if (format == 'geojson') {\r\n      download('export', data, format);     \r\n    } else {\r\n      toast.current.show({\r\n          severity: 'warn', \r\n          summary: 'Descarregar Tema',\r\n          detail: 'Formato não suportado', life: 3000\r\n      });\r\n    }\r\n\r\n    setIsDownloading(false);\r\n  }\r\n\r\n  function downloadDatasource(theme, format) {\r\n\r\n    let crs = null;\r\n    if (component_cfg && component_cfg.export_crs) {\r\n      crs = component_cfg.export_crs;\r\n    } else if (viewer.config_json && viewer.config_json.export_crs) {\r\n      crs = viewer.config_json.export_crs;    \r\n    } else if (viewer.config_json && viewer.config_json.display_crs) {\r\n      crs = viewer.config_json.display_crs;\r\n    }\r\n    if (crs) {\r\n      crs = 'EPSG:' + crs;\r\n    }\r\n\r\n    let params = [\r\n      \"SERVICE=WFS\",\r\n      \"REQUEST=GetFeature\",\r\n      \"VERSION=\" + (datasourceDownload.version || \"2.0.0\"),\r\n      \"typeNames=\" + datasourceDownload.typeNames,\r\n      \"srsName=\" + (datasourceDownload.crs || crs || 'EPSG:4326'),\r\n      \"outputFormat=\" + (format || \"application/json\")\r\n    ];\r\n    // Add count\r\n    if (datasourceDownload.count) params.push(\"count=\" + datasourceDownload.count);\r\n    // Add bbox (TODO)\r\n    if (datasourceDownload.bbox) params.push(\"bbox=\" + datasourceDownload.bbox.join(\",\"));\r\n    // Add CQL_FILTER (TODO)\r\n    if (datasourceDownload.cqlFilter) params.push(\"cql_filter=\" + datasourceDownload.cqlFilter)\r\n    // Add propertyName\r\n    if (datasourceDownload.propertyName) params.push(\"propertyName=\" + datasourceDownload.propertyName)\r\n    \r\n    // Build final URL\r\n    let url = datasourceDownload.url + params.join('&');    \r\n\r\n    window.open(url, \"_blank\");\r\n  }\r\n\r\n  function downloadTheme(theme, format) {\r\n    if (['WFS', 'KML', 'GML', 'DXF', 'GeoJSON'].includes(theme.type)) {\r\n      downloadVectorTheme(theme, format);\r\n    } else {\r\n      alert(\"Formato não suportado\");\r\n    }\r\n  }\r\n\r\n  // Use layers.exclude_components prop to exclude component\r\n  if (layer && layer.exclude_components && layer.exclude_components.includes('LayerDownload')) return null;  \r\n\r\n  //Use available export formats/modes to exclude component\r\n  if ((!exportFormats || !exportFormats.length) && !linkDownload && !externalDownload && !datasourceDownload) return null;\r\n\r\n  let showDownloadBtn = ['WFS', 'KML', 'GML', 'GeoJSON'].includes(layer.type);\r\n  if (linkDownload || externalDownload || datasourceDownload ) showDownloadBtn = true;\r\n\r\n  return (\r\n    <div>\r\n      {showOnPortal(<Toast ref={toast} position=\"top-right\" />)}\r\n      { showDownloadBtn && (\r\n        <div className=\"p-grid\">\r\n            <div className=\"p-col-4\">Descarregar</div>\r\n            <div className=\"p-col-8\">\r\n              { linkDownload &&\r\n                <Button\r\n                  className=\"p-button-sm p-mr-2 p-mb-2\"\r\n                  icon={(isDownloading && downloadFormat=='link') ? \"pi pi-spin pi-spinner\" : \"pi pi-external-link pi\"} \r\n                  label={linkDownload.label || \"Abrir\"}\r\n                  onClick={e => downloadLink(linkDownload.filename, linkDownload.url)}\r\n                  disabled={isDownloading}\r\n                />\r\n              }\r\n              { externalDownload &&\r\n                <Button\r\n                  className=\"p-button-sm p-mr-2 p-mb-2\"\r\n                  icon={(isDownloading && downloadFormat=='external') ? \"pi pi-spin pi-spinner\" : \"pi pi-external-link pi\"} \r\n                  label={externalDownload.label || \"Abrir\"}\r\n                  onClick={e => window.open(externalDownload.url, \"_blank\")}\r\n                  disabled={isDownloading}\r\n                />\r\n              }\r\n              { datasourceDownload ?\r\n                exportFormats.map(opt =>\r\n                  <Button\r\n                      className=\"p-button-sm p-mr-2 p-mb-2\"\r\n                      icon={(isDownloading && downloadFormat==opt.value) ? \"pi pi-spin pi-spinner\" : \"pi pi-file pi\"} \r\n                      label={opt.title}\r\n                      onClick={e => downloadDatasource(layer, opt.outputFormat)}\r\n                      disabled={isDownloading}\r\n                  />) \r\n                : exportFormats.map(opt =>\r\n                <Button\r\n                    className=\"p-button-sm p-mr-2 p-mb-2\"\r\n                    icon={(isDownloading && downloadFormat==opt.value) ? \"pi pi-spin pi-spinner\" : \"pi pi-file pi\"} \r\n                    label={opt.title}\r\n                    onClick={e => downloadTheme(layer, opt.value)}\r\n                    disabled={isDownloading}\r\n                />\r\n              )}\r\n            </div>\r\n        </div>\r\n      ) }\r\n    </div>  \r\n  )\r\n}\r\n","import React from 'react';\r\nimport { InputTextarea } from 'primereact/inputtextarea';\r\nimport { ColorPicker } from 'primereact/colorpicker';\r\nimport { Button } from 'primereact/button';\r\nimport { InputText } from 'primereact/inputtext';\r\nimport { Dropdown } from 'primereact/dropdown';\r\nimport { InputSwitch } from 'primereact/inputswitch';\r\n//import './style.css';\r\n\r\nclass EditNode extends React.Component {\r\n\r\n  constructor(props) {\r\n    super(props);    \r\n    this.state = {\r\n      edit: props.edit,\r\n      showAdvanceOptions: false\r\n    };\r\n    //Default value of 'selectable' property is true\r\n    if (props.edit.selectable == null) {\r\n      this.editField('selectable', true );\r\n    }\r\n  }\r\n\r\n  editField(field, value) {\r\n    let { edit } = this.state;\r\n    edit[field] = value;\r\n    this.setState({ ...this.state, edit });\r\n  }\r\n\r\n  convertToRGBAString(str) {\r\n    const fill = str.split(',');\r\n    return `rgba(${ fill[0] }, ${ fill[1] }, ${ fill[2] }, ${ fill[3] })`;\r\n  }\r\n\r\n  convertToRGBA(str) {\r\n    const fill = str.split(',');\r\n    return { r: fill[0], g: fill[1], b: fill[2], a: fill[3] };\r\n  }\r\n\r\n  convertToRGB(str) {\r\n    const fill = str.split(',');\r\n    return { r: fill[0], g: fill[1], b: fill[2] };\r\n  }\r\n\r\n  convertToRGBString(rgb) {\r\n    return [rgb.r, rgb.g, rgb.b, 1].join(',');\r\n  }\r\n\r\n  render() {\r\n    const { edit, showAdvanceOptions } = this.state;\r\n    if (!edit) return null;\r\n\r\n    let wmsFormatOptions = [];\r\n    let wmsFeatureFormatOptions = [];\r\n    let wmsStyleOptions = [{ key: 999, value: '', label: 'Não Especificado'}];\r\n\r\n    let wmtsFormatOptions = [];\r\n    let wmtsFeatureFormatOptions = [];\r\n    let wmtsStyleOptions = [{ key: 999, value: '', label: 'Não Especificado'}]; \r\n\r\n    if (edit.type === 'WMS') {\r\n      let map_formats = edit.get_map_formats || '';\r\n      let finfo_formats = edit.get_feature_info_formats || '';\r\n      let wstyles = edit.wms_styles || '';\r\n      wmsFormatOptions = map_formats.split(',').map((i, j) => {\r\n        return { key: j, value: i, label: i};\r\n      });\r\n      wmsFeatureFormatOptions = finfo_formats.split(',').map((i, j) => {\r\n        return { key: j, value: i, label: i};\r\n      });\r\n      wstyles.split(',').forEach((i, j) => {\r\n        wmsStyleOptions.push({ key: j, value: i, label: i})\r\n        return i;\r\n      });\r\n    }\r\n\r\n    if (['WMTS', 'WMTSXYZ'].includes(edit.type)) {\r\n      let tile_formats = edit.wmts_formats || '';\r\n      let wmts_finfo_formats = edit.get_feature_info_formats || '';\r\n      let wstyles = edit.wmts_styles || '';\r\n      wmtsFormatOptions = tile_formats.split(',')\r\n      .filter(v => v && v.toLowerCase().indexOf('image/') !== -1)\r\n      .map((i, j) => {\r\n        return { key: j, value: i, label: i};\r\n      });\r\n      wmtsFeatureFormatOptions = wmts_finfo_formats.split(',').map((i, j) => {\r\n        return { key: j, value: i, label: i};\r\n      });        \r\n      wstyles.split(',').forEach((i, j) => {\r\n        wmtsStyleOptions.push({ key: j, value: i, label: i})\r\n        return i;\r\n      });      \r\n    }\r\n\r\n    return (\r\n      <div>\r\n        <div className=\"p-fluid\">\r\n\r\n          <div className=\"p-field p-grid\">\r\n            <label className=\"p-col-12 p-md-4\">Título</label>\r\n            <div className=\"p-col-12 p-md-8\">\r\n              <InputText\r\n                value={edit.title}\r\n                placeholder=\"Título\"\r\n                onChange={e => this.editField('title', e.target.value)}\r\n                onClick={e => e.target.select()}\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"p-field p-grid\">\r\n            <label className=\"p-col-12 p-md-4\">Descrição</label>\r\n            <div className=\"p-col-12 p-md-8\">\r\n              <InputTextarea \r\n                value={edit.description} \r\n                placeholder=\"Descrição\"\r\n                style={{width: '100%', padding: '.67857143em 1em', border: '1px solid rgba(34,36,38,.15)'}}\r\n                rows=\"5\"\r\n                onChange={e => this.editField('description', e.target.value)}\r\n                onClick={e => e.target.select()}\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          { ['GeoJSON', 'KML', 'WMS', 'WFS', 'ArcGISMap'].includes(edit.type) ? (\r\n            <div className=\"p-field p-grid\">\r\n              <label className=\"p-col-12 p-md-4\">Selecionar Elementos</label>\r\n              <div className=\"p-col-12 p-md-8\">\r\n                <InputSwitch\r\n                  checked={edit.selectable}\r\n                  onChange={(e) => this.editField('selectable', !edit.selectable)}\r\n                />\r\n              </div>\r\n            </div>\r\n          ) : null }\r\n\r\n        { (['WMTS', 'WMTSXYZ'].includes(edit.type) && edit.get_feature_info_formats) ? (\r\n            <div className=\"p-field p-grid\">\r\n              <label className=\"p-col-12 p-md-4\">Selecionar Elementos</label>\r\n              <div className=\"p-col-12 p-md-8\">\r\n                <InputSwitch\r\n                  checked={edit.selectable}\r\n                  onChange={(e) => this.editField('selectable', !edit.selectable)}\r\n                />\r\n              </div>\r\n            </div>\r\n          ) : null }          \r\n\r\n          { edit.type === 'WMS' ? (\r\n            <React.Fragment>\r\n              <div>\r\n                <p style={{textAlign: 'right'}}>\r\n                  <a style={{cursor: 'pointer'}}\r\n                    onClick={e => this.setState({...this.state, showAdvanceOptions: !showAdvanceOptions})}>\r\n                    Opções Avançadas{' '}\r\n                    <i className={showAdvanceOptions ? 'pi pi-angle-up' : 'pi pi-angle-down'}></i>\r\n                  </a>\r\n                </p>\r\n                { showAdvanceOptions && (\r\n                <div className=\"p-pb-2\">\r\n                  <div className=\"p-pt-2\">\r\n                    <label>Formato de GetMap</label>\r\n                    <Dropdown placeholder='Escolha o Formato de GetMap'\r\n                      options={wmsFormatOptions}\r\n                      value={edit.get_map_format || ''}\r\n                      onChange={({ value }) => this.editField('get_map_format', value)}\r\n                    />\r\n                  </div>\r\n                  <div className=\"p-pt-2\">\r\n                    <label>Formato de GetFeatureInfo</label>\r\n                    <Dropdown placeholder='Escolha o formato de GetFeatureInfo'\r\n                      options={wmsFeatureFormatOptions}\r\n                      value={edit.get_feature_info_format || ''}\r\n                      onChange={({ value }) => this.editField('get_feature_info_format', value)}\r\n                    />\r\n                  </div>\r\n                  <div className=\"p-pt-2\">\r\n                    <label>Estilo</label>\r\n                    <Dropdown placeholder='Escolha o estilo'\r\n                      options={wmsStyleOptions}\r\n                      value={edit.wms_style || ''}\r\n                      onChange={({ value }) => this.editField('wms_style', value)}\r\n                    />\r\n                  </div>\r\n                </div>\r\n                )}\r\n              </div>\r\n            </React.Fragment>\r\n          ) : null }\r\n\r\n          { ['WMTS', 'WMTSXYZ'].includes(edit.type) ? (\r\n            <React.Fragment>\r\n              <div>\r\n                <p style={{textAlign: 'right'}}>\r\n                  <a style={{cursor: 'pointer'}}\r\n                    onClick={e => this.setState({...this.state, showAdvanceOptions: !showAdvanceOptions})}>\r\n                    Opções Avançadas{' '}\r\n                    <i className={showAdvanceOptions ? 'pi pi-angle-up' : 'pi pi-angle-down'}></i>\r\n                  </a>\r\n                </p>\r\n                { showAdvanceOptions && (\r\n                <div className=\"p-pb-2\">\r\n                  <div className=\"p-pt-2\">\r\n                    <label>Formato de GetTile</label>\r\n                    <Dropdown placeholder='Escolha o Formato de GetTile'\r\n                      options={wmtsFormatOptions}\r\n                      value={edit.wmts_format || ''}\r\n                      onChange={({ value }) => this.editField('wmts_format', value)}\r\n                    />\r\n                  </div>\r\n                  <div className=\"p-pt-2\">\r\n                    <label>Formato de GetFeatureInfo</label>\r\n                    <Dropdown placeholder='Escolha o formato de GetFeatureInfo'\r\n                      options={wmtsFeatureFormatOptions}\r\n                      value={edit.get_feature_info_format || ''}\r\n                      onChange={({ value }) => this.editField('get_feature_info_format', value)}\r\n                    />\r\n                  </div>\r\n                  <div className=\"p-pt-2\">\r\n                    <label>Estilo</label>\r\n                    <Dropdown placeholder='Escolha o estilo'\r\n                      options={wmtsStyleOptions}\r\n                      value={edit.wmts_style || ''}\r\n                      onChange={({ value }) => this.editField('wmts_style', value)}\r\n                    />\r\n                  </div>\r\n                </div>\r\n                )}\r\n              </div>\r\n            </React.Fragment>\r\n          ) : null }          \r\n\r\n          { ['GeoJSON', 'WFS', 'KML'].includes(edit.type) ? (\r\n            <React.Fragment>\r\n              <div className=\"p-field p-grid\">\r\n                <label className=\"p-col-12 p-md-4\">Côr de Preenchimento</label>\r\n                <div className=\"p-col-12 p-md-4\">\r\n                  <ColorPicker\r\n                    format=\"rgb\"\r\n                    value={ edit.style_color ? this.convertToRGB(edit.style_color) : null }\r\n                    onChange={({value}) => this.editField('style_color', this.convertToRGBString(value)) }\r\n                  />\r\n                </div>\r\n                <div className=\"p-col-12 p-md-4\">\r\n                  <InputText\r\n                    placeholder='Côr de preenchimento'\r\n                    value={edit.style_color ? this.convertToRGBAString(edit.style_color) : null }\r\n                  />\r\n                </div>\r\n              </div>\r\n              <div className=\"p-field p-grid\">\r\n                <label className=\"p-col-12 p-md-4\">Côr de Rebordo</label>\r\n                <div className=\"p-col-12 p-md-4\">\r\n                  <ColorPicker\r\n                    format=\"rgb\"\r\n                    value={ edit.style_stroke_color ? this.convertToRGB(edit.style_stroke_color) : null }\r\n                    onChange={({value}) => this.editField('style_stroke_color', this.convertToRGBString(value)) }\r\n                  />\r\n                </div>\r\n                <div className=\"p-col-12 p-md-4\">\r\n                  <InputText\r\n                    placeholder='Côr de Rebordo'\r\n                    value={ edit.style_stroke_color ? this.convertToRGBAString(edit.style_stroke_color) : null }\r\n                  />\r\n                </div>\r\n              </div>\r\n              <div className=\"p-field p-grid\">\r\n                <label className=\"p-col-12 p-md-4\">Espessura do Rebordo</label>\r\n                <div className=\"p-col-12 p-md-8\">\r\n                  <InputText\r\n                    type=\"number\"\r\n                    min=\"0\"\r\n                    value={edit.style_stroke_width}\r\n                    placeholder=\"Espessura do Rebordo\"\r\n                    onChange={e => this.editField('style_stroke_width', e.target.value)}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </React.Fragment>\r\n            \r\n          ) : null }\r\n\r\n        </div>\r\n\r\n        <div className=\"p-dialog-myfooter\">\r\n          <Button \r\n            color='green'\r\n            icon=\"pi pi-check\"\r\n            label=\"Aplicar\" \r\n            onClick={e => this.props.onSave(e, edit)}\r\n          />\r\n        </div>\r\n\r\n      </div>\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default EditNode;\r\n","import { Button } from 'primereact/button';\r\nimport { Dialog } from 'primereact/dialog';\r\nimport React, { useState } from 'react';\r\nimport EditNode from './EditNode';\r\n\r\nexport default function Main({ config }) {\r\n\r\n  const { layer, actions, models } = config;\r\n  const { getWindowSize, showOnPortal } = models.Utils;\r\n  const [modalEditOpen, setModalEditOpen] = useState(false);\r\n\r\n  const wsize = getWindowSize();\r\n  const isMobile = wsize[0] <= 768;\r\n\r\n  // Use layers.exclude_components prop to exclude component\r\n  if (layer && layer.exclude_components && layer.exclude_components.includes('LayerEdit')) return null;   \r\n  \r\n  return (\r\n    <React.Fragment>\r\n\r\n      <Button icon=\"pi pi-pencil\"\r\n        title=\"Personalizar Tema\"\r\n        color=\"green\"\r\n        className=\"p-button-sm p-button-rounded p-button-text tool\"\r\n        onClick={e => setModalEditOpen(layer)}\r\n      />\r\n\r\n      {showOnPortal(<Dialog \r\n        header=\"Personalizar Tema\"\r\n        visible={!!modalEditOpen} \r\n        style={{width: isMobile ? '90%' : '50vw' }} \r\n        modal \r\n        onHide={e => setModalEditOpen(false)}>\r\n        <EditNode\r\n          edit={modalEditOpen}\r\n          onSave={(e, theme) => {\r\n            setModalEditOpen(false);\r\n            actions.applyThemeChanges(theme)\r\n          }}\r\n        />\r\n      </Dialog>)}\r\n    </React.Fragment>\r\n  )\r\n}\r\n","import React from 'react';\r\n\r\n\r\nconst formatMetadataValue = (element) => {\r\n    if (element.type === 'html') {\r\n        return <div dangerouslySetInnerHTML={{__html: element.value}} />\r\n    } else if (element.type === 'hyperlink') {\r\n        return (\r\n            <a href={element.url} target=\"_blank\" rel=\"noopener noreferrer\" style={{\"textDecoration\": \"none\"}}>\r\n                <i className=\"pi pi-external-link p-mr-2\"></i>{ element.value || element.url }\r\n            </a>\r\n        );\r\n    } else {\r\n        return element.value || '';\r\n    }\r\n};\r\n\r\nclass ThemeInfo extends React.Component {\r\n  \r\n  getTypeDescription(type) {\r\n      switch(type) {\r\n        case 'OSM': return 'Open Street Map';\r\n        case 'BING': return 'Bing Maps';\r\n        case 'WMS': return 'Web Map Service';\r\n        case 'WFS': return 'Web Feature Service';\r\n        case 'ArcGISMap': return 'ArcGIS REST - Map Service';\r\n        case 'KML': return 'Keyhole Markup Language';\r\n        case 'GeoJSON': return 'GeoJSON';\r\n        case 'GROUP': return 'Grupo';\r\n        default: return type;\r\n      }\r\n  }\r\n\r\n  render() {\r\n    const { viewer, mainMap, core, theme, actions, models } = this.props;\r\n    return (\r\n      <div>\r\n        <div className=\"p-grid\">\r\n            <div className=\"p-col-4\">Título</div>\r\n            <div className=\"p-col-8\">{theme.title}</div>\r\n        </div>\r\n        { theme.description ?\r\n        <div className=\"p-grid\">\r\n            <div className=\"p-col-4\">Descrição</div>\r\n            <div className=\"p-col-8\">{theme.description}</div>\r\n        </div> : null }\r\n        { (theme.metadata && theme.metadata.url) ?\r\n        <div className=\"p-grid\">\r\n            <div className=\"p-col-4\">Metadados</div>\r\n            <div className=\"p-col-8\"><a href={theme.metadata.url} target=\"_blank\" rel=\"noopener noreferrer\" style={{\"textDecoration\": \"none\"}}><i className=\"pi pi-external-link p-mr-2\"></i>Abrir Ficha</a></div>\r\n        </div> : null }\r\n        { (theme.metadata && theme.metadata.data) ?\r\n            theme.metadata.data.map(d => {\r\n                return (\r\n                    <div className=\"p-grid\">\r\n                        <div className=\"p-col-4\">{d.title || d.name}</div>\r\n                        <div className=\"p-col-8\">{formatMetadataValue(d)}</div>\r\n                    </div>\r\n                )\r\n            }) : null }        \r\n        { (theme.exclude_service_metadata !== true) ?\r\n        (<>               \r\n            <div className=\"p-grid\">\r\n                <div className=\"p-col-4\">Tipo</div>\r\n                <div className=\"p-col-8\">{this.getTypeDescription(theme.type)}</div>\r\n            </div>\r\n            { !['GROUP'].includes(theme.type) ? (\r\n            <div className=\"p-grid\">\r\n                <div className=\"p-col-4\">URL</div>\r\n                <div className=\"p-col-8\" style={{wordBreak: \"break-all\"}}>{theme.url}</div>\r\n            </div>\r\n            ) : null }\r\n            { !['GROUP', 'ArcGISMap'].includes(theme.type) ? (\r\n            <div className=\"p-grid\">\r\n                <div className=\"p-col-4\">Sistema de Coordenadas</div>\r\n                <div className=\"p-col-8\">\r\n                    { theme.crs_options ? (\r\n                        <ul>\r\n                        { theme.crs_options.split(',').map((t, j) => (\r\n                            <li key={j}>{t}</li>\r\n                        ))}\r\n                        </ul>\r\n                    ) : theme.crs ? (\r\n                        <ul><li>{`EPSG:${theme.crs}`}</li></ul>\r\n                    ) : null }\r\n                </div>\r\n            </div>\r\n            ) : null }\r\n            { ['WMS'].includes(theme.type) ? (\r\n            <div className=\"p-grid\">\r\n                <div className=\"p-col-4\">Formatos de GetMap</div>\r\n                <div className=\"p-col-8\">\r\n                    { theme.get_map_formats ? (\r\n                        <ul>\r\n                        { theme.get_map_formats.split(',').map((t, j) => (\r\n                            <li key={j}>{t}</li>\r\n                        ))}\r\n                        </ul>\r\n                    ) : null }\r\n                </div>\r\n            </div>\r\n            ) : null }\r\n            { ['WMS'].includes(theme.type) ? (\r\n            <div className=\"p-grid\">\r\n                <div className=\"p-col-4\">Formatos de GetFeatureInfo</div>\r\n                <div className=\"p-col-8\">\r\n                    { theme.get_feature_info_formats ? (\r\n                        <ul>\r\n                        { theme.get_feature_info_formats.split(',').map((t, j) => (\r\n                            <li key={j}>{t}</li>\r\n                        ))}\r\n                        </ul>\r\n                    ) : null }\r\n                </div>\r\n            </div>\r\n            ) : null }\r\n        </>\r\n        ) : null }\r\n\r\n        { core.renderComponents({\r\n          region: 'theme_info_tools',\r\n          props: { layer: theme, actions, viewer, mainMap, models },\r\n          separator: \" \"\r\n        })}\r\n\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default ThemeInfo;","import { Button } from 'primereact/button';\r\nimport { Dialog } from 'primereact/dialog';\r\nimport React, { useState } from 'react';\r\nimport ThemeInfo from './ThemeInfo';\r\n\r\nexport default function Main({ core, config }) {\r\n\r\n  const { layer, viewer, mainMap, actions, models } = config;\r\n  const { getWindowSize, showOnPortal } = models.Utils;  \r\n  const [modalThemeInfoOpen, setModalThemeInfoOpen] = useState(false);\r\n\r\n  const wsize = getWindowSize();\r\n  const isMobile = wsize[0] <= 768;\r\n\r\n  // Use layers.exclude_components prop to exclude component\r\n  if (layer && layer.exclude_components && layer.exclude_components.includes('LayerMetadata')) return null;  \r\n\r\n  return (\r\n    <React.Fragment>\r\n\r\n      <Button icon=\"pi pi-info-circle\"\r\n        title=\"Informação de Metadados\"\r\n        color=\"blue\"\r\n        className=\"p-button-sm p-button-rounded p-button-text tool\"\r\n        onClick={e => setModalThemeInfoOpen(layer)}\r\n      />\r\n\r\n      {showOnPortal(<Dialog \r\n        header=\"Informação do Tema\"\r\n        visible={!!modalThemeInfoOpen}\r\n        style={{width: isMobile ? '90%' : '50vw' }}  \r\n        modal \r\n        onHide={e => setModalThemeInfoOpen(false)}>\r\n        <ThemeInfo\r\n          viewer={viewer}\r\n          mainMap={mainMap}\r\n          core={core}\r\n          models={models}\r\n          theme={modalThemeInfoOpen}\r\n          downloadTheme={theme => actions.downloadTheme(theme)}\r\n        />\r\n      </Dialog>)}\r\n    </React.Fragment>\r\n  )\r\n}\r\n","import { Slider } from 'primereact/slider';\r\nimport React from 'react';\r\n\r\nexport default function Main({ config }) {\r\n\r\n  const { layer, actions, except } = config;\r\n\r\n  //// Use except prop to exclude from selected layers\r\n  //if (except && except.includes(layer.id)) return null;\r\n\r\n    // Use layers.exclude_components prop to exclude component\r\n    if (layer && layer.exclude_components && layer.exclude_components.includes('LayerOpacity')) return null; \r\n\r\n  // Render component\r\n  return (\r\n    <div title=\"Definir Transparência\" className=\"toc-slider-wrapper\">\r\n      <Slider discrete\r\n        color=\"red\"\r\n        min={1}\r\n        max={100}\r\n        value={layer.opacity * 100}\r\n        onChange={e => actions.opacity(e, layer, e.value )}\r\n      />\r\n    </div>  \r\n  )\r\n}\r\n","import { Button } from 'primereact/button';\r\nimport { Dialog } from 'primereact/dialog';\r\nimport React, { useState } from 'react';\r\n\r\nexport default function Main({ config }) {\r\n\r\n  const { layer, actions } = config;\r\n  const [confirmDeleteTheme, setConfirmDeleteTheme] = useState(false);\r\n\r\n  // Use layers.exclude_components prop to exclude component\r\n  if (layer && layer.exclude_components && layer.exclude_components.includes('LayerRemove')) return null;\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <Button icon=\"pi pi-times-circle\"\r\n        title=\"Remover Tema\"\r\n        color=\"red\"\r\n        className=\"p-button-sm p-button-rounded p-button-text tool\"\r\n        onClick={e => setConfirmDeleteTheme([layer.id])}\r\n      />\r\n\r\n      <Dialog\r\n        header=\"Confirmar\" \r\n        visible={!!confirmDeleteTheme} \r\n        modal \r\n        style={{ width: '350px' }} \r\n        footer={(\r\n          <div>\r\n              <Button \r\n                label=\"Não\" \r\n                icon=\"pi pi-times\" \r\n                onClick={() => setConfirmDeleteTheme(false)} \r\n                className=\"p-button-text\"\r\n              />\r\n              <Button \r\n                label=\"Sim\" \r\n                icon=\"pi pi-check\" \r\n                onClick={() => {\r\n                  actions.removeThemes(confirmDeleteTheme);\r\n                  setConfirmDeleteTheme(false);\r\n                }} \r\n                autoFocus \r\n              />\r\n          </div>\r\n        )} \r\n        onHide={() => setConfirmDeleteTheme(false)}>\r\n          <div className=\"confirmation-content\">\r\n              <i className=\"pi pi-exclamation-triangle p-mr-3\" style={{ fontSize: '2rem' }} />\r\n              <span>Tem a certeza?</span>\r\n          </div>\r\n      </Dialog>\r\n    </React.Fragment>\r\n    \r\n  )\r\n}\r\n","import React, { useEffect, useState } from 'react';\r\nimport { Button } from 'primereact/button';\r\nimport ZoomToExtent from 'ol/control/ZoomToExtent';\r\nimport DragBox from 'ol/interaction/DragBox';\r\nimport {\r\n  DragRotate,\r\n  defaults as defaultInteractions,\r\n} from 'ol/interaction';\r\nimport { FullScreen, defaults as defaultControls } from 'ol/control';\r\nimport './style.css';\r\n\r\nlet mapControls;\r\nlet mapInteractions;\r\nlet zoomToExtentControl;\r\nlet dragBoxInteraction;\r\n\r\nexport default function MapControls({ viewer, mainMap, core, dispatch, actions, record }) {\r\n\r\n  const { exclusive_mapcontrol } = viewer;\r\n  const coordinates_control = viewer.config_json.map_controls.find(c => c.id === 'Coordinates');\r\n  const coordinatesActive = coordinates_control ? coordinates_control.active : false;\r\n  const feature_info_control = viewer.config_json.map_controls.find(c => c.id === 'FeatureInfo');\r\n  const featureInfoActive = feature_info_control ? feature_info_control.active : false;\r\n  const geo_location_control = viewer.config_json.map_controls.find(c => c.id === 'GeoLocation');\r\n  const geoLocationActive = geo_location_control ? geo_location_control.active : false;\r\n  const geoLocationTracking = geo_location_control ? geo_location_control.tracking : false;\r\n  const geo_location_component = viewer.config_json.components.find(c => c.config_json &&\r\n    c.config_json.map_control === 'GeoLocation');\r\n  const { viewer_update_mapcontrol, viewer_set_selectedmenu, viewer_set_exclusive_mapcontrol } = actions;\r\n  const [dragBox, setDragBox] = useState(false);\r\n\r\n  const [geoLocationSettings, setGeoLocationSettings] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const elem_zoom = document.createElement('span');\r\n    elem_zoom.classList.add(\"pi\", \"pi-window-maximize\", \"p-c\");\r\n\r\n    const zoom_opts = {\r\n      label: elem_zoom,\r\n      tipLabel: \"Ver extensão total\"\r\n    }\r\n\r\n    if (viewer && viewer.config_json && viewer.config_json.full_extent) {\r\n      zoom_opts['extent'] = viewer.config_json.full_extent;\r\n      zoomToExtentControl = new ZoomToExtent(zoom_opts);\r\n    } else {\r\n      zoomToExtentControl = new ZoomToExtent(zoom_opts);\r\n    }\r\n\r\n    const options = { attribution: false };\r\n    if (viewer.config_json.exclude_map_controls && viewer.config_json.exclude_map_controls.length > 0) {\r\n      viewer.config_json.exclude_map_controls.forEach(o => {\r\n        options[o] = false;\r\n      });\r\n    }\r\n\r\n    //mapControls = defaultControls(options).extend([new FullScreen(), zoomToExtentControl]);\r\n    mapControls = defaultControls(options);\r\n    if (viewer.config_json.exclude_map_controls && viewer.config_json.exclude_map_controls.length > 0) {\r\n      if (!viewer.config_json.exclude_map_controls.includes('fullscreen')) {\r\n        mapControls = mapControls.extend([new FullScreen()]);\r\n      }\r\n      if (!viewer.config_json.exclude_map_controls.includes('zoomtoextent')) {\r\n        mapControls = mapControls.extend([zoomToExtentControl]);\r\n      }\r\n    } else {\r\n      mapControls = defaultControls(options).extend([new FullScreen(), zoomToExtentControl]);\r\n    }\r\n    mapControls.forEach(c => mainMap.addControl(c));\r\n\r\n    dragBoxInteraction = new DragBox();\r\n    //mapInteractions = defaultInteractions({altShiftDragRotate:false, pinchRotate: false});\r\n    mapInteractions = defaultInteractions({ altShiftDragRotate: false, pinchRotate: false });\r\n    if (viewer.config_json.exclude_map_controls && viewer.config_json.exclude_map_controls.length > 0) {\r\n      if (!viewer.config_json.exclude_map_controls.includes('rotate')) {\r\n        mapInteractions = mapInteractions.extend([\r\n          new DragRotate({\r\n            condition: (evt) => {\r\n              var browserEvent = evt.originalEvent;\r\n              return browserEvent.ctrlKey;\r\n            }\r\n          })\r\n        ]);\r\n      }\r\n    }\r\n    mapInteractions = mapInteractions.extend([\r\n      dragBoxInteraction\r\n    ]);\r\n    mapInteractions.forEach(i => mainMap.addInteraction(i));\r\n\r\n    function zoomToBox(e) {\r\n      const box = dragBoxInteraction.getGeometry();\r\n      mainMap.getView().fit(box);\r\n      setDragBox(false);\r\n    }\r\n\r\n    // Add event\r\n    dragBoxInteraction.on('boxend', zoomToBox);\r\n    return () => {\r\n      if (dragBoxInteraction) mainMap.removeInteraction(dragBoxInteraction);\r\n      if (zoomToExtentControl) mainMap.removeControl(zoomToExtentControl);\r\n    }\r\n  }, []);\r\n\r\n  // Toggle coordinates control\r\n  function toggleCoordinatesControl() {\r\n    const active = !coordinatesActive;\r\n    dispatch(viewer_update_mapcontrol({ ...coordinates_control, active }));\r\n    if (active) {\r\n      dispatch(viewer_set_selectedmenu('coordinates'));\r\n      dispatch(viewer_set_exclusive_mapcontrol('Coordinates'));\r\n    } else {\r\n      dispatch(viewer_set_exclusive_mapcontrol(null));\r\n    }\r\n  }\r\n\r\n  // Toggle feature info control\r\n  function toggleFeatureInfoControl() {\r\n    const active = !featureInfoActive;\r\n    dispatch(viewer_update_mapcontrol({ ...feature_info_control, active }));\r\n    if (active) {\r\n      dispatch(viewer_set_selectedmenu('featureinfo'));\r\n      dispatch(viewer_set_exclusive_mapcontrol('FeatureInfo'));\r\n    } else {\r\n      dispatch(viewer_set_exclusive_mapcontrol(null));\r\n    }\r\n  }\r\n\r\n  // Toggle geo location control\r\n  function toggleGeoLocationControl() {\r\n    const active = !geoLocationActive;\r\n    dispatch(viewer_update_mapcontrol({ ...geo_location_control, active }));\r\n    if (active && geo_location_component) dispatch(viewer_set_selectedmenu('geolocation'));\r\n  }\r\n\r\n  function toggleGeoLocationTracking(val) {\r\n    const tracking = val;\r\n    dispatch(viewer_update_mapcontrol({ ...geo_location_control, tracking }));\r\n  }\r\n\r\n  function getComponentMapButton(type) {\r\n    if (type === 'Coordinates') {\r\n      return (!!coordinates_control && !!coordinates_control.show_button) ?\r\n        <Button key={type}\r\n          title={coordinates_control.title || 'Obter coordenadas'}\r\n          icon=\"fas fa-bullseye\"\r\n          className={exclusive_mapcontrol === 'Coordinates' ? \"p-button-rounded p-button-raised active\" : \"p-button-rounded p-button-raised\"}\r\n          onClick={e => { e.currentTarget.blur(); toggleCoordinatesControl() }}\r\n        /> : null;\r\n    } else if (type === 'FeatureInfo') {\r\n      return (!!feature_info_control && !!feature_info_control.show_button) ?\r\n        <Button key={type}\r\n          title={feature_info_control.title || 'Identificar elementos'}\r\n          icon=\"pi pi-info-circle\"\r\n          className={exclusive_mapcontrol === 'FeatureInfo' ? \"p-button-rounded p-button-raised active\" : \"p-button-rounded p-button-raised\"}\r\n          onClick={e => { e.currentTarget.blur(); toggleFeatureInfoControl() }}\r\n        /> : null;\r\n    } else if (type === 'GeoLocation') {\r\n      return (!!geo_location_control && !!geo_location_control.show_button && !!window.navigator.geolocation) ?\r\n        <div className=\"map-controls-geolocation\" key={type}\r\n          onMouseOver={e => { setGeoLocationSettings(true); }}\r\n          onMouseLeave={e => { setGeoLocationSettings(false); }}>\r\n          <Button \r\n            title={geo_location_control.title || 'A minha localização'}\r\n            icon=\"pi pi-globe\"\r\n            className={geoLocationActive ? \"p-button-rounded p-button-raised active\" : \"p-button-rounded p-button-raised\"}\r\n            onClick={e => { e.currentTarget.blur(); toggleGeoLocationControl() }}\r\n          />\r\n          <div className=\"btn-geolocation-options\" style={!geoLocationActive || !geoLocationSettings ? { display: \"none\" } : {}}\r\n            onMouseLeave={e => { setGeoLocationSettings(false); }}\r\n          >\r\n            <input type=\"checkbox\" onClick={e => { toggleGeoLocationTracking(e.currentTarget.checked); }} checked={geoLocationTracking} />\r\n            <label> Atualizar posição</label>\r\n          </div>\r\n        </div> : null;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // Apply state\r\n  if (dragBoxInteraction) dragBoxInteraction.setActive(dragBox);\r\n  return (\r\n    <div id=\"map-controls\" className=\"map-controls\">\r\n\r\n      {viewer.config_json.map_controls.map(c => {\r\n        return getComponentMapButton(c.type);\r\n      })}\r\n\r\n      {core.renderComponents({\r\n        region: 'map_tools',\r\n        props: { core, actions, viewer, dispatch, mainMap: mainMap },\r\n        separator: \" \",\r\n        parent: record\r\n      })}\r\n\r\n    </div>\r\n  )\r\n}","import React from 'react'\r\nimport { Button } from 'primereact/button';\r\nimport { Panel } from 'primereact/panel';\r\nimport MapControls from './MapControls'\r\n\r\n/**\r\n * Main menu component\r\n */\r\nexport function MainMenu({ className, config, actions, record }) {\r\n  return (React.Fragment)\r\n  {/*\r\n  return (\r\n    <Button\r\n      title=\"Ferramentas do Mapa\"\r\n      className={className}\r\n      icon=\"pi pi-sliders-h\"\r\n      style={{ margin: '0.5em 1em' }}\r\n      onClick={e => config.dispatch(actions.viewer_set_selectedmenu(record.id))}\r\n    />\r\n  )\r\n  */}\r\n}\r\n\r\nexport default function Main({ core, as, config, record }) {\r\n\r\n  const { actions, mainMap, viewer, dispatch } = config;\r\n\r\n  function renderContent() {\r\n    return (\r\n      <div title=\"Ferramentas do Mapa\">\r\n        <MapControls\r\n          core={core}\r\n          viewer={viewer}\r\n          actions={actions}\r\n          dispatch={dispatch}\r\n          mainMap={mainMap}\r\n          record={record}\r\n        />\r\n      </div>  \r\n    )  \r\n  }\r\n\r\n  if (as === 'panel') return (\r\n    <Panel header=\"Ferramentas do Mapa\">\r\n      { renderContent() }\r\n    </Panel>\r\n  )\r\n\r\n  // Render component\r\n  return renderContent()\r\n}\r\n","import React, { useEffect, useRef, useState } from 'react';\r\nimport { InputMask } from 'primereact/inputmask';\r\nimport { InputText } from 'primereact/inputtext';\r\nimport './style.css'\r\n\r\nexport default function Main({ config, actions }) {\r\n  const { viewer, mainMap, dispatch, Models } = config;\r\n  const { MapModel } = Models;\r\n  const { getResolutionForScale, getScaleForResolution } = MapModel;\r\n\r\n  const [editing, setEditing] = useState(false);\r\n  const [scale, setScale] = useState('');\r\n\r\n  function onChangeScale (e) {\r\n    const input = e.target.value;\r\n    setScale(input);\r\n    setEditing(true);\r\n  }\r\n\r\n  function onSetScale(e) {\r\n    const key = e.which || e.keyCode;\r\n    if (key !== 13) return;\r\n\r\n    let value = '' + scale;\r\n    let current_scale = '' + scale;\r\n    if (current_scale.indexOf(':')) value = value.substr(current_scale.indexOf(':')+1);\r\n    if (!!/\\D/.test(value)) return;\r\n    value = parseInt(value, 10);\r\n    if (isNaN(value)) return;\r\n    const resolution = getResolutionForScale(value, 'm');\r\n    setEditing(false);\r\n    mainMap.getView().setResolution(resolution);\r\n  }\r\n\r\n  function onEndEditing() {\r\n    if (editing) setEditing(false);\r\n  }\r\n\r\n  useEffect(()=>{\r\n    if (!mainMap) return;\r\n    const resolution = mainMap.getView().getResolution();\r\n    const scale = getScaleForResolution(resolution, 'm');\r\n    setScale('1:' + scale);\r\n  }, [viewer]);\r\n\r\n  return (\r\n    <div className=\"mapscale-input\">\r\n      <InputText value={scale}\r\n        onChange={(e) => onChangeScale(e)}\r\n        onKeyUp={(e) => onSetScale(e)}\r\n        onBlur={(e) => onEndEditing(e)}>\r\n      </InputText>\r\n    </div>\r\n    );\r\n}","import React, { useEffect, useRef, useState } from 'react';\r\nimport OlScaleLine from 'ol/control/ScaleLine';\r\nimport './style.css'\r\n\r\nexport default function Main({ config, actions }) {\r\n  const { viewer, mainMap, dispatch, Models } = config;\r\n  const { MapModel } = Models;\r\n  const { getResolutionForScale, getScaleForResolution } = MapModel;\r\n\r\n  const [scaleLineControl, setScaleLineControl] = useState(null);\r\n\r\n  useEffect(()=>{\r\n    if (!mainMap) return;\r\n    const scaleLineControl = new OlScaleLine({\r\n      target: document.getElementById('mapscale-line')\r\n      //bar: true,\r\n      //text: true\r\n    });\r\n    mainMap.addControl(scaleLineControl);\r\n    setScaleLineControl(scaleLineControl)\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"mapscale-line\">\r\n        <div id=\"mapscale-line\" />\r\n    </div>\r\n    );\r\n}","export const MAPTOOLS_SET_SELECTEDCONTROL = 'MAPTOOLS_SET_SELECTEDCONTROL';\r\n\r\nexport function maptools_set_selectedcontrol(selected_control) {\r\n  const action = {\r\n    type: MAPTOOLS_SET_SELECTEDCONTROL,\r\n    selected_control\r\n  }\r\n  return action;\r\n}\r\n\r\nexport default {\r\n  MAPTOOLS_SET_SELECTEDCONTROL,\r\n  maptools_set_selectedcontrol\r\n}","import React from 'react';\r\nimport { InputText } from 'primereact/inputtext';\r\nimport { Button } from 'primereact/button';\r\nimport { Dialog } from 'primereact/dialog';\r\nimport { SelectButton } from 'primereact/selectbutton';\r\nimport { unByKey } from 'ol/Observable';\r\nimport Overlay from 'ol/Overlay';\r\nimport * as OlSphere from 'ol/sphere';\r\nimport LineString from 'ol/geom/LineString';\r\nimport Polygon from 'ol/geom/Polygon';\r\nimport OlDraw from 'ol/interaction/Draw';\r\nimport OlStyle from 'ol/style/Style';\r\nimport OlCircle from 'ol/style/Circle';\r\nimport OlFill from 'ol/style/Fill';\r\nimport OlStroke from 'ol/style/Stroke';\r\nimport { unit } from 'mathjs';\r\nimport './style.css';\r\n\r\n// TODO: create namespace in Store and pass actions through props\r\n\r\nclass Main extends React.Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      helpModal: false,\r\n      helpLengthShowed: false,\r\n      helpAreaShowed: false,\r\n      control: props.selected_control || '',\r\n      length: 0,\r\n      area: 0\r\n    };\r\n\r\n    // Drawing style\r\n    this.drawingsStyle = new OlStyle({\r\n      fill: new OlFill({\r\n        color: 'rgba(255, 255, 255, 0.2)'\r\n      }),\r\n      stroke: new OlStroke({\r\n        color: '#ffcc33',\r\n        width: 2\r\n      })\r\n    });\r\n\r\n    // Draw style\r\n    this.drawStyle = new OlStyle({\r\n      fill: new OlFill({\r\n        color: 'rgba(255, 255, 255, 0.2)'\r\n      }),\r\n      stroke: new OlStroke({\r\n        color: 'rgba(0, 0, 0, 0.5)',\r\n        lineDash: [10, 10],\r\n        width: 2\r\n      }),\r\n      image: new OlCircle({\r\n        radius: 5,\r\n        stroke: new OlStroke({\r\n          color: 'rgba(0, 0, 0, 0.7)'\r\n        }),\r\n        fill: new OlFill({\r\n          color: 'rgba(255, 255, 255, 0.2)'\r\n        })\r\n      })\r\n    });\r\n\r\n    /**\r\n     * Currently drawn feature.\r\n     * @type {module:ol/Feature~Feature}\r\n     */\r\n    this.sketch = null;\r\n\r\n    /**\r\n     * The help tooltip element.\r\n     * @type {Element}\r\n     */\r\n    this.helpTooltipElement = null;\r\n\r\n\r\n    /**\r\n     * Overlay to show the help messages.\r\n     * @type {module:ol/Overlay}\r\n     */\r\n    this.helpTooltip = null;\r\n\r\n\r\n    /**\r\n     * The measure tooltip element.\r\n     * @type {Element}\r\n     */\r\n    this.measureTooltipElement = null;\r\n\r\n\r\n    /**\r\n     * Overlay to show the measurement.\r\n     * @type {module:ol/Overlay}\r\n     */\r\n    this.measureTooltip = null;\r\n\r\n\r\n    /**\r\n     * Message to show when the user is drawing a polygon.\r\n     * @type {string}\r\n     */\r\n    const continuePolygonMsg = 'Clique para continuar a desenhar o polígono';\r\n\r\n\r\n    /**\r\n     * Message to show when the user is drawing a line.\r\n     * @type {string}\r\n     */\r\n    const continueLineMsg = 'Clique para continuar a desenhar a linha';\r\n\r\n\r\n    /**\r\n     * Handle pointer move.\r\n     * @param {module:ol/MapBrowserEvent~MapBrowserEvent} evt The event.\r\n     */\r\n    this.pointerMoveHandler = (evt) => {\r\n        if (evt.dragging) {\r\n            return;\r\n        }\r\n        /** @type {string} */\r\n        let helpMsg = 'Clique para começar a desenhar';\r\n\r\n        if (this.sketch) {\r\n            const geom = (this.sketch.getGeometry());\r\n            if (geom instanceof Polygon) {\r\n            helpMsg = continuePolygonMsg;\r\n            } else if (geom instanceof LineString) {\r\n            helpMsg = continueLineMsg;\r\n            }\r\n        }\r\n\r\n        this.helpTooltipElement.innerHTML = helpMsg;\r\n        this.helpTooltip.setPosition(evt.coordinate);\r\n\r\n        this.helpTooltipElement.classList.remove('hidden');\r\n    };\r\n\r\n    this.onMouseOutViewport = () => {\r\n      this.helpTooltipElement.classList.add('hidden');\r\n    }\r\n\r\n    /**\r\n     * Format length output.\r\n     * @param {module:ol/geom/LineString~LineString} line The line.\r\n     * @return {string} The formatted length.\r\n     */\r\n    this.formatLength = function(line) {\r\n      let length = OlSphere.getLength(line, {projection: this.props.mainMap.getView().getProjection().getCode()});\r\n      if (this.props.record.config_json && this.props.record.config_json.crs) {\r\n        if (this.props.viewer.config_json.crs_list) {\r\n          const prj = this.props.viewer.config_json.crs_list.find(x => x.srid === this.props.record.config_json.crs);\r\n          if (prj) {\r\n            const geom = line.clone().transform(this.props.mainMap.getView().getProjection().getCode(), prj.code);\r\n            length = geom.getLength();\r\n          }\r\n        }\r\n      }\r\n\r\n      let output = length;\r\n      if (this.props.record?.config_json?.length?.format) {\r\n        const format = this.props.record.config_json.length.format;\r\n\r\n        if (format.source_unit && format.output_unit) {\r\n          output = unit(length, format.source_unit).toNumeric(format.output_unit);\r\n        }\r\n        if (format.options) {\r\n          output = output.toLocaleString(format.locale || 'en-US', format.options);\r\n          if (format.options.useGrouping !== false) {\r\n            output = output.replace(/,/g,\" \");\r\n          }\r\n        }\r\n        if (format.expression) {\r\n          output = format.expression.replace('{value}', output);\r\n        }\r\n      } else {\r\n        if (length > 10000) {\r\n          output = (Math.round(length / 1000 * 1000) / 1000) + ' km';\r\n        } else {\r\n            output = (Math.round(length * 1000) / 1000) + ' m';\r\n        }\r\n      }\r\n\r\n      return output;\r\n    };\r\n\r\n    /**\r\n     * Format area output.\r\n     * @param {module:ol/geom/Polygon~Polygon} polygon The polygon.\r\n     * @return {string} Formatted area.\r\n     */\r\n    this.formatArea = function(polygon) {\r\n      let area = OlSphere.getArea(polygon, {projection: this.props.mainMap.getView().getProjection().getCode()});\r\n      if (this.props.record.config_json && this.props.record.config_json.crs) {\r\n        if (this.props.viewer.config_json.crs_list) {\r\n          const prj = this.props.viewer.config_json.crs_list.find(x => x.srid === this.props.record.config_json.crs);\r\n          if (prj) {\r\n            const geom = polygon.clone().transform(this.props.mainMap.getView().getProjection().getCode(), prj.code);\r\n            area = geom.getArea();\r\n          }\r\n        }\r\n      }      \r\n      \r\n      let output = area;\r\n      if (this.props.record?.config_json?.area?.format) {\r\n        const format = this.props.record.config_json.area.format;\r\n\r\n        if (format.source_unit && format.output_unit) {\r\n          output = unit(area, format.source_unit).toNumeric(format.output_unit);\r\n        }        \r\n        if (format.options) {\r\n          output = output.toLocaleString(format.locale || 'en-US', format.options);\r\n          if (format.options.useGrouping !== false) {\r\n            output = output.replace(/,/g,\" \");\r\n          }\r\n        }\r\n        if (format.expression) {\r\n          output = format.expression.replace('{value}', output);\r\n        }\r\n      } else if (area > 100000) {\r\n        output = (Math.round(area / 1000000 * 1000) / 1000) + ' km2';\r\n      } else {\r\n        output = (Math.round(area * 1000) / 1000) + ' m2';\r\n      }\r\n\r\n      return output;\r\n    };\r\n\r\n    /**\r\n     * Creates a new help tooltip\r\n     */\r\n    this.createHelpTooltip = () => {\r\n      if (this.helpTooltipElement) {\r\n        this.helpTooltipElement.parentNode.removeChild(this.helpTooltipElement);\r\n      }\r\n      this.helpTooltipElement = document.createElement('div');\r\n      this.helpTooltipElement.className = 'tooltip hidden';\r\n      this.helpTooltip = new Overlay({\r\n        element: this.helpTooltipElement,\r\n        offset: [15, 0],\r\n        positioning: 'center-left'\r\n      });\r\n      this.olMap.addOverlay(this.helpTooltip);\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    if (!this.props.mainMap) return;\r\n    \r\n    this.olMap = this.props.mainMap;\r\n    this.draw = null;\r\n\r\n    // Get user layer\r\n    const layers = this.olMap.getLayers();\r\n    //this.vector = layers.item(2).getLayers().item(0);\r\n    this.vector = this.props.utils.findOlLayer(this.olMap, 'userlayer');\r\n\r\n    // TODO: find user layer\r\n    if (this.vector) {\r\n      this.vector.setStyle(this.drawingsStyle);\r\n      this.source = this.vector.getSource();\r\n    }\r\n\r\n    if (this.state.control) this.addInteraction(this.state.control);\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n\r\n    if (prevProps.selected_control && !this.props.selected_control) {\r\n      //Clear previsous feature\r\n      if (this.source) {\r\n        const features = this.source.getFeatures();\r\n        features.forEach((ft) => {\r\n            if (ft.get('tool') === 'maptools') {\r\n              this.source.removeFeature(ft);\r\n            }\r\n        });\r\n      }\r\n\r\n      this.olMap.removeInteraction(this.draw);\r\n      this.olMap.un('pointermove', this.pointerMoveHandler);\r\n      this.olMap.getViewport().removeEventListener('mouseout', this.onMouseOutViewport);\r\n      if (this.helpTooltip) this.helpTooltip.setPosition(null);\r\n\r\n      this.setState({\r\n        ...this.state,\r\n        helpModal: false,\r\n        control: ''\r\n      });      \r\n    }\r\n\r\n    if (this.state.control && this.props.viewer.config_json.selected_menu !== 'maptools') {\r\n      /*\r\n      const { actions, dispatch } = this.props;\r\n      const { control, helpLengthShowed, helpAreaShowed } = this.state;\r\n      */\r\n\r\n      //Clear previsous feature\r\n      if (this.source) {\r\n        const features = this.source.getFeatures();\r\n        features.forEach((ft) => {\r\n            if (ft.get('tool') === 'maptools') {\r\n              this.source.removeFeature(ft);\r\n            }\r\n        });\r\n        //this.source.clear();\r\n      }      \r\n\r\n      this.olMap.removeInteraction(this.draw);\r\n      this.olMap.un('pointermove', this.pointerMoveHandler);\r\n      this.olMap.getViewport().removeEventListener('mouseout', this.onMouseOutViewport);\r\n      if (this.helpTooltip) this.helpTooltip.setPosition(null);\r\n      this.setState({\r\n        ...this.state,\r\n        helpModal: false,\r\n        control: ''\r\n      });\r\n    }\r\n  }  \r\n\r\n  addInteraction(value) {\r\n    const type = (value === 'area' ? 'Polygon' : 'LineString');\r\n    this.draw = new OlDraw({\r\n      source: this.source,\r\n      type: type,\r\n      style: this.drawStyle\r\n    });\r\n    this.olMap.addInteraction(this.draw);\r\n\r\n    this.createHelpTooltip();\r\n\r\n    let listener;\r\n    this.draw.on('drawstart', (ev) => {\r\n\r\n        //Clear previsous feature\r\n        if (this.source) {\r\n          const features = this.source.getFeatures();\r\n          features.forEach((ft) => {\r\n              if (ft.get('tool') == 'maptools') {\r\n                this.source.removeFeature(ft);\r\n              }\r\n          });\r\n          //this.source.clear();\r\n        }\r\n\r\n        // set sketch\r\n        this.sketch = ev.feature;\r\n\r\n        listener = this.sketch.getGeometry().on('change', (evt) => {\r\n          const geom = evt.target;\r\n          let output;\r\n          if (geom instanceof Polygon) {\r\n            output = this.formatArea(geom);\r\n            this.setState({...this.state, area: output});\r\n          } else if (geom instanceof LineString) {\r\n            output = this.formatLength(geom);\r\n            this.setState({...this.state, length: output});\r\n          }\r\n        });\r\n      }, this);\r\n\r\n    this.draw.on('drawend', (evt) => {\r\n      \r\n      evt.feature.set('tool', 'maptools');\r\n\r\n      // unset sketch\r\n      this.sketch = null;\r\n      unByKey(listener);\r\n    }, this);\r\n\r\n    this.olMap.on('pointermove', this.pointerMoveHandler);\r\n    this.olMap.getViewport().addEventListener('mouseout', this.onMouseOutViewport);\r\n  }\r\n\r\n  /**\r\n   * Let user change the drawing control\r\n   */\r\n  changeMeasureControl(value) {\r\n    const { actions, dispatch } = this.props;\r\n    const { control, helpLengthShowed, helpAreaShowed } = this.state;\r\n    this.olMap.removeInteraction(this.draw);\r\n    this.olMap.un('pointermove', this.pointerMoveHandler);\r\n    this.olMap.getViewport().removeEventListener('mouseout', this.onMouseOutViewport);\r\n    if (this.helpTooltip) this.helpTooltip.setPosition(null);\r\n\r\n    // Deactivate control\r\n    if ((control === value) || !value) {\r\n\r\n      //Clear previsous feature\r\n      if (this.source) {\r\n        const features = this.source.getFeatures();\r\n        features.forEach((ft) => {\r\n            if (ft.get('tool') == 'maptools') {\r\n              this.source.removeFeature(ft);\r\n            }\r\n        }); \r\n      }     \r\n\r\n      return this.setState({\r\n        ...this.state,\r\n        helpModal: false,\r\n        control: ''\r\n      }, () => {\r\n        if (this.props.viewer.exclusive_mapcontrol === 'MapTools') {\r\n          dispatch(actions.viewer_set_exclusive_mapcontrol(null));\r\n          this.props.onControlSelect(null);\r\n        }\r\n      });\r\n    }\r\n\r\n    // Activate control\r\n    this.addInteraction(value);\r\n    const showHelp = (value === 'length' && !helpLengthShowed)\r\n      || (value === 'area' && !helpAreaShowed)\r\n    this.setState({\r\n      ...this.state,\r\n      helpModal: showHelp,\r\n      control: value\r\n    }, () => {\r\n      dispatch(actions.viewer_set_exclusive_mapcontrol('MapTools'));\r\n      this.props.onControlSelect(value);\r\n    });\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    //Clear previsous feature\r\n    if (this.source) {\r\n      const features = this.source.getFeatures();\r\n      features.forEach((ft) => {\r\n          if (ft.get('tool') === 'maptools') {\r\n            this.source.removeFeature(ft);\r\n          }\r\n      });\r\n      //this.source.clear();\r\n    }    \r\n    this.sketch = null;\r\n    this.olMap.un('pointermove', this.pointerMoveHandler);\r\n    this.olMap.getViewport().removeEventListener('mouseout', this.onMouseOutViewport);\r\n    if (this.helpTooltipElement) {\r\n        this.helpTooltipElement.parentNode.removeChild(this.helpTooltipElement);\r\n    }\r\n    if (this.helpTooltip) {\r\n        this.olMap.removeOverlay(this.helpTooltip);\r\n    }\r\n    this.olMap.removeInteraction(this.draw);\r\n  }\r\n\r\n  closeHelp() {\r\n    const { control, helpLengthShowed, helpAreaShowed } = this.state;\r\n    this.setState({\r\n      ...this.state,\r\n      helpModal: false,\r\n      helpLengthShowed: control === 'length' ? true : helpLengthShowed,\r\n      helpAreaShowed: control === 'area' ? true : helpAreaShowed\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const { control, helpModal } = this.state;\r\n    const controlOptions = [\r\n      { key: 'length', label: \"Medir Distância\", icon: \"pi pi-minus\" },\r\n      { key: 'area', label: \"Medir Área\", icon: \"fas fa-draw-polygon\" },\r\n    ];\r\n\r\n    return (\r\n      <div style={{ height: '100%' }}>\r\n        <div id=\"map-tools\" className=\"plugin-main p-p-2\">\r\n          \r\n          <SelectButton \r\n            optionLabel=\"name\"\r\n            optionValue=\"key\"\r\n            value={control || ''}\r\n            options={controlOptions}\r\n            onChange={(e) => this.changeMeasureControl(e.value)}\r\n            itemTemplate={option => (\r\n              <React.Fragment>\r\n                <i className={option.icon}>&nbsp;</i>{' '}\r\n                { option.label }\r\n              </React.Fragment>\r\n            )}\r\n          />\r\n\r\n          <div className=\"p-my-2\">\r\n\r\n            { control === 'length' ? (\r\n              <InputText fluid\r\n                label='Comprimento'\r\n                value={this.state.length || ''}\r\n                placeholder=\"Comprimento\"\r\n              />\r\n            ) : null }\r\n\r\n            { control === 'area' ? (\r\n              <InputText fluid\r\n                label='Área'\r\n                value={this.state.area || ''}\r\n                placeholder=\"Área\"\r\n              />\r\n            ) : null }\r\n\r\n          </div>\r\n\r\n        </div>\r\n\r\n        <Dialog \r\n          header={control === 'length' ? 'Medir Distância' : 'Medir Área'}\r\n          visible={helpModal}\r\n          style={{width: '50vw'}} \r\n          modal\r\n          footer={(\r\n            <Button \r\n              className=\"p-button-info\"\r\n              icon=\"pi pi-check\"\r\n              label=\"OK\"\r\n              onClick={this.closeHelp.bind(this)}\r\n            />\r\n          )}\r\n          onHide={e => this.closeHelp()}>\r\n          <div>\r\n            { control === 'length' ? <div>\r\n              <p>1. para começar a medição clique no mapa na localização inicial<br />\r\n              2. para medir um trajeto clique nas localizações intermédias<br />\r\n              3. para terminar faça duplo-clique\r\n              </p>\r\n            </div> : null}\r\n            { control === 'area' ? <div>\r\n              <p>1. para começar a medição clique no mapa numa localização inicial<br />\r\n              2. continue clicando nas localizações que definem a área<br />\r\n              3. para terminar faça duplo-clique\r\n              </p>\r\n            </div> : null}\r\n          </div>\r\n        </Dialog>\r\n\r\n      </div>\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default Main;","import React, { useEffect, useState, useRef } from 'react'\r\nimport { Button } from 'primereact/button';\r\nimport { Panel } from 'primereact/panel';\r\nimport componentActions from './actions';\r\nimport MapTools from './MapTools'\r\n\r\n\r\nconst maptoolsReducer = (state = {}, action) => {\r\n  switch (action.type) {\r\n    case 'MAPTOOLS_SET_SELECTEDCONTROL':\r\n      return { \r\n        ...state, \r\n        selected_control: action.selected_control\r\n      }\r\n    default:\r\n      return state\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * Main menu component\r\n */\r\nexport function MainMenu({ className, config, actions, record }) {\r\n\r\n  const component_cfg = record.config_json || {};\r\n  const title = record.title || 'Ferramentas de Medição';\r\n\r\n  return (\r\n    <Button\r\n      title={title}\r\n      className={className}\r\n      icon=\"fas fa-ruler\"\r\n      style={{ margin: '0.5em 1em' }}\r\n      onClick={e => config.dispatch(actions.viewer_set_selectedmenu(record.id))}\r\n    />\r\n  )\r\n}\r\n\r\n//export default function Main({ type, region, as, config, actions, record, utils }) {\r\n  export default function Main(props) {\r\n\r\n  const { type, region, as, config, actions, record, utils, Models } = props;\r\n\r\n  const core = props.core;\r\n  const component_store_state = core.store.getState().maptools;\r\n\r\n  const { dispatch, viewer, mainMap } = config;\r\n  const { selected_menu, layers } = viewer.config_json;\r\n  const { getWindowSize } = Models ? Models.Utils : utils;    \r\n\r\n  const component_cfg = record.config_json || {};\r\n  const title = record.title || 'Ferramentas de Medição';\r\n  const header = component_cfg.header || title;\r\n\r\n  const wsize = getWindowSize();\r\n  const isMobile = wsize[0] <= 768;   \r\n\r\n  useEffect(() => {\r\n    Object.entries(componentActions).forEach(([key, action]) => {\r\n      if (!props.core.actions[key]) {\r\n        props.core.actions[key] = action;\r\n      }\r\n    });\r\n    if (!('maptools' in props.core.store.reducerManager.getReducerMap())) {\r\n      props.core.store.reducerManager.add('maptools', maptoolsReducer);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (selected_menu === 'maptools') {\r\n      dispatch(actions.viewer_set_exclusive_mapcontrol('MapTools'));\r\n    } else {\r\n      dispatch(actions.maptools_set_selectedcontrol(null));\r\n    }\r\n  }, [selected_menu]);\r\n\r\n  function renderContent() {\r\n    return (\r\n      <div className=\"maptools\">\r\n        <MapTools\r\n          onControlSelect={(control)=> {\r\n            dispatch(actions.maptools_set_selectedcontrol(control));\r\n          }}\r\n          viewer={viewer}\r\n          core={core}\r\n          actions={actions}\r\n          dispatch={dispatch}\r\n          mainMap={mainMap}\r\n          utils={utils}\r\n          record={record}\r\n          selected_control={component_store_state?.selected_control}\r\n        />\r\n      </div>  \r\n    )  \r\n  }\r\n\r\n  if (type === 'link' && region === record.links) {\r\n\r\n    const classname = (viewer?.exclusive_mapcontrol === 'MapTools' && \r\n      component_store_state?.selected_control) ? 'active' : '';\r\n\r\n    return <Button\r\n      title={title}\r\n      icon=\"fas fa-ruler\"\r\n      className={ classname ? \"p-button-rounded p-button-raised \" + classname : \"p-button-rounded p-button-raised\" }\r\n      onClick={e => {\r\n        /*\r\n        if (selected_menu === 'maptools') {\r\n          dispatch(actions.maptools_set_selectedcontrol(null));\r\n          dispatch(actions.layout_show_menu(!isMobile));\r\n        } else {\r\n          dispatch(actions.viewer_set_selectedmenu(record.id));\r\n          dispatch(actions.layout_show_menu(!isMobile));\r\n        }*/\r\n        dispatch(actions.viewer_set_selectedmenu(record.id));\r\n        dispatch(actions.layout_show_menu(!isMobile));\r\n      }}\r\n    />\r\n  }  \r\n\r\n  if (as === 'panel') return (\r\n    <Panel header={header}>\r\n      { renderContent() }\r\n    </Panel>\r\n  )\r\n\r\n  //// Render component\r\n  //return renderContent()\r\n\r\n  return null;\r\n}\r\n","import React, { useEffect, useState } from 'react';\r\nimport './style.css'\r\n\r\n\r\nexport default function PanelHtmlContent({ config }) {\r\n\r\n  const [dialogContent, setDialogContent ] = useState(null);\r\n\r\n  useEffect(() => {    \r\n    if (config.url) {\r\n      const url = config.url;\r\n      fetch(url).then(res => {\r\n          return res.text();\r\n      }).then(result => {\r\n          //console.log(result);\r\n          setDialogContent(result);\r\n      }).catch(error => {        \r\n          //console.log('error', error);\r\n          setDialogContent(config.html || '');\r\n      })\r\n    } else {\r\n      setDialogContent(config.html || '');\r\n    }    \r\n  }, []);\r\n\r\n  return (\r\n    <div dangerouslySetInnerHTML={{ __html: dialogContent }}></div>\r\n  )\r\n\r\n}","import React, { useState } from 'react';\r\nimport { Button } from 'primereact/button'\r\nimport { Panel } from 'primereact/panel'\r\nimport { Dialog } from 'primereact/dialog'\r\nimport PanelHtmlContent from './PanelHmtlContent'\r\nimport './style.css'\r\n\r\n/**\r\n * Main menu component\r\n */\r\nexport function MainMenu({ className, config, actions, record }) {\r\n\r\n  const { viewer, dispatch, Models } = config;\r\n  const { getWindowSize, showOnPortal } = Models.Utils;\r\n\r\n  const [showPopup, setShowPopup] = useState(false);\r\n\r\n  const component_cfg = record.config_json || {};\r\n  const title = record.title || '';\r\n  const header = component_cfg.header || title;\r\n\r\n  const wsize = getWindowSize();\r\n  const isMobile = wsize[0] <= 768;\r\n\r\n  if (record.as === 'popup') {    \r\n    const closeLabel = component_cfg.closeLabel || \"Fechar\";    \r\n    return (\r\n      <React.Fragment>\r\n\r\n        <Button\r\n          title={title}\r\n          className={className}\r\n          icon=\"far fa-question-circle\"\r\n          style={{ margin: '0.5em 1em' }}\r\n          onClick={e => setShowPopup(true)}\r\n        />\r\n\r\n        {showOnPortal(<Dialog\r\n          header={header}\r\n          visible={showPopup}\r\n          style={{width: isMobile ? '90%' : '35vw' }} \r\n          modal\r\n          footer={(\r\n            <div className=\"p-grid\">\r\n              <div className=\"p-col\" style={{ textAlign: 'right'}}>\r\n                <Button label={closeLabel} onClick={e => setShowPopup(false)} />\r\n              </div>\r\n            </div>\r\n          )}          \r\n          onHide={e => setShowPopup(false)}>\r\n\r\n          <PanelHtmlContent\r\n            config={component_cfg}\r\n          />\r\n\r\n        </Dialog>)}\r\n\r\n      </React.Fragment>\r\n    )\r\n  }  else {\r\n    return (\r\n      <Button\r\n        title={title}\r\n        className={className}\r\n        icon=\"far fa-question-circle\"\r\n        style={{ margin: '0.5em 1em' }}\r\n        onClick={e => config.dispatch(actions.viewer_set_selectedmenu(record.id))}\r\n      />\r\n    )\r\n  }\r\n}\r\n\r\nexport default function Main({ as, config, actions, record }) {\r\n\r\n  const { viewer, dispatch, Models } = config;\r\n  const { getWindowSize, showOnPortal } = Models.Utils;\r\n\r\n  const component_cfg = record.config_json || {};\r\n  const title = record.title || '';\r\n  const header = component_cfg.header || title;\r\n\r\n  const wsize = getWindowSize();\r\n  const isMobile = wsize[0] <= 768; \r\n\r\n  // Render content\r\n  function renderContent() {\r\n    return (\r\n      <PanelHtmlContent\r\n        config={component_cfg}\r\n      />\r\n    )\r\n  }\r\n\r\n  if (as === '') return (\r\n    renderContent()\r\n  )\r\n\r\n  if (as === 'panel') return (\r\n    <Panel header={header}>\r\n      { renderContent() }\r\n    </Panel>\r\n  )\r\n\r\n  return null\r\n}","import { useEffect } from \"react\";\r\n\r\nconst useOutsideClick = (ref, callback) => {\r\n  const handleClick = e => {\r\n    if (ref.current && !ref.current.contains(e.target)) {\r\n      callback();\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    document.addEventListener(\"click\", handleClick);\r\n\r\n    return () => {\r\n      document.removeEventListener(\"click\", handleClick);\r\n    };\r\n  });\r\n};\r\n\r\nexport default useOutsideClick;","import React, { useEffect, useState, useRef } from 'react';\r\nimport { InputText } from 'primereact/inputtext';\r\nimport { ListBox } from 'primereact/listbox';\r\nimport { transform } from 'ol/proj';\r\nimport './style.css'\r\nimport { config } from 'react-transition-group';\r\nimport useOutsideClick from './useOutsideClick';\r\n\r\n\r\nexport default function Main({ core, config, actions, record }) {\r\n  const { viewer, mainMap, dispatch, Models } = config;\r\n  const { MapModel } = Models;\r\n\r\n  const [filter, setFilter] = useState(\"\");\r\n  const [activeSources, setActiveSources] = useState([]);\r\n  const [places, setPlaces] = useState([]);\r\n  const [selectedPlace, setSelectedPlace] = useState(null);\r\n\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  const ref = useRef();\r\n\r\n  const component_cfg = record.config_json || {};\r\n\r\n  useOutsideClick(ref, () => {\r\n    setPlaces([]);\r\n  });  \r\n\r\n  function changeFilterFunc(e) {\r\n    setFilter(e.target.value)\r\n    if (e.target.value.length < 3) {\r\n        setPlaces([]);\r\n        return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n\r\n    // Fetch filter\r\n    let url = core.API_URL + '/geographical_names/search?_min_similarity=0.5&_maxrows=10&_filter={filter}';\r\n    if (config.url) {\r\n      url = config.url;\r\n    }\r\n    if (config.max_rows) {\r\n      url = url.replace('{max_rows}', config.max_rows);\r\n    }\r\n    if (config.min_similarity) {\r\n      url = url.replace('{min_similarity}', config.min_similarity);\r\n    }     \r\n    url = url.replace('{filter}', e.target.value);\r\n    fetch(url).then(res => {      \r\n        // TODO: Validate response\r\n        return res.json();\r\n    }).then(result => {\r\n        if (activeSources?.length) {\r\n          setPlaces(result.filter((item)=>{ return activeSources.includes(item.origem); }));\r\n        } else {\r\n          setPlaces(result);\r\n        }\r\n        setIsLoading(false);\r\n    }).catch(error => {\r\n        //console.log('error', error);\r\n        setIsLoading(false);\r\n    })\r\n  }\r\n\r\n  function selectPlace(e) {\r\n    let item = e.value;\r\n    if (item && item.geom_wkt) {\r\n      let geom = MapModel.getGeometryFromWKT(item.geom_wkt);\r\n      geom.transform('EPSG:4326', mainMap.getView().getProjection());\r\n\r\n      let buffer = config.buffer || 1000;\r\n      if (config?.sources?.length) {\r\n        config.sources.forEach((src) => {\r\n          if(item.origem == src.id && src.buffer != null) {\r\n              buffer = src.buffer;\r\n          }\r\n        });\r\n      }\r\n\r\n      const geom_ext = geom.getExtent();\r\n      const extent = [geom_ext[0] - buffer, geom_ext[1] - buffer, geom_ext[0] + buffer, geom_ext[1] + buffer];\r\n\r\n      dispatch(actions.map_set_extent([extent[2] - extent[0], extent[3] - extent[1]], extent));\r\n\r\n      setFilter(item.designacao);\r\n    }\r\n  }\r\n\r\n  // Legacy code. To be removed\r\n  function buildLegacyDefaultItem(option, iconClass) {\r\n    let elem = null;\r\n  \r\n    if (iconClass) {\r\n      elem = <div><i className={`pi ${iconClass || ''} p-mr-2`}></i> <span>{option.designacao} ({option.concelho})</span></div>;\r\n      if (option.designacao === option.concelho) {\r\n        elem = <div>{option.concelho}</div>\r\n      }\r\n    } else {\r\n      elem = <div>{option.designacao} ({option.concelho})</div>;\r\n      if (option.designacao === option.concelho) {\r\n        elem = <div>{option.concelho}</div>\r\n      }\r\n    }\r\n\r\n    return elem;\r\n  }\r\n\r\n  function buildDefaultItem(option, iconClass) {\r\n    let elem = null;\r\n\r\n    const admin_level = option.admin_level4 || option.admin_level3 || option.admin_level2 || option.admin_level1 || '';\r\n  \r\n    if (iconClass) {      \r\n      elem = <div><i className={`pi ${iconClass || ''} p-mr-2`}></i> <span>{option.name} {admin_level ? `(${admin_level})` : ''}</span></div>;\r\n      if (option.name === admin_level) {\r\n        elem = <div>{admin_level}</div>\r\n      }\r\n    } else {\r\n      elem = <div>{option.name} {admin_level ? `(${admin_level})` : ''}</div>;\r\n      if (option.name=== option.admin_level) {\r\n        elem = <div>{admin_level}</div>\r\n      }\r\n    }\r\n\r\n    return elem;\r\n  }\r\n\r\n  function itemTemplate(option) {\r\n    const types = component_cfg?.types;\r\n    let elem = null;\r\n\r\n    if (types) {\r\n      elem = buildDefaultItem(option, types?.defaultTemplate?.iconClass);\r\n    } else {\r\n      elem = buildLegacyDefaultItem(option, null);\r\n    }\r\n\r\n    if (types?.defaultTemplate) {\r\n      if (types?.defaultTemplate?.html) {\r\n        let html = types?.defaultTemplate?.html;\r\n        const rf = (html && html.match) ? html.match(/[^{}]+(?=})/g) : null;\r\n        if (rf) {\r\n          rf.forEach(fld => {\r\n            html = html.replace(`{${fld}}`, option[fld] || '');      \r\n          });\r\n        }\r\n        elem = <div dangerouslySetInnerHTML={{__html: html}} />;\r\n      }\r\n    }\r\n\r\n    if (types?.field && option[types?.field] && types?.templates?.length) {\r\n      const tpl = types.templates.find( item => item.id === option[types.field]);\r\n      if (tpl) {\r\n        if (tpl?.html) {\r\n          let html = tpl.html;\r\n          const rf = (html && html.match) ? html.match(/[^{}]+(?=})/g) : null;\r\n          if (rf) {\r\n            rf.forEach(fld => {\r\n              html = html.replace(`{${fld}}`, option[fld] || '');      \r\n            });\r\n          }\r\n          elem = <div dangerouslySetInnerHTML={{__html: html}} />;\r\n        } else if (tpl.iconClass) {\r\n          elem = buildDefaultItem(option, tpl.iconClass);\r\n        }       \r\n      }\r\n    }    \r\n\r\n    return elem;\r\n  }\r\n\r\n  useEffect(() => {\r\n    let sources_ids = [];\r\n    if (config.sources && config.sources.length > 0) {      \r\n      config.sources.forEach(src => {\r\n        if (src.active) {\r\n          sources_ids.push(src.id);\r\n        }\r\n      });\r\n    }\r\n    setActiveSources([...sources_ids]);\r\n  }, []);   \r\n\r\n  return (\r\n    <div ref={ref} style={{ textAlign: \"right\" }}>\r\n      <span className=\"layout-topbar-search\">\r\n          <InputText type=\"text\"\r\n            placeholder={config.placeholder || 'Pesquisar...'}\r\n            value={filter}\r\n            onChange={(e) => changeFilterFunc(e)} />\r\n          <span className={ isLoading ? 'layout-topbar-search-icon pi pi-spin pi-spinner' : 'layout-topbar-search-icon pi pi-search' }/>\r\n      </span>\r\n      {(places && places.length > 0 ?\r\n        <div style={{marginTop: \"5px\", position: \"absolute\", zIndex: \"10\"}}>\r\n          <ListBox\r\n              optionLabel=\"Lugar\"\r\n              value={selectedPlace}\r\n              options={places}\r\n              itemTemplate={itemTemplate}\r\n              onChange={(e) => selectPlace(e)}              \r\n          />\r\n        </div> : null\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n","import React, { Fragment, useState, useEffect } from 'react'\r\nimport { Dialog } from 'primereact/dialog'\r\nimport Cookies from 'universal-cookie'\r\nimport { InputSwitch } from 'primereact/inputswitch'\r\nimport { Button } from 'primereact/button'\r\nimport './index.css'\r\n\r\nconst cookiePopupName = process.env.REACT_APP_COOKIE_POPUP_NAME || 'scalargis_popup';\r\nconst cookiePath = process.env.REACT_APP_COOKIE_PATH || '';\r\n\r\nexport default function Main({ config, as, core, actions, utils, record }) {\r\n\r\n  const { mainMap, auth } = config;\r\n  const { showOnPortal } = utils;\r\n\r\n  const [showPopup, setShowPopup] = useState(false);\r\n  const [permanent, setPermanent] = useState(false);\r\n\r\n  const wsize = utils.getWindowSize();\r\n  const isMobile = wsize[0] <= 768;\r\n\r\n  function getInitialState() {\r\n\r\n    let state = true;\r\n    const cookies = new Cookies();\r\n    const cookieData = cookies.get(config.cookieName || cookiePopupName);\r\n    if (typeof cookieData !== 'undefined') {\r\n      let data = JSON.parse(cookieData);\r\n      state = data === 0 ? false : true;\r\n    }\r\n    \r\n    //Always show if hideOption is not true\r\n    if (config.hideOption !== false) {\r\n      state = true;\r\n    }\r\n\r\n    //Do not show if user is authenticated and hideAuthentication option is true\r\n    if (auth?.data?.authenticated && record.config_json.hideAuthenticated) {\r\n      state = false;\r\n    }\r\n\r\n    return state;\r\n  }\r\n\r\n  function hidePopup() {\r\n    setShowPopup(false);\r\n    let data = JSON.stringify(0);\r\n    const cookies = new Cookies();\r\n    let maxAge = 1;\r\n    if (permanent) maxAge = config.maxAge || (maxAge * 365 * 24 * 60 * 60);\r\n    cookies.set(config.cookieName || cookiePopupName, data, { path: cookiePath, maxAge });\r\n\r\n    if (core?.pubsub && record?.config_json?.actions?.hide) {\r\n      core.pubsub.publish(record?.config_json?.actions?.hide, null);\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    let state = getInitialState();\r\n    setShowPopup(state);\r\n\r\n    if (!state) {\r\n      setTimeout(() => {\r\n        if (core?.pubsub && record?.config_json?.actions?.hide) {\r\n          core.pubsub.publish(record?.config_json?.actions?.hide, null);\r\n        }\r\n      }, 500);\r\n    }\r\n  }, []);\r\n  \r\n  // Render content\r\n  const closeLabel = config.closeLabel || \"Fechar\";\r\n  return (\r\n    <Fragment>\r\n      {showOnPortal(<Dialog\r\n        header={config.header}\r\n        visible={showPopup}\r\n        style={{width: isMobile ? '90%' : '35vw' }}\r\n        modal\r\n        footer={(\r\n          <div className=\"p-grid\">\r\n            {(!config.hideOption &&\r\n            <div className=\"p-col-12 p-md-6\" style={{ textAlign: 'left'}}>\r\n              <InputSwitch\r\n                inputId=\"permanentSwitch\"\r\n                checked={permanent}\r\n                onChange={(e) => setPermanent(!permanent)}\r\n              />\r\n              {' '}\r\n              <label htmlFor=\"permanentSwitch\">\r\n                <span>Não mostrar novamente</span>\r\n              </label>\r\n            </div>)}\r\n            <div className=\"p-col\" style={{ textAlign: 'right'}}>\r\n              <Button label={closeLabel} onClick={e => hidePopup() } />\r\n            </div>\r\n          </div>\r\n        )}\r\n        onHide={e => hidePopup()}>\r\n          <div dangerouslySetInnerHTML={{ __html: config.html }}></div>\r\n      </Dialog>)}\r\n    </Fragment>\r\n  )\r\n}\r\n","import React, { useState, useEffect } from 'react'\r\nimport { Message } from 'primereact/message';\r\nimport './style.css'\r\n\r\nexport default function PrintPanelNoPrints(props) {\r\n\r\n  const { viewer, mainMap, dispatch, Models } = props.config;\r\n  const control = props.control;\r\n  const actions = props.actions;\r\n\r\n  return (\r\n    <div className=\"print-panel1\">  \r\n      <Message\r\n        severity=\"warn\"\r\n        text={\"Este visualizador não tem plantas configuradas.\"} \r\n      />\r\n    </div>\r\n  )\r\n\r\n}","import React, { useState, useEffect } from 'react'\r\nimport { Button } from 'primereact/button'\r\nimport { Message } from 'primereact/message';\r\nimport './style.css'\r\n\r\nexport default function PrintPanel1(props) {\r\n\r\n  const { viewer, mainMap, dispatch, Models } = props.config;\r\n  const control = props.control;\r\n  const actions = props.actions;\r\n\r\n  function goPanelPrintGroup(group) {\r\n    props.setPrintGroup(group);\r\n    props.changeActivePanel(\"p2\");\r\n  }\r\n\r\n  function goPanelPrintItem(item) {\r\n    props.setPrintItem(item);\r\n    props.changeActivePanel(\"p2-item\");\r\n  }  \r\n\r\n  return (\r\n    <div className=\"print-panel1\">  \r\n      <Message\r\n        severity=\"info\"\r\n        text={\"Escolha o tipo de planta que pretende emitir.\"} \r\n      />\r\n\r\n      { (viewer.printing && viewer.printing.groups) && viewer.printing.groups.map( (group, index) => {\r\n        return (\r\n          <div key={index}>\r\n            <Button label=\"\" \r\n              icon=\"pi pi-chevron-right\" \r\n              className=\"p-button-rounded p-button-text\"\r\n              onClick={e => { goPanelPrintGroup(group) }} />\r\n            <h4>{group.title}</h4>\r\n            <p>{group.description}</p>\r\n          </div>\r\n        )\r\n      })}\r\n      { (viewer.printing && viewer.printing.prints) && viewer.printing.prints.map( (print, index) => {\r\n        return (\r\n          <div key={index}>\r\n            <Button label=\"\" icon=\"pi pi-chevron-right\" \r\n              className=\"p-button-rounded p-button-text\"\r\n              onClick={e => { goPanelPrintItem(print) }} />\r\n            <h4>{print.title}</h4>\r\n            <p>{print.description}</p>\r\n          </div>\r\n        )\r\n      })}\r\n\r\n    </div>\r\n  )\r\n\r\n}","import React, { useState, useEffect, useRef } from 'react'\r\nimport Cookies from 'universal-cookie'\r\nimport { Button } from 'primereact/button'\r\nimport { Toolbar } from 'primereact/toolbar';\r\nimport {InputText} from 'primereact/inputtext';\r\nimport { Message } from 'primereact/message';\r\nimport { confirmDialog } from 'primereact/confirmdialog';\r\nimport { Toast } from 'primereact/toast';\r\nimport OlInteractionDraw from \"ol/interaction/Draw\";\r\nimport OlInteractionModify from \"ol/interaction/Modify\";\r\nimport OlInteractionSelect from \"ol/interaction/Select\";\r\nimport { shiftKeyOnly, singleClick } from \"ol/events/condition\";\r\nimport { v4 as uuidV4 } from 'uuid'\r\nimport './style.css'\r\n\r\nexport default function PrintPanel2(props) {\r\n\r\n  const { core, control, printGroup, printLayer, setPrintDetails, fields, setGeometries, handleFieldChange, standalone, config, actions } = props;\r\n  const { viewer, mainMap, dispatch, Models } = config;\r\n  const { showOnPortal } = Models.Utils;\r\n  const { exclusive_mapcontrol } = viewer;\r\n\r\n  const API_URL = core.API_URL;\r\n\r\n  const [drawTool, setDrawTool] = useState(null);\r\n  const [draw , setDraw] = useState(null);\r\n  const select = useRef(null);  \r\n  const [modify, setModify] = useState(null);\r\n\r\n  const [selectedFeatures, setSelectedFeatures] = useState([]);\r\n\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [showErrors, setShowErrors] = useState(false);\r\n\r\n  const toastDialog = useRef(null);\r\n\r\n  const drawTools = [\r\n    { value: \"Point\", title: \"Adicionar ponto\", icon: \"fas fa-circle\" },\r\n    { value: \"LineString\", title: \"Adicionar linha\", icon: \"pi pi-minus\" },\r\n    { value: \"Polygon\", title: \"Adicionar polígono\", icon: \"fas fa-draw-polygon\" },\r\n    { value: \"Select\", title: \"Selecionar elemento\", icon: \"fas fa-mouse-pointer\" },\r\n    { value: \"Modify\", title: \"Editar elemento\", icon: \"pi pi-pencil\" }     \r\n  ];\r\n\r\n  function selectDrawTool(e, tool) {\r\n    e.preventDefault();\r\n    e.target.blur();\r\n\r\n    if (drawTool != tool) setDrawTool(tool);\r\n    else setDrawTool(null);\r\n  }\r\n\r\n  function addInteraction(type) {\r\n    if (draw) mainMap.removeInteraction(draw);\r\n    if (select.current) select.current.setActive(false);\r\n    if (modify) modify.setActive(false);    \r\n\r\n    if (['Point', 'LineString', 'Polygon'].includes(type)) {\r\n      const source = printLayer.current.getSource();\r\n      const di = new OlInteractionDraw({\r\n        source: source,\r\n        type: type,\r\n      });\r\n      mainMap.addInteraction(di);\r\n      di.on('drawend', (e) => {\r\n        if (!printGroup.multi_geom) {\r\n          if (select.current) select.current.getFeatures().clear();          \r\n          printLayer.current.getSource().getFeatures().forEach((f) => {\r\n            if (f != e.feature) printLayer.current.getSource().removeFeature(f);\r\n          });\r\n        }\r\n      });\r\n      setDraw(di);\r\n    } else if (type === 'Select') {\r\n      select.current.setActive(true);      \r\n    } else if (type === 'Modify') {\r\n      modify.setActive(true);      \r\n    }\r\n  }\r\n\r\n  const confirmDeleteAll = (features) => {\r\n    confirmDialog({\r\n        message: ' Deseja eliminar todos os elementos?',\r\n        header: 'Confirmação',\r\n        icon: 'pi pi-exclamation-triangle',\r\n        acceptLabel: 'Sim',\r\n        rejectLabel: 'Não',\r\n        accept: () => {\r\n          features.forEach((f) => {\r\n            printLayer.current.getSource().removeFeature(f);\r\n          });\r\n          mainMap.render();\r\n        },\r\n        reject: () =>  { }      \r\n    });\r\n  }  \r\n\r\n  function deletedSelectedFeature() {\r\n    const feats = printLayer.current.getSource().getFeatures();\r\n\r\n    if (select.current && select.current.getFeatures().getLength() > 0) {\r\n      select.current.getFeatures().forEach((f) => {\r\n        printLayer.current.getSource().removeFeature(f);\r\n      });\r\n      select.current.getFeatures().clear();\r\n    } else if (feats && feats.length > 1) {\r\n      confirmDeleteAll(feats);\r\n    } else if (feats && feats.length == 1) {\r\n      feats.forEach((f) => {\r\n        printLayer.current.getSource().removeFeature(f);\r\n      });      \r\n    }\r\n\r\n    mainMap.render();\r\n  }\r\n\r\n  function zoomFeaturesExtent() {\r\n    if (printLayer && printLayer.current && printLayer.current.getSource().getFeatures().length > 0) {\r\n      let extent = printLayer.current.getSource().getExtent();\r\n      if (!extent) return;\r\n      let center = [extent[0] + (extent[2] - extent[0])/2, extent[1] + (extent[3] - extent[1])/2];\r\n\r\n      if ((extent[2] - extent[0]) < 500 || (extent[3] - extent[1]) < 500) {\r\n        extent = [center[0] - 250, center[1] - 250, center[0] + 250, center[1] + 250];\r\n      }\r\n\r\n      dispatch(actions.map_set_extent(center, extent));\r\n    }    \r\n  }\r\n\r\n  function goPanelPrintPrev() {\r\n    props.setPrintGroup(null);\r\n    if (draw) mainMap.removeInteraction(draw);\r\n    props.changeActivePanel('p1');\r\n  }\r\n\r\n  function goPanelPrintNext() {\r\n\r\n    let isFormInvalid = false;\r\n\r\n    const formData = {};\r\n    if (printGroup.form_fields && printGroup.form_fields.groups) {\r\n      Object.entries(printGroup.form_fields.groups).forEach(([groupKey, group]) => {\r\n        Object.entries(group.fields).forEach(([fieldKey, field]) => {\r\n          const field_key = groupKey + '.' + fieldKey;\r\n          const val = fields[field_key];            \r\n          if (val) {\r\n            const fieldName = field.name || fieldKey;\r\n            formData[fieldName] = val;\r\n          } else {\r\n            if (field.required) isFormInvalid = true;\r\n          }\r\n        });\r\n      });\r\n    }\r\n    if (printGroup.form_fields && printGroup.form_fields.fields) {\r\n      Object.entries(printGroup.form_fields.fields).forEach(([fieldKey, field]) => {\r\n        const field_key = fieldKey;\r\n        const val = fields[field_key];            \r\n        if (val) {\r\n          const fieldName = field.name || fieldKey;\r\n          formData[fieldName] = val;\r\n        } else {\r\n          if (field.required) isFormInvalid = true;\r\n        }\r\n      });\r\n    }\r\n\r\n    if (printGroup.location_marking && !isFormInvalid) {\r\n      const ft = printLayer.current.getSource().getFeatures();\r\n      if (ft.length == 0) isFormInvalid = true;\r\n    }\r\n\r\n    //Abort if form is not valid\r\n    if (isFormInvalid) return;\r\n\r\n    setDrawTool(null);    \r\n    setIsLoading(true);\r\n\r\n    const geoms = [];\r\n    printLayer.current.getSource().getFeatures().forEach((f) => {\r\n      geoms.push(f.getGeometry().clone());      \r\n    });\r\n    setGeometries(geoms);\r\n\r\n    let record = {\r\n      geom_filter: geoms.map(g => {return Models.MapModel.getWKTFromGeometry(g);}),\r\n      geom_srid: Models.MapModel.getProjectionSrid(mainMap.getView().getProjection().getCode())\r\n    }\r\n\r\n    // Save request\r\n    let options = {\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'Content-Type': 'application/json'        \r\n      },\r\n      method: 'POST',\r\n      body: JSON.stringify(record)\r\n    }\r\n\r\n    // Get logged user\r\n    const cookies = new Cookies();\r\n    const logged = cookies.get(core.COOKIE_AUTH_NAME);\r\n    if (logged) options.headers['X-API-KEY'] = logged.token;\r\n\r\n    // Auth url. TODO: check for proxy\r\n    let url = printGroup.resource_url;\r\n    fetch(url, options)\r\n      .then(res => res.json())\r\n      .then(res => {\r\n        setIsLoading(false);               \r\n\r\n        function setExtraPropsRecursive(obj, printsIds)\r\n        {\r\n            obj.prints.forEach(p => {\r\n              p['uuid'] = String(uuidV4());\r\n              p['selected'] = true;\r\n\r\n              printsIds.push(p['uuid']);\r\n            })\r\n            obj.children.forEach(c => {\r\n              setExtraPropsRecursive(c, printsIds);\r\n            })\r\n        }\r\n\r\n        const data = {...res};\r\n        data['userFormData'] = {...formData};\r\n\r\n        const printsIds = [];\r\n\r\n        setExtraPropsRecursive(data, printsIds);\r\n        data['selected'] = printsIds;        \r\n\r\n        setPrintDetails(data);\r\n        props.changeActivePanel(\"p3\");\r\n      }).catch(error => {\r\n        setIsLoading(false); \r\n        /*\r\n        toastEl.show({\r\n          severity: 'error',\r\n          summary: 'Ocorreu um erro inesperado',\r\n          detail: \"Não foi possível obter a informação das plantas.\",\r\n          sticky: false\r\n        });\r\n        */\r\n      });   \r\n  }\r\n\r\n  useEffect(() => {\r\n    setShowErrors(false);\r\n  }, [fields]);\r\n\r\n  useEffect(() => {\r\n    if (drawTool) {\r\n      dispatch(actions.viewer_set_exclusive_mapcontrol('Print'));\r\n      addInteraction(drawTool);\r\n    } else {\r\n      if (draw) {\r\n        mainMap.removeInteraction(draw);\r\n        setDraw(null);\r\n      }\r\n      if (select.current) select.current.setActive(false);      \r\n      if (modify) modify.setActive(false);\r\n    }    \r\n  }, [drawTool]);\r\n\r\n  useEffect(() => {\r\n    if (drawTool && exclusive_mapcontrol != 'Print') {\r\n      setDrawTool(null);\r\n    }\r\n  }, [exclusive_mapcontrol]);\r\n\r\n  useEffect(() => {\r\n    const slct = new OlInteractionSelect({\r\n      condition: singleClick,\r\n      hitTolerance: 5,\r\n      wrapX: false,\r\n      filter: (feature, layer) => {\r\n        if (layer.get('id') !== 'print') return false;\r\n        return true;\r\n      }\r\n    });\r\n    slct.on('select', function (e) {\r\n      mainMap.render();\r\n    });    \r\n    mainMap.addInteraction(slct);\r\n    slct.setActive(false);\r\n    select.current = slct;    \r\n\r\n    const mdf = new OlInteractionModify({\r\n      source: printLayer.current.getSource()\r\n    });\r\n    mainMap.addInteraction(mdf);\r\n    mdf.setActive(false);\r\n    setModify(mdf); \r\n\r\n    return () => {\r\n      if (slct) mainMap.removeInteraction(slct);      \r\n      if (mdf) mainMap.removeInteraction(mdf);\r\n    }   \r\n  }, [mainMap]);\r\n\r\n\r\n  const toolbarLeftContents = (\r\n    <React.Fragment>\r\n      { drawTools.map(opt =>\r\n        <Button\r\n          key={opt.value}\r\n          icon={opt.icon}\r\n          label={ opt.label ? opt.label : ''}\r\n          tooltip={opt.title}\r\n          className={\"p-button-sm p-mr-2 tool\" + (opt.value === drawTool ? \" active\" : \"\") }\r\n          onClick={(e) => selectDrawTool(e, opt.value) }\r\n        />\r\n      )}     \r\n    </React.Fragment>\r\n  );\r\n\r\n  const toolbarRightContents = (\r\n    <React.Fragment>\r\n        <Button \r\n          icon=\"pi pi-trash\"\r\n          tooltip=\"Eliminar elemento selecionado\"\r\n          className=\"p-button-sm p-mr-2 tool\"\r\n          onClick={(e) => deletedSelectedFeature() }\r\n        />\r\n        <Button \r\n          icon=\"fas fa-search-plus\"\r\n          tooltip=\"Ver todos os elementos\"\r\n          className=\"p-button-sm p-mr-2 tool\"\r\n          onClick={(e) => zoomFeaturesExtent() }\r\n        />        \r\n    </React.Fragment>\r\n  );  \r\n\r\n  return (\r\n    <div className=\"print-panel2\">\r\n      {showOnPortal(<Toast ref={toastDialog} />)}\r\n\r\n      <h3>{props.printGroup.title}</h3>\r\n\r\n      {(printGroup.allow_drawing !== false) && <div className=\"p-fluid\">\r\n        <h4>Marcação do Local</h4>\r\n        <div>\r\n          <Toolbar left={toolbarLeftContents} right={toolbarRightContents} />\r\n        </div>\r\n        { printGroup.location_marking && \r\n          <Message severity=\"info\" text=\"Deverá marcar no mapa a localização pretendida\" />\r\n        }\r\n      </div>}\r\n\r\n      { (printGroup.form_fields && printGroup.form_fields.groups) &&\r\n        <React.Fragment>\r\n          { Object.entries(printGroup.form_fields.groups).map(([groupKey, group]) => {\r\n            if (group.active) {\r\n              return <div key={groupKey} className=\"p-fluid\">\r\n                <h4>{group.title}</h4>\r\n                { group.fields && Object.entries(group.fields).map(([fieldKey, field]) => {\r\n                  const field_key = groupKey + '.' + fieldKey;\r\n                  if (field.active) {                    \r\n                    return <div className=\"p-field\">\r\n                      { field.header && <h4>{field.header}</h4> }\r\n                      { field.label && <label>{field.label}</label> }\r\n                      <InputText key={field_key} id={field_key} className=\"p-inputtext-sm p-d-block\" \r\n                        placeholder={field.title} tooltip={field.title}\r\n                        value={fields[field_key]} onChange={handleFieldChange} />\r\n                        { (field.required && !fields[field_key]) && <small id={field_key + \"-help\"} className=\"p-error\">Campo de preenchimento obrigatório.</small> }\r\n                    </div>\r\n                  }\r\n                }) }\r\n              </div>\r\n            }\r\n          }) }\r\n        </React.Fragment>\r\n      }\r\n\r\n      { (printGroup.form_fields && printGroup.form_fields.fields) &&\r\n        <React.Fragment>\r\n          { Object.entries(printGroup.form_fields.fields).map(([fieldKey, field]) => {\r\n            const field_key = fieldKey;\r\n            if (field.active) {\r\n              return <React.Fragment>\r\n                <div key={field_key} className=\"p-fluid\">\r\n                  { field.header && <h4>{field.header}</h4> }\r\n                  <div className=\"p-field\">\r\n                    { field.label && <label>{field.label}</label> }\r\n                    <InputText id={field_key} className=\"p-inputtext-sm p-d-block\" \r\n                      placeholder={field.title} tooltip={field.title}\r\n                      value={fields[field_key]} onChange={handleFieldChange} />\r\n                      { (field.required && !fields[field_key]) && <small id={field_key + \"-help\"} className=\"p-error\">Campo de preenchimento obrigatório.</small> }\r\n                  </div>\r\n                </div>\r\n                </React.Fragment>\r\n              }\r\n          }) }\r\n        </React.Fragment>\r\n      }\r\n\r\n      <div className=\"card\">\r\n        <div className=\"p-grid\">\r\n          <div className=\"p-col p-text-left\">\r\n            {!standalone &&\r\n            <Button\r\n                label=\"Voltar\"\r\n                icon=\"pi pi-chevron-left\"\r\n                className=\"p-button-sm\"\r\n                onClick={e => { goPanelPrintPrev(); }}\r\n            />\r\n            }\r\n          </div>\r\n          <div className=\"p-col p-text-right\">\r\n            <Button\r\n                label=\"Continuar\"\r\n                icon={isLoading ? \"pi pi-spin pi-spinner\": \"\"}\r\n                className=\"p-button-sm\"\r\n                onClick={e => { goPanelPrintNext(); }}\r\n                disabled={isLoading} \r\n            />\r\n          </div>\r\n        </div>  \r\n      </div>      \r\n    </div>\r\n  )\r\n\r\n}","import React, { useState, useEffect } from 'react'\r\nimport { Button } from 'primereact/button'\r\nimport { Checkbox } from 'primereact/checkbox';\r\nimport { Dropdown } from 'primereact/dropdown';\r\nimport { Toolbar } from 'primereact/toolbar';\r\nimport {InputText} from 'primereact/inputtext';\r\nimport { Message } from 'primereact/message';\r\nimport useFormFields from \"./useFormFields\";\r\nimport './style.css'\r\nimport { useLayoutEffect } from 'react';\r\n\r\nexport default function PrintGroupItem(props) {\r\n\r\n  const { control, printLayer, printGroup, printDetails, groupItem, config, actions } = props;\r\n  const { selectedPrints, setSelectedPrints } = props;\r\n  const { viewer, mainMap, dispatch, Models } = config;\r\n\r\n  const onSelectedPrintChange = (e) => {    \r\n    let prints = [...selectedPrints];\r\n\r\n    if (e.checked)\r\n        prints.push(e.value);\r\n    else\r\n        prints.splice(prints.indexOf(e.value), 1);\r\n\r\n    setSelectedPrints(prints);\r\n  }\r\n\r\n  return (\r\n    <ul>\r\n      <li>\r\n        <span><b>{groupItem.title}</b></span>\r\n        { (groupItem.children && groupItem.children.length > 0)  &&\r\n          <React.Fragment>\r\n            { groupItem.children.map( item => {\r\n              return (\r\n                <PrintGroupItem\r\n                  config={config}\r\n                  actions={actions}\r\n                  printGroup={printGroup}\r\n                  printDetails={printDetails}\r\n                  groupItem={item}\r\n                  selectedPrints={selectedPrints}\r\n                  setSelectedPrints={setSelectedPrints}                  \r\n                />\r\n              )\r\n            }) }\r\n          </React.Fragment>\r\n        }\r\n        { (groupItem.prints && groupItem.prints.length > 0)  && \r\n          <ul>\r\n            { groupItem.prints.map( print => {\r\n                return (\r\n                  <li>\r\n                    { printDetails.allow_selection &&\r\n                    <Checkbox value={print.uuid} \r\n                      onChange={onSelectedPrintChange} checked={selectedPrints.includes(print.uuid)} />\r\n                    }\r\n                    <span className=\"task-name p-ml-1\">{print.title}</span>\r\n                  </li>\r\n                )            \r\n            }) }\r\n          </ul> \r\n        }\r\n      </li>    \r\n    </ul>\r\n  )\r\n}","import React, { useState, useEffect } from 'react'\r\nimport { Button } from 'primereact/button'\r\nimport { Checkbox } from 'primereact/checkbox';\r\nimport { Dropdown } from 'primereact/dropdown';\r\nimport { Toolbar } from 'primereact/toolbar';\r\nimport {InputText} from 'primereact/inputtext';\r\nimport { Message } from 'primereact/message';\r\nimport useFormFields from \"./useFormFields\";\r\nimport PrintGroupItem from \"./PrintGroupItem\";\r\nimport './style.css'\r\n\r\nexport default function PrintPanel3(props) {\r\n\r\n  const { control, printGroup, printLayer, printDetails, setFinalPrints, fields, handleFieldChange, config, actions } = props;\r\n  const { viewer, mainMap, dispatch, Models } = config;\r\n  const { exclusive_mapcontrol } = viewer;\r\n  \r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [formats, setFormats] = useState(null);\r\n\r\n  const [selectedPrints, setSelectedPrints] = useState([...printDetails.selected]);\r\n\r\n  function goPanelPrintPrev() {\r\n    props.changeActivePanel('p2');\r\n  }\r\n\r\n  function goPanelPrintNext() {\r\n    const finalPrints = [];\r\n\r\n    function getSelectedPrintsRecursive(group)\r\n    {\r\n      group.prints.forEach(p => {\r\n        if (selectedPrints.includes(p.uuid)) {\r\n          const print = {...p,\r\n                        groupId: group.id,\r\n                        groupTitle: group.title,\r\n                        processed: false, \r\n                        error: false\r\n                        }\r\n\r\n          finalPrints.push(print);\r\n        }\r\n      })\r\n      group.children.forEach(c => {          \r\n        getSelectedPrintsRecursive(c);\r\n      })\r\n    }    \r\n\r\n    getSelectedPrintsRecursive(printDetails);\r\n\r\n    //console.log(finalPrints);\r\n    setFinalPrints(finalPrints);\r\n    props.changeActivePanel('p4');\r\n  }\r\n\r\n  useEffect(() => {\r\n    const frmts = {};\r\n\r\n    printDetails.layouts.group.forEach((g) => {\r\n      const { format, orientation } = g;\r\n      const key = format + '-' + orientation;\r\n      if (!frmts[key]) frmts[key] = { format, orientation, label: format + ' - ' + orientation }\r\n    });\r\n    printDetails.layouts.prints.forEach((p) => {\r\n      const { format, orientation } = p;\r\n      const key = format + '-' + orientation;\r\n      if (!frmts[key]) frmts[key] = { format, orientation, label: format + ' - ' + orientation }\r\n    });\r\n\r\n    const ff = [];\r\n    Object.keys(frmts).forEach(function(k) {\r\n      ff.push(frmts[k]);\r\n    });\r\n\r\n    setFormats(ff);\r\n\r\n    if (ff.length > 0) handleFieldChange({ target: { id: 'layout', value: ff[0]}});\r\n\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"print-panel3\">\r\n      <h3>{printDetails.title}</h3>\r\n\r\n      <div className=\"p-fluid\">    \r\n        <Message severity=\"info\" text=\"Seleccione o formato e as plantas pretendidas e clique em Continuar\" />\r\n      </div>\r\n\r\n      <div className=\"p-fluid\">\r\n        <h4>Formato</h4>\r\n        <Dropdown id=\"layout\" optionLabel=\"label\" value={fields.layout} options={formats} onChange={handleFieldChange} placeholder=\"Selecione um Formato\"/>\r\n      </div>\r\n\r\n      <div className=\"p-fluid\">\r\n        <h4>Plantas</h4>\r\n        <PrintGroupItem\r\n          config={config}\r\n          actions={actions}\r\n          printGroup={printGroup}\r\n          printDetails={printDetails}\r\n          groupItem={printDetails}\r\n          selectedPrints={selectedPrints}\r\n          setSelectedPrints={setSelectedPrints}\r\n        />\r\n        {(printDetails.allow_selection && (printDetails.children.length + printDetails.prints.length > 1)) ?\r\n          <div className=\"p-d-flex\">\r\n            <Button label=\"Nenhuma\"\r\n              className=\"p-button-sm p-button-warning p-button-text\"\r\n              onClick={() => {\r\n                  //console.log('teste');\r\n              }}\r\n            />\r\n            <Button label=\"Todas\"\r\n              style={{ float: 'right' }}\r\n              className=\"p-button-sm p-button-warning p-button-text\"\r\n              onClick={() => {\r\n                //console.log('teste');\r\n              }}\r\n            />\r\n          </div>\r\n          : null}\r\n      </div>            \r\n\r\n      <div className=\"card\">\r\n        <div className=\"p-grid\">\r\n          <div className=\"p-col p-text-left\">\r\n            <Button\r\n                label=\"Voltar\"\r\n                icon=\"pi pi-chevron-left\"\r\n                className=\"p-button-sm\"\r\n                onClick={e => { goPanelPrintPrev(); }}\r\n            />\r\n          </div>\r\n          <div className=\"p-col p-text-right\">\r\n            <Button\r\n                label=\"Continuar\"\r\n                icon={isLoading ? \"pi pi-spin pi-spinner\": \"\"}\r\n                className=\"p-button-sm\"\r\n                onClick={e => { goPanelPrintNext(); }}\r\n                disabled={isLoading} \r\n            />\r\n          </div>\r\n        </div>  \r\n      </div>      \r\n    </div>\r\n  )\r\n\r\n}","import React, { useState, useEffect, useRef } from 'react';\r\nimport Cookies from 'universal-cookie';\r\nimport { Button } from 'primereact/button'\r\nimport { Checkbox } from 'primereact/checkbox';\r\nimport { Dropdown } from 'primereact/dropdown';\r\nimport { Toolbar } from 'primereact/toolbar';\r\nimport {InputText} from 'primereact/inputtext';\r\nimport { Message } from 'primereact/message';\r\nimport { Toast } from 'primereact/toast';\r\nimport useFormFields from \"./useFormFields\";\r\nimport PrintGroupItem from \"./PrintGroupItem\";\r\nimport './style.css'\r\n\r\nexport default function PrintPanel4(props) {\r\n\r\n  const { core, control, printGroup, printLayer, printDetails, finalPrints, setFinalPrints, fields, geometries, config, actions } = props;\r\n  const { viewer, mainMap, dispatch, Models } = config;\r\n  const { getScaleForResolution } = Models.MapModel;\r\n  const { showOnPortal } = Models.Utils;\r\n\r\n  const [isProcessing, setIsProcessing] = useState(true);\r\n  const [isMergingFiles, setIsMergingFiles] = useState(false);\r\n  const [mergedFile, setMergedFile] = useState(null);\r\n\r\n  const toast = useRef(null);\r\n\r\n  const API_URL = core.API_URL;\r\n\r\n  function goPanelPrintPrev() {\r\n    setFinalPrints([]);\r\n    props.changeActivePanel('p3');\r\n  }\r\n\r\n  function getFinalPrintsTotal() {\r\n    const total = finalPrints.map(p => p.error ? 0 : 1).reduce((sum, val) => sum + val);\r\n    return total;\r\n  }\r\n\r\n  function mergePrintFiles(prints) {\r\n    const files = [];\r\n\r\n    if (prints) {\r\n      prints.forEach(print => {\r\n        if (print.filename) {\r\n          files.push(print.filename);\r\n        }\r\n      });\r\n    } else {\r\n      finalPrints.forEach(print => {\r\n        if (print.filename) {\r\n          files.push(print.filename);\r\n        }\r\n      });\r\n    }\r\n\r\n    const record = { \r\n      viewerId: viewer.id,\r\n      files\r\n    }\r\n\r\n    let options = {\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'Content-Type': 'application/json'\r\n      },\r\n      method: 'POST',\r\n      body: JSON.stringify(record)\r\n    }\r\n    \r\n    // Get logged user\r\n    const cookies = new Cookies();\r\n    const logged = cookies.get(core.COOKIE_AUTH_NAME);\r\n    if (logged) options.headers['X-API-KEY'] = logged.token;\r\n\r\n    let url = API_URL + '/app/viewer/'+ viewer.id + '/print/merge';\r\n\r\n    setIsMergingFiles(true);\r\n\r\n    fetch(url, options)\r\n      .then(res => res.json())\r\n      .then(res => {\r\n        setIsMergingFiles(false);               \r\n\r\n        if (res.Success) {\r\n          setMergedFile({ filename: res.Data.filename, url: res.Data.url });\r\n        } else {\r\n          throw('Ocorreu um erro ao gerar o ficheiro');\r\n        }\r\n      }).catch(error => {\r\n        setIsMergingFiles(false);\r\n        setMergedFile(null);\r\n        /*\r\n        toastEl.show({\r\n          severity: 'error',\r\n          summary: 'Ocorreu um erro inesperado',\r\n          detail: \"Não foi possível obter a informação das plantas.\",\r\n          sticky: false\r\n        });\r\n        */\r\n      });\r\n  }\r\n\r\n  useEffect(() => {\r\n    // Set fetch options\r\n    let options = {\r\n      headers: {\r\n        'Accept': 'application/json',       \r\n        'Content-Type': 'application/x-www-form-urlencoded'\r\n      },\r\n      method: 'POST',\r\n      body: {}\r\n    }\r\n\r\n    // Get logged user\r\n    const cookies = new Cookies();\r\n    const logged = cookies.get(core.COOKIE_AUTH_NAME);\r\n    if (logged) options.headers['X-API-KEY'] = logged.token;\r\n\r\n    // Make a shallow copy of the print items\r\n    let newFinalPrints = [...finalPrints];\r\n\r\n    const promises = finalPrints.map(async (print) => {\r\n\r\n      const url = API_URL + '/app/viewer/' + viewer.id + '/print/' + print.code + '/generate';\r\n\r\n      const scale = getScaleForResolution(mainMap.getView().getResolution(), 'm');      \r\n\r\n      const record = {\r\n        ...printDetails.userFormData,\r\n        viewerId: viewer.id,\r\n        printId: print.id, \r\n        groupId: print.groupId,\r\n        srid: print.srid || 3857,\r\n        layout: 'A4|Portrait',\r\n        scale: scale, \r\n        extentWKT: ''\r\n      }\r\n\r\n      if (printDetails.userFormData) {\r\n        record['formFields'] = JSON.stringify(printDetails.userFormData);\r\n      }\r\n\r\n      if (fields.layout) {\r\n        record['layout'] = fields.layout.format + '|' + fields.layout.orientation;\r\n      }      \r\n\r\n      const outProj = print.srid ? 'EPSG:' + print.srid : mainMap.getView().getProjection().getCode();\r\n      \r\n      const extent = Models.MapModel.transformExtent(mainMap.getView().getProjection().getCode(), outProj, mainMap.getView().calculateExtent(mainMap.getSize()));\r\n      if (extent) {\r\n        record.extentWKT = Models.MapModel.getWKTFromGeometry(Models.MapModel.getPolygonFromExtent(extent));\r\n      }\r\n\r\n      const geomWKT = [];\r\n      if (geometries && geometries.length > 0) {\r\n        geometries.forEach(g => {\r\n          geomWKT.push(Models.MapModel.getWKTFromGeometry(g.clone().transform(mainMap.getView().getProjection().getCode(), outProj)));\r\n        });\r\n      }\r\n\r\n      let data = Object.keys(record).map(key => key + '=' + record[key]).join('&');\r\n\r\n      if (geomWKT && geomWKT.length > 0) {\r\n        data += '&' + geomWKT.map(wkt => 'geomWKT[]=' + wkt).join('&');\r\n      }\r\n\r\n      let opts = {\r\n        ...options,\r\n        body: data\r\n      }     \r\n\r\n      return fetch(url, opts)\r\n        .then(res => res.json())\r\n        .then(res => {\r\n          // Make a shallow copy of the item we want to mutate\r\n          let item = {...print};\r\n          if (res.Success) {            \r\n            // 1. Get print array index\r\n            const index = finalPrints.findIndex(p => p.uuid == print.uuid);\r\n            \r\n            //DEBUG\r\n            //if (index > 2) throw(res.Message || 'Ocorreu um erro ao gerar a planta');\r\n\r\n            // 2. Replace the property we're intested in\r\n            item.processed = true;\r\n            item.processing = false;\r\n            item.error = false;\r\n            item.filename = res.Data.filename;\r\n            item.url = res.Data.url;            \r\n            // 3. Put it back into our array.\r\n            newFinalPrints[index] = item;\r\n            // 4. Set the state to our new copy        \r\n            setTimeout(function(){ setFinalPrints(newFinalPrints); }, 500);\r\n          } else {\r\n            throw(res.Message || 'Ocorreu um erro ao gerar a planta');\r\n          }\r\n          return {...item};\r\n        }).catch(error => {\r\n          const index = finalPrints.findIndex(p => p.uuid == print.uuid);\r\n          \r\n          let item = {...print};\r\n          item.processed = false;\r\n          item.processing = false;\r\n          item.error = 'Não foi possível gerar a planta';\r\n\r\n          newFinalPrints[index] = item;          \r\n          setTimeout(function(){ setFinalPrints(newFinalPrints); }, 500);\r\n          \r\n          return {...item};\r\n        });\r\n    });\r\n\r\n    Promise.all(promises).then(res => {\r\n      let hasInvalidPrints = false;\r\n      res.forEach(print => {\r\n        if (print.error) {\r\n          hasInvalidPrints = true;\r\n        }\r\n      });\r\n\r\n      if (hasInvalidPrints) {\r\n        toast.current.show({ severity: 'warn', summary: printDetails.title || 'Emissão de plantas', \r\n          detail: 'Não foi possível gerar todas as plantas', life: 3000 });\r\n      }\r\n\r\n      setFinalPrints([...res]);\r\n      setIsProcessing(false);      \r\n      if (printDetails.merge_prints) {\r\n        setTimeout(mergePrintFiles([...res]), 1000);\r\n      }\r\n    });\r\n\r\n  }, []);  \r\n\r\n  return (\r\n    <div className=\"print-panel4\">\r\n\r\n      {showOnPortal(<Toast ref={toast} position=\"top-right\" />)}\r\n\r\n      <h3>{printDetails.title}</h3>\r\n\r\n      <div className=\"p-fluid\">\r\n        { isProcessing ?    \r\n        <Message severity=\"info\" text=\"A gerar as plantas ...\" /> :\r\n        <Message severity=\"info\" text=\"Plantas geradas. Pode descarregar as plantas pretendidas.\" />\r\n        }\r\n      </div>      \r\n\r\n      <div className=\"p-mt-4\">\r\n        { finalPrints.map( print => {\r\n          if (print.error) {\r\n            return (\r\n              <div className=\"p-grid\">\r\n                <div className=\"p-col-fixed\" style={{ width: '30px' }}>\r\n                  <div className=\"p-pl-2\">\r\n                    <i className='pi pi-times-circle print-error'></i>\r\n                  </div>\r\n                </div>                \r\n                <div className=\"p-col-9\">\r\n                  { print.groupTitle ? print.groupTitle + ' - ' + print.title :  print.title }\r\n                </div>\r\n                <div className=\"p-col\">\r\n                  <i className=\"pi pi-external-link p-pl-2\"></i>\r\n                </div>\r\n              </div>\r\n            )\r\n          } else {\r\n            if (printDetails.merge_prints) {\r\n              return (\r\n                <div className=\"p-grid\">\r\n                  <div className=\"p-col-fixed\" style={{ width: '30px' }}>\r\n                    <div className=\"p-pl-2\">\r\n                      <i className={print.processed ? 'pi pi-check print-success' : 'pi pi-spin pi-spinner'}></i>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"p-col\">\r\n                      { print.groupTitle ? print.groupTitle + ' - ' + print.title :  print.title }\r\n                  </div>               \r\n                </div>\r\n              )\r\n            } else {\r\n              return (\r\n                <div className=\"p-grid\">\r\n                  <div className=\"p-col-fixed\" style={{ width: '30px' }}>\r\n                    <div className=\"p-pl-2\">\r\n                      <i className={print.processed ? 'pi pi-check print-success' : 'pi pi-spin pi-spinner'}></i>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"p-col-9\">\r\n                      { print.groupTitle ? print.groupTitle + ' - ' + print.title :  print.title }\r\n                  </div>\r\n                  <div className=\"p-col\">\r\n                    { print.processed ?\r\n                      <a href={print.url} target=\"_blank\" title=\"Abrir planta\"\r\n                        style={ { textDecoration: \"none\", color: \"#2196f3\"} }>\r\n                        <i className=\"pi pi-external-link p-pl-2\"></i>\r\n                      </a> : null\r\n                    }\r\n                  </div>                \r\n                </div>\r\n              )\r\n            }\r\n          }\r\n        }) }\r\n      </div>\r\n\r\n      { mergedFile ?\r\n        <div className=\"card p-text-center\">\r\n          <a href={mergedFile.url} target=\"_blank\" style={ { textDecoration: \"none\", color: \"#2196f3\"} }>\r\n            <i className=\"pi pi-external-link p-pl-2\"></i> Abrir PDF com todas as plantas\r\n          </a>          \r\n        </div> :\r\n        null\r\n      }\r\n\r\n      { !isProcessing && !mergedFile && getFinalPrintsTotal() > 1 ?\r\n        <div className=\"card p-text-center\">\r\n          <Button label=\"Criar PDF com todas as plantas\"\r\n            icon={ isMergingFiles ? 'pi pi-spin pi-spinner' : '' } \r\n            className=\"p-button\"\r\n            onClick={e => { mergePrintFiles(); }}\r\n            />\r\n        </div> :\r\n        null\r\n      }\r\n\r\n      <div className=\"card\">\r\n        <div className=\"p-grid\">\r\n          <div className=\"p-col p-text-left\">\r\n            <Button\r\n                label=\"Voltar\"\r\n                icon=\"pi pi-chevron-left\"\r\n                className=\"p-button-sm\"\r\n                onClick={e => { goPanelPrintPrev(); }}\r\n            />\r\n          </div>\r\n        </div>  \r\n      </div> \r\n\r\n    </div>\r\n  )\r\n\r\n}","import React, { useState, useEffect, useRef } from 'react'\r\nimport Cookies from 'universal-cookie'\r\nimport { Button } from 'primereact/button'\r\nimport { Dropdown } from 'primereact/dropdown';\r\nimport { Toolbar } from 'primereact/toolbar';\r\nimport { InputText } from 'primereact/inputtext';\r\nimport { Message } from 'primereact/message';\r\nimport { TabView, TabPanel } from 'primereact/tabview';\r\nimport { InputNumber } from 'primereact/inputnumber';\r\nimport { confirmDialog } from 'primereact/confirmdialog';\r\nimport { Toast } from 'primereact/toast';\r\nimport { Checkbox } from 'primereact/checkbox';\r\nimport OlInteractionDraw from 'ol/interaction/Draw';\r\nimport OlInteractionModify from 'ol/interaction/Modify';\r\nimport OlInteractionSelect from 'ol/interaction/Select';\r\nimport OlInteractionDragPan from \"ol/interaction/DragPan\";\r\n\r\nimport VectorLayer from 'ol/layer/Vector';\r\nimport { Vector } from 'ol/source';\r\nimport { Fill, Stroke, Style } from 'ol/style';\r\nimport Polygon from 'ol/geom/Polygon';\r\nimport Feature from 'ol/Feature';\r\nimport { extend, createEmpty } from 'ol/extent';\r\n\r\nimport { singleClick, platformModifierKeyOnly } from 'ol/events/condition';\r\nimport './style.css'\r\n\r\n\r\nexport default function PrintPanelItem(props) {\r\n\r\n  const { core, control, printItem, printLayer, fields, handleFieldChange, standalone, config, actions } = props;\r\n  const { viewer, mainMap, dispatch, Models } = config;\r\n  const { showOnPortal, findOLInteraction } = Models.Utils;\r\n  const { getScaleForResolution, getWMSVisibleLayers, getArcGISVisibleLayers } = Models.MapModel;\r\n  const { exclusive_mapcontrol } = viewer;\r\n\r\n  const { selected_menu } = viewer.config_json\r\n\r\n  const toast = useRef(null);\r\n  const toastDialog = useRef(null);\r\n\r\n  const paperBoxLayer = useRef();\r\n  const [paperBox, setPaperBox] = useState(false);\r\n\r\n  const [drawTool, setDrawTool] = useState(null);\r\n  const [draw, setDraw] = useState(null);\r\n  const select = useRef(null);\r\n  const modify = useRef();\r\n\r\n  const [formats, setFormats] = useState(null);\r\n  const [restrictScales, setRestrictScales] = useState(null);\r\n\r\n  const [scaleTabIndex, setScaleTabIndex] = useState(0);\r\n  const [scaleModes, setScaleModes] = useState([]);\r\n  const [selectedScaleMode, setSelectedScaleMode] = useState(null);\r\n  const [restrictedScale, setRestrictedScale] = useState(null);\r\n  const [freeScale, setFreeScale] = useState(null);\r\n\r\n  const [isPrinting, setIsPrinting] = useState(false);\r\n  const [showErrors, setShowErrors] = useState(false);\r\n\r\n  const [printFile, setPrintFile] = useState(null);\r\n\r\n  const drawTools = [\r\n    { value: \"Point\", title: \"Adicionar ponto\", icon: \"fas fa-circle\" },\r\n    { value: \"LineString\", title: \"Adicionar linha\", icon: \"pi pi-minus\" },\r\n    { value: \"Polygon\", title: \"Adicionar polígono\", icon: \"fas fa-draw-polygon\" },\r\n    { value: \"Select\", title: \"Selecionar elemento\", icon: \"fas fa-mouse-pointer\" },\r\n    { value: \"Modify\", title: \"Editar elemento\", icon: \"pi pi-pencil\" }\r\n  ];\r\n\r\n  function selectDrawTool(e, tool) {\r\n    e.preventDefault();\r\n    e.target.blur();\r\n\r\n    if (drawTool !== tool) setDrawTool(tool);\r\n    else setDrawTool(null);\r\n  }\r\n\r\n  function addInteraction(type) {\r\n    if (draw) mainMap.removeInteraction(draw);\r\n    if (select.current) select.current.setActive(false);\r\n    if (modify.current) modify.current.setActive(false);\r\n\r\n    if (['Point', 'LineString', 'Polygon'].includes(type)) {\r\n      const source = printLayer.current.getSource();\r\n      const di = new OlInteractionDraw({\r\n        source: source,\r\n        type: type,\r\n      });\r\n      mainMap.addInteraction(di);\r\n      di.on('drawend', (e) => {\r\n        if (!printItem.multi_geom) {\r\n          if (select.current) select.current.getFeatures().clear();\r\n          printLayer.current.getSource().getFeatures().forEach((f) => {\r\n            if (f !== e.feature) printLayer.current.getSource().removeFeature(f);\r\n          });\r\n        }\r\n\r\n        if (paperBox) {\r\n          drawPaperBox()\r\n        }\r\n\r\n      });\r\n      setDraw(di);\r\n    } else if (type === 'Select') {\r\n      select.current.setActive(true);\r\n    } else if (type === 'Modify') {\r\n      findOLInteraction(mainMap, OlInteractionDragPan).setActive(false);\r\n      modify.current.setActive(true);\r\n    }\r\n  }\r\n\r\n  const confirmDeleteAll = (features) => {\r\n    confirmDialog({\r\n      message: ' Deseja eliminar todos os elementos?',\r\n      header: 'Confirmação',\r\n      icon: 'pi pi-exclamation-triangle',\r\n      acceptLabel: 'Sim',\r\n      rejectLabel: 'Não',\r\n      accept: () => {\r\n        features.forEach((f) => {\r\n          printLayer.current.getSource().removeFeature(f);\r\n        });\r\n        drawPaperBox();\r\n        mainMap.render();\r\n      },\r\n      reject: () => { }\r\n    });\r\n  }\r\n\r\n  function deletedSelectedFeature() {\r\n    const feats = printLayer.current.getSource().getFeatures();\r\n\r\n    if (select.current && select.current.getFeatures().getLength() > 0) {\r\n      select.current.getFeatures().forEach((f) => {\r\n        printLayer.current.getSource().removeFeature(f);\r\n      });\r\n      select.current.getFeatures().clear();\r\n    } else if (feats && feats.length > 1) {\r\n      confirmDeleteAll(feats);\r\n    } else if (feats && feats.length === 1) {\r\n      feats.forEach((f) => {\r\n        printLayer.current.getSource().removeFeature(f);\r\n      });\r\n    }\r\n\r\n    drawPaperBox();\r\n    mainMap.render();\r\n  }\r\n\r\n  function zoomFeaturesExtent() {\r\n    if (printLayer && printLayer.current && printLayer.current.getSource().getFeatures().length > 0) {\r\n      let extent = printLayer.current.getSource().getExtent();\r\n      if (!extent) return;\r\n      let center = [extent[0] + (extent[2] - extent[0]) / 2, extent[1] + (extent[3] - extent[1]) / 2];\r\n\r\n      if ((extent[2] - extent[0]) < 500 || (extent[3] - extent[1]) < 500) {\r\n        extent = [center[0] - 250, center[1] - 250, center[0] + 250, center[1] + 250];\r\n      }\r\n\r\n      dispatch(actions.map_set_extent(center, extent));\r\n    }\r\n  }\r\n\r\n  function goPanelPrintPrev() {\r\n    props.setPrintItem(null);\r\n    if (draw) mainMap.removeInteraction(draw);\r\n    props.changeActivePanel('p1');\r\n  }\r\n\r\n  function doPrint() {\r\n    let isFormInvalid = false;\r\n\r\n    setPrintFile(null);\r\n\r\n    const formData = {};\r\n    if (printItem.form_fields && printItem.form_fields.groups) {\r\n      Object.entries(printItem.form_fields.groups).forEach(([groupKey, group]) => {\r\n        Object.entries(group.fields).forEach(([fieldKey, field]) => {\r\n          const field_key = groupKey + '.' + fieldKey;\r\n          const val = fields[field_key];\r\n          if (val) {\r\n            const fieldName = field.name || fieldKey;\r\n            formData[fieldName] = val;\r\n          } else {\r\n            if (field.required) isFormInvalid = true;\r\n          }\r\n        });\r\n      });\r\n    }\r\n    if (printItem.form_fields && printItem.form_fields.fields) {\r\n      Object.entries(printItem.form_fields.fields).forEach(([fieldKey, field]) => {\r\n        const field_key = fieldKey;\r\n        const val = fields[field_key];\r\n        if (val) {\r\n          const fieldName = field.name || fieldKey;\r\n          formData[fieldName] = val;\r\n        } else {\r\n          if (field.required) isFormInvalid = true;\r\n        }\r\n      });\r\n    }\r\n\r\n    if (printItem.location_marking && !isFormInvalid) {\r\n      const ft = printLayer.current.getSource().getFeatures();\r\n      if (ft.length === 0) isFormInvalid = true;\r\n    }\r\n\r\n    //Abort if form is not valid\r\n    if (isFormInvalid) return;\r\n\r\n    setDrawTool(null);\r\n    setIsPrinting(true);\r\n\r\n    // Set fetch options\r\n    let options = {\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'Content-Type': 'application/x-www-form-urlencoded'\r\n      },\r\n      method: 'POST',\r\n      body: {}\r\n    }\r\n\r\n    // Get logged user\r\n    const cookies = new Cookies();\r\n    const logged = cookies.get(core.COOKIE_AUTH_NAME);\r\n    if (logged) options.headers['X-API-KEY'] = logged.token;\r\n\r\n    const url = core.API_URL + '/app/viewer/' + viewer.id + '/print/' + printItem.code + '/generate';\r\n\r\n    const scale = getScaleForResolution(mainMap.getView().getResolution(), 'm');\r\n\r\n    const record = {\r\n      ...formData,\r\n      viewerId: viewer.id,\r\n      printId: printItem.id,\r\n      srid: printItem.srid || 3857,\r\n      layout: 'A4|Portrait',\r\n      scale: scale,\r\n      extentWKT: ''\r\n    }\r\n\r\n    if (formData) {\r\n      record['formFields'] = JSON.stringify(formData);\r\n    }\r\n\r\n    if (fields.layout) {\r\n      record['layout'] = fields.layout.format + '|' + fields.layout.orientation;\r\n    }\r\n\r\n    if (selectedScaleMode === 'restricted' && restrictedScale) {\r\n      record['userScale'] = restrictedScale;\r\n    } else if (selectedScaleMode === 'free' && freeScale) {\r\n      record['userScale'] = freeScale;\r\n    }\r\n\r\n    const outProj = printItem.srid ? 'EPSG:' + printItem.srid : mainMap.getView().getProjection().getCode();\r\n\r\n    const extent = Models.MapModel.transformExtent(mainMap.getView().getProjection().getCode(), outProj, mainMap.getView().calculateExtent(mainMap.getSize()));\r\n    if (extent) {\r\n      record.extentWKT = Models.MapModel.getWKTFromGeometry(Models.MapModel.getPolygonFromExtent(extent));\r\n    }\r\n\r\n    const geomWKT = [];\r\n    printLayer.current.getSource().getFeatures().forEach((f) => {\r\n      geomWKT.push(Models.MapModel.getWKTFromGeometry(f.getGeometry().clone().transform(mainMap.getView().getProjection().getCode(), outProj)));\r\n    });\r\n\r\n    let data = Object.keys(record).map(key => key + '=' + record[key]).join('&');\r\n\r\n    if (geomWKT && geomWKT.length > 0) {\r\n      data += '&' + geomWKT.map(wkt => 'geomWKT[]=' + wkt).join('&');\r\n    }\r\n\r\n    //Get WMS and ArGIS Layers\r\n    const wmsLayers = getWMSVisibleLayers(mainMap) || [];\r\n    const arcgisLayers = getArcGISVisibleLayers(mainMap) || [];\r\n    const allLayers = [\r\n      ...wmsLayers.map(l => 'wms' + ';' + l.url + ';' + l.params.LAYERS + ';' + l.opacity + ';' + l.minScale + ';' + l.maxScale + ';' + (l.params.CQL_FILTER || '') + ';' + (l.params.STYLES || l.params.STYLE || '')),\r\n      ...arcgisLayers.map(l => 'esri_rest' + ';' + l.url + ';' + l.params.LAYERS + ';' + l.opacity + ';' + l.minScale + ';' + l.maxScale + ';' + (l.params.CQL_FILTER || '') + ';' + (l.params.STYLES || l.params.STYLE || '')),\r\n    ];\r\n\r\n    if (allLayers.length) {\r\n      data += '&' + allLayers.map(l => 'layers[]=' + l).join('&');\r\n    }\r\n\r\n    let opts = {\r\n      ...options,\r\n      body: data\r\n    }\r\n\r\n    return fetch(url, opts)\r\n      .then(res => res.json())\r\n      .then(res => {\r\n        setIsPrinting(false);\r\n        if (res.Success) {\r\n          setPrintFile({ filename: res.Data.filename, url: res.Data.url });\r\n        } else {\r\n          throw (res.Message || 'Ocorreu um erro ao gerar a planta');\r\n        }\r\n      }).catch(error => {\r\n        setIsPrinting(false);\r\n        toast.current.show({\r\n          severity: 'warn', summary: printItem.title || 'Emissão de plantas',\r\n          detail: 'Não foi possível gerar a planta', life: 3000\r\n        });\r\n      });\r\n  }\r\n\r\n  function getScalesTabs() {\r\n    const tabs = [];\r\n    if (printItem.restrict_scales) {\r\n      tabs.push(<TabPanel key={'predefined'} header=\"Predefinida\">\r\n        <Dropdown\r\n          className=\"p-inputgroup\"\r\n          options={restrictScales}\r\n          optionLabel=\"label\"\r\n          optionValue=\"value\"\r\n          value={restrictedScale}\r\n          onChange={e => setRestrictedScale(e.value)}\r\n        />\r\n      </TabPanel>)\r\n    }\r\n    if (printItem.free_scale) {\r\n      tabs.push(<TabPanel key={'freescale'} header=\"Livre\">\r\n        <InputNumber value={freeScale} onChange={(e) => setFreeScale(e.value)} prefix=\"1:\" />\r\n      </TabPanel>)\r\n    }\r\n    if (printItem.map_scale) {\r\n      tabs.push(<TabPanel key={'map'} header=\"Mapa\">\r\n        <Message\r\n          severity=\"info\"\r\n          text={\"A planta será emitida em função da escala de visualização do mapa\"}\r\n        />\r\n      </TabPanel>)\r\n    }\r\n    return tabs;\r\n  }\r\n\r\n\r\n\r\n  useEffect(() => {\r\n    const frmts = {};\r\n    printItem.layouts.forEach((p) => {\r\n      const { format, orientation } = p;\r\n      const key = format + '-' + orientation;\r\n      if (!frmts[key]) frmts[key] = { format, orientation, label: format + ' - ' + orientation }\r\n    });\r\n    const ff = [];\r\n    Object.keys(frmts).forEach(function (k) {\r\n      ff.push(frmts[k]);\r\n    });\r\n    setFormats(ff);\r\n    if (ff.length > 0) handleFieldChange({ target: { id: 'layout', value: ff[0] } });\r\n\r\n    //Set scale modes\r\n    const scale_types = [];\r\n    if (printItem.restrict_scales) scale_types.push('restricted');\r\n    if (printItem.free_scale) scale_types.push('free');\r\n    if (printItem.map_scale) scale_types.push('map');\r\n    setScaleModes(scale_types);\r\n\r\n\r\n    //Set restricted scales\r\n    const scales = [];\r\n    if (printItem.restrict_scales_list) {\r\n      printItem.restrict_scales_list.split(',').forEach((s) => {\r\n        scales.push({ value: parseInt(s), label: '1:' + s });\r\n      })\r\n    }\r\n    setRestrictScales(scales);\r\n    //Set restricted scale default value\r\n    if (scales.length > 0) setRestrictedScale(scales[0].value);\r\n\r\n\r\n    const tabs = getScalesTabs()\r\n    const defaultTab = tabs.findIndex(e => e.key === control?.config_json?.defaultScaleSelector)\r\n    \r\n    if (scale_types.length > 0) {\r\n      if (defaultTab > -1) {\r\n        setScaleTabIndex(defaultTab);\r\n        setSelectedScaleMode(scale_types[defaultTab]);\r\n      } else {\r\n        setSelectedScaleMode(scale_types[0]);\r\n      }\r\n    }\r\n\r\n\r\n\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    setShowErrors(false);\r\n  }, [fields]);\r\n\r\n  function onScaleTabChange(e) {\r\n    setScaleTabIndex(e.index);\r\n    setSelectedScaleMode(scaleModes[e.index]);\r\n  }\r\n\r\n  // Add paper box layer\r\n  useEffect(() => {\r\n\r\n    paperBoxLayer.current = new VectorLayer({\r\n      id: \"paperbox-layer\",\r\n      renderMode: 'vector',\r\n      source: new Vector({}),\r\n      style: new Style({\r\n        stroke: new Stroke({\r\n          color: 'rgba(100, 100, 100, 0.8)',\r\n          width: 7,\r\n          lineDash: [4, 8]\r\n        }),\r\n        fill: new Fill({\r\n          color: 'rgba(255, 255, 255, 0.2)'\r\n        }),\r\n      })\r\n    })\r\n\r\n    mainMap.addLayer(paperBoxLayer.current)\r\n\r\n  }, []);\r\n\r\n\r\n  // draw paper box \r\n  function drawPaperBox() {\r\n    if (!paperBoxLayer.current.getSource()) { return null }\r\n    if (!selectedScaleMode) { return null }\r\n\r\n    paperBoxLayer.current.getSource().clear();\r\n\r\n    if (!paperBox) { return null }\r\n    if (selected_menu !== 'print') { return null }\r\n    \r\n\r\n    let scale;\r\n\r\n\r\n    if (selectedScaleMode === 'map') {\r\n      scale = getScaleForResolution(mainMap.getView().getResolution(), 'm')\r\n    } else if (selectedScaleMode === 'free') {\r\n      scale = freeScale\r\n    } else if (selectedScaleMode === 'restricted') {\r\n      scale = restrictedScale\r\n    } else {\r\n      // ?\r\n      return null\r\n    }\r\n\r\n\r\n    let center_x\r\n    let center_y\r\n\r\n    if (printLayer.current.getSource().getFeatures().length > 0) { // user geoms \r\n      let f_extent = new createEmpty()\r\n      printLayer.current.getSource().getFeatures().forEach((i) => {\r\n        f_extent = extend(f_extent, i.getGeometry().getExtent())\r\n      })\r\n      center_x = (f_extent[0] + f_extent[2]) / 2\r\n      center_y = (f_extent[1] + f_extent[3]) / 2\r\n    } else {\r\n      // no user geom\r\n      center_x = mainMap.getView().getCenter()[0];\r\n      center_y = mainMap.getView().getCenter()[1];\r\n    }\r\n\r\n    // const units = \"meter\"\r\n    const inch_per_units = 39.37\r\n\r\n    // find layout serv conf\r\n    const layout_conf = printItem.layouts.find(e => e.orientation === fields.layout.orientation && fields.layout.format === printItem.format)\r\n    if (!layout_conf || !layout_conf.config) return null; // TODO need clean up !??\r\n\r\n    const layout_conf_json = JSON.parse(layout_conf?.config)[0]\r\n\r\n    const img_w = layout_conf_json.map.width;\r\n    const img_h = layout_conf_json.map.height;\r\n\r\n    const magic = 22;\r\n    const res = 1 / ((1 / scale) * inch_per_units * magic);\r\n    const half_w = (img_w * res) / 2;\r\n    const half_h = (img_h * res) / 2;\r\n    const xmin = center_x - half_w;\r\n    const ymin = center_y - half_h;\r\n    const xmax = center_x + half_w;\r\n    const ymax = center_y + half_h;\r\n\r\n    const corners_pts = [[\r\n      [xmin, ymin],\r\n      [xmin, ymax],\r\n      [xmax, ymax],\r\n      [xmax, ymin],\r\n      [xmin, ymin] // closing if be used as print polygon...\r\n    ]]\r\n\r\n    const paperbox = new Polygon(corners_pts);\r\n    const paperbox_Feature = new Feature(paperbox);\r\n\r\n    paperBoxLayer.current.getSource().addFeature(paperbox_Feature);\r\n\r\n\r\n  }\r\n\r\n  useEffect(() => {\r\n    drawPaperBox()\r\n\r\n  }, [fields, restrictedScale, freeScale, selectedScaleMode, paperBox,\r\n    mainMap.getView().calculateExtent()]);\r\n\r\n\r\n\r\n  useEffect(() => {\r\n    if (drawTool) {\r\n      dispatch(actions.viewer_set_exclusive_mapcontrol('Print'));\r\n      addInteraction(drawTool);\r\n    } else {\r\n      if (draw) {\r\n        mainMap.removeInteraction(draw);\r\n        setDraw(null);\r\n      }\r\n      if (select.current) select.current.setActive(false);\r\n      if (modify.current) modify.current.setActive(false);\r\n\r\n      const olit = findOLInteraction(mainMap, OlInteractionDragPan);\r\n      if (olit) olit.setActive(true);\r\n    }\r\n  }, [drawTool]);\r\n\r\n  useEffect(() => {\r\n    if (drawTool && exclusive_mapcontrol !== 'Print') {\r\n      setDrawTool(null);\r\n    }\r\n  }, [exclusive_mapcontrol]);\r\n\r\n  useEffect(() => {\r\n    const slct = new OlInteractionSelect({\r\n      condition: singleClick,\r\n      hitTolerance: 5,\r\n      wrapX: false,\r\n      filter: (feature, layer) => {\r\n        if (layer.get('id') !== 'print') return false;\r\n        return true;\r\n      }\r\n    });\r\n    slct.on('select', function (e) {\r\n      mainMap.render();\r\n    });\r\n    mainMap.addInteraction(slct);\r\n    slct.setActive(false);\r\n    select.current = slct;\r\n\r\n    const mdf = new OlInteractionModify({\r\n      source: printLayer.current.getSource(),\r\n      deleteCondition: (event) => {\r\n        return singleClick(event) && platformModifierKeyOnly(event);\r\n      }\r\n    });\r\n    mainMap.addInteraction(mdf);\r\n    mdf.setActive(false);\r\n    modify.current = mdf;\r\n\r\n    mainMap.controls.forEach(function (control) {\r\n      if (control.dragPan) {\r\n        control.dragPan.deactivate();\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      if (slct) mainMap.removeInteraction(slct);\r\n      if (mdf) mainMap.removeInteraction(mdf);\r\n    }\r\n  }, [mainMap]);\r\n\r\n\r\n  const toolbarLeftContents = (\r\n    <React.Fragment>\r\n      {drawTools.map(opt =>\r\n        <Button\r\n          key={opt.value}\r\n          icon={opt.icon}\r\n          label={opt.label ? opt.label : ''}\r\n          tooltip={opt.title}\r\n          className={\"p-button-sm p-mr-2 tool\" + (opt.value === drawTool ? \" active\" : \"\")}\r\n          onClick={(e) => selectDrawTool(e, opt.value)}\r\n        />\r\n      )}\r\n    </React.Fragment>\r\n  );\r\n\r\n  const toolbarRightContents = (\r\n    <React.Fragment>\r\n      <Button\r\n        icon=\"pi pi-trash\"\r\n        tooltip=\"Eliminar elemento(s)\"\r\n        className=\"p-button-sm p-mr-2 tool\"\r\n        onClick={(e) => deletedSelectedFeature()}\r\n      />\r\n      <Button\r\n        icon=\"fas fa-search-plus\"\r\n        tooltip=\"Ver todos os elementos\"\r\n        className=\"p-button-sm p-mr-2 tool\"\r\n        onClick={(e) => zoomFeaturesExtent()}\r\n      />\r\n    </React.Fragment>\r\n  );\r\n\r\n  return (\r\n    <div className=\"print-panel-item\">\r\n      {showOnPortal(<Toast ref={toast} position=\"top-right\" />)}\r\n      {showOnPortal(<Toast ref={toastDialog} />)}\r\n\r\n      <h3>{props.printItem.title}</h3>\r\n\r\n      {(printItem.allow_drawing !== false) && <div className=\"p-fluid\">\r\n        <h4>Marcação do Local</h4>\r\n        <div>\r\n          <Toolbar left={toolbarLeftContents} right={toolbarRightContents} />\r\n        </div>\r\n        {printItem.location_marking &&\r\n          <Message severity=\"info\" text=\"Deverá marcar no mapa a localização pretendida\" />\r\n        }\r\n      </div>}\r\n\r\n      {(printItem.restrict_scales || printItem.free_scale || printItem.map_scale) &&\r\n        <div className=\"p-fluid\">\r\n          <h4>Escala de Saída</h4>\r\n          <TabView activeIndex={scaleTabIndex} onTabChange={(e) => onScaleTabChange(e)}>\r\n            {getScalesTabs().map(tab => tab)}\r\n          </TabView>\r\n        </div>}\r\n\r\n      <div className=\"p-fluid\">\r\n        <h4>Formato</h4>\r\n        <Dropdown\r\n          id=\"layout\"\r\n          optionLabel=\"label\"\r\n          value={fields.layout}\r\n          options={formats}\r\n          onChange={handleFieldChange}\r\n          placeholder=\"Selecione um Formato\" />\r\n      </div>\r\n\r\n      {(printItem.form_fields && printItem.form_fields.groups) &&\r\n        <React.Fragment>\r\n          {Object.entries(printItem.form_fields.groups).map(([groupKey, group]) => {\r\n            if (group.active) {\r\n              return <div key={groupKey} className=\"p-fluid\">\r\n                <h4>{group.title}</h4>\r\n                {group.fields && Object.entries(group.fields).map(([fieldKey, field]) => {\r\n                  const field_key = groupKey + '.' + fieldKey;\r\n                  if (field.active) {\r\n                    return <div key={field_key} className=\"p-field\">\r\n                      {field.header && <h4>{field.header}</h4>}\r\n                      {field.label && <label>{field.label}</label>}\r\n                      <InputText id={field_key} className=\"p-inputtext-sm p-d-block\"\r\n                        placeholder={field.title} tooltip={field.title}\r\n                        value={fields[field_key]} onChange={handleFieldChange} />\r\n                      {(field.required && !fields[field_key]) && <small id={field_key + \"-help\"} className=\"p-error\">Campo de preenchimento obrigatório.</small>}\r\n                    </div>\r\n                  }\r\n                })}\r\n              </div>\r\n            }\r\n          })}\r\n        </React.Fragment>\r\n      }\r\n\r\n      {(printItem.form_fields && printItem.form_fields.fields) &&\r\n        <React.Fragment>\r\n          {Object.entries(printItem.form_fields.fields).map(([fieldKey, field]) => {\r\n            const field_key = fieldKey;\r\n            if (field.active) {\r\n              return <React.Fragment>\r\n                <div key={field_key} className=\"p-fluid\">\r\n                  {field.header && <h4>{field.header}</h4>}\r\n                  <div className=\"p-field\">\r\n                    {field.label && <label>{field.label}</label>}\r\n                    <InputText id={field_key} className=\"p-inputtext-sm p-d-block\"\r\n                      placeholder={field.title} tooltip={field.title}\r\n                      value={fields[field_key]} onChange={handleFieldChange} />\r\n                    {(field.required && !fields[field_key]) && <small id={field_key + \"-help\"} className=\"p-error\">Campo de preenchimento obrigatório.</small>}\r\n                  </div>\r\n                </div>\r\n              </React.Fragment>\r\n            }\r\n          })}\r\n        </React.Fragment>\r\n      }\r\n\r\n      {isPrinting ?\r\n        <div className=\"card p-text-center p-mt-4\" style={{ backgroundColor: \"#add8e6\", borderRadius: \"4px\" }}>\r\n          <div><i className=\"pi pi-spin pi-spinner\"></i> A gerar a planta ...</div>\r\n        </div> : null\r\n      }\r\n      {!isPrinting && printFile ?\r\n        <div className=\"card p-text-center p-mt-4\" style={{ backgroundColor: \"#add8e6\", borderRadius: \"4px\" }}>\r\n          <a href={printFile.url} target=\"_blank\">\r\n            <i className=\"pi pi-external-link p-pl-2\"></i> Abrir PDF da planta\r\n          </a>\r\n        </div> : null\r\n      }\r\n\r\n      <div className=\"card\">\r\n        <div className=\"p-grid\">\r\n          <div className=\"p-col p-text-left\">\r\n            {!standalone &&\r\n              <Button\r\n                label=\"Voltar\"\r\n                icon=\"pi pi-chevron-left\"\r\n                className=\"p-button-sm\"\r\n                onClick={e => { goPanelPrintPrev(); }}\r\n              />}\r\n          </div>\r\n          <div className=\"p-col p-text-right\">\r\n            <Button\r\n              label=\"Imprimir\"\r\n              icon=\"pi pi-print\"\r\n              className=\"p-button-sm\"\r\n              onClick={e => { doPrint(); }}\r\n              disabled={isPrinting}\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n      {config.showPreview ? <div className=\"card\">\r\n        <div className=\"field-checkbox\">\r\n          <Checkbox inputId=\"binary\" checked={paperBox}\r\n            onChange={e => setPaperBox(e.checked)} />\r\n          <label htmlFor=\"binary\"> Visualizar área de impressão</label>\r\n        </div>\r\n      </div> : null}\r\n    </div>\r\n  )\r\n\r\n}","import React, { useState, useEffect, useRef } from 'react'\r\nimport 'ol/ol.css';\r\nimport VectorLayer from 'ol/layer/Vector'\r\nimport { Vector } from 'ol/source';\r\nimport {Circle as CircleStyle, Fill, Stroke, Style} from 'ol/style';\r\nimport PrintPanelNoPrints from './PrintPanelNoPrints.js';\r\nimport PrintPanel1 from './PrintPanel1';\r\nimport PrintPanel2 from './PrintPanel2';\r\nimport PrintPanel3 from './PrintPanel3';\r\nimport PrintPanel4 from './PrintPanel4';\r\nimport PrintPanelItem from './PrintPanelItem';\r\nimport useFormFields from \"./useFormFields\";\r\nimport './style.css'\r\n\r\nexport default function Print({core, config, actions, dispatch, record}) {\r\n\r\n  const { viewer, mainMap, Models } = config;\r\n\r\n  // global\r\n  const [activePanel, changeActivePanel] = useState(\"p1\");\r\n  const [standalone, setStandalone] = useState(false);\r\n  const [printGroup, setPrintGroup] = useState(null);\r\n  const [printItem, setPrintItem] = useState(null);\r\n  const [printDetails, setPrintDetails] = useState(null);\r\n  const [finalPrints, setFinalPrints] = useState(null);\r\n  const [fields, handleFieldChange] = useFormFields({});\r\n  const [geometries, setGeometries] = useState([]);\r\n\r\n  const printLayer = useRef();\r\n\r\n  const printStyle = new Style({\r\n    image: new CircleStyle({\r\n        radius: 4,\r\n        fill: new Fill({\r\n        color: '#fff',\r\n        }),\r\n        stroke: new Stroke({\r\n        color: '#FF0000',\r\n        width: 2,\r\n        }),\r\n    })\r\n  });\r\n\r\n  function getTotalPrints() {\r\n    let total = 0;\r\n\r\n    if (!viewer.printing) return total;\r\n\r\n    if (viewer.printing.groups && viewer.printing.groups.length) {\r\n      total += viewer.printing.groups.length;\r\n    }\r\n    if (viewer.printing.prints && viewer.printing.prints.length) {\r\n      total += viewer.printing.prints.length;\r\n    }\r\n\r\n    return total;\r\n  }  \r\n\r\n  useEffect(() => {\r\n    const total = getTotalPrints();\r\n\r\n\r\n    if (total == 0) {\r\n      changeActivePanel(\"p-noprints\");\r\n      setStandalone(false);      \r\n    } else if (total > 1) {\r\n      changeActivePanel(\"p1\");\r\n      setStandalone(false);\r\n    } else if (viewer.printing && viewer.printing.groups && viewer.printing.groups.length > 0) {\r\n      setPrintGroup(viewer.printing.groups[0]);\r\n      changeActivePanel(\"p2\");\r\n      setStandalone(true);\r\n    } else if (viewer.printing && viewer.printing.prints && viewer.printing.prints.length > 0) {\r\n      setPrintItem(viewer.printing.prints[0]);\r\n      changeActivePanel(\"p2-item\");\r\n      setStandalone(true);\r\n    }\r\n  }, []);\r\n\r\n\r\n  // Add print layer\r\n  useEffect(() => {\r\n    if (!mainMap) return;\r\n\r\n    printLayer.current = new VectorLayer({\r\n      id: 'print',\r\n      renderMode: 'vector',\r\n      source: new Vector({}),\r\n      //style: style_pts,\r\n      selectable: false\r\n    })\r\n\r\n    const parentLayer = Models.Utils.findOlLayer(mainMap, 'overlays');\r\n\r\n    if (parentLayer) {\r\n      parentLayer.getLayers().getArray().push(printLayer.current);\r\n    } else {\r\n      mainMap.addLayer(printLayer.current); \r\n    }\r\n\r\n    /*\r\n    setTimeout(() => {     \r\n\r\n      //Add theme\r\n      dispatch(actions.viewer_add_themes(\r\n          \"componentslayer\",\r\n          [\r\n              {\r\n              id: \"print\",\r\n              title: \"Print\",\r\n              description: \"Print\",\r\n              active: true,\r\n              open: false,\r\n              type: \"VECTOR\",\r\n              opacity: 1,\r\n              selectable: false\r\n              }\r\n          ]\r\n      ));      \r\n\r\n      setTimeout(() => {       \r\n        printLayer.current = Models.Utils.findOlLayer(mainMap, 'print');\r\n        //printLayer && printLayer.current.setStyle(printStyle);\r\n\r\n        // Turn layer on\r\n        dispatch(actions.layers_set_checked([ ...viewer.config_json.checked, 'print']));        \r\n      }, 500);\r\n\r\n    }, 1500);\r\n    */\r\n\r\n  }, [mainMap]);\r\n\r\n  return (\r\n    <div style={{ height: '100%' }}>\r\n\r\n      {activePanel === \"p-noprints\" ?\r\n        <PrintPanelNoPrints\r\n          core={core}\r\n          config={config}\r\n          control={record}\r\n          actions={actions}\r\n          dispatch={dispatch}\r\n          activePanel={activePanel}\r\n          changeActivePanel={changeActivePanel}\r\n        />\r\n      : null}\r\n\r\n      {activePanel === \"p1\" ?\r\n        <PrintPanel1\r\n          core={core}\r\n          config={config}\r\n          control={record}\r\n          actions={actions}\r\n          dispatch={dispatch}\r\n          activePanel={activePanel}\r\n          changeActivePanel={changeActivePanel}\r\n          printGroup={printGroup}\r\n          setPrintGroup={setPrintGroup}\r\n          printItem={printItem}\r\n          setPrintItem={setPrintItem}\r\n          printLayer={printLayer}\r\n          fields={fields}\r\n          handleFieldChange={handleFieldChange}\r\n        />\r\n      : null}\r\n\r\n      {activePanel === \"p2\" ?\r\n        <PrintPanel2\r\n          core={core}\r\n          standalone={standalone}\r\n          config={config}\r\n          control={record}\r\n          actions={actions}\r\n          dispatch={dispatch}\r\n          activePanel={activePanel}\r\n          changeActivePanel={changeActivePanel}\r\n          printGroup={printGroup}\r\n          setPrintGroup={setPrintGroup}\r\n          printLayer={printLayer}\r\n          printDetails={printDetails}\r\n          setPrintDetails={setPrintDetails}\r\n          fields={fields}\r\n          setGeometries={setGeometries}\r\n          handleFieldChange={handleFieldChange}          \r\n        />\r\n      : null}\r\n\r\n      {activePanel === \"p3\" ?\r\n        <PrintPanel3\r\n          core={core}\r\n          config={config}\r\n          control={record}\r\n          actions={actions}\r\n          dispatch={dispatch}\r\n          activePanel={activePanel}\r\n          changeActivePanel={changeActivePanel}\r\n          printGroup={printGroup}\r\n          setPrintGroup={setPrintGroup}\r\n          printLayer={printLayer}\r\n          printDetails={printDetails}\r\n          setFinalPrints={setFinalPrints}\r\n          fields={fields}\r\n          handleFieldChange={handleFieldChange}          \r\n        />\r\n      : null}\r\n\r\n      {activePanel === \"p4\" ?\r\n        <PrintPanel4\r\n          core={core}\r\n          config={config}\r\n          control={record}\r\n          actions={actions}\r\n          dispatch={dispatch}\r\n          activePanel={activePanel}\r\n          changeActivePanel={changeActivePanel}\r\n          printGroup={printGroup}\r\n          setPrintGroup={setPrintGroup}\r\n          printLayer={printLayer}\r\n          printDetails={printDetails}\r\n          finalPrints={finalPrints}\r\n          setFinalPrints={setFinalPrints}\r\n          fields={fields}\r\n          geometries={geometries}\r\n        />\r\n      : null}\r\n\r\n      {activePanel === \"p2-item\" ?\r\n        <PrintPanelItem\r\n          core={core}\r\n          standalone={standalone}\r\n          config={config}\r\n          control={record}\r\n          actions={actions}\r\n          dispatch={dispatch}\r\n          activePanel={activePanel}\r\n          changeActivePanel={changeActivePanel}\r\n          printItem={printItem}\r\n          setPrintItem={setPrintItem}\r\n          printLayer={printLayer}\r\n          printDetails={printDetails}\r\n          finalPrints={finalPrints}\r\n          setFinalPrints={setFinalPrints}\r\n          fields={fields}\r\n          handleFieldChange={handleFieldChange}           \r\n          geometries={geometries}\r\n        />\r\n      : null}    \r\n\r\n    </div>\r\n  )\r\n\r\n}","import { useState } from \"react\";\r\n\r\nexport default function useFormFields(initialState) {\r\n  const [fields, setValues] = useState(initialState);\r\n\r\n  return [\r\n    fields,\r\n    function(event) {\r\n      setValues({\r\n        ...fields,\r\n        [event.target.id]: event.target.value\r\n      });\r\n    }\r\n  ];\r\n}","import React, { useState,useEffect } from 'react';\r\nimport { Button } from 'primereact/button'\r\nimport { Panel } from 'primereact/panel'\r\nimport { Dialog } from 'primereact/dialog'\r\nimport Print from './Print'\r\nimport './style.css'\r\n\r\n/**\r\n * Main menu component\r\n */\r\nexport function MainMenu({ className, core, config, actions, record }) {\r\n\r\n  const { viewer, dispatch, Models } = config;\r\n  const { getWindowSize, showOnPortal } = Models.Utils;\r\n\r\n  const [showPopup, setShowPopup] = useState(false);\r\n\r\n  const component_cfg = record.config_json || {};\r\n  const title = record.title || 'Imprimir';\r\n  const header = component_cfg.header || title;\r\n\r\n  const wsize = getWindowSize();\r\n  const isMobile = wsize[0] <= 768;\r\n\r\n  if (record.as === 'popup') {    \r\n    const closeLabel = component_cfg.closeLabel || \"Fechar\";    \r\n    return (\r\n      <React.Fragment>\r\n\r\n        <Button\r\n          title={title}\r\n          className={className}\r\n          icon=\"pi pi-print\"\r\n          style={{ margin: '0.5em 1em' }}\r\n          onClick={e => setShowPopup(true)}\r\n        />\r\n\r\n        {showOnPortal(<Dialog\r\n          header={header}\r\n          visible={showPopup}\r\n          style={{width: isMobile ? '90%' : '35vw' }} \r\n          modal\r\n          footer={(\r\n            <div className=\"p-grid\">\r\n              <div className=\"p-col\" style={{ textAlign: 'right'}}>\r\n                <Button label={closeLabel} onClick={e => setShowPopup(false)} />\r\n              </div>\r\n            </div>\r\n          )}          \r\n          onHide={e => setShowPopup(false)}>\r\n\r\n          <Print\r\n            core={core}\r\n            config={config}\r\n            actions={actions}\r\n            dispatch={dispatch}\r\n            record={record}\r\n          />\r\n\r\n        </Dialog>)}\r\n\r\n      </React.Fragment>\r\n    )\r\n  }  else {\r\n    return (\r\n      <Button\r\n        title={title}\r\n        className={className}\r\n        icon=\"pi pi-print\"\r\n        style={{ margin: '0.5em 1em' }}\r\n        onClick={e => config.dispatch(actions.viewer_set_selectedmenu(record.id))}\r\n      />\r\n    )\r\n  }\r\n}\r\n\r\nexport default function Main({ type, region, as, core, config, actions, record, utils }) {\r\n\r\n  const { viewer, dispatch, Models } = config;\r\n  const { selected_menu } = viewer.config_json;\r\n  const { getWindowSize, showOnPortal } = Models ? Models.Utils : utils;\r\n\r\n  const component_cfg = record.config_json || {};\r\n  const title = record.title || 'Imprimir';\r\n  const header = component_cfg.header || title;\r\n\r\n  const wsize = getWindowSize();\r\n  const isMobile = wsize[0] <= 768;\r\n\r\n  useEffect(() => {\r\n    if (selected_menu === record.id) dispatch(actions.viewer_set_exclusive_mapcontrol('Print'));\r\n  }, [selected_menu]);  \r\n\r\n  // Render content\r\n  function renderContent() {\r\n    return (\r\n      <div className=\"print\">\r\n\r\n        <Print\r\n          core={core}\r\n          config={config}\r\n          actions={actions}\r\n          dispatch={dispatch}\r\n          record={record}\r\n        />\r\n        \r\n      </div>\r\n    )\r\n  }\r\n\r\n  if (type === 'link' && region === record.links) {\r\n    return <Button\r\n      title={title}\r\n      icon=\"pi pi-print\"\r\n      className=\"p-button-rounded p-button-raised\"\r\n      onClick={e => {\r\n        dispatch(actions.viewer_set_selectedmenu(record.id));\r\n        dispatch(actions.layout_show_menu(!isMobile));\r\n      }}\r\n    />\r\n  }\r\n\r\n  if (as === 'panel') {\r\n    return (\r\n      <Panel header={header}>\r\n        { renderContent() }\r\n      </Panel>\r\n    )\r\n  }\r\n\r\n  return null;\r\n\r\n}","export const SEARCHLAYERS_SET_LAYER = 'SEARCHLAYERS_SET_LAYER';\r\n\r\nexport function searchlayers_set_layer(control, layer) {\r\n  const action = {\r\n    type: SEARCHLAYERS_SET_LAYER,\r\n    control,\r\n    layer\r\n  }\r\n  return action;\r\n}\r\n\r\nexport default {\r\n  SEARCHLAYERS_SET_LAYER,  \r\n  searchlayers_set_layer\r\n}\r\n\r\n","/*\r\nconst searchlayersReducer = (state = {}, action) => {\r\n  switch (action.type) {\r\n    case 'SEARCHLAYERS_SET_LAYER':\r\n      let l = {};\r\n      if (state[action.control]) {\r\n        l[action.control] = {...state[action.control], layers: [action.layer]};\r\n      } else {\r\n        l = {};\r\n        l[action.control] = { layers: [action.layer] }        \r\n      }\r\n      return Object.assign({}, {...state}, l)\r\n    default:\r\n      return state\r\n  }\r\n}\r\n\r\nexport default {\r\n  searchlayers: searchlayersReducer\r\n}\r\n*/\r\n\r\nconst reducer = {\r\n  'SEARCHLAYERS_SET_LAYER': (state, action) => { \r\n    let l = {};\r\n    if (state[action.control]) {\r\n      l[action.control] = {...state[action.control], layers: [action.layer]};\r\n    } else {\r\n      l = {};\r\n      l[action.control] = { layers: [action.layer] }        \r\n    }\r\n    return Object.assign({}, {...state}, l)\r\n  }\r\n}\r\n\r\nexport default {\r\n  searchlayers: reducer\r\n}","/*\r\n  The MIT License\r\n  Copyright (c) 2021 WKT-Sistemas de Informação\r\n  https://github.com/wkt/jsonforms\r\n  Permission is hereby granted, free of charge, to any person obtaining a copy\r\n  of this software and associated documentation files (the \"Software\"), to deal\r\n  in the Software without restriction, including without limitation the rights\r\n  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n  copies of the Software, and to permit persons to whom the Software is\r\n  furnished to do so, subject to the following conditions:\r\n  The above copyright notice and this permission notice shall be included in\r\n  all copies or substantial portions of the Software.\r\n  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n  THE SOFTWARE.\r\n*/\r\nimport isEmpty from 'lodash/isEmpty';\r\nimport React from 'react';\r\nimport { ComponentType } from 'react';\r\nimport Ajv from 'ajv';\r\nimport {\r\n  getAjv,\r\n  JsonFormsCellRendererRegistryEntry,\r\n  JsonFormsRendererRegistryEntry,\r\n  JsonSchema,\r\n  OwnPropsOfRenderer,\r\n  UISchemaElement\r\n} from '@jsonforms/core';\r\nimport { JsonFormsDispatch, useJsonForms } from '@jsonforms/react';\r\n\r\nexport const renderLayoutElements = (\r\n  elements,\r\n  schema,\r\n  path,\r\n  enabled,\r\n  renderers,\r\n  cells,\r\n  className\r\n) => {\r\n  return elements.map((child, index) => (\r\n    <div key={`${path}-${index}`} className={className ? `p-field ${className}` : 'p-field'}>\r\n      <JsonFormsDispatch\r\n        uischema={child}\r\n        schema={schema}\r\n        path={path}\r\n        enabled={enabled}\r\n        renderers={renderers}\r\n        cells={cells}\r\n      />\r\n    </div>\r\n  ));\r\n};\r\n\r\nexport const withAjvProps = (Component) =>\r\n    (props) => {\r\n    const ctx = useJsonForms();\r\n    const ajv = getAjv({jsonforms: {...ctx}});\r\n\r\n    return (<Component {...props} ajv={ajv} />);\r\n  };","/*\r\n  The MIT License\r\n  \r\n  Copyright (c) 2021 WKT-Sistemas de Informação\r\n  https://github.com/wkt/jsonforms\r\n  \r\n  Permission is hereby granted, free of charge, to any person obtaining a copy\r\n  of this software and associated documentation files (the \"Software\"), to deal\r\n  in the Software without restriction, including without limitation the rights\r\n  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n  copies of the Software, and to permit persons to whom the Software is\r\n  furnished to do so, subject to the following conditions:\r\n  \r\n  The above copyright notice and this permission notice shall be included in\r\n  all copies or substantial portions of the Software.\r\n  \r\n  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n  THE SOFTWARE.\r\n*/\r\nimport React from 'react';\r\nimport isEmpty from 'lodash/isEmpty';\r\nimport {\r\n  LayoutProps,\r\n  RankedTester,\r\n  rankWith,\r\n  uiTypeIs,\r\n  VerticalLayout,\r\n} from '@jsonforms/core';\r\nimport {\r\n  renderLayoutElements,\r\n  //PrimereactLayoutRenderer,\r\n  //PrimereactVLayoutRenderer,\r\n  PrimereactLayoutRendererProps\r\n} from '../util/layout';\r\nimport { withJsonFormsLayoutProps } from '@jsonforms/react';\r\n\r\n/**\r\n * Default tester for a vertical layout.\r\n * @type {RankedTester}\r\n */\r\n//export const materialVerticalLayoutTester: RankedTester = rankWith(\r\n  export const primereactVerticalLayoutTester = rankWith(\r\n  3,\r\n  uiTypeIs('VerticalLayout')\r\n);\r\n\r\n\r\n/*\r\nexport interface MaterialLayoutRendererProps extends OwnPropsOfRenderer {\r\n  elements: UISchemaElement[];\r\n  direction: 'row' | 'column';\r\n}\r\n*/\r\nconst PrimereactVerticalLayoutRendererComponent =\r\n  ({\r\n    visible,\r\n    elements,\r\n    schema,\r\n    path,\r\n    enabled,\r\n    direction,\r\n    renderers,\r\n    cells\r\n  //}: MaterialLayoutRendererProps) => {\r\n  }) => {\r\n    if (isEmpty(elements)) {\r\n      return null;\r\n    } else {\r\n      return (\r\n        <div className=\"p-fluid p-jsonform\">          \r\n          {renderLayoutElements(\r\n            elements,\r\n            schema,\r\n            path,\r\n            enabled,\r\n            renderers,\r\n            cells\r\n          )}\r\n        </div>\r\n      );\r\n    }\r\n  };\r\nexport const PrimereactLayoutRenderer = React.memo(PrimereactVerticalLayoutRendererComponent);\r\n\r\n\r\n//export const MaterialVerticalLayoutRenderer = ({ uischema, schema, path, enabled, visible, renderers, cells }: LayoutProps) => {\r\n  export const PrimereactVerticalLayoutRenderer = ({ uischema, schema, path, enabled, visible, renderers, cells }) => {\r\n  //const verticalLayout = uischema as VerticalLayout;\r\n  const verticalLayout = uischema;\r\n  //const childProps: MaterialLayoutRendererProps = {\r\n    const childProps = {\r\n    elements: verticalLayout.elements,\r\n    schema,\r\n    path,\r\n    enabled,\r\n    direction: 'column',\r\n    visible\r\n  };\r\n\r\n  //return <PrimereactLayoutRenderer {...childProps} renderers={renderers} cells={cells} />;\r\n  return <PrimereactVerticalLayoutRendererComponent {...childProps} renderers={renderers} cells={cells} />;  \r\n};\r\n\r\nexport default withJsonFormsLayoutProps(PrimereactVerticalLayoutRenderer);","/*\r\n  The MIT License\r\n  \r\n  Copyright (c) 2021 WKT-Sistemas de Informação\r\n  https://github.com/wkt/jsonforms\r\n  \r\n  Permission is hereby granted, free of charge, to any person obtaining a copy\r\n  of this software and associated documentation files (the \"Software\"), to deal\r\n  in the Software without restriction, including without limitation the rights\r\n  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n  copies of the Software, and to permit persons to whom the Software is\r\n  furnished to do so, subject to the following conditions:\r\n  \r\n  The above copyright notice and this permission notice shall be included in\r\n  all copies or substantial portions of the Software.\r\n  \r\n  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n  THE SOFTWARE.\r\n*/\r\nimport React from 'react';\r\nimport isEmpty from 'lodash/isEmpty';\r\nimport {\r\n  LayoutProps,\r\n  RankedTester,\r\n  rankWith,\r\n  uiTypeIs,\r\n  VerticalLayout,\r\n} from '@jsonforms/core';\r\nimport {\r\n  renderLayoutElements,\r\n  PrimereactLayoutRendererProps\r\n} from '../util/layout';\r\nimport { withJsonFormsLayoutProps } from '@jsonforms/react';\r\n\r\n/**\r\n * Default tester for a vertical layout.\r\n * @type {RankedTester}\r\n */\r\n  export const primereactHorizontalLayoutTester = rankWith(\r\n  3,\r\n  uiTypeIs('HorizontalLayout')\r\n);\r\n\r\nconst PrimereactHorizontalLayoutRendererComponent =\r\n  ({\r\n    visible,\r\n    elements,\r\n    schema,\r\n    path,\r\n    enabled,\r\n    direction,\r\n    renderers,\r\n    cells\r\n  }) => {\r\n    if (isEmpty(elements)) {\r\n      return null;\r\n    } else {\r\n      return (\r\n          <div className=\"p-fluid p-formgrid p-grid p-jsonform\">          \r\n            {renderLayoutElements(\r\n              elements,\r\n              schema,\r\n              path,\r\n              enabled,\r\n              renderers,\r\n              cells,\r\n              'p-col'\r\n            )}\r\n          </div>\r\n      );\r\n    }\r\n  };\r\nexport const PrimereactLayoutRenderer = React.memo(PrimereactHorizontalLayoutRendererComponent);\r\n\r\n\r\nexport const PrimereactHorizontalLayoutRenderer = ({ uischema, schema, path, enabled, visible, renderers, cells }) => {\r\n  const horizontalLayout = uischema;\r\n    const childProps = {\r\n    elements: horizontalLayout.elements,\r\n    schema,\r\n    path,\r\n    enabled,\r\n    direction: 'row',\r\n    visible\r\n  };\r\n\r\n  return <PrimereactHorizontalLayoutRendererComponent {...childProps} renderers={renderers} cells={cells} />;  \r\n};\r\n\r\nexport default withJsonFormsLayoutProps(PrimereactHorizontalLayoutRenderer);","export const isUrlAppOrigin = (url) => {\r\n  //Considers it is same origin if is relative path\r\n  if (url.indexOf('http') !== 0) return true;\r\n\r\n  //Check if is same origin\r\n  const url1 = new URL(window.location.href);\r\n  const url2 = new URL(url);\r\n  return (url1.origin === url2.origin);\r\n}\r\n\r\nexport const isUrlAppHostname = (url) => {\r\n  //Considers it is same origin if is relative path\r\n  if (url.indexOf('http') !== 0) return true;\r\n\r\n  //Check if is same origin\r\n  const url1 = new URL(window.location.href);\r\n  const url2 = new URL(url);\r\n  return (url1.hostname === url2.hostname);\r\n}\r\n\r\nexport const buildSchemaFromFeatureType = (data) => {\r\n\r\n  const properties = {};\r\n  \r\n  data.properties.forEach(p => {\r\n    switch (p.localType.toLowerCase()) {\r\n      case 'int':\r\n        properties[p.name] = { type: 'integer' }\r\n        break;\r\n      case 'number': //TODO: use correct field type name\r\n          properties[p.name] = { type: 'number' }\r\n          break;         \r\n      case 'bool':\r\n          properties[p.name] = { type: 'boolean' }\r\n          break;               \r\n      case 'string':\r\n        properties[p.name] = { type: 'string' }\r\n        break;\r\n      default:\r\n    }\r\n  });\r\n\r\n  const schema = {\r\n    \"type\": \"object\",\r\n    \"properties\": properties\r\n  }\r\n\r\n  return schema;\r\n}\r\n\r\nexport const buildUiSchemaFromSchema = (schema) => {\r\n  const elements = [];\r\n\r\n  Object.entries(schema.properties).forEach(([key, val]) => {\r\n    elements.push({ \r\n      \"type\": \"Control\",\r\n      \"scope\": `#/properties/${key}`\r\n    });\r\n  });\r\n\r\n  const uischema = {\r\n    \"type\": \"VerticalLayout\",\r\n    elements\r\n  }  \r\n\r\n  return uischema;\r\n}\r\n\r\nexport const getGeometryFieldFromFeatureType = (data) => {\r\n\r\n  let field = null;\r\n  \r\n  data.properties.forEach(p => {\r\n    if (p.localType.toLowerCase() === 'geometry') {\r\n      field = p.name;\r\n    }\r\n  });\r\n\r\n  return field;\r\n}","import {GeoJSON, WFS} from 'ol/format';\r\nimport {\r\n  and as andFilter,\r\n  equalTo as equalToFilter,\r\n  like as likeFilter\r\n} from 'ol/format/filter';\r\nimport {  isUrlAppOrigin, isUrlAppHostname,\r\n  getGeometryFieldFromFeatureType, buildSchemaFromFeatureType, buildUiSchemaFromSchema } from './utils';\r\n\r\nexport const getDescribeFeatureType = (options) => {\r\n  const { core, cfg, viewer, auth } = options;\r\n\r\n  const featureType = `${cfg.feature_prefix}:${cfg.feature_type}`;\r\n  let url = cfg.source_url + (cfg.source_url.indexOf('?') > -1 ? '' : '?');\r\n  url = `${url}&service=WFS&version=2.0.0&request=DescribeFeatureType&typeName=${featureType}&outputFormat=application/json`\r\n\r\n  //Add user authentication token\r\n  if (isUrlAppHostname(url) && viewer.integrated_authentication) {\r\n    if (auth && auth.data && auth.data.auth_token) {\r\n      const authkey = viewer?.integrated_authentication_key || 'authkey';\r\n      url = url + '&' + authkey + '=' + auth.data.auth_token;\r\n    }\r\n  }\r\n\r\n  if (!isUrlAppOrigin(url)) {\r\n    url = core.MAP_PROXY_URL + encodeURIComponent(url);\r\n  }\r\n\r\n  return fetch(url).then(res => {\r\n    return res.json();\r\n  }).then(result => {\r\n    const sch = buildSchemaFromFeatureType(result.featureTypes[0]);\r\n    const uisch = buildUiSchemaFromSchema(sch);\r\n    const geometry_field = getGeometryFieldFromFeatureType(result.featureTypes[0]);\r\n\r\n    const data = {\r\n      schema: sch,\r\n      uischema: uisch,\r\n      geometry_field: geometry_field\r\n    }\r\n\r\n    return Promise.resolve(data);    \r\n\r\n  }).catch(error => {\r\n    return Promise.reject(error);\r\n  });\r\n};\r\n\r\nexport const getFeatures = (options) => {\r\n\r\n  const {core, cfg, schema, startIndex, maxFeatures, filter, sort, viewer, auth} = options;\r\n\r\n  let url = cfg.source_url + (cfg.source_url.indexOf('?') > -1 ? '' : '?');\r\n\r\n  //Add user authentication token\r\n  if (isUrlAppHostname(url) && viewer.integrated_authentication) {\r\n    if (auth && auth.data && auth.data.auth_token) {\r\n      const authkey = viewer?.integrated_authentication_key || 'authkey';\r\n      url = url + '&' + authkey + '=' + auth.data.auth_token;\r\n    }\r\n  }\r\n\r\n  if (!isUrlAppOrigin(url)) {\r\n    url = core.MAP_PROXY_URL + encodeURIComponent(url);\r\n  }\r\n\r\n  const requestOptions = {\r\n    srsName: 'EPSG:4326',\r\n    featureNS: cfg.feature_namespace,\r\n    featurePrefix: cfg.feature_prefix,\r\n    featureTypes: [cfg.feature_type],\r\n    outputFormat: 'application/json'\r\n    //startIndex,\r\n    //maxFeatures,\r\n    //sortBy: 'distrito+D',\r\n    /*\r\n    filter: andFilter(\r\n      likeFilter('code', '08*'),\r\n      equalToFilter('unity', 'conc')\r\n    )\r\n    */\r\n  }\r\n\r\n  if (startIndex != null) {\r\n    requestOptions[\"startIndex\"] = startIndex;\r\n  }\r\n  if (maxFeatures != null) {\r\n    requestOptions[\"maxFeatures\"] = maxFeatures;\r\n  }\r\n  \r\n  let fields = null;\r\n  if (cfg.fields_list && Object.keys(cfg.fields_list).length > 0) {\r\n    fields = Object.keys(cfg.fields_list);\r\n  } else if (schema && schema.properties && Object.keys(schema.properties).length > 0) {\r\n    fields = Object.keys(schema.properties);\r\n  }\r\n  if (fields) {\r\n    if (cfg.all_geometries === true && cfg.geometry_field) {\r\n      if (Object.keys(fields).indexOf(cfg.geometry_field) === -1) fields.push(cfg.geometry_field);\r\n    }\r\n    requestOptions['propertyNames'] = fields;\r\n  }\r\n\r\n  if (filter && Object.keys(filter).length > 0) {\r\n    const conditions =[];\r\n    Object.entries(filter).forEach(([key, value]) => {\r\n      if (value) {\r\n        if (schema && schema.properties && schema.properties[key]) {\r\n          if (schema.properties[key].type === 'integer') {\r\n            conditions.push(equalToFilter(key, value));\r\n          } else {\r\n            conditions.push(likeFilter(key, value, '*', '.','!', false));\r\n          }\r\n        } else {\r\n          conditions.push(likeFilter(key, value, '*', '.','!', false));\r\n        }\r\n      }\r\n    });\r\n\r\n    let wfsFilter = null;\r\n    if (conditions.length === 1) {\r\n      wfsFilter = conditions[0];\r\n    } else if (conditions.length > 1) {\r\n      wfsFilter = andFilter(...conditions);\r\n    }\r\n\r\n    if (wfsFilter) {\r\n      requestOptions['filter'] = wfsFilter;\r\n    }\r\n  }\r\n\r\n  // generate a GetFeature request\r\n  const featureRequest = new WFS().writeGetFeature(requestOptions);\r\n  const ogcNS = 'http://www.opengis.net/ogc';\r\n  featureRequest.setAttribute('xmlns:ogc', ogcNS);\r\n\r\n  const xmlSerializer = new XMLSerializer();\r\n  \r\n  let body = xmlSerializer.serializeToString(featureRequest);\r\n\r\n  let new_sort = null;\r\n  if (sort && Object.keys(sort).length > 0) {\r\n    new_sort = {...sort};\r\n  } else if (cfg.sort && Object.keys(cfg.sort).length > 0) {\r\n    new_sort = {...cfg.sort}\r\n  }\r\n  if(new_sort && Object.keys(new_sort).length > 0) {\r\n    const parser = new DOMParser();\r\n    const xmlDoc = parser.parseFromString(body, 'text/xml');\r\n    const parent = xmlDoc.getElementsByTagName(\"Query\")[0];\r\n\r\n    const sortElem = xmlDoc.createElementNS(ogcNS, 'ogc:SortBy');\r\n\r\n    Object.entries(new_sort).forEach(([key, value]) => {\r\n      const sortPropertyElem = xmlDoc.createElementNS(ogcNS, 'ogc:SortProperty');\r\n    \r\n      const propertyNameElem = xmlDoc.createElementNS(ogcNS, 'ogc:PropertyName');\r\n      propertyNameElem.appendChild(xmlDoc.createTextNode(key));\r\n  \r\n      const sortOrderElem = xmlDoc.createElementNS(ogcNS, 'ogc:SortOrder');\r\n      sortOrderElem.appendChild(xmlDoc.createTextNode(value));\r\n  \r\n      sortPropertyElem.appendChild(propertyNameElem);\r\n      sortPropertyElem.appendChild( sortOrderElem);\r\n\r\n      sortElem.appendChild(sortPropertyElem);\r\n    })\r\n\r\n    parent.appendChild(sortElem);\r\n    body = xmlSerializer.serializeToString(xmlDoc);\r\n\r\n  }\r\n\r\n  // then post the request and add the received features to a layer\r\n  return fetch(url, {\r\n    method: 'POST',\r\n    body,\r\n  })\r\n  .then(function (response) {\r\n    return response.json();\r\n  })\r\n  .then(function (json) {\r\n    const features = new GeoJSON().readFeatures(json);\r\n    return Promise.resolve({features, total: json.totalFeatures}); \r\n  }).catch(error => {\r\n    return Promise.reject(error);\r\n  });\r\n\r\n}\r\n\r\n\r\nexport const getFeatureById = (options) => {\r\n\r\n  const { core, viewer, auth, cfg, featureId, crs = 'EPSG:4326', format = 'application/json'} = options;\r\n\r\n  let url = cfg.source_url;\r\n  url += url.indexOf('?') < 0 ? '?' : '';\r\n  url += '&service=WFS';\r\n  url += '&request=GetFeature';\r\n  url += '&typeNames=' + (cfg.feature_prefix ? cfg.feature_prefix + ':' +  cfg.feature_type : cfg.feature_type);\r\n  url += '&featureID=' + featureId;\r\n  url += '&srsName=' + crs;\r\n  url += '&outputFormat=' + format;\r\n\r\n  //Add user authentication token\r\n  if (isUrlAppHostname(url) && viewer.integrated_authentication) {\r\n    if (auth && auth.data && auth.data.auth_token) {\r\n      const authkey = viewer?.integrated_authentication_key || 'authkey';\r\n      url = url + '&' + authkey + '=' + auth.data.auth_token;\r\n    }\r\n  }\r\n\r\n  if (!isUrlAppOrigin(url)) {\r\n    url = core.MAP_PROXY_URL + encodeURIComponent(url);\r\n  }\r\n\r\n  return fetch(url).then(res => {\r\n    return res.json();\r\n  }).then(result => {\r\n    return Promise.resolve(result);\r\n  }).catch(error => {\r\n    return Promise.reject(error);\r\n  });\r\n}","import React, { useState, useEffect } from 'react';\r\nimport { DataTable } from 'primereact/datatable';\r\nimport { Column } from 'primereact/column';\r\nimport { Paginator } from 'primereact/paginator';\r\nimport { Button } from 'primereact/button';\r\nimport { Dropdown } from 'primereact/dropdown';\r\nimport OlFormatGeoJSON from 'ol/format/GeoJSON';\r\nimport OlFeature from 'ol/Feature';\r\nimport {getCenter as olGetCenter} from 'ol/extent';\r\nimport { getFeatureById } from './service';\r\n\r\nexport default function SearchLayerResults(props) {\r\n\r\n  const { core, viewer, auth, actions, dispatch, mainMap, layer, searchConfig, doSearch, results } = props;\r\n  const { publish, subscribe } = props.pubsub ? props.pubsub : {}\r\n\r\n  const [data, setData] = useState([]);\r\n  const [columns, setColumns] = useState([]);\r\n  const [totalRecords, setTotalRecords] = useState(null);\r\n  const [sortField, setSortField] = useState(null);\r\n  const [sortOrder, setSortOrder] = useState(null);\r\n\r\n  useEffect(() => {    \r\n    if (!results && !results.features && !results.features.length > 0) {\r\n      setData([]);\r\n      setColumns([]);\r\n      setSortField(null);\r\n      setSortOrder(null);\r\n      return;\r\n    }   \r\n\r\n    const new_data = [];\r\n    results.features.forEach(f => {\r\n      let properties = f.getProperties(); //(({ geometry, ...o }) => o)(f.getProperties()); // remove geometry field\r\n      properties = { id_: f.getId(), ...properties }\r\n      new_data.push(properties);\r\n    });\r\n\r\n    let new_cols = [];\r\n    if (results &&  results.features && results.features.length > 0) {\r\n        new_cols = results.features[0].getKeys().filter(k => k.toLowerCase() !== 'geometry')\r\n    }\r\n\r\n    setData(new_data);\r\n    setColumns(new_cols);\r\n\r\n    if ((results.startIndex === 0 && results.total < results.maxFeatures) ||  results.total >= results.maxFeatures) {\r\n      setTotalRecords(results.total);\r\n    }\r\n    if (results.sort && Object.keys(results.sort).length > 0) {\r\n      const fieldName = Object.keys(results.sort)[0];\r\n      setSortField(fieldName);\r\n      setSortOrder(results.sort[fieldName] === 'ASC' ? 1 : -1);\r\n    }\r\n\r\n  }, [results]);\r\n\r\n  // Zoom to layer features\r\n  function zoomLayerFeatures() {\r\n    let extent = layer.current.getSource().getExtent();\r\n    if (extent) {\r\n      const bufferValue = 500;\r\n      extent = [\r\n        extent[0] - bufferValue,\r\n        extent[1] - bufferValue,\r\n        extent[2] + bufferValue,\r\n        extent[3] + bufferValue\r\n      ];\r\n      dispatch(actions.map_set_extent(olGetCenter(extent), extent));\r\n    }\r\n  }\r\n\r\n  const zoomActionTemplate = (rowData) => {\r\n    return (\r\n        <React.Fragment>\r\n            <Button icon=\"pi pi-search\" className=\"p-button-rounded p-button-text p-mr-2\" \r\n              onClick={() => { \r\n                layer.current.getSource().clear();\r\n                if (rowData.geometry == null) {\r\n                  getFeatureById({cfg: searchConfig, featureId: rowData['id_'], core, viewer, auth}).then(d => {                   \r\n                    if (!d.features || !d.features.length > 0) return;                \r\n                    const options = {\r\n                      dataProjection: 'EPSG:4326',\r\n                      featureProjection: mainMap.getView().getProjection().getCode()\r\n                    }\r\n                    const features = new OlFormatGeoJSON(options).readFeatures(d);\r\n                    layer.current.getSource().addFeatures(features);                      \r\n                    zoomLayerFeatures();\r\n                  });\r\n                } else {\r\n                  const geom = rowData.geometry.clone().transform('EPSG:4326',mainMap.getView().getProjection().getCode());\r\n                  const feature = new OlFeature({...rowData, geometry: geom});\r\n                  feature.setId(rowData.id_);\r\n                  layer.current.getSource().addFeature(feature);\r\n                  zoomLayerFeatures();\r\n                }                \r\n              }} />\r\n        </React.Fragment>\r\n    );\r\n  }\r\n  \r\n  const paginatorTemplate = {\r\n    layout: 'RowsPerPageDropdown CurrentPageReport',\r\n    'RowsPerPageDropdown': (options) => {\r\n        const dropdownOptions = [\r\n            { label: 10, value: 10 },\r\n            { label: 20, value: 20 },\r\n            { label: 50, value: 50 }\r\n        ];\r\n\r\n        return (\r\n          <>\r\n              <span className=\"p-mx-1\" style={{ color: 'var(--text-color)', userSelect: 'none' }}>Registos: </span>\r\n              <Dropdown value={results.maxFeatures} options={dropdownOptions} onChange={(e) => doSearch(0, e.value, results.filter, results.sort)} />\r\n          </>\r\n        );\r\n    },\r\n    'CurrentPageReport': (options) => {\r\n        return (\r\n            <span style={{ color: 'var(--text-color)', userSelect: 'none', width: '120px', textAlign: 'center' }}>\r\n                {results.startIndex + 1} - {results.startIndex + data.length} de {options.totalRecords}\r\n            </span>\r\n        )\r\n    }\r\n  };\r\n\r\n  const totalPaginatorTemplate = {\r\n    layout: 'CurrentPageReport',\r\n    'CurrentPageReport': (options) => {\r\n        return (\r\n            <span style={{ color: 'var(--text-color)', userSelect: 'none', width: '120px', textAlign: 'center' }}>\r\n                {options.totalRecords} registos\r\n            </span>\r\n        )\r\n    }\r\n  };\r\n  \r\n  const showPagination = () => {\r\n    let show = (searchConfig.pagination == null || searchConfig.pagination === true);\r\n    if (results && results.startIndex === 0 && results.total <= 1) {\r\n      show = false;\r\n    }\r\n    return show;\r\n  }\r\n\r\n  const getPaginator = () => {\r\n    return {\r\n      paginator: showPagination(),\r\n      paginatorTemplate: searchConfig.pagination === false ? totalPaginatorTemplate : paginatorTemplate\r\n    }\r\n  }\r\n\r\n  const htmlTemplate = (rowData, field) => {\r\n    let new_value = field.value ? field.value : rowData[field.name];\r\n    const rf = (new_value && new_value.match) ? new_value.match(/[^{}]+(?=})/g) : null;\r\n    if (rf) {\r\n      rf.forEach(fld => {\r\n        new_value = new_value.replace(`{${fld}}`, rowData[fld] || '');      \r\n      });                 \r\n    }    \r\n    return <div dangerouslySetInnerHTML={{__html: new_value}} />;\r\n  }\r\n\r\n  const actionTemplate = (rowData, field) => {\r\n    const action = {...field.action};\r\n\r\n    if (field.action.data) {\r\n      const new_data = {}\r\n      Object.entries(field.action.data).forEach(([key, value]) => {                                    \r\n        new_data[key] = formatTemplateValue(rowData, value);\r\n      });\r\n      action.data = new_data;\r\n    }\r\n\r\n    //Replace label value\r\n    let label = action.icon ? action.label : action.label || 'Abrir';\r\n    label = formatTemplateValue(rowData, label);  \r\n\r\n    //Replace tooltip value\r\n    let tooltip = action.tooltip;\r\n    tooltip = formatTemplateValue(rowData, tooltip);\r\n\r\n    //Replace value\r\n    let new_value = field.value ? field.value : rowData[field.name];\r\n    new_value = formatTemplateValue(rowData, new_value);    \r\n\r\n    if (action.show_null === true || new_value != null) {\r\n      return <Button label={label} icon={action.icon}\r\n          className={action.classname || action.className}\r\n          title={tooltip}\r\n          onClick={(e) => publish(action.type, action.data)}\r\n        />\r\n    }\r\n    \r\n    return null;\r\n\r\n  }\r\n\r\n  const valueTemplate = (rowData, field) => {\r\n    let new_value = field.value ? field.value : rowData[field.name];\r\n    const rf = (new_value && new_value.match) ? new_value.match(/[^{}]+(?=})/g) : null;\r\n    if (rf) {\r\n      rf.forEach(fld => {\r\n        new_value = new_value.replace(`{${fld}}`, rowData[fld] || '');      \r\n      });                 \r\n    }\r\n    return new_value;\r\n  }\r\n\r\n  const formatTemplateValue = (rowData, value) => {\r\n    let new_value = value;\r\n\r\n    const rf = (new_value && new_value.match) ? new_value.match(/[^{}]+(?=})/g) : null;\r\n    if (rf) {\r\n      if (rf.length === 1) {\r\n        const fld = rf[0];\r\n        if (fld in rowData) {\r\n          new_value = rowData[fld];\r\n        }\r\n      } else {\r\n        rf.forEach(fld => {\r\n          new_value = new_value.replace(`{${fld}}`, rowData[fld] || '');      \r\n        });\r\n      }\r\n    }\r\n   \r\n    return new_value;\r\n  }\r\n\r\n  const buildColumns = (cfg, columns) => {\r\n    let cols = [];\r\n    if (cfg.fields_list && Object.keys(cfg.fields_list).length > 0) {      \r\n      cols = Object.entries(cfg.fields_list).map(([k, f]) => {\r\n        return [k, f.label || k];\r\n      })\r\n    } else {\r\n      cols = columns.map(f => [f, f]);\r\n    }\r\n\r\n    return cols.map((f, i) => {\r\n      const sortable = cfg.fields_sort && cfg.fields_sort.length > 0 && cfg.fields_sort.includes(f[0]);\r\n\r\n      const field_cfg = cfg.fields_list[f[0]];\r\n\r\n      if (field_cfg) {\r\n        if (field_cfg.type === 'html') {\r\n          return <Column key={i+1} field={f[0]} header={f[1]} sortable={sortable} \r\n            body={(rowData) => htmlTemplate(rowData, {...field_cfg, 'name': f[0]})} />\r\n        } else if (field_cfg.type === 'action') {\r\n          return <Column key={i+1} field={f[0]} header={f[1]} sortable={sortable} \r\n            body={(rowData) => actionTemplate(rowData, {...field_cfg, 'name': f[0]})} />\r\n        } else {\r\n          return <Column key={i+1} field={f[0]} header={f[1]} sortable={sortable} \r\n            body={(rowData) => valueTemplate(rowData, {...field_cfg, 'name': f[0]})} />\r\n        }\r\n      }\r\n\r\n      return <Column key={i+1} field={f[0]} header={f[1]} sortable={sortable} />\r\n\r\n    });\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <DataTable value={data} lazy\r\n        {...getPaginator()} \r\n        first={results.startIndex} \r\n        rows={results.maxFeatures} totalRecords={totalRecords}\r\n        sortField={sortField} sortOrder={sortOrder}\r\n        onSort={(e) => {\r\n          const new_sort = {};\r\n          new_sort[e.sortField] = e.sortOrder === 1 ? 'ASC' : 'DESC'\r\n          doSearch(0, results.maxFeatures, results.filter, new_sort);\r\n        }}\r\n        paginatorClassName=\"p-jc-end\" className=\"p-mt-4\"> \r\n        {(columns && columns.length > 0) && <Column key={0} body={zoomActionTemplate} style={{width: '30px'}} />}\r\n        {buildColumns(searchConfig, columns).map(c => c)}\r\n      </DataTable>\r\n      \r\n      { showPagination() &&\r\n        <Paginator first={results.startIndex} rows={results.maxFeatures} totalRecords={totalRecords} pageLinkSize={3} \r\n          onPageChange={e => {\r\n              doSearch(e.first, results.maxFeatures, results.filter, results.sort);\r\n          }} \r\n          style={{fontSize: \".8rem\"}}></Paginator>\r\n      }\r\n    </>\r\n\r\n  )\r\n\r\n}","import React, { useState, useEffect } from 'react';\r\nimport { Button } from 'primereact/button';\r\nimport { Toast } from 'primereact/toast';\r\nimport { Message } from 'primereact/message';\r\nimport { JsonForms } from '@jsonforms/react';\r\nimport { vanillaCells, vanillaRenderers } from '@jsonforms/vanilla-renderers';\r\n\r\nimport PrimereactVerticalLayoutRenderer, { primereactVerticalLayoutTester } from './renderes/layouts/PrimereactVerticalLayoutRenderer';\r\nimport PrimereactHorizontalLayoutRenderer, { primereactHorizontalLayoutTester } from './renderes/layouts/PrimereactHorizontalLayoutRenderer';\r\n\r\nimport { getDescribeFeatureType, getFeatures } from './service';\r\nimport SearchLayerResults from './SearchLayerResults';\r\n\r\nlet toastEl = null;\r\n\r\nconst renderers = [\r\n  ...vanillaRenderers,\r\n  //register custom renderers\r\n  { tester: primereactVerticalLayoutTester, renderer: PrimereactVerticalLayoutRenderer },\r\n  { tester: primereactHorizontalLayoutTester, renderer: PrimereactHorizontalLayoutRenderer }\r\n];\r\n\r\nexport default function SearchLayerForm(props) {\r\n  const {core, viewer, auth, actions, pubsub, dispatch, mainMap, Models, layers, layer, \r\n    searchConfig, schemaConfig, updateLayerSchema, goPanelSearchPrev} = props;\r\n  const { showOnPortal } = Models.Utils;\r\n  \r\n  const {schema={}, uischema={}, geometry_field} = schemaConfig || {};\r\n\r\n  const id = searchConfig?.id;\r\n\r\n  const [loaded, setLoaded] = useState(false);\r\n  const [errorSchema, setErrorSchema] = useState(null);\r\n  const [formData, setFormData] = useState({});\r\n  const [results, setResults] = useState({});\r\n\r\n  useEffect(() => {    \r\n    setErrorSchema(null);\r\n\r\n    if (schema && Object.keys(schema).length > 0 && uischema && Object.keys(uischema).length) {\r\n      setLoaded(true);\r\n      return;\r\n    }\r\n\r\n    setLoaded(false);\r\n\r\n    props.setBlockedPanel(true);\r\n\r\n    getDescribeFeatureType({cfg: searchConfig, core, viewer, auth}).then(data => {\r\n      try {\r\n        updateLayerSchema(id, data);\r\n      } catch (err) {\r\n        return Promise.reject(err);\r\n      }\r\n      setLoaded(true);\r\n    }).catch(error => {      \r\n      console.log(error);\r\n      setErrorSchema({message:'Não foi possível obter informação do tema'});\r\n    }).finally(()=> {\r\n      props.setBlockedPanel(false);\r\n    });\r\n  }, [id]);\r\n\r\n  const doSearch = (startIndex=0, maxFeatures, filter, sort) => {\r\n    let start = null;\r\n    let numRecords = null;\r\n  \r\n    if (searchConfig.pagination == null || searchConfig.pagination === true) {\r\n      start = startIndex;\r\n      numRecords = maxFeatures || searchConfig.maxFeatures || 10;\r\n    }\r\n\r\n    const cfg = {geometry_field, ...searchConfig};\r\n\r\n    props.setBlockedPanel(true);\r\n\r\n    getFeatures({core, cfg, schema, startIndex: start, maxFeatures: numRecords, filter, sort, viewer, auth}).then(data=> {\r\n      const new_results = {...results};\r\n      new_results[id] ={\r\n        filter: filter || {},\r\n        sort: sort || {},\r\n        startIndex, \r\n        maxFeatures: numRecords, \r\n        total: data.total, \r\n        features: data.features        \r\n      };\r\n      if (layer && layer.current) layer.current.getSource().clear();\r\n      setResults(new_results);\r\n    }).catch(error => {\r\n      console.log(error);\r\n      toastEl.show({\r\n        severity: 'error',\r\n        summary: 'Ocorreu um erro',\r\n        detail: 'Não foi possível realizar a pesquisa',\r\n        sticky: true\r\n      });      \r\n    }).finally(()=> props.setBlockedPanel(false));\r\n  }\r\n  \r\n  return (\r\n    <>\r\n      {showOnPortal(<Toast ref={(el) => toastEl = el} />)}\r\n\r\n      {goPanelSearchPrev && <div className=\"p-mt-2\">\r\n        <div className=\"p-grid\">\r\n          <div className=\"p-col p-text-left\">\r\n            <Button\r\n                label=\"Voltar\"\r\n                icon=\"pi pi-chevron-left\"\r\n                className=\"p-button-sm\"\r\n                onClick={e => { goPanelSearchPrev(); }}\r\n            />\r\n          </div>\r\n        </div>  \r\n      </div>}\r\n\r\n      <div className=\"p-mt-2\">{searchConfig.title}</div>        \r\n      <hr />\r\n\r\n      { errorSchema && <React.Fragment>\r\n        <Message\r\n          severity=\"warn\"\r\n          text={errorSchema.message} \r\n        />\r\n      </React.Fragment> }\r\n\r\n      { loaded && <React.Fragment>\r\n        <div className=\"p-mt-3\">\r\n          <JsonForms\r\n            schema={schema}\r\n            uischema={uischema}\r\n            data={formData[id]}\r\n            renderers={renderers}\r\n            cells={vanillaCells}\r\n            onChange={({ data, _errors }) => {\r\n              const new_formdata = {...formData};\r\n              new_formdata[id] = data;\r\n              setFormData(new_formdata);\r\n            }}\r\n          />       \r\n        </div>\r\n\r\n        <div className=\"p-text-center\">\r\n          <Button onClick={() => {\r\n            const new_formdata = {...formData};\r\n            new_formdata[id] = {};\r\n            setFormData(new_formdata);\r\n            const new_results = {...results};\r\n            new_results[id] = null;\r\n            setResults(new_results);\r\n            if (layer && layer.current) layer.current.getSource().clear();\r\n            }}\r\n            className=\"p-mr-2\"\r\n            color='primary'>\r\n            Limpar\r\n          </Button>\r\n          <Button onClick={(e) => {\r\n              const getFormData = (schema, formData, template) => {\r\n                if (!formData || ! template) return formData;\r\n\r\n                //Get filled form fields\r\n                const formvalues = {};\r\n                Object.entries(formData).forEach(([k, v]) => {\r\n                  const val = (typeof v == 'number' && Number.isNaN(v)) ? null : v + '';\r\n                  if (val !== null && val !== '') {\r\n                    formvalues[k] = v;\r\n                  }\r\n                });             \r\n                \r\n                //Apply expression to filled form fields values\r\n                const fielddata = Object.entries(formvalues).map(([k, v]) => {\r\n                  let final_value = v;\r\n                  if (k in template && template[k].expression) {\r\n                    final_value = template[k].expression.replace('{value}', v);                 \r\n                    Object.entries(formvalues).forEach(([f, z]) => {\r\n                      final_value = final_value.replace('{' + f + '}', z);\r\n                    });\r\n                  }\r\n                  return {[k]: final_value};\r\n                }).reduce((obj, val) => {\r\n                  return Object.assign(obj, val);\r\n                }, {});\r\n\r\n                //Apply expression to virtual form fields\r\n                const virtualdata = Object.entries(template).filter(([k, v]) => {\r\n                  //Exclude form fields\r\n                  return !(k in (formData || {})) && !(k in (schema?.properties || {}));\r\n                }).map(([k, v]) => {\r\n                  let final_value = v.expression;\r\n                  Object.entries(formvalues).forEach(([f, z]) => {\r\n                    final_value = final_value.replace('{' + f + '}', z);\r\n                  });                \r\n                  return { [k]: final_value};\r\n                }).reduce((obj, val) => {\r\n                  return Object.assign(obj, val);\r\n                }, {});\r\n\r\n                const data = {...virtualdata, ...fielddata};\r\n                return data;\r\n              }\r\n              \r\n              //Combine values of form and virtual fields\r\n              const data = getFormData(schema, formData[id], searchConfig.fields_form);\r\n              doSearch(0, null, data);\r\n\r\n          }} color='primary'>\r\n            Pesquisar\r\n          </Button> \r\n        </div>\r\n\r\n        {(results && results[id] && results[id].total === 0) &&\r\n          <div className=\"p-mt-4\" style={{textAlign: 'center'}}>\r\n            <Message\r\n              severity=\"info\"\r\n              text='Pesquisa sem resultados'\r\n            />\r\n          </div>\r\n        }\r\n\r\n        {(results && results[id] && results[id].total > 0) &&\r\n          <SearchLayerResults\r\n            core={core}\r\n            viewer={viewer}\r\n            auth={auth}          \r\n            actions={actions}\r\n            pubsub={pubsub}\r\n            dispatch={dispatch}\r\n            mainMap={mainMap}\r\n            layers={layers}\r\n            layer={layer}\r\n            searchConfig={searchConfig}\r\n            results={results[id]}\r\n            doSearch={doSearch}\r\n          />\r\n        }\r\n      </React.Fragment> }  \r\n    </>\r\n  )\r\n\r\n}","import React, { useState, useEffect } from 'react'\r\nimport { Card } from 'primereact/card';\r\nimport classNames from 'classnames'\r\nimport SearchLayerForm from './SearchLayerForm';\r\n\r\nexport default function SearchLayers(props) {\r\n  const { core, config, layer, layers, actions, pubsub, dispatch, mainMap, Models, record } = props;\r\n  const { viewer, auth } = config;\r\n  const component_cfg = record.config_json ? { show_icon: true, ...record.config_json } : { show_icon: true};\r\n  const { show_icon } = component_cfg;\r\n\r\n  const [active, setActive] = useState(null);\r\n  const [schemas, setSchemas] = useState({});\r\n\r\n  useEffect(() => {\r\n    if (layers.length === 1 && !component_cfg.show_main) {\r\n      setActive(layers[0]);\r\n    }\r\n  }, [layers, component_cfg.show_main]);\r\n\r\n  const updateLayerSchema = (id, data) => {\r\n    const sch = {...schemas};\r\n    sch[id] = data;\r\n    setSchemas(sch);\r\n  }\r\n\r\n  if (active) {\r\n    let schemaConfig = null;\r\n\r\n    if (active.schema) {\r\n      schemaConfig = {\r\n        schema: {...active.schema},\r\n        uischema: {...active.uischema}\r\n      }\r\n    }\r\n    \r\n    if (schemas[active.id]) {\r\n      schemaConfig = {...schemas[active.id]};\r\n    }\r\n\r\n    const showPanelPrev = (\r\n      (component_cfg.layers && component_cfg.layers.length > 1) || component_cfg.show_main === true\r\n      ) ? true : false;\r\n\r\n    return <SearchLayerForm\r\n      core={core}\r\n      viewer={viewer}\r\n      auth={auth}\r\n      actions={actions}\r\n      pubsub={pubsub}\r\n      dispatch={dispatch}\r\n      mainMap={mainMap}\r\n      Models={Models}\r\n      layers={layers}\r\n      layer={layer}\r\n      searchConfig={active}\r\n      schemaConfig={schemaConfig}\r\n      updateLayerSchema={updateLayerSchema}\r\n      goPanelSearchPrev={showPanelPrev && ((e) => \r\n        {\r\n          layer.current.getSource().clear();\r\n          setActive(null);\r\n        }\r\n      )}\r\n      setBlockedPanel={props.setBlockedPanel}\r\n    />\r\n  }\r\n\r\n  if ((component_cfg.layers && component_cfg.layers.length > 1) || component_cfg.show_main === true) {\r\n    return (\r\n      <div>\r\n        {component_cfg.layers.map((l, i) => {\r\n\r\n          const iconClass = {\r\n            \"pi\": !l.icon,\r\n            \"p-mt-3\": true\r\n          }\r\n          iconClass[l.icon] = l.icon ? true : false;\r\n          iconClass['pi-bars'] = l.icon ? false : true;\r\n          \r\n          const icon = <div style={{ cursor: 'pointer'}} title={l.tooltip} \r\n            onClick={e => setActive(l)}>\r\n            <i className={classNames(iconClass)} style={{fontSize: '3em'}}></i>\r\n          </div>\r\n          const title = <div style={{ cursor: 'pointer'}} title={l.tooltip} \r\n            onClick={e => setActive(l)}>\r\n            {l.title}\r\n          </div>\r\n\r\n          return <Card key={i} header={show_icon && icon} title={title} subTitle={l.subtitle && l.subtitle} style={{ marginBottom: '2em' }} \r\n            onClick={e => console.log(e)}>\r\n              <div className=\"p-m-0\" dangerouslySetInnerHTML={{__html: l.description || ''}}></div>\r\n            </Card>\r\n        })}\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <></>\r\n  )\r\n}","import OLGroupLayer from 'ol/layer/Group'\r\nimport OlLayerVector from 'ol/layer/Vector';\r\nimport OlSourceVector from 'ol/source/Vector';\r\nimport OlFormatGeoJSON from 'ol/format/GeoJSON';\r\nimport {Circle as OlStyleCircle, Fill as OlStyleFill, Stroke as OlStyleStroke, \r\n  Style as OlStyle} from 'ol/style';\r\n  \r\nconst defaultStyle = new OlStyle({\r\n  stroke: new OlStyleStroke({\r\n    color: '#ff0000',\r\n    width: 3,\r\n  }),\r\n  image: new OlStyleCircle({\r\n    radius: 4,\r\n    fill: new OlStyleFill({\r\n      color: '#ff0000',\r\n    }),\r\n    stroke: new OlStyleStroke({\r\n      color: '#fff',\r\n      width: 2,\r\n    }),\r\n  })\r\n});\r\n\r\nexport function createLayer(layer, layerId, map, style) { // new: vector type \r\n  const l = findOlLayer(layerId, map);\r\n  if (l) { \r\n    layer.current = l; \r\n  } else {\r\n    layer.current = new OlLayerVector ({\r\n      id: layerId,\r\n      renderMode: 'vector',\r\n      source: new OlSourceVector ({}),\r\n      style: style ? createStyle(style) : defaultStyle,\r\n      selectable: false\r\n    });\r\n    \r\n    map.addLayer(layer.current);\r\n  } \r\n}\r\n\r\nexport function traverseOlLayers(collection, cb) {\r\n  collection.forEach(l => {\r\n    cb(l);\r\n    if (l instanceof OLGroupLayer) traverseOlLayers(l.getLayers(), cb);\r\n  })\r\n}\r\n\r\nexport function findOlLayer(id, mainMap) {\r\n  let layer;\r\n  traverseOlLayers(mainMap.getLayers(), l => {\r\n    if (l.get('id') === id) layer = l;\r\n  });\r\n  return layer;\r\n}\r\n\r\nexport const createStyle = (props) => {\r\n  const {fill, stroke, image } = props;\r\n  const style = defaultStyle.clone();\r\n\r\n  try {\r\n    if (fill) {\r\n      style.setFill(new OlStyleFill(fill));\r\n    }\r\n    if (stroke) {\r\n      style.setStroke(new OlStyleStroke(stroke));\r\n    }\r\n    if (image) {\r\n      const { radius, displacement, scale, rotation, rotateWithView } = image;\r\n      const circleStyle = new OlStyleCircle({\r\n        fill: image.fill ? new OlStyleFill(image.fill) : null,\r\n        stroke: image.stroke ? new OlStyleStroke(image.stroke): null,\r\n        radius,\r\n        displacement,\r\n        scale,\r\n        rotation,\r\n        rotateWithView\r\n      });\r\n      style.setImage(circleStyle);\r\n    }\r\n  } catch (error) {\r\n    console.log(error);\r\n  }\r\n\r\n  return style;\r\n}\r\n","import React, { useEffect, useRef, useState } from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport { ProgressSpinner } from 'primereact/progressspinner';\r\nimport { Button } from 'primereact/button';\r\nimport OLGroupLayer from 'ol/layer/Group';\r\nimport { Panel } from 'primereact/panel';\r\nimport componentActions from './actions';\r\nimport componentReducers from './reducers';\r\nimport SearchLayers from './SearchLayers';\r\nimport { createLayer } from './map';\r\nimport './style.scss';\r\n\r\n\r\n/**\r\n * Main menu component\r\n */\r\nexport function MainMenu({ className, config, actions, record }) {\r\n  const component_cfg = record.config_json || {};\r\n  const title = record.title || 'Pesquisar Temas';\r\n  const icon = record.icon || \"pi pi-search\";\r\n\r\n  if (record.mode !== 'child') {\r\n  return (\r\n    <Button\r\n      title={title}\r\n      className={className}\r\n      icon={icon}\r\n      style={{ margin: '0.5em 1em' }}\r\n      onClick={e => config.dispatch(actions.viewer_set_selectedmenu(record.id))}\r\n    />\r\n  )\r\n  } else {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Actions\r\n */\r\nexport const actions = {\r\n  ...componentActions\r\n}\r\n\r\n/**\r\n * Reducers\r\n */\r\n export const reducers = {\r\n  ...componentReducers\r\n }\r\n\r\n/**\r\n * Main component\r\n */\r\nexport default function Main(props) {\r\n\r\n  const { as, core, config, actions, record } = props;\r\n\r\n  const { viewer, dispatch, mainMap, Models } = config;\r\n  const { selected_menu } = viewer.config_json;\r\n\r\n  const component_cfg = record.config_json || {};\r\n  const title = record.title || 'Pesquisar Temas';\r\n  const header = component_cfg.header || title;\r\n\r\n  const layer_id = component_cfg.exclusive_layer === true ? record.id : 'searchlayers';\r\n  const layer = useRef();\r\n\r\n  const ref = useRef(null);\r\n  const [blockedPanel, setBlockedPanel] = useState(false);\r\n  const [layers, setLayers] = useState(component_cfg.layers || []);\r\n\r\n\r\n  const component_store_state = useSelector((state) => {\r\n    return state?.searchlayers || {};\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (!mainMap) return;\r\n  \r\n    createLayer(layer, layer_id, mainMap, component_cfg.style);\r\n    //changeMapLoaded(true)\r\n  }, [mainMap]);\r\n\r\n  useEffect(() => {\r\n    //if (selected_menu === 'searchlayers') dispatch(actions.viewer_set_exclusive_mapcontrol('SearchLayers'));\r\n  }, [selected_menu]);\r\n\r\n  useEffect(() => {\r\n    if (component_store_state && component_store_state[record.id]) {\r\n      const new_layers = component_store_state[record.id].layers.map(l=>{\r\n        return {\r\n          id: l.id,\r\n          title: l.title,\r\n          description: l.description,\r\n          ...l.datatable\r\n        }\r\n      });\r\n      setLayers(new_layers);\r\n    }\r\n  }, [component_store_state, record.id]);\r\n\r\n\r\n  const getBlockFullHeight = () => {\r\n\r\n    const oDiv = ref.current;\r\n    \r\n    let clientHeight = 0;\r\n    let height = 0;\r\n    \r\n    try {\r\n      clientHeight = oDiv.clientHeight;\r\n    \r\n      const sOriginalOverflow = oDiv.style.overflow;\r\n      const sOriginalHeight = oDiv.style.height;\r\n      oDiv.style.overflow = \"\";\r\n      oDiv.style.height = \"\";\r\n\r\n      height = oDiv.offsetHeight;\r\n      oDiv.style.height = sOriginalHeight;\r\n      oDiv.style.overflow = sOriginalOverflow;\r\n    } catch {}\r\n        \r\n    return clientHeight > height ? clientHeight : height;\r\n  }\r\n\r\n  // Render content\r\n  function renderContent() {\r\n    return (     \r\n      <div className=\"search-layers\">\r\n        <SearchLayers\r\n          core={core}\r\n          config={config}\r\n          layer={layer}\r\n          layers={layers}\r\n          actions={actions}\r\n          pubsub={core.pubsub}\r\n          dispatch={dispatch}\r\n          mainMap={mainMap}\r\n          record={record}\r\n          Models={Models}\r\n          setBlockedPanel={setBlockedPanel}\r\n        />        \r\n      </div>\r\n    )    \r\n  }\r\n\r\n  if (as === 'panel') return (\r\n    <div ref={ref} className=\"p-blockui-container\" style={{height: 'calc(100%)'}}>\r\n      <Panel header={header}>\r\n        { renderContent() }\r\n      </Panel>\r\n      { blockedPanel && <div className=\"p-blockui p-component-overlay p-component-overlay-enter\" style={{zIndex: 1003, height: getBlockFullHeight()}}>\r\n        <ProgressSpinner style={{width: '50px', height: '50px'}} strokeWidth=\"8\" fill=\"#EEEEEE\" animationDuration=\".5s\"/>\r\n      </div> }\r\n    </div>\r\n  )\r\n\r\n  return null\r\n}","import React, { useEffect, useState, useRef } from 'react';\r\nimport { Button } from 'primereact/button';\r\nimport { Dialog } from 'primereact/dialog';\r\n\r\nimport { transform } from 'ol/proj';\r\nimport 'ol/ol.css';\r\nimport VectorLayer from 'ol/layer/Vector';\r\nimport { Vector } from 'ol/source';\r\nimport {containsXY} from 'ol/extent';\r\nimport {Circle as OlStyleCircle, Fill as OlStyleFill, Stroke as OlStyleStroke, \r\n  Icon as OlStyleIcon, Style as OlStyle} from 'ol/style';\r\nimport Feature from 'ol/Feature';\r\nimport Point from 'ol/geom/Point';\r\n\r\nimport './style.css';\r\n\r\n\r\nexport default function StreetView({ core, viewer, mainMap, dispatch, actions, record, utils }) {\r\n\r\n  const { exclusive_mapcontrol } = viewer;\r\n\r\n  const streetview_control = record;\r\n  const { viewer_update_mapcontrol, viewer_set_selectedmenu, map_set_extent, viewer_set_exclusive_mapcontrol } = actions;\r\n  const { getWindowSize, showOnPortal } = utils;  \r\n\r\n  const [modalStreetViewOpen, setModalStreetViewOpen] = useState(false);\r\n\r\n  const [position, setPosition] = useState();\r\n  const [pov, setPov] = useState();\r\n\r\n  const dialog = useRef();\r\n  const streetviewLayer = useRef();\r\n  const panorama = useRef();\r\n\r\n  const wsize = getWindowSize();\r\n  const isMobile = wsize[0] <= 768;\r\n\r\n  const component_cfg = record.config_json || {};\r\n  const title = record.title || 'Google StreetView';\r\n  const header = component_cfg.header || title;\r\n\r\n  const streetviewStyle = new OlStyle({\r\n    fill: new OlStyleFill({\r\n      color: 'rgba(255, 0, 0, 0.2)',\r\n    }),\r\n    image: new OlStyleIcon({\r\n      src: core.CLIENT_URL + 'assets/images/location-heading.svg',\r\n      imgSize: [27, 55]\r\n    }),\r\n  });\r\n\r\n  const createStyle = (props, rotation) => {\r\n\r\n    const {fill, stroke, image} = props;\r\n    const style = streetviewStyle.clone();\r\n\r\n    try {\r\n      if (fill) {\r\n        style.setFill(new OlStyleFill(fill));\r\n      }\r\n      if (stroke) {\r\n        style.setStroke(new OlStyleStroke(stroke));\r\n      }\r\n      if (image) {\r\n        if (image.icon) {\r\n          const { displacement, scale, color, rotateWithView } = image.icon;\r\n          const iconStyle = new OlStyleIcon({\r\n            imgSize: image.icon.imgSize || style.getImage().getSize(),\r\n            src: image.icon.src ? core.CLIENT_URL + image.icon.src : style.getImage().getSrc(),\r\n            color,\r\n            displacement,\r\n            scale,\r\n            rotation,\r\n            rotateWithView\r\n          });\r\n          style.setImage(iconStyle);\r\n        } else {\r\n          const { radius, displacement, scale, rotateWithView } = image;\r\n          const circleStyle = new OlStyleCircle({\r\n            fill: image.fill ? new OlStyleFill(image.fill) : null,\r\n            stroke: image.stroke ? new OlStyleStroke(image.stroke): null,\r\n            radius,\r\n            displacement,\r\n            scale,\r\n            rotateWithView\r\n          });\r\n          style.setImage(circleStyle);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n\r\n    return style;\r\n  }\r\n\r\n\r\n  // Add StreetView layer\r\n  useEffect(() => {\r\n    if (!mainMap) return;\r\n\r\n    streetviewLayer.current = new VectorLayer({\r\n      id: 'streetview',\r\n      renderMode: 'vector',\r\n      source: new Vector({}),\r\n      selectable: false\r\n    });\r\n    streetviewLayer.current.setStyle(streetviewStyle);\r\n\r\n    //const parentLayer = utils.findOlLayer(mainMap, 'overlays');\r\n    mainMap.addLayer(streetviewLayer.current);\r\n  \r\n  }, [mainMap]);\r\n\r\n\r\n  useEffect(() => {\r\n    if (!exclusive_mapcontrol) return;\r\n\r\n    if (exclusive_mapcontrol === 'StreetView' ) mainMap.on('singleclick', streetviewSingleClick);\r\n    else mainMap.un('singleclick', streetviewSingleClick);\r\n\r\n    return () => {\r\n      mainMap.un('singleclick', streetviewSingleClick);\r\n    }\r\n  }, [exclusive_mapcontrol]);  \r\n\r\n\r\n  // Toggle StreetView control\r\n  function toggleStreetViewControl() {\r\n    dispatch(viewer_set_exclusive_mapcontrol('StreetView'));\r\n  }\r\n\r\n  function streetviewSingleClick (e) {\r\n    const lonlat = transform(e.coordinate, mainMap.getView().getProjection().getCode(), 'EPSG:4326');\r\n\r\n    if (streetviewLayer?.current) {\r\n      const source = streetviewLayer.current.getSource();\r\n\r\n      if (source) {\r\n          source.clear();\r\n\r\n        const feature = new Feature({\r\n            geometry: new Point(e.coordinate)\r\n        });\r\n        source.addFeature(feature);          \r\n      }\r\n    }\r\n\r\n    if (panorama?.current) {\r\n      const pos = panorama.current.getPosition();\r\n      console.log([pos.lng(), pos.lat()]);\r\n\r\n      const newPos = new window.google.maps.LatLng(lonlat[1],lonlat[0]);\r\n      console.log([newPos.lng(), newPos.lat()]);\r\n      panorama.current.setPosition(newPos);\r\n    } else {      \r\n      setPosition(lonlat);      \r\n      setModalStreetViewOpen(true);\r\n    }    \r\n  }\r\n  \r\n  //Exit if google maps script is not loaded\r\n  if (!(window.google && window.google.maps)) return null;\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <div id=\"streetview\" className=\"streetview\">\r\n          <Button\r\n            title={title}\r\n            icon=\"fas fa-street-view\"\r\n            className={exclusive_mapcontrol === 'StreetView' ? \"p-button-rounded p-button-raised active\" : \"p-button-rounded p-button-raised\" }\r\n            onClick={e => { e.currentTarget.blur(); toggleStreetViewControl() } }\r\n          />\r\n      </div>       \r\n\r\n      {showOnPortal(<Dialog\r\n        ref={dialog} \r\n        header={header}\r\n        visible={!!modalStreetViewOpen}\r\n        style={{width: isMobile ? '90%' : '50vw', height: '80%' }}\r\n        modal={false} \r\n        onShow={() => {          \r\n          const panoramaOptions = {\r\n            position: new window.google.maps.LatLng(position[1], position[0]),\r\n            pov: {\r\n              heading: 34,\r\n              pitch: 10\r\n            }\r\n          };\r\n          const elem = dialog.current.contentEl;\r\n          const pan = new window.google.maps.StreetViewPanorama(elem, panoramaOptions);\r\n          pan.addListener('position_changed', function() {\r\n            const pos = panorama.current.getPosition();\r\n            const pov = panorama.current.getPov();\r\n\r\n            var coords = transform([pos.lng(), pos.lat()], 'EPSG:4326', mainMap.getView().getProjection().getCode());\r\n\r\n            if (streetviewLayer?.current) {\r\n              const source = streetviewLayer.current.getSource();\r\n        \r\n              if (source) {\r\n                source.clear();                \r\n                \r\n                const rotation = (Math.PI / 180) * pov.heading;            \r\n                const style = createStyle(record?.config_json?.style, rotation);\r\n        \r\n                const feature = new Feature({\r\n                    geometry: new Point(coords)\r\n                });\r\n                feature.setStyle(style);\r\n                source.addFeature(feature);\r\n                \r\n                /*Tacking modes\r\n                //  extent - only move map if position is outside map extent\r\n                //  always - alway move map to position\r\n                */\r\n                if (record?.config_json?.tracking) {\r\n                  if (record.config_json.tracking === 'extent') {\r\n                    const extent = mainMap.getView().calculateExtent(mainMap.getSize());\r\n                    if (!containsXY(extent, coords[0], coords[1])) {\r\n                      mainMap.getView().animate({\r\n                        center: coords\r\n                      });\r\n                    } \r\n                  } else if (record.config_json.tracking === 'always') {\r\n                    mainMap.getView().animate({\r\n                      center: coords\r\n                    });\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          });\r\n          pan.addListener('pov_changed', function() {\r\n            const pos = panorama.current.getPosition();\r\n            const pov = panorama.current.getPov();          \r\n\r\n            var coords = transform([pos.lng(), pos.lat()], 'EPSG:4326', mainMap.getView().getProjection().getCode());\r\n            if (streetviewLayer?.current) {\r\n              const source = streetviewLayer.current.getSource();\r\n        \r\n              if (source) {\r\n                source.clear();\r\n\r\n                const rotation = (Math.PI / 180) * pov.heading;            \r\n                const style = createStyle(record?.config_json?.style, rotation);\r\n        \r\n                const feature = new Feature({\r\n                    geometry: new Point(coords)\r\n                });\r\n                feature.setStyle(style);\r\n                source.addFeature(feature);          \r\n              }\r\n            }\r\n          });          \r\n          panorama.current = pan;\r\n         }}\r\n         onResizeEnd={() => {\r\n          window.google.maps.event.trigger(panorama.current, 'resize');\r\n        }}\r\n        onHide={e => {\r\n          if (streetviewLayer?.current) {\r\n            const source = streetviewLayer.current.getSource();      \r\n            if (source) source.clear();\r\n          }\r\n          if (panorama?.current) panorama.current = null;\r\n          setModalStreetViewOpen(false);\r\n          if (exclusive_mapcontrol === 'StreetView') {\r\n            dispatch(viewer_set_exclusive_mapcontrol(null));\r\n          }\r\n        }}>\r\n      </Dialog>)}\r\n    </React.Fragment>\r\n  )\r\n}","import React from 'react';\r\nimport { Button } from 'primereact/button';\r\nimport { Panel } from 'primereact/panel';\r\nimport StreetView from './StreetView';\r\n\r\n/**\r\n * Main menu component\r\n */\r\nexport function MainMenu({ className, config, actions, record }) {\r\n  return (React.Fragment)\r\n  {/*\r\n  const title = record.title || 'Google Street View';\r\n\r\n  return (\r\n    <Button\r\n      title=\"Ferramentas do Mapa\"\r\n      className={className}\r\n      icon=\"pi pi-sliders-h\"\r\n      style={{ margin: '0.5em 1em' }}\r\n      onClick={e => config.dispatch(actions.viewer_set_selectedmenu(record.id))}\r\n    />\r\n  )\r\n  */}\r\n}\r\n\r\nexport default function Main(props) {\r\n\r\n  const { as, core, config, utils, record } = props;\r\n\r\n  const { actions, mainMap, viewer, dispatch } = config;\r\n\r\n  const component_cfg = record.config_json || {};\r\n  const title = record.title || 'Google StreetView';\r\n  const header = component_cfg.header || title;  \r\n\r\n  function renderContent() {\r\n    return (\r\n      <div title={title}>\r\n        <StreetView\r\n          core={core}\r\n          viewer={viewer}\r\n          actions={actions}\r\n          dispatch={dispatch}\r\n          mainMap={mainMap}\r\n          record={record}\r\n          utils={utils}\r\n        />\r\n      </div>  \r\n    )  \r\n  }\r\n\r\n  if (as === 'panel') return (\r\n    <Panel header={header}>\r\n      { renderContent() }\r\n    </Panel>\r\n  )\r\n\r\n  // Render component\r\n  return renderContent()\r\n}\r\n","import React, { useState } from 'react';\r\nimport { Button } from 'primereact/button';\r\nimport { RadioButton } from 'primereact/radiobutton';\r\n\r\n/*\r\nconst types = [\r\n  { value: 'wms', label: 'WMS - Web Map service' },\r\n  { value: 'wmts', label: 'WMTS - Web Map Tile Service' },\r\n  { value: 'wfs', label: 'WFS - web Feature Service' },\r\n  { value: 'shape', label: 'Shapefile - ficheiro .zip contendo .shp' },\r\n  { value: 'kml', label: 'KML - Keyhole Markup Language' },\r\n  { value: 'gml', label: 'GML - Geographic Markup Language' },\r\n  { value: 'geojson', label: 'GeoJSON' },\r\n  { value: 'dxf', label: 'DXF (v2000)' },\r\n  { value: 'group', label: 'Grupo de Temas' },\r\n];\r\n*/\r\n\r\nexport default function WizardStepType(props) {\r\n  const { types } = props;\r\n  let [type, setType ] = useState(props.wizardData.type);\r\n  return (\r\n    <div>\r\n      \r\n      <div className=\"p-mt-2\">\r\n        { types.map(t => (\r\n          <div className=\"p-field-radiobutton\" key={t.value}>\r\n            <RadioButton\r\n              id={'wizard_type' + t.value}\r\n              value={t.value}\r\n              name=\"type\"\r\n              onChange={(e) => setType(e.value)}\r\n              checked={type === t.value}\r\n            />\r\n            <label htmlFor={'wizard_type' + t.value}>{ t.label }</label>\r\n          </div>\r\n        ))}\r\n      </div>\r\n      \r\n      <div style={ {padding: \"0.571rem 1rem\", textAlign: \"right\"} }>\r\n        <Button           \r\n          disabled={!type}\r\n          onClick={e => {\r\n            let stepdata = props.initialData;\r\n            let previousType = stepdata.type;\r\n            stepdata.type = type;\r\n            if (previousType !== type) { \r\n              stepdata.items = [];\r\n              stepdata.dataitems = [];\r\n              stepdata.url = '';\r\n            }\r\n            props.onSave(stepdata)\r\n          }}\r\n          label=\"Seguinte\" />\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","import React, {Component} from 'react';\r\nimport { WMSCapabilities } from 'ol/format';\r\n//import WMSCapabilities from '../../../model/WMSCapabilities';\r\nimport { Button } from 'primereact/button';\r\nimport { InputText } from 'primereact/inputtext';\r\nimport { Dropdown } from 'primereact/dropdown';\r\nimport {InputSwitch} from 'primereact/inputswitch';\r\nimport { Accordion, AccordionTab } from 'primereact/accordion';\r\n\r\nconst versions = [\r\n  { key: 'default', value: 'default', label: 'Especificada pela Serviço' },\r\n  { key: '1.1.0', value: '1.1.0', label: '1.1.0' },\r\n  { key: '1.1.1', value: '1.1.1', label: '1.1.1' },\r\n  { key: '1.3.0', value: '1.3.0', label: '1.3.0' }\r\n];\r\n\r\nclass WMS extends Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { showAdvanceOptions: false };\r\n  }\r\n\r\n  /**\r\n   * Event handler for load WMS capabilities\r\n   *\r\n   * @param {Object} e The click handler\r\n   */\r\n  loadWMSCapabilities() {\r\n    const { core, auth, mainMap, viewer, data, setLoading, setData, setError, cookies, Models } = this.props;\r\n    const { isUrlAppOrigin, isUrlAppHostname, rememberUrl, removeUrlParam } = Models.Utils;\r\n    if (!data.url) return;\r\n\r\n    let srid = Models.MapModel.getProjectionSrid(mainMap.getView().getProjection());\r\n    let bbox = viewer.config_json.full_extent || viewer.config_json.restricted_extent || mainMap.getView().calculateExtent();\r\n\r\n    let options = {\r\n      srid: srid,\r\n      bbox: bbox,\r\n      ignore_url: data.wmsIgnoreServiceUrl,\r\n      version: data.wmsVersion,\r\n      tiled: data.wmsTiled\r\n    }\r\n    let turl = data.url;\r\n    turl = removeUrlParam(turl, 'request')\r\n    turl = removeUrlParam(turl, 'service')\r\n    turl = removeUrlParam(turl, 'version')\r\n    turl = turl + (turl.indexOf('?') > -1 ? '' : '?')\r\n    turl = turl + '&SERVICE=WMS&REQUEST=GetCapabilities';\r\n    if (data.wmsVersion && data.wmsVersion !== 'default') {\r\n      turl = turl + '&VERSION=' + data.wmsVersion;\r\n    }\r\n\r\n    //Add user authentication token\r\n    if (isUrlAppHostname(turl) && viewer.integrated_authentication) {\r\n      if (auth && auth.data && auth.data.auth_token) {\r\n        const authkey = viewer?.integrated_authentication_key || 'authkey';\r\n        turl = turl + '&' + authkey + '=' + auth.data.auth_token;\r\n      }\r\n    }\r\n\r\n    if (!isUrlAppOrigin(turl)) {\r\n      turl = core.MAP_PROXY_URL + encodeURIComponent(turl);\r\n    }\r\n\r\n    setLoading(true);\r\n    fetch(turl)\r\n    .then(res => {\r\n      if (!res.ok) throw Error(res.statusText);\r\n      return res;\r\n    })\r\n    .then(res => res.text())\r\n    .then((r) => {\r\n      try {\r\n        const parser = new WMSCapabilities();\r\n        const wms = parser.read(r);\r\n        let dataitems = Models.OWSModel.convertWMS2Themes(wms, data.url, options);\r\n        setData({ ...data, dataitems });\r\n\r\n        // Add to cookies history\r\n        if (cookies) rememberUrl(cookies, 'wms', data.url);\r\n        setLoading(false);\r\n\r\n      } catch (e) {\r\n        setLoading(false);\r\n        setError(''+e);\r\n      }\r\n    }).catch((error) => {\r\n      setData({ ...data, dataitems: [] });\r\n      setLoading(false);\r\n      setError(''+error);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * On component did mount\r\n   */\r\n  componentDidMount() {\r\n    const { data } = this.props;\r\n    if (data.dataType === 'wms' && data.url) {\r\n      this.loadWMSCapabilities();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Render WMS wizard\r\n   */\r\n  render() {\r\n    const { loading, data, editField, getUrlHistory, winSize } = this.props;\r\n    const { wmsIgnoreServiceUrl, wmsVersion, wmsTiled } = data;\r\n    const { showAdvanceOptions } = this.state;\r\n    return (\r\n      <React.Fragment>\r\n        <div className=\"p-inputgroup\">\r\n          <InputText placeholder='http://...'\r\n            value={data.url}\r\n            list='urlhistory'\r\n            onChange={e => editField('url', e.target.value.trim())}\r\n          />\r\n          <Button\r\n            icon={ loading ? \"pi pi-spin pi-spinner\" : \"pi pi-search\" }\r\n            tooltip=\"Carregar\" tooltipOptions={{position: 'bottom'}}\r\n            disabled={loading}\r\n            onClick={e => {\r\n              e.preventDefault();\r\n              this.loadWMSCapabilities()\r\n            }}\r\n          />\r\n        </div>\r\n        <datalist id='urlhistory'>\r\n          { getUrlHistory().map((i, k) => <option key={k} value={i} />)}\r\n        </datalist>\r\n\r\n        <Accordion activeIndex={showAdvanceOptions ? 0 : -1} className=\"p-pt-2\">\r\n          <AccordionTab header=\"Opções Avançadas\">\r\n\r\n            <div className=\"p-fluid\">\r\n\r\n              <div className=\"p-field p-grid\">\r\n                <label className=\"p-col-12 p-md-7\">Versão</label>\r\n                <div className=\"p-col-12 p-md-5\">\r\n                  <Dropdown\r\n                    options={versions}\r\n                    value={wmsVersion}\r\n                    onChange={(e) => editField('wmsVersion', e.value)}\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"p-field p-grid\">\r\n                <label className=\"p-col-12 p-md-7\">Ignorar URL do serviço</label>\r\n                <div className=\"p-col-12 p-md-5\" style={{ textAlign: 'right' }}>\r\n                  <InputSwitch\r\n                    id='Ignorar URL do serviço'\r\n                    checked={wmsIgnoreServiceUrl}\r\n                    onChange={e => editField('wmsIgnoreServiceUrl', !wmsIgnoreServiceUrl)}\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"p-field p-grid\">\r\n                <label className=\"p-col-12 p-md-7\">Usar quadrículas</label>\r\n                <div className=\"p-col-12 p-md-5\" style={{ textAlign: 'right' }}>\r\n                  <InputSwitch\r\n                    id='Usar quadrículas'\r\n                    checked={wmsTiled}\r\n                    onChange={e => editField('wmsTiled', !wmsTiled)}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n          </AccordionTab>\r\n        </Accordion>\r\n\r\n      </React.Fragment>\r\n    )\r\n  }\r\n}\r\n\r\nexport default WMS;\r\n","import React, {Component} from 'react';\r\nimport { WMTSCapabilities } from 'ol/format';\r\n//import WMSCapabilities from '../../../model/WMSCapabilities';\r\nimport { Button } from 'primereact/button';\r\nimport { InputText } from 'primereact/inputtext';\r\nimport { Dropdown } from 'primereact/dropdown';\r\nimport {InputSwitch} from 'primereact/inputswitch';\r\nimport { Accordion, AccordionTab } from 'primereact/accordion';\r\n\r\nconst versions = [\r\n  { key: 'default', value: 'default', label: 'Especificada pelo Serviço' },\r\n  { key: '1.0.0', value: '1.0.0', label: '1.0.0' }\r\n];\r\n\r\nclass WMTS extends Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { showAdvanceOptions: false };\r\n  }\r\n\r\n  /**\r\n   * Event handler for load WMTS capabilities\r\n   *\r\n   * @param {Object} e The click handler\r\n   */\r\n  loadWMTSCapabilities() {\r\n    const { core, auth, mainMap, viewer, data, setLoading, setData, setError, cookies, Models } = this.props;\r\n    const { isUrlAppOrigin, isUrlAppHostname, rememberUrl, removeUrlParam } = Models.Utils;\r\n    if (!data.url) return;\r\n\r\n    let srid = Models.MapModel.getProjectionSrid(mainMap.getView().getProjection());\r\n    let bbox = viewer.config_json.full_extent || viewer.config_json.restricted_extent || mainMap.getView().calculateExtent();\r\n\r\n    let options = {\r\n      srid: srid,\r\n      bbox: bbox,\r\n      ignore_url: data.wmtsIgnoreServiceUrl,\r\n      version: data.wmtsVersion\r\n    }\r\n    let turl = data.url;\r\n    turl = removeUrlParam(turl, 'request')\r\n    turl = removeUrlParam(turl, 'service')\r\n    turl = removeUrlParam(turl, 'version')\r\n    turl = turl + (turl.indexOf('?') > -1 ? '' : '?')\r\n    turl = turl + '&SERVICE=WMTS&REQUEST=GetCapabilities';\r\n    if (data.wmtsVersion && data.wmtsVersion !== 'default') {\r\n      turl = turl + '&VERSION=' + data.wmtsVersion;\r\n    }\r\n\r\n    //Add user authentication token\r\n    if (isUrlAppHostname(turl) && viewer.integrated_authentication) {\r\n      if (auth && auth.data && auth.data.auth_token) {\r\n        const authkey = viewer?.integrated_authentication_key || 'authkey';\r\n        turl = turl + '&' + authkey + '=' + auth.data.auth_token;\r\n      }\r\n    }\r\n\r\n    if (!isUrlAppOrigin(turl)) {\r\n      turl = core.MAP_PROXY_URL + encodeURIComponent(turl);\r\n    };\r\n\r\n    setLoading(true);\r\n    fetch(turl)\r\n    .then(res => {\r\n      if (!res.ok) throw Error(res.statusText);\r\n      return res;\r\n    })\r\n    .then(res => res.text())\r\n    .then((r) => {\r\n      try {\r\n        const parser = new WMTSCapabilities();\r\n        const wmts = parser.read(r);\r\n        data.dataitems = Models.OWSModel.convertWMTS2Themes(wmts, data.url, options);\r\n        data.wmtsTileMatrixSet = [];\r\n        if (wmts.Contents && wmts.Contents.TileMatrixSet) {\r\n          data.wmtsTileMatrixSet = wmts.Contents.TileMatrixSet.map(m => ({ Identifier: m.Identifier, SupportedCRS: m.SupportedCRS }));\r\n        }\r\n        setData(data);\r\n\r\n        // Add to cookies history\r\n        if (cookies) rememberUrl(cookies, 'wmts', data.url);\r\n        setLoading(false);\r\n\r\n      } catch (e) {\r\n        setError(''+e);\r\n        setLoading(false);\r\n      }\r\n    }).catch((error) => {\r\n      setData({ ...data, dataitems: [] });\r\n      setError(''+error);\r\n      setLoading(false);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * On component did mount\r\n   */\r\n  componentDidMount() {\r\n    const { data } = this.props;\r\n    if (data.dataType === 'wmts' && data.url) {\r\n      this.loadWMTSCapabilities();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Render WMTS wizard\r\n   */\r\n  render() {\r\n    const { loading, data, editField, getUrlHistory, winSize } = this.props;\r\n    const { wmtsIgnoreServiceUrl, wmtsVersion } = data;\r\n    const { showAdvanceOptions } = this.state;\r\n    \r\n    return (\r\n      <React.Fragment>\r\n        <div className=\"p-inputgroup\">\r\n          <InputText placeholder='http://...'\r\n            value={data.url}\r\n            list='urlhistory'\r\n            onChange={e => editField('url', e.target.value.trim())}\r\n          />\r\n          <Button\r\n            icon={ loading ? \"pi pi-spin pi-spinner\" : \"pi pi-search\" }\r\n            tooltip=\"Carregar\" tooltipOptions={{position: 'bottom'}}\r\n            disabled={loading}\r\n            onClick={e => {\r\n              e.preventDefault();\r\n              this.loadWMTSCapabilities()\r\n            }}\r\n          />\r\n        </div>\r\n        <datalist id='urlhistory'>\r\n          { getUrlHistory().map((i, k) => <option key={k} value={i} />)}\r\n        </datalist>\r\n\r\n        <Accordion activeIndex={showAdvanceOptions ? 0 : -1} className=\"p-pt-2\">\r\n          <AccordionTab header=\"Opções Avançadas\">\r\n\r\n            <div className=\"p-fluid\">\r\n\r\n              <div className=\"p-field p-grid\">\r\n                <label className=\"p-col-12 p-md-7\">Versão</label>\r\n                <div className=\"p-col-12 p-md-5\">\r\n                  <Dropdown\r\n                    options={versions}\r\n                    value={wmtsVersion}\r\n                    onChange={(e, { value }) => editField('wmtsVersion', value)}\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"p-field p-grid\">\r\n                <label className=\"p-col-12 p-md-7\">Ignorar URL do serviço</label>\r\n                <div className=\"p-col-12 p-md-5\" style={{ textAlign: 'right' }}>\r\n                  <InputSwitch\r\n                    id='Ignorar URL do serviço'\r\n                    checked={wmtsIgnoreServiceUrl}\r\n                    onChange={e => editField('wmtsIgnoreServiceUrl', !wmtsIgnoreServiceUrl)}\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n            </div>\r\n\r\n          </AccordionTab>\r\n        </Accordion>\r\n\r\n      </React.Fragment>\r\n    )\r\n  }\r\n}\r\n\r\nexport default WMTS;\r\n","import React, {Component} from 'react';\r\nimport xml2js from 'xml2js';\r\nimport { Button } from 'primereact/button';\r\nimport { InputText } from 'primereact/inputtext';\r\n\r\nclass WFS extends Component {\r\n\r\n  /**\r\n   * Event handler for load WFS Capabilities\r\n   */\r\n  loadWFSCapabilities() {\r\n    const { core, auth, mainMap, viewer, data, setLoading, setData, setError, cookies, Models } = this.props;\r\n    const { isUrlAppOrigin, isUrlAppHostname, rememberUrl } = Models.Utils;\r\n    if (!data.url) return;\r\n\r\n    let srid = Models.MapModel.getProjectionSrid(mainMap.getView().getProjection());\r\n    let bbox = viewer.config_json.full_extent || viewer.config_json.restricted_extent || mainMap.getView().calculateExtent();\r\n\r\n    let options = {\r\n      srid: srid,\r\n      bbox: bbox\r\n    }\r\n    \r\n    let turl = data.url;\r\n    turl = turl.replace(/request=getcapabilities/ig, '');\r\n    turl = turl.replace(/service=wfs/ig, '')\r\n    turl = turl + (turl.indexOf('?') > -1 ? '' : '?')\r\n    turl = turl + '&SERVICE=WFS&REQUEST=GetCapabilities';\r\n\r\n    //Add user authentication token\r\n    if (isUrlAppHostname(turl) && viewer.integrated_authentication) {\r\n      if (auth && auth.data && auth.data.auth_token) {\r\n        const authkey = viewer?.integrated_authentication_key || 'authkey';\r\n        turl = turl + '&' + authkey + '=' + auth.data.auth_token;\r\n      }\r\n    }\r\n\r\n    if (!isUrlAppOrigin(turl)) {\r\n      turl = core.MAP_PROXY_URL + encodeURIComponent(turl);\r\n    };\r\n\r\n    setLoading(true);\r\n\r\n    fetch(turl)\r\n    .then(res => {\r\n      if (!res.ok) throw Error(res.statusText);\r\n      return res;\r\n    })\r\n    .then(res => res.text())\r\n    .then((r) => {\r\n      xml2js.parseString(r, (err, capabilities) => {\r\n        if (err) {\r\n          console.error(err);\r\n          setError(''+err);\r\n          setLoading(false);\r\n          return;\r\n        }\r\n        data.dataitems = Models.OWSModel.convertWFS2Themes(capabilities, data.url, options);\r\n        setData(data);\r\n\r\n        // Add to cookies history\r\n        if (cookies) rememberUrl(cookies, 'wfs', data.url);\r\n        setLoading(false);\r\n\r\n      });\r\n    }).catch((error) => {\r\n      setData({ ...data, dataitems: [] });\r\n      setError(''+error);\r\n      setLoading(false);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * On component did mount\r\n   */\r\n  componentDidMount() {\r\n    const { data } = this.props;\r\n    if (data.dataType === 'wfs' && data.url) {\r\n      this.loadWFSCapabilities();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Render WFS wizard\r\n   */\r\n  render() {\r\n    const { loading, data, editField, getUrlHistory, winSize } = this.props;\r\n    return (\r\n      <React.Fragment>\r\n        <div className=\"p-inputgroup\">\r\n          <InputText placeholder='http://...'\r\n            value={data.url}\r\n            list='urlhistory'\r\n            onChange={e => editField('url', e.target.value.trim())}\r\n          />\r\n          <Button\r\n            icon={ loading ? \"pi pi-spin pi-spinner\" : \"pi pi-search\" }\r\n            tooltip=\"Carregar\" tooltipOptions={{position: 'bottom'}}\r\n            disabled={loading}\r\n            onClick={e => {\r\n              e.preventDefault();\r\n              this.loadWFSCapabilities()\r\n            }}\r\n          />\r\n        </div>\r\n        <datalist id='urlhistory'>\r\n          { getUrlHistory().map((i, k) => <option key={k} value={i} />)}\r\n        </datalist>\r\n      </React.Fragment>\r\n    )\r\n  }\r\n}\r\n\r\nexport default WFS;","import React, {Component} from 'react';\r\nimport { Button } from 'primereact/button';\r\nimport { InputText } from 'primereact/inputtext';\r\nimport { Dropdown } from 'primereact/dropdown';\r\nimport {InputSwitch} from 'primereact/inputswitch';\r\nimport { Accordion, AccordionTab } from 'primereact/accordion';\r\n\r\n\r\nclass ArcGISMap extends Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { showAdvanceOptions: false };\r\n  }\r\n\r\n  /**\r\n   * Event handler for load ArcGIS Map Srvice capabilities\r\n   *\r\n   * @param {Object} e The click handler\r\n   */\r\n  loadArcGISMapCapabilities() {\r\n    const { core, auth, mainMap, viewer, data, setLoading, setData, setError, cookies, Models } = this.props;\r\n    const { isUrlAppOrigin, isUrlAppHostname, rememberUrl, removeUrlParam } = Models.Utils;\r\n    if (!data.url) return;\r\n\r\n    let srid = Models.MapModel.getProjectionSrid(mainMap.getView().getProjection());\r\n    let bbox = viewer.config_json.full_extent || viewer.config_json.restricted_extent || mainMap.getView().calculateExtent();\r\n\r\n    let options = {\r\n      srid: srid,\r\n      bbox: bbox,\r\n      tiled: data.wmsTiled\r\n    }\r\n    let murl = `${data.url}?f=json`;\r\n    let lurl = `${data.url}/layers?f=json`; \r\n\r\n    /*\r\n    //Add user authentication token\r\n    if (isUrlAppHostname(turl) && viewer.integrated_authentication) {\r\n      if (auth && auth.data && auth.data.auth_token) {\r\n        const authkey = viewer?.integrated_authentication_key || 'authkey';\r\n        turl = turl + '&' + authkey + '=' + auth.data.auth_token;\r\n      }\r\n    }\r\n    */\r\n\r\n    if (!isUrlAppOrigin(data.url)) {\r\n      murl = core.MAP_PROXY_URL + encodeURIComponent(murl);\r\n      lurl = core.MAP_PROXY_URL + encodeURIComponent(lurl);\r\n    }\r\n\r\n    setLoading(true);\r\n\r\n    Promise.all([\r\n      fetch(murl).catch((error) => error),\r\n      fetch(lurl).catch((error) => error)\r\n    ]).then(async(result) => {\r\n      const capabilities = {\r\n        service: null,\r\n        layers: null\r\n      }\r\n      if (result[0].ok) capabilities['service'] = await result[0].json();\r\n      if (result[1].ok) {\r\n        const layers_data = await result[1].json();\r\n        capabilities.layers = layers_data?.layers ? layers_data?.layers : null;\r\n      }\r\n      return capabilities;\r\n    }).then((capabilities) => {\r\n      let dataitems = Models.OWSModel.convertArcGISMap2Themes(capabilities, data.url, options);\r\n      setData({ ...data, dataitems });        \r\n\r\n      // Add to cookies history\r\n      if (cookies) rememberUrl(cookies, 'arcgismap', data.url);\r\n      setLoading(false);\r\n    }).catch((error) => {\r\n      setData({ ...data, dataitems: [] });\r\n      setLoading(false);\r\n      setError(''+error);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * On component did mount\r\n   */\r\n  componentDidMount() {\r\n    const { data } = this.props;\r\n    if (data.dataType === 'arcgismap' && data.url) {\r\n      this.loadArcGISMapCapabilities();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Render WMS wizard\r\n   */\r\n  render() {\r\n    const { loading, data, editField, getUrlHistory, winSize } = this.props;\r\n    const { wmsTiled } = data;\r\n    const { showAdvanceOptions } = this.state;\r\n    return (\r\n      <React.Fragment>\r\n        <div className=\"p-inputgroup\">\r\n          <InputText placeholder='http://...'\r\n            value={data.url}\r\n            list='urlhistory'\r\n            onChange={e => editField('url', e.target.value.trim())}\r\n          />\r\n          <Button\r\n            icon={ loading ? \"pi pi-spin pi-spinner\" : \"pi pi-search\" }\r\n            tooltip=\"Carregar\" tooltipOptions={{position: 'bottom'}}\r\n            disabled={loading}\r\n            onClick={e => {\r\n              e.preventDefault();\r\n              this.loadArcGISMapCapabilities()\r\n            }}\r\n          />\r\n        </div>\r\n        <datalist id='urlhistory'>\r\n          { getUrlHistory().map((i, k) => <option key={k} value={i} />)}\r\n        </datalist>\r\n\r\n        <Accordion activeIndex={showAdvanceOptions ? 0 : -1} className=\"p-pt-2\">\r\n          <AccordionTab header=\"Opções Avançadas\">\r\n\r\n            <div className=\"p-fluid\">\r\n              <div className=\"p-field p-grid\">\r\n                <label className=\"p-col-12 p-md-7\">Usar quadrículas</label>\r\n                <div className=\"p-col-12 p-md-5\" style={{ textAlign: 'right' }}>\r\n                  <InputSwitch\r\n                    id='Usar quadrículas'\r\n                    checked={wmsTiled}\r\n                    onChange={e => editField('wmsTiled', !wmsTiled)}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n          </AccordionTab>\r\n        </Accordion>\r\n\r\n      </React.Fragment>\r\n    )\r\n  }\r\n}\r\n\r\nexport default ArcGISMap;","import React, {Component} from 'react';\r\nimport { Dropdown } from 'primereact/dropdown';\r\nimport { FileUpload } from 'primereact/fileupload';\r\n\r\n\r\nclass Shapefile extends Component {\r\n\r\n  /**\r\n   * Event handler for load Shapefile\r\n   * \r\n   * @param {Object} e \r\n   */\r\n  loadShapeFile(e) {\r\n    const { core, mainMap, viewer, data, setLoading, setData, Models, fastFetch } = this.props;\r\n    const { isUrlAppOrigin } = Models.Utils;    \r\n    const endpoint = viewer.upload_url || core.UPLOAD_URL;\r\n    const name = e.files[0].name;\r\n\r\n    const file = e.files[0];\r\n    const upload = new FormData();\r\n    upload.append('files', file);\r\n    upload.append('ext', 'json');\r\n\r\n    setLoading(true);\r\n    const options = { method: 'POST', body: upload };\r\n    fastFetch(endpoint, options, 8000)\r\n      .then(res => {return res.json()})\r\n      .then(res => {\r\n\r\n        // Validate response\r\n        setLoading(false);\r\n        if (!res.Success) {\r\n          //console.log(res.Message);\r\n          return setLoading(false);\r\n        }\r\n\r\n        let orginal_url = core.API_URL + res.Data.url;\r\n        let url = orginal_url;\r\n        if (!isUrlAppOrigin(url)) {\r\n          url = core.MAP_PROXY_URL + encodeURIComponent(url);\r\n        };      \r\n        fetch(url)\r\n          .then(res => res.json())\r\n          .then(res => {\r\n            data.dataitems = Models.OWSModel.convertGeoJSON2Themes(res, orginal_url, name, data.crs);\r\n            setData(Object.assign({}, data));\r\n            setLoading(false);\r\n        })\r\n\r\n          // Catch download error\r\n          .catch(error => {\r\n            console.error(error);\r\n            setLoading(false);\r\n          });\r\n      })\r\n  \r\n      // Catch upload error\r\n      .catch(error => {\r\n        console.error(error);\r\n        setLoading(false);\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Render Shapefile wizard\r\n   */\r\n  render() {\r\n    const { viewer, loading, data, editField } = this.props;\r\n    return (\r\n      <React.Fragment>\r\n        <div className=\"p-fluid\">\r\n\r\n          <div className=\"p-field\">\r\n            <label>Sistema de Coordenadas</label>\r\n            <Dropdown \r\n              placeholder='Escolha o sistema de coordenadas'\r\n              options={viewer.config_json.crs_list.map(c => ({value: String(c.srid), label: c.title }))}\r\n              value={data.crs || '4326'}\r\n              onChange={(e) => editField('crs', e.value)}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"p-field\">\r\n            <label>Ficheiro ZIP contendo os ficheiros SHP, DBF e SHX</label>\r\n            <FileUpload \r\n              name=\"upload\"\r\n              accept=\"application/zip\"\r\n              maxFileSize={this.props.maxFileSize * 1024}\r\n              customUpload \r\n              uploadHandler={this.loadShapeFile.bind(this)}\r\n              disabled={loading}\r\n              url=\"./upload\"\r\n              chooseLabel=\"Escolher\"\r\n              uploadLabel=\"Carregar\"\r\n              cancelLabel=\"Cancelar\"              \r\n              invalidFileSizeMessageDetail=\"\"\r\n              invalidFileSizeMessageSummary={\"O ficheiro não poderá ter mais de \" + (Math.round((this.props.maxFileSize/1024) * 100) / 100) + \" MB\"}\r\n            />\r\n            { (this.props.maxFileSize && this.props.maxFileSize > 0) ?\r\n            <small id=\"upload-help\" className=\"p-warn\">Dimensão máxima do ficheiro: {Math.round((this.props.maxFileSize/1024) * 100) / 100} MB</small>\r\n            : null }            \r\n          </div>\r\n        </div>\r\n\r\n      </React.Fragment>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Shapefile;","import React, {Component} from 'react';\r\nimport { Dropdown } from 'primereact/dropdown';\r\nimport { FileUpload } from 'primereact/fileupload';\r\nimport { TabView, TabPanel } from 'primereact/tabview';\r\nimport { InputText } from 'primereact/inputtext';\r\nimport { Button } from 'primereact/button';\r\n\r\n\r\nclass GeoJSON extends Component {\r\n\r\n  /**\r\n   * Event handler for load file\r\n   * \r\n   * @param {Object} e \r\n   */\r\n  loadGeoJSONFile(e) {\r\n    const { core, mainMap, viewer, data, setLoading, setData, setError, Models, fastFetch } = this.props;\r\n    const { isUrlAppOrigin } = Models.Utils;\r\n    const endpoint = viewer.upload_url || core.UPLOAD_URL;\r\n    const name = e.files[0].name;\r\n\r\n    const file = e.files[0];\r\n    const upload = new FormData();\r\n    upload.append('files', file);\r\n    upload.append('ext', 'json');\r\n\r\n    setLoading(true);\r\n    const options = { method: 'POST', body: upload };\r\n    fastFetch(endpoint, options, 8000)\r\n      .then(res => {\r\n        if (!res || !res.ok) {\r\n          throw new Error('Não foi possível obter uma resposta válida.');\r\n        } else {\r\n          return res.json();\r\n        }        \r\n      })\r\n      .then(res => {\r\n        // Validate response\r\n        if (!res.Success) {\r\n          setError('Ocorreu um erro ao processar o ficheiro GeoJSON!');\r\n          return setLoading(false);\r\n        }\r\n\r\n        let orginal_url = core.API_URL + res.Data.url;\r\n        let url = orginal_url;\r\n        if (!isUrlAppOrigin(url)) {\r\n          url = core.MAP_PROXY_URL + encodeURIComponent(url);\r\n        };        \r\n        fetch(url)\r\n          .then(res => res.json())\r\n          .then(res => {\r\n            data.dataitems = Models.OWSModel.convertGeoJSON2Themes(res, orginal_url, name, data.crs);\r\n            setData(Object.assign({}, data));\r\n            setLoading(false);\r\n        })\r\n\r\n        // Catch download error\r\n        .catch(error => {\r\n          setLoading(false);\r\n          setError(''+error);\r\n        });\r\n    })\r\n\r\n    // Catch upload error\r\n    .catch(error => {\r\n      setLoading(false);\r\n      setError(''+error);\r\n    });\r\n  }\r\n\r\n  changeURL(value) {\r\n    let { data, setData } = this.props;\r\n    data.url = value.trim();\r\n    setData(Object.assign({}, data));\r\n  }\r\n\r\n  loadFromUserURL() {\r\n    let { core, data, setData, setSelected, setError, cookies, setLoading, Models } = this.props;\r\n    let { isUrlAppOrigin } = Models.Utils;\r\n    let name = 'GeoJSON';\r\n    let url = data.url || '';\r\n\r\n    if (!url.trim()) return;\r\n\r\n    if (!isUrlAppOrigin(url)) {\r\n      url = core.MAP_PROXY_URL + encodeURIComponent(url);\r\n    };\r\n    setLoading(true);\r\n    fetch(url)\r\n      .then(res => {     \r\n        if (!res.ok) {\r\n          throw new Error('Não foi possível obter uma resposta válida.');\r\n        } else {\r\n          return res.json();\r\n        }                   \r\n      })\r\n      .then(res => {\r\n        try {\r\n          data.dataitems = Models.OWSModel.convertGeoJSON2Themes(res, data.url, name, data.crs);\r\n          if (data.dataitems && data.dataitems.length > 0) {\r\n            setLoading(false);\r\n            setData(Object.assign({}, data));\r\n            // Add to cookies history\r\n            //if (cookies) rememberUrl(cookies, 'geojson', data.url);\r\n          } else {\r\n            throw Error('Não foi possível obter uma resposta válida.');\r\n          }\r\n        } catch (e) {\r\n          setLoading(false);\r\n          setError(''+e);\r\n        }          \r\n      })\r\n      // Catch download error\r\n      .catch(error => {\r\n        setData({ ...data, dataitems: [] });\r\n        setSelected({});\r\n        setLoading(false);\r\n        setError(''+error);\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Render GeoJSON wizard\r\n   */\r\n  render() {\r\n    const { viewer, loading, data, editField, winSize } = this.props;\r\n    return (\r\n      <React.Fragment>\r\n        <div className=\"p-fluid\">\r\n\r\n          <div className=\"p-field\">\r\n            <label>Sistema de Coordenadas</label>\r\n            <Dropdown \r\n              placeholder='Escolha o sistema de coordenadas'\r\n              options={viewer.config_json.crs_list.map(c => ({value: String(c.srid), label: c.title }))}\r\n              value={data.crs || '4326'}\r\n              onChange={(e) => editField('crs', e.value)}\r\n            />\r\n          </div>\r\n\r\n          <TabView>\r\n            <TabPanel header=\"Ficheiro\">\r\n              <div className=\"p-field\">\r\n                <label>Ficheiro GeoJSON</label>\r\n                <FileUpload \r\n                  name=\"upload\"\r\n                  accept=\"application/json,.geojson\"\r\n                  maxFileSize={this.props.maxFileSize * 1024}\r\n                  customUpload \r\n                  uploadHandler={this.loadGeoJSONFile.bind(this)}\r\n                  disabled={loading}\r\n                  url=\"./upload\"\r\n                  chooseLabel=\"Escolher\"\r\n                  uploadLabel=\"Carregar\"\r\n                  cancelLabel=\"Cancelar\"\r\n                  invalidFileSizeMessageDetail=\"\"\r\n                  invalidFileSizeMessageSummary={\"O ficheiro não poderá ter mais de \" + (Math.round((this.props.maxFileSize/1024) * 100) / 100) + \" MB\"}\r\n                />\r\n                { (this.props.maxFileSize && this.props.maxFileSize > 0) ?\r\n                <small id=\"upload-help\" className=\"p-warn\">Dimensão máxima do ficheiro: {Math.round((this.props.maxFileSize/1024) * 100) / 100} MB</small>\r\n                : null }\r\n              </div>\r\n            </TabPanel>\r\n            <TabPanel header=\"URL\">\r\n              <div className=\"p-field\">\r\n                <label>URL</label>\r\n                <div className=\"p-inputgroup\">\r\n                  <InputText placeholder='URL...'\r\n                    value={data.url}\r\n                    onChange={e => this.changeURL(e.target.value)}\r\n                    style={{ width: '100%' }}\r\n                  />\r\n                  <Button\r\n                    icon={ loading ? \"pi pi-spin pi-spinner\" : \"pi pi-search\" }\r\n                    tooltip=\"Carregar\" tooltipOptions={{position: 'bottom'}}\r\n                    disabled={loading}\r\n                    onClick={e => {\r\n                      e.preventDefault();\r\n                      this.loadFromUserURL()\r\n                    }}\r\n                  />\r\n                </div>\r\n                \r\n              </div>\r\n            </TabPanel>\r\n\r\n          </TabView>\r\n\r\n          \r\n        </div>\r\n\r\n      </React.Fragment>\r\n    )\r\n  }\r\n}\r\n\r\nexport default GeoJSON;","import React, {Component} from 'react';\r\nimport { Dropdown } from 'primereact/dropdown';\r\nimport { FileUpload } from 'primereact/fileupload';\r\nimport { TabView, TabPanel } from 'primereact/tabview';\r\nimport { InputText } from 'primereact/inputtext';\r\nimport { Button } from 'primereact/button';\r\nimport {parseString} from 'xml2js';\r\n\r\n\r\nclass KML extends Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    const { editField } = props;\r\n\r\n    editField('crs', 4326);\r\n  }  \r\n\r\n  loadKMLData(file, name) {\r\n    const { core, mainMap, viewer, data, setLoading, setData, setError, Models, fastFetch } = this.props;\r\n    const { isUrlAppOrigin } = Models.Utils;\r\n    const endpoint = viewer.upload_url || core.UPLOAD_URL;\r\n    \r\n    const upload = new FormData();\r\n    upload.append('files', file);\r\n    upload.append('ext', 'kml');\r\n\r\n    setLoading(true);\r\n    const options = { method: 'POST', body: upload };\r\n    fastFetch(endpoint, options, 8000)\r\n      .then(res => res.json())\r\n      .then(res => {\r\n\r\n        // Validate response\r\n        if (!res.Success) {\r\n          setError('Ocorreu um erro ao processar o ficheiro KML!');\r\n          return setLoading(false);\r\n        }\r\n        \r\n        let orginal_url = core.API_URL + res.Data.url;\r\n        let url = orginal_url;\r\n        if (!isUrlAppOrigin(url)) {\r\n          url = core.MAP_PROXY_URL + encodeURIComponent(url);\r\n        };        \r\n        fetch(url)\r\n          .then(res => res.json())\r\n          .then(res => {\r\n            data.dataitems = Models.OWSModel.convertGeoJSON2Themes(res, orginal_url, name, data.crs);\r\n            setData(Object.assign({}, data));\r\n            setLoading(false);\r\n        })\r\n\r\n        // Catch download error\r\n        .catch(error => {\r\n          setLoading(false);\r\n          setError(''+error);\r\n        });\r\n      })\r\n      \r\n      // Catch upload error\r\n      .catch(error => {\r\n        setLoading(false);\r\n        setError(''+error);\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Event handler for load file\r\n   * \r\n   * @param {Object} e \r\n   */\r\n  loadKMLFile(e) {\r\n    const name = e.files[0].name;\r\n    const file = e.files[0];\r\n    this.loadKMLData(file, name);\r\n  }\r\n\r\n  changeURL(value) {\r\n    let { data, setData } = this.props;\r\n    data.url = value.trim();\r\n    setData(Object.assign({}, data));\r\n  }\r\n\r\n  loadFromUserURL() {\r\n    let { core, data, setData, setSelected, setError, cookies, setLoading, Models, } = this.props;\r\n    let { isUrlAppOrigin } = Models.Utils;\r\n    let name = 'KML';\r\n    let url = data.url || '';\r\n\r\n    if (!url.trim()) return;\r\n\r\n    if (!isUrlAppOrigin(url)) {\r\n      url = core.MAP_PROXY_URL + encodeURIComponent(url);\r\n    };\r\n    setLoading(true);\r\n\r\n    fetch(url)\r\n      .then(res => res.text())\r\n      .then(res => {\r\n        try {\r\n          parseString(res, function (err, kml) { \r\n            data.dataitems = Models.OWSModel.convertKML2Themes(kml, data.url, res, data.crs);\r\n            if (data.dataitems && data.dataitems.length > 0) {\r\n              setLoading(false);\r\n              setData(Object.assign({}, data));\r\n              // Add to cookies history\r\n              //if (cookies) rememberUrl(cookies, 'geojson', data.url);              \r\n            } else {\r\n              throw Error('Não foi possível obter uma resposta válida.');\r\n            }\r\n          });\r\n        } catch (e) {\r\n          setLoading(false);\r\n          setError(''+e);\r\n        }          \r\n      })\r\n      .catch(error => {\r\n        setData({ ...data, dataitems: [] });\r\n        setSelected({});\r\n        setLoading(false);\r\n        setError(''+error);\r\n      })\r\n\r\n    /*   \r\n    fetch(url)\r\n      .then(res => {\r\n        if (!res.ok) {\r\n          throw new Error('Não foi possível obter uma resposta válida.');\r\n        } else {\r\n          return res.text();\r\n        }\r\n      })\r\n      .then(res => {\r\n        try {\r\n          const file = new File([res], name, {type: \"application/vnd.google-earth.kml+xml\", lastModified: new Date() });\r\n          this.loadKMLData(file, name);\r\n\r\n          // Add to cookies history\r\n          //if (cookies) rememberUrl(cookies, 'geojson', data.url);\r\n          //setLoading(false);\r\n        } catch (e) {\r\n          setLoading(false);\r\n          setError(''+e);\r\n        }        \r\n      })\r\n      // Catch download error\r\n      .catch(error => {\r\n        setData({ ...data, dataitems: [] });\r\n        setSelected({});\r\n        setLoading(false);\r\n        setError(''+error);\r\n      });\r\n      */\r\n  }\r\n\r\n  /**\r\n   * Render KML wizard\r\n   */\r\n  render() {\r\n    const { viewer, loading, data, editField, winSize } = this.props;\r\n    return (\r\n      <React.Fragment>\r\n        <div className=\"p-fluid\">\r\n\r\n          <TabView>\r\n            <TabPanel header=\"Ficheiro\">\r\n              <div className=\"p-field\">\r\n                <label>Ficheiro - KML/KMZ</label>\r\n                <FileUpload \r\n                  name=\"upload\"\r\n                  accept=\".kml,.kmz\"\r\n                  maxFileSize={this.props.maxFileSize * 1024}\r\n                  customUpload \r\n                  uploadHandler={this.loadKMLFile.bind(this)}\r\n                  disabled={loading}\r\n                  url=\"./upload\"\r\n                  chooseLabel=\"Escolher\"\r\n                  uploadLabel=\"Carregar\"\r\n                  cancelLabel=\"Cancelar\"\r\n                  invalidFileSizeMessageDetail=\"\"\r\n                  invalidFileSizeMessageSummary={\"O ficheiro não poderá ter mais de \" + (Math.round((this.props.maxFileSize/1024) * 100) / 100) + \" MB\"}\r\n                />\r\n                { (this.props.maxFileSize && this.props.maxFileSize > 0) ?\r\n                <small id=\"upload-help\" className=\"p-warn\">Dimensão máxima do ficheiro: {Math.round((this.props.maxFileSize/1024) * 100) / 100} MB</small>\r\n                : null }                \r\n              </div>\r\n            </TabPanel>\r\n            <TabPanel header=\"URL\">\r\n              <div className=\"p-field\">\r\n                <label>URL - KML</label>\r\n                <div className=\"p-inputgroup\">\r\n                  <InputText placeholder='URL...'\r\n                    value={data.url}\r\n                    onChange={e => this.changeURL(e.target.value)}\r\n                    style={{ width: '100%' }}\r\n                  />\r\n                  <Button\r\n                    icon={ loading ? \"pi pi-spin pi-spinner\" : \"pi pi-search\" }\r\n                    tooltip=\"Carregar\" tooltipOptions={{position: 'bottom'}}\r\n                    disabled={loading}\r\n                    onClick={e => {\r\n                      e.preventDefault();\r\n                      this.loadFromUserURL()\r\n                    }}\r\n                  />\r\n                </div>\r\n                \r\n              </div>\r\n            </TabPanel>\r\n\r\n          </TabView>\r\n\r\n        </div>\r\n\r\n      </React.Fragment>\r\n    )\r\n  }\r\n}\r\n\r\nexport default KML;","import React, {Component} from 'react';\r\nimport { Dropdown } from 'primereact/dropdown';\r\nimport { FileUpload } from 'primereact/fileupload';\r\n\r\n\r\nclass GML extends Component {\r\n\r\n  /**\r\n   * Event handler for load file\r\n   * \r\n   * @param {Object} e \r\n   */\r\n  loadGMLFile(e) {\r\n    const { core, mainMap, viewer, data, setLoading, setData, Models, fastFetch } = this.props;\r\n    const { isUrlAppOrigin } = Models.Utils;    \r\n    const endpoint = viewer.upload_url || core.UPLOAD_URL;\r\n    const name = e.files[0].name;\r\n\r\n    const file = e.files[0];\r\n    const upload = new FormData();\r\n    upload.append('files', file);\r\n    upload.append('ext', 'xml');\r\n\r\n    setLoading(true);\r\n    const options = { method: 'POST', body: upload };\r\n    fastFetch(endpoint, options, 8000)\r\n      .then(res => res.json())\r\n      .then(res => {\r\n\r\n        // Validate response\r\n        setLoading(false);\r\n        if (!res.Success) {\r\n          //console.log(res.Message);\r\n          return setLoading(false);\r\n        }\r\n\r\n        let orginal_url = core.API_URL + res.Data.url;\r\n        let url = orginal_url;\r\n        if (!isUrlAppOrigin(url)) {\r\n          url = core.MAP_PROXY_URL + encodeURIComponent(url);\r\n        };\r\n        fetch(url)\r\n          .then(res => res.json())\r\n          .then(res => {\r\n            data.dataitems = Models.OWSModel.convertGeoJSON2Themes(res, orginal_url, name, data.crs);\r\n            setData(Object.assign({}, data));\r\n            setLoading(false);\r\n        })\r\n\r\n        // Catch download error\r\n        .catch(error => {\r\n          console.error(error);\r\n          setLoading(false);\r\n        });\r\n      })\r\n\r\n    // Catch upload error\r\n    .catch(error => {\r\n      console.error(error);\r\n      setLoading(false);\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n   * Render WMS wizard\r\n   */\r\n  render() {\r\n    const { viewer, loading, data, editField } = this.props;\r\n    return (\r\n      <React.Fragment>\r\n        <div className=\"p-fluid\">\r\n\r\n          <div className=\"p-field\">\r\n            <label>Sistema de Coordenadas</label>\r\n            <Dropdown \r\n              placeholder='Escolha o sistema de coordenadas'\r\n              options={viewer.config_json.crs_list.map(c => ({value: String(c.srid), label: c.title }))}\r\n              value={data.crs || '4326'}\r\n              onChange={(e) => editField('crs', e.value)}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"p-field\">\r\n            <label>Ficheiro GML</label>\r\n            <FileUpload \r\n              name=\"upload\"\r\n              accept=\"text/xml\"\r\n              maxFileSize={this.props.maxFileSize * 1024}\r\n              customUpload \r\n              uploadHandler={this.loadGMLFile.bind(this)}\r\n              disabled={loading}\r\n              url=\"./upload\"\r\n              chooseLabel=\"Escolher\"\r\n              uploadLabel=\"Carregar\"\r\n              cancelLabel=\"Cancelar\"              \r\n              invalidFileSizeMessageDetail=\"\"\r\n              invalidFileSizeMessageSummary={\"O ficheiro não poderá ter mais de \" + (Math.round((this.props.maxFileSize/1024) * 100) / 100) + \" MB\"}\r\n            />\r\n            { (this.props.maxFileSize && this.props.maxFileSize > 0) ?\r\n            <small id=\"upload-help\" className=\"p-warn\">Dimensão máxima do ficheiro: {Math.round((this.props.maxFileSize/1024) * 100) / 100} MB</small>\r\n            : null }            \r\n          </div>\r\n        </div>\r\n\r\n      </React.Fragment>\r\n    )\r\n  }\r\n}\r\n\r\nexport default GML;","import React, {Component} from 'react';\r\nimport { Dropdown } from 'primereact/dropdown';\r\nimport { FileUpload } from 'primereact/fileupload';\r\n\r\n\r\nclass DXF extends Component {\r\n\r\n  /**\r\n   * Event handler for load file\r\n   * \r\n   * @param {Object} e \r\n   */\r\n  loadDXFFile(e) {\r\n    const { core, mainMap, viewer, data, setLoading, setData, Models, fastFetch } = this.props;\r\n    const { isUrlAppOrigin } = Models.Utils;\r\n    const endpoint = viewer.upload_url || core.UPLOAD_URL;\r\n    const name = e.files[0].name;\r\n\r\n    const file = e.files[0];\r\n    const upload = new FormData();\r\n    upload.append('files', file);\r\n    upload.append('ext', 'dxf');\r\n\r\n    setLoading(true);\r\n    const options = { method: 'POST', body: upload };\r\n    fastFetch(endpoint, options, 8000)\r\n      .then(res => res.json())\r\n      .then(res => {\r\n\r\n        // Validate response\r\n        setLoading(false);\r\n        if (!res.Success) {\r\n          //console.log(res.Message);\r\n          return setLoading(false);\r\n        }\r\n\r\n        let orginal_url = core.API_URL + res.Data.url;\r\n        let url = orginal_url;\r\n        if (!isUrlAppOrigin(url)) {\r\n          url = core.MAP_PROXY_URL + encodeURIComponent(url);\r\n        };        \r\n        fetch(url)\r\n          .then(res => res.json())\r\n          .then(res => {\r\n            data.dataitems = Models.OWSModel.convertGeoJSON2Themes(res, orginal_url, name, data.crs);\r\n            setData(Object.assign({}, data));\r\n            setLoading(false);\r\n        })\r\n\r\n          // Catch download error\r\n          .catch(error => {\r\n            console.error(error);\r\n            setLoading(false);\r\n          });\r\n      })\r\n      \r\n      // Catch upload error\r\n      .catch(error => {\r\n        console.error(error);\r\n        setLoading(false);\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Render DXF wizard\r\n   */\r\n  render() {\r\n    const { viewer, loading, data, editField } = this.props;\r\n    return (\r\n      <React.Fragment>\r\n        <div className=\"p-fluid\">\r\n\r\n          <div className=\"p-field\">\r\n            <label>Sistema de Coordenadas</label>\r\n            <Dropdown \r\n              placeholder='Escolha o sistema de coordenadas'\r\n              options={viewer.config_json.crs_list.map(c => ({value: String(c.srid), label: c.title }))}\r\n              value={data.crs || '4326'}\r\n              onChange={(e) => editField('crs', e.value)}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"p-field\">\r\n            <label>Ficheiro DXF</label>\r\n            <FileUpload \r\n              name=\"upload\"\r\n              accept=\".dxf\"\r\n              maxFileSize={this.props.maxFileSize * 1024}\r\n              customUpload \r\n              uploadHandler={this.loadDXFFile.bind(this)}\r\n              disabled={loading}\r\n              url=\"./upload\"\r\n              chooseLabel=\"Escolher\"\r\n              uploadLabel=\"Carregar\"\r\n              cancelLabel=\"Cancelar\"              \r\n              invalidFileSizeMessageDetail=\"\"\r\n              invalidFileSizeMessageSummary={\"O ficheiro não poderá ter mais de \" + (Math.round((this.props.maxFileSize/1024) * 100) / 100) + \" MB\"}\r\n            />\r\n            { (this.props.maxFileSize && this.props.maxFileSize > 0) ?\r\n            <small id=\"upload-help\" className=\"p-warn\">Dimensão máxima do ficheiro: {Math.round((this.props.maxFileSize/1024) * 100) / 100} MB</small>\r\n            : null }            \r\n          </div>\r\n        </div>\r\n\r\n      </React.Fragment>\r\n    )\r\n  }\r\n}\r\n\r\nexport default DXF;","import React, {Component} from 'react';\r\nimport { InputText } from 'primereact/inputtext';\r\nimport { v4 as uuidV4 } from 'uuid'\r\n\r\nclass Group extends Component {\r\n\r\n  componentDidMount() {\r\n    let { data, setData, setSelected } = this.props;\r\n    \r\n    // Create theme\r\n    let theme = {\r\n      \"type\": \"GROUP\",\r\n      \"active\": true,\r\n      \"id\": String(uuidV4()),\r\n      \"title\": \"Grupo\",\r\n      \"opacity\": 1,\r\n      \"open\": true,\r\n      \"children\": [],\r\n      \"selectable\": false\r\n    };\r\n\r\n    // Add if not exists\r\n    if (data.dataitems.length === 0) data.dataitems.push(theme);\r\n    else if (data.dataitems[0].type !== 'GROUP') data.dataitems = [theme];\r\n    else theme = data.dataitems[0];\r\n    setData(data);\r\n\r\n    // Create selection\r\n    // TODO: fix without timeout\r\n    setTimeout(() => {\r\n      let selection = {};\r\n      selection[theme.id] = { checked: true, partialChecked: false };\r\n      setSelected(selection);\r\n    }, 0);\r\n  }\r\n\r\n  changeName(value) {\r\n    let { data, editField, setSelected } = this.props;\r\n    let title =  value.trim();\r\n    if (title) {\r\n      let theme = data.dataitems[0];\r\n      if (theme) {\r\n        theme.title = title;\r\n        editField('dataitems', Object.assign([], data.dataitems));\r\n      } else {\r\n        theme = {\r\n          \"type\": \"GROUP\",\r\n          \"active\": true,\r\n          \"id\": String(uuidV4()),\r\n          \"title\": title,\r\n          \"opacity\": 1,\r\n          \"open\": true,\r\n          \"children\": [],\r\n          \"selectable\": false\r\n        };\r\n        editField('dataitems', Object.assign([], [theme]));      \r\n      }\r\n      let selection = {};\r\n      selection[theme.id] = { checked: true, partialChecked: false };\r\n      setSelected(selection);\r\n    } else {\r\n      editField('dataitems', []);\r\n      setSelected([]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Render WMS wizard\r\n   */\r\n  render() {\r\n    const { data } = this.props;\r\n    const theme = data.dataitems.length ? data.dataitems[0] : null;\r\n\r\n    return (\r\n      <React.Fragment>\r\n        <InputText placeholder='Nome do grupo...'\r\n          value={theme ? theme.title : ''}\r\n          onChange={e => this.changeName(e.target.value)}\r\n          style={{ width: '100%' }}\r\n        />\r\n      </React.Fragment>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Group;\r\n","export default function layerNode(layer, selected) {\r\n  let node = {\r\n    key: layer.id,\r\n    label: layer.title,\r\n    data: layer,\r\n    selectable: true,\r\n    children: []\r\n  };\r\n  if (layer.children) {\r\n    node.children = layer.children.map(l => layerNode(l, selected));\r\n  } else node['leaf'] = true;\r\n  return node;\r\n}","import React, { useEffect, useState } from 'react';\r\nimport { Tree } from 'primereact/tree';\r\nimport layerNode from './layerNode';\r\n\r\nconst WMSThemesSelector = ({ themes, selected, setSelected, readOnly, expandAllGroups }) => {\r\n  const [expandedKeys, setExpandedKeys] = useState({});\r\n  const [isSelectAll, setIsSelectAll] = useState(false);\r\n  const nodes = themes.map(l => layerNode(l));\r\n\r\n  function expandNode(node) {\r\n    let newExpandedKeys = { ...expandedKeys };\r\n    if (node.children && node.children.length) {\r\n      newExpandedKeys[node.key] = true;\r\n      for (let child of node.children) {\r\n        expandNode(child);\r\n      }\r\n    }\r\n    setExpandedKeys(newExpandedKeys);\r\n  }\r\n\r\n  function selectAll(checked, items, selection, lvl = 0) {\r\n    if (!checked) return setSelected({});\r\n    items.forEach((n, i) => {\r\n      selection[n.key] = { checked, partial: false };\r\n      if (n.children) selectAll(checked, n.children, selection, lvl+1);\r\n    })\r\n    if (lvl === 0) setSelected(selection);\r\n  }\r\n\r\n  // Select/deselect all\r\n  useEffect(() => {\r\n    if (!setSelected) return;\r\n    selectAll(isSelectAll, nodes, {});\r\n  }, [isSelectAll]);\r\n\r\n  // Expand all on\r\n  /*\r\n  useEffect(() => {\r\n    for (let node of nodes) {\r\n      expandNode(node);\r\n    }\r\n  }, []);\r\n  */  \r\n  // Expand all on\r\n  useEffect(() => {\r\n    if (expandAllGroups) {\r\n      let newExpandedKeys = {};\r\n      const getGroupsKeys =  function (node) {\r\n        if (node.children && node.children.length) {\r\n          newExpandedKeys[node.key] = true;\r\n          for (let child of node.children) {\r\n            getGroupsKeys(child);\r\n          }\r\n        }\r\n      }\r\n      for (let node of nodes) {\r\n        getGroupsKeys(node);\r\n      }      \r\n      setExpandedKeys(newExpandedKeys);\r\n    } else {\r\n      for (let node of nodes) {\r\n        expandNode(node);\r\n      }\r\n    }\r\n  }, [themes]);   \r\n\r\n  if (!nodes.length) return null;\r\n\r\n  return (\r\n    <React.Fragment>\r\n\r\n      { !!setSelected && nodes.length ? (\r\n        <h5>\r\n          &nbsp;\r\n          <a style={{float: 'right', cursor: 'pointer'}}\r\n            onClick={e => setIsSelectAll(!isSelectAll)}>\r\n            Selecionar/Remover Todos\r\n          </a>\r\n        </h5>\r\n      ) : null }\r\n\r\n      <Tree\r\n        value={nodes}\r\n        expandedKeys={expandedKeys}\r\n        filter={readOnly || nodes.length === 0 ? false : true}\r\n        filterMode={readOnly ? null :  \"lenient\"}\r\n        selectionMode={readOnly ? null : \"checkbox\"}\r\n        selectionKeys={readOnly ? null : selected}\r\n        onSelectionChange={e => { \r\n          /*console.log(e.value);*/\r\n          const sel = {};\r\n          Object.keys(e.value).forEach(key => {\r\n            const selItem = e.value[key];\r\n            if (selItem.checked || selItem.partialChecked) sel[key] = {...selItem};\r\n          });\r\n          setSelected(sel);\r\n        }}\r\n        onToggle={e => { /*console.log(e.value);*/ setExpandedKeys(e.value);}} \r\n      />\r\n\r\n    </React.Fragment>\r\n  );\r\n}\r\n\r\nexport default WMSThemesSelector;","import React, { useState, useEffect } from 'react';\r\nimport { Tree } from 'primereact/tree';\r\nimport { Dropdown } from 'primereact/dropdown';\r\nimport layerNode from './layerNode';\r\n\r\nconst WMTSThemesSelector = ({ themes, tileMatrixSet, data, setData, selected, setSelected, readOnly }) => {\r\n  const [expandedKeys, setExpandedKeys] = useState({});\r\n  const [isSelectAll, setIsSelectAll] = useState(false);\r\n  const [tilematrixset, setTilematrixset] =useState();\r\n  const nodes = themes.map(l => layerNode(l));\r\n  const matrixItems = tileMatrixSet.map( m => ({ label: m.Identifier, value: m.Identifier }));\r\n\r\n  function expandNode(node) {\r\n    let newExpandedKeys = { ...expandedKeys };\r\n    if (node.children && node.children.length) {\r\n      newExpandedKeys[node.key] = true;\r\n      for (let child of node.children) {\r\n        expandNode(child);\r\n      }\r\n    }\r\n    setExpandedKeys(newExpandedKeys);\r\n  }\r\n\r\n  function selectAll(checked, items, selection, lvl = 0) {\r\n    if (!checked) return setSelected({});\r\n    items.forEach((n, i) => {\r\n      selection[n.key] = { checked, partial: false };\r\n      if (n.children) selectAll(checked, n.children, selection, lvl+1);\r\n    })\r\n    if (lvl === 0) setSelected(selection);\r\n  }\r\n\r\n  function selectTileMatrixSet(value) {\r\n    const dataitems = data.dataitems.map( t => { return {...t, wmts_tilematrixset: value }});\r\n    setData({...data, dataitems: dataitems});\r\n    setTilematrixset(value);\r\n  }\r\n\r\n  // Select/deselect all\r\n  useEffect(() => {\r\n    if (!setSelected) return;\r\n    selectAll(isSelectAll, nodes, {});\r\n  }, [isSelectAll]);\r\n\r\n  // Expand all on\r\n  useEffect(() => {\r\n    for (let node of nodes) {\r\n      expandNode(node);\r\n    }\r\n  }, []);\r\n\r\n  if (!nodes.length) return null;\r\n\r\n  return (\r\n    <div>\r\n      <div className=\"p-d-flex p-mt-2 p-mb-2\">\r\n        <Dropdown options={matrixItems} value={tilematrixset} showClear placeholder=\"Selecione a Grelha\" style={{ width: \"100%\"}}\r\n        onChange={ e => selectTileMatrixSet(e.value)}/>    \r\n      </div>\r\n\r\n      { !!setSelected && nodes.length ? (\r\n        <h5>\r\n          &nbsp;\r\n          <a style={{float: 'right', cursor: 'pointer'}}\r\n            onClick={e => setIsSelectAll(!isSelectAll)}>\r\n            Selecionar/Remover Todos\r\n          </a>\r\n        </h5>\r\n      ) : null }\r\n\r\n      <Tree\r\n        value={nodes}\r\n        expandedKeys={expandedKeys}\r\n        filter={readOnly || nodes.length === 0 ? false : true}\r\n        filterMode={readOnly ? null :  \"lenient\"}\r\n        selectionMode={readOnly ? null : \"checkbox\"}\r\n        selectionKeys={readOnly ? null : selected}\r\n        onSelectionChange={e => {\r\n          /*console.log(e.value);*/\r\n          const sel = {};\r\n          Object.keys(e.value).forEach(key => {\r\n            const selItem = e.value[key];\r\n            if (selItem.checked || selItem.partialChecked) sel[key] = {...selItem};\r\n          });\r\n          setSelected(sel);        \r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default WMTSThemesSelector;","import React, { useState, useEffect } from 'react';\r\nimport { Tree } from 'primereact/tree';\r\nimport layerNode from './layerNode';\r\n\r\nconst ThemesSelector = ({ themes, selected, setSelected, readOnly, hide }) => {\r\n  const [expandedKeys, setExpandedKeys] = useState({});\r\n  const [isSelectAll, setIsSelectAll] = useState(false);\r\n  const nodes = themes.map(l => layerNode(l));\r\n\r\n  function expandNode(node) {\r\n    let newExpandedKeys = { ...expandedKeys };\r\n    if (node.children && node.children.length) {\r\n      newExpandedKeys[node.key] = true;\r\n      for (let child of node.children) {\r\n        expandNode(child);\r\n      }\r\n    }\r\n    setExpandedKeys(newExpandedKeys);\r\n  }\r\n\r\n  function selectAll(checked, items, selection, lvl = 0) {\r\n    if (!checked) return setSelected({});\r\n    items.forEach((n, i) => {\r\n      selection[n.key] = { checked, partial: false };\r\n      if (n.children) selectAll(checked, n.children, selection, lvl+1);\r\n    })\r\n    if (lvl === 0) setSelected(selection);\r\n  }\r\n\r\n  // Select/deselect all\r\n  useEffect(() => {\r\n    if (!setSelected) return;\r\n    selectAll(isSelectAll, nodes, {});\r\n  }, [isSelectAll]);\r\n\r\n  // Expand all on\r\n  useEffect(() => {\r\n    for (let node of nodes) {\r\n      expandNode(node);\r\n    }\r\n  }, []);\r\n\r\n  if (!nodes.length) return null;\r\n  if (hide) return null;\r\n\r\n  return (\r\n    <React.Fragment>\r\n\r\n      { !!setSelected && nodes.length ? (\r\n        <h5>\r\n          &nbsp;\r\n          <a style={{float: 'right', cursor: 'pointer'}}\r\n            onClick={e => setIsSelectAll(!isSelectAll)}>\r\n            Selecionar/Remover Todos\r\n          </a>\r\n        </h5>\r\n      ) : null }\r\n\r\n      <Tree\r\n        value={nodes}\r\n        expandedKeys={expandedKeys}\r\n        filter={readOnly || nodes.length < 10 ? false : true}\r\n        filterMode={readOnly ? null :  \"lenient\"}\r\n        selectionMode={readOnly ? null : \"checkbox\"}\r\n        selectionKeys={readOnly ? null : selected}\r\n        onSelectionChange={e => {\r\n          /*console.log(e.value);*/\r\n          const sel = {};\r\n          Object.keys(e.value).forEach(key => {\r\n            const selItem = e.value[key];\r\n            if (selItem.checked || selItem.partialChecked) sel[key] = {...selItem};\r\n          });\r\n          setSelected(sel);        \r\n        }}\r\n      />\r\n\r\n    </React.Fragment>\r\n  );\r\n}\r\n\r\nexport default ThemesSelector;","import React, { useState } from 'react';\r\nimport { Button } from 'primereact/button';\r\nimport WMS from './type/WMS';\r\nimport WMTS from './type/WMTS';\r\nimport WFS from './type/WFS';\r\nimport ArcGISMap from './type/ArcGISMap';\r\nimport Shapefile from './type/Shapefile';\r\nimport GeoJSON from './type/GeoJSON';\r\nimport KML from './type/KML';\r\nimport GML from './type/GML';\r\nimport DXF from './type/DXF';\r\nimport Group from './type/Group';\r\nimport { Toast } from 'primereact/toast';\r\nimport { InputText } from 'primereact/inputtext';\r\nimport WMSThemesSelector from './WMSThemesSelector';\r\nimport WMTSThemesSelector from './WMTSThemesSelector';\r\nimport ThemesSelector from './ThemesSelector';\r\n\r\nlet toastEl = null;\r\n\r\nexport default function WizardStepData(props) {\r\n\r\n  const { Models, fastFetch } = props;\r\n  let [data, setData] = useState(props.wizardData);\r\n  const [filter, setFilter] = useState('');\r\n  const [selected, setSelected] = useState({});\r\n  const { getWindowSize, showOnPortal } = Models.Utils;\r\n  const winSize = getWindowSize();\r\n\r\n  //Set default upload max file size (2MB)\r\n  //Filesize configuration is in KB\r\n  let maxFileSize = 2048;\r\n  if (props.viewer && props.viewer.upload_maxfilesize) {\r\n    maxFileSize = props.viewer.upload_maxfilesize;\r\n  }\r\n  if (props.record && props.record.config_json && props.record.config_json.upload_maxfilesize) {\r\n    maxFileSize = props.record.config_json.upload_maxfilesize;\r\n  }\r\n\r\n  function editField(field, value) {\r\n    setData({ ...data, [field]: value });\r\n  }\r\n\r\n  function getUrlHistory() {\r\n    const items = props.cookies || [];\r\n    return items;\r\n  }\r\n\r\n  function setError(message) {\r\n    toastEl.show({\r\n      severity: 'error',\r\n      summary: 'Ocorreu um erro inesperado',\r\n      detail: message,\r\n      sticky: true\r\n    });\r\n  }\r\n\r\n  function saveSelection() {\r\n    const filterSelectedLayerItems = function (items) {\r\n      const selectedItems = items.filter(l => {\r\n        if (l.children) {\r\n          const children = filterSelectedLayerItems(l.children);\r\n          l.children = children;\r\n        }\r\n        return Object.keys(selected).includes(l.id);\r\n      });\r\n      return selectedItems;\r\n    }\r\n\r\n    let clone = JSON.parse(JSON.stringify(data.dataitems));\r\n    clone = filterSelectedLayerItems(clone);\r\n    data.items = clone;\r\n     \r\n    props.onSave(data);\r\n  }\r\n\r\n  let TypeComponent = null;\r\n  switch(data.type) {\r\n    case 'wms': TypeComponent = WMS; break;\r\n    case 'wmts': TypeComponent = WMTS; break;\r\n    case 'wfs': TypeComponent = WFS; break;\r\n    case 'arcgismap': TypeComponent = ArcGISMap; break;\r\n    case 'shape': TypeComponent = Shapefile; break;\r\n    case 'geojson': TypeComponent = GeoJSON; break;\r\n    case 'kml': TypeComponent = KML; break;\r\n    case 'gml': TypeComponent = GML; break;\r\n    case 'dxf': TypeComponent = DXF; break;\r\n    case 'group': TypeComponent = Group; break;\r\n    default: TypeComponent = null;\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      {showOnPortal(<Toast ref={(el) => toastEl = el} />)}\r\n      \r\n      <TypeComponent\r\n        core={props.core}\r\n        auth={props.auth}\r\n        record={props.record}\r\n        Models={props.Models}\r\n        data={data}\r\n        mainMap={props.mainMap}\r\n        viewer={props.viewer}\r\n        loading={props.loading}\r\n        setLoading={props.setLoading}\r\n        setError={setError}\r\n        setData={setData}\r\n        setSelected={setSelected}\r\n        getUrlHistory={getUrlHistory}\r\n        editField={editField}\r\n        winSize={winSize}\r\n        fastFetch={fastFetch}\r\n        maxFileSize={maxFileSize}\r\n      />\r\n\r\n      {{wms: <WMSThemesSelector\r\n          core={props.core}\r\n          record={props.record}\r\n          themes={data.dataitems}\r\n          selected={selected}\r\n          filter={filter}\r\n          setSelected={setSelected}\r\n        />,\r\n        wmts: <WMTSThemesSelector\r\n          core={props.core}\r\n          record={props.record}     \r\n          themes={data.dataitems}\r\n          tileMatrixSet={data.wmtsTileMatrixSet || []}\r\n          selected={selected}\r\n          filter={filter}\r\n          setSelected={setSelected}\r\n          data={data}\r\n          setData={setData}\r\n        />\r\n      }[props.wizardData.type] || <ThemesSelector\r\n          core={props.core}\r\n          record={props.record}\r\n          hide={data.type === 'group'}\r\n          themes={data.dataitems}\r\n          selected={selected}\r\n          filter={filter}\r\n          setSelected={setSelected}\r\n        />\r\n      }\r\n\r\n      <div style={ {padding: \"0.571rem 1rem\", textAlign: \"right\"} }>\r\n        <Button \r\n          onClick={e => saveSelection()} \r\n          label=\"Seguinte\" \r\n          disabled={props.loading || (Object.keys(selected).length === 0) || \r\n            (Object.keys(selected).length === 1 && !selected[Object.keys(selected)[0]].checked) }\r\n          style={{ marginTop: '1em' }}\r\n        />\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","import React from 'react';\r\nimport { Button } from 'primereact/button';\r\nimport { Message } from 'primereact/message'\r\nimport ThemesSelector from './ThemesSelector';\r\nimport WMSThemesSelector from './WMSThemesSelector';\r\n\r\nexport default function WizardStepConfirm(props) {\r\n  let data = props.wizardData;\r\n  return (\r\n    <div>\r\n      \r\n      <h1>Confirmar</h1>\r\n      \r\n      { data.items && data.items.length > 0 ? (\r\n        data.type === 'wms' ? (\r\n          <WMSThemesSelector \r\n            themes={data.items}\r\n            selected={data.selected}\r\n            readOnly={true}\r\n            expandAllGroups={true}\r\n          />\r\n        ) : (\r\n          <ThemesSelector\r\n            themes={data.items}\r\n            selected={data.selected}\r\n            readOnly={true}\r\n          />\r\n        ) \r\n      ) :\r\n        <Message\r\n          severity=\"info\"\r\n          text={\"Não há nenhum tema selecionado. Volte à etapa anterior e selecione pelo menos um tema.\"} \r\n        />      \r\n      }\r\n\r\n      <div style={ {padding: \"0.571rem 1rem\", textAlign: \"right\"} }>\r\n        <Button \r\n          onClick={e => props.onSave(data)} \r\n          label=\"Concluir\"\r\n          disabled={props.loading || data.items.length === 0}\r\n          style={{ marginTop: '1em' }}\r\n        />\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","import React, { useState } from 'react';\r\nimport {Steps} from 'primereact/steps';\r\nimport WizardStepType from './wizard/stepType';\r\nimport WizardStepData from './wizard/stepData';\r\nimport WizardStepConfirm from './wizard/stepConfirm';\r\nimport { Button } from 'primereact/button';\r\nimport { Panel } from 'primereact/panel';\r\nimport './index.css'\r\nimport { useEffect } from 'react';\r\n\r\nconst items = [\r\n  { label: 'Tipo' },\r\n  { label: 'Dados' },\r\n  { label: 'Confirmar' }\r\n];\r\n\r\nconst source_types = [\r\n  { value: 'wms', label: 'WMS - Web Map service' },\r\n  { value: 'wmts', label: 'WMTS - Web Map Tile Service' },\r\n  { value: 'wfs', label: 'WFS - web Feature Service' },\r\n  { value: 'arcgismap', label: 'ArcGIS REST - Map Service' },\r\n  { value: 'shape', label: 'Shapefile - ficheiro .zip contendo .shp' },\r\n  { value: 'kml', label: 'KML - Keyhole Markup Language' },\r\n  { value: 'gml', label: 'GML - Geographic Markup Language' },\r\n  { value: 'geojson', label: 'GeoJSON' },\r\n  { value: 'dxf', label: 'DXF (v2000)' },\r\n  { value: 'group', label: 'Grupo de Temas' },\r\n];\r\n\r\nconst initialData = {\r\n  crs: \"4326\",\r\n  dataitems: [],\r\n  get_feature_info_format: \"text/plain\",\r\n  get_map_format: \"image/png\",\r\n  items: [],\r\n  type: \"\",\r\n  url: \"\",\r\n  wmsIgnoreServiceUrl: true,\r\n  wmsTiled: true,\r\n  wmsVersion: \"1.3.0\",\r\n  wmtsIgnoreServiceUrl: true,\r\n  wmtsVersion: \"1.0.0\"\r\n};\r\n\r\n/**\r\n * Main menu component\r\n */\r\nexport function MainMenu({ className, config, actions, record }) {\r\n  const component_cfg = record.config_json || {};\r\n  const title = record.title || 'Adicionar Temas';\r\n  const header = component_cfg.header || title;\r\n\r\n  return (\r\n    <Button\r\n      title={title}\r\n      className={className}\r\n      icon=\"pi pi-plus-circle\"\r\n      style={{ margin: '0.5em 1em' }}\r\n      onClick={e => config.dispatch(actions.viewer_set_selectedmenu(record.id))}\r\n    />\r\n  )\r\n}\r\n\r\nexport default function Main(props) {\r\n  const component_cfg = props.record.config_json;\r\n  const title = props.record.title || 'Adicionar Temas';\r\n  const header = component_cfg.header || title;\r\n\r\n  const [activeIndex, setActiveIndex] = useState(\r\n    props.config.data.type ? (props.config.data.items.length ? 2 : 1) : 0\r\n  );\r\n  const [wizardData, setWizardData] = useState(props.config.data);\r\n  const [loading, setLoading] = useState(false);\r\n  const [types, setTypes] = useState(source_types);\r\n\r\n  useEffect(() => {\r\n    if (component_cfg && component_cfg.exclude_types && component_cfg.exclude_types.length) {\r\n      const filtered_types = types.filter(t => !component_cfg.exclude_types.includes(t.value));\r\n      setTypes(filtered_types);\r\n    }\r\n  }, []);\r\n\r\n\r\n  function reset() {\r\n    setWizardData(initialData);\r\n  }\r\n\r\n  function onComplete(wizardData) {\r\n    const { viewer_add_themes, viewer_set_selectedmenu, layers_set_checked, layers_set_opened } = props.actions;\r\n    const { viewer, mainMap, dispatch } = props.config;\r\n\r\n    // Add themes to viewer\r\n    if (dispatch && viewer_add_themes) {\r\n\r\n      const simpleLayers = [];\r\n      const allIds = [];\r\n      const parentIds = [];\r\n\r\n      const getSimpleLayers = function (items) {\r\n        items.forEach(item => {\r\n          if (item.children && item.children.length) {\r\n            getSimpleLayers(item.children);\r\n          } else {\r\n            simpleLayers.push(item);\r\n          }\r\n        });\r\n      }\r\n\r\n      const addLayerItems = function (items, parent) {\r\n        items.forEach(item => {\r\n          allIds.push(item.id);\r\n          \r\n          let children = [];\r\n          if (item.children && item.children.length) {\r\n            children =  [...item.children];\r\n            item.type = 'GROUP'\r\n            item.children = [];\r\n\r\n            parentIds.push(item.id);\r\n          }\r\n\r\n          if (!parent) {\r\n            dispatch(viewer_add_themes('main', [item]));\r\n          } else {\r\n            dispatch(viewer_add_themes(parent.id, [item]));            \r\n          }\r\n\r\n          if (children && children.length) {\r\n            addLayerItems(children, item);\r\n          }\r\n        })       \r\n      }\r\n\r\n      getSimpleLayers(wizardData.items);\r\n      if (simpleLayers && simpleLayers.length === 1) {\r\n        addLayerItems(simpleLayers, null);\r\n      } else { \r\n        addLayerItems(wizardData.items, null);\r\n      }\r\n\r\n      if (parentIds.length && props.record.config_json && props.record.config_json.layer_group_opened) {\r\n        let opened = [...viewer.config_json.opened];\r\n        opened = opened.concat(parentIds);\r\n        dispatch(layers_set_opened(opened));\r\n      }\r\n\r\n      if (allIds.length && props.record.config_json && props.record.config_json.layer_visible) {\r\n        let checked = [...viewer.config_json.checked];\r\n        checked = checked.concat(allIds);\r\n        dispatch(layers_set_checked(checked));\r\n      }\r\n\r\n      // Reset\r\n      reset();\r\n      setActiveIndex(0);\r\n      dispatch(viewer_set_selectedmenu('toc'));\r\n    }\r\n\r\n    // TODO: Reset wizard?\r\n  }\r\n\r\n  // Validate change step\r\n  function changeStep(previous, next) {\r\n    if (next > 0 && !wizardData.type) setActiveIndex(previous);\r\n    else if (next > 1 && !wizardData.items.length > 0) setActiveIndex(previous);\r\n    else setActiveIndex(next);\r\n  }\r\n\r\n  function renderContent() {\r\n    let step = null;\r\n    switch(activeIndex) {\r\n      case 2:\r\n        step =\r\n          <WizardStepConfirm\r\n            core={props.core}\r\n            auth={props.config.auth}\r\n            record={props.record}\r\n            wizardData={wizardData}\r\n            onSave={e => onComplete(wizardData)}\r\n            onCancel={null}\r\n          />\r\n        break\r\n      case 1:\r\n        step =\r\n          <WizardStepData\r\n            core={props.core}\r\n            auth={props.config.auth}\r\n            record={props.record} \r\n            Models={props.config.Models}\r\n            wizardData={wizardData}\r\n            mainMap={props.config.mainMap}\r\n            viewer={props.config.viewer}\r\n            loading={loading}\r\n            setLoading={setLoading}\r\n            onSave={stepdata => {\r\n              setWizardData(stepdata);\r\n              setActiveIndex(activeIndex+1);\r\n            }}\r\n            onCancel={null}\r\n            fastFetch={fastFetch}\r\n          />\r\n        break\r\n      case 0:\r\n      default:\r\n        step =\r\n          <WizardStepType\r\n            core={props.core}\r\n            auth={props.config.auth}\r\n            record={props.record}\r\n            types={types}\r\n            initialData={initialData}\r\n            wizardData={wizardData} \r\n            onSave={stepdata => {\r\n              setWizardData(stepdata);\r\n              setActiveIndex(activeIndex+1);\r\n            }}\r\n            onCancel={null}\r\n          />\r\n    }\r\n\r\n    // Render content\r\n    return (\r\n      <div id=\"themewizard\">\r\n        <Steps \r\n          model={items} \r\n          activeIndex={activeIndex} \r\n          onSelect={(e) => changeStep(activeIndex, e.index)} \r\n          readOnly={false}\r\n        />\r\n        { step }\r\n      </div>\r\n    )\r\n  }\r\n\r\n  const { as } = props;\r\n  if (as === 'panel') return (\r\n    <Panel header={header}>\r\n      { renderContent() }\r\n    </Panel>\r\n  )\r\n\r\n  // Render content\r\n  return renderContent();\r\n  \r\n}\r\n\r\n// Fetch with timeout handler\r\nfunction fastFetch(url, options, timeout = 8000) {\r\n  return new Promise((resolve, reject) => {\r\n    const controller = new AbortController();\r\n    const toptions = { ...options, signal: controller.signal };\r\n\r\n    // Hanle fetch timeout\r\n    const fetchTimeout = setTimeout(() => {\r\n      controller.abort();\r\n      console.log('Fetch timeout at ' + timeout + ' ms')\r\n      resolve({});\r\n    }, timeout);\r\n\r\n    fetch(url, toptions)\r\n      .then(res => {\r\n        clearTimeout(fetchTimeout);\r\n        resolve(res);\r\n      })\r\n      // Catch upload error\r\n      .catch(error => {\r\n        clearTimeout(fetchTimeout);\r\n        reject(error);\r\n      });\r\n  })\r\n}","import React, { useState } from 'react'\r\n\r\nexport default function DragSlot({ i, parent, action, deep }) {\r\n\r\n  const [over, setOver] = useState(false)\r\n  \r\n  function onDragEnter(ev) {\r\n    ev.preventDefault();\r\n    ev.stopPropagation();\r\n    setOver(true);\r\n  }\r\n  \r\n  function onDragLeave(ev) {\r\n    ev.preventDefault();\r\n    ev.stopPropagation();\r\n    setOver(false);\r\n  }\r\n  \r\n  function onDrop(ev, a, parent) {\r\n    ev.stopPropagation();\r\n    setOver(false);\r\n    let from = ev.dataTransfer.getData(\"index\");\r\n    from = from.split(',');\r\n    let to = [a, parent];\r\n    action(from[0], from[1], parseInt(to[0], 10), to[1]);\r\n  };\r\n\r\n  function onDragOver(ev) {\r\n    ev.preventDefault();\r\n  };\r\n\r\n  //if (deep === 0) return null;\r\n  return (\r\n    <li className={\"drag-slot\" + (over ? \" drag-over\" : \"\")} \r\n      data-deep={deep}\r\n      onDrop={e => onDrop(e, i, parent) }\r\n      onDragOver={e => onDragOver(e)}\r\n      onDragLeave={e => onDragLeave(e)}\r\n      onDragEnter={e => onDragEnter(e)}></li>\r\n  )\r\n}","import React from \"react\";\r\n\r\nclass DraggableItem extends React.Component {\r\n\r\n  onDragStart = (ev, id, parent) => {\r\n    ev.stopPropagation();\r\n    const data = [id, parent].join(',');\r\n    ev.dataTransfer.setData(\"index\", data);\r\n    this.props.onDragStart();\r\n  };\r\n\r\n  render() {\r\n    if (this.props.draggable === false) {\r\n      const { id } = this.props;\r\n      return (\r\n        <li data-id={id}>\r\n          {this.props.children}\r\n        </li>\r\n      );\r\n    }\r\n\r\n    const { i, parent, id } = this.props;\r\n    return (\r\n      <li data-id={id}\r\n        draggable\r\n        className=\"draggable\"\r\n        onDragStart={e => this.onDragStart(e, id, parent)}>\r\n        {this.props.children}\r\n      </li>\r\n    );\r\n\r\n  }\r\n\r\n}\r\n\r\nexport default DraggableItem;","import React, { useEffect, useState } from 'react'\r\n\r\n//Cache Arcgis Legend requests\r\nconst legendCache = {};\r\n\r\nexport default function LegendArcGIS({ data, core, actions, models }) {\r\n\r\n  const { Utils } = models;\r\n  const { isUrlAppOrigin } = Utils;\r\n\r\n  const type = data.legend_type || 'image';\r\n  const label = data.legend_label || 'Legenda';\r\n\r\n  const [layers, setLayers] = useState([]);\r\n\r\n  useEffect(() => {\r\n    if (!data?.url) return;\r\n    \r\n    let url = `${data.url}/legend?f=pjson`;\r\n\r\n    if (!layers.length && legendCache[data.url]) {\r\n      const layers = legendCache[data.url].layers.filter(l => data.layerId.includes(l.layerId));\r\n      setLayers(layers || []);\r\n    } else {\r\n      if (!isUrlAppOrigin(url)) {\r\n        url = core.MAP_PROXY_URL + encodeURIComponent(url);\r\n      }\r\n      \r\n      fetch(url)\r\n      .then(response => {\r\n        if (response.ok) {\r\n          return response.json();\r\n        }\r\n        throw response;\r\n      })\r\n      .then(legend => {\r\n        if (!legend?.layers) throw legend;\r\n        const layers = legend.layers.filter(l => data.layerId.includes(l.layerId));        \r\n        setLayers(layers);\r\n        legendCache[data.url] = legend;\r\n      }).catch(error => {\r\n        console.log(error);\r\n      })\r\n    }\r\n  },[]);\r\n\r\n  if (!layers || !layers.length) return null;\r\n\r\n  return (\r\n    <div className=\"legend-container\">\r\n      {layers.map(l => {\r\n          return (\r\n            <React.Fragment>\r\n              { layers.length > 1 && <div>{l.layerName}</div> }\r\n              { l.legend.map(leg => {\r\n                return (\r\n                      <ul>\r\n                        <li>\r\n                          <div>\r\n                            <img src={`data:${leg.contentType};base64,${leg.imageData}`} \r\n                              style={{ verticalAlign: \"middle\", maxHeight: \"25px\" }} alt=\"\"/>\r\n                            { leg.label && <span> {leg.label}</span> }\r\n                          </div>\r\n                        </li>\r\n                      </ul>\r\n                    )\r\n                  }\r\n                )\r\n              }\r\n            </React.Fragment>\r\n          )\r\n        })\r\n      }\r\n    </div>\r\n  )\r\n}","import React from 'react'\r\nimport LegendArcGIS from './LegendArcGIS';\r\n\r\nexport default function Legend({ data, core, actions, models }) {\r\n\r\n  const type = data.legend_type || 'image';\r\n  const label = data.legend_label || 'Legenda';\r\n\r\n  //Return ArcGIS Legend for arcgis source\r\n  if (data.type === 'ArcGISMap' && !data.legend_url) return (\r\n    <LegendArcGIS data={data} core={core} actions={actions} models={models} />\r\n  )\r\n\r\n  // Validate legend\r\n  if (!data.legend_url) return null;\r\n\r\n  // Render legend link\r\n  if (type === 'link') return (\r\n    <div className=\"legend-container\">\r\n      <a target=\"_blank\" title=\"Clique para abrir num separador\"\r\n        rel=\"noopener noreferrer\"\r\n        href={actions.getThemeLegendUrl(data)}>\r\n        { label }\r\n      </a>\r\n    </div>\r\n  );\r\n\r\n  // Render legend image\r\n  return (\r\n    <div className=\"legend-container\">\r\n      <a target=\"_blank\" title=\"Clique para abrir num separador\"\r\n        rel=\"noopener noreferrer\"\r\n        href={actions.getThemeLegendUrl(data)}>\r\n        <img src={actions.getThemeLegendUrl(data)} alt='' />\r\n      </a>\r\n    </div>\r\n  )\r\n}","import React from \"react\";\r\nimport Tree from \"./Tree\";\r\nimport {Checkbox} from 'primereact/checkbox';\r\nimport { RadioButton } from 'primereact/radiobutton';\r\nimport { Button } from 'primereact/button';\r\nimport DraggableItem from './DraggableItem';\r\nimport Legend from \"./Legend\";\r\n\r\nclass Node extends React.Component {\r\n\r\n  state = { detailsOpen: false }\r\n\r\n  isChecked() {\r\n    const { data, checked } = this.props;\r\n    return checked.indexOf(data.id) > -1;\r\n  }\r\n\r\n  isOpen() {\r\n    const { data, opened } = this.props;\r\n    return opened.indexOf(data.id) > -1;\r\n  }\r\n\r\n  onClickZoom(e, theme) {\r\n    e.preventDefault();\r\n    this.props.actions.onZoomTheme(theme);\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      i,\r\n      parent,\r\n      record,\r\n      data,\r\n      layers,\r\n      config,\r\n      deep,\r\n      opened,\r\n      checked,\r\n      radioName,\r\n      items,\r\n      disabled,\r\n      olmap,\r\n      editNode,\r\n      actions,\r\n      core\r\n    } = this.props;\r\n    const { detailsOpen } = this.state;\r\n\r\n    if (data.filtered) return null;\r\n\r\n    // Check theme min/max scale visibility\r\n    const onScale = actions.isThemeOnScale(olmap, data);\r\n\r\n    // Check if is group\r\n    const isGroup = data.type === 'GROUP';\r\n\r\n    // Find node children\r\n    const nodeChildren = (data.children || [])\r\n      .map(id => layers.find(l => l.id === id))\r\n      .filter(i => !!i);\r\n\r\n    // Render theme node\r\n    return (\r\n      <React.Fragment>\r\n        <DraggableItem i={i}\r\n          parent={parent}\r\n          action={actions.moveTheme}\r\n          models={config.Models}\r\n          onDragStart={this.props.onDragStart}\r\n          id={data.id}\r\n          draggable={config.draggable}>\r\n          <table style={{width: '100%'}}>\r\n            <tbody>\r\n              <tr>\r\n                <td className=\"activate\">\r\n\r\n                  { isGroup && (\r\n                    <Button\r\n                      className=\"p-button-sm p-button-text\" \r\n                      title=\"Mostrar/esconder subtemas\"\r\n                      icon={this.isOpen() ? \"pi pi-chevron-down\" : \"pi pi-chevron-right\" }\r\n                      onClick={e => actions.open(e, data.id)}\r\n                    />\r\n                  )}\r\n                  \r\n                  {!radioName ? (\r\n                    <Checkbox\r\n                      title=\"Ligar/desligar tema\"\r\n                      id={data.id}\r\n                      checked={this.isChecked()}\r\n                      onChange={e => actions.toggle(data.id, data)}\r\n                      className={!isGroup ? \"toc-leaf\" : \"\" }\r\n                    />\r\n                  ) : (\r\n                    <RadioButton \r\n                      title=\"Ligar/desligar tema\" \r\n                      id={data.id}\r\n                      name={radioName}\r\n                      checked={this.isChecked()}\r\n                      onChange={e => actions.toggle(data.id, data, items)}\r\n                      className={!isGroup ? \"toc-leaf\" : \"\" }\r\n                    />\r\n                  )}\r\n                </td>\r\n                <td className={(onScale ? \"title\" : \"title outofscale\") + (isGroup ? \" title-grp\" : \"\")}>\r\n                  { data.style_color ? <i className='pi pi-square' style={{color: `rgba(${data.style_color})` }} /> : null }\r\n                  <label htmlFor={data.id} className={\"label\" + (isGroup ? \" label-grp\" : \"\") }>\r\n                    {data.title}\r\n                  </label>\r\n                  { !data.system && (\r\n                    <div className={\"theme-tools\" + (detailsOpen ? \"\" : \" hidden\") }>\r\n\r\n                      { core.renderComponents({\r\n                        region: 'layer_tools',\r\n                        props: { layer: data, actions, viewer: config.viewer, dispatch: config.dispatch, models: config.Models, mainMap: config.mainMap },\r\n                        separator: \" \",\r\n                        parent: record\r\n                      })}\r\n\r\n                    </div>\r\n                  )}\r\n                </td>\r\n                <td className=\"buttons\">\r\n                  { data.show_details !== false ?\r\n                  <Button\r\n                    className={\"p-button-sm\" + (detailsOpen ? \"\" : \" p-button-text\") } \r\n                    title=\"Mostrar/esconder detalhes\"\r\n                    icon={this.isOpen() ? \"pi pi-cog\" : \"pi pi-cog\" }\r\n                    onClick={e => this.setState({ ...this.state, detailsOpen: !detailsOpen })}\r\n                  /> : null }\r\n                  {' '}\r\n                  { data.bbox && data.show_zoom_extent !== false ? (\r\n                    <Button\r\n                      className=\"p-button-sm p-button-text\"\r\n                      title=\"Zoom à extensão do tema\"\r\n                      icon=\"pi pi-search\"\r\n                      onClick={e => this.onClickZoom(e, data)}\r\n                    />\r\n                ) : null }\r\n                </td>\r\n              </tr>\r\n\r\n              { detailsOpen ? (\r\n                <tr>\r\n                  <td colSpan=\"3\">\r\n                    { core.renderComponents({\r\n                      region: 'layer_tools_block',\r\n                      props: { layer: data, actions, viewer: config.viewer, dispatch: config.dispatch, models: config.Models, mainMap: config.mainMap },\r\n                      separator: \" \",\r\n                      parent: record\r\n                    })}\r\n                  </td>\r\n                </tr>\r\n              ) : null }\r\n\r\n              {detailsOpen ? (\r\n                <tr className=\"detail-container\">\r\n                  <td colSpan=\"3\">                    \r\n                    { !!data.description && \r\n                      <div className=\"theme-description\" dangerouslySetInnerHTML={{__html: data.description }}></div>\r\n                    }\r\n                    <Legend data={data} core={core} actions={actions} models={config.Models}/>\r\n                  </td>\r\n                </tr>\r\n              ) : null}\r\n\r\n              {isGroup && this.isOpen() ? (\r\n                <tr>\r\n                  <td colSpan=\"3\">\r\n                    <Tree\r\n                      id={data.id}\r\n                      record={record}\r\n                      items={nodeChildren}\r\n                      layers={layers}\r\n                      config={config}\r\n                      core={core}\r\n                      deep={deep+1}\r\n                      opened={opened}\r\n                      exclusive={data.exclusive}\r\n                      checked={checked}\r\n                      actions={actions}\r\n                      disabled={!this.isChecked() || disabled}\r\n                      editNode={editNode}\r\n                      olmap={olmap}\r\n                      onDragStart={this.props.onDragStart}\r\n                    />\r\n                  </td>\r\n                </tr>\r\n              ) : null}\r\n\r\n              </tbody>\r\n          </table>\r\n        </DraggableItem>\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Node;\r\n","import React from \"react\";\r\nimport DragSlot from \"./DragSlot\";\r\nimport Node from \"./Node\";\r\n\r\nclass Tree extends React.Component {\r\n\r\n  render() {\r\n    const {\r\n      id,\r\n      core,\r\n      record,\r\n      config,\r\n      layers,\r\n      deep,\r\n      checked,\r\n      opened,\r\n      exclusive,\r\n      disabled,\r\n      olmap,\r\n      actions\r\n    } = this.props;\r\n    const items = this.props.items || [];\r\n    return (\r\n      <div>\r\n        <ul>\r\n          <DragSlot i={0}\r\n            parent={id}\r\n            action={actions.moveTheme}\r\n            deep={deep}\r\n          />\r\n          {items.map((child, i) => (\r\n            <React.Fragment key={child.id}>\r\n              <Node\r\n                i={i}\r\n                parent={id}\r\n                data={child}\r\n                record={record}\r\n                config={config}\r\n                layers={layers}\r\n                core={core}\r\n                deep={deep}\r\n                opened={opened}\r\n                radioName={exclusive ? id : \"\"}\r\n                checked={checked}\r\n                toggle={actions.toggle}\r\n                items={exclusive ? items : null}\r\n                disabled={disabled}\r\n                olmap={olmap}\r\n                actions={actions}\r\n                onDragStart={this.props.onDragStart}\r\n              />\r\n              <DragSlot i={i+1}\r\n                parent={id}\r\n                action={actions.moveTheme}\r\n                deep={deep}\r\n              />\r\n            </React.Fragment>\r\n          ))}\r\n        </ul>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Tree;\r\n","\r\nexport const convertToRGBAString = (str) => {\r\n  const fill = str.split(',');\r\n  return `rgba(${ fill[0] }, ${ fill[1] }, ${ fill[2] }, ${ fill[3] })`;\r\n}\r\n\r\nexport const convertToRGBA = (str) => {\r\n  const fill = str.split(',');\r\n  return { r: fill[0], g: fill[1], b: fill[2], a: fill[3] };\r\n}\r\n\r\n/**\r\n * Traverse layers tree\r\n * \r\n * @param {Array} items \r\n * @param {Function} cb \r\n * @param {Object} parent \r\n */\r\nexport const traverseTree = (items, cb, parent = {}) => {\r\n  items = items || [];\r\n  items.map((child, i) => {\r\n    cb(child, i, items, parent);\r\n    traverseTree(child.children, cb, child);\r\n    return child;\r\n  });\r\n};\r\n\r\nexport const traverseTreeRecursive = (items, parent, grandparent, cb) => {\r\n  if (parent.children && parent.children.length) {\r\n    items.filter(i => parent.children.includes(i.id)).forEach((node, i) => {\r\n      cb(node, parent, grandparent);\r\n      traverseTreeRecursive(items, node, parent, cb);\r\n    });\r\n  }\r\n}\r\n\r\n/*\r\nexport const traverseTreeUpRecursiveById = (node, id, level = 0) => {\r\n  if (node.id === id) return [id];\r\n  if (node.children) {\r\n    for (let i = 0; i < node.children.length; i++) {\r\n      let result = traverseTreeUpRecursiveById(node.children[i], id, level+1);\r\n      if (Array.isArray(result)) return [node.id].concat(result);\r\n    }\r\n  } else if (Array.isArray(node)) {\r\n    for (let i = 0; i < node.length; i++) {\r\n      let result = traverseTreeUpRecursiveById(node[i], id, level+1);\r\n      if (Array.isArray(result)) return [node.id].concat(result);\r\n    }\r\n  }\r\n}\r\n*/\r\n\r\nexport const findAllParents = (layers, id, level = 0) => {\r\n  let result = [];\r\n  for (let i = 0; i < layers.length; i++) {\r\n    if (Array.isArray(layers[i].children) && layers[i].children.includes(id)) {\r\n      result.push(layers[i].id);\r\n      let result2 = findAllParents(layers, layers[i].id, level+1);\r\n      result = result.concat(result2);\r\n    }\r\n  }\r\n  return result;\r\n}\r\n\r\nexport const findAllChildren = (layers, ids, level = 0) => {\r\n  let result = Object.assign([], ids);\r\n  for (let i = 0; i < layers.length; i++) {\r\n    if (ids.includes(layers[i].id) && Array.isArray(layers[i].children)) {\r\n      let result2 = findAllChildren(layers, layers[i].children, level+1);\r\n      if (Array.isArray(result2)) result = result.concat(result2);\r\n    }\r\n  }\r\n  return result;\r\n}","import React, { useRef } from 'react';\r\nimport Cookies from 'universal-cookie'\r\nimport { Button } from 'primereact/button';\r\nimport { InputText } from 'primereact/inputtext';\r\nimport Tree from './TOC/Tree';\r\nimport { traverseTree, traverseTreeRecursive, traverseTreeUpRecursiveById, findAllParents, findAllChildren } from './TOC/Model';\r\nimport './TOC/style.css';\r\nimport { Panel } from 'primereact/panel';\r\nimport { Message } from 'primereact/message';\r\nimport { Toast } from 'primereact/toast';\r\nimport { Toolbar } from 'primereact/toolbar';\r\n\r\nconst diffArray = (arr1, arr2) => arr1.concat(arr2)\r\n    .filter(val => !(arr1.includes(val) && arr2.includes(val)));\r\n\r\n/**\r\n * Actions\r\n */\r\nexport const actions = {\r\n  toc_action1: () => console.log('Called toc_helper')\r\n}\r\n\r\n/**\r\n * Main menu component\r\n */\r\nexport function MainMenu({ className, config, actions, record }) {\r\n  return (\r\n    <Button\r\n      title=\"Temas\"\r\n      className={className}\r\n      icon=\"pi pi-list\"\r\n      style={{ margin: '0.5em 1em' }}\r\n      onClick={e => config.dispatch(actions.viewer_set_selectedmenu(record.id))}\r\n    />\r\n  )\r\n}\r\n\r\nclass Main extends React.Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    \r\n    const { core } = props;\r\n    const { opened } = props.config.viewer.config_json;\r\n\r\n    const cookieAuthName = core.COOKIE_AUTH_NAME;\r\n    const API_URL = core.API_URL;\r\n\r\n    this.state = {\r\n      dragging: false,\r\n      config: props.config,\r\n      filter: '',\r\n      opened: opened || [],\r\n      cookieAuthName: cookieAuthName,\r\n      API_URL: API_URL\r\n    }\r\n  }\r\n\r\n  traverseTree = (items, cb, parent = {}) => {\r\n    items = items || [];\r\n    items.map((child, i) => {\r\n      cb(child, i, items, parent);\r\n      traverseTree(child.children, cb, child);\r\n      return child;\r\n    });\r\n  };\r\n\r\n  openTheme(e, id) {\r\n    let { opened } = this.state;\r\n    let index = opened.indexOf(id);\r\n    if (index === -1) opened.push(id);\r\n    else opened.splice(index, 1);\r\n    this.setState({ ...this.state, opened });\r\n    \r\n    if (this.props.actions.layers_set_opened && this.props.config.dispatch) {\r\n      this.props.config.dispatch(this.props.actions.layers_set_opened(opened));\r\n    }    \r\n  }\r\n\r\n  toggle(id, layer_data, items) {\r\n    const { activate_parents, deactivate_children, open_children, viewer } = this.props.config;\r\n    const { layers } = viewer.config_json;\r\n    const checked = Object.assign([], viewer.config_json.checked);\r\n    \r\n    // Toggle selected\r\n    let index = checked.indexOf(id);\r\n    if (index === -1) checked.push(id);\r\n    else checked.splice(index, 1);\r\n\r\n    //Uncheck other nodes (parent with exclusive == true)\r\n    if (items && items.length) {\r\n      items.forEach(child => {\r\n        let index = checked.indexOf(child.id);\r\n        if (child.id !== id && index > -1) checked.splice(index, 1);\r\n      });\r\n    }\r\n    \r\n    // If checked, activate all parents\r\n    if (index === -1 && ((activate_parents && layer_data?.activate_parents !== false)\r\n      || layer_data?.activate_parents === true)) {\r\n      let parents = findAllParents(layers, id).filter(i => !!i);\r\n      parents.forEach(p => {\r\n        let index = checked.indexOf(p);\r\n        if (index === -1) checked.push(p);\r\n      });\r\n    }\r\n    \r\n    // If unchecked deactivate all children\r\n    if (index > -1 && ((deactivate_children && layer_data?.deactivate_children !== false) \r\n      || layer_data?.deactivate_children === true)) {\r\n      let children = findAllChildren(layers, [id]);\r\n      children.forEach(p => {\r\n        let index = checked.indexOf(p);\r\n        if (p !== id && index > -1) checked.splice(index, 1);\r\n      });\r\n    }\r\n\r\n    // Update all changes\r\n    this.setState({ ...this.state, checked });\r\n    if (this.props.actions.layers_set_checked && this.props.config.dispatch) {\r\n      this.props.config.dispatch(this.props.actions.layers_set_checked(checked));\r\n    }\r\n\r\n    // Open direct children if checked\r\n    if ((open_children && layer_data?.open_children !== false) || layer_data?.open_children) {\r\n      if (checked.includes(id) && layer_data.type === 'GROUP') {\r\n        let { opened } = this.state;\r\n        let index = opened.indexOf(id);\r\n        if (index === -1) {\r\n          opened.push(id);\r\n          this.setState({ ...this.state, opened });\r\n        \r\n          if (this.props.actions.layers_set_opened && this.props.config.dispatch) {\r\n            this.props.config.dispatch(this.props.actions.layers_set_opened(opened));\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  opacity(e, theme, value) {\r\n    let { layers } = this.props.config.viewer.config_json;\r\n    const index = layers.indexOf(theme);\r\n    const update = Object.assign({}, theme);\r\n    update.opacity = value / 100;\r\n    layers.splice(index, 1, update);\r\n    this.setState({ ...this.state, layers });\r\n    if (this.props.actions.layers_update_theme && this.props.config.dispatch) {\r\n      this.props.config.dispatch(this.props.actions.layers_update_theme(update));\r\n    }\r\n  }\r\n\r\n  removeThemes(themes) {\r\n    this.setState({ ...this.state, confirmDeleteTheme: false });\r\n    //const { opened } = this.state;\r\n    const { opened } = this.props.config.viewer.config_json;\r\n    const { checked } = this.props.config.viewer.config_json;\r\n    themes.forEach(id => {\r\n      if (opened.includes(id)) this.openTheme(null, id);\r\n      if (checked.includes(id)) this.toggle(id);\r\n    });\r\n    if (this.props.actions.layers_remove_items && this.props.config.dispatch) {\r\n      this.props.config.dispatch(this.props.actions.layers_remove_items(themes));\r\n    }\r\n  }\r\n\r\n  applyThemeChanges(theme) {\r\n    let { layers } = this.props.config.viewer.config_json;\r\n    const index = layers.indexOf(theme);\r\n    const update = Object.assign({}, theme);\r\n    layers.splice(index, 1, update);\r\n    this.setState({ ...this.state, layers });\r\n    if (this.props.actions.layers_update_theme && this.props.config.dispatch) {\r\n      this.props.config.dispatch(this.props.actions.layers_update_theme(update));\r\n    }\r\n  }\r\n\r\n  moveTheme(fromIndex, fromParent, toIndex, toParent) {\r\n    let { layers } = this.props.config.viewer.config_json;\r\n    let updated = Object.assign([], layers);\r\n    \r\n    const parentIndex = updated.findIndex(i => i.id === fromParent);\r\n    const targetIndex = updated.findIndex(i => i.id === toParent);\r\n    const idIndex = updated[parentIndex].children.indexOf(fromIndex);\r\n    const target = Object.assign({}, updated[targetIndex]);\r\n\r\n    // Disallow drag into children\r\n    if (target.children.includes(toParent)) {\r\n      return this.setState({ ...this.state, dragging: false });\r\n    }\r\n\r\n    // Fix index when drag n drop in the same parent and drag lesser index\r\n    if (fromParent === toParent && idIndex < toIndex) toIndex--;\r\n\r\n    // Update themes\r\n    updated[parentIndex].children.splice(idIndex, 1);\r\n    target.children.splice(toIndex, 0, fromIndex);\r\n    updated.splice(targetIndex, 1, target);\r\n    this.setState({ ...this.state, layers: updated, dragging: false });\r\n\r\n    // Dispatch update global store\r\n    if (this.props.actions.layers_update_theme && this.props.config.dispatch) {\r\n      this.props.config.dispatch(this.props.actions.layers_update_theme(updated[parentIndex]));\r\n      this.props.config.dispatch(this.props.actions.layers_update_theme(target));\r\n      //if (checked.includes(fromIndex)) this.toggle(fromIndex);\r\n    }\r\n  };\r\n\r\n  onZoomTheme(theme) {\r\n    const { dispatch } = this.props.config;\r\n    const { transform_extent, map_set_extent } = this.props.actions;\r\n\r\n    // Dispatch zoom to theme action\r\n    if (theme.crs && theme.bbox && transform_extent && map_set_extent && dispatch) {\r\n      try {\r\n        let target_proj = this.props.config.mainMap.getView().getProjection().getCode();\r\n        let extent = transform_extent(theme.crs, target_proj, theme.bbox.split(' '));\r\n        let center = [extent[0] + (extent[2] - extent[0])/2, extent[1] + (extent[3] - extent[1])/2]\r\n        dispatch(map_set_extent(center, extent));\r\n      } catch (e) {\r\n          console.log(e);\r\n       }\r\n    }\r\n  }\r\n\r\n  filterThemes(themes, filter) {\r\n    const filterDone = [];\r\n    let filterRegEx = new RegExp(filter, \"i\");\r\n    themes.forEach(n => {\r\n      if (filterDone.includes(n.id)) return;\r\n      if (!filter) n.filtered = false;\r\n      else n.filtered = filterRegEx.test(n.title) || filterRegEx.test(n.description) ? false : true;\r\n      filterDone.push(n.id);\r\n      if (!n.filtered) {\r\n        let parents = findAllParents(themes, n.id);\r\n        themes.forEach(p => {\r\n          if (filterDone.includes(p.id)) return;\r\n          if (parents.includes(p.id)) {\r\n            p.filtered = false;\r\n            filterDone.push(p.id);\r\n          }\r\n        }); \r\n      }\r\n    });\r\n  }\r\n\r\n  endDragging(e) {\r\n    this.setState({ ...this.state, dragging: false })\r\n  }\r\n\r\n\r\n  changeFilter(e) {\r\n    this.setState({ ...this.state, filter: e.target.value });\r\n  }\r\n\r\n  clearFilter(e) {\r\n    this.setState({ ...this.state, filter: '' });\r\n  }\r\n\r\n  saveSession(toastEl) {\r\n    this.props.config.dispatch(this.props.actions.viewer_save_http_loading());\r\n\r\n    //Get current session viewer config\r\n    const { getViewerSessionConfig } = this.props.config.Models.MapModel;\r\n\r\n    let { cookieAuthName, API_URL } = this.state;\r\n\r\n    const viewer = this.props.config.viewer;\r\n    const newconfig = getViewerSessionConfig(viewer);\r\n\r\n    let record = {\r\n      id: viewer.id,\r\n      config_json: JSON.stringify(newconfig)\r\n    }\r\n\r\n    // Save request\r\n    let options = {\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'Content-Type': 'application/json'        \r\n      },\r\n      method: 'POST',\r\n      body: JSON.stringify(record)\r\n    }\r\n\r\n    // Get logged user\r\n    const cookies = new Cookies();\r\n    const logged = cookies.get(cookieAuthName);\r\n    if (logged) options.headers['X-API-KEY'] = logged.token;\r\n\r\n    // Auth url. TODO: check for proxy\r\n    let url = API_URL + '/app/viewer/session';\r\n    url += '/' + record.id;\r\n    fetch(url, options)\r\n      .then(res => res.json())\r\n      .then(res => {\r\n        if (res.success) {\r\n          toastEl.show({\r\n            severity: 'success',\r\n            summary: 'Gravar Sessão',\r\n            detail: \"A sessão foi gravada com sucesso.\",\r\n            sticky: false\r\n          });\r\n          this.props.config.dispatch(this.props.actions.viewer_session_saved(res.session));       \r\n        } else {\r\n          throw new Error('Não foi possível gravar a sessão.');        \r\n        }\r\n      }).catch(error => {\r\n        toastEl.show({\r\n          severity: 'error',\r\n          summary: 'Ocorreu um erro inesperado',\r\n          detail: \"Não foi possível gravar a sessão.\",\r\n          sticky: false\r\n        });\r\n        this.props.config.dispatch(this.props.actions.viewer_save_http_error());\r\n      });\r\n  }\r\n\r\n  loadSession() {\r\n    const history= this.props.config.history;\r\n    this.props.config.dispatch(this.props.actions.viewer_session_load(history));\r\n    window.location.reload();\r\n  }\r\n\r\n  renderContent() {\r\n    const {\r\n      core,\r\n      record,\r\n      config,\r\n      actions,\r\n      withHeading\r\n    } = this.props;\r\n\r\n    const olmap = config.mainMap;\r\n    const component_cfg = record.config_json || {};\r\n\r\n    /*\r\n    const { filter, opened, dragging } = this.state;\r\n    const { layers, checked } = config.viewer.config_json;\r\n    */\r\n    const { filter, dragging } = this.state;\r\n    const { layers, checked, opened } = config.viewer.config_json;   \r\n    const { showOnPortal } = config.Models.Utils;\r\n\r\n    if (!Array.isArray(layers)) return null;\r\n    \r\n    const main = layers.find(i => i.id === 'main');\r\n    if (!main) return null;\r\n\r\n    //User authentication\r\n    const cookies = new Cookies();\r\n    const cookieAuthName = core.COOKIE_AUTH_NAME;\r\n    const cookieData = cookies.get(cookieAuthName);\r\n    \r\n    // Filter themes\r\n    this.filterThemes(layers, filter);\r\n    \r\n    // Get main items\r\n    const tree = main.children.map(id => layers.find(l => l.id === id)).filter(i => !!i);\r\n\r\n    // Compose actions\r\n    const tocActions = {\r\n      ...actions,\r\n      open: this.openTheme.bind(this),\r\n      toggle: this.toggle.bind(this),\r\n      opacity: this.opacity.bind(this),\r\n      moveTheme: this.moveTheme.bind(this),\r\n      removeThemes: this.removeThemes.bind(this),\r\n      onZoomTheme: this.onZoomTheme.bind(this),\r\n      applyThemeChanges: this.applyThemeChanges.bind(this)\r\n    }\r\n\r\n    let toastEl = null;\r\n\r\n    return (\r\n      <div style={{ height: '100%' }} \r\n        onMouseLeave={this.endDragging.bind(this)}\r\n        onDrop={ev => {\r\n          this.endDragging.bind(this)\r\n        }}>\r\n        \r\n        {showOnPortal(<Toast ref={(el) => toastEl = el} />)}\r\n\r\n        <div id=\"layer-switcher\" className={\"plugin-main\" + (dragging ? \" dragging\" : \"\")}>\r\n\r\n          { !!withHeading && <h3>Temas</h3> }\r\n\r\n          { (!!cookieData && !!config.viewer.allow_user_session) && \r\n            <Toolbar className=\"p-mb-2\"\r\n              left={(config.viewer.is_session && \r\n                <Button label=\"Sessão\" className=\"p-button-sm p-button-rounded p-button-info\" \r\n                  icon=\"pi pi-check\" tooltip={\"Gravada em \" + config.viewer.session.date}  />)} \r\n              right={ \r\n              <React.Fragment>\r\n                {(config.viewer.session && !config.viewer.is_session) && <Button label=\"Abrir Sessão\" \r\n                  icon=\"pi pi-folder-open\" \r\n                  className=\"p-button-text p-button-sm\"\r\n                  onClick={e => this.loadSession()}\r\n                  disabled={(config.viewer.save_loading)}\r\n                  tooltip={\"Gravada em \" + config.viewer.session.date} />}\r\n                <Button label=\"Gravar Sessão\"\r\n                  icon={config.viewer.save_loading ? \"pi pi-spin pi-spinner\": \"pi pi-save\"}\r\n                  className=\"p-button-text p-button-sm\"\r\n                  onClick={e => this.saveSession(toastEl)} \r\n                  disabled={(config.viewer.save_loading)} />                                    \r\n              </React.Fragment> } />\r\n          }\r\n\r\n          { !!tree.length ? (\r\n            <>\r\n            { component_cfg.show_filter !== false ? (\r\n              <div className=\"p-inputgroup\">\r\n                <InputText \r\n                  placeholder='Filtro...'\r\n                  className=\"p-inputtext-sm p-mb-2\"\r\n                  value={filter}\r\n                  onChange={this.changeFilter.bind(this)}\r\n                />\r\n                <Button\r\n                  icon=\"pi pi-times\"\r\n                  label=\"Limpar\"\r\n                  className=\"p-button-sm p-mb-2\"\r\n                  onClick={this.clearFilter.bind(this)}\r\n                />\r\n              </div>\r\n            ) : null }\r\n            </>\r\n          ) : (\r\n            <Message\r\n              severity=\"info\"\r\n              text=\"Não existem temas. Clique no menu + para adicionar.\" \r\n            />\r\n          ) }\r\n\r\n          <Tree\r\n            id=\"main\"\r\n            deep={0}\r\n            core={core}\r\n            record={record}\r\n            items={tree}\r\n            config={config}\r\n            layers={layers}\r\n            checked={checked}\r\n            opened={opened}\r\n            olmap={olmap}\r\n            actions={tocActions}\r\n            onDragStart={e => this.setState({ ...this.state, dragging: true })}\r\n          />\r\n\r\n        </div>\r\n\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { as } = this.props;\r\n    \r\n    if (as === 'panel') return (\r\n      <Panel header=\"Temas\">        \r\n        { this.renderContent() }\r\n      </Panel>\r\n    )\r\n\r\n    if (as === 'button') return (\r\n      <Button label=\"teste\" />\r\n    )\r\n\r\n    // Render content\r\n    return this.renderContent();\r\n  }\r\n\r\n}\r\n\r\nexport default Main;","import React, { useState, useEffect, useRef } from 'react'\r\nimport { connect } from 'react-redux'\r\nimport Cookies from 'universal-cookie'\r\nimport { useForm, Controller } from 'react-hook-form'\r\nimport { InputText } from 'primereact/inputtext'\r\nimport { Password } from 'primereact/password'\r\nimport { Button } from 'primereact/button'\r\nimport { Message } from 'primereact/message'\r\nimport { classNames } from 'primereact/utils'\r\n\r\nconst cookies = new Cookies();\r\n\r\nfunction LoginWidget(props) {\r\n\r\n  const { auth, history, redirect, core, dispatch, actions, record, showRegistration } = props;\r\n\r\n  const componentCfg = record.config_json || {};\r\n\r\n  const [mode, setMode] = useState('login');\r\n  \r\n  // Redux actions\r\n  const { login_post, login_clear_error, login_reset_password, logout } = actions;\r\n\r\n  const cookieData = cookies.get(core.COOKIE_AUTH_NAME);\r\n\r\n  const defaultLoginValues = {\r\n    username: '',\r\n    password: ''\r\n  }\r\n\r\n  const { control, formState: { errors }, trigger, getValues, setValue, handleSubmit } = useForm({ defaultLoginValues });\r\n\r\n  useEffect(() => {\r\n    dispatch(login_clear_error());\r\n  }, []);\r\n  \r\n  if (cookieData) {\r\n    const { username } = cookieData;\r\n    return (\r\n      <div>\r\n        <p>Olá { username }.</p>\r\n        <p>\r\n          Clique para \r\n          <Button\r\n            className=\"p-button-link\" onClick={e => dispatch(logout())}\r\n            label=\"terminar sessão\"\r\n          />.\r\n        </p>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  function switchPasswordResetMode(e) {\r\n    e.preventDefault();\r\n    setValue('username', '');\r\n    setValue('password', '');\r\n    setMode('password_reset');\r\n    dispatch(login_clear_error());\r\n  }\r\n\r\n  function switchLoginMode(e) {\r\n    e.preventDefault();\r\n    setValue('username', '');\r\n    setValue('password', '');    \r\n    setMode('login');\r\n    dispatch(login_clear_error());\r\n  }\r\n\r\n  const checkKeyDown =  async (e) => {\r\n    if (e.code === 'Enter') {\r\n      e.preventDefault();\r\n      const result = await trigger([\"username\", \"password\"]);\r\n      if (result) {\r\n        onSubmit(getValues());\r\n      }\r\n    }\r\n  };  \r\n\r\n  const onSubmit = (data) => {\r\n    if (mode === 'password_reset') {\r\n      if (record?.config_json?.actions?.reset_password) {\r\n        core.pubsub.publish(record?.config_json?.actions?.reset_password, {post: { username: data.username, redirect }, history, redirect});\r\n        return;\r\n      }\r\n      dispatch(login_reset_password({ username: data.username, redirect }, history, redirect));\r\n    } else {\r\n      if (record?.config_json?.actions?.login) {\r\n        core.pubsub.publish(record?.config_json?.actions?.login, null);\r\n        return;\r\n      }      \r\n      dispatch(login_post({ username: data.username, password: data.password }, history, redirect));\r\n    }\r\n  }  \r\n\r\n  const getFormValidationErrorMessage = (errors, name) => {\r\n    if (errors && errors[name]) {\r\n      if (errors[name].type === 'required') {\r\n        return <small className=\"p-error\">{errors[name].message || 'Campo obrigatório'}</small>\r\n      } else if (errors[name].type === 'maxLength') {\r\n         return <small className=\"p-error\">{errors[name].message || 'O número de caracteres é superior à dimensão máxima permitida'}</small>\r\n      } else if (errors[name].type === 'pattern') {\r\n        return <small className=\"p-error\">{errors[name].message || 'Formato inválido'}</small>\r\n      } else {\r\n        return <small className=\"p-error\">{errors[name].message}</small>\r\n      }\r\n    }      \r\n  };\r\n\r\n  if (mode === 'password_reset' && auth?.response?.reset_password === true && !auth?.response?.error) {\r\n    return (\r\n      <React.Fragment>\r\n\r\n        <div className=\"p-fluid\">\r\n\r\n          <div className=\"p-d-flex p-ai-center p-dir-col p-pt-2 p-px-3\">\r\n            <h3>Recuperação de palavra-passe</h3>\r\n            <p>{auth.response.message}</p>\r\n            <p style={{fontSize: \"0.9rem\"}}>Caso não receba o email com as instruções para recuperação da palavra-passe durante os próximos minutos, verifique se este não foi direcionado para a área de SPAM do seu correio eletrónico.</p>\r\n          </div> \r\n\r\n          <div className=\"p-field p-grid\">\r\n            <div className=\"p-col-12\">\r\n              <Button\r\n                className=\"p-button-link\"\r\n                label = \"Login\"\r\n                onClick={switchLoginMode}\r\n              />\r\n            </div>\r\n          </div>          \r\n        </div>\r\n\r\n        <div className=\"p-dialog-myfooter\">\r\n          <Button \r\n            color='green'\r\n            icon={ auth.loading ? \"pi pi-spin pi-spinner\": \"pi pi-check\" }\r\n            label=\"Fechar\" \r\n            onClick={(e) => {\r\n              setMode('login');\r\n              props.onHide();\r\n            }}\r\n          />\r\n        </div>\r\n\r\n      </React.Fragment>        \r\n    );\r\n  }\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit(onSubmit)} autoComplete=\"off\">\r\n      <div className=\"p-fluid\">\r\n        <div className=\"p-field p-grid\">\r\n          <label htmlFor=\"username\" className=\"p-col-12 p-md-4\">Utilizador / E-mail</label>\r\n          <div className=\"p-col-12 p-md-8\">\r\n            <Controller name=\"username\" control={control} rules={{ required: 'Preenchimento obrigatório.' }} render={({ field, fieldState }) => (\r\n                <InputText id={field.name} {...field} autoFocus className={classNames({ 'p-invalid': fieldState.invalid })}\r\n                  autoComplete=\"off\"\r\n                  aria-autocomplete=\"none\"\r\n                  onKeyPress={checkKeyDown} />\r\n              )} />\r\n            {getFormValidationErrorMessage(errors, 'username')}\r\n          </div>\r\n        </div>\r\n\r\n        { mode === 'login' && \r\n          <React.Fragment>\r\n            <div className=\"p-field p-grid\">\r\n              <label htmlFor=\"password\" className=\"p-col-12 p-md-4\">Palavra-passe</label>\r\n              <div className=\"p-col-12 p-md-8\">\r\n              <Controller name=\"password\" control={control} rules={{ required: 'Preenchimento obrigatório.' }} render={({ field, fieldState }) => (\r\n                <Password id={field.name} {...field} \r\n                  toggleMask \r\n                  feedback={false} \r\n                  className={classNames({ 'p-invalid': fieldState.invalid })}\r\n                  autoComplete=\"off\"\r\n                  aria-autocomplete=\"none\"\r\n                  onKeyPress={checkKeyDown} />                  \r\n                  )} />\r\n                {getFormValidationErrorMessage(errors, 'password')}\r\n              </div>\r\n            </div>\r\n\r\n            { (componentCfg.reset_password === true || componentCfg.user_registration) && <div className=\"p-field p-grid\">\r\n              { (!componentCfg.reset_password  || !componentCfg.user_registration) && <div className='p-col-12 p-md-6' />}\r\n              { componentCfg.reset_password && <div className={'p-col-12 p-md-6 p-p-2 p-text-center'}>\r\n                <Button\r\n                  className=\"p-button-link\"\r\n                  style={{width: 'auto'}}\r\n                  label = \"Recuperar palavra-passe\"\r\n                  onClick={switchPasswordResetMode}\r\n                />\r\n              </div> }\r\n              { componentCfg.user_registration && <div className='p-col-12 p-md-6 p-p-2 p-text-center'>\r\n                <Button\r\n                  className=\"p-button-link\"\r\n                  style={{width: 'auto'}}\r\n                  label = \"Novo utilizador\"\r\n                  onClick={ (e) => { e.preventDefault(); showRegistration() }}\r\n                />\r\n              </div> }          \r\n            </div> }\r\n          </React.Fragment>\r\n        }\r\n\r\n        { mode === 'password_reset' && \r\n          <div className=\"p-field p-grid\">\r\n            <div className=\"p-col-12 p-text-center\">\r\n              <Button\r\n                className=\"p-button-link\"\r\n                style={{width: 'auto'}}\r\n                label = \"Login\"\r\n                onClick={switchLoginMode}\r\n              />\r\n            </div>\r\n          </div>\r\n        }        \r\n\r\n      </div>\r\n\r\n      <div className=\"p-dialog-myfooter\">\r\n        <Button\r\n          type=\"submit\" \r\n          color='green'\r\n          icon={ auth.loading ? \"pi pi-spin pi-spinner\": \"pi pi-check\" }\r\n          label={ mode === \"password_reset\" ? \"Enviar\" : \"Entrar\" }\r\n          disabled={auth.loading}\r\n        />\r\n      </div>\r\n      \r\n      { auth.http_error && !auth.response &&\r\n        <Message style={{ width: '100%' }} severity=\"error\" text=\"Serviço Indisponível\"></Message>\r\n      }\r\n\r\n      { auth.response && !!auth.response && !!auth.response.message && \r\n        <Message style={{ width: '100%' }} severity=\"error\" text={auth?.response?.message}></Message>\r\n      }\r\n\r\n    </form>\r\n  )\r\n}\r\n\r\nexport default connect(state => ({ auth: state.root.auth }))(LoginWidget)","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport Cookies from 'universal-cookie';\r\nimport { useForm, Controller } from 'react-hook-form';\r\nimport { InputText } from 'primereact/inputtext';\r\nimport { Password } from 'primereact/password';\r\nimport { Button } from 'primereact/button';\r\nimport { Checkbox } from 'primereact/checkbox';\r\nimport { Message } from 'primereact/message';\r\nimport { Divider } from 'primereact/divider';\r\nimport { classNames } from 'primereact/utils';\r\n\r\nconst cookies = new Cookies();\r\n\r\nconst passwordStrengthLabels = {\r\n  weakLabel: 'Fraca',\r\n  mediumLabel: 'Média',\r\n  strongLabel: 'Forte'\r\n}\r\n\r\nfunction RegistrationWidget(props) {\r\n\r\n  const { auth, viewer, history, redirect, core, dispatch, actions, record, showLogin } = props;\r\n  \r\n  // Redux redux actions\r\n  const { login_user_registration , logout } = actions;\r\n\r\n  const cookieData = cookies.get(core.COOKIE_AUTH_NAME);\r\n\r\n  const defaultValues = {\r\n    name: null,\r\n    email: null,\r\n    username: null,\r\n    password: '',\r\n    accept: false\r\n  }\r\n\r\n  // Render user\r\n  if (cookieData) {\r\n    console.log(cookieData);\r\n  }\r\n\r\n  const { control, formState: { errors }, handleSubmit } = useForm({ defaultValues });\r\n\r\n\r\n  const TERMS_OF_SERVICE_URL = viewer?.config_json?.terms_of_service_url;\r\n\r\n  const onSubmit = (data) => {\r\n    dispatch(login_user_registration({ ...data }, history, redirect));  \r\n  }\r\n\r\n  const getFormValidationErrorMessage = (errors, name) => {\r\n    if (errors && errors[name]) {\r\n      if (errors[name].type === 'required') {\r\n        return <small className=\"p-error\">{errors[name].message || 'Campo obrigatório'}</small>\r\n      } else if (errors[name].type === 'maxLength') {\r\n         return <small className=\"p-error\">{errors[name].message || 'O número de caracteres é superior à dimensão máxima permitida'}</small>\r\n      } else if (errors[name].type === 'pattern') {\r\n        return <small className=\"p-error\">{errors[name].message || 'Formato inválido'}</small>\r\n      } else {\r\n        return <small className=\"p-error\">{errors[name].message}</small>\r\n      }\r\n    }      \r\n  }; \r\n\r\n  const passwordFooter = (\r\n    <React.Fragment>\r\n        <Divider className=\"p-mt-2\" />\r\n        <p className=\"p-mt-2\">Sugestões:</p>\r\n        <ul className=\"p-pl-2 p-ml-2 p-mt-0\" style={{ lineHeight: '1.5' }}>\r\n            <li>Pelo menos uma minúscula</li>\r\n            <li>Pelo menos uma maiúscula</li>\r\n            <li>Pelo menos um dígito</li>\r\n            <li>Pelo menos 8 caracteres</li>\r\n        </ul>\r\n    </React.Fragment>\r\n  );\r\n   \r\n\r\n  if (auth?.response?.register_user === true && !auth?.response?.error) {\r\n    return (\r\n      <div className=\"p-d-flex p-ai-center p-dir-col p-pt-6 p-px-3\">\r\n        <i className=\"pi pi-check-circle\" style={{ fontSize: '5rem', color: 'var(--green-500)' }}></i>\r\n        <h3>Registo realizado com sucesso!</h3>\r\n        <p style={{ lineHeight: 1.5 }}>\r\n            A sua conta foi registada com o username <b>{auth?.response?.username}</b>, deverá proceder à sua ativação durante as próximas 24 horas. Por favor, verifique as instruções de ativação da conta enviadas para o email <b>{auth?.response?.email}</b>.\r\n        </p>\r\n        {/*\r\n        <Button label=\"Entrar\" onClick={ e=>\r\n          dispatch(login_post({ username: formData.username, password: formData.password }, history, redirect))\r\n        } />\r\n        */}\r\n<       div className='p-col-12 p-md-6 p-p-2 p-text-center'>\r\n          <Button\r\n            className=\"p-button-link\"\r\n            style={{width: 'auto'}}\r\n            label = \"Login\"\r\n            onClick={ (e) => { e.preventDefault(); showLogin() }}\r\n          />\r\n        </div>        \r\n      </div>      \r\n    ) \r\n  } \r\n\r\n  return (\r\n    <form onSubmit={handleSubmit(onSubmit)} autoComplete=\"off\">\r\n      <div className=\"p-fluid p-mt-2\">\r\n        <h3>Dados de registo</h3>\r\n\r\n        <div className=\"p-field\">\r\n          <span className=\"p-float-label\">\r\n            <Controller name=\"name\" control={control} rules={{ required: 'Campo obrigatório.' }} render={({ field, fieldState }) => (\r\n                <InputText id={field.name} {...field} autoFocus className={classNames({ 'p-invalid': fieldState.invalid })} />\r\n            )} />\r\n            <label htmlFor=\"name\" className={classNames({ 'p-error': errors.name })}>Nome*</label>\r\n          </span>\r\n          {getFormValidationErrorMessage(errors, 'name')}\r\n        </div>\r\n        <div className=\"p-field\">\r\n          <span className=\"p-float-label p-input-icon-right\">\r\n            <i className=\"pi pi-envelope\" />\r\n            <Controller name=\"email\" control={control}\r\n                rules={{ required: 'Campo obrigatório', pattern: { value: /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,4}$/i, message: 'Email inválido. E.g. exemplo@email.pt' }}}\r\n                render={({ field, fieldState }) => (\r\n                    <InputText id={field.name} {...field} disabled={!!cookieData} className={classNames({ 'p-invalid': fieldState.invalid })} />\r\n            )} />\r\n            <label htmlFor=\"email\" className={classNames({ 'p-error': !!errors.email })}>Email*</label>\r\n          </span>\r\n          {getFormValidationErrorMessage(errors, 'email')}\r\n        </div>              \r\n        <div className=\"p-field\">\r\n          <span className=\"p-float-label\">\r\n            <Controller name=\"username\" control={control} rules={{ required: 'Campo obrigatório.' }} render={({ field, fieldState }) => (\r\n                <InputText id={field.name} {...field} className={classNames({ 'p-invalid': fieldState.invalid })} \r\n                autoComplete=\"off\" />\r\n            )} />\r\n            <label htmlFor=\"username\" className={classNames({ 'p-error': errors.username })}>Username*</label>\r\n          </span>\r\n          {getFormValidationErrorMessage(errors, 'username')}\r\n        </div>\r\n        <div className=\"p-field\">\r\n          <span className=\"p-float-label\">\r\n              <Controller name=\"password\" control={control} rules={{ required: 'Campo obrigatório.' }} render={({ field, fieldState }) => (\r\n                  <Password id={field.name} {...field}\r\n                    toggleMask\r\n                    promptLabel=\"Introduza a password\" \r\n                    {...passwordStrengthLabels}\r\n                    className={classNames({ 'p-invalid': fieldState.invalid })} \r\n                    footer={passwordFooter} \r\n                    autoComplete=\"off\"\r\n                    aria-autocomplete=\"none\" />\r\n              )} />\r\n              <label htmlFor=\"password\" className={classNames({ 'p-error': errors.password })}>Password*</label>\r\n          </span>\r\n          {getFormValidationErrorMessage(errors, 'password')}\r\n        </div>\r\n        <div className=\"p-field-checkbox\">\r\n            <Controller name=\"accept\" control={control} rules={{ required: true }} render={({ field, fieldState }) => (\r\n                <Checkbox inputId={field.name} onChange={(e) => field.onChange(e.checked)} checked={field.value} className={classNames({ 'p-invalid': fieldState.invalid })} />\r\n            )} />\r\n            <label htmlFor=\"accept\" className={classNames({ 'p-error': errors.accept })}>Aceito os <a href={TERMS_OF_SERVICE_URL} target=\"_blank\" rel=\"noopener noreferrer\" className={classNames({ 'p-error': errors.accept })}>termos e condições de utilização</a>*</label>\r\n        </div>        \r\n      </div>\r\n\r\n      { showLogin && <div className=\"p-fluid\">\r\n          <div className=\"p-field p-grid\">\r\n            <div className=\"p-col-12\">\r\n              <Button\r\n                className=\"p-button-link\"\r\n                label = \"Login\"\r\n                onClick={(e) => {\r\n                  e.preventDefault();\r\n                  showLogin();\r\n                }}\r\n              />\r\n            </div>\r\n          </div>          \r\n        </div> }\r\n      \r\n      <div className=\"p-dialog-myfooter\">        \r\n        <Button \r\n          color='green'\r\n          icon={ auth.loading ? \"pi pi-spin pi-spinner\": \"pi pi-check\" }\r\n          label=\"Registar\" \r\n          type=\"submit\"\r\n          disabled={auth.loading}\r\n        />\r\n      </div>\r\n      \r\n      { auth.http_error && !auth.response &&\r\n        <Message style={{ width: '100%' }} severity=\"error\" text=\"Serviço Indisponível\"></Message>\r\n      }\r\n\r\n      { auth.response && !!auth.response && !!auth.response.message && \r\n        <Message style={{ width: '100%' }} severity=\"error\" text={auth.response.message}></Message>\r\n      }\r\n\r\n    </form>\r\n  )\r\n}\r\n\r\nexport default connect(state => ({ auth: state.root.auth }))(RegistrationWidget)","export const USERLOGIN_SHOW = 'UserLogin/Show';\r\nexport const USERLOGIN_LOGIN = 'UserLogin/Show';\r\nexport const USERLOGIN_REGISTRATION = 'UserLogin/Registration';\r\n\r\nexport default {\r\n  USERLOGIN_SHOW,\r\n  USERLOGIN_LOGIN,\r\n  USERLOGIN_REGISTRATION\r\n}","import React, {  useRef, useState, useEffect } from 'react'\r\nimport { Dialog } from 'primereact/dialog'\r\nimport Cookies from 'universal-cookie'\r\nimport { Menu } from 'primereact/menu'\r\nimport LoginWidget from './LoginWidget'\r\nimport RegistrationWidget from './RegistrationWidget'\r\nimport componentMessages from './messages'\r\n\r\n\r\nconst cookies = new Cookies();\r\nconst appEntityNameAbrev = process.env.REACT_APP_ENTITY_NAME_ABREV || 'ScalarGIS';\r\n\r\nexport default function Main({ region, as, core, config, actions, record }) {\r\n  const { viewer, mainMap, dispatch, Models } = config;\r\n  const { getWindowSize, showOnPortal } = Models.Utils;\r\n\r\n  const [showLoginButton, setShowLoginButton] = useState(true);\r\n  const [showLogin, setShowLogin] = useState(false);\r\n  const [showRegistration, setShowRegistration] = useState(false);\r\n  const [showMenu, setShowMenu] = useState(false);\r\n  const popupMenu = useRef();\r\n\r\n  const { logout } = actions;\r\n\r\n  const cookieData = cookies.get(core.COOKIE_AUTH_NAME);\r\n  const wsize = getWindowSize();\r\n  const isMobile = wsize[0] <= 768;\r\n  const isMobileSmall = wsize[0] <= 440;\r\n\r\n\r\n  useEffect(() => {\r\n    if (!core?.pubsub?.subscribe) return;\r\n\r\n    const unsubscribeLogin = core.pubsub.subscribe(componentMessages.USERLOGIN_SHOW, data => {\r\n      setShowRegistration(false);\r\n      setShowLogin(true);\r\n    });\r\n\r\n    const unsubscribeRegistration = core.pubsub.subscribe(componentMessages.USERLOGIN_REGISTRATION, data => {\r\n      setShowLogin(false);\r\n      setShowRegistration(true);\r\n    });\r\n\r\n    return [unsubscribeLogin, unsubscribeRegistration]\r\n  }, []);\r\n\r\n\r\n  useEffect(() => {\r\n    //Hide login button if viewer only has anonymous access\r\n    if (config && config.roles && config.roles.length === 1 && config.roles[0].name === 'Anonymous') {\r\n      setShowLoginButton(false);\r\n    }\r\n  }, [config]);\r\n\r\n  // Render user\r\n  if (cookieData) {\r\n    const { username } = cookieData;\r\n    const userMenu = [\r\n      {\r\n        label: 'Terminar Sessão',\r\n        icon: 'pi pi-lock',\r\n        command: () => {\r\n          dispatch(logout())  \r\n        }\r\n      }\r\n    ]\r\n    if (isMobileSmall) {\r\n      userMenu.unshift({\r\n          label: username,\r\n          disabled: true,\r\n          style: { wordBreak: 'break-all' }\r\n        });\r\n    }\r\n    return (\r\n      <span style={{ position: 'relative' }}>\r\n        { showLoginButton ?\r\n        <button className=\"p-link\" onClick={e => setShowMenu(!showMenu)}>\r\n          <span className=\"layout-topbar-item-text\">{ !isMobileSmall ? username : '' }</span>\r\n          <span className=\"layout-topbar-icon pi pi-user\"/>\r\n          {' '}{ !isMobileSmall ? username : '' }\r\n        </button> : null }\r\n        <Menu \r\n          model={userMenu} \r\n          ref={el => popupMenu.current = el} id=\"user_menu\"\r\n          style={{ display: showMenu ? 'block' : 'none' }}\r\n        />\r\n      </span>\r\n    )\r\n  }\r\n\r\n  if (showLogin) {\r\n    return (\r\n      <Dialog\r\n        header={record?.config_json?.header ? record?.config_json?.header : \"Entrar - \" + (appEntityNameAbrev || 'ScalarGIS')}\r\n        visible={showLogin}\r\n        style={{width: wsize[0] < 768 ? '90%' : '35vw' }} \r\n        modal\r\n        closable={record?.config_json?.closable === false ? false : true}\r\n        onHide={e => setShowLogin(false)}>\r\n          <LoginWidget\r\n            core={core}\r\n            dispatch={dispatch}\r\n            actions={actions}\r\n            record={record}\r\n            redirect={viewer?.name}\r\n            onHide={() => {\r\n              if (record?.config_json?.closable !== false) {\r\n                setShowLogin(false);\r\n              }\r\n            }}\r\n            showRegistration={() => {\r\n              if (record?.config_json?.actions?.registration) {\r\n                setShowLogin(false); \r\n                setShowRegistration(false); \r\n\r\n                core.pubsub.publish(record?.config_json?.actions?.registration, null);\r\n                return;\r\n              }\r\n\r\n              setShowLogin(false); \r\n              setShowRegistration(true);\r\n            }}\r\n            />\r\n      </Dialog>\r\n    )\r\n  }\r\n\r\n  if (showRegistration) {\r\n    return (\r\n      <Dialog\r\n        header={record?.config_json?.header ? record?.config_json?.header : \"Registo de Utilizador - \" + (appEntityNameAbrev || 'ScalarGIS')}\r\n        visible={showRegistration}\r\n        style={{width: wsize[0] < 768 ? '90%' : '35vw' }} \r\n        modal \r\n        onHide={e => setShowRegistration(false)}>\r\n          <RegistrationWidget\r\n            core={core}\r\n            dispatch={dispatch}\r\n            actions={actions}\r\n            viewer={viewer}\r\n            record={record}\r\n            redirect={viewer?.name}\r\n            showLogin={() => { \r\n              setShowRegistration(false); \r\n              setShowLogin(true); \r\n            }}\r\n            />\r\n      </Dialog>\r\n    )\r\n  }  \r\n\r\n  if (showLoginButton) {\r\n    // Render login button\r\n    return (\r\n      true ? <button className=\"p-link\" onClick={e => setShowLogin(true)} title={config.tooltip_login || ''}>\r\n          <span className=\"layout-topbar-item-text\">Utilizador</span>\r\n          <span className=\"layout-topbar-icon pi pi-unlock\"/>\r\n      </button> : null\r\n    )\r\n  } else {\r\n    return null;\r\n  }\r\n}","import { transformExtent } from \"../model/MapModel\"\r\nimport Cookies from 'universal-cookie'\r\nimport { isUrlAppOrigin, getAppApiUrl, getAppMapProxyUrl, getCookieAuthName } from '../utils'\r\nimport { isThemeOnScale as isThemeOnScaleMapModel } from '../model/MapModel'\r\n\r\nexport const AUTH_HTTP_LOADING          = 'AUTH_HTTP_LOADING'\r\nexport const AUTH_HTTP_ERROR            = 'AUTH_HTTP_ERROR'\r\nexport const AUTH_CLEAR_ERROR           = 'AUTH_CLEAR_ERROR'\r\nexport const AUTH_RESPONSE              = 'AUTH_RESPONSE'\r\nexport const AUTH_LOGIN                 = 'AUTH_LOGIN'\r\n\r\nexport const PASSWORD_HTTP_LOADING      = 'PASSWORD_HTTP_LOADING'\r\nexport const PASSWORD_HTTP_ERROR        = 'PASSWORD_HTTP_ERROR'\r\nexport const PASSWORD_RESPONSE          = 'PASSWORD_RESPONSE'\r\n\r\nexport const REGISTRATION_HTTP_LOADING  = 'REGISTRATION_HTTP_LOADING'\r\nexport const REGISTRATION_HTTP_ERROR    = 'REGISTRATION_HTTP_ERROR'\r\nexport const REGISTRATION_RESPONSE      = 'REGISTRATION_RESPONSE'\r\n\r\nexport const VIEWER_LOAD                = 'VIEWER_LOAD'\r\nexport const VIEWER_LOAD_DONE           = 'VIEWER_LOAD_DONE'\r\nexport const VIEWER_SAVE_HTTP_LOADING   = 'VIEWER_SAVE_HTTP_LOADING'\r\nexport const VIEWER_SAVE_HTTP_ERROR     = 'VIEWER_SAVE_HTTP_ERROR'\r\nexport const VIEWER_SAVE_RESPONSE       = 'VIEWER_SAVE_RESPONSE'\r\n\r\nexport const VIEWER_SESSION_LOAD        = 'VIEWER_SESSION_LOAD'\r\nexport const VIEWER_SESSION_SAVED       = 'VIEWER_SESSION_SAVED'\r\n\r\nexport const VIEWER_SET_CONFIG          = 'VIEWER_SET_CONFIG'\r\nexport const VIEWER_LOAD_ERROR          = 'VIEWER_LOAD_ERROR'\r\nexport const VIEWER_NOT_FOUND           = 'VIEWER_NOT_FOUND'\r\nexport const VIEWER_NOT_AUTHORIZED      = 'VIEWER_NOT_AUTHORIZED'\r\nexport const VIEWER_LOAD_COMPONENTS     = 'VIEWER_LOAD_COMPONENTS'\r\nexport const VIEWER_UNLOAD_COMPONENTS   = 'VIEWER_UNLOAD_COMPONENTS'\r\nexport const VIEWER_SET_SELECTEDMENU    = 'VIEWER_SET_SELECTEDMENU'\r\nexport const VIEWER_SET_FEATUREINFO     = 'VIEWER_SET_FEATUREINFO'\r\nexport const VIEWER_SET_GEOLOCATION     = 'VIEWER_SET_GEOLOCATION'\r\nexport const VIEWER_SET_DRAWINGS        = 'VIEWER_SET_DRAWINGS'\r\nexport const VIEWER_SET_COORDINATES     = 'VIEWER_SET_COORDINATES'\r\n\r\nexport const MAP_SET_EXTENT             = 'MAP_SET_EXTENT'\r\nexport const MAP_SET_SIZE               = 'MAP_SET_SIZE'\r\nexport const MAP_SET_CLASS              = 'MAP_SET_CLASS'\r\n\r\nexport const LAYERS_SET_CHECKED         = 'LAYERS_SET_CHECKED'\r\nexport const LAYERS_SET_OPENED          = 'LAYERS_SET_OPENED'\r\nexport const LAYERS_UPDATE_THEME        = 'LAYERS_UPDATE_THEME'\r\nexport const LAYERS_REMOVE_ITEMS        = 'LAYERS_REMOVE_ITEMS'\r\nexport const VIEWER_SET_DISPLAYCRS      = 'VIEWER_SET_DISPLAYCRS'\r\nexport const VIEWER_ADD_THEMES          = 'VIEWER_ADD_THEMES'\r\nexport const VIEWER_REMOVE_THEMES       = 'VIEWER_REMOVE_THEMES'\r\nexport const VIEWER_SET_CONFIGJSON      = 'VIEWER_SET_CONFIGJSON'\r\nexport const VIEWER_UPDATE_MAPCONTROL   = 'VIEWER_UPDATE_MAPCONTROL'\r\nexport const VIEWER_SET_EXCUSIVE_MAPCONTROL = 'VIEWER_SET_EXCUSIVE_MAPCONTROL'\r\n\r\nexport const LAYOUT_WRAPPER_CLICK       = 'LAYOUT_WRAPPER_CLICK'\r\nexport const LAYOUT_TOGGLE_OVERLAYMENU  = 'LAYOUT_TOGGLE_OVERLAYMENU'\r\nexport const LAYOUT_TOGGLE_STATICMENU   = 'LAYOUT_TOGGLE_STATICMENU'\r\nexport const LAYOUT_TOGGLE_MOBILEMENU   = 'LAYOUT_TOGGLE_MOBILEMENU'\r\n\r\n// Get config URL\r\nconst CONFIG_URL = process.env.REACT_APP_CONFIG_URL;\r\nconst API_URL = getAppApiUrl();\r\nconst MAP_PROXY = getAppMapProxyUrl();\r\nconst cookieAuthName = getCookieAuthName();\r\nconst cookiePath = process.env.REACT_APP_COOKIE_PATH || ''; \r\nconst cookieExpiresDays = parseInt(process.env.REACT_APP_COOKIE_EXPIRES_DAYS || '150', 10);\r\n\r\nexport function viewer_save_record(record, history, redirect) {\r\n  return function (dispatch, getState) {\r\n    dispatch(viewer_save_http_loading());\r\n\r\n    // Save request\r\n    let options = {\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'Content-Type': 'application/json'        \r\n      },\r\n      method: record.id ? 'PUT' : 'POST',\r\n      body: JSON.stringify(record)\r\n    }\r\n\r\n    // Get logged user\r\n    const cookies = new Cookies();\r\n    const logged = cookies.get(cookieAuthName);\r\n    if (logged) options.headers['X-API-KEY'] = logged.token;\r\n\r\n    // Auth url. TODO: check for proxy\r\n    let url = API_URL + '/app/viewer';\r\n    if (record.id) url += '/' + record.id;\r\n    fetch(url, options)\r\n      .then(res => res.json())\r\n      .then(res => {\r\n        const save_options = record.id ? { \r\n          name: record.name,\r\n          title: record.title,\r\n          description: record.description,\r\n          allow_user_session: record.allow_user_session || false,\r\n          allow_anonymous: record.allow_anonymous,\r\n          is_active: record.is_active\r\n        } : null;\r\n        dispatch(viewer_save_response(res, save_options));\r\n      }).catch(error => {\r\n        console.log('error', error);\r\n        dispatch(viewer_save_http_error());\r\n      });\r\n  }\r\n}\r\n\r\nexport function viewer_save_http_error() {\r\n  const action = {\r\n    type: VIEWER_SAVE_HTTP_ERROR,\r\n    error: true\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function viewer_save_http_loading() {\r\n  const action = {\r\n    type: VIEWER_SAVE_HTTP_LOADING\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function viewer_save_response(res, save_options) {\r\n  const action = {\r\n    type: VIEWER_SAVE_RESPONSE,\r\n    res,\r\n    save_options\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function login_http_loading() {\r\n  const action = {\r\n    type: AUTH_HTTP_LOADING\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function login_post(post, history, redirect, urlRedirect) {\r\n  return function (dispatch, getState) {\r\n    dispatch(login_http_loading());\r\n    \r\n    // Login request\r\n    let options = {\r\n      method: 'POST',\r\n      body: JSON.stringify(post)\r\n    }\r\n\r\n    // Auth url. TODO: check for proxy\r\n    let url = API_URL + '/authentication/authenticate';\r\n    fetch(url, options)\r\n      .then(res => res.json())\r\n      .then(res => {\r\n        dispatch(login_response(res));\r\n        if (res.authenticated) {\r\n          const cookies = new Cookies();\r\n          let expireDate = new Date();\r\n          expireDate.setDate(expireDate.getDate() + parseInt(cookieExpiresDays));\r\n          cookies.set(cookieAuthName, res, { path: urlRedirect || cookiePath, expires: expireDate });\r\n          if (urlRedirect) {\r\n            window.location.assign(urlRedirect);\r\n          } else if (redirect && history) {\r\n             history.push({ pathname: redirect }); \r\n          } else {\r\n            window.location.reload();\r\n          }\r\n        } else {\r\n          dispatch(login_http_error({ status: 401, message: 'Nome de Utilizador ou Palavra-passe inválido'}));\r\n        }\r\n      }).catch(error => {\r\n        console.log('error', error);\r\n        dispatch(login_http_error());\r\n      });\r\n  }\r\n}\r\n\r\nexport function login(auth, history, redirect, urlRedirect) {\r\n  return function (dispatch, getState) {\r\n    dispatch(login_response(auth));\r\n    if (auth.authenticated) {\r\n      const cookies = new Cookies();\r\n      let expireDate = new Date();\r\n      expireDate.setDate(expireDate.getDate() + parseInt(cookieExpiresDays));\r\n      cookies.set(cookieAuthName, auth, { path: urlRedirect || cookiePath, expires: expireDate });\r\n      if (urlRedirect) {\r\n        window.location.assign(urlRedirect);\r\n      } else if (redirect && history) {\r\n        history.push({ pathname: redirect }); \r\n      } else {\r\n        window.location.reload();\r\n      } \r\n    }\r\n  }\r\n}\r\n/*\r\nexport function login(data) {\r\n  const action = {\r\n    type: AUTH_LOGIN,\r\n    data\r\n  }\r\n  return action\r\n}\r\n*/\r\n\r\nexport function logout() {\r\n  const cookies = new Cookies();\r\n  cookies.remove(cookieAuthName, { path: cookiePath });\r\n  window.location.reload();\r\n}\r\n\r\nexport function login_http_error(res) {\r\n  const action = {\r\n    type: AUTH_HTTP_ERROR,\r\n    res\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function login_clear_error() {\r\n  const action = {\r\n    type: AUTH_CLEAR_ERROR\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function login_response(res) {\r\n  const action = {\r\n    type: AUTH_RESPONSE,\r\n    res\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function login_reset_password(post, history, redirect) {\r\n  return function (dispatch, getState) {\r\n    dispatch(login_http_loading());\r\n    \r\n    let options = {\r\n      method: 'POST',\r\n      body: JSON.stringify({...post, redirect})\r\n    }\r\n\r\n    let url = API_URL + '/security/reset_password';\r\n    fetch(url, options)\r\n      .then(res => res.json())\r\n      .then(res => {\r\n        if (!res.error) {\r\n          dispatch(login_response({reset_password:true, ...res}));\r\n        } else {\r\n          dispatch(login_http_error({status: res.status, message: res.message}));\r\n        }\r\n      }).catch(error => {\r\n        dispatch(login_http_error());\r\n      });\r\n  }\r\n}\r\n\r\nexport function password_http_loading() {\r\n  const action = {\r\n    type: PASSWORD_HTTP_LOADING\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function password_reset_validation(post, history, redirect) {\r\n  return function (dispatch, getState) {\r\n    dispatch(password_http_loading());\r\n    \r\n    // Login request\r\n    let options = {\r\n      method: 'POST',\r\n      body: JSON.stringify(post)\r\n    }\r\n\r\n    let url = API_URL + '/security/reset_password_validation';\r\n    fetch(url, options)\r\n      .then(res => res.json())\r\n      .then(res => {\r\n        if (!res.error) {\r\n          dispatch(password_response(res));\r\n        } else {\r\n          dispatch(login_http_error({status: res.status, valid_token:false, message: res.message}));\r\n        }\r\n      }).catch(error => {\r\n        dispatch(login_http_error({status: 401, valid_token:false, message: 'Serviço indisponível'}));\r\n      });\r\n  }\r\n}\r\n\r\n\r\nexport function password_post(post, history, redirect) {\r\n  return function (dispatch, getState) {\r\n    dispatch(password_http_loading());\r\n    \r\n    let options = {\r\n      method: 'POST',\r\n      body: JSON.stringify(post)\r\n    }\r\n\r\n    let url = API_URL + '/security/set_password';\r\n    fetch(url, options)\r\n      .then(res => res.json())\r\n      .then(res => {\r\n        if (!res.error) {\r\n          dispatch(password_response(res));\r\n        } else {\r\n          dispatch(login_http_error({ status: res.status, message: res.message}));\r\n        }\r\n      }).catch(error => {\r\n        dispatch(password_http_error());\r\n      });\r\n  }\r\n}\r\n\r\nexport function password_response(res) {\r\n  const action = {\r\n    type: PASSWORD_RESPONSE,\r\n    res\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function password_http_error(res) {\r\n  const action = {\r\n    type: PASSWORD_HTTP_ERROR,\r\n    res\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function login_user_registration(post, history, redirect) {\r\n  return function (dispatch, getState) {\r\n    dispatch(login_http_loading());\r\n    \r\n    const { username, email } = post;\r\n\r\n    let options = {\r\n      method: 'POST',\r\n      body: JSON.stringify({...post, redirect})\r\n    }\r\n\r\n    let url = API_URL + '/security/register_user';;\r\n    fetch(url, options)\r\n      .then(res => res.json())\r\n      .then(res => {\r\n        if (!res.error) {\r\n          dispatch(login_response({register_user:true, username, email, redirect, ...res}));\r\n        } else {\r\n          dispatch(login_http_error({status: res.status, message: res.message}));\r\n        }\r\n      }).catch(error => {\r\n        dispatch(login_http_error());\r\n      });\r\n  }\r\n}\r\n\r\nexport function registration_http_loading() {\r\n  const action = {\r\n    type: REGISTRATION_HTTP_LOADING\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function registration_post(post, history, redirect) {\r\n  return function (dispatch, getState) {\r\n    dispatch(registration_http_loading());\r\n    \r\n    let options = {\r\n      method: 'POST',\r\n      body: JSON.stringify(post)\r\n    }\r\n\r\n    let url = API_URL + '/security/registration/confirmation';\r\n    fetch(url, options)\r\n      .then(res => res.json())\r\n      .then(res => {\r\n        dispatch(registration_response(res));\r\n        if (res.authenticated) {\r\n          const cookies = new Cookies();\r\n          let expireDate = new Date();\r\n          expireDate.setDate(expireDate.getDate() + parseInt(cookieExpiresDays));\r\n          cookies.set(cookieAuthName, res, { path: cookiePath, expires: expireDate });\r\n          if (redirect && history) history.push({ pathname: redirect }); \r\n          else window.location.reload();\r\n        } else {\r\n          //dispatch(registration_http_error({ status: 401, message: 'Nome de Utilizador ou Palavra-passe inválido'}));\r\n        }\r\n      }).catch(error => {\r\n        dispatch(registration_http_error());\r\n      });\r\n  }\r\n}\r\n\r\nexport function registration_confirmation(post, history, redirect) {\r\n  return function (dispatch, getState) {\r\n    dispatch(login_http_loading());\r\n    \r\n    let options = {\r\n      method: 'POST',\r\n      body: JSON.stringify(post)\r\n    }\r\n\r\n    let url = API_URL + '/security/registration/confirmation';\r\n    fetch(url, options)\r\n      .then(res => res.json())\r\n      .then(res => {\r\n        if (!res.error) {\r\n          dispatch(registration_response(res));\r\n        } else {\r\n          dispatch(login_http_error({status: res.status, valid_token:false, message: res.message}));\r\n        }\r\n      }).catch(error => {\r\n        dispatch(login_http_error());\r\n      });\r\n  }\r\n}\r\n\r\n\r\nexport function registration_send_confirmation(post, history, redirect) {\r\n  return function (dispatch, getState) {\r\n    dispatch(login_http_loading());\r\n    \r\n    let options = {\r\n      method: 'POST',\r\n      body: JSON.stringify({...post, redirect})\r\n    }\r\n\r\n    let url = API_URL + '/security/registration/send_confirmation';\r\n    fetch(url, options)\r\n      .then(res => res.json())\r\n      .then(res => {\r\n        if (!res.error) {\r\n          dispatch(login_response(res));\r\n        } else {\r\n          dispatch(login_http_error({status: res.status, message: res.message}));\r\n        }    \r\n      }).catch(error => {\r\n        dispatch(login_http_error());\r\n      });\r\n  }\r\n}\r\n\r\nexport function registration_response(res) {\r\n  const action = {\r\n    type: REGISTRATION_RESPONSE,\r\n    res\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function registration_http_error(res) {\r\n  const action = {\r\n    type: REGISTRATION_HTTP_ERROR,\r\n    res\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function viewer_set_drawings(data) {\r\n  const action = {\r\n    type: VIEWER_SET_DRAWINGS,\r\n    data\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function viewer_set_featureinfo(data) {\r\n  const action = {\r\n    type: VIEWER_SET_FEATUREINFO,\r\n    data\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function viewer_set_geolocation(data) {\r\n  const action = {\r\n    type: VIEWER_SET_GEOLOCATION,\r\n    data\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function viewer_set_coordinates(data) {\r\n  const action = {\r\n    type: VIEWER_SET_COORDINATES,\r\n    data\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function viewer_set_config(config) {\r\n  const action = {\r\n    type: VIEWER_SET_CONFIG,\r\n    config,\r\n    viewer: config\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function viewer_load_components(components) {\r\n  const action = {\r\n    type: VIEWER_LOAD_COMPONENTS,\r\n    components\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function viewer_unload_components(core) {\r\n  return function (dispatch, getState) {\r\n    core.unloadComponents();\r\n    const action = {\r\n      type: VIEWER_UNLOAD_COMPONENTS\r\n    }\r\n    dispatch(action);\r\n  }\r\n}\r\n\r\nexport function viewer_error(history) {\r\n  const action = {\r\n    type: VIEWER_LOAD_ERROR,\r\n    redirect: '/not-found'\r\n  }\r\n  if (action.redirect && history) history.push({ pathname: action.redirect })\r\n  return action;\r\n}\r\n\r\nexport function viewer_not_found(history) {\r\n  const action =  {\r\n    type: VIEWER_NOT_FOUND,\r\n    redirect: '/not-found'\r\n  }\r\n  if (action.redirect && history) history.push({ pathname: action.redirect })\r\n  return action;\r\n}\r\n\r\n\r\nexport function viewer_not_authorized(history, redirect) {\r\n  const action = {\r\n    type: VIEWER_NOT_AUTHORIZED,\r\n    redirect: redirect ? redirect : '/not-allowed'\r\n  }\r\n  if (action.redirect && history) history.push({ pathname: action.redirect })\r\n  return action;\r\n}\r\n\r\nexport function viewer_load_done(components) {\r\n  const action = {\r\n    type: VIEWER_LOAD_DONE\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function viewer_set_selectedmenu(selected_menu) {\r\n  const action = {\r\n    type: VIEWER_SET_SELECTEDMENU,\r\n    selected_menu\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function viewer_set_exclusive_mapcontrol(exclusive_mapcontrol) {\r\n  const action = {\r\n    type: VIEWER_SET_EXCUSIVE_MAPCONTROL,\r\n    exclusive_mapcontrol\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function viewer_load(core, id, history) {\r\n  return function (dispatch, getState) {\r\n\r\n    // Get logged user\r\n    const cookies = new Cookies();\r\n    const logged = cookies.get(cookieAuthName);\r\n    \r\n    // Fetch viewer\r\n    let url = id ? API_URL + '/app/viewer/' + id + (history.location.search || '') : CONFIG_URL;\r\n    if (!url) {\r\n      url = API_URL + '/app/viewer' + (history.location.search || '')\r\n    }\r\n\r\n    const options = { headers: {} };\r\n    \r\n    // Add logged user token\r\n    if (logged) options.headers['X-API-KEY'] = logged.token;\r\n    \r\n    // Make request\r\n    fetch(url, options).then(res => {\r\n\r\n      // Validate response\r\n      if (res.status === 401) throw new Error('Unauthorized');\r\n      else if (res.status !== 200) throw new Error('Not found');\r\n      return res.json();\r\n      \r\n    }).then(config => {\r\n      \r\n      // Validate config\r\n      if (!config) return dispatch(viewer_not_found(history));\r\n      if (!config.config_json) return dispatch(viewer_not_found(history));\r\n\r\n      //Clears authentication cookie if user is not valid\r\n      if (!config?.user_info?.username) {\r\n        const cookies = new Cookies();\r\n        cookies.remove(cookieAuthName, { path: cookiePath });\r\n      }\r\n\r\n      // Unload components\r\n      dispatch(viewer_unload_components(core));\r\n\r\n      // Setup config\r\n      config['checked'] = config.config_json.checked ? config.config_json.checked : [];\r\n      config['removed'] = [];\r\n      config['featureinfo'] = [];\r\n      config['geolocation'] = null;\r\n      config['coordinates'] = [];\r\n      config['exclusive_mapcontrol'] = null;\r\n      core.setConfig(config);\r\n\r\n      if (config?.config_json?.show_menu === false || !config?.config_json?.selected_menu) {\r\n        config['staticMenuInactive'] = true;\r\n      }\r\n\r\n      dispatch(viewer_set_config(config));\r\n\r\n      // Load components\r\n      let count = 0;\r\n      let { components } = config.config_json;\r\n      components.forEach(component => {\r\n        core.addComponent(core, component, () => {\r\n          count++;\r\n          if (count === components.length) {\r\n\r\n            // Index by id\r\n            let pitems = {};\r\n            components.forEach(c => pitems[c.id] = c);\r\n\r\n            // Finally, load into redux store\r\n            dispatch(viewer_load_components(pitems));\r\n            dispatch(viewer_load_done());\r\n          }\r\n        })\r\n      })\r\n\r\n    }).catch(error => {\r\n\r\n      // Redirect to login or error pages\r\n      if (error.message === 'Unauthorized') {\r\n        if (!logged) {\r\n          let redirect = '/login?redirect=' + (id || '/');\r\n          if (window.location.pathname.toLowerCase().indexOf(core.BASE_URL + 'mapa') > -1) {\r\n            redirect += '&path=/mapa/';\r\n          } else if (window.location.pathname.toLowerCase().indexOf(core.BASE_URL + 'map') > -1) {\r\n            redirect += '&path=/map/';\r\n          } else if (window.location.pathname.toLowerCase().indexOf(core.BASE_URL) < 0) {\r\n            redirect += '&url_redirect=/' + id;\r\n          }\r\n          history.push(redirect);\r\n        } else dispatch(viewer_not_authorized(history));\r\n      } else dispatch(viewer_not_found(history));\r\n    })\r\n  }\r\n}\r\n\r\nexport function viewer_session_load(history) {\r\n  const action =  {\r\n    type: VIEWER_SESSION_LOAD,\r\n    redirect: history.location.pathname + (history.location.search ? history.location.search + '&session=true' : '?session=true')\r\n  }\r\n  if (action.redirect && history) history.push({ pathname: action.redirect })\r\n  return action;\r\n}\r\n\r\nexport function viewer_session_saved(session) {\r\n  const action =  {\r\n    type: VIEWER_SESSION_SAVED,\r\n    session: session\r\n  }\r\n  return action;\r\n}\r\n\r\n// TODO: calculate is theme on scale\r\nexport function isThemeOnScale(olmap, layer) {\r\n  return isThemeOnScaleMapModel(olmap, layer);\r\n}\r\n\r\nexport function map_set_extent(center, extent, srid) {\r\n  let action = {\r\n    type: MAP_SET_EXTENT,\r\n    center,\r\n    extent,\r\n    srid\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function map_set_size(size) {\r\n  let action = {\r\n    type: MAP_SET_SIZE,\r\n    size\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function map_set_class(className) {\r\n  let action = {\r\n    type: MAP_SET_CLASS,\r\n    className\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function layers_set_checked(checked) {\r\n  let action = {\r\n    type: LAYERS_SET_CHECKED,\r\n    checked\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function layers_set_opened(opened) {\r\n  let action = {\r\n    type: LAYERS_SET_OPENED,\r\n    opened\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function layers_update_theme(theme) {\r\n  let action = {\r\n    type: LAYERS_UPDATE_THEME,\r\n    theme\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function viewer_add_themes(parentId, themes = [], top) {\r\n  let action = {\r\n    type: VIEWER_ADD_THEMES,\r\n    parentId,\r\n    themes, \r\n    top\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function layers_remove_items(ids) {\r\n  let action = {\r\n    type: LAYERS_REMOVE_ITEMS,\r\n    ids\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function viewer_remove_themes(ids) {\r\n  let action = {\r\n    type: VIEWER_REMOVE_THEMES,\r\n    ids\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function viewer_set_configjson(config_json) {\r\n  let action = {\r\n    type: VIEWER_SET_CONFIGJSON,\r\n    config_json\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function viewer_update_mapcontrol(control) {\r\n  let action = {\r\n    type: VIEWER_UPDATE_MAPCONTROL,\r\n    control\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function viewer_set_displaycrs(crs) {\r\n  let action = {\r\n    type: VIEWER_SET_DISPLAYCRS,\r\n    crs\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function layout_wrapper_click() {\r\n  const action = {\r\n    type: LAYOUT_WRAPPER_CLICK,\r\n    overlayMenuActive: false,\r\n    mobileMenuActive: false\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function layout_toggle_overlaymenu() {\r\n  const action = {\r\n    type: LAYOUT_TOGGLE_OVERLAYMENU\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function layout_toggle_staticmenu() {\r\n  const action = {\r\n    type: LAYOUT_TOGGLE_STATICMENU\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function layout_toggle_mobilemenu() {\r\n  const action = {\r\n    type: LAYOUT_TOGGLE_MOBILEMENU\r\n  }\r\n  return action;\r\n}\r\n\r\nexport function layout_toggle_menu(isDesktop) {\r\n  return (dispatch, getState) => {\r\n    if (isDesktop) {\r\n      if (getState().root.viewer.layoutMode === 'overlay') {\r\n        dispatch(layout_toggle_overlaymenu());\r\n      } else if (getState().root.viewer.layoutMode === 'static') {\r\n        dispatch(layout_toggle_staticmenu())\r\n      }\r\n    } else {\r\n      dispatch(layout_toggle_mobilemenu())\r\n    }\r\n  }\r\n}\r\n\r\nexport function layout_show_menu(isDesktop) {\r\n  return (dispatch, getState) => {\r\n    if (isDesktop) {\r\n      if (getState().root.viewer.layoutMode === 'overlay') {\r\n        if (getState().root.viewer.overlayMenuActive) {\r\n          dispatch(layout_toggle_overlaymenu());\r\n        }\r\n      } else if (getState().root.viewer.layoutMode === 'static') {\r\n        if (getState().root.viewer.staticMenuInactive) {\r\n          dispatch(layout_toggle_staticmenu());\r\n        }\r\n      }\r\n    } else {\r\n      //dispatch(layout_toggle_mobilemenu())\r\n      if (getState().root.viewer.layoutMode === 'overlay') {\r\n        if (getState().root.viewer.overlayMenuActive) {\r\n          dispatch(layout_toggle_overlaymenu());\r\n        }\r\n      } else if (getState().root.viewer.layoutMode === 'static') {\r\n        if (!getState().root.viewer.mobileMenuActive) {\r\n          dispatch(layout_toggle_mobilemenu());\r\n        }\r\n      } \r\n    }\r\n  }\r\n}\r\n\r\nexport function getThemeLegendUrl(config) {\r\n  let url = config.legend_url;\r\n  if (!url && config.type === 'WMS') {\r\n    url = createLegendUrl(config.url, config.wms_layers || config.layers, config.crs)\r\n  } else {\r\n    if (window.location.protocol === 'https:' && !isUrlAppOrigin(url) && navigator.userAgent.indexOf(\"Firefox\") == -1) {\r\n      const turl = new URL(url);\r\n      if (turl.protocol === 'http:') {\r\n        url = MAP_PROXY + encodeURIComponent(url);\r\n      }\r\n    }\r\n  }\r\n  return url;\r\n}\r\n\r\n// TODO: decide where to put this\r\nconst createLegendUrl = (url, layer, srs = 4326) => {\r\n  let finalurl = url;\r\n  finalurl += finalurl.indexOf('?') === -1 ? '?' : '';\r\n\r\n  //console.log('SRS=' + (srs.indexOf(':') === -1 ? 'EPSG:' + srs : srs));\r\n\r\n  finalurl = finalurl + '&' + ([\r\n        'SERVICE=WMS',\r\n        'VERSION=1.1.1',\r\n        'REQUEST=GetLegendGraphic',\r\n        'FORMAT=image%2Fpng',\r\n        'SRS=' + (String(srs).indexOf(':') === -1 ? 'EPSG:' + srs : srs),\r\n        'CRS=' + (String(srs).indexOf(':') === -1 ? 'EPSG:' + srs : srs),\r\n        'LAYER=' + layer\r\n    ].join('&'));\r\n\r\n  if (window.location.protocol == 'https:' && !isUrlAppOrigin(finalurl) && navigator.userAgent.indexOf(\"Firefox\") == -1) {\r\n    const turl = new URL(finalurl);\r\n    if (turl.protocol === 'http:') {\r\n      finalurl = MAP_PROXY + encodeURIComponent(finalurl);\r\n    }\r\n  }\r\n\r\n  return finalurl;\r\n};\r\n\r\nexport const transform_extent = (source, target, extent) => {\r\n  return transformExtent(source, target, extent);\r\n}","import { v4 as uuid } from 'uuid'\r\nconst topics = {}\r\n\r\nexport function subscribe(topic, fn) {\r\n  if (!topics[topic]) topics[topic] = {}\r\n  const id = uuid()\r\n  topics[topic][id] = fn\r\n  return () => {\r\n    topics[topic][id] = null\r\n    delete topics[topic][id]\r\n  }\r\n}\r\n\r\nexport function publish(topic, args) {\r\n  if (!topics[topic]) return\r\n  Object.values(topics[topic]).forEach(fn => {\r\n    if (fn) fn(args)\r\n  })\r\n}","import React from 'react'\r\nimport { extend, omit } from 'underscore'\r\nimport thunk from 'redux-thunk'\r\nimport { createStore, applyMiddleware, combineReducers } from 'redux'\r\nimport * as local_components from './core/components'\r\nimport * as core_components from '@scalargis/components'\r\nimport * as actions from './core/actions'\r\nimport * as utils from './core/utils'\r\nimport * as pubsub from './core/pubsub'\r\n\r\nexport function createReducerManager(initialReducers) {\r\n  // Create an object which maps keys to reducers\r\n  const reducers = { ...initialReducers }\r\n\r\n  const reducers_list = {}\r\n\r\n  // Create the initial combinedReducer\r\n  let combinedReducer = combineReducers(reducers)\r\n\r\n  // An array which is used to delete state keys when reducers are removed\r\n  let keysToRemove = []\r\n\r\n  return {\r\n    getReducerMap: () => reducers,\r\n\r\n    // The root reducer function exposed by this object\r\n    // This will be passed to the store\r\n    reduce: (state, action) => {\r\n      // If any reducers have been removed, clean up their state first\r\n      if (keysToRemove.length > 0) {\r\n        state = { ...state }\r\n        for (let key of keysToRemove) {\r\n          delete state[key]\r\n        }\r\n        keysToRemove = []\r\n      }\r\n\r\n      // Delegate to the combined reducer\r\n      return combinedReducer(state, action)\r\n    },\r\n\r\n    // Adds a new reducer with the specified key\r\n    add: (key, reducer) => {\r\n      if (reducers_list[key]) {\r\n        reducers_list[key] = \r\n        { \r\n          ...reducers_list[key], \r\n          ...reducer\r\n        }\r\n      } else {\r\n        reducers_list[key] = { ...reducer }\r\n      }\r\n\r\n      const new_reducer = (state = {}, action) => {\r\n        if (reducers_list[key] && reducers_list[key][action.type]) {\r\n          const reducer_func = reducers_list[key][action.type];\r\n          const new_state = reducer_func(state, action);\r\n          return new_state;\r\n        }\r\n\r\n        return state;\r\n      }\r\n      //Set internal reducer function name equal to reducer key\r\n      Object.defineProperty(new_reducer, 'name', {value: key})\r\n\r\n      // Add the reducer to the reducer mapping\r\n      reducers[key] = new_reducer;\r\n\r\n      // Generate a new combined reducer\r\n      combinedReducer = combineReducers(reducers)\r\n    },\r\n\r\n    // Removes a reducer with the specified key\r\n    remove: key => {\r\n      if (!key || !reducers[key]) {\r\n        return\r\n      }\r\n\r\n      // Remove it from the reducer mapping\r\n      delete reducers[key]\r\n\r\n      // Add the key to the list of keys to clean up\r\n      keysToRemove.push(key)\r\n\r\n      // Generate a new combined reducer\r\n      combinedReducer = combineReducers(reducers);\r\n    }\r\n  }\r\n}\r\n\r\nfunction Core(config, reducers) {\r\n\r\n  const reducerManager = createReducerManager(reducers);\r\n\r\n  const store = createStore(reducerManager.reduce, applyMiddleware(thunk));\r\n  // Put the reducer manager on the store so it is easily accessible\r\n  store.reducerManager = reducerManager;\r\n  //console.log(store.getState());\r\n\r\n  /**\r\n  * Apply config options\r\n  */\r\n  for (const [key, value] of Object.entries(config)) {\r\n    this[key] = value\r\n  }\r\n\r\n  /**\r\n   * Hold programatic config\r\n   */\r\n  this.config = {};\r\n\r\n  /**\r\n   * Hold redux actions\r\n   */\r\n  this.actions = actions;\r\n\r\n  /**\r\n   * Hold PubSubs methods\r\n   */\r\n  this.pubsub = pubsub;\r\n\r\n  /**\r\n   * Hold redux store\r\n   */\r\n  this.store = store;\r\n  //this.store = createStore(rootReducer, applyMiddleware(thunk));\r\n\r\n  /**\r\n   * Hold app components\r\n   */\r\n  this.__components = {};\r\n\r\n  /**\r\n   * Hold menu components\r\n   */\r\n  this.__mainmenu = {};\r\n\r\n  /**\r\n   * Secure app props\r\n   */\r\n  this.__secureProps = ['config', 'actions', 'store', 'Renderer', '__components', '__mainmenu'];\r\n}\r\n\r\n// Set core config\r\nCore.prototype.setConfig = function(config) {\r\n  this.config = config;\r\n}\r\n\r\n// Add components\r\nCore.prototype.addComponent = function(core, component, done) {\r\n\r\n  const components = { ...local_components, ...core_components};\r\n  \r\n  if (components[component.type]) {\r\n\r\n    //Add local and core components\r\n    const c = components[component.type];\r\n\r\n    // Add component actions\r\n    if (c.actions && typeof c.actions === 'object') {\r\n      core.actions = extend(core.actions, omit(c.actions, this.__secureProps ));\r\n    }\r\n\r\n    // Add component reducers\r\n    if (c.reducers && typeof c.reducers === 'object') {\r\n      Object.entries(c.reducers).forEach(function([key, reducer]) {\r\n        core.store.reducerManager.add(key, reducer);\r\n     });\r\n    }    \r\n\r\n    // Registry Pattern: register react component in components registry\r\n    if (!!c.default && !this.__components[component.type]) {   \r\n      const ReactComponent = c.default;\r\n      this.__components[component.type] = ReactComponent;\r\n    }\r\n\r\n    // Main menu registry\r\n    if (!!c.MainMenu && !this.__mainmenu[component.type]) {\r\n      const MainMenu = c.MainMenu;\r\n      this.__mainmenu[component.type] = MainMenu;\r\n    }\r\n\r\n    done();\r\n    \r\n  } else {\r\n\r\n    // Add plugin components\r\n    import('./components/' + component.type + '/src/Main.js').then(c => {\r\n\r\n      // Add component actions\r\n      if (c.actions && typeof c.actions === 'object') {\r\n        core.actions = extend(core.actions, omit(c.actions, this.__secureProps ));\r\n      }\r\n\r\n      // Add component reducers\r\n      if (c.reducers && typeof c.reducers === 'object') {\r\n        Object.entries(c.reducers).forEach(function([key, reducer]) {\r\n          core.store.reducerManager.add(key, reducer);\r\n      });\r\n      }\r\n\r\n      // Registry Pattern: register react component in components registry \r\n      if (!!c.default && !this.__components[component.type]) {\r\n        const ReactComponent = c.default;\r\n        this.__components[component.type] = ReactComponent;\r\n      }\r\n\r\n      // Main menu registry\r\n      if (!!c.MainMenu && !this.__mainmenu[component.type]) {\r\n        const MainMenu = c.MainMenu;\r\n        this.__mainmenu[component.type] = MainMenu;\r\n      }\r\n      \r\n      done();\r\n    }).catch(err => {\r\n      console.log('Error loading module:', err);\r\n      done();\r\n    })\r\n  }\r\n}\r\n\r\nCore.prototype.unloadComponents = function() {\r\n  this.__components = {}\r\n}\r\n\r\nCore.prototype.renderMainMenu = function({ selected_menu, props }) {\r\n  \r\n  // Validate not empty components registry\r\n  const keys = Object.keys(this.__mainmenu);\r\n  if (keys.length === 0) return null;\r\n\r\n  // From all components\r\n  let { components } = this.config.config_json;\r\n\r\n  // Filter by region\r\n  const mainmenuComponents = components.filter(c => c.target === 'mainmenu');  \r\n  \r\n  // Render components\r\n  return mainmenuComponents.map(c => {\r\n    let PluginComponent = this.__mainmenu[c.type];\r\n\r\n    // Validate dynamic import is loaded\r\n    if (!PluginComponent) return null;\r\n\r\n    const className = selected_menu === c.id ?\r\n    \"p-button-rounded p-button-raised p-button-sm\" :\r\n    \"p-button-rounded p-button-raised p-button-sm p-button-outlined\";\r\n\r\n    return (\r\n      <React.Fragment key={c.id}>\r\n        <PluginComponent\r\n          className={className}\r\n          record={c}\r\n          config={{ className, ...props, ...c.config_json }}\r\n          core={this}\r\n          actions={this.actions}\r\n          utils={utils}\r\n        />\r\n      </React.Fragment>\r\n    )\r\n  })\r\n}\r\n\r\nCore.prototype.renderComponentById = function({ id, as = '', props, }) {\r\n\r\n  // Validate id\r\n  if (!id) return null;\r\n  \r\n  // Validate not empty components registry\r\n  const keys = Object.keys(this.__components);\r\n  if (keys.length === 0) return null;\r\n\r\n  // From all components\r\n  let { components } = this.config.config_json;\r\n  \r\n  // Filter by id\r\n  let c = components.find(c => c.id === id);\r\n\r\n  // Render components\r\n  let PluginComponent = this.__components[c.type];\r\n\r\n  // Validate dynamic import is loaded\r\n  if (!PluginComponent) return null;\r\n  return (\r\n    <PluginComponent\r\n      record={c}\r\n      config={{ ...props, ...c.config_json }}\r\n      core={this}\r\n      actions={this.actions}\r\n      as={as}\r\n      utils={utils}\r\n    />\r\n  )\r\n}\r\n\r\nCore.prototype.renderComponents = function({ region, as = '', props, parent, separator = '', style = null, className = '' }) {\r\n  \r\n  // Validate not empty components registry\r\n  const keys = Object.keys(this.__components);\r\n  if (keys.length === 0) return null;\r\n\r\n  // From all components\r\n  let { components } = this.config.config_json;\r\n  \r\n  // Filter by parent\r\n  if (parent) components = components.filter(c => parent.children.includes(c.id));\r\n\r\n  // Filter by region\r\n  const regionComponents = components.filter(c => c.target === region);\r\n\r\n  // Render components\r\n  return regionComponents.map(c => {\r\n    let PluginComponent = this.__components[c.type];\r\n\r\n    // Validate dynamic import is loaded\r\n    if (!PluginComponent) return null;\r\n    return (\r\n      <div key={c.id} className={className} style={style ? style(c) : null }>\r\n        <PluginComponent\r\n          record={c}\r\n          config={{ ...props, ...c.config_json }}\r\n          core={this}\r\n          actions={this.actions}\r\n          region={region}\r\n          as={c.as || as}\r\n          utils={utils}\r\n        />\r\n        { separator }\r\n      </div>\r\n    )\r\n  })\r\n}\r\n\r\nCore.prototype.renderComponentsLinks = function({ region, as = '', props, parent, separator = '', style = null, className = '' }) {\r\n  \r\n  // Validate not empty components registry\r\n  const keys = Object.keys(this.__components);\r\n  if (keys.length === 0) return null;\r\n\r\n  // From all components\r\n  let { components } = this.config.config_json;\r\n  \r\n  // Filter by parent\r\n  if (parent) components = components.filter(c => parent.children.includes(c.id));\r\n\r\n  // Filter by region\r\n  const regionComponents = components.filter(c => c.links === region);\r\n\r\n  // Render components\r\n  return regionComponents.map(c => {\r\n    let PluginComponent = this.__components[c.type];\r\n\r\n    // Validate dynamic import is loaded\r\n    if (!PluginComponent) return null;\r\n    return (\r\n      <div key={c.id} className={className} style={style ? style(c) : null }>\r\n        <PluginComponent\r\n          type=\"link\"\r\n          region={region}\r\n          record={c}\r\n          config={{ ...props, ...c.config_json }}\r\n          core={this}\r\n          actions={this.actions}\r\n          as={as}\r\n          utils={utils}\r\n        />\r\n        { separator }\r\n      </div>\r\n    )\r\n  })\r\n}\r\n\r\nexport default Core;\r\n","import Cookies from 'universal-cookie';\r\nimport {\r\n  LAYOUT_TOGGLE_MOBILEMENU,\r\n  LAYOUT_TOGGLE_OVERLAYMENU,\r\n  LAYOUT_TOGGLE_STATICMENU,\r\n  LAYOUT_WRAPPER_CLICK,\r\n  VIEWER_LOAD,\r\n  VIEWER_LOAD_COMPONENTS,\r\n  VIEWER_UNLOAD_COMPONENTS,\r\n  VIEWER_LOAD_DONE,\r\n  VIEWER_ADD_THEMES,\r\n  VIEWER_REMOVE_THEMES,\r\n  LAYERS_SET_CHECKED,\r\n  LAYERS_SET_OPENED,\r\n  VIEWER_SET_CONFIG,\r\n  VIEWER_SET_CONFIGJSON,\r\n  VIEWER_SET_SELECTEDMENU,\r\n  VIEWER_SET_EXCUSIVE_MAPCONTROL,\r\n  LAYERS_UPDATE_THEME,\r\n  LAYERS_REMOVE_ITEMS,\r\n  MAP_SET_EXTENT,\r\n  MAP_SET_SIZE,\r\n  MAP_SET_CLASS,\r\n  VIEWER_SET_DISPLAYCRS,\r\n  AUTH_HTTP_ERROR,\r\n  AUTH_CLEAR_ERROR,\r\n  AUTH_HTTP_LOADING,\r\n  AUTH_RESPONSE,\r\n  //AUTH_LOGIN,\r\n  PASSWORD_HTTP_ERROR,\r\n  PASSWORD_HTTP_LOADING,\r\n  PASSWORD_RESPONSE,\r\n  REGISTRATION_HTTP_ERROR,\r\n  REGISTRATION_HTTP_LOADING,\r\n  REGISTRATION_RESPONSE,\r\n  VIEWER_SET_FEATUREINFO,\r\n  VIEWER_SET_GEOLOCATION,\r\n  VIEWER_UPDATE_MAPCONTROL,\r\n  VIEWER_SAVE_HTTP_LOADING,\r\n  VIEWER_SAVE_HTTP_ERROR,\r\n  VIEWER_SAVE_RESPONSE,\r\n\r\n  VIEWER_SESSION_SAVED,\r\n\r\n  VIEWER_SET_DRAWINGS,\r\n  VIEWER_SET_COORDINATES\r\n} from '../actions';\r\nimport { traverseLayersTree, getCookieAuthName } from '../utils';\r\n\r\n\r\nconst initialViewer = {\r\n  layoutMode: 'static',\r\n  layoutColorMode: 'light',\r\n  staticMenuInactive: false,\r\n  overlayMenuActive: false,\r\n  mobileMenuActive: false,\r\n  config_json: {\r\n    layers: [],\r\n    removed: [],\r\n    map_controls: []\r\n  }\r\n}\r\n\r\nconst cookies = new Cookies();\r\nconst cookieAuthName = getCookieAuthName();\r\n\r\n//export default (state = { loading: true, auth: { data: cookies.get(cookieAuthName)}, config: null, viewer: initialViewer, components: {} }, action) => {\r\nconst root = (state = { loading: true, auth: { data: cookies.get(cookieAuthName)}, registration: {}, password: {}, config: null, viewer: initialViewer, components: {} }, action) => {\r\n\r\n  //console.log('action', action);\r\n  \r\n  switch (action.type) {\r\n\r\n    // Login loading\r\n    case AUTH_HTTP_LOADING:\r\n      return {\r\n        ...state,\r\n        auth: {\r\n          loading: true,\r\n          http_error: false,\r\n          error: null\r\n        }\r\n      }\r\n\r\n    // Login http error\r\n    case AUTH_HTTP_ERROR:\r\n      return {\r\n        ...state,\r\n        auth: {\r\n          loading: false,\r\n          http_error: true,\r\n          response: action.res\r\n        }\r\n      }\r\n\r\n    // Login http error\r\n    case AUTH_CLEAR_ERROR:\r\n      return {\r\n        ...state,\r\n        auth: {\r\n          loading: false,\r\n          http_error: false,\r\n          response: null\r\n        }\r\n      }      \r\n\r\n    // Login response\r\n    case AUTH_RESPONSE:\r\n      return {\r\n        ...state,\r\n        auth: {\r\n          loading: false,\r\n          response: action.res\r\n        }\r\n      }\r\n    \r\n    /*\r\n    // Login user\r\n    case AUTH_LOGIN:\r\n      return {\r\n        ...state,\r\n        auth: {\r\n          loading: false,\r\n          data: action.data\r\n        }\r\n      }\r\n    */\r\n\r\n    // Password loading\r\n    case PASSWORD_HTTP_LOADING:\r\n      return {\r\n        ...state,\r\n        password: {\r\n          loading: true,\r\n          http_error: false,\r\n          error: null\r\n        }\r\n      }      \r\n\r\n    // Password http error\r\n    case PASSWORD_HTTP_ERROR:\r\n      return {\r\n        ...state,\r\n        password: {\r\n          loading: false,\r\n          http_error: true,\r\n          response: action.res\r\n        }\r\n      }\r\n\r\n    // Password response\r\n    case PASSWORD_RESPONSE:\r\n      return {\r\n        ...state,\r\n        password: {\r\n          loading: false,\r\n          response: action.res\r\n        }\r\n      }\r\n\r\n    // Registration loading\r\n    case REGISTRATION_HTTP_LOADING:\r\n      return {\r\n        ...state,\r\n        registration: {\r\n          loading: true,\r\n          http_error: false,\r\n          error: null\r\n        }\r\n      }      \r\n\r\n    // Registration http error\r\n    case REGISTRATION_HTTP_ERROR:\r\n      return {\r\n        ...state,\r\n        registration: {\r\n          loading: false,\r\n          http_error: true,\r\n          response: action.res\r\n        }\r\n      }\r\n\r\n    // Rgistration response\r\n    case REGISTRATION_RESPONSE:\r\n      return {\r\n        ...state,\r\n        registration: {\r\n          loading: false,\r\n          response: action.res\r\n        }\r\n      }      \r\n    \r\n    // Start loading viewer config\r\n    case VIEWER_LOAD:\r\n      return {\r\n        ...state,\r\n        loading: true\r\n      }\r\n\r\n    // Set viewer config\r\n    case VIEWER_SET_CONFIG:\r\n      return {\r\n        ...state,\r\n        config: action.config,\r\n        viewer: {\r\n          ...initialViewer,\r\n          ...action.viewer\r\n        }\r\n      }\r\n\r\n    // Save loading\r\n    case VIEWER_SAVE_HTTP_LOADING:\r\n      return {\r\n        ...state,\r\n        viewer: {          \r\n          ...state.viewer,\r\n          save_loading: true,\r\n          save_response: null,\r\n          save_error: null\r\n        }\r\n      }      \r\n\r\n    // Set save viewer HTTP error\r\n    case VIEWER_SAVE_HTTP_ERROR:\r\n      return {\r\n        ...state,\r\n        viewer: {\r\n          ...state.viewer,\r\n          save_loading: false,\r\n          save_error: action.error\r\n        }\r\n      }\r\n\r\n    // Set save viewer last response\r\n    case VIEWER_SAVE_RESPONSE:\r\n      let save_options = {\r\n        name: action.save_options ? action.save_options.name : state.viewer.name,\r\n        title: action.save_options ? action.save_options.title : state.viewer.title,\r\n        description: action.save_options ? action.save_options.description : state.viewer.description,\r\n        allow_anonymous: action.save_options ? action.save_options.allow_anonymous : state.viewer.allow_anonymous,\r\n        allow_user_session : action.save_options ? action.save_options.allow_user_session : state.viewer.allow_user_session,\r\n        is_active: action.save_options ? action.save_options.is_active : state.viewer.is_active\r\n      }\r\n      return {\r\n        ...state,\r\n        viewer: {\r\n          ...state.viewer,\r\n          ...save_options,\r\n          save_loading: false,\r\n          save_response: action.res          \r\n        }\r\n      }     \r\n\r\n    case VIEWER_LOAD_COMPONENTS:\r\n      return {\r\n        ...state,\r\n        components: action.components\r\n      }\r\n\r\n    case VIEWER_UNLOAD_COMPONENTS:\r\n      return {\r\n        ...state,\r\n        components: {}\r\n      }\r\n\r\n    case VIEWER_LOAD_DONE:\r\n      return {\r\n        ...state,\r\n        loading: false\r\n      }\r\n\r\n    // Map set extent\r\n    case VIEWER_SET_SELECTEDMENU:\r\n      return {\r\n        ...state,\r\n        viewer: {\r\n          ...state.viewer,\r\n          config_json: {\r\n            ...state.viewer.config_json,\r\n            selected_menu: action.selected_menu\r\n          }\r\n        }\r\n      }\r\n\r\n    case VIEWER_SET_EXCUSIVE_MAPCONTROL:\r\n      return {\r\n        ...state,\r\n        viewer: {\r\n          ...state.viewer,\r\n          exclusive_mapcontrol: action.exclusive_mapcontrol\r\n        }\r\n      }\r\n\r\n    case VIEWER_SET_DRAWINGS:\r\n      return {\r\n        ...state,\r\n        viewer: {\r\n          ...state.viewer,\r\n          config_json: {\r\n            ...state.viewer.config_json,\r\n            drawings: [...action.data]\r\n          }\r\n        }\r\n      }\r\n\r\n    case VIEWER_SET_FEATUREINFO:\r\n      return {\r\n        ...state,\r\n        viewer: {\r\n          ...state.viewer,\r\n          featureinfo: [...action.data]\r\n        }\r\n      }\r\n\r\n    case VIEWER_SET_GEOLOCATION:\r\n      return {\r\n        ...state,\r\n        viewer: {\r\n          ...state.viewer,\r\n          geolocation: action.data\r\n        }\r\n      }\r\n\r\n    case VIEWER_SET_COORDINATES:\r\n      return {\r\n        ...state,\r\n        viewer: {\r\n          ...state.viewer,\r\n          coordinates: [...action.data]\r\n        }\r\n      }\r\n\r\n    // Map set extent\r\n    case MAP_SET_EXTENT:\r\n      return {\r\n        ...state,\r\n        viewer: {\r\n          ...state.viewer,\r\n          config_json: {\r\n            ...state.viewer.config_json,\r\n            center: action.center,\r\n            extent: action.extent\r\n          }\r\n        }\r\n      }\r\n\r\n    // Map set size\r\n    case MAP_SET_SIZE:\r\n      return {\r\n        ...state,\r\n        viewer: {\r\n          ...state.viewer,\r\n          size: action.size\r\n        }\r\n      }\r\n\r\n    // Map set class\r\n    case MAP_SET_CLASS:\r\n      return {\r\n        ...state,\r\n        viewer: {\r\n          ...state.viewer,\r\n          className: action.className\r\n        }\r\n      }       \r\n    \r\n      // Set checked themes\r\n    case LAYERS_SET_CHECKED:\r\n      const checked = [ ...action.checked ]\r\n      return {\r\n        ...state,\r\n        viewer: {\r\n          ...state.viewer,\r\n          config_json: {\r\n            ...state.viewer.config_json,\r\n            checked\r\n          }\r\n        }\r\n      }\r\n\r\n      // Set opened themes\r\n      case LAYERS_SET_OPENED:\r\n        const opened = [ ...action.opened ]\r\n        return {\r\n          ...state,\r\n          viewer: {\r\n            ...state.viewer,\r\n            config_json: {\r\n              ...state.viewer.config_json,\r\n              opened\r\n            }\r\n          }\r\n        }      \r\n\r\n    // Update theme\r\n    case LAYERS_UPDATE_THEME:\r\n      let { layers } = state.viewer.config_json;\r\n      let index = layers.findIndex(i => i.id === action.theme.id);\r\n      layers.splice(index, 1, action.theme);\r\n      return {\r\n        ...state,\r\n        viewer: {\r\n          ...state.viewer,\r\n          config_json: {\r\n            ...state.viewer.config_json,\r\n            layers\r\n          }\r\n        }\r\n      }\r\n\r\n    // Remove layers\r\n    case LAYERS_REMOVE_ITEMS:\r\n      let updated = Object.assign([], state.viewer.config_json.layers);\r\n\r\n      // Remove as child layers\r\n      traverseLayersTree(updated, null, (l, i) => {\r\n        if (l.children) l.children = l.children.filter(cid => action.ids.includes(cid) === false);\r\n      });\r\n\r\n      // Remove layers\r\n      traverseLayersTree(updated, null, (l, i) => {\r\n        if (action.ids.includes(l.id)) updated.splice(updated.indexOf(l), 1);\r\n      });\r\n\r\n      return {\r\n        ...state,\r\n        viewer: {\r\n          ...state.viewer,\r\n          config_json: {\r\n            ...state.viewer.config_json,\r\n            layers: updated\r\n          }\r\n        }\r\n      }\r\n\r\n    case VIEWER_SET_DISPLAYCRS:\r\n      return {\r\n        ...state,\r\n        viewer: {\r\n          ...state.viewer,\r\n          config_json: {\r\n            ...state.viewer.config_json,\r\n            display_crs: action.crs\r\n          }\r\n        }\r\n      }\r\n\r\n    // Add themes\r\n    case VIEWER_ADD_THEMES:\r\n      const tlayers = state.viewer.config_json.layers;\r\n\r\n      // Add themes\r\n      let newlayers = Object.assign([], tlayers);\r\n\r\n      newlayers = newlayers.concat(action.themes.map((t)=>({\r\n        ...t,\r\n        opacity: (t.opacity != undefined) ? t.opacity : 1\r\n      })));\r\n\r\n      // Find parent index\r\n      let parentId = action.parentId || 'main';\r\n      let parentIndex = newlayers.findIndex(i => i.id === parentId);\r\n      const parent = Object.assign({}, newlayers[parentIndex]);\r\n      if (action.top) {\r\n        parent.children = action.themes.map(t => t.id).concat(parent.children);\r\n      } else {\r\n        parent.children = parent.children.concat(action.themes.map(t => t.id));\r\n      }\r\n      newlayers.splice(parentIndex, 1, parent);\r\n\r\n      return {\r\n        ...state,\r\n        viewer: {\r\n          ...state.viewer,\r\n          config_json: {\r\n            ...state.viewer.config_json,\r\n            layers: newlayers\r\n          }\r\n        }\r\n      }\r\n\r\n    // Remove themes from ids\r\n    // DEPRECATED\r\n    case VIEWER_REMOVE_THEMES:\r\n      let { removed } = state.viewer;\r\n      removed = removed.concat(action.ids);\r\n      return {\r\n        ...state,\r\n        viewer: {\r\n          ...state.viewer,\r\n          removed\r\n        }\r\n      }\r\n\r\n    // Update map control\r\n    case VIEWER_UPDATE_MAPCONTROL:\r\n      let { map_controls } = state.viewer.config_json;\r\n      let mindex = map_controls.findIndex(i => i.id === action.control.id);\r\n      map_controls.splice(mindex, 1, action.control);\r\n      return {\r\n        ...state,\r\n        viewer: {\r\n          ...state.viewer,\r\n          config_json: {\r\n            ...state.viewer.config_json,\r\n            map_controls\r\n          }\r\n        }\r\n      }\r\n\r\n    // Set viewer configjson\r\n    case VIEWER_SET_CONFIGJSON:\r\n      return {\r\n        ...state,\r\n        viewer: {\r\n          ...state.viewer,\r\n          configjson: action.configjson\r\n        }\r\n      }\r\n\r\n    // Set viewer configjson\r\n    case VIEWER_SESSION_SAVED:\r\n      return {\r\n        ...state,\r\n        viewer: {\r\n          ...state.viewer,\r\n          is_session: true,\r\n          session: action.session,\r\n          save_loading: false,\r\n          save_response: null,\r\n          save_error: null          \r\n        }\r\n      }\r\n\r\n    // On click layout\r\n    case LAYOUT_WRAPPER_CLICK:\r\n      return {\r\n      ...state,\r\n      viewer: {\r\n        ...state.viewer,\r\n        overlayMenuActive: false//,\r\n        //mobileMenuActive: false\r\n      }\r\n    }\r\n\r\n    // Toggle overlay menu\r\n    case LAYOUT_TOGGLE_OVERLAYMENU:\r\n      return {\r\n      ...state,\r\n      viewer: {\r\n        ...state.viewer,\r\n        overlayMenuActive: !state.viewer.overlayMenuActive\r\n      }\r\n    }\r\n\r\n    // Toggle static menu\r\n    case LAYOUT_TOGGLE_STATICMENU:\r\n      return {\r\n      ...state,\r\n      viewer: {\r\n        ...state.viewer,\r\n        staticMenuInactive: !state.viewer.staticMenuInactive\r\n      }\r\n    }\r\n\r\n    // Toggle mobile menu\r\n    case LAYOUT_TOGGLE_MOBILEMENU:\r\n      return {\r\n        ...state,\r\n        viewer: {\r\n          ...state.viewer,\r\n          mobileMenuActive: !state.viewer.mobileMenuActive\r\n        }\r\n      }\r\n\r\n    // Not state change\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport default {\r\n  root\r\n}","import React from 'react';\r\nimport { Map, View } from 'ol';\r\nimport OlCollection from 'ol/Collection';\r\nimport Core from './Core';\r\nimport rootReducer from './core/reducers';\r\nimport { getAppRootPath, getAppBaseUrl, getAppClientUrl, getAppApiUrl, getAppMapProxyUrl, getAppUploadUrl, getCookieAuthName } from './core/utils';\r\n\r\nconst ROOT_PATH = getAppRootPath();\r\nconst BASE_URL = getAppBaseUrl();\r\nconst CLIENT_URL = getAppClientUrl();\r\nconst API_URL = getAppApiUrl();\r\nconst MAP_PROXY_URL = getAppMapProxyUrl();\r\nconst UPLOAD_URL = getAppUploadUrl();\r\nconst COOKIE_AUTH_NAME = getCookieAuthName();\r\nexport const core = new Core({ ROOT_PATH, BASE_URL, CLIENT_URL, API_URL, MAP_PROXY_URL, UPLOAD_URL, COOKIE_AUTH_NAME }, rootReducer);\r\n\r\nlet options = {\r\n  controls: new OlCollection(),\r\n  interactions: new OlCollection(),\r\n  view: new View({\r\n    center: [-878528, 4465088],\r\n    zoom: 12,\r\n    //rotation: -Math.PI / 8\r\n  })\r\n};\r\nexport const mainMap = new Map(options);\r\n\r\nconst AppContext = React.createContext();\r\n\r\nexport default AppContext","import React, { useEffect } from 'react'\r\nimport { View } from 'ol'\r\nimport 'ol/ol.css'\r\nimport './mainmap.css'\r\nimport { connect } from 'react-redux'\r\nimport  { addProjections, transformExtent } from '../model/MapModel'\r\n\r\nfunction MainMap(props) {\r\n  let { olMap, config, viewer, mainMapEl, core, dispatch, auth } = props;\r\n\r\n  useEffect(() => {\r\n    if (!config) return;\r\n    if (olMap && mainMapEl.current) olMap.setTarget(mainMapEl.current);\r\n    const { center, extent } = config.config_json;\r\n    const resolution = olMap.getView().getResolutionForExtent(extent);\r\n    olMap.getView().setCenter(center);\r\n    olMap.getView().setResolution(resolution);\r\n\r\n    // Attach on change center event\r\n    function onMoveEnd() {\r\n      const center = olMap.getView().getCenter();\r\n      const extent = olMap.getView().calculateExtent();\r\n      dispatch(core.actions.map_set_extent(center, extent));\r\n    }\r\n    olMap.on('moveend', onMoveEnd);\r\n\r\n    // Load Projections\r\n    if (viewer.config_json.crs_list && Array.isArray(viewer.config_json.crs_list)) {\r\n      addProjections(viewer.config_json.crs_list);\r\n    }\r\n\r\n    return () => {\r\n      olMap.un('moveend', onMoveEnd);\r\n    }\r\n  }, [config]);\r\n\r\n  const { center, extent } = viewer.config_json;\r\n  useEffect(() => {\r\n    if (!olMap) return;\r\n\r\n    // Apply programatic center and extent\r\n    if (extent) {\r\n      const resolution = olMap.getView().getResolutionForExtent(extent);\r\n      olMap.getView().setResolution(resolution);\r\n      olMap.getView().fit(extent, olMap.getSize(), { closest: true });\r\n    }\r\n    else if (center) olMap.getView().setCenter(center);\r\n  }, [center, extent]);\r\n\r\n  const { constrained_extent, min_zoom, max_zoom, max_resolution, min_resolution,\r\n    min_zoom_authenticated, max_zoom_authenticated, max_resolution_authenticated, min_resolution_authenticated,\r\n  } = viewer.config_json;\r\n  useEffect(() => {\r\n    if (!olMap) return;\r\n    if (!constrained_extent && !min_zoom && !max_zoom && !max_resolution && !min_resolution &&\r\n      !min_zoom_authenticated && !max_zoom_authenticated && !max_resolution_authenticated && !min_resolution_authenticated) return;\r\n\r\n    const viewOptions = {\r\n      center: olMap.getView().getCenter(),\r\n      zoom: olMap.getView().getZoom()\r\n    }\r\n\r\n    if (constrained_extent) viewOptions['extent'] = constrained_extent;\r\n    if (min_zoom) viewOptions['minZoom'] = min_zoom;\r\n    if (max_zoom) viewOptions['maxZoom'] = max_zoom;\r\n    if (max_resolution) viewOptions['maxResolution'] = max_resolution;\r\n    if (min_resolution) viewOptions['minResolution'] = min_resolution;\r\n\r\n    if (auth && auth.data && auth.data.authenticated) {\r\n      if (min_zoom_authenticated) viewOptions['minZoom'] = min_zoom_authenticated;\r\n      if (max_zoom_authenticated) viewOptions['maxZoom'] = max_zoom_authenticated;\r\n      if (max_resolution_authenticated) viewOptions['maxResolution'] = max_resolution_authenticated;\r\n      if (min_resolution_authenticated) viewOptions['minResolution'] = min_resolution_authenticated;      \r\n    }\r\n\r\n    // Recreate view with constrained extent and min and max zoom\r\n    olMap.setView(new View(viewOptions));    \r\n  }, [constrained_extent, min_zoom, max_zoom, max_resolution, min_resolution, min_zoom_authenticated, max_zoom_authenticated, max_resolution_authenticated, min_resolution_authenticated]);\r\n\r\n\r\n  // Set map size\r\n  let map_style = {};\r\n  if (viewer?.size?.width != null) map_style = {...map_style, width : viewer.size.width};\r\n  if (viewer?.size?.height != null) map_style = {...map_style, height : viewer.size.height}; \r\n\r\n  return (\r\n    <React.Fragment>\r\n      <div id=\"map\" ref={mainMapEl} style={{...map_style}} className={viewer?.className}>\r\n        { props.children }\r\n      </div>\r\n    </React.Fragment>\r\n  )\r\n}\r\n\r\nexport default connect(state => ({\r\n  auth: state.root.auth,\r\n  config: state.root.config,\r\n  viewer: state.root.viewer\r\n}))(MainMap);\r\n","import { v4 as uuidv4 } from 'uuid';\r\nimport * as OlProj from 'ol/proj';\r\nimport OlFormatKML from \"ol/format/KML\";\r\nimport OlFormatGML2 from \"ol/format/GML2\";\r\nimport OlFormatGeoJSON from \"ol/format/GeoJSON\";\r\nimport * as OlExtent from 'ol/extent';\r\nimport { generateRGBA, removeUrlParam } from '../utils';\r\nimport FileSaver from 'file-saver';\r\nimport proj4 from 'proj4';\r\n\r\n\r\nconst getCRSCode = (val) => {\r\n\r\n  let retVal = /:(\\d+)$/g.exec(val) ? parseInt(/:(\\d+)$/g.exec(val)[1], 10) : null;\r\n\r\n  if (!retVal) {\r\n    if (val.indexOf('www.opengis.net/def/crs/EPSG') !== -1) {\r\n      retVal = val.substr(val.lastIndexOf('/') + 1);\r\n    }\r\n  }\r\n\r\n  return retVal;\r\n}\r\n\r\n// Get loaded coordinate systems from server\r\nexport const projOptions = (coordsyss) => {\r\n  const options = coordsyss.map(i => ({\r\n    key: ''+i.srid,\r\n    text: i.label,\r\n    value: ''+i.srid,\r\n    extent: i.extent.split(' '),\r\n    defs: i.defs,\r\n    label: i.label,\r\n    label_long: i.label_long,\r\n    labelx: i.labelx,\r\n    labely: i.labely,\r\n    precision: i.precision\r\n  }));\r\n  return options;\r\n}\r\n\r\n/**\r\n * Create group\r\n */\r\nexport const createGroup = (title, crs, bbox) => {\r\n  const group = {\r\n    type: 'GROUP',\r\n    id: uuidv4(),\r\n    title,\r\n    description: '',\r\n    active: true,\r\n    open: true,\r\n    opacity: 1,\r\n    crs,\r\n    bbox: bbox.join(' '),\r\n    children: []\r\n  };\r\n  return [group];\r\n}\r\n\r\n/**\r\n * Parse BBOX string coordinates\r\n *\r\n * @param {Array} bbox\r\n * @param {String} fromCRS\r\n * @param {String} toCRS\r\n * @param {Boolean} inverted\r\n */\r\nconst parseBBOX = (bbox, fromCRS, toCRS, inverted) => {\r\n  let result = [\r\n    parseFloat(bbox[0]),\r\n    parseFloat(bbox[1]),\r\n    parseFloat(bbox[2]),\r\n    parseFloat(bbox[3])\r\n  ];\r\n  if (fromCRS !== toCRS) result = OlProj.transformExtent(bbox, fromCRS, toCRS);\r\n  if (inverted) {\r\n    result = [result[1], result[0], result[3], result[2]];\r\n  }\r\n  return result;\r\n}\r\n\r\nconst parseInspireMetadata = (metadata) => {\r\n  const result = {};\r\n  if (metadata.MetadataUrl) {\r\n    result['url'] = metadata.MetadataUrl.URL;\r\n    result['media_type'] = metadata.MetadataUrl.MediaType;\r\n  }\r\n\r\n  result['language'] = metadata.ResponseLanguage.Language;\r\n  result['supported_languages'] = {\r\n      default: metadata.SupportedLanguages.DefaultLanguage.Language,\r\n      languages: metadata.SupportedLanguages.SupportedLanguage ? metadata.SupportedLanguages.SupportedLanguage.map((l, i) => {\r\n        return l.Language;\r\n      }) : []\r\n    }\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * Parse WFS to Theme\r\n *\r\n * @param {Object} wfs\r\n * @param {String} originUrl\r\n * @param {Object} extent\r\n * @param {Object} options\r\n */\r\nexport const convertWFS2Themes = (wfs, originUrl, options) => {\r\n  let result = [];\r\n  let types = [];\r\n  let bbox;\r\n\r\n  // Set default extent from extent options\r\n  if (options.extent) bbox = parseBBOX(options.extent);\r\n\r\n  // Find wfs namespace\r\n  let wfsns = wfs['wfs:WFS_Capabilities'] ? 'wfs:' : '';\r\n\r\n  // Find ows namespace\r\n  let owsns = wfs[wfsns+'WFS_Capabilities']['ows:ServiceProvider'] ? 'ows:' : '';\r\n\r\n  // Find default namespace\r\n  let ns = wfs[wfsns+'WFS_Capabilities'][wfsns+'FeatureTypeList'] ? wfsns : '';\r\n\r\n  // Get feature types\r\n  types = wfs[wfsns+'WFS_Capabilities'][ns+'FeatureTypeList'][0][ns+'FeatureType'];\r\n\r\n\r\n\r\n  // Loop through feature types\r\n  types.map((l, i) => {\r\n\r\n    // Use default map CRS\r\n    let crs = [null, ''+options.srid];\r\n\r\n    // Find WFS version\r\n    let version = wfs[wfsns+'WFS_Capabilities']['$']['version'];\r\n\r\n    // Get URL\r\n    let url = originUrl ? originUrl.replace('request=GetCapabilities', '')+'&' : 'wfs_features.xml';\r\n    url = url.replace(/request=getcapabilities/i, '');\r\n\r\n    if (url.indexOf('?') < 0) {\r\n      url = url.replace(/&+$/gm,'');\r\n      url += '?';\r\n    }\r\n\r\n    // Parse feature for versions 1.0.0 and 1.1.0\r\n    if (['1.0.0', '1.1.0'].indexOf(version) > -1) {\r\n\r\n      // Update CRS\r\n      if (l.SRS) crs = getCRSCode(l.SRS[0]) ? parseInt(getCRSCode(l.SRS[0]), 10) : crs; //parseInt(/EPSG:(\\d+)/g.exec(l.SRS[0])[1], 10);\r\n      else if (l.DefaultSRS) {\r\n        crs = getCRSCode(l.DefaultSRS[0]) ? parseInt(getCRSCode(l.DefaultSRS[0]), 10): crs; //parseInt(/EPSG::(\\d+)/g.exec(l.DefaultSRS[0])[1], 10);\r\n      }\r\n\r\n      // Use CRS from DefaultCRS\r\n      if (l[wfsns+'DefaultCRS']) {\r\n        crs = getCRSCode(l[wfsns+'DefaultCRS'][0]) ? parseInt(getCRSCode(l[wfsns+'DefaultCRS'][0]), 10) : crs; //parseInt(/EPSG::(\\d+)/g.exec(l[wfsns+'DefaultCRS'][0])[1], 10);\r\n      }\r\n\r\n      // Find lat/lon bounding box\r\n      if (l.LatLongBoundingBox) {\r\n        bbox = [\r\n          l.LatLongBoundingBox[0]['$']['minx'],\r\n          l.LatLongBoundingBox[0]['$']['miny'],\r\n          l.LatLongBoundingBox[0]['$']['maxx'],\r\n          l.LatLongBoundingBox[0]['$']['maxx']\r\n        ];\r\n        bbox = parseBBOX(bbox);\r\n      }\r\n\r\n      // Use WGS84 boundging box if exists\r\n      if (l[owsns+'WGS84BoundingBox']) {\r\n        bbox = [\r\n          l[owsns+'WGS84BoundingBox'][0][owsns+'LowerCorner'][0].split(' ')[0],\r\n          l[owsns+'WGS84BoundingBox'][0][owsns+'LowerCorner'][0].split(' ')[1],\r\n          l[owsns+'WGS84BoundingBox'][0][owsns+'UpperCorner'][0].split(' ')[0],\r\n          l[owsns+'WGS84BoundingBox'][0][owsns+'UpperCorner'][0].split(' ')[1]\r\n        ];\r\n        bbox = parseBBOX(bbox);\r\n      }\r\n\r\n      // Transform BBOX if CRS different that 3857\r\n      /*\r\n      if (crs !== 3857) {\r\n        bbox = parseBBOX(bbox, 'EPSG:' + crs, 'EPSG:3857');\r\n      }\r\n      */\r\n    }\r\n\r\n    // Parse feature for versions 2.0.0\r\n    if (version === '2.0.0') {\r\n\r\n      // Get CRS from DefaultCRS\r\n      if (l[wfsns+'DefaultCRS']) {\r\n        //crs = /:(\\d+)$/g.exec(l[wfsns+'DefaultCRS'][0]) ? parseInt(/:(\\d+)$/g.exec(l[wfsns+'DefaultCRS'][0])[1], 10) : crs;\r\n        crs = getCRSCode(l[wfsns+'DefaultCRS'][0]) ? parseInt(getCRSCode(l[wfsns+'DefaultCRS'][0]), 10) : crs;\r\n      } else if (l['DefaultCRS']) {\r\n        //crs = /:(\\d+)$/g.exec(l['DefaultCRS'][0]) ? parseInt(/:(\\d+)$/g.exec(l['DefaultCRS'][0])[1], 10) : crs;\r\n        crs =  getCRSCode(l['DefaultCRS'][0]) ? parseInt(getCRSCode(l['DefaultCRS'][0]), 10) : crs;\r\n      }\r\n\r\n      // Get bounding box from WGS84 bounding box\r\n      if (l[owsns+'WGS84BoundingBox']) {\r\n        crs = 4326;\r\n        bbox = [\r\n          l[owsns+'WGS84BoundingBox'][0][owsns+'LowerCorner'][0].split(' ')[0],\r\n          l[owsns+'WGS84BoundingBox'][0][owsns+'LowerCorner'][0].split(' ')[1],\r\n          l[owsns+'WGS84BoundingBox'][0][owsns+'UpperCorner'][0].split(' ')[0],\r\n          l[owsns+'WGS84BoundingBox'][0][owsns+'UpperCorner'][0].split(' ')[1]\r\n        ];\r\n        bbox = parseBBOX(bbox);\r\n      }\r\n\r\n      // Transform BBOX if CRS different that 4326\r\n      if (crs !== 4326) {\r\n        bbox = parseBBOX(bbox, 'EPSG:'+crs, 'EPSG:4326');\r\n        crs = 4326;\r\n      }\r\n    }\r\n\r\n    // Create theme object\r\n    const theme = {\r\n      id: uuidv4(),\r\n      title: l[ns+'Title'][0].trim(),\r\n      description: l[ns+'Keywords'] ? l[ns+'Keywords'][0].trim() : '',\r\n      active: false,\r\n      open: false,\r\n      opacity: 1,\r\n      type: \"WFS\",\r\n      url: url,\r\n      layers: l[ns+'Name'][0],\r\n      servertype: 'mapserver',\r\n      crs,\r\n      tiled: true,\r\n      version: version,\r\n      bbox: bbox.join(' '),\r\n      style_color: generateRGBA(),\r\n      style_stroke_color: generateRGBA(),\r\n      style_stroke_width: 1\r\n    };\r\n\r\n    if (l['$']) {\r\n      const featurerns = Object.entries(l['$']).find(([key]) => key.includes('xmlns:' + ns));\r\n      const featureprefix = l[ns+'Name'][0].split(':').length > 1 ? l[ns+'Name'][0].split(':')[0] : '';\r\n      const faturetype = l[ns+'Name'][0].split(':').length > 1 ? l[ns+'Name'][0].split(':')[1] : l[ns+'Name'][0];\r\n      if (featurerns) {\r\n        theme['datatable'] = {\r\n          \"source_type\": \"wfs\",\r\n          \"source_url\": url,\r\n          \"feature_namespace\": featurerns[1],\r\n          \"feature_prefix\": featureprefix,\r\n          \"feature_type\": faturetype,\r\n          \"all_geometries\": true\r\n        }\r\n      }\r\n    }\r\n\r\n    result.push(theme)\r\n    return l;\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * Parse WMS to Theme\r\n */\r\nexport const convertWMS2Themes = (wms, originUrl, options) => {\r\n  let result = [];\r\n\r\n  // Get formats for GetMap request\r\n  let get_map_formats = wms.Capability.Request.GetMap.Format.join(',');\r\n  // Set prefered getMap format\r\n  let get_map_format_preference = [\r\n    'image/png',\r\n    'image/png8',\r\n    'image/png24',\r\n    'image/png32',\r\n    'image/gif',\r\n    'image/jpeg',    \r\n    'image/bmp',\r\n    'image/tiff',\r\n    'image/svg+xml'\r\n  ];\r\n  let get_map_format = '';\r\n  if (get_map_formats) {\r\n    let tmformats = get_map_formats.split(',');\r\n    get_map_format_preference.forEach(gmf => {\r\n      if (get_map_format) return;\r\n      if (tmformats.includes(gmf)) get_map_format = gmf;\r\n    });\r\n  }  \r\n\r\n  // Get formats for GetFeatureInfo request\r\n  let get_feature_info_formats = wms.Capability.Request.GetFeatureInfo.Format.join(',');\r\n  // Set prefered getFeatureInfo format\r\n  let get_feature_info_format_preference = [\r\n    'application/json',\r\n    'application/geojson',\r\n    'application/vnd.ogc.gml',\r\n    'application/vnd.ogc.gml/3.1.1',\r\n    'text/xml; subtype=gml/3.1.1',\r\n    'text/xml',\r\n    'text/html',\r\n    'text/plain'\r\n  ];\r\n  let get_feature_info_format = '';\r\n  if (get_feature_info_formats) {\r\n    let tformats = get_feature_info_formats.split(',');\r\n    get_feature_info_format_preference.forEach(gfif => {\r\n      if (get_feature_info_format) return;\r\n      if (tformats.includes(gfif)) get_feature_info_format = gfif;\r\n    });\r\n  }\r\n\r\n  // Set default CRS\r\n  let crs = 4326, bbox, inspire_service_metadata;\r\n\r\n  // Get bbox from extent options\r\n  if (options.extent) bbox = parseBBOX(options.extent)\r\n\r\n  // Parse INSPIRE Metadata\r\n  if (wms.Capability.Inspire) {\r\n    inspire_service_metadata = parseInspireMetadata(wms.Capability.Inspire);\r\n  }\r\n\r\n  // Warn user about different version\r\n  if (options.version\r\n    && (options.version !== \"default\")\r\n    && (wms.version !== options.version)\r\n  ) {\r\n    throw new Error('O serviço respondeu com a versão ' + wms.version);\r\n  }\r\n\r\n  let createThemeFromLayer = (wms, layer, themes) => {\r\n\r\n      // Get CRS options\r\n      let crs_options = [];\r\n\r\n      if (layer.CRS && layer.CRS.length) {\r\n        crs_options = layer.CRS.filter((v, i, array) => array.indexOf(v) === i);\r\n      } else {\r\n        crs_options = wms.Capability.Layer.CRS.filter((v, i, array) => array.indexOf(v) === i);\r\n      }\r\n\r\n      // Get legend URL\r\n      let wms_styles = [];\r\n      let legend_url = '';\r\n      if (layer.Style) {\r\n        if (typeof layer.Style === 'object' && layer.Style.length) {\r\n          layer.Style.map(style => {\r\n            wms_styles.push(style.Name);\r\n            if (!legend_url && typeof style.LegendURL === 'object' && style.LegendURL.length) {\r\n              legend_url = style.LegendURL[0].OnlineResource;\r\n            }\r\n            return style;\r\n          });\r\n        }\r\n      }\r\n\r\n      // Parse URL\r\n      let finalUrl = originUrl;\r\n\r\n      // Get GetMap URL from GetCapabilities\r\n      if (options.ignore_url) {\r\n        finalUrl = removeUrlParam(finalUrl, 'request');\r\n      } else {\r\n        if (wms.Capability.Request.GetMap.DCPType) {\r\n          wms.Capability.Request.GetMap.DCPType.map(v => {\r\n            if (v.HTTP.Get.OnlineResource) {\r\n              finalUrl = v.HTTP.Get.OnlineResource;\r\n            }\r\n            return v;\r\n          })\r\n        } else {\r\n          if (wms.Service.OnlineResource) finalUrl = wms.Service.OnlineResource;\r\n        }\r\n      }\r\n\r\n      // Some services publish wrong URL from GetCapabilities\r\n      if (finalUrl.indexOf('localhost') > -1) finalUrl = originUrl; // Wrong on some services\r\n\r\n\r\n      // Parse WGS84 bounding box\r\n      if (layer.EX_GeographicBoundingBox && layer.EX_GeographicBoundingBox.length) {\r\n        crs = 4326;\r\n        bbox = parseBBOX(layer.EX_GeographicBoundingBox, 'EPSG:4326', 'EPSG:4326', false)\r\n      } else {\r\n        let findBBOX = []\r\n        if (layer.BoundingBox && layer.BoundingBox.length) {\r\n          findBBOX = layer.BoundingBox.filter(i => i.crs === 'EPSG:4326');\r\n        } else {\r\n          findBBOX = wms.Capability.Layer.BoundingBox.filter(i => i.crs === 'EPSG:4326');\r\n        }\r\n        if (findBBOX.length) {\r\n          crs = 4326;\r\n          bbox = findBBOX[0].extent;\r\n          bbox = parseBBOX(findBBOX[0].extent, 'EPSG:4326', 'EPSG:4326', false)\r\n        }\r\n      }\r\n\r\n      // Parse min/max scale\r\n      let source_min_scale = null;\r\n      let source_max_scale = null;\r\n      if (layer.MinScaleDenominator) source_min_scale = layer.MinScaleDenominator;\r\n      if (layer.MaxScaleDenominator) source_max_scale = layer.MaxScaleDenominator;\r\n\r\n      // Get Layer INSPIRE Metadata\r\n      let inspire_layer_metadata;\r\n      if (layer.Inspire) {\r\n        inspire_layer_metadata = parseInspireMetadata(layer.Inspire);\r\n      }\r\n\r\n      // Build theme object\r\n      const theme = {\r\n        id: uuidv4(),\r\n        title: layer.Title,\r\n        description: layer.Abstract,\r\n        active: false,\r\n        open: false,\r\n        opacity: 1,\r\n        type: 'WMS',\r\n        url: finalUrl,\r\n        layers: layer.Name,\r\n        children: [],\r\n        servertype: 'mapserver',\r\n        crs: crs,\r\n        tiled: typeof options.tiled === 'undefined' ? true : options.tiled,\r\n        version: wms.version,\r\n        crs_options: crs_options.join(','),\r\n        get_map_formats,\r\n        get_map_format: get_map_format || 'image/png',\r\n        get_feature_info_formats,\r\n        get_feature_info_format: get_feature_info_format || 'text/plain',\r\n        wms_styles: wms_styles.join(','),\r\n        wms_style: (wms_styles && wms_styles.length) > 0 ? wms_styles[0] : '',\r\n        legend_url: legend_url,\r\n        bbox: bbox.join(' '),\r\n        source_min_scale,\r\n        source_max_scale,\r\n        inspire_metadata: inspire_layer_metadata || inspire_service_metadata,\r\n        authkey: options.authkey\r\n      }\r\n\r\n      // Add theme to parse results\r\n      themes.push(theme);\r\n\r\n      // Add sublayers\r\n      if (layer.Layer && layer.Layer.length) {\r\n        layer.Layer.map((l, i) => {\r\n          //createThemeFromLayer(wms, l, themes);\r\n          createThemeFromLayer(wms, l, theme.children);\r\n          return l;\r\n        });\r\n      }\r\n\r\n      return theme;\r\n  }\r\n\r\n  //wms.Capability.Layer.Layer.map((l, i) => {\r\n  [wms.Capability.Layer].map((l, i) => {\r\n    createThemeFromLayer(wms, l, result);\r\n    return l;\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * Parse WMTS to Theme\r\n */\r\nexport const convertWMTS2Themes = (wmts, originUrl, options) => {\r\n  let result = [];\r\n  \r\n  // Set default CRS\r\n  let crs = 4326, bbox, inspire_service_metadata;\r\n\r\n  // Set prefered getTile format\r\n  let get_tile_format_preference = [\r\n    'image/png',\r\n    'image/png8',\r\n    'image/png24',\r\n    'image/png32',\r\n    'image/gif',\r\n    'image/jpeg',    \r\n    'image/bmp',\r\n    'image/tiff',\r\n    'image/svg-+xml'\r\n  ];\r\n\r\n  // Set prefered getFeatureInfo format\r\n  let get_feature_info_format_preference = [\r\n    'application/json',\r\n    'application/geojson',\r\n    'application/vnd.ogc.gml',\r\n    'application/vnd.ogc.gml/3.1.1',\r\n    'text/xml; subtype=gml/3.1.1',\r\n    'text/xml',\r\n    'text/html',\r\n    'text/plain'\r\n  ];\r\n\r\n  // Parse URL\r\n  let finalUrl = originUrl;\r\n\r\n  // Get GetMap URL from GetCapabilities\r\n  if (options.ignore_url) {\r\n    finalUrl = removeUrlParam(finalUrl, 'request');\r\n  } else {\r\n    if (wmts.OperationsMetadata.GetTile.DCP) {\r\n      wmts.OperationsMetadata.GetTile.DCP.HTTP.Get.map(v => {\r\n        if (v.href) {\r\n          finalUrl = v.href;\r\n        }\r\n        return v;\r\n      })\r\n    }\r\n  }\r\n  // Some services publish wrong URL from GetCapabilities\r\n  if (finalUrl.indexOf('localhost') > -1) finalUrl = originUrl; // Wrong on some services\r\n\r\n\r\n  //// Get formats for GetFeatureInfo request\r\n  //let get_feature_info_formats = wmts.Capability.Request.GetFeatureInfo.Format.join(',');  \r\n\r\n  //// Get bbox from extent options\r\n  //if (options.extent) bbox = parseBBOX(options.extent)\r\n\r\n  // Parse INSPIRE Metadata\r\n  //if (wmts.Capability.Inspire) {\r\n  //  inspire_service_metadata = parseInspireMetadata(wmts.Capability.Inspire);\r\n  //}\r\n\r\n  // Warn user about different version\r\n  if (options.version\r\n    && (options.version !== \"default\")\r\n    && (wmts.version !== options.version)\r\n  ) {\r\n    throw new Error('O serviço respondeu com a versão ' + wmts.version);\r\n  }\r\n\r\n  wmts.Contents.Layer.map((l, i) => {\r\n    //Get tilematrixsets\r\n    let wmts_tilematrixsets = [];\r\n    if (l.TileMatrixSetLink && l.TileMatrixSetLink.length > 0) {\r\n      wmts_tilematrixsets = l.TileMatrixSetLink.map(m => m.TileMatrixSet);\r\n    }\r\n\r\n    // Get formats for GetMap request\r\n    let wmts_format = '';\r\n    let wmts_formats = [];\r\n    if (l.Format && l.Format.length > 0) {\r\n      wmts_formats = [...(l.Format)];\r\n    }\r\n    if (wmts_formats.length > 0) {\r\n      get_tile_format_preference.forEach(gtf => {\r\n        if (wmts_format) return;\r\n        if (wmts_formats.includes(gtf)) wmts_format = gtf;\r\n      });\r\n    }    \r\n\r\n    // Get legend URL\r\n    let wmts_styles = [];\r\n    let legend_url = '';\r\n    if (l.Style) {\r\n      if (typeof l.Style === 'object' && l.Style.length) {\r\n        l.Style.map(style => {\r\n          wmts_styles.push(style.Identifier);\r\n          if (!legend_url && typeof style.LegendURL === 'object' && style.LegendURL.length) {\r\n            legend_url = style.LegendURL[0].href;\r\n          }\r\n          return style;\r\n        });\r\n      }\r\n    }\r\n\r\n    //Get FeatureInfo Url\r\n    let get_feature_info_url = finalUrl;\r\n\r\n    //Get FeatureInfo formats    \r\n    let get_feature_info_format = '';\r\n    let get_feature_info_formats = [];\r\n    if (l.ResourceURL && l.ResourceURL.length > 0) {\r\n      get_feature_info_formats = l.ResourceURL.filter((f => f.resourceType === 'FeatureInfo' ))\r\n        .map(e => e.format);\r\n    }\r\n    if (get_feature_info_formats.length > 0) {\r\n      get_feature_info_format_preference.forEach(gfif => {\r\n        if (get_feature_info_format) return;\r\n        if (get_feature_info_formats.includes(gfif)) get_feature_info_format = gfif;\r\n      });\r\n    }    \r\n\r\n    // Create theme object\r\n      // Build theme object\r\n      const theme = {\r\n        id: uuidv4(),\r\n        title: l.Title,\r\n        description: l.Abstract,\r\n        active: false,\r\n        open: false,\r\n        opacity: 1,\r\n        type: 'WMTS',\r\n        url: finalUrl,\r\n        layer: l.Identifier,\r\n        version: wmts.version,\r\n        crs: crs,\r\n        bbox: l.WGS84BoundingBox && l.WGS84BoundingBox.length > 0 ? l.WGS84BoundingBox.join(' ') : null,\r\n        servertype: 'mapserver',\r\n        wmts_capabilities: wmts,\r\n        wmts_tilematrixsets: wmts_tilematrixsets.join(','),\r\n        wmts_tilematrixset: l.tilematrixset || 'EPSG:900913',\r\n        wmts_format: wmts_format || 'image/png',        \r\n        wmts_formats: wmts_formats.join(','),                \r\n        wmts_styles: wmts_styles.join(','),\r\n        wmts_style: '',\r\n        get_feature_info_url: get_feature_info_formats.length > 0 ? get_feature_info_url : null,\r\n        get_feature_info_format: get_feature_info_format || 'text/plain',\r\n        get_feature_info_formats: get_feature_info_formats.join(','),\r\n        legend_url: legend_url      \r\n      }\r\n\r\n    result.push(theme)\r\n    return l;    \r\n  });\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * Convert KML to themes\r\n *\r\n * @param {String} kml\r\n * @param {String} url\r\n * @param {String} raw\r\n * @param {Int} crs\r\n */\r\nexport const convertKML2Themes = (kml, url, raw, crs) => {\r\n  const items = [];\r\n  const parser = new OlFormatKML({extractStyles: false});\r\n  const parseOptions = {\r\n    dataProjection: 'EPSG:' + crs,\r\n    featureProjection: 'EPSG:' + crs\r\n  };\r\n  const features = parser.readFeatures(raw, parseOptions);\r\n  let extent = OlExtent.createEmpty();\r\n  features.map(f => {\r\n    if (f.getGeometry()) OlExtent.extend(extent, f.getGeometry().getExtent());\r\n    return f;\r\n  });\r\n  const bbox = [parseFloat(extent[0]), parseFloat(extent[1]), parseFloat(extent[2]), parseFloat(extent[3])];\r\n  /*\r\n  const min = OlProj.transform([parseFloat(extent[0]), parseFloat(extent[1])], 'EPSG:4326', 'EPSG:3857');\r\n  const max = OlProj.transform([parseFloat(extent[2]), parseFloat(extent[3])], 'EPSG:4326', 'EPSG:3857');\r\n  const bbox = [min[0], min[1], max[0], max[1]];\r\n  */\r\n  if (kml && kml.kml && kml.kml.Document) {\r\n    const doc = kml.kml.Document[0];\r\n    let name = 'Documento';\r\n    if (doc.name) name = doc.name[0].trim();\r\n    if (doc.Folder) {\r\n      doc.Folder.map((l, i) => {\r\n        items.push({\r\n          id: uuidv4(),\r\n          title: name + ' | ' + l.name[0].trim(),\r\n          description: l.description ? l.description[0].trim() : '',\r\n          active: false,\r\n          open: false,\r\n          opacity: 1,\r\n          type: \"KML\",\r\n          url: url,\r\n          crs: parseInt(crs, 10),\r\n          crs_options: 'EPSG:' + crs,\r\n          bbox: bbox.join(' '),\r\n          style_color: generateRGBA(),\r\n          style_stroke_color: generateRGBA(),\r\n          style_stroke_width: 1\r\n        })\r\n        return l;\r\n      })\r\n    } else if (doc.name) {\r\n      const name = doc.name[0].trim();\r\n      items.push({\r\n        id: uuidv4(),\r\n        title: name,\r\n        description: doc.description ? doc.description[0].trim() : '',\r\n        active: false,\r\n        open: false,\r\n        opacity: 1,\r\n        type: \"KML\",\r\n        url: url,\r\n        crs: parseInt(crs, 10),\r\n        crs_options: 'EPSG:' + crs,\r\n        bbox: bbox.join(' '),\r\n        style_color: generateRGBA(),\r\n        style_stroke_color: generateRGBA(),\r\n        style_stroke_width: 1\r\n      })\r\n    } else {\r\n      items.push({\r\n        id: uuidv4(),\r\n        title: name,\r\n        description: '',\r\n        active: false,\r\n        open: false,\r\n        opacity: 1,\r\n        type: \"KML\",\r\n        url: url,\r\n        crs: parseInt(crs, 10),\r\n        crs_options: 'EPSG:' + crs,\r\n        bbox: bbox.join(' '),\r\n        style_color: generateRGBA(),\r\n        style_stroke_color: generateRGBA(),\r\n        style_stroke_width: 1\r\n      })      \r\n    }\r\n  }\r\n  return items;\r\n}\r\n\r\n/**\r\n * Convert GeoJSON file to theme\r\n */\r\nexport const convertGeoJSON2Themes = (geojson, url, name, crs) => {\r\n  const items = [];\r\n  const parser = new OlFormatGeoJSON();\r\n  const parseOptions = {\r\n    dataProjection: 'EPSG:' + crs,\r\n    featureProjection: 'EPSG:' + crs\r\n  };\r\n\r\n  const features = parser.readFeatures(geojson, parseOptions);\r\n  let extent = OlExtent.createEmpty();\r\n  features.map(f => {\r\n    if (f.getGeometry()) OlExtent.extend(extent, f.getGeometry().getExtent());\r\n    return f;\r\n  });\r\n  const bbox = [parseFloat(extent[0]), parseFloat(extent[1]), parseFloat(extent[2]), parseFloat(extent[3])];\r\n  /*\r\n  const min = OlProj.transform([parseFloat(extent[0]), parseFloat(extent[1])], 'EPSG:4326', 'EPSG:3857');\r\n  const max = OlProj.transform([parseFloat(extent[2]), parseFloat(extent[3])], 'EPSG:4326', 'EPSG:3857');\r\n  const bbox = [min[0], min[1], max[0], max[1]];\r\n  */\r\n  items.push({\r\n    id: uuidv4(),\r\n    title: name,\r\n    description: '',\r\n    active: false,\r\n    open: false,\r\n    opacity: 1,\r\n    type: \"GeoJSON\",\r\n    url: url,\r\n    crs: parseInt(crs, 10),\r\n    crs_options: 'EPSG:' + crs,\r\n    bbox: bbox.join(' '),\r\n    style_color: generateRGBA(),\r\n    style_stroke_color: generateRGBA(),\r\n    style_stroke_width: 1\r\n  });\r\n\r\n  return items;\r\n}\r\n\r\nexport const convertGML2Themes = (gml, url, name, crs) => {\r\n  const items = [];\r\n  const parser = new OlFormatGML2();\r\n  const parseOptions = {\r\n    dataProjection: 'EPSG:' + crs,\r\n    featureProjection: 'EPSG:' + crs\r\n  };\r\n  const features = parser.readFeatures(gml, parseOptions);\r\n  let extent = OlExtent.createEmpty();\r\n  features.map(f => {\r\n    if (f.getGeometry()) OlExtent.extend(extent, f.getGeometry().getExtent());\r\n    return f;\r\n  });\r\n  const bbox = [parseFloat(extent[0]), parseFloat(extent[1]), parseFloat(extent[2]), parseFloat(extent[3])];\r\n  /*\r\n  const min = OlProj.transform([parseFloat(extent[0]), parseFloat(extent[1])], 'EPSG:3763', 'EPSG:3857');\r\n  const max = OlProj.transform([parseFloat(extent[2]), parseFloat(extent[3])], 'EPSG:3763', 'EPSG:3857');\r\n  const bbox = [min[0], min[1], max[0], max[1]];\r\n  */\r\n  items.push({\r\n    id: uuidv4(),\r\n    title: name,\r\n    description: '',\r\n    active: false,\r\n    open: false,\r\n    opacity: 1,\r\n    type: \"GML\",\r\n    url: url,\r\n    crs: parseInt(crs, 10),\r\n    crs_options: 'EPSG:' + crs,\r\n    bbox: bbox.join(' '),\r\n    style_color: generateRGBA(),\r\n    style_stroke_color: generateRGBA(),\r\n    style_stroke_width: 1\r\n  });\r\n  return items;\r\n}\r\n\r\n/**\r\n * Download theme\r\n *\r\n * @param {Object} theme\r\n * @param {String} format\r\n */\r\nexport const downloadTheme = (theme, format) => {\r\n  const endpoint = process.env.REACT_APP_SERVER_URL || process.env.REACT_APP_PUBLIC_URL;\r\n\r\n  if (['KML', 'GML', 'GeoJSON'].indexOf(theme.type) > -1) {\r\n\r\n    // Convert file\r\n    const filename = theme.url.substring(theme.url.lastIndexOf('/')+1);\r\n    const url = endpoint + '/convert/' + filename + '/' + format\r\n    fetch(url, { responseType: 'blob' })\r\n      .then(res => res.blob())\r\n      .then(res => {\r\n\r\n        // Download result\r\n        FileSaver.saveAs(res, format)\r\n      }).catch((error) => {\r\n        console.error(error);\r\n      });\r\n  }\r\n\r\n  if (['WFS'].indexOf(theme.type) > -1) {\r\n\r\n    // Get WFS data\r\n    const formatOutput = (['1.0.0', '1.1.0'].indexOf(theme.version) > -1 ? 'GML2' : 'GML3');\r\n    let url = theme.url\r\n    url = url.replace(/&$/ig, '')\r\n    url = url + (url.indexOf('?') > -1 ? '' : '?')\r\n      + '&service=WFS&'\r\n      + 'version=' + theme.version\r\n      + '&request=GetFeature'\r\n      + '&typename=' + encodeURIComponent(theme.layers)\r\n      + '&outputFormat=' + formatOutput\r\n      + '&srsname=EPSG:' + theme.crs;\r\n    fetch(url, { responseType: 'blob'})\r\n    .then(res => res.blob())\r\n    .then(res => {\r\n\r\n      // Upload data\r\n      const upload = new FormData();\r\n      upload.append('upload', res);\r\n      upload.append('ext', 'xml');\r\n      fetch(endpoint + '/resource', { method: 'POST', body: upload })\r\n      .then(res => res.json())\r\n      .then(res => {\r\n        if (!res.success) {\r\n          console.log(res.error);\r\n          return;\r\n        }\r\n\r\n        // Convert to format\r\n        const url = endpoint + '/convert/' + res.filename + '/' + format\r\n        fetch(url, { responseType: 'blob' })\r\n          .then(res => res.blob())\r\n          .then(res => {\r\n\r\n            // Download result\r\n            FileSaver.saveAs(res, format)\r\n          }).catch((error) => {\r\n            console.error(error);\r\n          });\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * Parse WMS to Theme\r\n */\r\n export const convertArcGISMap2Themes = (capabilities, originUrl, options) => {\r\n  let result = [];\r\n\r\n  const service = capabilities.service;\r\n  const layers = capabilities.layers;\r\n\r\n  // Get formats for GetMap request\r\n  let get_map_formats = service.supportedImageFormatTypes;\r\n  // Set prefered getMap format\r\n  let get_map_format_preference = [\r\n    'PNG32',\r\n    'PNG24',\r\n    'PNG',\r\n    'JPG',\r\n    'DIB',\r\n    'TIFF',    \r\n    'EMF',\r\n    'PS',\r\n    'PDF',\r\n    'GIF',\r\n    'SVG',\r\n    'SVGZ',\r\n    'BMP'\r\n  ];\r\n  let get_map_format = '';\r\n  if (get_map_formats) {\r\n    let tmformats = get_map_formats.split(',');\r\n    get_map_format_preference.forEach(gmf => {\r\n      if (get_map_format) return;\r\n      if (tmformats.includes(gmf)) get_map_format = gmf;\r\n    });\r\n  }  \r\n\r\n  // Set default CRS\r\n  let crs = 4326, bbox;\r\n\r\n  try {\r\n    // Get bbox from extent options\r\n    const extent = service.fullExtent;\r\n    if (extent && extent.xmin && extent.ymin && extent.xmax && extent.ymax) {\r\n      console.log(OlProj.get(`EPSG:${extent.spatialReference.wkid}`));\r\n      if (extent.spatialReference.wkid && OlProj.get(`EPSG:${extent.spatialReference.wkid}`)) {        \r\n        bbox = parseBBOX([extent.xmin, extent.ymin, extent.xmax, extent.ymax], `EPSG:${extent.spatialReference.wkid}`, `EPSG:${crs}`);\r\n      } else if (extent.spatialReference.wkt) {\r\n        const min = proj4(extent.spatialReference.wkt,'EPSG:4326', [extent.xmin, extent.ymin]);\r\n        const max = proj4(extent.spatialReference.wkt,'EPSG:4326', [extent.xmax, extent.ymax]);\r\n        bbox = [...min, ...max];\r\n      }\r\n    }\r\n  } catch(e) {\r\n    console.log(e);\r\n  }\r\n\r\n\r\n  let createThemeFromLayer = (capabilities, layer, themes) => {\r\n\r\n      // Get CRS options\r\n      const crs_options = ['EPSG:4326', 'EPSG:3857'];\r\n      if (service?.spatialReference?.wkid) {\r\n        crs_options.push(`EPSG:${service.spatialReference.wkid}`);\r\n      }\r\n      if (layer.sourceSpatialReference && !crs_options.includes(`EPSG:${layer.sourceSpatialReference.wkid}`)) {\r\n        crs_options.push(`EPSG:${layer.sourceSpatialReference.wkid}`);\r\n      }\r\n\r\n      // Parse URL\r\n      let finalUrl = originUrl;\r\n\r\n      let layer_crs = crs;\r\n      let layer_bbox = bbox;      \r\n\r\n      try {\r\n        const extent = layer.extent;\r\n        if (extent && extent.xmin && extent.ymin && extent.xmax && extent.ymax) {\r\n          if (extent.spatialReference.wkid && OlProj.get(`EPSG:${extent.spatialReference.wkid}`)) {\r\n            layer_bbox = parseBBOX([extent.xmin, extent.ymin, extent.xmax, extent.ymax], `EPSG:${extent.spatialReference.wkid}`, `EPSG:${crs}`);\r\n          } else if (extent.spatialReference.wkt) {\r\n            const min = proj4(extent.spatialReference.wkt,'EPSG:4326', [extent.xmin, extent.ymin]);\r\n            const max = proj4(extent.spatialReference.wkt,'EPSG:4326', [extent.xmax, extent.ymax]);\r\n            layer_bbox = [...min, ...max];\r\n          }\r\n        }\r\n      } catch (e) {\r\n        console.log(e);\r\n      }      \r\n\r\n      // Parse min/max scale\r\n      const source_min_scale = layer.maxScale != null ? layer.maxScale : null;\r\n      const source_max_scale = layer.minScale != null ? layer.minScale : null;\r\n\r\n      // Build theme object\r\n      const theme = {\r\n        id: uuidv4(),\r\n        title: layer.name,\r\n        description: layer.description,\r\n        active: false,\r\n        open: false,\r\n        opacity: 1,\r\n        type: 'ArcGISMap',\r\n        url: finalUrl,\r\n        layers: !layer.subLayers || !layer.subLayers.length ? `show:${layer.id}` : null,\r\n        layerId: [layer.id],\r\n        children: [],\r\n        servertype: 'arcgismap',\r\n        crs: layer_crs,\r\n        tiled: typeof options.tiled === 'undefined' ? true : options.tiled,\r\n        get_feature_info_layers: `visible:${layer.id}`,\r\n        crs_options: crs_options.length ? crs_options.join(',') : null,\r\n        bbox: (layer_bbox && layer_bbox.length) ? layer_bbox.join(' ') : null,\r\n        source_min_scale,\r\n        source_max_scale,\r\n        //authkey: options.authkey\r\n      }\r\n\r\n      // Add theme to parse results\r\n      themes.push(theme);\r\n\r\n      // Add sublayers\r\n      if (layer.subLayers && layer.subLayers.length) {\r\n        layer.subLayers.map((l, i) => {\r\n          const child_layer = capabilities.layers.filter(cl => cl.id === l.id)[0];\r\n          createThemeFromLayer(capabilities, child_layer, theme.children);\r\n          return l;\r\n        });\r\n      }\r\n\r\n      return theme;\r\n  }\r\n\r\n  layers.filter(l=>!l.parentLayer).map((l, i) => {\r\n    createThemeFromLayer(capabilities, l, result);\r\n    return l;\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\n\r\nexport default {\r\n  projOptions,\r\n  convertWFS2Themes,\r\n  convertWMS2Themes,\r\n  convertWMTS2Themes,\r\n  convertArcGISMap2Themes,  \r\n  convertKML2Themes,\r\n  convertGeoJSON2Themes,\r\n  convertGML2Themes,\r\n  createGroup\r\n}\r\n","import React from 'react'\r\nimport MapModel from '../model/MapModel';\r\nimport OWSModel from '../model/OWSModel';\r\nimport * as Utils from '../utils';\r\n\r\nexport default function MainMenu(props) {\r\n\r\n  const { components, history, core, viewer, dispatch, mainMap, auth, onMenuClick } = props;\r\n  const { selected_menu } = viewer.config_json;\r\n\r\n  function getStyle(c) {\r\n    return { display: c.id !== selected_menu ? 'none' : 'block', overflowY: 'auto', height: 'calc(100%)'  }\r\n  }\r\n\r\n  return (\r\n    <div className=\"layout-sidebar-panel\">\r\n      <div id=\"mainmenu\"\r\n        onClick={onMenuClick}\r\n        >\r\n        \r\n        { core.renderMainMenu({\r\n          selected_menu,\r\n          props: { components, history, viewer, dispatch, mainMap, Models: { MapModel, OWSModel, Utils }, auth }\r\n        })}\r\n\r\n      </div>\r\n\r\n      <div id=\"content\" className=\"p-d-flex p-flex-column p-jc-between\">\r\n        \r\n        { core.renderComponents({\r\n          id: selected_menu,\r\n          region: 'mainmenu',\r\n          props: { history, viewer, dispatch, mainMap, Models: { MapModel, OWSModel, Utils }, auth },\r\n          as: 'panel',\r\n          style: getStyle\r\n        })}\r\n\r\n        <div id=\"content-bottom\">\r\n          { core.renderComponents({\r\n            id: selected_menu,\r\n            region: 'mainmenu-bottom',\r\n            props: { history, viewer, dispatch, mainMap, Models: { MapModel, OWSModel, Utils }, auth },\r\n            as: ''\r\n          })}          \r\n        </div>\r\n\r\n        { core.renderComponents({\r\n          region: 'popup',\r\n          props: { history, viewer, dispatch, mainMap, Models: { MapModel, OWSModel, Utils }, auth },\r\n          as: 'popup'\r\n        })}\r\n\r\n      </div>\r\n    </div>\r\n  )\r\n}","import React, { useContext, useEffect, useState } from 'react'\r\nimport { connect, useDispatch } from 'react-redux'\r\nimport AppContext from '../../AppContext'\r\nimport MainMenuComponent from '../components/MainMenu'\r\nimport { mapStateToProps } from '../utils'\r\n\r\nfunction MainMenu(props) {\r\n\r\n  const { core, mainMap } = useContext(AppContext);\r\n  const dispatch = useDispatch();\r\n  let [ componentsOrdered, setComponentsOrdered ] = useState([]);\r\n  const { history, viewer, components, auth, onMenuClick } = props;\r\n\r\n  useEffect(() => {\r\n    let pitems = Object.keys(components)\r\n      .filter(k => components[k].target === 'mainmenu')\r\n      //.sort((a, b) => components[a].order > components[b].order ? 1 : -1 )\r\n      .map(id => components[id]);\r\n    \r\n    setComponentsOrdered(pitems);\r\n\r\n  }, [components]);\r\n  \r\n  return (\r\n    <MainMenuComponent\r\n      auth={auth}\r\n      history={history}\r\n      core={core}\r\n      mainMap={mainMap}\r\n      dispatch={dispatch}\r\n      components={componentsOrdered}\r\n      viewer={viewer}\r\n      onMenuClick={onMenuClick}\r\n    />\r\n  )\r\n}\r\n\r\nexport default connect(state => {\r\n  const gstate = mapStateToProps(state);\r\n  return ({\r\n    viewer: gstate.viewer,\r\n    components: gstate.components,\r\n    auth: gstate.auth\r\n  });\r\n})(MainMenu);","import React from \"react\";\r\n\r\nconst Layers = ({ children }) => {\r\n  return <div>{children}</div>;\r\n};\r\n\r\nexport default Layers;","import { useContext, useEffect, useRef } from \"react\";\r\nimport OLTileLayer from \"ol/layer/Tile\";\r\nimport AppContext from \"../../../AppContext\";\r\n\r\nconst TileLayer = ({ config, source, group, checked }) => {\r\n\r\n  const { mainMap } = useContext(AppContext);\r\n  const layer = useRef();\r\n  \r\n  useEffect(() => {\r\n    if (!mainMap) return;\r\n\r\n    if (config.attributions) {\r\n      source.setAttributions(config.attributions);\r\n    }\r\n\r\n    layer.current = new OLTileLayer({\r\n      ...config,\r\n      source\r\n    });\r\n    group.getLayers().push(layer.current);\r\n\r\n    return () => {\r\n      group.getLayers().remove(layer.current);\r\n    };\r\n\r\n  }, [mainMap]);\r\n\r\n  // Toggle layer visibility\r\n  useEffect(() => {\r\n    layer.current.setVisible(checked.includes(config.id))\r\n  }, [checked]);\r\n\r\n  // Changed config\r\n  useEffect(() => {\r\n    layer.current.setOpacity(config.opacity);\r\n  }, [config]);  \r\n\r\n  return null;\r\n};\r\n\r\nexport default TileLayer;","import { useContext, useEffect, useRef } from \"react\";\r\nimport OLTileLayer from \"ol/layer/Tile\";\r\nimport OLImageLayer from \"ol/layer/Image\";\r\nimport OlSourceTileWMS from 'ol/source/TileWMS';\r\nimport OlSourceImageWMS from 'ol/source/ImageWMS';\r\nimport AppContext from \"../../../AppContext\";\r\nimport { removeUrlParam } from \"../../utils\";\r\nimport { isUrlAppOrigin, isUrlAppHostname } from '../../utils';\r\nimport { getResolutionForScale } from '../../model/MapModel';\r\n\r\nconst WMSLayer = ({ config, group, checked, viewer }) => {\r\n\r\n  const { core, mainMap } = useContext(AppContext);\r\n  const layer = useRef();\r\n\r\n  const auth = core.store.getState().root.auth;\r\n\r\n  const MAP_PROXY = core.MAP_PROXY_URL;\r\n\r\n  function createLayer(config) {\r\n    let url = config.url;\r\n    url = removeUrlParam(url, 'service');\r\n    url = removeUrlParam(url, 'version');\r\n    url = removeUrlParam(url, 'request');\r\n\r\n    let proxy_requests = false;\r\n    if (viewer && viewer.config_json && viewer.config_json.proxy_http_image_requests) {\r\n      proxy_requests = true;\r\n    }\r\n    if(config && config.proxy_http_image_requests != null) {\r\n      proxy_requests = config.proxy_http_image_requests;\r\n    }\r\n\r\n    let sourceConfig = {\r\n      url: url,\r\n      hidpi: false,\r\n      //serverType: config.servertype,\r\n      //crossOrigin: 'anonymous',\r\n      //crossOrigin: null, // Quirks: some services does not work with this value\r\n      params: {\r\n        'LAYERS': config.layers,\r\n        'TILED': config.tiled,\r\n        'VERSION': config.version,\r\n        'FORMAT': config.get_map_format || config.format || 'image/png',\r\n        'STYLES': config.wms_style || config.styles\r\n      }\r\n    };\r\n\r\n    //Add user authentication token  \r\n    if (isUrlAppHostname(url) && viewer.integrated_authentication) {\r\n      if (auth && auth.data && auth.data.auth_token) {\r\n        const authkey = viewer?.integrated_authentication_key || 'authkey';\r\n        sourceConfig.params[authkey] = auth.data.auth_token;\r\n      }\r\n    }\r\n\r\n    if (proxy_requests) {\r\n      if (window.location.protocol === 'https:' && !isUrlAppOrigin(url) && navigator.userAgent.indexOf(\"Firefox\") == -1) {\r\n        const turl = new URL(url);\r\n        if (turl.protocol === 'http:') {\r\n          if (config.tiled) {\r\n            sourceConfig[\"tileLoadFunction\"] = function(imageTile, src) {\r\n              imageTile.getImage().src = MAP_PROXY + encodeURIComponent(src);\r\n            };\r\n          } else {\r\n            sourceConfig[\"imageLoadFunction\"] = function(image, src) {\r\n              image.getImage().src = MAP_PROXY + encodeURIComponent(src);\r\n            };            \r\n          }\r\n        } else {\r\n          proxy_requests = false;\r\n        }\r\n      } else {\r\n        proxy_requests = false;\r\n      }\r\n    }\r\n\r\n    // Check theme has map CRS\r\n    let crs = mainMap.getView().getProjection().getCode();\r\n    if (config.crs_options && config.crs_options.indexOf(crs) === -1) {\r\n      if (config.crs_options.indexOf('EPSG:4326') !== -1) {\r\n        sourceConfig['projection'] = 'EPSG:4326';\r\n      } else {\r\n        sourceConfig['projection'] = 'CRS:84';\r\n      }\r\n    }\r\n\r\n    if (config.attributions) {\r\n      sourceConfig['attributions'] = config.attributions;\r\n    }\r\n\r\n    // Create layer\r\n    let t;\r\n    if (config.tiled) {\r\n      t = new OLTileLayer({\r\n        id: config.id,\r\n        title: config.title,\r\n        type: config.type,\r\n        visible: config.active,\r\n        opacity: config.opacity ? config.opacity : 1,\r\n        source: new OlSourceTileWMS(sourceConfig)\r\n      });\r\n    } else {\r\n      t = new OLImageLayer({\r\n        id: config.id,\r\n        title: config.title,\r\n        type: config.type,\r\n        visible: config.active,\r\n        opacity: config.opacity ? config.opacity : 1,       \r\n        source: new OlSourceImageWMS(sourceConfig)\r\n      })\r\n    }\r\n    if (t && config.datasource) t.set(\"datasource\", config.datasource);\r\n    if (t && config.get_feature_info_format) t.set('get_feature_info_format', config.get_feature_info_format);\r\n\r\n    if (t && config.min_resolution) {\r\n      t.setMinResolution(config.min_resolution);\r\n    }\r\n    if (t && config.max_resolution) {\r\n      t.setMaxResolution(config.max_resolution);\r\n    }\r\n    if (t && config.min_scale) {\r\n      const res = getResolutionForScale(config.min_scale, mainMap.getView().getProjection().getUnits());\r\n      t.setMinResolution(res);\r\n    }    \r\n    if (t && config.max_scale) {\r\n      const res = getResolutionForScale(config.max_scale, mainMap.getView().getProjection().getUnits());\r\n      t.setMaxResolution(res);\r\n    }    \r\n\r\n    // Set legend URL\r\n    let legendUrl = createLegendUrl(config.url, config.wms_layers || config.layers, config.crs)\r\n    if (proxy_requests) {\r\n      legendUrl = MAP_PROXY + encodeURIComponent(legendUrl);\r\n    }\r\n    t.set('legendURL', legendUrl);\r\n    return t;\r\n  }\r\n  \r\n  useEffect(() => {\r\n    if (!mainMap) return;\r\n\r\n    layer.current = createLayer(config);\r\n    group.getLayers().push(layer.current);\r\n\r\n    return () => {\r\n      group.getLayers().remove(layer.current);\r\n    };\r\n\r\n  }, [mainMap]);\r\n\r\n  // Toggle layer visibility\r\n  useEffect(() => {\r\n    layer.current.setVisible(checked.includes(config.id));\r\n  }, [checked]);\r\n  \r\n  // Changed config\r\n  useEffect(() => {\r\n    let params = {\r\n      'LAYERS': config.layers,\r\n      'TILED': config.tiled,\r\n      'VERSION': config.version,\r\n      'FORMAT': config.get_map_format || config.format || 'image/png',\r\n      'STYLES': config.wms_style || config.styles\r\n    }\r\n    layer.current.getSource().updateParams(params);\r\n    layer.current.set('selectable', config.selectable);\r\n    layer.current.set('get_feature_info_format', config.get_feature_info_format)\r\n    layer.current.setOpacity(config.opacity);\r\n  }, [config]);\r\n\r\n  return null;\r\n};\r\n\r\nconst createLegendUrl = (url, layer, srs = 4326) => {\r\n  var finalurl = url;\r\n  finalurl += finalurl.indexOf('?') === -1 ? '?' : '';\r\n\r\n  //console.log('SRS=' + (srs.indexOf(':') === -1 ? 'EPSG:' + srs : srs));\r\n\r\n  return finalurl + '&' + ([\r\n      'SERVICE=WMS',\r\n      'VERSION=1.1.1',\r\n      'REQUEST=GetLegendGraphic',\r\n      'FORMAT=image%2Fpng',\r\n      'SRS=' + (String(srs).indexOf(':') === -1 ? 'EPSG:' + srs : srs),\r\n      'CRS=' + (String(srs).indexOf(':') === -1 ? 'EPSG:' + srs : srs),\r\n      'LAYER=' + layer\r\n  ].join('&'));\r\n};\r\n\r\nexport default WMSLayer;","import { useContext, useEffect, useRef } from \"react\";\r\nimport OlLayerVector from \"ol/layer/Vector\";\r\nimport OlSourceVector from \"ol/source/Vector\";\r\nimport OlFormatGML2 from \"ol/format/GML2\";\r\nimport OlFormatWFS from \"ol/format/WFS\";\r\nimport OlStyleStyle from \"ol/style/Style\";\r\nimport OlStyleStroke from \"ol/style/Stroke\";\r\nimport OlStyleFill from \"ol/style/Fill\";\r\nimport OlStyleCircle from \"ol/style/Circle\";\r\nimport OlStyleText from 'ol/style/Text';\r\nimport {all as allStrategy, bbox as bboxStrategy} from 'ol/loadingstrategy';\r\nimport AppContext from \"../../../AppContext\";\r\nimport { isUrlAppOrigin, isUrlAppHostname } from '../../utils';\r\nimport { transformExtent, getProjectionSrid, getResolutionForScale } from '../../model/MapModel';\r\n\r\nconst WFSLayer = ({ config, group, checked, viewer }) => {\r\n\r\n  const { core, mainMap } = useContext(AppContext);\r\n  const layer = useRef();\r\n\r\n  const auth = core.store.getState().root.auth;\r\n\r\n  const MAP_PROXY = core.MAP_PROXY_URL;\r\n\r\n  // Default style\r\n  function defaultStyle(config) {\r\n    console.log(config.style_stroke_color);\r\n    \r\n    let style_color = config.style_color === null ? null : (config.style_color ? `rgba(${config.style_color})` : 'black');\r\n    \r\n    let style_stroke_color = config.style_stroke_color === null ? null : (config.style_stroke_color ? `rgba(${config.style_stroke_color})` : 'black');\r\n    let style_stroke_width = config.style_stroke_width === null ? null : (typeof config.style_stroke_width === 'undefined' ? 1 : Number(config.style_stroke_width));\r\n    \r\n    let style_text_font = config.style_text_font ? config.style_text_font : '12px Calibri,sans-serif';\r\n    let style_text_fill_color = config.style_text_fill_color ? `rgba(${config.style_text_fill_color})` : '#000';\r\n    let style_text_stroke_color = config.style_text_stroke_color === null ? null : (config.style_text_stroke_color ? `rgba(${config.style_text_stroke_color})` : '#fff');\r\n    let style_text_stroke_width = config.style_text_stroke_width === null ? null : (typeof config.style_text_stroke_width === 'undefined' ? 2 : Number(config.style_text_stroke_width));\r\n    let style_text_value = config.style_text_value;\r\n\r\n    const style_objs = {\r\n      image: new OlStyleCircle({\r\n        radius: 8,\r\n        snapToPixel: false,\r\n        fill: new OlStyleFill({color: style_color }),\r\n        stroke: new OlStyleStroke({color: style_stroke_color, width: style_stroke_width })\r\n      })  \r\n    }\r\n\r\n    if (style_color) {\r\n      style_objs['fill'] = new OlStyleFill({color: style_color })\r\n    }\r\n    if (style_stroke_color || style_stroke_width) {\r\n      style_objs['stroke'] = new OlStyleStroke({\r\n          color: style_stroke_color,\r\n          width: style_stroke_width\r\n        });\r\n    }\r\n    if (style_text_value) {\r\n      style_objs['text'] = new OlStyleText({\r\n        font: style_text_font,\r\n        fill: new OlStyleFill({ color: style_text_fill_color }),\r\n        stroke: new OlStyleStroke({\r\n          color: style_text_stroke_color,\r\n          width: style_text_stroke_width\r\n        }),\r\n        text: style_text_value\r\n      });          \r\n    }\r\n\r\n    return new OlStyleStyle(\r\n      style_objs\r\n    );\r\n  }\r\n\r\n  function createLayer(config) {\r\n    let crs = mainMap.getView().getProjection().getCode();\r\n    let wfsFormatOptions = {\r\n      srsName: 'EPSG:' + config.crs,\r\n      dataProjection: 'EPSG:' + config.crs\r\n    };\r\n    let formatOutput = 'GML2';\r\n    let wfsformat = new OlFormatGML2(wfsFormatOptions);\r\n    let readFeaturesOptions = {\r\n      featureProjection: crs\r\n    }\r\n    let srsname = 'EPSG:' + config.crs\r\n    if (['2.0.0'].indexOf(config.version) > -1) {\r\n      wfsFormatOptions = {\r\n        srsName: 'EPSG:' + config.crs,\r\n        dataProjection: 'EPSG:' + config.crs\r\n      };\r\n      formatOutput = 'GML3';\r\n      wfsformat = new OlFormatWFS(wfsFormatOptions);\r\n      readFeaturesOptions = {\r\n        srsName: 'EPSG:' + config.crs,\r\n        dataProjection: 'EPSG:' + config.crs,\r\n        featureProjection: crs\r\n      }\r\n      srsname = \"urn:ogc:def:crs:EPSG::\" + config.crs\r\n    }\r\n    const vectorSource = new OlSourceVector({\r\n      loader: (extent, resolution, projection, success, failure) => {\r\n        let bbox = config.bbox ? config.bbox.split(' ') : null;\r\n        let bbox_crs = config?.bbox_crs || config?.crs;\r\n        let url = config.url\r\n        url = url.replace(/&$/ig, '')\r\n        url = url + (url.indexOf('?') > -1 ? '' : '?')\r\n          + '&service=WFS&'\r\n          + 'version=' + config.version\r\n          + '&request=GetFeature'\r\n          + '&typename=' + encodeURIComponent(config.layers)\r\n          + '&outputFormat=' + formatOutput\r\n          + '&srsname=' + srsname\r\n\r\n        if (config.strategy === 'bbox') {\r\n          if (parseInt(config.crs) !== parseInt(getProjectionSrid(crs))) {\r\n            bbox = transformExtent(\r\n              crs,\r\n              'EPSG:'+config.crs,\r\n              extent\r\n            );\r\n            url += '&bbox=' + bbox.join(',') + ',EPSG:'+config.crs;\r\n          } else {\r\n            url += '&bbox=' + extent.join(',') + ','+crs;\r\n          }\r\n        } else if (bbox) {\r\n          url += '&bbox=' + bbox.join(',') + ',EPSG:'+bbox_crs;\r\n        }         \r\n        \r\n        if (config?.max_features) {\r\n          if (config.version.startsWith('2')) {\r\n            url = url + '&count='+config.max_features;\r\n          } else {\r\n            url = url + '&maxFeatures='+config.max_features;\r\n          }\r\n        }\r\n        \r\n        //Add user authentication token  \r\n        if (isUrlAppHostname(url) && viewer.integrated_authentication) {\r\n          if (auth && auth.data && auth.data.auth_token) {\r\n            const authkey = viewer?.integrated_authentication_key || 'authkey';\r\n            url = url + '&' + authkey + '=' + auth.data.auth_token;\r\n          }\r\n        }\r\n\r\n        if (!isUrlAppOrigin(url)) {\r\n          url = MAP_PROXY + encodeURIComponent(url);\r\n        };\r\n\r\n        // TODO: check loading\r\n        //checkLoading('start');\r\n        fetch(url).then(res => res.text()).then(res => {\r\n          let features = [];\r\n          features = wfsformat.readFeatures(res, readFeaturesOptions);\r\n          features.forEach(f => f.ollayer = layer.current);\r\n          layer.current.getSource().addFeatures(features);\r\n          //checkLoading('end');\r\n        })\r\n        .catch(error => {\r\n          console.log(error);\r\n          layer.current.getSource().removeLoadedExtent(extent);\r\n          //checkLoading('end');\r\n        });\r\n      },\r\n      strategy: config?.strategy === \"bbox\" ? bboxStrategy : allStrategy,\r\n      attributions: config.attributions || []\r\n    });\r\n\r\n    const style = defaultStyle(config);\r\n\r\n    const new_layer = new OlLayerVector({\r\n      ...config,\r\n      visible: config.active,\r\n      source: vectorSource,\r\n      style: config.style_text_value ? (feature, resolution) => {\r\n        let label = config.style_text_value || '';\r\n        if (config.style_text_value && feature?.get) {\r\n          const rf = (label && label.match) ? label.match(/[^{}]+(?=})/g) : null;\r\n          if (rf) {\r\n            rf.forEach(fld => {\r\n              label = label.replace(`{${fld}}`, feature.get(fld) || '');      \r\n            });            \r\n          }\r\n        }\r\n        //const label = map.getView().getZoom() > 12 ? feature.get('PAR_ID') + '' : '';\r\n        style.getText().setText(label);\r\n          return style;\r\n        } : style\r\n    });\r\n\r\n    if (new_layer && config.min_resolution) {\r\n      new_layer.setMinResolution(config.min_resolution);\r\n    }\r\n    if (new_layer && config.max_resolution) {\r\n      new_layer.setMaxResolution(config.max_resolution);\r\n    }\r\n    if (new_layer && config.min_scale) {\r\n      const res = getResolutionForScale(config.min_scale, mainMap.getView().getProjection().getUnits());\r\n      new_layer.setMinResolution(res);\r\n    }    \r\n    if (new_layer && config.max_scale) {\r\n      const res = getResolutionForScale(config.max_scale, mainMap.getView().getProjection().getUnits());\r\n      new_layer.setMaxResolution(res);\r\n    }\r\n\r\n    return new_layer;\r\n  }\r\n  \r\n  useEffect(() => {\r\n    if (!mainMap) return;\r\n\r\n    layer.current = createLayer(config);\r\n    group.getLayers().push(layer.current);\r\n\r\n    return () => {\r\n      group.getLayers().remove(layer.current);\r\n    };\r\n\r\n  }, [mainMap]);\r\n\r\n  // Toggle layer visibility\r\n  useEffect(() => {\r\n    layer.current.setVisible(checked.includes(config.id))\r\n  }, [checked]);\r\n\r\n  // Changed config\r\n  useEffect(() => {\r\n    layer.current.setProperties(config);\r\n    layer.current.set('selectable', config.selectable);\r\n    layer.current.setOpacity(config.opacity);\r\n    layer.current.changed();\r\n  }, [config]);\r\n\r\n  return null;\r\n};\r\n\r\nexport default WFSLayer;","import { useContext, useEffect, useRef } from \"react\";\r\nimport OlSourceWMTS, {optionsFromCapabilities} from 'ol/source/WMTS';\r\nimport OLTileLayer from \"ol/layer/Tile\";\r\nimport AppContext from \"../../../AppContext\";\r\nimport { isUrlAppOrigin, isUrlAppHostname, removeUrlParam, addUrlParam } from '../../utils';\r\n\r\nconst WMTSLayer = ({ config, group, checked, viewer }) => {\r\n\r\n  const { core, mainMap } = useContext(AppContext);\r\n  const layer = useRef();\r\n\r\n  const auth = core.store.getState().root.auth;\r\n\r\n  function createLayer(config) {\r\n    let url = config.url;\r\n\r\n    let proxy_requests = false;\r\n    if (viewer && viewer.config_json && viewer.config_json.proxy_http_image_requests) {\r\n      proxy_requests = true;\r\n    }\r\n    if(config && config.proxy_http_image_requests != null) {\r\n      proxy_requests = config.proxy_http_image_requests;\r\n    }\r\n\r\n    const wmts_options = optionsFromCapabilities(config.wmts_capabilities, {\r\n      layer: config.layer,\r\n      matrixSet: config.wmts_tilematrixset || 'EPSG:900913',\r\n      format: 'image/png'\r\n    });\r\n\r\n    //Add user authentication token\r\n    if (isUrlAppHostname(url) && viewer.integrated_authentication) {\r\n      if (auth && auth.data && auth.data.auth_token) {\r\n        const authkey = viewer?.integrated_authentication_key || 'authkey';\r\n\r\n        if (wmts_options.urls && wmts_options.urls.length) {\r\n          const urls = wmts_options.urls.map(u => {\r\n            let new_url = removeUrlParam(u, authkey);\r\n            new_url = addUrlParam(new_url, authkey, auth.data.auth_token);\r\n            return new_url;\r\n          });\r\n          wmts_options.urls = urls;\r\n        };\r\n      }\r\n    }\r\n\r\n    if (proxy_requests) {\r\n      if (window.location.protocol === 'https:' && !isUrlAppOrigin(url) && navigator.userAgent.indexOf(\"Firefox\") == -1) {\r\n        const turl = new URL(url);\r\n        if (turl.protocol === 'http:') {\r\n          wmts_options[\"tileLoadFunction\"] = function(imageTile, src) {\r\n            imageTile.getImage().src = core.MAP_PROXY_URL + encodeURIComponent(src);\r\n          };\r\n        } else {\r\n          proxy_requests = false;\r\n        }\r\n      } else {\r\n        proxy_requests = false;\r\n      }\r\n    }    \r\n\r\n    if (config.attributions) {\r\n      wmts_options['attributions'] = config.attributions;\r\n    }\r\n    \r\n    return new OLTileLayer({\r\n      ...config,\r\n      visible: config.active,\r\n      source: new OlSourceWMTS(wmts_options)\r\n    });\r\n  }\r\n  \r\n  useEffect(() => {\r\n    if (!mainMap) return;\r\n\r\n    layer.current = createLayer(config);\r\n    group.getLayers().push(layer.current);\r\n\r\n    return () => {\r\n      group.getLayers().remove(layer.current);\r\n    };\r\n\r\n  }, [mainMap]);\r\n\r\n  // Toggle layer visibility\r\n  useEffect(() => {\r\n    layer.current.setVisible(checked.includes(config.id))\r\n  }, [checked]);\r\n\r\n  // Changed config\r\n  useEffect(() => {\r\n    const wmts_options = optionsFromCapabilities(config.wmts_capabilities, {\r\n      layer: config.layer,\r\n      matrixSet: config.wmts_tilematrixset || 'EPSG:900913',\r\n      format: 'image/png'\r\n    });\r\n    if (config.wmts_style) {\r\n      wmts_options.style = config.wmts_style;\r\n    }\r\n    if (config.wmts_format && config.wmts_format.toLowerCase().indexOf('image/') !== -1) {\r\n      wmts_options.format = config.wmts_format;\r\n    }\r\n    layer.current.setSource(new OlSourceWMTS(wmts_options));\r\n    layer.current.set('selectable', config.selectable);\r\n    layer.current.set('wmts_format', config.wmts_format);\r\n    layer.current.set('wmts_style', config.wmts_style);    \r\n    layer.current.set('get_feature_info_format', config.get_feature_info_format);\r\n    layer.current.setOpacity(config.opacity);\r\n  }, [config]);\r\n\r\n  return null;\r\n};\r\n\r\nexport default WMTSLayer;","import { useContext, useEffect, useRef } from \"react\";\r\nimport VectorLayer from 'ol/layer/VectorTile'\r\nimport VectorTile from 'ol/source/VectorTile'\r\nimport MVT from 'ol/format/MVT'\r\nimport { createXYZ } from 'ol/tilegrid';\r\nimport { Fill, Stroke, Style, Circle, Text } from 'ol/style'\r\nimport AppContext from \"../../../AppContext\";\r\nimport { isUrlAppOrigin } from \"../../utils\"\r\n\r\nconst VectorTileLayer = ({ config, group, checked }) => {\r\n\r\n  const { core, mainMap } = useContext(AppContext);\r\n  const layer = useRef();\r\n\r\n  const MAP_PROXY = core.MAP_PROXY_URL;\r\n\r\n  function createLayer(config) {\r\n\r\n    function getText(feature, resolution){\r\n  \r\n      if (!config.style || !config.style.label || resolution > config.style.label_resolution) {\r\n        return \"\"\r\n      } \r\n      \r\n      return (\r\n        config.style && config.style.label && feature ? new Text({\r\n          font: config.style.label_font ? config.style.label_font : \"12px sans-serif\",\r\n          text: feature.get(config.style.label_field).toString(),\r\n          fill: new Fill({ color: config.style.label_fill_color ? config.style.label_fill_color : \"rgba(0,0,0,1)\" }),\r\n          stroke: new Stroke({ color: config.style.label_stroke_color ? config.style.label_stroke_color : \"rgba(200,200,200,1)\", width: 3 }),\r\n          offsetX: 0,\r\n          offsetY: -10,\r\n        }) : ''\r\n      )\r\n    }\r\n\r\n\r\n    function getStyle(feature, resolution) {\r\n      if (!config.style || resolution > config.style.resolution) {\r\n        return \"\"\r\n      }\r\n\r\n      return new Style({\r\n        image: (config.style && config.style.point_shape && (config.style.point_shape.length > 2)) ?\r\n          new Circle({\r\n            fill: new Fill({\r\n              color: config.style.point_color,\r\n            }),\r\n            stroke: new Stroke({\r\n              color: config.style.point_stroke_color,\r\n              width: config.style.point_stroke_width,\r\n            }),\r\n            radius: config.style.point_radius\r\n          }) : null,\r\n\r\n        fill: new Fill({\r\n          color: config.style.fill_color\r\n        }),\r\n\r\n        stroke: new Stroke({\r\n          color: config.style.stroke_color,\r\n          width: config.style.stroke_width\r\n        }),\r\n\r\n        text: getText(feature, resolution)\r\n      })\r\n\r\n    };\r\n\r\n\r\n\r\n    let url = config.url;\r\n    if ((config.ignoreProxy != true) && !isUrlAppOrigin(url)) {\r\n      url = MAP_PROXY + url;\r\n    };\r\n\r\n    return new VectorLayer({\r\n      ...config,\r\n      visible: config.active,\r\n      style: getStyle,\r\n      source: new VectorTile({\r\n        tilePixelRatio: 1, // oversampling when > 1\r\n        tileGrid: createXYZ({ maxZoom: 19 }),\r\n        format: new MVT(),\r\n        url: url,\r\n        attributions: config.attributions || []\r\n      })\r\n    })\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (!mainMap) return;\r\n\r\n    layer.current = createLayer(config);\r\n    group.getLayers().push(layer.current);\r\n\r\n    // let selection = {};\r\n\r\n    // const selectionLayerStyle = new Style({\r\n    //   stroke: new Stroke({\r\n    //     color: '#dddd22',\r\n    //     width: 2,\r\n    //   }),\r\n    //   fill: new Fill({\r\n    //     color: 'rgba(200,200,200,0.4)',\r\n    //   }),\r\n    // });\r\n\r\n    // const selectionLayer = new VectorLayer({\r\n    //   renderMode: 'vector',\r\n    //   source: layer.current.getSource(),\r\n    //   style: function (feature) {\r\n    //     if (feature.getId() in selection) {\r\n    //       return selectionLayerStyle;\r\n    //     }\r\n    //   },\r\n    // });\r\n    // mainMap.addLayer(selectionLayer);\r\n\r\n    // // Check map click and select vector tile feature\r\n    // mainMap.on(['click'], function (event) {\r\n    //   layer.current.getFeatures(event.pixel).then(function (features) {\r\n    //     debugger;\r\n    //     selection = {};\r\n    //     if (!features.length) {\r\n    //       selectionLayer.changed();\r\n    //       console.log(\"nada\")\r\n    //       return;\r\n    //     }\r\n    //     var feature = features[0];\r\n    //     if (!feature) {\r\n    //       return;\r\n    //     }\r\n    //     var fid = feature.getId();\r\n\r\n    //     // if (selectElement.value.startsWith('singleselect')) {\r\n    //     //   selection = {};\r\n    //     // }\r\n    //     // add selected feature to lookup\r\n    //     selection[fid] = feature;\r\n    //     console.log(selection)\r\n    //     selectionLayer.changed();\r\n    //   });\r\n    // })\r\n\r\n    return () => {\r\n      group.getLayers().remove(layer.current);\r\n    };\r\n\r\n  }, [mainMap]);\r\n\r\n  // Toggle layer visibility\r\n  useEffect(() => {\r\n    layer.current.setVisible(checked.includes(config.id))\r\n  }, [checked]);\r\n\r\n  // Changed config\r\n  useEffect(() => {\r\n    layer.current.setOpacity(config.opacity);\r\n  }, [config]);\r\n\r\n  return null;\r\n};\r\n\r\nexport default VectorTileLayer;","import { useContext, useEffect, useRef } from \"react\";\r\nimport OLVectorLayer from \"ol/layer/Vector\";\r\nimport AppContext from \"../../../AppContext\";\r\nimport VectorSource from \"ol/source/Vector\";\r\nimport OlCollection from \"ol/Collection\";\r\nimport * as utils from '../../utils';\r\n\r\nconst VectorLayer = ({ config, source, style, group, checked, viewer }) => {\r\n\r\n  const { mainMap } = useContext(AppContext);\r\n  const layer = useRef()\r\n\r\n  useEffect(() => {\r\n    if (!mainMap) return;\r\n\r\n    // TODO: load source and style\r\n    layer.current = new OLVectorLayer({\r\n      ...config,\r\n      source: new VectorSource({ features: new OlCollection(), attributions: config.attributions || [] })\r\n      //style\r\n    });\r\n\r\n    group.getLayers().push(layer.current);\r\n\r\n    return () => {\r\n      group.getLayers().remove(layer.current);\r\n    };\r\n  }, [mainMap]);\r\n\r\n  // Update map with user drawings\r\n  const drawings = viewer.config_json.drawings;\r\n  useEffect(() => {\r\n    let ollayer = null;\r\n    if (layer.current && layer.current.get('id') === 'userlayer') ollayer = layer.current;\r\n    if (ollayer) {\r\n      const crs = mainMap.getView().getProjection().getCode();\r\n      ollayer.getSource().forEachFeature(f => {\r\n        if (f.get('state')) {\r\n          const exists = drawings.filter(d => d.id === f.getId());\r\n          if (exists.length === 0) ollayer.getSource().removeFeature(f);\r\n        }  \r\n      });\r\n      drawings.forEach(d => {\r\n        const exists = ollayer.getSource().getFeatureById(d.id);\r\n        if (!exists) {\r\n          const f = utils.deserializeDrawing(d, crs);\r\n          ollayer.getSource().addFeature(f);\r\n        }\r\n      });\r\n    }\r\n    return () => {\r\n      //if (ollayer) ollayer.getSource().clear();\r\n    }\r\n  }, [drawings]);\r\n\r\n  // Toggle layer visibility\r\n  useEffect(() => {\r\n    layer.current.setVisible(checked.includes(config.id))\r\n  }, [checked]);\r\n\r\n  return null;\r\n};\r\n\r\nexport default VectorLayer;","import { useContext, useEffect, useRef } from \"react\";\r\nimport OlLayerVector from \"ol/layer/Vector\";\r\nimport OlSourceVector from \"ol/source/Vector\";\r\nimport OlFormatGeoJSON from \"ol/format/GeoJSON\";\r\nimport OlStyleStyle from \"ol/style/Style\";\r\nimport OlStyleStroke from \"ol/style/Stroke\";\r\nimport OlStyleFill from \"ol/style/Fill\";\r\nimport OlStyleCircle from \"ol/style/Circle\";\r\nimport AppContext from \"../../../AppContext\";\r\nimport { isUrlAppOrigin } from '../../utils';\r\n\r\nconst GeoJSONLayer = ({ config, group, checked }) => {\r\n\r\n  const { core, mainMap } = useContext(AppContext);\r\n  const layer = useRef();\r\n\r\n  const MAP_PROXY = core.MAP_PROXY_URL;\r\n\r\n  // Default style\r\n  function defaultStyle(feature) {\r\n    let style_color = config.style_color ? `rgba(${config.style_color})` : 'black';\r\n    let style_stroke_color = config.style_stroke_color ? `rgba(${config.style_stroke_color})` : 'black';\r\n    let style_stroke_width = typeof config.style_stroke_width === 'undefined' ? 1 : Number(config.style_stroke_width);\r\n    let style_image_radius = typeof config.style_image_radius === 'undefined' ? 3 : Number(config.style_image_radius);\r\n    if (feature.ollayer) {\r\n      const layerProps = feature.ollayer.getProperties();\r\n      style_color = `rgba(${layerProps.style_color})`;\r\n      style_stroke_color = `rgba(${layerProps.style_stroke_color})`;\r\n      style_stroke_width = typeof layerProps.style_stroke_width === 'undefined' ? 1 : Number(layerProps.style_stroke_width);\r\n      style_image_radius = typeof layerProps.style_image_radius === 'undefined' ? 3 : Number(layerProps.style_image_radius);\r\n    }\r\n    return new OlStyleStyle({\r\n      image: new OlStyleCircle({\r\n        radius: style_image_radius,\r\n        snapToPixel: false,\r\n        fill: new OlStyleFill({color: style_color }),\r\n        stroke: new OlStyleStroke({color: style_stroke_color, width: style_stroke_width })\r\n      }),\r\n      fill: new OlStyleFill({color: style_color }),\r\n      stroke: new OlStyleStroke({\r\n        color: style_stroke_color,\r\n        width: style_stroke_width\r\n      })\r\n    });\r\n  }\r\n\r\n  function createLayer(config) {\r\n    let formatOptions = {\r\n      dataProjection: 'EPSG:' + config.crs,\r\n      featureProjection: mainMap.getView().getProjection().getCode()\r\n    };\r\n    let format = new OlFormatGeoJSON(formatOptions);\r\n    \r\n    const vectorSource = new OlSourceVector({\r\n      //url: config.url,\r\n      format: format,\r\n      attributions: config.attributions || [],\r\n\r\n      loader: (extent) => {\r\n        let url = config.url\r\n        // Use map proxy\r\n        if (!isUrlAppOrigin(url)) {\r\n          url = MAP_PROXY + encodeURIComponent(url);\r\n        };\r\n        // TODO: check loading\r\n        //checkLoading('start');\r\n        fetch(url).then(res => res.text()).then(res => {\r\n          let features = [];\r\n          features = format.readFeatures(res);\r\n          features.forEach(f => f.ollayer = layer.current);\r\n          layer.current.getSource().addFeatures(features);\r\n          //checkLoading('end');\r\n        })\r\n        .catch(error => {\r\n          console.log(error);\r\n          layer.current.getSource().removeLoadedExtent(extent);\r\n          //checkLoading('end');\r\n        });\r\n      }\r\n    });\r\n    return new OlLayerVector({\r\n      ...config,\r\n      visible: config.active,\r\n      source: vectorSource,\r\n      style: defaultStyle\r\n    });\r\n  }\r\n  \r\n  useEffect(() => {\r\n    if (!mainMap) return;\r\n\r\n    layer.current = createLayer(config);\r\n    group.getLayers().push(layer.current);\r\n\r\n    return () => {\r\n      group.getLayers().remove(layer.current);\r\n    };\r\n\r\n  }, [mainMap]);\r\n\r\n  // Toggle layer visibility\r\n  useEffect(() => {\r\n    layer.current.setVisible(checked.includes(config.id))\r\n  }, [checked]);\r\n\r\n  // Changed config\r\n  useEffect(() => {\r\n    layer.current.setProperties(config);\r\n    layer.current.set('selectable', config.selectable);\r\n    layer.current.setOpacity(config.opacity);\r\n    layer.current.changed();\r\n  }, [config]);\r\n\r\n  return null;\r\n};\r\n\r\nexport default GeoJSONLayer;","import { useContext, useEffect, useRef } from \"react\";\r\nimport OlLayerVector from \"ol/layer/Vector\";\r\nimport OlSourceVector from \"ol/source/Vector\";\r\nimport OlFormatKML from \"ol/format/KML\";\r\nimport OlStyleStyle from \"ol/style/Style\";\r\nimport OlStyleStroke from \"ol/style/Stroke\";\r\nimport OlStyleFill from \"ol/style/Fill\";\r\nimport OlStyleCircle from \"ol/style/Circle\";\r\nimport AppContext from \"../../../AppContext\";\r\nimport { isUrlAppOrigin } from '../../utils';\r\n\r\nconst KMLLayer = ({ config, group, checked }) => {\r\n\r\n  const { core, mainMap } = useContext(AppContext);\r\n  const layer = useRef();\r\n\r\n  const MAP_PROXY = core.MAP_PROXY_URL;\r\n\r\n  // Default style\r\n  function defaultStyle(feature) {\r\n    let style_color = config.style_color ? `rgba(${config.style_color})` : 'black';\r\n    let style_stroke_color = config.style_stroke_color ? `rgba(${config.style_stroke_color})` : 'black';\r\n    let style_stroke_width = typeof config.style_stroke_width === 'undefined' ? 1 : Number(config.style_stroke_width);\r\n    if (feature.ollayer) {\r\n      const layerProps = feature.ollayer.getProperties();\r\n      style_color = `rgba(${layerProps.style_color})`;\r\n      style_stroke_color = `rgba(${layerProps.style_stroke_color})`;\r\n      style_stroke_width = typeof layerProps.style_stroke_width === 'undefined' ? 1 : Number(layerProps.style_stroke_width);\r\n    }\r\n    return new OlStyleStyle({\r\n      image: new OlStyleCircle({\r\n        radius: 8,\r\n        snapToPixel: false,\r\n        fill: new OlStyleFill({color: style_color }),\r\n        stroke: new OlStyleStroke({color: style_stroke_color, width: style_stroke_width })\r\n      }),\r\n      fill: new OlStyleFill({color: style_color }),\r\n      stroke: new OlStyleStroke({\r\n        color: style_stroke_color,\r\n        width: style_stroke_width\r\n      })\r\n    });\r\n  }\r\n\r\n  function createLayer(config) {\r\n    /*\r\n    let formatOptions = {\r\n      dataProjection: 'EPSG:' + config.crs,\r\n      featureProjection: mainMap.getView().getProjection().getCode()\r\n    };\r\n    */\r\n    //let format = new OlFormatKML(formatOptions);  \r\n    let format = new OlFormatKML();\r\n\r\n    let url = config.url\r\n    // Use map proxy\r\n    if (!isUrlAppOrigin(url)) {\r\n      url = MAP_PROXY + encodeURIComponent(url);\r\n    };    \r\n    \r\n    const vectorSource = new OlSourceVector({\r\n      url: url,\r\n      format: new OlFormatKML({\r\n        extractStyles: false\r\n      }),\r\n      attributions: config.attributions || []\r\n      /*\r\n      //url: config.url,\r\n      format: format,\r\n      \r\n      loader: (extent) => {\r\n        let url = config.url\r\n        // Use map proxy\r\n        if (!isUrlAppOrigin(url)) {\r\n          url = MAP_PROXY + encodeURIComponent(url)\r\n        };\r\n        // TODO: check loading\r\n        //checkLoading('start');\r\n        fetch(url).then(res => res.text()).then(res => {\r\n          let features = [];\r\n          features = format.readFeatures(res);\r\n          features.forEach(f => f.ollayer = layer.current);\r\n          layer.current.getSource().addFeatures(features);\r\n          //checkLoading('end');\r\n        })\r\n        .catch(error => {\r\n          console.log(error);\r\n          layer.current.getSource().removeLoadedExtent(extent);\r\n          //checkLoading('end');\r\n        });\r\n      }\r\n      */\r\n    });\r\n    return new OlLayerVector({\r\n      ...config,\r\n      visible: config.active,\r\n      source: vectorSource,\r\n      style: defaultStyle\r\n    });\r\n  }\r\n  \r\n  useEffect(() => {\r\n    if (!mainMap) return;\r\n\r\n    layer.current = createLayer(config);\r\n    group.getLayers().push(layer.current);\r\n\r\n    return () => {\r\n      group.getLayers().remove(layer.current);\r\n    };\r\n\r\n  }, [mainMap]);\r\n\r\n  // Toggle layer visibility\r\n  useEffect(() => {\r\n    layer.current.setVisible(checked.includes(config.id))\r\n  }, [checked]);\r\n\r\n  // Changed config\r\n  useEffect(() => {\r\n    layer.current.setProperties(config);\r\n    layer.current.set('selectable', config.selectable);\r\n    layer.current.setOpacity(config.opacity);\r\n    layer.current.changed();\r\n  }, [config]);\r\n\r\n  return null;\r\n};\r\n\r\nexport default KMLLayer;","import { useContext, useEffect, useRef, useState } from \"react\";\r\nimport OLTileLayer from \"ol/layer/Tile\";\r\nimport OLImageLayer from \"ol/layer/Image\";\r\nimport OlSourceTileArcGISRest from 'ol/source/TileArcGISRest';\r\nimport OlSourceImageArcGISRest from 'ol/source/ImageArcGISRest';\r\nimport AppContext from \"../../../AppContext\";\r\nimport { removeUrlParam } from \"../../utils\";\r\nimport { dumpLayers } from \"./MorphLayer\";\r\nimport { isUrlAppOrigin, isUrlAppHostname } from '../../utils';\r\nimport { getResolutionForScale } from '../../model/MapModel';\r\n\r\nconst ArcGISMapLayer = ({ config, group, checked, viewer }) => {\r\n\r\n  const { core, mainMap } = useContext(AppContext);\r\n  const layer = useRef();\r\n\r\n  //const auth = core.store.getState().root.auth;\r\n\r\n  const MAP_PROXY = core.MAP_PROXY_URL;\r\n\r\n  function createLayer(config) {\r\n    let url = config.url;\r\n\r\n    let proxy_requests = false;\r\n    if (viewer && viewer.config_json && viewer.config_json.proxy_http_image_requests) {\r\n      proxy_requests = true;\r\n    }\r\n    if(config && config.proxy_http_image_requests != null) {\r\n      proxy_requests = config.proxy_http_image_requests;\r\n    }\r\n\r\n    let sourceConfig = {\r\n      url: url,\r\n      //hidpi: false,\r\n      params: {\r\n        'LAYERS': config.layers,\r\n      }\r\n    };\r\n\r\n    /*\r\n    //Add user authentication token  \r\n    if (isUrlAppHostname(url) && viewer.integrated_authentication) {\r\n      if (auth && auth.data && auth.data.auth_token) {\r\n        const authkey = viewer?.integrated_authentication_key || 'authkey';\r\n        sourceConfig.params[authkey] = auth.data.auth_token;\r\n      }\r\n    }\r\n    */\r\n\r\n    if (proxy_requests) {\r\n      if (window.location.protocol === 'https:' && !isUrlAppOrigin(url) && navigator.userAgent.indexOf(\"Firefox\") == -1) {\r\n        const turl = new URL(url);\r\n        if (turl.protocol === 'http:') {\r\n          if (config.tiled) {\r\n            sourceConfig[\"tileLoadFunction\"] = function(imageTile, src) {\r\n              imageTile.getImage().src = MAP_PROXY + encodeURIComponent(src);\r\n            };\r\n          } else {\r\n            sourceConfig[\"imageLoadFunction\"] = function(image, src) {\r\n              image.getImage().src = MAP_PROXY + encodeURIComponent(src);\r\n            };            \r\n          }\r\n        } else {\r\n          proxy_requests = false;\r\n        }\r\n      } else {\r\n        proxy_requests = false;\r\n      }\r\n    }\r\n\r\n    // Check theme has map CRS\r\n    let crs = mainMap.getView().getProjection().getCode();\r\n    if (config.crs_options && config.crs_options.indexOf(crs) === -1) {\r\n      sourceConfig['projection'] = 'EPSG:4326';\r\n    }\r\n\r\n    if (config.attributions) {\r\n      sourceConfig['attributions'] = config.attributions;\r\n    }\r\n\r\n    // Create layer\r\n    let t;\r\n    if (config.tiled) {\r\n      t = new OLTileLayer({\r\n        id: config.id,\r\n        title: config.title,\r\n        type: config.type,\r\n        visible: config.active,\r\n        opacity: config.opacity ? config.opacity : 1,\r\n        source: new OlSourceTileArcGISRest(sourceConfig)\r\n      });\r\n    } else {\r\n      t = new OLImageLayer({\r\n        id: config.id,\r\n        title: config.title,\r\n        type: config.type,\r\n        visible: config.active,\r\n        opacity: config.opacity ? config.opacity : 1,       \r\n        source: new OlSourceImageArcGISRest(sourceConfig)\r\n      })\r\n    }\r\n    if (t && config.datasource) t.set(\"datasource\", config.datasource);\r\n    if (t && config.get_feature_info_layers) t.set('get_feature_info_layers', config.get_feature_info_layers);\r\n    if (t && config.get_feature_info_tolerance) t.set('get_feature_info_tolerance', config.get_feature_info_tolerance);\r\n\r\n    if (t && config.min_resolution) {\r\n      t.setMinResolution(config.min_resolution);\r\n    }\r\n    if (t && config.max_resolution) {\r\n      t.setMaxResolution(config.max_resolution);\r\n    }\r\n    if (t && config.min_scale) {\r\n      const res = getResolutionForScale(config.min_scale, mainMap.getView().getProjection().getUnits());\r\n      t.setMinResolution(res);\r\n    }    \r\n    if (t && config.max_scale) {\r\n      const res = getResolutionForScale(config.max_scale, mainMap.getView().getProjection().getUnits());\r\n      t.setMaxResolution(res);\r\n    }\r\n\r\n    if (t && config.layerId != null) {\r\n      t.set('layerId', Array.isArray(config.layerId) ? config.layerId : [config.layerId]);\r\n    }\r\n    if (t && config.layerName) {\r\n      t.set('layerName', Array.isArray(config.layerName) ? config.layerName : [config.layerName]);\r\n    }       \r\n\r\n    return t;\r\n  }\r\n  \r\n  useEffect(() => {\r\n    if (!mainMap) return;\r\n\r\n    layer.current = createLayer(config);\r\n    group.getLayers().push(layer.current);\r\n\r\n    return () => {\r\n      group.getLayers().remove(layer.current);\r\n    };\r\n\r\n  }, [mainMap]);\r\n\r\n  // Toggle layer visibility\r\n  useEffect(() => {\r\n    layer.current.setVisible(checked.includes(config.id));\r\n  }, [checked]);\r\n  \r\n  // Changed config\r\n  useEffect(() => {\r\n    let params = {\r\n      'LAYERS': config.layers\r\n    }\r\n    layer.current.getSource().updateParams(params);\r\n    layer.current.set('selectable', config.selectable);\r\n    layer.current.set('get_feature_info_layers', config.get_feature_info_layers)\r\n    layer.current.set('get_feature_info_tolerance', config.get_feature_info_tolerance)\r\n    layer.current.setOpacity(config.opacity);\r\n  }, [config]);\r\n\r\n  return null;\r\n};\r\n\r\nexport default ArcGISMapLayer;","import React, { useContext, useEffect, useRef, useState } from \"react\"\r\nimport AppContext from \"../../../AppContext\"\r\nimport OLGroupLayer from 'ol/layer/Group'\r\nimport MorphLayer, { dumpLayers } from \"./MorphLayer\"\r\n\r\nconst GroupLayer = ({ layers, config, group, checked, viewer }) => {\r\n\r\n  const { mainMap } = useContext(AppContext);\r\n  const [loaded, setLoaded] = useState(false);\r\n  const layer = useRef();\r\n\r\n  useEffect(() => {\r\n    if (!mainMap) return;\r\n    setLoaded(false);\r\n\r\n    layer.current = new OLGroupLayer({\r\n      id: config.id,\r\n      title: config.title,\r\n      type: config.type,\r\n      visible: config.active\r\n    });\r\n    \r\n    if (!group) mainMap.addLayer(layer.current);\r\n    else group.getLayers().push(layer.current);\r\n    setLoaded(true);\r\n\r\n    return () => {\r\n      if (!layer.current) return;\r\n      if (!group) mainMap.removeLayer(layer.current);\r\n      else group.getLayers().remove(layer.current);\r\n    };\r\n  }, [mainMap]);\r\n\r\n  // Toggle layer visibility\r\n  useEffect(() => {\r\n    layer.current.setVisible(checked.includes(config.id));\r\n  }, [checked]);\r\n\r\n  // Validate children prop\r\n  if (!config.children) return null;\r\n  if (!loaded) return null;\r\n\r\n  // Render children layers\r\n  const children = config.children.map(id => layers.find(c => c.id === id)).filter(c => !!c);\r\n  children.reverse();\r\n  return children.map((c, i) => {\r\n\r\n    // Render component layer\r\n    return (\r\n      <MorphLayer\r\n        key={c.id + i}\r\n        config={c}\r\n        layers={layers}\r\n        group={layer.current}\r\n        checked={checked}\r\n        viewer={viewer}\r\n      />\r\n    )\r\n    \r\n  });\r\n};\r\n\r\nexport default GroupLayer;","import React from \"react\";\r\nimport TileLayer from \"./TileLayer\";\r\nimport WMSLayer from \"./WMSLayer\";\r\nimport WFSLayer from \"./WFSLayer\";\r\nimport OSM from \"ol/source/OSM\";\r\nimport OlSourceXYZ from \"ol/source/XYZ\";\r\nimport OlSourceTileJSON from \"ol/source/TileJSON\";\r\nimport OLGroupLayer from \"ol/layer/Group\";\r\nimport WMTSLayer from \"./WMTSLayer\";\r\nimport VectorTileLayer from \"./VectorTileLayer\";\r\nimport VectorLayer from \"./VectorLayer\";\r\nimport GeoJSONLayer from \"./GeoJSONLayer\";\r\nimport KMLLayer from \"./KMLLayer\";\r\nimport ArcGISMapLayer from \"./ArcGISMapLayer\";\r\nimport GroupLayer from './GroupLayer';\r\nimport { removeUrlParam, addUrlParam} from '../../utils';\r\n\r\nexport function dumpLayers(collection, only) {\r\n  collection.forEach(l => {\r\n    //console.log(l.get('id'), l.get('type'), l.get('title'), l.getVisible());\r\n    if (l instanceof OLGroupLayer) dumpLayers(l.getLayers(), only);\r\n  })\r\n}\r\n\r\nconst MorphLayer = ({ layers, config, group, checked, viewer }) => {\r\n\r\n  if (!config) return null;\r\n\r\n  // Create component layer\r\n  let source, LayerComponent;\r\n  switch(config.type) {\r\n\r\n    case 'VTILE': \r\n      LayerComponent = VectorTileLayer;\r\n      break;\r\n      \r\n    case 'VECTOR': \r\n      LayerComponent = VectorLayer;\r\n      break; \r\n\r\n    case 'GeoJSON': \r\n      LayerComponent = GeoJSONLayer;\r\n      break;\r\n\r\n    case 'KML': \r\n      LayerComponent = KMLLayer;\r\n      break;      \r\n    \r\n    case 'WMS': \r\n      LayerComponent = WMSLayer;\r\n      break;\r\n      \r\n    case 'WFS': \r\n      LayerComponent = WFSLayer;\r\n      break;\r\n      \r\n    case 'WMTS': \r\n      LayerComponent = WMTSLayer;\r\n      break;\r\n      \r\n    case 'OSM':\r\n      source = new OSM()\r\n      LayerComponent = TileLayer;\r\n      break;\r\n      \r\n    case 'XYZ': \r\n      source = new OlSourceXYZ({ url: config.url })\r\n      LayerComponent = TileLayer;\r\n      break;\r\n\r\n    case 'WMTSXYZ':\r\n      source = new OlSourceXYZ({\r\n        tileUrlFunction: function(coordinate) {\r\n          let wmts_url = config.url;\r\n\r\n          wmts_url = removeUrlParam(wmts_url, 'service');\r\n          wmts_url = addUrlParam(wmts_url, 'service', 'WMTS');\r\n\r\n          wmts_url = removeUrlParam(wmts_url, 'request');\r\n          wmts_url = addUrlParam(wmts_url, 'request', 'GetTile');          \r\n\r\n          if (config.wmts_version) {\r\n            wmts_url = removeUrlParam(wmts_url, 'version');\r\n            wmts_url = addUrlParam(wmts_url, 'version', config.wmts_version);\r\n          }\r\n\r\n          let z = ('0' + coordinate[0]).slice(-2);\r\n          if (config.zformat === 'integer') {\r\n            z = coordinate[0];\r\n          }\r\n          wmts_url = wmts_url.replace('{z}', z);\r\n          wmts_url = wmts_url.replace('{x}', coordinate[1]);\r\n          wmts_url = wmts_url.replace('{y}', coordinate[2]);\r\n\r\n          if (config.layer) {\r\n            wmts_url = removeUrlParam(wmts_url, 'layer');\r\n            wmts_url = addUrlParam(wmts_url, 'layer', config.layer);            \r\n          }\r\n          if (config.wmts_layer) {\r\n            wmts_url = removeUrlParam(wmts_url, 'layer');\r\n            wmts_url = addUrlParam(wmts_url, 'layer', config.wmts_layer);            \r\n          }          \r\n          if (config.wmts_tilematrixset) {\r\n            wmts_url = removeUrlParam(wmts_url, 'tilematrixset');\r\n            wmts_url = addUrlParam(wmts_url, 'tilematrixset', config.wmts_tilematrixset);\r\n            wmts_url = wmts_url.replace('{tilematrixset}', config.wmts_tilematrixset);\r\n          }                 \r\n          if (config.wmts_style) {\r\n            wmts_url = removeUrlParam(wmts_url, 'style');\r\n            wmts_url = addUrlParam(wmts_url, 'style', config.wmts_style);\r\n          }\r\n          //Legacy, replaced by wmts_format\r\n          if (config.get_tile_format) {\r\n            wmts_url = removeUrlParam(wmts_url, 'format');\r\n            wmts_url = addUrlParam(wmts_url, 'format', config.get_tile_format);\r\n          }          \r\n          if (config.wmts_format) {\r\n            wmts_url = removeUrlParam(wmts_url, 'format');\r\n            wmts_url = addUrlParam(wmts_url, 'format', config.wmts_format);\r\n          }\r\n\r\n          return wmts_url;\r\n        }\r\n      })\r\n      LayerComponent = TileLayer;\r\n      break;\r\n      \r\n    case 'BING':\r\n      LayerComponent = TileLayer;\r\n      break;\r\n      \r\n    case 'TileJSON':\r\n      source = new OlSourceTileJSON({ url: config.url })\r\n      LayerComponent = TileLayer;\r\n      break;\r\n\r\n    case 'ArcGISMap': \r\n      LayerComponent = ArcGISMapLayer;\r\n      break;     \r\n      \r\n    case 'GROUP':\r\n      LayerComponent = GroupLayer;\r\n      break;\r\n      \r\n    default:\r\n      return null;\r\n  }\r\n\r\n  // Render component layer\r\n  return (\r\n    <LayerComponent \r\n      key={config.id}\r\n      config={config}\r\n      layers={layers}\r\n      group={group}\r\n      source={source}\r\n      checked={checked}\r\n      viewer={viewer}\r\n    />\r\n  )\r\n\r\n};\r\n\r\nexport default MorphLayer;","import React from 'react'\r\nimport MapModel from '../model/MapModel';\r\nimport OWSModel from '../model/OWSModel';\r\nimport * as Utils from '../utils';\r\n\r\nexport default function FooterLeft(props) {\r\n\r\n  const { core, viewer, dispatch, mainMap } = props;\r\n\r\n  return (\r\n    <React.Fragment>\r\n\r\n      { core.renderComponents({\r\n        region: 'footer_left',\r\n        props: { viewer, dispatch, mainMap, Models: { MapModel, OWSModel, Utils } },\r\n        as: \"popup\"\r\n      })}\r\n      \r\n    </React.Fragment>\r\n  )\r\n}","import React, { useContext } from 'react'\r\nimport { connect, useDispatch } from 'react-redux'\r\nimport AppContext from '../../AppContext'\r\nimport FooterLeftComponent from '../components/FooterLeft'\r\nimport { mapStateToProps } from '../utils'\r\n\r\nfunction FooterLeft(props) {\r\n\r\n  const { core, mainMap } = useContext(AppContext);\r\n  const dispatch = useDispatch();\r\n  const { viewer } = props;\r\n  \r\n  return (\r\n    <FooterLeftComponent\r\n      core={core}\r\n      mainMap={mainMap}\r\n      dispatch={dispatch}\r\n      viewer={viewer}\r\n    />\r\n  )\r\n}\r\n\r\nexport default connect(state => {\r\n  const gstate = mapStateToProps(state);\r\n  return ({\r\n    viewer: gstate.viewer,\r\n    components: gstate.components,\r\n    auth: gstate.auth\r\n  });\r\n})(FooterLeft);","import React from 'react'\r\nimport MapModel from '../model/MapModel';\r\nimport OWSModel from '../model/OWSModel';\r\nimport * as Utils from '../utils';\r\n\r\nexport default function FooterRight(props) {\r\n\r\n  const { core, viewer, dispatch, mainMap } = props;\r\n\r\n  return (\r\n    <React.Fragment>\r\n\r\n      { core.renderComponents({\r\n        region: 'footer_right',\r\n        props: { viewer, dispatch, mainMap, Models: { MapModel, OWSModel, Utils } },\r\n        as: \"popup\"\r\n      })}\r\n      \r\n    </React.Fragment>\r\n  )\r\n}","import React, { useContext } from 'react'\r\nimport { connect, useDispatch } from 'react-redux'\r\nimport AppContext from '../../AppContext'\r\nimport FooterRightComponent from '../components/FooterRight'\r\nimport { mapStateToProps } from '../utils'\r\n\r\nfunction FooterRight(props) {\r\n\r\n  const { core, mainMap } = useContext(AppContext);\r\n  const dispatch = useDispatch();\r\n  const { viewer } = props;\r\n\r\n  return (\r\n    <FooterRightComponent\r\n      core={core}\r\n      mainMap={mainMap}\r\n      dispatch={dispatch}\r\n      viewer={viewer}\r\n    />\r\n  )\r\n}\r\n\r\nexport default connect(state => {\r\n  const gstate = mapStateToProps(state);\r\n  return ({\r\n    viewer: gstate.viewer,\r\n    components: gstate.components,\r\n    auth: gstate.auth\r\n  });\r\n})(FooterRight);","import React from 'react'\r\nimport MapModel from '../model/MapModel';\r\nimport OWSModel from '../model/OWSModel';\r\nimport * as Utils from '../utils';\r\n\r\nexport default function TopbarRight(props) {\r\n\r\n  const { core, viewer, dispatch, mainMap } = props;\r\n\r\n  return (\r\n    <React.Fragment>\r\n\r\n      { core.renderComponents({\r\n        region: 'topbar_right',\r\n        props: { viewer, dispatch, mainMap, Models: { MapModel, OWSModel, Utils } }\r\n      })}\r\n      \r\n    </React.Fragment>\r\n  )\r\n}","import React, { useContext } from 'react'\r\nimport { connect, useDispatch } from 'react-redux'\r\nimport AppContext from '../../AppContext'\r\nimport TopbarRightComponent from '../components/TopbarRight'\r\nimport { mapStateToProps } from '../utils'\r\n\r\nfunction TopbarRight(props) {\r\n\r\n  const { core, mainMap } = useContext(AppContext);\r\n  const dispatch = useDispatch();\r\n  const { viewer } = props;\r\n  \r\n  return (\r\n    <TopbarRightComponent\r\n      core={core}\r\n      mainMap={mainMap}\r\n      dispatch={dispatch}\r\n      viewer={viewer}\r\n    />\r\n  )\r\n}\r\n\r\nexport default connect(state => {\r\n  const gstate = mapStateToProps(state);\r\n  return ({\r\n    viewer: gstate.viewer,\r\n    components: gstate.components,\r\n    auth: gstate.auth\r\n  });\r\n})(TopbarRight);","import React from 'react'\r\n\r\nexport default function MapControlsTopLeft(props) {\r\n\r\n  const { core, viewer, dispatch, mainMap } = props;\r\n\r\n  return (\r\n    <React.Fragment>\r\n\r\n      { core.renderComponents({\r\n        region: 'map_controls_top_left',\r\n        props: { viewer, dispatch, mainMap },\r\n        className: \"map-region-top-left\"\r\n      })}\r\n      \r\n    </React.Fragment>\r\n  )\r\n}","import React, { useContext } from 'react'\r\nimport { connect, useDispatch } from 'react-redux'\r\nimport AppContext from '../../AppContext'\r\nimport MapControlsTopLeftComponent from '../components/MapControlsTopLeft'\r\nimport { mapStateToProps } from '../utils'\r\n\r\nfunction MapControlsTopLeft(props) {\r\n\r\n  const { core, mainMap } = useContext(AppContext);\r\n  const dispatch = useDispatch();\r\n  const { viewer } = props;\r\n  \r\n  return (\r\n    <MapControlsTopLeftComponent\r\n      core={core}\r\n      mainMap={mainMap}\r\n      dispatch={dispatch}\r\n      viewer={viewer}\r\n    />\r\n  )\r\n}\r\n\r\nexport default connect(state => {\r\n  const gstate = mapStateToProps(state);\r\n  return ({\r\n    viewer: gstate.viewer,\r\n    components: gstate.components,\r\n    auth: gstate.auth\r\n  });\r\n})(MapControlsTopLeft);","import React from 'react'\r\n\r\nexport default function MapControlsTopRight(props) {\r\n\r\n  const { core, viewer, dispatch, mainMap } = props;\r\n\r\n  return (\r\n    <React.Fragment>\r\n\r\n      { core.renderComponents({\r\n        region: 'map_controls_top_right',\r\n        props: { viewer, dispatch, mainMap },\r\n        className: \"map-region-top-right\"\r\n      })}\r\n      \r\n    </React.Fragment>\r\n  )\r\n}","import React, { useContext } from 'react'\r\nimport { connect, useDispatch } from 'react-redux'\r\nimport AppContext from '../../AppContext'\r\nimport MapControlsTopRightComponent from '../components/MapControlsTopRight'\r\nimport { mapStateToProps } from '../utils'\r\n\r\nfunction MapControlsTopRight(props) {\r\n\r\n  const { core, mainMap } = useContext(AppContext);\r\n  const dispatch = useDispatch();\r\n  const { viewer } = props;\r\n\r\n  return (\r\n    <MapControlsTopRightComponent\r\n      core={core}\r\n      mainMap={mainMap}\r\n      dispatch={dispatch}\r\n      viewer={viewer}\r\n    />\r\n  )\r\n}\r\n\r\nexport default connect(state => {\r\n  const gstate = mapStateToProps(state);\r\n  return ({\r\n    viewer: gstate.viewer,\r\n    components: gstate.components,\r\n    auth: gstate.auth\r\n  });\r\n})(MapControlsTopRight);","import React from 'react'\r\n\r\nexport default function MapControlsLeft(props) {\r\n\r\n  const { core, viewer, dispatch, mainMap } = props;\r\n\r\n  return (\r\n    <React.Fragment>\r\n\r\n      { core.renderComponents({\r\n        region: 'map_controls_left',\r\n        props: { viewer, dispatch, mainMap, actions: core.actions },\r\n        className: \"map-region-left-component\"\r\n      })}\r\n\r\n      { core.renderComponentsLinks({\r\n        region: 'map_controls_left',\r\n        props: { viewer, dispatch, mainMap, actions: core.actions },\r\n        className: \"map-region-left-component-link\"\r\n      })}         \r\n\r\n    </React.Fragment>\r\n  )\r\n}","import React, { useContext } from 'react'\r\nimport { connect, useDispatch } from 'react-redux'\r\nimport AppContext from '../../AppContext'\r\nimport MapControlsLeftComponent from '../components/MapControlsLeft'\r\nimport { mapStateToProps } from '../utils'\r\n\r\nfunction MapControlsLeft(props) {\r\n\r\n  const { core, mainMap } = useContext(AppContext);\r\n  const dispatch = useDispatch();\r\n  const { viewer } = props;\r\n  \r\n  return (\r\n    <div className=\"map-region-left\">\r\n      <MapControlsLeftComponent\r\n        core={core}\r\n        mainMap={mainMap}\r\n        dispatch={dispatch}\r\n        viewer={viewer}\r\n      />\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default connect(state => {\r\n  const gstate = mapStateToProps(state);\r\n  return ({\r\n    viewer: gstate.viewer,\r\n    components: gstate.components,\r\n    auth: gstate.auth\r\n  });\r\n})(MapControlsLeft);","import React from 'react'\r\n\r\nexport default function MapControlsBottomLeft(props) {\r\n\r\n  const { core, viewer, dispatch, mainMap } = props;\r\n\r\n  return (\r\n    <React.Fragment>\r\n\r\n      { core.renderComponents({\r\n        region: 'map_controls_bottom_left',\r\n        props: { viewer, dispatch, mainMap },\r\n        className: \"map-region-bottom-left\"\r\n      })}\r\n      \r\n    </React.Fragment>\r\n  )\r\n}","import React, { useContext } from 'react'\r\nimport { connect, useDispatch } from 'react-redux'\r\nimport AppContext from '../../AppContext'\r\nimport MapControlsBottomLeftComponent from '../components/MapControlsBottomLeft'\r\nimport { mapStateToProps } from '../utils'\r\n\r\nfunction MapControlsBottomLeft(props) {\r\n\r\n  const { core, mainMap } = useContext(AppContext);\r\n  const dispatch = useDispatch();\r\n  const { viewer } = props;\r\n  \r\n  return (\r\n    <MapControlsBottomLeftComponent\r\n      core={core}\r\n      mainMap={mainMap}\r\n      dispatch={dispatch}\r\n      viewer={viewer}\r\n    />\r\n  )\r\n}\r\n\r\nexport default connect(state => {\r\n  const gstate = mapStateToProps(state);\r\n  return ({\r\n    viewer: gstate.viewer,\r\n    components: gstate.components,\r\n    auth: gstate.auth\r\n  });\r\n})(MapControlsBottomLeft);","import React from 'react'\r\n\r\nexport default function MapControlsBottomRight(props) {\r\n\r\n  const { core, viewer, dispatch, mainMap } = props;\r\n\r\n  return (\r\n    <React.Fragment>\r\n\r\n      { core.renderComponents({\r\n        region: 'map_controls_bottom_right',\r\n        props: { viewer, dispatch, mainMap },\r\n        className: \"map-region-bottom-right\"\r\n      })}\r\n      \r\n    </React.Fragment>\r\n  )\r\n}","import React, { useContext } from 'react'\r\nimport { connect, useDispatch } from 'react-redux'\r\nimport AppContext from '../../AppContext'\r\nimport MapControlsBottomRightComponent from '../components/MapControlsBottomRight'\r\nimport { mapStateToProps } from '../utils'\r\n\r\nfunction MapControlsBottomRight(props) {\r\n\r\n  const { core, mainMap } = useContext(AppContext);\r\n  const dispatch = useDispatch();\r\n  const { viewer } = props;\r\n  \r\n  return (\r\n    <MapControlsBottomRightComponent\r\n      core={core}\r\n      mainMap={mainMap}\r\n      dispatch={dispatch}\r\n      viewer={viewer}\r\n    />\r\n  )\r\n}\r\n\r\nexport default connect(state => {\r\n  const gstate = mapStateToProps(state);\r\n  return ({\r\n    viewer: gstate.viewer,\r\n    components: gstate.components,\r\n    auth: gstate.auth\r\n  });\r\n})(MapControlsBottomRight);","import React, { useEffect, useState, useRef } from 'react'\r\nimport VectorLayer from 'ol/layer/Vector'\r\nimport { Vector } from 'ol/source';\r\nimport OlVectorTileLayer from \"ol/layer/VectorTile\";\r\nimport OlGroup from \"ol/layer/Group\";\r\nimport OlSourceTileWMS from 'ol/source/TileWMS';\r\nimport OlSourceImageWMS from 'ol/source/ImageWMS';\r\nimport OlSourceWMTS from 'ol/source/WMTS';\r\nimport OlSourceTileArcGISRest from 'ol/source/TileArcGISRest';\r\nimport OlSourceImageArcGISRest from 'ol/source/ImageArcGISRest';\r\nimport OlFormatGeoJSON from \"ol/format/GeoJSON\";\r\nimport OlFormatGML from \"ol/format/GML\";\r\nimport OlFormatGML2 from \"ol/format/GML2\";\r\nimport OlFormatGML3 from \"ol/format/GML3\";\r\nimport OlFormatEsriJSON from 'ol/format/EsriJSON';\r\nimport OlFeature from 'ol/Feature'\r\nimport OlCollection from 'ol/Collection'\r\nimport WMSGetFeatureInfo from 'ol/format/WMSGetFeatureInfo';\r\nimport { transform, transformExtent } from 'ol/proj'\r\nimport { Fill, Stroke, Style, Circle } from 'ol/style'\r\nimport { v4 as uuidV4 } from 'uuid'\r\nimport xml2js from 'xml2js'\r\nimport { isUrlAppOrigin, findOlLayer } from '../utils';\r\nimport { serializeFeatures, deserializeFeatures } from '../model/MapModel';\r\n\r\nconst selectionLayerStyle = new Style({\r\n  image: new Circle({\r\n    radius: 4,\r\n    fill: new Fill({\r\n    color: '#FF0000',\r\n    }),\r\n    stroke: new Stroke({\r\n    color: '#fff',\r\n    width: 2,\r\n    }),\r\n  }),\r\n  stroke: new Stroke({\r\n    color: '#ff0000',\r\n    width: 3,\r\n  })  \r\n});\r\n\r\nexport default function FeatureInfo({ core, config, actions }) {\r\n\r\n  const { viewer, mainMap, dispatch } = config;\r\n  const { featureinfo } = viewer;\r\n  const feature_info_control = viewer.config_json.map_controls.find(c => c.id === 'FeatureInfo');\r\n  const feature_info_component = viewer.config_json.components.find(c => c.config_json && \r\n                c.config_json.map_control === 'FeatureInfo');\r\n  const layers = viewer.config_json.layers;\r\n\r\n  const [search, setSearch] = useState(null);\r\n\r\n  const selectionLayer = useRef();\r\n\r\n  const utils = new FeatureInfoUtils(core);\r\n  \r\n  function selectSingleClick(e) {\r\n    setSearch({ coords: e.coordinate, pixel: e.pixel });\r\n    feature_info_component && dispatch(actions.viewer_set_selectedmenu(feature_info_component.id));    \r\n  }\r\n\r\n  function searchAll(coordinate, pixel) {\r\n\r\n    const acc = [];\r\n    let features = [];\r\n\r\n    // Display vector feature\r\n    const displayFeature = (feature, l) => {\r\n      if ((typeof feature === 'object')) {\r\n        if ((feature instanceof OlFeature)) {\r\n          return {\r\n            id: uuidV4(),\r\n            type: 'ol',\r\n            data: serializeFeatures([feature]),\r\n            layer: l ? l.get('title') : '',\r\n            feature_tpl: l.get('feature_tpl') ? l.get('feature_tpl') : null\r\n          };\r\n        } else {\r\n          let data = {};\r\n          Object.keys(feature)\r\n            .filter(k => typeof feature[k] !== 'object')\r\n            .forEach(k => data[k] = feature[k]);\r\n          return { id: uuidV4(), type: 'object', data, layer: l ? l.get('title') : '' };\r\n        }\r\n      }\r\n    }\r\n\r\n    //List o vector tile features for remote query\r\n    let fvt_remote = [];\r\n\r\n    const layers_selected = [];\r\n\r\n    // Find vector features strategy\r\n    mainMap.forEachFeatureAtPixel(pixel, (f, l) => {\r\n      if (!l) return;\r\n      if (l == selectionLayer.current) return;\r\n      if (l.get('selectable') == false) return;\r\n      if (l instanceof OlVectorTileLayer) {\r\n        let fvt = new OlFeature();\r\n        let props = f.getProperties();\r\n        Object.keys(props).forEach(k => {\r\n          fvt.set(k, props[k]);;\r\n        });\r\n        if (props.id) fvt.setId(props.id)        \r\n        if (l.get(\"datasource\") && l.get(\"datasource\").cql_fields && l.get(\"datasource\").cql_filter) {\r\n          if (l.get(\"datasource\").allow_multi === false) {\r\n            if (!layers_selected.includes(l.get('id'))) {\r\n              fvt_remote.push({ feature: fvt, layer: l });\r\n              layers_selected.push(l.get('id'));\r\n            }\r\n          } else {\r\n            fvt_remote.push({ feature: fvt, layer: l });\r\n          }\r\n        } else {\r\n          features.push({ feature: fvt, layer: l });\r\n        }\r\n      } else {\r\n        features.push({ feature: f, layer: l });\r\n      }\r\n      //return true;\r\n    });\r\n\r\n    // Found vector features\r\n    if (features.length) {\r\n      //const acc = featureinfo;\r\n      features.forEach(fl => {\r\n        acc.push(displayFeature(fl.feature, fl.layer));\r\n        dispatch(actions.viewer_set_featureinfo(acc));\r\n      });\r\n    }\r\n\r\n    //Get info for VectorTile features\r\n    fvt_remote.forEach(item => {\r\n      let nativeCRS = item.layer.get(\"datasource\").crs || 'EPSG:4326';\r\n      let filter = item.layer.get(\"datasource\").cql_filter;\r\n      let fields = item.layer.get(\"datasource\").cql_fields;\r\n      fields.forEach((f, index) => {\r\n        //replace based on field names\r\n        filter = filter.replaceAll('{' + f + '}', item.feature.get(f));\r\n        //replace based on field index\r\n        filter = filter.replaceAll('{' + index + '}', item.feature.get(f));\r\n      });\r\n      //replace based on XY coordinates\r\n      const coords = transform(coordinate, mainMap.getView().getProjection().getCode(), nativeCRS);\r\n      filter = filter.replaceAll('{X}', coords[0]);\r\n      filter = filter.replaceAll('{Y}', coords[1]);\r\n\r\n      utils.getWFSFeaturesFilterByGeom(\r\n        item.layer.get(\"datasource\").url, \r\n        item.layer.get(\"datasource\").typeNames,\r\n        nativeCRS,\r\n        50,\r\n        null,\r\n        filter\r\n      )\r\n      .then(res => res.json())\r\n      .then(json => {\r\n\r\n        // Parse JSON feature\r\n        const parser = new OlFormatGeoJSON();\r\n        const parseOptions = {\r\n          dataProjection: nativeCRS,\r\n          featureProjection: mapCRS\r\n        };\r\n        const features = parser.readFeatures(json, parseOptions);\r\n        if (!features) return;\r\n\r\n        // Add results\r\n        features.forEach(feat => {\r\n          acc.push(displayFeature(feat, item.layer));\r\n        });\r\n        dispatch(actions.viewer_set_featureinfo(acc));          \r\n      })\r\n      .catch(err => console.log(err));\r\n    });\r\n      \r\n    // Find features from WMS layers strategy\r\n    const viewResolution = (mainMap.getView().getResolution());\r\n    const mapCRS = mainMap.getView().getProjection().getCode();\r\n    const lrs = utils.findActiveWMSLayer(mainMap.getLayers());\r\n    lrs.forEach(l => {\r\n      if (l.get('selectable') === false) return;\r\n\r\n      // Get features using datasource\r\n      if (l.get(\"datasource\")) {\r\n        let buffer = 2;\r\n        let nativeCRS = l.get(\"datasource\").crs || 'EPSG:4326';\r\n        let bbox = [coordinate[0]-buffer, coordinate[1]-buffer, coordinate[0]+buffer, coordinate[1]+buffer];\r\n        const nativeBBOX = transformExtent(bbox, mapCRS, nativeCRS);\r\n        utils.getWFSFeaturesFilterByGeom(\r\n          l.get(\"datasource\").url, \r\n          l.get(\"datasource\").typeNames,\r\n          nativeCRS,\r\n          50,\r\n          nativeBBOX\r\n          //\"CONTAINS(\" + l.get(\"datasource\").geomName + \",POINT(\" + coordinate.join(\" \") + \"))\"\r\n        )\r\n        .then(res => res.json())\r\n        .then(json => {\r\n\r\n          // Parse JSON feature\r\n          const parser = new OlFormatGeoJSON();\r\n          const parseOptions = {\r\n            dataProjection: nativeCRS,\r\n            featureProjection: mapCRS\r\n          };\r\n          const features = parser.readFeatures(json, parseOptions);\r\n          if (!features) return;\r\n\r\n          // Add results\r\n          features.forEach(feat => {\r\n            acc.push(displayFeature(feat, l));\r\n          });\r\n          dispatch(actions.viewer_set_featureinfo(acc));          \r\n        })\r\n        .catch(err => console.log(err));\r\n\r\n      // Get features using any other strategy\r\n      } else {\r\n        utils.parseFeatureInfo(mainMap, l, viewResolution, coordinate, mapCRS, (result) => {\r\n          const format = l.getProperties().get_feature_info_format || 'application/json';\r\n          if (!result) acc.push({ id: uuidV4(), type: 'error', format });\r\n          if (typeof result === 'object') {\r\n            if (Array.isArray(result)) {\r\n              result.forEach(feat => {\r\n                acc.push(displayFeature(feat, l));\r\n              });\r\n            } else {\r\n              acc.push(displayFeature(result, l));\r\n            }          \r\n          } else {\r\n           acc.push({id: uuidV4(), type: 'text', data: result, layer: l.get('title') || 'teste'});\r\n          }\r\n          dispatch(actions.viewer_set_featureinfo(acc));\r\n        });\r\n      }\r\n    });\r\n\r\n    // Find features from ArcGIS layers strategy\r\n    const aglrs = utils.findActiveArcGISMapLayer(mainMap.getLayers());;\r\n    aglrs.forEach(l => {\r\n      if (l.get('selectable') === false) return;\r\n\r\n      // Get features using datasource\r\n      if (l.get(\"datasource\")) {\r\n      /*\r\n        let buffer = 2;\r\n        let nativeCRS = l.get(\"datasource\").crs || 'EPSG:4326';\r\n        let bbox = [coordinate[0]-buffer, coordinate[1]-buffer, coordinate[0]+buffer, coordinate[1]+buffer];\r\n        const nativeBBOX = transformExtent(bbox, mapCRS, nativeCRS);\r\n        getWFSFeaturesFilterByGeom(\r\n          l.get(\"datasource\").url, \r\n          l.get(\"datasource\").typeNames,\r\n          nativeCRS,\r\n          50,\r\n          nativeBBOX\r\n          //\"CONTAINS(\" + l.get(\"datasource\").geomName + \",POINT(\" + coordinate.join(\" \") + \"))\"\r\n        )\r\n        .then(res => res.json())\r\n        .then(json => {\r\n\r\n          // Parse JSON feature\r\n          const parser = new OlFormatGeoJSON();\r\n          const parseOptions = {\r\n            dataProjection: nativeCRS,\r\n            featureProjection: mapCRS\r\n          };\r\n          const features = parser.readFeatures(json, parseOptions);\r\n          if (!features) return;\r\n\r\n          // Add results\r\n          features.forEach(feat => {\r\n            acc.push(displayFeature(feat, l));\r\n          });\r\n          dispatch(actions.viewer_set_featureinfo(acc));          \r\n        })\r\n        .catch(err => console.log(err));\r\n      // Get features using any other strategy\r\n      */      \r\n      } else {\r\n        utils.parseArcGISFeatureInfo(mainMap, l, viewResolution, coordinate, mapCRS, (result) => {\r\n          const format = l.getProperties().get_feature_info_format || 'application/json';\r\n          if (!result) acc.push({ id: uuidV4(), type: 'error', format });\r\n          if (typeof result === 'object') {\r\n            if (Array.isArray(result)) {\r\n              result.forEach(feat => {\r\n                acc.push(displayFeature(feat, l));\r\n              });\r\n            } else {\r\n              acc.push(displayFeature(result, l));\r\n            }          \r\n          } else {\r\n           acc.push({id: uuidV4(), type: 'text', data: result, layer: l.get('title') || 'teste'});\r\n          }\r\n          dispatch(actions.viewer_set_featureinfo(acc));\r\n        });\r\n      }\r\n    });    \r\n\r\n\r\n    // No layers found, disable GetFeatureInfo\r\n    //if (features.length === 0 && lrs.length === 0) {\r\n      if (features.length === 0 && fvt_remote.length === 0) {\r\n      let emptyResults = [{\r\n        id: uuidV4(),\r\n        type: 'text',\r\n        data: '<p>Não foram encontrados resultados</p>'\r\n      }];\r\n      dispatch(actions.viewer_set_featureinfo(emptyResults));\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (!feature_info_control) return;\r\n    if (feature_info_control.active) mainMap.on('singleclick', selectSingleClick);\r\n    else mainMap.un('singleclick', selectSingleClick);\r\n    return () => {\r\n      mainMap.un('singleclick', selectSingleClick);\r\n    }\r\n  }, [feature_info_control]);  \r\n\r\n  useEffect(() => {\r\n    if (search) searchAll(search.coords, search.pixel);\r\n  }, [search]);\r\n\r\n  // Add highlight layer\r\n  useEffect(() => {\r\n    if (!mainMap) return;\r\n\r\n    selectionLayer.current = new VectorLayer({\r\n      id: 'featureinfo',\r\n      renderMode: 'vector',\r\n      source: new Vector({}),\r\n      style: selectionLayerStyle,\r\n      selectable: false\r\n    });\r\n\r\n    //const parentLayer = findOlLayer(mainMap, 'overlays');\r\n\r\n    mainMap.addLayer(selectionLayer.current); \r\n    /*\r\n    if (parentLayer) {\r\n      parentLayer.getLayers().getArray().push(selectionLayer.current);\r\n    } else {\r\n      mainMap.addLayer(selectionLayer.current); \r\n    }\r\n    */\r\n\r\n\r\n\r\n    /*\r\n    setTimeout(() => {\r\n      //Add theme\r\n      dispatch(actions.viewer_add_themes(\r\n          \"overlays\",\r\n          [\r\n              {\r\n                id: \"featureinfo\",\r\n                title: 'Elementos Selecionados',\r\n                description: \"Elementos Selecionados\",\r\n                active: true,\r\n                open: false,\r\n                type: \"VECTOR\",\r\n                opacity: 1\r\n              }\r\n          ]\r\n      ));\r\n      \r\n      setTimeout(() => {\r\n          selectionLayer.current = findOlLayer(mainMap, 'featureinfo');\r\n          selectionLayer.current.setStyle(selectionLayerStyle);          \r\n\r\n          // Turn layer on\r\n          dispatch(actions.layers_set_checked([ ...viewer.config_json.checked, 'featureinfo']));\r\n      }, 500);\r\n\r\n    }, 1000);\r\n    */\r\n\r\n  }, [mainMap]); \r\n\r\n  /*\r\n  useEffect(() => {\r\n    if (!mainMap) return;\r\n    if (selectionLayer) return;\r\n\r\n    // Find selection layer\r\n    selectionLayer = findOlLayer(mainMap, 'featureinfo');\r\n    console.log('find featureinfo layer', selectionLayer);\r\n    if (selectionLayer) {\r\n      selectionLayer.setStyle(selectionLayerStyle);\r\n    }    \r\n  }, [layers]);\r\n  */\r\n\r\n  // Highlight features\r\n  useEffect(() => {\r\n    if (!selectionLayer.current) return;\r\n\r\n    selectionLayer.current.getSource().clear();\r\n    let features;\r\n    featureinfo.forEach(feat => {\r\n      if (feat.type === 'ol') {\r\n        features = deserializeFeatures(feat.data);\r\n        features = features instanceof OlCollection ? features.getArray() : features;\r\n        //features.forEach(f => f.setStyle([selectionLayerStyle]));\r\n        selectionLayer.current.getSource().addFeatures(features);\r\n      }      \r\n    });\r\n\r\n    return () => {\r\n      selectionLayer.current.getSource().clear();\r\n    }\r\n  }, [featureinfo]);\r\n\r\n  return null\r\n}\r\n\r\n\r\nclass FeatureInfoUtils  {\r\n  constructor(core) {\r\n    this.core = core;\r\n  }\r\n\r\n  /**\r\n   * TODO: add description\r\n   *\r\n   * @param {String} serviceUrl Url of wfs service to query\r\n   */\r\n  getWFSFeaturesFilterByGeom(serviceUrl, typeNames, srsName, count, bbox, cql_filter) {\r\n    let params = [\r\n      \"SERVICE=wfs\",\r\n      \"REQUEST=GetFeature\",\r\n      \"VERSION=1.1.0\",\r\n      \"typeNames=\" + typeNames,\r\n      \"srsName=\" + srsName,\r\n      \"outputFormat=application/json\",\r\n      \"COUNT=\" + (count || 50),\r\n    ];\r\n\r\n    // Add bbox\r\n    if (bbox) params.push(\"bbox=\" + bbox.join(\",\"));\r\n\r\n    // Add CQL_FILTER\r\n    if (cql_filter) params.push(\"cql_filter=\" + cql_filter)\r\n    \r\n    // Build final URL\r\n    let url = serviceUrl + params.join('&');\r\n\r\n    // Use map proxy\r\n    if (!isUrlAppOrigin(url)) {\r\n      url = this.core.MAP_PROXY_URL + encodeURIComponent(url);\r\n    };\r\n\r\n    // Set headers\r\n    let headers = {\r\n      \"accept\": \"application/json, text/javascript, */*; q=0.01\",\r\n      \"accept-language\": \"pt-PT,pt;q=0.9,en-US;q=0.8,en;q=0.7,es;q=0.6\",\r\n      \"cache-control\": \"no-cache\",\r\n      \"pragma\": \"no-cache\",\r\n      \"sec-fetch-dest\": \"empty\",\r\n      \"sec-fetch-mode\": \"cors\",\r\n      \"sec-fetch-site\": \"same-origin\",\r\n      \"x-requested-with\": \"XMLHttpRequest\"\r\n    };\r\n\r\n    // Set request options\r\n    const options = {\r\n      //\"headers\": headers,\r\n      //\"referrer\": \"\",\r\n      //\"referrerPolicy\": \"strict-origin-when-cross-origin\",\r\n      \"body\": null,\r\n      \"method\": \"GET\",\r\n      //\"mode\": \"cors\",\r\n      //\"credentials\": \"include\"\r\n    };\r\n\r\n    // return request\r\n    return fetch(url, options);\r\n  }\r\n\r\n  getFeatureInfoGeoJSON(map, l, viewResolution, coordinate, crs, requestBuilder, resolve, reject) {\r\n    let url = requestBuilder.call(this, map, l, viewResolution, coordinate, crs, 'application/geojson');\r\n    fetch(url)\r\n    .then(res => res.json())\r\n    .then(geojson => {\r\n  \r\n      // Parse JSON feature\r\n      const parser = new OlFormatGeoJSON();\r\n      let data_crs = crs;\r\n      if (geojson.crs && geojson.crs.properties && geojson.crs.properties.name) {\r\n        if (geojson.crs.properties.name.indexOf('EPSG::4326') != -1) {\r\n          data_crs = 'EPSG:4326';\r\n        } else if (geojson.crs.properties.name.indexOf('CRS::84') != -1) {\r\n          data_crs = 'EPSG:4326';\r\n        }\r\n      }    \r\n      const parseOptions = {\r\n        dataProjection: crs,\r\n        featureProjection: crs\r\n      };\r\n      const features = parser.readFeatures(geojson, parseOptions);\r\n  \r\n      // Found GeoJSON features\r\n      if (features.length) resolve(features);\r\n      else reject();\r\n    })\r\n    .catch(err => {\r\n      console.log('getFeatureInfoGeoJSON error', err);\r\n      reject();\r\n    })\r\n  }\r\n  \r\n  getFeatureInfoJSON(map, l, viewResolution, coordinate, crs, requestBuilder, resolve, reject) {\r\n    let url = requestBuilder.call(this, map, l, viewResolution, coordinate, crs, 'application/json'); \r\n    fetch(url)\r\n    .then(res => res.json())\r\n    .then(json => {\r\n  \r\n      // Parse JSON feature\r\n      const parser = new OlFormatGeoJSON();\r\n      let data_crs = crs;\r\n      if (json.crs && json.crs.properties && json.crs.properties.name) {\r\n        if (json.crs.properties.name.indexOf('EPSG::4326') !== -1) {\r\n          data_crs = 'EPSG:4326';\r\n        } else if (json.crs.properties.name.indexOf('CRS::84') !== -1) {\r\n          data_crs = 'EPSG:4326';\r\n        }\r\n      }\r\n      const parseOptions = {\r\n        dataProjection: data_crs,\r\n        featureProjection: crs\r\n      };\r\n      const features = parser.readFeatures(json, parseOptions);\r\n  \r\n      // Found GeoJSON features\r\n      if (features.length) resolve(features);\r\n      else reject();\r\n    })\r\n    .catch(err => {\r\n      reject();\r\n    })\r\n  }\r\n  \r\n  getFeatureInfoXML(map, l, viewResolution, coordinate, crs, requestBuilder, resolve, reject) {\r\n    let url = requestBuilder.call(this, map, l, viewResolution, coordinate, crs, 'text/xml');  \r\n    fetch(url)\r\n    .then(res => res.text())\r\n    .then(xml => {\r\n  \r\n      // Found features\r\n      let features = [];\r\n  \r\n      // Try GML format (in some services)\r\n      let parser = new OlFormatGML();\r\n      let parseOptions = {\r\n        dataProjection: crs,\r\n        featureProjection: crs\r\n      };\r\n      let gmlFeatures = parser.readFeatures(xml, parseOptions);\r\n      if (gmlFeatures && gmlFeatures.length) return resolve(gmlFeatures[0]);\r\n  \r\n      // Load raw XML with field \"FeatureInfoResponse\"\r\n      xml2js.parseString(xml, (err, res) => {\r\n        if (err) return reject();\r\n  \r\n        // Parse XML\r\n        if (res['FeatureInfoResponse']) {\r\n          res['FeatureInfoResponse']['FIELDS'].forEach(f => {\r\n            features.push(f['$']);\r\n          });\r\n        }\r\n  \r\n        // Found XML features\r\n        if (features.length) resolve(features);\r\n        else reject();\r\n      });\r\n    })\r\n    .catch(err => {\r\n      reject();\r\n    });\r\n  }\r\n  \r\n  getFeatureInfoGML(map, l, viewResolution, coordinate, crs, format, requestBuilder, resolve, reject) {\r\n    let layerProps = l.getProperties();\r\n    let url = requestBuilder.call(this, map, l, viewResolution, coordinate, crs, format || 'application/vnd.ogc.gml');\r\n    fetch(url)\r\n    .then(res => res.text())\r\n    .then(gmlt => {\r\n  \r\n      //TODO: Add logic to identify geometry field name (assuming 'geometry')\r\n      let gml = gmlt.replace('the_geom', 'geometry');\r\n      gml = gml.replace('the_geom', 'geometry');\r\n      gml = gml.replace('st_union', 'geometry');\r\n      gml = gml.replace('st_union', 'geometry');\r\n  \r\n      let features = [];\r\n      // Parse GML feature\r\n      let parser = new OlFormatGML();\r\n      let parseOptions = {\r\n        dataProjection: crs,\r\n        featureProjection: crs\r\n      };\r\n      try {\r\n        features = parser.readFeatures(gml, parseOptions);\r\n      } catch (e) {\r\n        //console.log(e);\r\n      }\r\n  \r\n      // Try parse with GML v2\r\n      if (!features.length) {\r\n        parser = new OlFormatGML2();\r\n        parseOptions = {\r\n          dataProjection: crs,\r\n          featureProjection: crs\r\n        };\r\n        try {\r\n          features = parser.readFeatures(gml, parseOptions);\r\n        } catch (e) {\r\n          //console.log(e);\r\n        }\r\n      }\r\n  \r\n      // Try parse with GML v3\r\n      if (!features.length) {\r\n        parser = new OlFormatGML3();\r\n        parseOptions = {\r\n          dataProjection: crs,\r\n          featureProjection: crs,\r\n          featureType: layerProps.layers\r\n        };\r\n        try {\r\n          features = parser.readFeatures(gml, parseOptions);\r\n        } catch (e) {\r\n          //console.log(e);\r\n        }\r\n      }\r\n  \r\n      // Try parse with WMSGetFeatureInfo\r\n      if (!features.length) {\r\n        parseOptions = {\r\n          dataProjection: crs,\r\n          featureProjection: crs\r\n        };      \r\n        try {\r\n          features = new WMSGetFeatureInfo().readFeatures(gml, parseOptions);\r\n        } catch (e) {\r\n          //console.log(e);\r\n        }\r\n      }   \r\n  \r\n      // Found GML features\r\n      if (features.length) resolve(features);\r\n      else reject();\r\n    })\r\n    .catch(err => {\r\n      reject();\r\n    });\r\n  }\r\n  \r\n  getFeatureInfoHtml(map, l, viewResolution, coordinate, crs, requestBuilder, resolve, reject) {\r\n    let url = requestBuilder.call(this, map, l, viewResolution, coordinate, crs, 'text/html');  \r\n    fetch(url)\r\n    .then(res => res.text())\r\n    .then(text => {\r\n      resolve(text);\r\n    })\r\n    .catch(err => {\r\n      reject();\r\n    });\r\n  }\r\n  \r\n  getFeatureInfoText(map, l, viewResolution, coordinate, crs, requestBuilder, resolve, reject) {\r\n    let url = requestBuilder.call(this, map, l, viewResolution, coordinate, crs, 'text/plain');\r\n    fetch(url)\r\n    .then(res => res.text())\r\n    .then(text => {\r\n      resolve(text);\r\n    })\r\n    .catch(err => {\r\n      reject();\r\n    });\r\n  }\r\n  \r\n  getFeatureInfoEsriJSON(map, l, viewResolution, coordinate, crs, requestBuilder, resolve, reject) {\r\n    let url = requestBuilder.call(this, map, l, viewResolution, coordinate, crs, 'application/json'); \r\n    fetch(url)\r\n    .then(res => res.json())\r\n    .then(json => {\r\n      const parser = new OlFormatEsriJSON();\r\n      let data_crs = 'EPSG:4326' //crs;\r\n      /*\r\n      if (json.crs && json.crs.properties && json.crs.properties.name) {\r\n        if (json.crs.properties.name.indexOf('EPSG::4326') !== -1) {\r\n          data_crs = 'EPSG:4326';\r\n        } else if (json.crs.properties.name.indexOf('CRS::84') !== -1) {\r\n          data_crs = 'EPSG:4326';\r\n        }\r\n      }\r\n      */   \r\n      const parseOptions = {\r\n        dataProjection: data_crs,\r\n        featureProjection: crs\r\n      };\r\n  \r\n      let results = json.results || [];\r\n  \r\n      if (l.get('layerId') || l.get('layerName')) {\r\n        results = results.filter(r => {\r\n          const val = (l.get('layerId') || []).includes(r.layerId);\r\n          if (val) return true;\r\n          return (l.get('layerName') || []).includes(r.layerName);\r\n        });\r\n      }\r\n      const features = results.map(r => {\r\n        const ft = parser.readFeatures(r, parseOptions);\r\n        return ft[0];\r\n      });  \r\n      // Found EsriJSON features\r\n      if (features.length) resolve(features);\r\n      else reject();\r\n    })\r\n    .catch(err => {\r\n      reject();\r\n    })\r\n  }\r\n  \r\n  async parseFeatureInfo (map, l, viewResolution, coordinate, crs, cb) {\r\n    const callFormat = (format) => {\r\n      return new Promise((resolve, reject) => {\r\n        let requestBuilder = this.buildFeatureInfoWMSUrl;\r\n        if (l.getSource() instanceof OlSourceWMTS) requestBuilder = this.buildFeatureInfoWMTSUrl;\r\n        if (l.get('type') === 'WMTSXYZ') requestBuilder = this.buildFeatureInfoWMTSXYZUrl;\r\n  \r\n        if (/gml/ig.test(format)) {\r\n          this.getFeatureInfoGML(map, l, viewResolution, coordinate, crs, format, requestBuilder, resolve, reject);\r\n        } else if (/xml/ig.test(format)) {\r\n          this.getFeatureInfoXML(map, l, viewResolution, coordinate, crs, requestBuilder, resolve, reject);\r\n        }\r\n        else if (/geojson/ig.test(format)) {\r\n          this.getFeatureInfoGeoJSON(map, l, viewResolution, coordinate, crs, requestBuilder, resolve, reject);\r\n        }\r\n        else if (/json/ig.test(format)) {\r\n          this.getFeatureInfoJSON(map, l, viewResolution, coordinate, crs, requestBuilder, resolve, reject);\r\n        }\r\n        else if (/html/ig.test(format)) {\r\n          this.getFeatureInfoHtml(map, l, viewResolution, coordinate, crs, requestBuilder, resolve, reject);\r\n        }\r\n        else if (/plain/ig.test(format)) {\r\n          this.getFeatureInfoText(map, l, viewResolution, coordinate, crs, requestBuilder, resolve, reject);\r\n        }\r\n        else reject();\r\n      });\r\n    }\r\n  \r\n    // Start request\r\n    const layerProps = l.getProperties();\r\n    const format = layerProps.get_feature_info_format || 'application/json';\r\n    callFormat(format)\r\n    .then(result => {\r\n      cb(result);\r\n    })\r\n    .catch(err => {\r\n      cb(false);\r\n    });\r\n  }\r\n  \r\n  async parseArcGISFeatureInfo (map, l, viewResolution, coordinate, crs, cb) {\r\n    const callFormat = (format) => {\r\n      return new Promise((resolve, reject) => {\r\n        //let requestBuilder = l.getSource() instanceof OlSourceWMTS ? buildFeatureInfoWMTSUrl : buildFeatureInfoArcGISUrl;\r\n        let requestBuilder = this.buildFeatureInfoArcGISUrl;\r\n        if (/json/ig.test(format)) {\r\n          this.getFeatureInfoEsriJSON(map, l, viewResolution, coordinate, crs, requestBuilder, resolve, reject);\r\n        }\r\n        else reject();\r\n      });\r\n    }\r\n  \r\n    // Start request\r\n    const layerProps = l.getProperties();\r\n    const format = layerProps.get_feature_info_format || 'application/json';\r\n    callFormat(format)\r\n    .then(result => {\r\n      cb(result);\r\n    })\r\n    .catch(err => {\r\n      cb(false);\r\n    });\r\n  }\r\n  \r\n  findActiveWMSLayer(layers) {\r\n    let result = [];\r\n    layers.forEach(l => {\r\n      if (l.getVisible() \r\n        && l.getSource \r\n        && (l.getSource() instanceof OlSourceTileWMS || l.getSource() instanceof OlSourceImageWMS || l.getSource() instanceof OlSourceWMTS)\r\n      ) {\r\n        result.push(l);\r\n      }\r\n  \r\n      if (l.getVisible()\r\n        && l.get(\"type\") === \"WMTSXYZ\"\r\n      ) {\r\n        result.push(l);\r\n      }\r\n  \r\n      if ((l instanceof OlGroup) && l.getVisible()) {\r\n        let temp = this.findActiveWMSLayer(l.getLayers());\r\n        temp.forEach(t => result.push(t));\r\n      }\r\n    });\r\n    return result;\r\n  }\r\n  \r\n  buildFeatureInfoWMSUrl(map, layer, viewResolution, coordinate, crs, format) {  \r\n    let url = layer.getSource().getFeatureInfoUrl(\r\n      coordinate,\r\n      viewResolution,\r\n      crs,\r\n      //TODO: Add option to set FEATURE_COUNT by config\r\n      { 'INFO_FORMAT': format, 'FEATURE_COUNT': 10 }\r\n    );\r\n    if (!isUrlAppOrigin(url)) {\r\n      url = this.core.MAP_PROXY_URL + encodeURIComponent(url);\r\n    }\r\n    return url;\r\n  }\r\n  \r\n  buildFeatureInfoWMTSUrl(map, layer, viewResolution, coordinate, crs, format) {\r\n  \r\n    const source = layer.getSource();\r\n    const tilegrid = source.getTileGrid();\r\n    const tileResolutions = tilegrid.getResolutions();\r\n    let zoomIdx, diff = Infinity;\r\n    let resolution;\r\n  \r\n    for (let i = 0; i < tileResolutions.length; i++) {\r\n        const tileResolution = tileResolutions[i];\r\n        const diffP = Math.abs(viewResolution-tileResolution);\r\n        if (diffP < diff) {\r\n            diff = diffP;\r\n            zoomIdx = i;\r\n            resolution =  tileResolution;\r\n        }\r\n        if (tileResolution < viewResolution) {\r\n          break;\r\n        }\r\n    }\r\n    const tileSize = tilegrid.getTileSize(zoomIdx);\r\n    const tileSizeX = Array.isArray(tileSize) ? tileSize[0] : tileSize;\r\n    const tileSizeY = Array.isArray(tileSize) ? tileSize[1] : tileSize;\r\n    const tileOrigin = tilegrid.getOrigin(zoomIdx);\r\n  \r\n    const fx = (coordinate[0] - tileOrigin[0]) / (resolution * tileSizeX);\r\n    const fy = (tileOrigin[1] - coordinate[1]) / (resolution * tileSizeY);  \r\n    const tileCol = Math.floor(fx);\r\n    const tileRow = Math.floor(fy);\r\n    const tileI = Math.floor((fx - tileCol) * tileSizeX);\r\n    const tileJ = Math.floor((fy - tileRow) * tileSizeY);\r\n    const matrixIds = tilegrid.getMatrixIds()[zoomIdx];\r\n    const matrixSet = source.getMatrixSet();\r\n  \r\n    let url = layer.get('get_feature_info_url');\r\n    if (url.indexOf('?') < 0) {\r\n      url += '?';\r\n    }\r\n  \r\n    url = url    \r\n      + 'SERVICE=WMTS&REQUEST=GetFeatureInfo'\r\n      + '&TILEMATRIXSET=' + matrixSet\r\n      + '&TILEMATRIX=' + matrixIds\r\n      + '&LAYER=' + layer.get('layer')\r\n      + '&STYLE=' + (layer.get('wmts_style') || '')\r\n      + '&INFOFORMAT=' +  format\r\n      + '&TileCol=' +  tileCol\r\n      + '&TileRow=' +  tileRow\r\n      + '&I=' +  tileI\r\n      + '&J=' +  tileJ;\r\n  \r\n  \r\n    if (!isUrlAppOrigin(url)) {\r\n      url = this.core.MAP_PROXY_URL + encodeURIComponent(url);\r\n    }\r\n  \r\n    return url;\r\n  }\r\n  \r\n  buildFeatureInfoWMTSXYZUrl(map, layer, viewResolution, coordinate, crs, format) { \r\n    const source = layer.getSource();\r\n    const tilegrid = source.getTileGrid();\r\n    const tileResolutions = tilegrid.getResolutions();\r\n    let zoomIdx, diff = Infinity;\r\n    let resolution;\r\n  \r\n    for (let i = 0; i < tileResolutions.length; i++) {\r\n        const tileResolution = tileResolutions[i];\r\n        const diffP = Math.abs(viewResolution-tileResolution);\r\n        if (diffP < diff) {\r\n            diff = diffP;\r\n            zoomIdx = i;\r\n            resolution =  tileResolution;\r\n        }\r\n        if (tileResolution < viewResolution) {\r\n          break;\r\n        }\r\n    }\r\n    const tileSize = tilegrid.getTileSize(zoomIdx);\r\n    const tileSizeX = Array.isArray(tileSize) ? tileSize[0] : tileSize;\r\n    const tileSizeY = Array.isArray(tileSize) ? tileSize[1] : tileSize;\r\n    const tileOrigin = tilegrid.getOrigin(zoomIdx);\r\n  \r\n    const fx = (coordinate[0] - tileOrigin[0]) / (resolution * tileSizeX);\r\n    const fy = (tileOrigin[1] - coordinate[1]) / (resolution * tileSizeY);  \r\n    const tileCol = Math.floor(fx);\r\n    const tileRow = Math.floor(fy);\r\n    const tileI = Math.floor((fx - tileCol) * tileSizeX);\r\n    const tileJ = Math.floor((fy - tileRow) * tileSizeY);\r\n  \r\n    let zIndex = ('0' + zoomIdx).slice(-2);\r\n    if (layer.get('zformat') === 'integer') {\r\n      zIndex = zoomIdx;\r\n    }\r\n  \r\n    const tileMatrixSet = layer.get('wmts_tilematrixset') || '';\r\n    const tileMatix = tileMatrixSet + ':' + zIndex;\r\n  \r\n    let url = layer.get('url');\r\n    if (layer.get('get_feature_info_url')) {\r\n      url = layer.get('get_feature_info_url');\r\n    }\r\n    if (url.indexOf('?') < 0) {\r\n      url += '?';\r\n    } \r\n  \r\n    url = url    \r\n      + 'SERVICE=WMTS&REQUEST=GetFeatureInfo'\r\n      + '&TILEMATRIXSET=' + tileMatrixSet\r\n      + '&TILEMATRIX=' + tileMatix\r\n      + '&LAYER=' + (layer.get('wmts_layer') || layer.get('layer') || '')\r\n      + '&STYLE=' + (layer.get('wmts_style') || '')\r\n      + '&INFOFORMAT=' +  format\r\n      + '&TileCol=' +  tileCol\r\n      + '&TileRow=' +  tileRow\r\n      + '&I=' +  tileI\r\n      + '&J=' +  tileJ;\r\n  \r\n    if (!isUrlAppOrigin(url) && layer.get('get_feature_info_proxy_request') !== false) {\r\n      url = this.core.MAP_PROXY_URL + encodeURIComponent(url);\r\n    }\r\n  \r\n    return url;\r\n  }\r\n  \r\n  buildFeatureInfoArcGISUrl(map, layer, viewResolution, coordinate, crs, format) {\r\n    \r\n    const geometryType = 'esriGeometryPoint';\r\n    const mapSize = map.getSize();\r\n    const mapExtent = transformExtent(map.getView().calculateExtent(mapSize), crs, 'EPSG:4326');\r\n  \r\n    let params = [\r\n      `geometry=${transform(coordinate, crs, 'EPSG:4326').join(',')}`,\r\n      `geometryType=${geometryType}`,\r\n      `layers=${layer.get('get_feature_info_layers') || 'visible'}`,\r\n      `sr=4326`,\r\n      `tolerance=${layer.get('get_feature_info_tolerance') || 1}`,\r\n      `mapExtent=${mapExtent.join(',')}`,\r\n      `imageDisplay=${mapSize.join(',')},96`,\r\n      `returnGeometry=true`,\r\n      `f=json`\r\n    ];\r\n  \r\n    let url = layer.getSource().getUrls ? layer.getSource().getUrls()[0] : layer.getSource().getUrl();\r\n    url = `${url}/identify?${params.join('&')}`;\r\n    if (!isUrlAppOrigin(url)) {\r\n      url = this.core.MAP_PROXY_URL + encodeURIComponent(url);\r\n    }\r\n    return url;\r\n  }\r\n  \r\n  findActiveArcGISMapLayer(layers) {\r\n    let result = [];\r\n    layers.forEach(l => {\r\n      if (l.getVisible() \r\n        && l.getSource \r\n        && (l.getSource() instanceof OlSourceTileArcGISRest || l.getSource() instanceof OlSourceImageArcGISRest)\r\n      ) {\r\n        result.push(l);\r\n      }\r\n      if ((l instanceof OlGroup) && l.getVisible()) {\r\n        let temp = this.findActiveArcGISMapLayer(l.getLayers());\r\n        temp.forEach(t => result.push(t));\r\n      }\r\n    });\r\n    return result;\r\n  }  \r\n\r\n}","import React, { useEffect, useState, useRef } from 'react'\r\nimport { transform } from 'ol/proj'\r\nimport 'ol/ol.css';\r\nimport VectorLayer from 'ol/layer/Vector'\r\nimport { Vector } from 'ol/source';\r\nimport {Circle as CircleStyle, Fill, Stroke, Style} from 'ol/style';\r\nimport Feature from 'ol/Feature';\r\nimport Point from 'ol/geom/Point';\r\nimport OLGroupLayer from \"ol/layer/Group\"\r\nimport { v4 as uuidV4 } from 'uuid'\r\nimport * as utils from '../utils';\r\nimport { getProjectionSrid } from '../model/MapModel';\r\n\r\nconst coordinatesStyle = new Style({\r\n  image: new CircleStyle({\r\n    radius: 4,\r\n    fill: new Fill({\r\n      color: '#fff',\r\n    }),\r\n    stroke: new Stroke({\r\n      color: '#FF0000',\r\n      width: 2,\r\n    }),\r\n  })\r\n});\r\nconst selectedCoordinatesStyle = new Style({\r\n  image: new CircleStyle({\r\n    radius: 6,\r\n    fill: new Fill({\r\n      color: '#FF0000',\r\n    }),\r\n    stroke: new Stroke({\r\n      color: '#fff',\r\n      width: 2,\r\n    }),\r\n  })\r\n});\r\n\r\n/**\r\n * Actions\r\n */\r\nexport const actions = {\r\n  coordinates_action1: () => console.log('Called coordinates_helper')\r\n}\r\n\r\nexport default function Coordinates({ core, config, actions }) {\r\n\r\n  const { viewer, mainMap, dispatch } = config;\r\n  const { coordinates } = viewer;\r\n  const [newCoord, setNewCoord] = useState(null);\r\n  const coordinates_control = viewer.config_json.map_controls.find(c => c.id === 'Coordinates');\r\n  const coordinates_component = viewer.config_json.components.find(c => c.config_json && \r\n              c.config_json.map_control === 'Coordinates');\r\n\r\n  const coordinatesLayer = useRef();\r\n\r\n\r\n  function transformCoordinates(x, y) {\r\n    const trans_coords = {};\r\n    viewer.config_json.crs_list.forEach(crs => {\r\n      const coords = transform([x, y],  mainMap.getView().getProjection(), crs.code);\r\n      trans_coords[crs.code] = { code: crs.code, title: crs.title, description: crs.description, \r\n        srid: crs.srid, precision: crs.precision, coordinates: coords }\r\n    });     \r\n    setNewCoord({ id: uuidV4(), coordinates: [x, y], crs: mainMap.getView().getProjection().getCode(), results: trans_coords });\r\n  }\r\n\r\n  function transformCoordinatesByApi(x, y) {\r\n    const url = core.API_URL + '/app/utils/transcoord';\r\n\r\n    const srid = getProjectionSrid(mainMap.getView().getProjection());\r\n\r\n    let options = {\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'Content-Type': 'application/json'        \r\n      },\r\n      method: 'POST',\r\n      body: JSON.stringify({ x: x, y: y, srid: srid})\r\n    }\r\n\r\n    fetch(url, options).then(res => {\r\n        return res.json();\r\n    }).then(result => {\r\n        if (result.results) {\r\n          const trans_coords = {};\r\n          viewer.config_json.crs_list.forEach(crs => {\r\n            let coords = [];\r\n            if (result.results[crs.code]) {\r\n              coords = [result.results[crs.code].x, result.results[crs.code].y];\r\n              trans_coords[crs.code] = { code: crs.code, title: crs.title, description: crs.description, \r\n                srid: crs.srid, precision: crs.precision, coordinates: coords }\r\n            }\r\n          });          \r\n          const new_coords = [x, y];\r\n          const item = { id: uuidV4(), coordinates: new_coords, crs: mainMap.getView().getProjection().getCode(), results: trans_coords };\r\n          setNewCoord(item);\r\n        }\r\n    })\r\n    .catch(error => {\r\n        console.log('error', error);\r\n    })\r\n  }              \r\n\r\n  function coordinatesSingleClick (e) {\r\n    //transformCoordinates(e.coordinate[0], e.coordinate[1]);\r\n    transformCoordinatesByApi(e.coordinate[0], e.coordinate[1]);\r\n  }\r\n\r\n  useEffect(() => {\r\n  }, []);\r\n\r\n  useEffect(() => {      \r\n    if (!coordinatesLayer.current) return;\r\n\r\n    coordinatesLayer.current.getSource().clear();\r\n\r\n    let index = 0;\r\n    coordinates.forEach((item) => {\r\n      const feature = new Feature();\r\n\r\n      //transform([geolocation.coordinates[0], geolocation.coordinates[1]], 'EPSG:4326', mainMap.getView().getProjection());\r\n      feature.setGeometry(new Point(item.coordinates));\r\n      if (index == 0) feature.setStyle(selectedCoordinatesStyle); \r\n      coordinatesLayer.current.getSource().addFeatures([feature]);\r\n      index += 1;\r\n    });\r\n  \r\n  }, [coordinates]);\r\n\r\n  useEffect(() => {      \r\n    if (newCoord) dispatch(actions.viewer_set_coordinates([newCoord, ...coordinates]));\r\n  }, [newCoord]);  \r\n\r\n  useEffect(() => {\r\n    if (!coordinates_control) return;\r\n    if (coordinates_control.active) mainMap.on('singleclick', coordinatesSingleClick);\r\n    else mainMap.un('singleclick', coordinatesSingleClick);\r\n\r\n    if (coordinates_control.active && !viewer.config_json.checked.includes('coordinates')) {\r\n      dispatch(actions.layers_set_checked([ ...viewer.config_json.checked, 'coordinates']));\r\n    }\r\n\r\n    return () => {\r\n      mainMap.un('singleclick', coordinatesSingleClick);\r\n    }\r\n  }, [coordinates_control]);  \r\n\r\n  // Add coordinates layer\r\n  useEffect(() => {\r\n    if (!mainMap) return;\r\n\r\n    coordinatesLayer.current = new VectorLayer({\r\n      id: 'coordinates',\r\n      renderMode: 'vector',\r\n      source: new Vector({}),\r\n      style: coordinatesStyle,\r\n      selectable: false\r\n    });\r\n\r\n    //const parentLayer = utils.findOlLayer(mainMap, 'overlays');\r\n\r\n    mainMap.addLayer(coordinatesLayer.current); \r\n    /*\r\n    if (parentLayer) {\r\n      parentLayer.getLayers().getArray().push(coordinatesLayer.current);\r\n    } else {\r\n      mainMap.addLayer(coordinatesLayer.current); \r\n    }\r\n    */\r\n\r\n      \r\n    /*\r\n    setTimeout(() => {\r\n\r\n      //Add theme\r\n      dispatch(actions.viewer_add_themes(\r\n          \"overlays\",\r\n          [\r\n              {\r\n              id: \"coordinates\",\r\n              title: \"Coordinates\",\r\n              description: \"Coordinates\",\r\n              active: true,\r\n              open: false,\r\n              type: \"VECTOR\",\r\n              opacity: 1\r\n              }\r\n          ]\r\n      ));   \r\n      \r\n      setTimeout(() => {       \r\n        coordinatesLayer.current = utils.findOlLayer(mainMap, 'coordinates');\r\n        coordinatesLayer.current.setStyle(coordinatesStyle);\r\n\r\n        // Turn layer on\r\n        dispatch(actions.layers_set_checked([ ...viewer.config_json.checked, 'coordinates']));        \r\n      }, 500);\r\n\r\n    }, 500);\r\n    */\r\n\r\n  }, [mainMap]);\r\n\r\n  return null;\r\n\r\n}","import React, { useEffect, useState, useRef } from 'react'\r\nimport { transform } from 'ol/proj'\r\nimport VectorLayer from 'ol/layer/Vector'\r\nimport { Vector } from 'ol/source';\r\nimport OLGeolocation from 'ol/Geolocation';\r\nimport 'ol/ol.css';\r\nimport {Circle as CircleStyle, Fill, Stroke, Style} from 'ol/style';\r\nimport Feature from 'ol/Feature';\r\nimport Point from 'ol/geom/Point';\r\nimport OLGroupLayer from \"ol/layer/Group\"\r\nimport * as utils from '../utils';\r\nimport { getProjectionSrid } from '../model/MapModel';\r\n\r\nconst locationStyle = new Style({\r\n    image: new CircleStyle({\r\n        radius: 6,\r\n        fill: new Fill({\r\n        color: '#3399CC',\r\n        }),\r\n        stroke: new Stroke({\r\n        color: '#fff',\r\n        width: 2,\r\n        }),\r\n    })\r\n});\r\n\r\nexport default function GeoLocation({ config, actions }) {\r\n\r\n    const { viewer, mainMap, dispatch } = config;\r\n    const { geolocation }  = viewer;\r\n    const geo_location_control = viewer.config_json.map_controls.find(c => c.id === 'GeoLocation');\r\n    const geo_location_component = viewer.config_json.components.find(c => c.config_json && \r\n                c.config_json.map_control === 'GeoLocation');\r\n    const [loaded, setLoaded] = useState(false);\r\n    const [olgeolocation, setOlgeolocation] = useState(null);\r\n\r\n    const locationLayer = useRef();\r\n\r\n\r\n    function getGeoLocation (cb) {\r\n        let coordinates = olgeolocation ? olgeolocation.getPosition() : null;\r\n        if (coordinates) {\r\n            const pos = {\r\n                coordinates: coordinates,\r\n                accuracy: olgeolocation.getAccuracy(), //[m]\r\n                altitude: olgeolocation.getAltitude(), //[m]\r\n                altitudeAccuracy: olgeolocation.getAltitudeAccuracy(), //[m]\r\n                heading: olgeolocation.getHeading(), //[rad]\r\n                speed: olgeolocation.getSpeed() //[m/s]\r\n            }\r\n            saveGeoLocation(pos);\r\n            if (cb) cb(pos);\r\n        } else {\r\n            window.navigator.geolocation.getCurrentPosition((position) => {\r\n                if (position.coords) {                    \r\n                    const pos = { \r\n                        coordinates: [position.coords.longitude, position.coords.latitude],\r\n                        accuracy: position.coords.accuracy,\r\n                        altitude: position.coords.altitude,\r\n                        altitudeAccuracy: position.coords.altitudeAccuracy,\r\n                        heading: position.coords.heading,\r\n                        speed: position.coords.speed\r\n                    }\r\n                    saveGeoLocation(pos);\r\n                    if (cb) cb(pos);\r\n                } else {\r\n                    saveGeoLocation({ error: { code: 0, message: 'Não foi possível obter localização.'} });\r\n                }\r\n            }, (error) => {\r\n                const pos = { \r\n                    error: {\r\n                        code: error.code || 0,\r\n                        message: error.message\r\n                    }\r\n                }\r\n                saveGeoLocation(pos);\r\n            });                   \r\n        }        \r\n    }\r\n\r\n    function saveGeoLocation(position) {\r\n        // Save GeoLocation\r\n        dispatch(actions.viewer_set_geolocation(position));\r\n    }\r\n\r\n    function zoomGeoLocation(position) {\r\n        // Zoom to extent        \r\n        if (position && position.coordinates) {\r\n            const coordinates = transform(position.coordinates, 'EPSG:4326', mainMap.getView().getProjection());\r\n            const extent = [coordinates[0] - 500, coordinates[1] - 500, \r\n                            coordinates[0] + 500, coordinates[1] + 500];\r\n            const srid = getProjectionSrid(mainMap.getView().getProjection()); \r\n            dispatch(actions.map_set_extent(coordinates, extent, srid));\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (!geo_location_control) return;\r\n        if (!olgeolocation) return;\r\n\r\n        olgeolocation.setTracking(geo_location_control.tracking);\r\n    },[geo_location_control.tracking]);\r\n\r\n    useEffect(() => {\r\n        if (!geo_location_control) return;\r\n        \r\n        if (!geo_location_control.active) {\r\n            olgeolocation && olgeolocation.setTracking(false);\r\n            dispatch(actions.viewer_set_geolocation(null));\r\n            return;\r\n        }\r\n\r\n        olgeolocation && olgeolocation.setTracking(!!geo_location_control.tracking);\r\n        if (loaded) {\r\n            if (!!geo_location_control.zoom) {\r\n                getGeoLocation(pos => zoomGeoLocation(pos));\r\n            } else {\r\n                getGeoLocation();\r\n            }\r\n        }\r\n        dispatch(actions.layers_set_checked([ ...viewer.config_json.checked, 'geolocation']));\r\n    }, [geo_location_control.active]);   \r\n\r\n\r\n    useEffect(() => {      \r\n        if (!locationLayer.current) return;\r\n\r\n        locationLayer.current.getSource().clear();\r\n\r\n        if (geo_location_control.active && geolocation && geolocation.coordinates) {\r\n            const positionFeature = new Feature();\r\n\r\n            const coordinates = transform([geolocation.coordinates[0], geolocation.coordinates[1]], 'EPSG:4326', mainMap.getView().getProjection());\r\n            positionFeature.setGeometry(new Point(coordinates));\r\n            locationLayer.current.getSource().addFeatures([positionFeature]);\r\n        }               \r\n    }, [geolocation]);        \r\n\r\n    // Add geolocation layer\r\n    useEffect(() => {\r\n        if (!mainMap) return;\r\n\r\n        locationLayer.current = new VectorLayer({\r\n            id: 'geolocation',\r\n            renderMode: 'vector',\r\n            source: new Vector({}),\r\n            style: locationStyle,\r\n            selectable: false\r\n          });\r\n      \r\n          //const parentLayer = utils.findOlLayer(mainMap, 'overlays');\r\n      \r\n          mainMap.addLayer(locationLayer.current); \r\n          /*\r\n          if (parentLayer) {\r\n            parentLayer.getLayers().getArray().push(locationLayer.current);\r\n          } else {\r\n            mainMap.addLayer(locationLayer.current); \r\n          }\r\n          */        \r\n\r\n         setLoaded(true);\r\n         \r\n         if (geo_location_control.active) {\r\n             if (!!geo_location_control.zoom_init) {\r\n                 getGeoLocation(pos => zoomGeoLocation(pos));\r\n             } else {\r\n                 getGeoLocation();\r\n             }\r\n         }\r\n\r\n\r\n        /*\r\n        setTimeout(() => {\r\n\r\n            //Add theme\r\n            dispatch(actions.viewer_add_themes(\r\n                \"overlays\",\r\n                [\r\n                    {\r\n                    id: \"geolocation\",\r\n                    title: 'GeoLocation',\r\n                    description: \"GeoLocation\",\r\n                    active: true,\r\n                    open: false,\r\n                    type: \"VECTOR\",\r\n                    opacity: 1\r\n                    }\r\n                ]\r\n            ));\r\n            // Turn layer on\r\n            dispatch(actions.layers_set_checked([ ...viewer.config_json.checked, 'geolocation']));\r\n\r\n            setTimeout(() => {\r\n                setLoaded(true);\r\n\r\n                locationLayer = utils.findOlLayer(mainMap, 'geolocation');\r\n                locationLayer && locationLayer.setStyle(locationStyle);\r\n                \r\n                if (geo_location_control.active) {\r\n                    if (!!geo_location_control.zoom_init) {\r\n                        getGeoLocation(pos => zoomGeoLocation(pos));\r\n                    } else {\r\n                        getGeoLocation();\r\n                    }\r\n                }\r\n            }, 500);\r\n\r\n        }, 1000);\r\n        */\r\n\r\n        //Create and config Openlayers Geolocation (OLGeolocation)\r\n        const olgeolocation = new OLGeolocation({\r\n                // enableHighAccuracy must be set to true to have the heading value.\r\n                //trackingOptions: {\r\n                //    enableHighAccuracy: true,\r\n                //},\r\n                //projection: mainMap.getView().getProjection()\r\n            });\r\n\r\n            olgeolocation.on('change', function () {\r\n                const pos = {\r\n                    coordinates: olgeolocation.getPosition(),\r\n                    accuracy: olgeolocation.getAccuracy(), //[m]\r\n                    altitude: olgeolocation.getAltitude(), //[m]\r\n                    altitudeAccuracy: olgeolocation.getAltitudeAccuracy(), //[m]\r\n                    heading: olgeolocation.getHeading(), //[rad]\r\n                    speed: olgeolocation.getSpeed() //[m/s]\r\n                }\r\n                saveGeoLocation(pos, false);\r\n            });\r\n\r\n            olgeolocation.on('error', function (error) {\r\n                const pos = {\r\n                    error: {\r\n                        code: error.code,\r\n                        message: error.message,\r\n                        type: error.type\r\n                    }    \r\n                }\r\n                saveGeoLocation(pos, false);\r\n            });\r\n\r\n            setOlgeolocation(olgeolocation);\r\n\r\n    }, [mainMap]);  \r\n\r\n    return null\r\n}","import FeatureInfo from './FeatureInfo'\r\nimport Coordinates from './Coordinates'\r\nimport GeoLocation from './GeoLocation'\r\nimport Attribution from './Attribution'\r\n\r\n\r\nexport default {\r\n  FeatureInfo,\r\n  Coordinates,\r\n  GeoLocation,\r\n  Attribution\r\n}","import React, { useEffect, useState } from 'react';\r\nimport OLAttribution from 'ol/control/Attribution';\r\nimport { isMobile } from '../utils';\r\n\r\nexport default function Attribution({ config, actions, record }) {\r\n\r\n  const {mainMap, viewer} = config;\r\n\r\n  const [controlLoaded, setControlLoaded] = useState(false);\r\n\r\n  useEffect(() => {\r\n  }, []);\r\n\r\n  // Add attribution control\r\n  useEffect(() => {\r\n    if (!mainMap) return;\r\n    if (controlLoaded) return;\r\n    \r\n    setControlLoaded(true);\r\n\r\n    const mobile = isMobile();\r\n\r\n    let collapsed = record.collapsed == null ? false : record.collapsed;\r\n    if (mobile) collapsed = record.collapsed_mobile != null ? record.collapsed_mobile : collapsed;\r\n\r\n    let collapsible = record.collapsible == null ? true : record.collapsible;\r\n    if (mobile) collapsible = record.collapsible_mobile != null ? record.collapsible_mobile : collapsible;\r\n\r\n    const options = {\r\n      collapsed: collapsed,\r\n      collapsible: collapsible\r\n    }\r\n\r\n    const control = new OLAttribution(options);\r\n    mainMap.addControl(control);\r\n\r\n  }, [mainMap]);\r\n\r\n  return null;\r\n}","import ReactGA from \"react-ga\";\r\n\r\nexport const initGA = (trackingID) => {           \r\n    ReactGA.initialize(trackingID); \r\n }\r\n\r\nexport const PageView = () => {  \r\n    ReactGA.pageview(window.location.pathname +  \r\n                     window.location.search); \r\n}\r\n","import React, { useContext, useEffect, useRef } from 'react'\r\nimport { connect, useDispatch } from 'react-redux'\r\nimport Layout from './Layout'\r\nimport { withRouter } from 'react-router-dom'\r\nimport AppContext from '../../AppContext'\r\nimport MainMap from '../components/MainMap'\r\nimport MainMenu from './MainMenu'\r\nimport Layers from '../components/Layers'\r\nimport MorphLayer from '../components/Layers/MorphLayer'\r\nimport FooterLeft from './FooterLeft'\r\nimport FooterRight from './FooterRight'\r\nimport TopbarRight from './TopbarRight'\r\nimport MapControlsTopLeft from './MapControlsTopLeft'\r\nimport MapControlsTopRight from './MapControlsTopRight'\r\nimport MapControlsLeft from './MapControlsLeft'\r\nimport MapControlsBottomLeft from './MapControlsBottomLeft'\r\nimport MapControlsBottomRight from './MapControlsBottomRight'\r\nimport OlControls from '../map_control'\r\nimport { mapStateToProps } from '../utils'\r\nimport {PageView, initGA} from '../components/Tracking'\r\n\r\n/**\r\n * Viewer layout container\r\n * @param {Object} props \r\n */\r\nfunction Viewer(props) {\r\n\r\n  // Get router props\r\n  const { url } = props.match;\r\n  const { id } = props.match.params;\r\n  const { history, loading, viewer, config } = props;\r\n  const { exclusive_mapcontrol } = viewer;\r\n  const { layers } = viewer.config_json;\r\n  const { map_controls } = viewer.config_json;\r\n  \r\n  // Main map\r\n  let mainMapEl = useRef(null);\r\n  \r\n  // Enable redux actions\r\n  const dispatch = useDispatch();\r\n  const { core, mainMap } = useContext(AppContext);\r\n  const { viewer_load, layout_wrapper_click, layout_toggle_menu, layout_show_menu, viewer_update_mapcontrol } = core.actions;\r\n\r\n  const gaTrackingId = process.env.REACT_APP_GA_TRACKING_ID;\r\n\r\n  // Get config\r\n  React.useEffect(() => {\r\n    if (gaTrackingId) {\r\n      initGA(gaTrackingId);\r\n      PageView();\r\n    }\r\n\r\n    if (url.indexOf('/session') < 0) {\r\n      dispatch(viewer_load(core, id, history));\r\n    } else {\r\n      dispatch(viewer_load(core, id, history, true));\r\n    }\r\n  }, [id]);\r\n\r\n  useEffect(() => {\r\n    if (!viewer.config_json) return;\r\n    viewer.config_json.map_controls.filter(c => c.exclusive).forEach(control => {\r\n      if (control.id === exclusive_mapcontrol) {\r\n        dispatch(viewer_update_mapcontrol({ ...control, active: true }));\r\n      } else {\r\n        dispatch(viewer_update_mapcontrol({ ...control, active: false }));\r\n      }\r\n    });\r\n  }, [exclusive_mapcontrol]);\r\n\r\n  // TODO: improve loading UI\r\n  if (loading) return null;\r\n\r\n  let rlayers = ['overlays', 'main', 'background', 'basemaps'];\r\n  if (viewer.config_json && viewer.config_json.root_layers && viewer.config_json.root_layers.length > 0) {\r\n    rlayers = viewer.config_json.root_layers;\r\n  }\r\n\r\n  const rootLayers = layers.filter(c => rlayers.includes(c.id)).reverse();\r\n  return (\r\n    <Layout\r\n      history={history}\r\n      core={core}\r\n      viewer={viewer}\r\n      layout_wrapper_click={e => dispatch(layout_wrapper_click())}\r\n      layout_toggle_menu={isDesktop => dispatch(layout_toggle_menu(isDesktop))}\r\n      mainMenu={<MainMenu history={history} onMenuClick={isDesktop => dispatch(layout_show_menu(isDesktop))} />}\r\n      topbarRight={<TopbarRight />}\r\n      footerLeft={<FooterLeft />}\r\n      footerRight={<FooterRight />}\r\n      mainOlMap={mainMap}\r\n    >\r\n      <MainMap \r\n        olMap={mainMap}\r\n        config={config}\r\n        viewer={viewer}\r\n        mainMapEl={mainMapEl}\r\n        dispatch={dispatch}\r\n        core={core}\r\n      >\r\n        <Layers>\r\n          { rootLayers.map(c =>\r\n            \r\n            <MorphLayer\r\n              key={c.id}\r\n              config={c}\r\n              layers={layers}\r\n              checked={viewer.config_json.checked}\r\n              viewer={viewer}\r\n            />\r\n\r\n          ) }\r\n        </Layers>\r\n\r\n        <MapControlsTopLeft />\r\n        <MapControlsTopRight />\r\n        <MapControlsLeft />\r\n        <MapControlsBottomLeft />\r\n        <MapControlsBottomRight />\r\n\r\n        { !!map_controls && map_controls.map(ctrl => {\r\n          const OlControl = OlControls[ctrl.type];\r\n          return (\r\n            <OlControl\r\n              core={core}\r\n              key={ctrl.id}\r\n              config={{ viewer, mainMap, dispatch }}\r\n              actions={core.actions}\r\n              record={ctrl}\r\n            />\r\n          )\r\n        })}\r\n\r\n      </MainMap>\r\n    </Layout>\r\n  );\r\n}\r\n\r\nexport default connect(state => {\r\n  const gstate = mapStateToProps(state);\r\n  return ({ viewer: gstate.viewer });\r\n})(withRouter(Viewer));\r\n","import React from 'react'\r\nimport { Button } from 'primereact/button';\r\nimport { withRouter } from 'react-router-dom';\r\n\r\nfunction Page404({ history }) {\r\n  return (\r\n    <div className=\"p-d-flex p-jc-center\" style={{ height: '100%' }}>\r\n      <div className=\"p-as-center\" style={{ backgroundColor: 'white', padding: '6rem' }}>\r\n        <h1>Ops...</h1>\r\n        <p>O visualizador pedido não existe.</p>\r\n        <p>Clique para voltar a página inicial</p>\r\n        <p>\r\n          <Button label=\"Página Inicial\" onClick={e => history.push({ pathname: \"/\" })}></Button>\r\n        </p>\r\n      </div>\r\n  </div>\r\n  )\r\n}\r\n\r\nexport default withRouter(Page404);","import React from 'react'\r\nimport { Button } from 'primereact/button';\r\nimport { withRouter } from 'react-router-dom';\r\n\r\nfunction Page401({ history }) {\r\n  return (\r\n    <div className=\"p-d-flex p-jc-center\" style={{ height: '100%' }}>\r\n      <div className=\"p-as-center\" style={{ backgroundColor: 'white', padding: '6rem' }}>\r\n        <h1>Ops...</h1>\r\n        <p>Não está autorizado a aceder ao visualizador pedido.</p>\r\n        <p>Clique para voltar a página inicial ou clique para efetuar login</p>\r\n        <p>\r\n          <Button label=\"Página Inicial\" onClick={e => history.push({ pathname: \"/\" })}></Button>{' '}\r\n          <Button label=\"Entrar\" onClick={e => history.push({ pathname: \"/login\" })}></Button>\r\n        </p>\r\n      </div>\r\n  </div>\r\n  )\r\n}\r\n\r\nexport default withRouter(Page401);","import React, { useContext }  from 'react';\r\nimport { withRouter } from 'react-router-dom';\r\nimport LoginWidget from './LoginWidget';\r\nimport AppContext from '../../AppContext';\r\n\r\nfunction PageLogin(props) {\r\n  const { search } = props.location;\r\n  //const foundRedirect = /redirect=(.*)/i.exec(search);\r\n\r\n  const params = new URLSearchParams(search)\r\n  const redirect = params.get('redirect');\r\n  const path = params.get('path');\r\n  const url_redirect = params.get('url_redirect');\r\n\r\n  const { core } = useContext(AppContext);\r\n\r\n  const { CLIENT_URL } = core;\r\n\r\n  // Render page\r\n  const logo = CLIENT_URL + 'assets/images/logo.png';\r\n  return (\r\n    <div id=\"login-page\" className=\"p-d-flex p-jc-center\" style={{ height: '100%' }}>\r\n      <div className=\"p-as-center\" style={{ backgroundColor: 'white', padding: '6rem' }}>\r\n        \r\n        <div className=\"login-logo\">\r\n          <img alt=\"Logo\" src={logo} />  \r\n        </div>\r\n        \r\n        <LoginWidget\r\n          history={props.history}\r\n          /*redirect={foundRedirect ? foundRedirect[1] : null}*/\r\n          redirect={redirect || null}\r\n          path={path || null}\r\n          urlRedirect = {url_redirect || null}\r\n        />\r\n\r\n      </div>\r\n  </div>\r\n  )\r\n}\r\n\r\nexport default withRouter(PageLogin);","import React, { useContext, useState, useEffect } from 'react'\r\nimport Cookies from 'universal-cookie'\r\nimport { InputText } from 'primereact/inputtext'\r\nimport { Button } from 'primereact/button'\r\nimport { connect, useDispatch } from 'react-redux'\r\nimport AppContext from '../../AppContext'\r\nimport { Message } from 'primereact/message'\r\n\r\nconst cookies = new Cookies();\r\n\r\nfunction RegistrationConfirmationWidget({ token, auth, registration, history, redirect, urlRedirect }) {\r\n\r\n  const [emailConfirmation, setEmailConfirmation] = useState('');\r\n  const [goRedirect, setGoRedirect] = useState(false);\r\n\r\n  // Enable redux actions\r\n  const dispatch = useDispatch();\r\n  const { core } = useContext(AppContext);\r\n  const { registration_confirmation, registration_send_confirmation, login, logout } = core.actions;\r\n\r\n\r\n  const cookieData = cookies.get(core.COOKIE_AUTH_NAME);\r\n\r\n  useEffect(() => {\r\n    if (cookieData)  return;\r\n \r\n    dispatch(registration_confirmation({ token }, history, redirect));\r\n  }, []);\r\n  \r\n  // Render user\r\n  if (cookieData) {\r\n    const { username } = cookieData;\r\n    return (\r\n      <div>\r\n        <p>Existe uma sessão ativa para o utilizador <i><strong>{ username }</strong></i>.</p>\r\n        <p>\r\n          Clique para \r\n          <Button\r\n            className=\"p-button-link\"\r\n            label=\"terminar sessão\"\r\n            onClick={e => dispatch(logout())}\r\n          />e concluir registo de novo utilizador.\r\n        </p>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  const sendEmailConfirmation = () => {    \r\n    dispatch(registration_send_confirmation({ email: emailConfirmation }, history, redirect));\r\n  }\r\n\r\n  if (registration.response && !!registration.response && !!registration.response.authenticated) {\r\n    return (\r\n      <div className=\"p-d-flex p-ai-center p-dir-col p-px-3\">\r\n        <h3>Registo de utilizador</h3>\r\n        <i className=\"pi pi-check-circle\" style={{ fontSize: '5rem', color: 'var(--green-500)' }}></i>        \r\n        <p style={{ lineHeight: 1.5 }}>Registo de utilizador confirmado com sucesso!</p>\r\n        <Button label=\"Continuar\" \r\n          onClick={ e => {\r\n            setGoRedirect(true);\r\n            dispatch(login(registration.response, history, redirect, urlRedirect));\r\n          }}\r\n          icon={ goRedirect ? \"pi pi-spin pi-spinner\": \"pi pi-check\" }\r\n          disabled={goRedirect} />\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <React.Fragment>\r\n      { auth.http_error && !auth.response &&\r\n        <Message style={{ width: '100%' }} severity=\"error\" text=\"Serviço Indisponível\"></Message>\r\n      }\r\n\r\n      { auth.http_error && auth.response && !!auth.response.message && \r\n\r\n\r\n        <React.Fragment>\r\n          <div className=\"p-fluid\" style={{\"maxWidth\": \"500px\"}}>\r\n\r\n            <div className=\"p-field p-grid\">\r\n              <div className=\"p-col-12\">\r\n                <h3>Confirmação de registo de utilizador</h3>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"p-field p-grid\">\r\n              <div className=\"p-col-12 \">\r\n                <Message style={{ width: '100%' }} severity=\"error\" text={auth.response.message}></Message> \r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"p-field p-grid\">\r\n              <div className=\"p-col-12\">Indique o email utilizado no registo do utilizador para que seja enviada nova confirmação de registo.</div>\r\n            </div>                     \r\n\r\n            <div className=\"p-field p-grid\">\r\n              <label className=\"p-col-12 p-md-2\">Email</label>\r\n              <div className=\"p-col-12 p-md-10\">\r\n                <InputText value={emailConfirmation} onChange={(e) => setEmailConfirmation(e.target.value)} />\r\n              </div>\r\n            </div>         \r\n          </div>\r\n\r\n          <div className=\"p-dialog-myfooter\">\r\n            <Button \r\n              color='green'\r\n              icon={ auth.loading ? \"pi pi-spin pi-spinner\": \"pi pi-check\" }\r\n              label=\"Enviar\" \r\n              onClick={sendEmailConfirmation}\r\n              disabled={auth.loading}\r\n            />\r\n          </div>\r\n        </React.Fragment>\r\n\r\n      }\r\n\r\n      { !auth.http_error && auth.response && !!auth.response.message && \r\n          <div className=\"p-fluid\" style={{\"maxWidth\": \"500px\"}}>\r\n            <div className=\"p-field p-grid\">\r\n              <div className=\"p-col-12\">\r\n                <h3>Confirmação de registo de utilizador</h3>\r\n              </div>\r\n            </div>\r\n            <Message style={{ width: '100%' }} severity=\"info\" text={auth.response.message}></Message>\r\n          </div>\r\n      }\r\n\r\n\r\n    </React.Fragment>\r\n  )\r\n}\r\n\r\nexport default connect(state => ({ auth: state.root.auth, registration: state.root.registration }))(RegistrationConfirmationWidget)","import React,{ useContext }  from 'react';\r\nimport { withRouter } from 'react-router-dom';\r\nimport RegistrationConfirmationWidget from './RegistrationConfirmationWidget';\r\nimport AppContext from '../../AppContext';\r\n\r\nfunction PageRegistrationConfirmation(props) {\r\n  //const { token } = props.match.params;\r\n  const { search } = props.location;\r\n\r\n  const { core } = useContext(AppContext);\r\n\r\n  const { CLIENT_URL } = core;\r\n  \r\n  const query = new URLSearchParams(search);\r\n  const token = query.get('token');\r\n  //const redirect = query.get('redirect');\r\n\r\n  const foundRedirect = /redirect=(.*)/i.exec(search);\r\n  const foundUrlRedirect = /url_redirect=(.*)/i.exec(search);\r\n  \r\n\r\n  // Render page\r\n  const logo = CLIENT_URL + 'assets/images/logo.png';\r\n\r\n  return (\r\n    <div id=\"login-page\" className=\"p-d-flex p-jc-center\" style={{ height: '100%' }}>\r\n      <div className=\"p-as-center\" style={{ backgroundColor: 'white', padding: '6rem' }}>\r\n        \r\n        <div className=\"login-logo\">\r\n          <img alt=\"Logo\" src={logo} />  \r\n        </div>\r\n        \r\n        <RegistrationConfirmationWidget\r\n          token={token}\r\n          history={props.history}\r\n          redirect={foundRedirect ? foundRedirect[1] : null }\r\n          urlRedirect={foundUrlRedirect ? foundUrlRedirect[1] : null }\r\n        />\r\n\r\n      </div>\r\n  </div>\r\n  )\r\n}\r\n\r\nexport default withRouter(PageRegistrationConfirmation);","import React, { useContext, useState, useEffect } from 'react';\r\nimport { connect, useDispatch } from 'react-redux';\r\nimport Cookies from 'universal-cookie';\r\nimport { useForm, Controller } from 'react-hook-form';\r\nimport { InputText } from 'primereact/inputtext'\r\nimport { Password } from 'primereact/password';\r\nimport { Button } from 'primereact/button';\r\nimport { Divider } from 'primereact/divider';\r\nimport { Message } from 'primereact/message';\r\nimport AppContext from '../../AppContext';\r\nimport { classNames } from 'primereact/utils';\r\n\r\nconst cookies = new Cookies();\r\n\r\nfunction PasswordWidget({ token, auth, pwd, history, redirect, urlRedirect }) {\r\n\r\n  const [mode, setMode] = useState('set');\r\n\r\n  const [username, setUsername] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [goRedirect, setGoRedirect] = useState(false);\r\n\r\n  // Enable redux actions\r\n  const dispatch = useDispatch();\r\n  const { core } = useContext(AppContext);\r\n  const { login_reset_password, password_reset_validation, password_post, login_post, logout } = core.actions;\r\n\r\n  const cookieData = cookies.get(core.COOKIE_AUTH_NAME);\r\n\r\n  const defaultValues = {\r\n    newPassword: '',\r\n    confirmPassword: ''\r\n  }\r\n\r\n  const passwordStrengthLabels = {\r\n    weakLabel: 'Fraca',\r\n    mediumLabel: 'Média',\r\n    strongLabel: 'Forte'\r\n  }\r\n  \r\n  useEffect(() => {\r\n    if (cookieData)  return;\r\n    \r\n    dispatch(password_reset_validation({ token }, history, redirect));\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (auth.response && auth.response.valid_token === false) {\r\n      setMode('reset');\r\n    }\r\n  }, [auth]);\r\n\r\n  const { control, formState: { errors }, getValues, handleSubmit } = useForm({ defaultValues });\r\n  \r\n\r\n  const getFormValidationErrorMessage = (errors, name) => {\r\n    if (errors && errors[name]) {\r\n      if (errors[name].type === 'required') {\r\n        return <small className=\"p-error\">{errors[name].message || 'Campo obrigatório'}</small>\r\n      } else if (errors[name].type === 'maxLength') {\r\n         return <small className=\"p-error\">{errors[name].message || 'O número de caracteres é superior à dimensão máxima permitida'}</small>\r\n      } else if (errors[name].type === 'pattern') {\r\n        return <small className=\"p-error\">{errors[name].message || 'Formato inválido'}</small>\r\n      } else {\r\n        return <small className=\"p-error\">{errors[name].message}</small>\r\n      }\r\n    }      \r\n  };\r\n\r\n  const passwordFooter = (\r\n      <React.Fragment>\r\n          <Divider className=\"p-mt-2\" />\r\n          <p className=\"p-mt-2\">Sugestões:</p>\r\n          <ul className=\"p-pl-2 p-ml-2 p-mt-0\" style={{ lineHeight: '1.5' }}>\r\n              <li>Pelo menos uma minúscula</li>\r\n              <li>Pelo menos uma maiúscula</li>\r\n              <li>Pelo menos um dígito</li>\r\n              <li>Pelo menos 8 caracteres</li>\r\n          </ul>\r\n      </React.Fragment>\r\n  );\r\n\r\n  // Render user\r\n  if (cookieData) {\r\n    const { username } = cookieData;\r\n    return (\r\n      <div>\r\n        <p>Existe uma sessão ativa para o utilizador <i><strong>{ username }</strong></i>.</p>\r\n        <p>\r\n          Clique para \r\n          <Button\r\n            className=\"p-button-link\"\r\n            label=\"terminar sessão\"\r\n            onClick={e => dispatch(logout())}\r\n          />e fazer a alteração da palavra-passe.\r\n        </p>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  const onSubmit = (data) => {\r\n    setPassword(data.newPassword);\r\n    dispatch(password_post({ token, password: data.newPassword }, history, redirect))\r\n  }\r\n\r\n  if (pwd.response && !!pwd.response && !!pwd.response.authenticated) {\r\n    const username = pwd.response.username;\r\n    return (\r\n      <div className=\"p-d-flex p-ai-center p-dir-col p-px-3\">\r\n        <h3>Definição de Palavra-passe</h3>\r\n        <i className=\"pi pi-check-circle\" style={{ fontSize: '5rem', color: 'var(--green-500)' }}></i>        \r\n        <p style={{ lineHeight: 1.5 }}>A Palavra-passe foi alterada com sucesso!</p>\r\n        <Button label=\"Continuar\" \r\n          onClick={ e => {\r\n            setGoRedirect(true); \r\n            dispatch(login_post({ username, password }, history, redirect, urlRedirect));\r\n          }}\r\n          icon={ goRedirect ? \"pi pi-spin pi-spinner\": \"pi pi-check\" }\r\n          disabled={goRedirect} />\r\n      </div>\r\n    )\r\n  }\r\n\r\n  if (mode === 'reset') {\r\n    if (auth?.response?.reset_password) {\r\n      return (\r\n        <React.Fragment>\r\n          <div className=\"p-fluid\">\r\n\r\n            <div className=\"p-field p-grid\">\r\n              <div className=\"p-col-12\">\r\n                <h3>Alteração de Palavra-passe</h3>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"p-field p-grid\">\r\n              <div className=\"p-col-12 \">\r\n              <Message style={{ width: '100%' }} severity=\"info\" text={auth.response.message}></Message> \r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"p-field p-grid\">\r\n              <div className=\"p-col-12\">\r\n                <Button\r\n                  className=\"p-button-link\"\r\n                  label = \"Login\"\r\n                  onClick={() => {\r\n                    history.push('login?redirect=' + (redirect|| '/'));\r\n                  }}\r\n                />\r\n              </div>\r\n            </div>          \r\n          </div>\r\n\r\n          <div className=\"p-dialog-myfooter\"></div>\r\n        </React.Fragment>\r\n      )\r\n    } else {\r\n      return (\r\n        <React.Fragment>\r\n          <div className=\"p-fluid\">\r\n\r\n            <div className=\"p-field p-grid\">\r\n              <div className=\"p-col-12\">\r\n                <h3>Alteração de Palavra-passe</h3>\r\n                <p>Indique o seu <i>username</i> ou <i>email</i> para receber um email com instruções para alterar a palavra-passe.</p>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"p-field p-grid\">\r\n              <label className=\"p-col-12 p-md-4\">Nome de Utilizador / E-mail</label>\r\n              <div className=\"p-col-12 p-md-8\">\r\n                <InputText\r\n                  value={username}\r\n                  placeholder=\"Nome de Utilizador\"\r\n                  onChange={e => setUsername(e.target.value)}\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"p-dialog-myfooter\">\r\n            <Button \r\n              color='green'\r\n              icon={ auth.loading ? \"pi pi-spin pi-spinner\": \"pi pi-check\" }\r\n              label={\"Enviar\" }\r\n              onClick={(e)=> { e.preventDefault(); dispatch(login_reset_password({ username }, history, redirect));}}\r\n              disabled={auth.loading}\r\n            />\r\n          </div>\r\n\r\n          { auth.response && !!auth.response && !!auth.response.message && \r\n            <Message style={{ width: '100%' }} severity={auth.http_error ? \"error\" : \"info\"} text={auth?.response?.message}></Message>\r\n          }\r\n\r\n        </React.Fragment>   \r\n      )\r\n    }\r\n  }\r\n\r\n  if (mode === 'set') {\r\n    return (        \r\n      <form onSubmit={handleSubmit(onSubmit)} autoComplete=\"new-password\">\r\n        <div className=\"p-fluid\">       \r\n\r\n          <div className=\"p-field p-grid\">\r\n            <div className=\"p-col-12\">\r\n              <h3>Definição de Password</h3>\r\n              <p>Por favor, defina e confirme a sua nova palavra-passe</p>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"p-field p-grid\">\r\n            <label htmlFor=\"newPassword\" className={classNames({ 'p-col-12 p-md-4': true,'p-error': errors.newPassword })}>Palavra-passe*</label>\r\n            <div className=\"p-col-12 p-md-8\">\r\n              <Controller name=\"newPassword\" control={control} rules={{ required: 'Preenchimento obrigatório.' }} render={({ field, fieldState }) => (\r\n                <Password id={field.name} {...field} \r\n                  toggleMask\r\n                  promptLabel=\"Introduza a palavra-passe\"\r\n                  {...passwordStrengthLabels}\r\n                  className={classNames({ 'p-invalid': fieldState.invalid })} \r\n                  footer={passwordFooter}\r\n                  autoComplete=\"off\"\r\n                  aria-autocomplete=\"none\" />\r\n              )} />\r\n              {getFormValidationErrorMessage(errors, 'newPassword')}            \r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"p-field p-grid\">\r\n            <label htmlFor=\"confirmPassword\" className={classNames({ 'p-col-12 p-md-4': true,'p-error': errors.confirmPassword })}>Confirmar Palavra-passe*</label>\r\n            <div className=\"p-col-12 p-md-8\">\r\n              <Controller name=\"confirmPassword\" control={control} rules={{ required: 'Preenchimento obrigatório.', validate: ()=>{ if (getValues('newPassword') !== getValues('confirmPassword')) return \"As passwords não são iguais.\" } }} render={({ field, fieldState }) => (\r\n                <Password id={field.name} {...field} \r\n                  toggleMask \r\n                  feedback={false} \r\n                  className={classNames({ 'p-invalid': fieldState.invalid })}\r\n                  autoComplete=\"off\"\r\n                  aria-autocomplete=\"none\" />\r\n              )} />\r\n              {getFormValidationErrorMessage(errors, 'confirmPassword')}            \r\n            </div>\r\n          </div>      \r\n\r\n        </div>\r\n\r\n        <div className=\"p-dialog-myfooter\">\r\n          <Button \r\n            color='green'\r\n            icon={ pwd.loading ? \"pi pi-spin pi-spinner\": \"pi pi-check\" }\r\n            label=\"Aceitar\" \r\n            type=\"submit\"\r\n            disabled={pwd.loading}\r\n          />\r\n        </div>\r\n        \r\n        { pwd.http_error && !pwd.response &&\r\n          <Message style={{ width: '100%' }} severity=\"error\" text=\"Serviço Indisponível\"></Message>\r\n        }\r\n\r\n        { pwd.response && !!pwd.response && !pwd.authenticated && !!pwd.response.message && \r\n          <Message style={{ width: '100%' }} severity=\"error\" text=\"Dados inválidos\"></Message>\r\n        }\r\n\r\n      </form>\r\n    )\r\n  }\r\n}\r\n\r\nexport default connect(state => ({ auth: state.root.auth, pwd: state.root.password }))(PasswordWidget)","import React, { useEffect, useContext } from 'react';\r\nimport { withRouter } from 'react-router-dom';\r\nimport PasswordWidget from './PasswordWidget';\r\nimport AppContext from '../../AppContext';\r\n\r\nfunction PagePassword(props) {\r\n  //const { token } = props.match.params;\r\n  const { search } = props.location;\r\n\r\n  const { core } = useContext(AppContext);\r\n\r\n  const { CLIENT_URL } = core;\r\n  \r\n  const query = new URLSearchParams(search);\r\n  const token = query.get('token');\r\n  //const redirect = query.get('redirect');\r\n\r\n  const foundRedirect = /redirect=(.*)/i.exec(search);\r\n  const foundUrlRedirect = /url_redirect=(.*)/i.exec(search);\r\n  \r\n  // Render page\r\n  const logo = CLIENT_URL + 'assets/images/logo.png';\r\n\r\n  useEffect(() => {\r\n    //console.log(token);\r\n  }, []);\r\n\r\n  return (\r\n    <div id=\"login-page\" className=\"p-d-flex p-jc-center\" style={{ height: '100%' }}>\r\n      <div className=\"p-as-center\" style={{ backgroundColor: 'white', padding: '6rem', maxWidth: '700px' }}>\r\n        \r\n        <div className=\"login-logo\">\r\n          <img alt=\"Logo\" src={logo} />  \r\n        </div>        \r\n        \r\n        <PasswordWidget\r\n          token={token}\r\n          history={props.history}\r\n          redirect={foundRedirect ? foundRedirect[1] : null }\r\n          urlRedirect={foundUrlRedirect ? foundUrlRedirect[1] : null }\r\n        />\r\n\r\n      </div>\r\n  </div>\r\n  )\r\n}\r\n\r\nexport default withRouter(PagePassword);","import React, { useContext } from 'react';\r\nimport { withRouter } from 'react-router-dom';\r\nimport AppContext from '../../AppContext';\r\n\r\n\r\nconst message = \"Este website usa cookies para melhorar a sua experiência de navegação. Ao pressionar 'Aceito' está a concordar com a sua utilização.\"\r\n\r\nfunction SplashScreen(props) {\r\n\r\n  const { history, children } = props;\r\n\r\n  const { core } = useContext(AppContext);\r\n\r\n  const { CLIENT_URL } = core;\r\n\r\n  const defaultLogo = CLIENT_URL + 'assets/images/logo-splash.png';\r\n  const viewerLogo = CLIENT_URL + 'assets/images' + (props.location.pathname || '') + '/logo-splash.png';\r\n\r\n  const addDefaultSrc = (ev) => {\r\n    ev.target.src = defaultLogo;\r\n  }\r\n\r\n  return (\r\n    <div className=\"splashscreen p-d-flex p-jc-center\">\r\n      <div className=\"p-as-center\">\r\n\r\n        <div className=\"login-logo p-text-center\">\r\n          <img onError={addDefaultSrc} className=\"img-responsive\" src={viewerLogo} alt=\"Logo\" />  \r\n        </div>\r\n\r\n        <h3>Bem-vindo!</h3>\r\n        <p>\r\n          { process.env.REACT_APP_COOKIE_MESSAGE || message }           \r\n        </p>\r\n        { process.env.REACT_APP_COOKIE_INFO_URL && (<p><a href={process.env.REACT_APP_COOKIE_INFO_URL} target=\"_blank\" rel=\"noopener noreferrer\">Mais informação</a></p>) }\r\n\r\n        { children }\r\n\r\n      </div>\r\n  </div>\r\n  )\r\n}\r\n\r\nexport default withRouter(SplashScreen);","import React, { useState } from 'react';\r\nimport SplashScreen from './SplashScreen';\r\nimport { withCookies } from 'react-cookie';\r\nimport CookieConsent from \"react-cookie-consent\";\r\nimport Cookies from 'universal-cookie';\r\nimport ThemeSelector from './ThemeSelector';\r\n\r\nconst cookieName = process.env.REACT_APP_COOKIE_NAME || 'scalargis_rgpd';\r\nconst cookieValue = process.env.REACT_APP_COOKIE_VALUE || '2';\r\nconst cookiePath = process.env.REACT_APP_COOKIE_PATH || ''; \r\nconst cookieExpiresDays = parseInt(process.env.REACT_APP_COOKIE_EXPIRES_DAYS || '150', 10);\r\n\r\nfunction RGPD({ cookies, children }) {\r\n\r\n  const [cookiergpd, setCookiergpd] = useState(cookies.get(cookieName));\r\n\r\n  let theme = process.env.REACT_APP_DEFAULT_THEME || 'default';\r\n\r\n  function accept() {\r\n    setCookiergpd(cookieValue);\r\n\r\n    // Manually save cookie if using http access\r\n    if (window.location.protocol === 'http:') {\r\n      let expireDate = new Date();\r\n      expireDate.setDate(expireDate.getDate() + parseInt(cookieExpiresDays));\r\n      const cookies = new Cookies();\r\n      cookies.set(cookieName, cookieValue, { path: cookiePath, expires: expireDate,\r\n        secure: false, httpOnly: false });\r\n    }\r\n  }\r\n\r\n  return (\r\n    <ThemeSelector theme={theme}>\r\n      <React.Fragment>\r\n        { cookiergpd !== cookieValue && (\r\n          <SplashScreen>\r\n            <CookieConsent\r\n              location=\"bottom\"\r\n              buttonText=\"Aceito\"\r\n              cookieName={cookieName}\r\n              cookieValue={cookieValue}\r\n              expires={cookieExpiresDays}\r\n              onAccept={accept}\r\n              extraCookieOptions={{ path: cookiePath }}\r\n              debug={true}\r\n              cookieSecurity={false}\r\n              disableStyles={true}\r\n            >\r\n            </CookieConsent>\r\n          </SplashScreen>\r\n        ) }\r\n        \r\n        {/* cookiergpd ? children : <SplashScreen /> */}\r\n        { cookiergpd ? children : <></> }\r\n      </React.Fragment>\r\n    </ThemeSelector> \r\n  );\r\n} \r\n\r\nexport default withCookies(RGPD);","import React from 'react'\r\nimport Viewer from './Viewer'\r\nimport { BrowserRouter as Router, Switch, Route, Redirect } from 'react-router-dom'\r\nimport { Provider } from 'react-redux'\r\nimport HomePage from '../components/HomePage'\r\nimport Page404 from '../components/Page404'\r\nimport Page401 from '../components/Page401'\r\nimport AppContext, { core, mainMap } from '../../AppContext'\r\nimport PageLogin from '../components/PageLogin'\r\nimport PageRegistrationConfirmation from '../components/PageRegistrationConfirmation'\r\nimport PagePassword from '../components/PagePassword'\r\nimport RGPD from '../components/RGPD'\r\nimport { getAppBaseUrl } from '../utils'\r\n\r\nconst App = () => {\r\n\r\n  const base_url = getAppBaseUrl();\r\n\r\n  return (\r\n    <React.StrictMode>\r\n      <AppContext.Provider value={{ core, mainMap }}>\r\n        <Provider store={core.store}>\r\n          <Router basename={base_url}>\r\n            <RGPD>\r\n              <Switch>\r\n                <Route path=\"/login\" children={<PageLogin />} />\r\n                <Route path=\"/registration\" children={<PageRegistrationConfirmation />} />\r\n                <Route path=\"/password\" children={<PagePassword/>} />\r\n                <Route path=\"/not-found\" children={<Page404 />} />\r\n                <Route path=\"/not-allowed\" children={<Page401 />} />\r\n                <Route path=\"/mapa/session/:id?\" children={<Viewer />} />\r\n                <Route path=\"/map/session/:id?\" children={<Viewer />} />\r\n                <Route path=\"/mapa/:id?\" children={<Viewer />} />\r\n                <Route path=\"/map/:id?\" children={<Viewer />} />\r\n                <Route path=\"/:id\" children={<Viewer />} />\r\n                {/*\r\n                <Route path=\"/:id\" render={(props) => {\r\n                    console.log(props);\r\n                    return <Redirect to={`/map/${props.match.params.id || ''}${props.location.search || ''}`} />\r\n                }} />\r\n                */}\r\n                {/*\r\n                <Route path=\"/\" children={<HomePage />} />\r\n                */}\r\n                <Route path=\"/\" render={(props) => {\r\n                    return <Redirect to={`/map/${props.location.search || ''}`} />\r\n                }} />\r\n              </Switch>\r\n            </RGPD>\r\n          </Router>\r\n        </Provider>\r\n      </AppContext.Provider>\r\n    </React.StrictMode>\r\n  )\r\n}\r\n\r\nexport default App;","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then(registration => {\r\n        registration.unregister();\r\n      })\r\n      .catch(error => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","import 'react-app-polyfill/ie11';\r\nimport 'react-app-polyfill/stable';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport '@fortawesome/fontawesome-free/css/all.min.css';\r\nimport App from './core/containers/App';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nReactDOM.render(\r\n  <App />\r\n  , document.getElementById('root')\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}